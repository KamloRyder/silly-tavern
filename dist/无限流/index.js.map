{"version":3,"file":"index.js","mappings":"2MACIA,EADAC,E,gBCIJC,EAAOC,QAJC,CAACC,IACR,IAAIC,EAAI,CAAC,EAAgC,OAA7BC,EAAoBC,EAAEF,EAAGD,GAAWC,GAGhCA,CAAE,CAAE,MAAW,IAAOG,EAAqF,O,eCA5HN,EAAOC,QAJC,CAACC,IACR,IAAIC,EAAI,CAAC,EAAgC,OAA7BC,EAAoBC,EAAEF,EAAGD,GAAWC,GAGhCA,CAAE,CAAE,YAAiB,IAAOI,EAA2F,YAAG,YAAiB,IAAOA,EAA2F,a,+CCgPvP,MAAMC,EAAmB,IAzOhC,MACUC,aAAc,EACdC,aAA0B,YAC1BC,cAA+B,KAMvC,gBAAMC,GACJ,GAAIC,KAAKJ,YACPK,QAAQC,IAAI,kCAId,IACED,QAAQC,IAAI,+BAGZ,MAAMC,EAAiBC,sBAAsB,WAEzCD,EAAeE,SACjBL,KAAKF,cAAgBK,EAAeE,QACpCJ,QAAQC,IAAI,kCAAmCF,KAAKF,iBAEpDG,QAAQK,KAAK,kCACbN,KAAKF,cAAgB,MAGvBE,KAAKJ,aAAc,EACnBK,QAAQC,IAAI,6BACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,4BAA6BA,GACrCA,CACR,CACF,CAMA,8BAAMC,GACJ,IACE,IAAKR,KAAKF,cAER,YADAG,QAAQK,KAAK,kCAIfL,QAAQC,IAAI,kCAGZ,MAGMO,SAHkBC,aAAaV,KAAKF,gBAGPa,IAAIC,IAErC,MAAMC,EAAYD,EAAME,OAAOD,UAE/B,MAAkB,cAAdA,EAEK,IACFD,EACHG,SAAU,IACLH,EAAMG,SACTC,KAAM,aAGa,eAAdH,GAA4C,cAAdA,EAEhC,IACFD,EACHG,SAAU,IACLH,EAAMG,SACTC,KAAM,YACNC,KAAML,EAAMG,SAASE,KAAKC,OAAS,EAAIN,EAAMG,SAASE,KAAO,CAAC,qBAK3DL,UAKLO,iBAAiBnB,KAAKF,cAAeW,GAE3CT,KAAKH,aAAe,YACpBI,QAAQC,IAAI,+BACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,iCAAkCA,GAC1CA,CACR,CACF,CAMA,+BAAMa,GACJ,IACE,IAAKpB,KAAKF,cAER,YADAG,QAAQK,KAAK,kCAIfL,QAAQC,IAAI,iCAGZ,MAGMO,SAHkBC,aAAaV,KAAKF,gBAGPa,IAAIC,IAErC,MAAMC,EAAYD,EAAME,OAAOD,UAE/B,MAAkB,eAAdA,EAEK,IACFD,EACHG,SAAU,IACLH,EAAMG,SACTC,KAAM,aAGa,cAAdH,GAA2C,cAAdA,EAE/B,IACFD,EACHG,SAAU,IACLH,EAAMG,SACTC,KAAM,YACNC,KAAML,EAAMG,SAASE,KAAKC,OAAS,EAAIN,EAAMG,SAASE,KAAO,CAAC,qBAK3DL,UAKLO,iBAAiBnB,KAAKF,cAAeW,GAE3CT,KAAKH,aAAe,aACpBI,QAAQC,IAAI,8BACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,gCAAiCA,GACzCA,CACR,CACF,CAMA,oCAAMc,GACJ,IACE,IAAKrB,KAAKF,cAER,YADAG,QAAQK,KAAK,kCAIfL,QAAQC,IAAI,gCAGZ,MAGMO,SAHkBC,aAAaV,KAAKF,gBAGPa,IAAIC,IAErC,MAAMC,EAAYD,EAAME,OAAOD,UAE/B,MAAkB,cAAdA,EAEK,IACFD,EACHG,SAAU,IACLH,EAAMG,SACTC,KAAM,aAGa,cAAdH,GAA2C,eAAdA,EAE/B,IACFD,EACHG,SAAU,IACLH,EAAMG,SACTC,KAAM,YACNC,KAAML,EAAMG,SAASE,KAAKC,OAAS,EAAIN,EAAMG,SAASE,KAAO,CAAC,qBAK3DL,UAKLO,iBAAiBnB,KAAKF,cAAeW,GAE3CT,KAAKH,aAAe,YACpBI,QAAQC,IAAI,6BACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,+BAAgCA,GACxCA,CACR,CACF,CAKA,eAAAe,GACE,OAAOtB,KAAKH,YACd,CAKA,gBAAA0B,GACE,OAAOvB,KAAKF,aACd,CAMA,YAAM0B,GACJxB,KAAKJ,aAAc,QACbI,KAAKD,YACb,E,SChPFZ,EAAOC,QAAUqC,G,6DCUV,MAAMC,GAAoB,IAAAC,aAAY,YAAa,KAExD,MAAMC,GAAS,IAAAC,UAAiCC,GAC1CC,GAAO,IAAAF,KAA+B,IAAIG,KAC1CC,GAAmB,IAAAJ,KAAc,IAGjCK,GAAY,IAAAC,UAAS,SAAuBL,IAAjBF,EAAOQ,OAElCC,GAAU,IAAAF,UAAS,IAAMG,MAAMC,KAAKR,EAAKK,MAAMI,WAE/CC,GAAW,IAAAN,UAAS,IAAMJ,EAAKK,MAAMM,MAErCC,GAAa,IAAAR,UAAS,IACnBF,EAAiBG,MAAMzB,IAAIiC,GAAMb,EAAKK,MAAMS,IAAID,IAAKE,OAAQC,QAAqCjB,IAARiB,IAG7FC,GAAgB,IAAAb,UAAS,IACtBE,EAAQD,MAAMU,OAAOC,GAAOA,EAAIE,cA8TzC,MAAO,CAELrB,SACAG,OACAE,mBAGAC,YACAG,UACAI,WACAE,aACAK,gBAGAE,YApUFC,iBACE,IACElD,QAAQC,IAAI,qCAGZ,IACE,MAAMkD,EAAaC,aAAa,CAAErC,KAAM,WACpCoC,EAAWE,mBACb1B,EAAOQ,MAAQgB,EAAWE,iBAC1BrD,QAAQC,IAAI,mCAAoC0B,EAAOQ,MAAMmB,MAEjE,CAAE,MAAOC,GACPvD,QAAQK,KAAK,0CAA2CkD,EAC1D,CAGA,IAAK5B,EAAOQ,MAAO,CACjB,MAAMqB,QAAiB,EAAAC,WAAWC,eAGlC,GAAIF,EAASG,WAAWhC,OAAQ,CAC9BA,EAAOQ,MAAQqB,EAASG,WAAWhC,OACnC3B,QAAQC,IAAI,oCAAqC0B,EAAOQ,MAAMmB,MAG9D,IACEM,wBAAwB,CAAEP,iBAAkB1B,EAAOQ,OAAS,CAAEpB,KAAM,WACpEf,QAAQC,IAAI,iCACd,CAAE,MAAO4D,GACP7D,QAAQK,KAAK,+BAAgCwD,EAC/C,CACF,CACF,CAGA,MAAML,QAAiB,EAAAC,WAAWC,eAClC5B,EAAKK,MAAM2B,QACXC,OAAOC,QAAQR,EAASG,WAAW7B,MAAMmC,QAAQ,EAAEtB,EAAIG,MACrDhB,EAAKK,MAAM+B,IAAIvB,EAAIG,KAGrB9C,QAAQC,IAAI,yBAAyB6B,EAAKK,MAAMM,aAClD,CAAE,MAAOnC,GAGP,MAFAN,QAAQM,MAAM,8BAA+BA,GAC7C6D,OAAO7D,MAAM,YACPA,CACR,CACF,EAsRE8D,UAjRFlB,eAAyBmB,GACvB,IACE1C,EAAOQ,MAAQkC,QAGT,EAAAZ,WAAWa,cAAcD,GAG/B,IACET,wBAAwB,CAAEP,iBAAkBgB,GAAa,CAAEtD,KAAM,WACjEf,QAAQC,IAAI,iCACd,CAAE,MAAOsD,GACPvD,QAAQK,KAAK,+BAAgCkD,EAC/C,CAEAvD,QAAQC,IAAI,8BAA+BoE,EAAUf,MACrDa,OAAOI,QAAQ,QAAQF,EAAUf,YACnC,CAAE,MAAOhD,GAGP,MAFAN,QAAQM,MAAM,8BAA+BA,GAC7C6D,OAAO7D,MAAM,YACPA,CACR,CACF,EA4PEkE,aAvPFtB,eAA4BuB,GAC1B,IAAK9C,EAAOQ,MACV,MAAM,IAAIuC,MAAM,WAGlB,IAEMD,EAAQE,YACVZ,OAAOa,OAAOjD,EAAOQ,MAAMwC,WAAYF,EAAQE,YAE7CF,EAAQI,cACVd,OAAOa,OAAOjD,EAAOQ,MAAM0C,aAAcJ,EAAQI,cAE/CJ,EAAQK,YACVnD,EAAOQ,MAAM2C,UAAYL,EAAQK,iBAI7B,EAAArB,WAAWsB,sBAAsB,SAAUN,GAGjD,IACEb,wBAAwB,CAAEP,iBAAkB1B,EAAOQ,OAAS,CAAEpB,KAAM,WACpEf,QAAQC,IAAI,mCACd,CAAE,MAAOsD,GACPvD,QAAQK,KAAK,+BAAgCkD,EAC/C,CAEAvD,QAAQC,IAAI,+BACd,CAAE,MAAOK,GAGP,MAFAN,QAAQM,MAAM,gCAAiCA,GAC/C6D,OAAO7D,MAAM,YACPA,CACR,CACF,EAsNE0E,OAjNF9B,eAAsBJ,GACpB,IACEhB,EAAKK,MAAM+B,IAAIpB,EAAIH,GAAIG,SACjB,EAAAW,WAAWa,cAAcxB,GAC/B9C,QAAQC,IAAI,8BAA+B6C,EAAIQ,MAC/Ca,OAAOI,QAAQ,OAAOzB,EAAIQ,YAC5B,CAAE,MAAOhD,GAGP,MAFAN,QAAQM,MAAM,+BAAgCA,GAC9C6D,OAAO7D,MAAM,aACPA,CACR,CACF,EAuME2E,UAlMF/B,eAAyBgC,EAAeT,GACtC,MAAM3B,EAAMhB,EAAKK,MAAMS,IAAIsC,GAC3B,IAAKpC,EACH,MAAM,IAAI4B,MAAM,OAAOQ,SAGzB,IAEMT,EAAQE,YACVZ,OAAOa,OAAO9B,EAAI6B,WAAYF,EAAQE,YAEpCF,EAAQI,cACVd,OAAOa,OAAO9B,EAAI+B,aAAcJ,EAAQI,cAEtCJ,EAAQK,YACVhC,EAAIgC,UAAYL,EAAQK,gBAEAjD,IAAtB4C,EAAQU,YACVrC,EAAIqC,UAAYV,EAAQU,iBAIpB,EAAA1B,WAAWsB,sBAAsBG,EAAOT,GAC9CzE,QAAQC,IAAI,yBAAyB6C,EAAIQ,cAC3C,CAAE,MAAOhD,GAGP,MAFAN,QAAQM,MAAM,4BAA4B4E,UAAe5E,GACzD6D,OAAO7D,MAAM,eACPA,CACR,CACF,EAsKE8E,UAhKFlC,eAAyBgC,GACvB,MAAMpC,EAAMhB,EAAKK,MAAMS,IAAIsC,GAC3B,IAAKpC,EACH,MAAM,IAAI4B,MAAM,OAAOQ,SAGzB,IACE,MAAMG,EAAUvC,EAAIQ,KAGpBxB,EAAKK,MAAMmD,OAAOJ,GAGlBlD,EAAiBG,MAAQH,EAAiBG,MAAMU,OAAOF,GAAMA,IAAOuC,SAG9D,EAAAzB,WAAW2B,UAAUF,GAE3BlF,QAAQC,IAAI,yBAAyBoF,UACrClB,OAAOoB,KAAK,OAAOF,iBACrB,CAAE,MAAO/E,GAGP,MAFAN,QAAQM,MAAM,4BAA4B4E,QAAa5E,GACvD6D,OAAO7D,MAAM,aACPA,CACR,CACF,EAwIEkF,aAnIF,SAAsBC,GACpB,MAAoB,WAAhBA,GAA6B9D,EAAOQ,OAASR,EAAOQ,MAAMQ,KAAO8C,EAC5D9D,EAAOQ,MAETL,EAAKK,MAAMS,IAAI6C,EACxB,EA+HEC,oBAzHF,SAA6BC,GAC3B3D,EAAiBG,MAAQwD,EACzB3F,QAAQC,IAAI,+BAAgC0F,EAC9C,EAuHEC,mBAlHF,SAA4BH,GACrBzD,EAAiBG,MAAM0D,SAASJ,KACnCzD,EAAiBG,MAAM2D,KAAKL,GAC5BzF,QAAQC,IAAI,wBAAwBwF,UAExC,EA8GEM,sBAzGF,SAA+BN,GAC7BzD,EAAiBG,MAAQH,EAAiBG,MAAMU,OAAOF,GAAMA,IAAO8C,GACpEzF,QAAQC,IAAI,wBAAwBwF,SACtC,EAuGEO,gBAlGF9C,eAA+BgC,EAAeC,GAC5C,MAAMrC,EAAMhB,EAAKK,MAAMS,IAAIsC,GAC3B,IAAKpC,EACH,MAAM,IAAI4B,MAAM,OAAOQ,SAGzB,IAEE,MAAMe,EAAmBC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKjB,IAEnDrC,EAAIqC,UAAYc,QACV,EAAAxC,WAAWsB,sBAAsBG,EAAO,CAAEC,UAAWc,IAE3DjG,QAAQC,IAAI,yBAAyB6C,EAAIQ,gBAAgB2C,IAC3D,CAAE,MAAO3F,GAGP,MAFAN,QAAQM,MAAM,4BAA4B4E,WAAgB5E,GAC1D6D,OAAO7D,MAAM,WACPA,CACR,CACF,EAgFE+F,gBA3EFnD,eAA+BgC,EAAelC,GAC5C,MAAMF,EAAMhB,EAAKK,MAAMS,IAAIsC,GAC3B,IAAKpC,EACH,MAAM,IAAI4B,MAAM,OAAOQ,SAGzB,IACEpC,EAAIE,YAAcA,QACZ,EAAAS,WAAWa,cAAcxB,GAE/B,MAAMwD,EAAStD,EAAc,KAAO,KACpChD,QAAQC,IAAI,yBAAyB6C,EAAIQ,WAAWgD,OACpDnC,OAAOoB,KAAK,GAAGzC,EAAIQ,YAAYgD,MACjC,CAAE,MAAOhG,GAGP,MAFAN,QAAQM,MAAM,4BAA4B4E,WAAgB5E,GAC1D6D,OAAO7D,MAAM,aACPA,CACR,CACF,EA0DEiG,YArDFrD,eAA2BgC,EAAesB,GACxC,MAAM1D,EAAMhB,EAAKK,MAAMS,IAAIsC,GAC3B,IAAKpC,EACH,MAAM,IAAI4B,MAAM,OAAOQ,SAGzB,IACEpC,EAAI2D,OAAOX,KAAKU,SACV,EAAA/C,WAAWa,cAAcxB,GAC/B9C,QAAQC,IAAI,yBAAyB6C,EAAIQ,eAC3C,CAAE,MAAOhD,GAEP,MADAN,QAAQM,MAAM,4BAA4B4E,YAAiB5E,GACrDA,CACR,CACF,EAwCEoG,MAnCF,WACE/E,EAAOQ,WAAQN,EACfC,EAAKK,MAAM2B,QACX9B,EAAiBG,MAAQ,GACzBnC,QAAQC,IAAI,4BACd,I,+DCgPK,MAAM0G,EAAsB,IA7jBnC,MAME,iBAAMC,CAAYvC,GAGhB,aAAa,QAAe,YAAanB,UACvC,IACElD,QAAQC,IAAI,sCAAuCoE,EAAUf,MAC7Da,OAAOoB,KAAK,iBAGZ,MAAMsB,EAAS,qFAKhBxC,EAAUf,cACVe,EAAUyC,KAAO,cACjBzC,EAAU0C,YAAc,cACxB1C,EAAU2C,YAAc,4MAcnB3C,EAAUf,8ZAgCd,IAAI2D,EARJjH,QAAQC,IAAI,uCACZD,QAAQC,IAAI,iCAAkC,CAC5CiH,eAAe,EACfC,cAAeN,EAAO5F,OACtBmG,eAAgB/C,EAAUf,KAC1B+D,qBAAsBhD,EAAU0C,YAAc,OAIhD,IACEE,QAAaK,SAAS,CACpBC,WAAYV,EACZK,eAAe,IAGjBlH,QAAQC,IAAI,6CACZD,QAAQC,IAAI,mCAAoCgH,EAAKhG,OAAQ,MAC7DjB,QAAQC,IAAI,sCAAuCgH,EACrD,CAAE,MAAOO,GAOP,MANAxH,QAAQM,MAAM,kCAAmC,CAC/CA,MAAOkH,aAAoB9C,MAAQ8C,EAASC,QAAUC,OAAOF,GAC7DG,MAAOH,aAAoB9C,MAAQ8C,EAASG,WAAQ9F,IAIhD,IAAI6C,MAAM,aAAa8C,aAAoB9C,MAAQ8C,EAASC,QAAUC,OAAOF,KACrF,CAGA,MAAMI,QAAe7H,KAAK8H,iBAAiBZ,EAAM5C,GAYjD,OATArE,QAAQC,IAAI,gDACNF,KAAK+H,oBAAoBF,SAGzB7H,KAAKgI,QAAQH,GAEnB5H,QAAQC,IAAI,oCACZkE,OAAOI,QAAQ,eAERqD,CACT,CAAE,MAAOtH,GACPN,QAAQM,MAAM,gCAAiCA,GAC/CN,QAAQM,MAAM,8BAA+B,CAC3CmH,QAASnH,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,GACzDqH,MAAOrH,aAAiBoE,MAAQpE,EAAMqH,WAAQ9F,EAC9CwC,UAAWA,EAAUf,OAEvBtD,QAAQK,KAAK,iDAEb,IAEEL,QAAQC,IAAI,yCACZ,MAAM2H,EAAS7H,KAAKiI,mBAAmB3D,GAgBvC,OAfArE,QAAQC,IAAI,kCAAmC,CAC7CgI,YAAaL,EAAOM,MAAMzF,KAC1B0F,UAAWP,EAAOO,UAClBC,eAAgBR,EAAOQ,iBAIzBpI,QAAQC,IAAI,gDACNF,KAAK+H,oBAAoBF,SAEzB7H,KAAKgI,QAAQH,GAEnB5H,QAAQC,IAAI,4CACZkE,OAAOkE,QAAQ,mBAERT,CACT,CAAE,MAAOU,GAOP,MANAtI,QAAQM,MAAM,mCAAoCgI,GAClDtI,QAAQM,MAAM,kCAAmC,CAC/CmH,QAASa,aAAyB5D,MAAQ4D,EAAcb,QAAUC,OAAOY,GACzEX,MAAOW,aAAyB5D,MAAQ4D,EAAcX,WAAQ9F,IAEhEsC,OAAO7D,MAAM,cACPgI,CACR,CACF,GAEJ,CAMA,aAAMP,CAAQrH,GACZ,IACEV,QAAQC,IAAI,wCAEZ,MAAMsI,EAAgB,CACpBL,MAAO7F,MAAMC,KAAK5B,EAAIwH,MAAMlE,WAAWtD,IAAI,EAAE,CAAE8H,KAAUA,GACzDC,YAAa/H,EAAI+H,YACjBL,eAAgB1H,EAAI0H,eACpBD,UAAWzH,EAAIyH,WAGjBnI,QAAQC,IAAI,+BAAgC,CAC1C,KAAMsI,EAAcL,MAAMjH,OAC1B,KAAMsH,EAAcE,YAAYxH,OAChC,KAAMsH,EAAcH,eACpB,KAAMG,EAAcJ,YAGtBvE,wBAAwB,CAAE8E,eAAgBH,GAAiB,CAAExH,KAAM,WACnEf,QAAQC,IAAI,2CACd,CAAE,MAAOK,GAIP,MAHAN,QAAQM,MAAM,kCAAmCA,GACjDN,QAAQM,MAAM,8BAA+BA,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,IAC7F6D,OAAO7D,MAAM,UACPA,CACR,CACF,CAMA,aAAMqI,GACJ,IACE,MACMC,EADYxF,aAAa,CAAErC,KAAM,WAChB2H,eAEvB,IAAKE,IAASA,EAAKV,MAEjB,OADAlI,QAAQC,IAAI,qCACL,KAIT,MAEM4I,EAAmB,CACvBX,MAHY,IAAInG,IAIhB0G,YAAaG,EAAKH,aAAe,GACjCL,eAAgBQ,EAAKR,gBAAkBQ,EAAKT,WAAa,OACzDA,UAAWS,EAAKT,WAAa,QAI/B,OADAnI,QAAQC,IAAI,oCACL4I,CACT,CAAE,MAAOvI,GAEP,OADAN,QAAQM,MAAM,gCAAiCA,GACxC,IACT,CACF,CAMA,0BAAMwI,CAAqBC,GACzB,IACE,MAAMrI,QAAYX,KAAK4I,UACvB,IAAKjI,EACH,MAAM,IAAIgE,MAAM,aAGlB,IAAKhE,EAAIwH,MAAMc,IAAID,GACjB,MAAM,IAAIrE,MAAM,MAAMqE,SAGxBrI,EAAI0H,eAAiBW,EAGrB,MAAMP,EAAO9H,EAAIwH,MAAMtF,IAAImG,GACvBP,IACFA,EAAKS,cAAe,SAGhBlJ,KAAKgI,QAAQrH,GACnBV,QAAQC,IAAI,kCAAkC8I,IAChD,CAAE,MAAOzI,GAEP,MADAN,QAAQM,MAAM,kCAAmCA,GAC3CA,CACR,CACF,CAMA,YAAM4I,GAEJ,OAAe,aADGnJ,KAAK4I,SAEzB,CAQQ,sBAAMd,CAAiBZ,EAAc5C,GAC3C,MAAM8E,YAAc,4CAAgBC,QAEpCpJ,QAAQC,IAAI,wDACZD,QAAQC,IAAI,8BAA+BgH,EAAKhG,OAAQ,MAGxDjB,QAAQC,IAAI,iEACZ,MAAMoJ,EAAW,CACf,CAAEC,MAAO,2BAA4BhG,KAAM,WAC3C,CAAEgG,MAAO,0BAA2BhG,KAAM,UAC1C,CAAEgG,MAAO,uBAAwBhG,KAAM,QAGzC,IAAK,IAAIiG,EAAI,EAAGA,EAAIF,EAASpI,OAAQsI,IAAK,CACxC,MAAM,MAAED,EAAK,KAAEhG,GAAS+F,EAASE,GACjCvJ,QAAQC,IAAI,8BAA8BsJ,EAAI,MAAMjG,KACpD,MAAMkG,EAAQvC,EAAKuC,MAAMF,GACzB,GAAIE,EAAO,CACTxJ,QAAQC,IAAI,sCAAsCqD,MAClDtD,QAAQC,IAAI,kCAAkCuJ,EAAM,GAAGvI,aACvD,IACE,MAAM4H,EAAUM,KAAKM,MAAMD,EAAM,IAOjC,GANAxJ,QAAQC,IAAI,qCACZD,QAAQC,IAAI,8BAA+B,CACzCgI,YAAaY,EAAQX,OAAOjH,QAAU,EACtCkH,UAAWU,EAAQV,UACnBuB,SAAUb,EAAQX,OAAOyB,KAAMC,GAAoB,SAATA,EAAEjH,MAE1C5C,KAAK8J,gBAAgBhB,GAIvB,OAHA7I,QAAQC,IAAI,kCACZD,QAAQC,IAAI,0CACZkE,OAAOI,QAAQ,eACRxE,KAAK+J,aAAajB,GAEzB7I,QAAQK,KAAK,iCAEjB,CAAE,MAAO0J,GACP/J,QAAQK,KAAK,qCAAsC0J,aAAarF,MAAQqF,EAAEtC,QAAUC,OAAOqC,IAC3F,QACF,CACF,MACE/J,QAAQC,IAAI,oCAEhB,CACAD,QAAQC,IAAI,gDAGZD,QAAQC,IAAI,8DACZ,IACE,MAAM4I,EAAUM,KAAKM,MAAMxC,GAO3B,GANAjH,QAAQC,IAAI,qCACZD,QAAQC,IAAI,8BAA+B,CACzCgI,YAAaY,EAAQX,OAAOjH,QAAU,EACtCkH,UAAWU,EAAQV,UACnBuB,SAAUb,EAAQX,OAAOyB,KAAMC,GAAoB,SAATA,EAAEjH,MAE1C5C,KAAK8J,gBAAgBhB,GAKvB,OAJA7I,QAAQC,IAAI,kCACZD,QAAQC,IAAI,uDACZD,QAAQC,IAAI,0CACZkE,OAAOI,QAAQ,eACRxE,KAAK+J,aAAajB,GAEzB7I,QAAQK,KAAK,iCAEjB,CAAE,MAAO0J,GACP/J,QAAQK,KAAK,qCAAsC0J,aAAarF,MAAQqF,EAAEtC,QAAUC,OAAOqC,GAC7F,CAcA,OAbA/J,QAAQC,IAAI,2CAGZD,QAAQK,KAAK,oEACbL,QAAQK,KAAK,+CACbL,QAAQC,IAAI,iDACZD,QAAQC,IAAI,8BAA+B,CACzCqD,KAAMe,EAAUf,KAChByD,WAAY1C,EAAU0C,WACtBD,IAAKzC,EAAUyC,MAEjB9G,QAAQC,IAAI,6CACZkE,OAAOkE,QAAQ,mBACRtI,KAAKiI,mBAAmB3D,EACjC,CAOQ,YAAAyF,CAAajB,GACnB7I,QAAQC,IAAI,0CAEZ,MAAMiI,EAAQ,IAAInG,IACZoG,EAAYU,EAAQV,WAAa,OAEnCU,EAAQX,OAAS7F,MAAM2H,QAAQnB,EAAQX,QACzCW,EAAQX,MAAMjE,QAASuE,IACrBN,EAAMhE,IAAIsE,EAAK7F,GAAI,CACjBA,GAAI6F,EAAK7F,GACTW,KAAMkF,EAAKlF,KACX2G,YAAazB,EAAKyB,YAClBjD,WAAYwB,EAAKxB,WACjBkD,eAAgB1B,EAAK0B,gBAAkB,GACvCjB,aAAcT,EAAK7F,KAAOwF,EAC1BgC,YAAa3B,EAAK2B,cAAe,EACjCC,YAAa5B,EAAK4B,aAAe,OAKvC,MAAMxC,EAAkB,CACtBM,QACAO,YAAaI,EAAQJ,aAAe,GACpCL,eAAgBD,EAChBA,UAAWA,GAIb,OADAnI,QAAQC,IAAI,wCAAyCiI,EAAMzF,KAAM,OAC1DmF,CACT,CAOQ,eAAAiC,CAAgBhB,GACtB,IAAKA,GAA8B,iBAAZA,EAErB,OADA7I,QAAQK,KAAK,mCACN,EAGT,IAAKwI,EAAQX,QAAU7F,MAAM2H,QAAQnB,EAAQX,OAE3C,OADAlI,QAAQK,KAAK,sCACN,EAGT,GAA6B,IAAzBwI,EAAQX,MAAMjH,OAEhB,OADAjB,QAAQK,KAAK,qCACN,EAKT,IADgBwI,EAAQX,MAAMyB,KAAMnB,GAA0B,SAAZA,EAAK7F,IAGrD,OADA3C,QAAQK,KAAK,qCACN,EAIT,IAAK,MAAMmI,KAAQK,EAAQX,MACzB,IAAKM,EAAK7F,KAAO6F,EAAKlF,OAASkF,EAAKyB,YAElC,OADAjK,QAAQK,KAAK,kCAAmCmI,IACzC,EAIX,OAAO,CACT,CAOQ,kBAAAR,CAAmB3D,GACzBrE,QAAQC,IAAI,qCAEZ,MAAMiI,EAAQ,IAAInG,IA+ClB,GA5CAmG,EAAMhE,IAAI,OAAQ,CAChBvB,GAAI,OACJW,KAAM,GAAGe,EAAUf,SACnB2G,YAAa,KAAK5F,EAAUf,YAC5B4G,eAAgB,CAAC,UACjBjB,cAAc,EACdkB,aAAa,EACbC,YAAa,KAIflC,EAAMhE,IAAI,SAAU,CAClBvB,GAAI,SACJW,KAAM,MACN2G,YAAa,kBACbC,eAAgB,CAAC,OAAQ,OAAQ,QACjCjB,cAAc,EACdkB,aAAa,EACbC,YAAa,KAIflC,EAAMhE,IAAI,OAAQ,CAChBvB,GAAI,OACJW,KAAM,MACN2G,YAAa,aACbC,eAAgB,CAAC,UACjBjB,cAAc,EACdkB,aAAa,EACbC,YAAa,KAIflC,EAAMhE,IAAI,OAAQ,CAChBvB,GAAI,OACJW,KAAM,OACN2G,YAAa,aACbC,eAAgB,CAAC,UACjBjB,cAAc,EACdkB,aAAa,EACbC,YAAa,KAIX/F,EAAU0C,YAAuC,OAAzB1C,EAAU0C,WAAqB,CACzD/G,QAAQC,IAAI,gCAAgCoE,EAAU0C,sBACtDmB,EAAMhE,IAAI,OAAQ,CAChBvB,GAAI,OACJW,KAAM,GAAGe,EAAU0C,iBACnBkD,YAAa,GAAG5F,EAAUf,YAC1B4G,eAAgB,CAAC,UACjBjB,cAAc,EACdkB,aAAa,EACbC,YAAa,KAIAlC,EAAMtF,IAAI,UAClBsH,eAAepE,KAAK,OAC7B,MACE9F,QAAQC,IAAI,uCAGd,MAAM2H,EAAS,CACbM,QACAO,YAAa1I,KAAKsK,oBAAoBnC,GACtCE,eAAgB,OAChBD,UAAW,QAIb,OADAnI,QAAQC,IAAI,sCAAuCiI,EAAMzF,KAAM,OACxDmF,CACT,CAOQ,mBAAAyC,CAAoBnC,GAC1B,MAAMO,EAAmD,GAYzD,OAVAP,EAAMjE,QAAQuE,IACZA,EAAK0B,eAAejG,QAAQqG,IAEJ7B,EAAYkB,KAAKY,GAAKA,EAAEjI,OAASgI,GAAeC,EAAEC,KAAOhC,EAAK7F,KAElF8F,EAAY3C,KAAK,CAAExD,KAAMkG,EAAK7F,GAAI6H,GAAIF,QAKrC7B,CACT,CAMQ,yBAAMX,CAAoBe,GAChC,IACE,MAAM,mBAAE4B,SAA6B,sCAC/BvC,EAAQ7F,MAAMC,KAAKuG,EAAQX,MAAM3F,UAEvCvC,QAAQC,IAAI,6BAA6BiI,EAAMjH,oBAC/CjB,QAAQC,IAAI,8BAA+BiI,EAAMxH,IAAIkJ,GAAKA,EAAEtG,MAAMoH,KAAK,OAEvE,IAAIC,EAAe,EACfC,EAAY,EAGhB,IAAK,IAAIrB,EAAI,EAAGA,EAAIrB,EAAMjH,OAAQsI,IAAK,CACrC,MAAMf,EAAON,EAAMqB,GACnBvJ,QAAQC,IAAI,iCAAiCsJ,EAAI,KAAKrB,EAAMjH,YAAYuH,EAAKlF,QAE7E,IACE,MAAMuH,QAAgBJ,EAAmBK,gBAAgBtC,GAAM,GAC/DA,EAAKqC,QAAUA,EACfF,IACA3K,QAAQC,IAAI,2BAA2BuI,EAAKlF,cAC9C,CAAE,MAAOhD,GACPsK,IACA5K,QAAQM,MAAM,2BAA2BkI,EAAKlF,eAAgB,CAC5DhD,MAAOA,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,GACvDyK,QAASvC,EAAK7F,IAGlB,CACF,CAEA3C,QAAQC,IAAI,oCAAqC,CAC/C+K,MAAO9C,EAAMjH,OACbsD,QAASoG,EACTM,OAAQL,GAEZ,CAAE,MAAOtK,GACPN,QAAQM,MAAM,kCAAmC,CAC/CA,MAAOA,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,GACvDqH,MAAOrH,aAAiBoE,MAAQpE,EAAMqH,WAAQ9F,GAGlD,CACF,E,qEC1jBK,MAAMqJ,GAAoB,IAAAxJ,aAAY,YAAa,KAExD,MAAMyJ,GAAqB,IAAAvJ,KAAe,CAAEwJ,MAAO,KAC7CC,GAAoB,IAAAzJ,KAAe,CAAEwJ,MAAO,KAOlD,SAASE,EAAeC,GACtBJ,EAAmBhJ,MAAMiJ,MAAMtF,KAAKyF,GACpCvL,QAAQC,IAAI,mCAAmCsL,EAAKjI,OACtD,CAyBA,SAASkI,EAAmBC,GAC1B,MAAMC,EAAQL,EAAkBlJ,MAAMiJ,MAAMO,UAAUJ,GAAQA,EAAK5I,KAAO8I,GAC1E,IAAe,IAAXC,EAAc,CAChB,MAAMH,EAAOF,EAAkBlJ,MAAMiJ,MAAMM,GAC3CL,EAAkBlJ,MAAMiJ,MAAMQ,OAAOF,EAAO,GAC5C1L,QAAQC,IAAI,iCAAiCsL,EAAKjI,OACpD,CACF,CAwDAJ,eAAe2I,IACb,IACE,MAAMjD,EAAO,CACXuC,mBAAoBA,EAAmBhJ,MACvCkJ,kBAAmBA,EAAkBlJ,OAEvCyB,wBAAwB,CAAEkI,UAAWlD,GAAQ,CAAE7H,KAAM,WACrDf,QAAQC,IAAI,4BACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,8BAA+BA,GAC7C6D,OAAO7D,MAAM,WACf,CACF,CAkCA,MAAO,CAEL6K,qBACAE,oBAGAC,iBACAS,cAxIF,SAAuBR,GACrBF,EAAkBlJ,MAAMiJ,MAAMtF,KAAKyF,GACnCvL,QAAQC,IAAI,iCAAiCsL,EAAKjI,OACpD,EAsIE0I,oBAjIF,SAA6BP,GAC3B,MAAMC,EAAQP,EAAmBhJ,MAAMiJ,MAAMO,UAAUJ,GAAQA,EAAK5I,KAAO8I,GAC3E,IAAe,IAAXC,EAAc,CAChB,MAAMH,EAAOJ,EAAmBhJ,MAAMiJ,MAAMM,GAC5CP,EAAmBhJ,MAAMiJ,MAAMQ,OAAOF,EAAO,GAC7C1L,QAAQC,IAAI,mCAAmCsL,EAAKjI,OACtD,CACF,EA2HEkI,qBACAS,uBA3GF,WACE,MAAMC,EAAYb,EAAkBlJ,MAAMiJ,MAAMnK,OAChDoK,EAAkBlJ,MAAMiJ,MAAQ,GAChCpL,QAAQC,IAAI,kCAAkCiM,SAChD,EAwGEC,wBAnGF,WACE,MAAMD,EAAYf,EAAmBhJ,MAAMiJ,MAAMnK,OACjDkK,EAAmBhJ,MAAMiJ,MAAQ,GACjCpL,QAAQC,IAAI,oCAAoCiM,UAChDL,GACF,EA+FEO,oBA1FF,WACE,MAAMC,EAAiBlB,EAAmBhJ,MAAMiJ,MAAMnK,OAChDqL,EAAgBjB,EAAkBlJ,MAAMiJ,MAAMnK,OAC9CsL,EAAaF,EAAiBC,EAEpCnB,EAAmBhJ,MAAMiJ,MAAQ,GACjCC,EAAkBlJ,MAAMiJ,MAAQ,GAEhCpL,QAAQC,IACN,oCAAoCoM,cAA2BC,cAA0BC,UAG3FV,GACF,EA8EEW,oBAzEF,SAA6BC,GAC3BA,EAAQxI,QAAQwH,IACd,MAAMF,EAAOF,EAAkBlJ,MAAMiJ,MAAMsB,KAAKnD,GAAKA,EAAE5G,KAAO8I,GAC1DF,IACFD,EAAeC,GACfC,EAAmBC,MAGvBzL,QAAQC,IAAI,qBAAqBwM,EAAQxL,uBAC3C,EAiEE4K,eACAc,eA5CFzJ,iBACE,IACE,MACM0F,EADYxF,aAAa,CAAErC,KAAM,WAChB+K,UAEnBlD,IACEA,EAAKuC,qBACPA,EAAmBhJ,MAAQyG,EAAKuC,oBAE9BvC,EAAKyC,oBACPA,EAAkBlJ,MAAQyG,EAAKyC,mBAEjCrL,QAAQC,IAAI,6BAEhB,CAAE,MAAOK,GACPN,QAAQM,MAAM,8BAA+BA,EAC/C,CACF,EA4BEoG,MAvBF,WACEyE,EAAmBhJ,MAAQ,CAAEiJ,MAAO,IACpCC,EAAkBlJ,MAAQ,CAAEiJ,MAAO,IACnCpL,QAAQC,IAAI,8BACd,I,gBCjJKiD,eAAe0J,IAKpB,IACE5M,QAAQC,IAAI,kCAGZ,MAAM4M,EAAa,YAEbC,QAAiBxF,SAAS,CAC9BC,WAAYsF,EACZ3F,eAAe,IAKjB,OAFAlH,QAAQC,IAAI,4BAA6B6M,GAErCA,GAAYA,EAAS7L,OAAS,EACzB,CACLsD,SAAS,EACTkD,QAAS,YACToD,QAAS,CACPiC,SAAUA,EAASC,UAAU,EAAG,KAChC9L,OAAQ6L,EAAS7L,SAId,CACLsD,SAAS,EACTkD,QAAS,aAGf,CAAE,MAAOnH,GACPN,QAAQM,MAAM,8BAA+BA,GAE7C,MAAM0M,EAAe1M,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,GAGrE,IAAI2M,EAAY,GAahB,OAXEA,EADED,EAAanH,SAAS,OACZ,yDACHmH,EAAanH,SAAS,OACnB,8BACHmH,EAAanH,SAAS,QAAUmH,EAAanH,SAAS,OACnD,uBACHmH,EAAanH,SAAS,WACnB,gBAEA,uBAGP,CACLtB,SAAS,EACTkD,QAAS,cAAcuF,IACvBnC,QAAS,CACPvK,MAAO0M,EACPC,aAGN,CACF,CAiCO/J,eAAegK,IACpBlN,QAAQC,IAAI,8BAEZ,IAAIkN,EAAS,wBAGbA,GAAU,YACV,MAAMC,EAnCD,WAKL,IAEE,MAAMC,EAAeC,YAAYC,uBAC3BC,EAAUF,YAAYE,QAE5B,MAAO,CACLC,MAAOJ,GAAcK,cAAgBF,GAAW,UAChDG,SAAUN,GAAcO,eAAiB,UACzCC,UAAWC,QAAQT,GAAcU,gBAAkBV,GAAcW,gBAErE,CAAE,MAAO1N,GAEP,OADAN,QAAQM,MAAM,6BAA8BA,GACrC,CACLmN,MAAO,UACPE,SAAU,UACVE,WAAW,EAEf,CACF,CAYiBI,GACfd,GAAU,YAAYC,EAAOK,UAC7BN,GAAU,YAAYC,EAAOO,aAC7BR,GAAU,gBAAgBC,EAAOS,UAAY,MAAQ,YAGrDV,GAAU,YACV,MAAMe,QAAmBtB,IAkBzB,OAjBAO,GAAU,YAAYe,EAAW3J,QAAU,OAAS,WACpD4I,GAAU,YAAYe,EAAWzG,YAE7ByG,EAAWrD,UACTqD,EAAWrD,QAAQoC,YACrBE,GAAU,YAAYe,EAAWrD,QAAQoC,eAEvCiB,EAAWrD,QAAQiC,WACrBK,GAAU,cAAce,EAAWrD,QAAQiC,eAI/CK,GAAU,iBAEVnN,QAAQC,IAAI,yBACZD,QAAQC,IAAIkN,GAELA,CACT,C,yHC9HO,MAAMgB,GAAmB,IAAAzM,aAAY,WAAY,KAEtD,MAAM0M,GAAoB,IAAAxM,KAAmB,MACvCyM,GAAY,IAAAzM,KAAiC,IAAIG,KAGjDuM,GAAkB,IAAApM,UAAS,IAC1BkM,EAAkBjM,OAChBkM,EAAUlM,MAAMS,IAAIwL,EAAkBjM,QADR,MAIjCoM,GAAoB,IAAArM,UAAS,IACQ,WAAlCoM,EAAgBnM,OAAOmE,QAG1BgG,GAAgB,IAAApK,UAAS,IACtBmM,EAAUlM,MAAMM,MAGnB+L,GAAe,IAAAtM,UAAS,IACrBG,MAAMC,KAAK+L,EAAUlM,MAAMI,WAG9BkM,GAAc,IAAAvM,UAAS,KAC3B,IAAKoM,EAAgBnM,MAAO,OAAO,KACnC,MAAMiG,EAAiBkG,EAAgBnM,MAAMzB,IAAI0H,eACjD,OAAOkG,EAAgBnM,MAAMzB,IAAIwH,MAAMtF,IAAIwF,IAAmB,OAG1D8B,GAAiB,IAAAhI,UAAS,IACzBuM,EAAYtM,MACVsM,EAAYtM,MAAM+H,eACtBxJ,IAAIqI,GAAUuF,EAAgBnM,OAAOzB,IAAIwH,MAAMtF,IAAImG,IACnDlG,OAAQ2F,QAA4D3G,IAAT2G,GAH/B,IAsSjCtF,eAAewL,IACb,IACE,MAAM,WAAEjL,SAAqB,sCACvBmF,QAAanF,EAAWC,eAGxBiL,EAAoC,CAAC,EAC3C,IAAK,MAAOhM,EAAIiM,KAAaP,EAAUlM,MAAM6B,UAAW,CAEtD,MAAM,MAAE6K,SAAgB,sCAClBC,EAAgBD,EAAMD,GAGtBG,EAAgC,CAAC,EACvC,IAAK,MAAOhG,EAAQP,KAASoG,EAASlO,IAAIwH,MAAMlE,UAC9C+K,EAAShG,GAAU8F,EAAMrG,GAE3BsG,EAAcpO,IAAIwH,MAAQ6G,EAE1BJ,EAAahM,GAAMmM,CACrB,CAEAlG,EAAKyF,UAAYM,QACXlL,EAAWuL,aAAapG,GAE9B5I,QAAQC,IAAI,8BACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,+BAAgCA,GAC9C6D,OAAO7D,MAAM,WACf,CACF,CAmFA,MAAO,CAEL8N,oBACAC,YAGAC,kBACAC,oBACAjC,gBACAkC,eACAC,cACAvE,iBAGA+E,mBA1ZF,SAA4BC,GAC1Bd,EAAkBjM,MAAQ+M,EAC1BlP,QAAQC,IAAI,4BAA6BiP,EAC3C,EAwZEC,YAnZF,SAAqBP,GACnBP,EAAUlM,MAAM+B,IAAI0K,EAASjM,GAAIiM,GACjC5O,QAAQC,IAAI,2BAA2B2O,EAAStL,SAASsL,EAASjM,MACpE,EAiZEyM,eA5YFlM,eAA8BgM,EAAoBzK,GAChD,MAAMmK,EAAWP,EAAUlM,MAAMS,IAAIsM,GAChCN,GAKL7K,OAAOa,OAAOgK,EAAUnK,GACxB4J,EAAUlM,MAAM+B,IAAIgL,EAAYN,GAChC5O,QAAQC,IAAI,2BAA2BiP,MANrClP,QAAQM,MAAM,2BAA2B4O,IAO7C,EAmYEG,YA9XF,SAAqBH,GACnB,OAAOb,EAAUlM,MAAMS,IAAIsM,IAAe,IAC5C,EA6XEI,gBAxXF,WACE,OAAOjN,MAAMC,KAAK+L,EAAUlM,MAAMI,SACpC,EAuXEgN,eAlXF,SAAwBL,GACtBb,EAAUlM,MAAMmD,OAAO4J,GACnBd,EAAkBjM,QAAU+M,IAC9Bd,EAAkBjM,MAAQ,MAE5BnC,QAAQC,IAAI,2BAA2BiP,IACzC,EA6WEM,mBAxWFtM,eAAkCgM,EAAoBzJ,GACpD,MAAMmJ,EAAWP,EAAUlM,MAAMS,IAAIsM,GACrC,IAAKN,EAEH,YADA5O,QAAQM,MAAM,2BAA2B4O,KAI3C,MAAMO,EAAiBb,EAASjL,WAAW+I,KAAKnC,GAAKA,EAAE9E,cAAgBA,GAClEgK,GAMLA,EAAezM,aAAeyM,EAAezM,YAC7ChD,QAAQC,IAAI,8BAA8BwF,QAAkBgK,EAAezM,gBANzEhD,QAAQM,MAAM,+BAA+BmF,IAOjD,EAyVEiK,2BApVF,SAAoCC,GAClC,OAAOtN,MAAMC,KAAK+L,EAAUlM,MAAMI,UAAUM,OAAO+L,GAAYA,EAASe,eAAiBA,EAC3F,EAmVEC,uBApGF1M,eACEgM,EACA7K,EACArB,GAAuB,GAEvB,MAAM4L,EAAWP,EAAUlM,MAAMS,IAAIsM,GACrC,IAAKN,EAEH,YADA5O,QAAQM,MAAM,2BAA2B4O,KAK5BN,EAASjL,WAAWgG,KAAKY,GAAKA,EAAE9E,cAAgBpB,EAAU1B,IAEvE3C,QAAQK,KAAK,+BAA+BgE,EAAU1B,OAKxDiM,EAASjL,WAAWmC,KAAK,CACvBL,YAAapB,EAAU1B,GACvB0B,YACArB,cACA6M,WAAY7M,EAAc,EAAI,EAC9B8M,gBAAiB,IAGnB9P,QAAQC,IAAI,8BAA8BoE,EAAUf,SAASe,EAAU1B,OACzE,EAyEEmG,qBApEF5F,eAAoC6F,GAClC,IAAKuF,EAAgBnM,MAEnB,YADAnC,QAAQM,MAAM,2BAIhB,MAAMkI,EAAO8F,EAAgBnM,MAAMzB,IAAIwH,MAAMtF,IAAImG,GAC5CP,GAKL8F,EAAgBnM,MAAMzB,IAAI0H,eAAiBW,EAC3C/I,QAAQC,IAAI,6BAA6BuI,EAAKlF,SAL5CtD,QAAQM,MAAM,2BAA2ByI,IAM7C,EAuDEgH,aAlDF7M,eAA4B6F,GAC1B,IAAKuF,EAAgBnM,MAEnB,YADAnC,QAAQM,MAAM,2BAIhB,MAAMkI,EAAO8F,EAAgBnM,MAAMzB,IAAIwH,MAAMtF,IAAImG,GAC5CP,GAKLA,EAAKS,cAAe,EACpBjJ,QAAQC,IAAI,2BAA2BuI,EAAKlF,SAL1CtD,QAAQM,MAAM,2BAA2ByI,IAM7C,EAqCErC,MAhCF,WACE0H,EAAkBjM,MAAQ,KAC1BkM,EAAUlM,MAAM2B,QAChB9D,QAAQC,IAAI,6BACd,EA+BE+P,WApVF9M,eAA0BgM,EAAoBe,GAC5C,MAAMrB,EAAWP,EAAUlM,MAAMS,IAAIsM,GACrC,IAAKN,EAEH,YADA5O,QAAQM,MAAM,2BAA2B4O,KAK5BN,EAASsB,SAASvG,KAAKwG,GAAKA,EAAExN,KAAOsN,EAAQtN,IAE1D3C,QAAQK,KAAK,4BAA4B4P,EAAQtN,OAInDiM,EAASsB,SAASpK,KAAKmK,GACvBjQ,QAAQC,IAAI,4BAA4BgQ,EAAQ3M,SAAS2M,EAAQtN,aAG3D+L,IACR,EAkUE0B,oBA7TFlN,eACEgM,EACAzJ,EACAoK,GAEA,MAAMjB,EAAWP,EAAUlM,MAAMS,IAAIsM,GACrC,IAAKN,EAEH,YADA5O,QAAQM,MAAM,2BAA2B4O,KAI3C,MAAMO,EAAiBb,EAASjL,WAAW+I,KAAKnC,GAAKA,EAAE9E,cAAgBA,GAClEgK,GAKLA,EAAeI,WAAaA,EAC5B7P,QAAQC,IAAI,iCAAiCwF,QAAkBoK,WAGzDnB,KARJ1O,QAAQM,MAAM,+BAA+BmF,IASjD,EAwSE4K,yBAnSFnN,eAAwCgM,EAAoBzJ,EAAqB6K,GAC/E,MAAM1B,EAAWP,EAAUlM,MAAMS,IAAIsM,GACrC,IAAKN,EAEH,YADA5O,QAAQM,MAAM,2BAA2B4O,KAI3C,MAAMO,EAAiBb,EAASjL,WAAW+I,KAAKnC,GAAKA,EAAE9E,cAAgBA,GAClEgK,GAMHA,EAAeK,qBADHjO,IAAVyO,EAC+BA,GAECb,EAAeK,iBAAmB,GAAK,EAG3E9P,QAAQC,IAAI,iCAAiCwF,QAAkBgK,EAAeK,yBAGxEpB,KAbJ1O,QAAQM,MAAM,+BAA+BmF,IAcjD,EA6QE8K,qBAxQFrN,eACEgM,EACA5I,GAEA,MAAMsI,EAAWP,EAAUlM,MAAMS,IAAIsM,GAChCN,GAKLA,EAAStI,OAASA,EAGH,WAAXA,GAAwBsI,EAAS4B,UAEf,cAAXlK,GAA2BsI,EAAS6B,UAC7C7B,EAAS6B,QAAUC,KAAKC,OAFxB/B,EAAS4B,UAAYE,KAAKC,MAK5B3Q,QAAQC,IAAI,6BAA6BiP,QAAiB5I,WAGpDoI,KAhBJ1O,QAAQM,MAAM,2BAA2B4O,IAiB7C,EAkPE0B,SA7OF1N,eAAwBgM,EAAoB1I,GAC1C,MAAMoI,EAAWP,EAAUlM,MAAMS,IAAIsM,GACrC,IAAKN,EAEH,YADA5O,QAAQM,MAAM,2BAA2B4O,KAK5BN,EAASnI,OAAOkD,KAAKI,GAAKA,EAAEpH,KAAO6D,EAAM7D,IAEtD3C,QAAQK,KAAK,2BAA2BmG,EAAM7D,OAIhDiM,EAASnI,OAAOX,KAAKU,GACrBxG,QAAQC,IAAI,2BAA2BuG,EAAMqK,YAAYrK,EAAM7D,aAGzD+L,IACR,EA2NEoC,YArNF5N,eAA2BgM,GACzB,MAAMN,EAAWP,EAAUlM,MAAMS,IAAIsM,GAChCN,GAMLA,EAAStI,OAAS,YAClBsI,EAAS6B,QAAUC,KAAKC,MAGxB/B,EAASjL,WAAa,GAGtBiL,EAASlO,IAAIwH,MAAMpE,QACnB8K,EAASlO,IAAI+H,YAAc,GAC3BmG,EAASlO,IAAI0H,eAAiB,GAC9BwG,EAASlO,IAAIyH,UAAY,GAGzBnI,QAAQC,IAAI,2BAA2BiP,KACvClP,QAAQC,IAAI,uBAAuB2O,EAASnI,OAAOxF,gBACnDjB,QAAQC,IAAI,uBAAuB2O,EAASsB,SAASjP,qBAG/CyN,KAvBJ1O,QAAQM,MAAM,2BAA2B4O,IAwB7C,EA2LE6B,iBApLF7N,eAAgCgM,GAC9B,MAAMN,EAAWP,EAAUlM,MAAMS,IAAIsM,GAChCN,GAMLA,EAAStI,OAAS,YAClBsI,EAAS6B,QAAUC,KAAKC,MAGxB/B,EAASjL,WAAa,GAGtBiL,EAASlO,IAAIwH,MAAMpE,QACnB8K,EAASlO,IAAI+H,YAAc,GAC3BmG,EAASlO,IAAI0H,eAAiB,GAC9BwG,EAASlO,IAAIyH,UAAY,GAIzBnI,QAAQC,IAAI,2BAA2BiP,KACvClP,QAAQC,IAAI,uBAAuB2O,EAASnI,OAAOxF,gBACnDjB,QAAQC,IAAI,uBAAuB2O,EAASsB,SAASjP,qBAG/CyN,KAxBJ1O,QAAQM,MAAM,2BAA2B4O,IAyB7C,EAyJER,c,gECxcG,MAAMsC,EAOX,8BAAOC,CAAwBC,EAAsBC,GACnD,IACEnR,QAAQC,IAAI,sCAGZ,MAAMkD,EAAaC,aAAa,CAAErC,KAAM,WACxCf,QAAQC,IAAI,mCAGZ,MAAMmR,EAAajO,EAAWkO,YAG9B,KAFkBD,IAAeF,GAO/B,OAJAlR,QAAQM,MAAM,4CAA6C,CACzDgR,SAAUJ,EACVK,OAAQH,KAEH,EAGTpR,QAAQC,IAAI,2CAA4CmR,GAGxD,MAAMI,EAAoBrO,EAAWsO,mBAGrC,OAFyBD,IAAsBL,GAY/CnR,QAAQC,IAAI,qDAAsDuR,EAAkBvQ,QAEpFjB,QAAQC,IAAI,sCACL,IAZLD,QAAQM,MAAM,mDAAoD,CAChEgR,SAAU,GAAGH,EAAoBpE,UAAU,EAAG,SAC9CwE,OAAQC,EAAoB,GAAGA,EAAkBzE,UAAU,EAAG,cAAWlL,EACzE6P,eAAgBP,EAAoBlQ,OACpC0Q,aAAcH,GAAmBvQ,UAE5B,EAOX,CAAE,MAAOX,GAKP,OAJAN,QAAQM,MAAM,qCAAsC,CAClDA,MAAQA,EAAgBmH,QACxBE,MAAQrH,EAAgBqH,SAEnB,CACT,CACF,CAQA,0BAAOiK,CAAoBV,EAAsBC,GAC/C,IACEnR,QAAQC,IAAI,qCAEZ,MAAM4R,EAAKvE,YAGX,GAA8B,mBAAnBuE,EAAGC,YAA4B,CACxC,MAAMV,EAAaS,EAAGC,cAGtB,KAFkBV,IAAeF,GAO/B,OAJAlR,QAAQM,MAAM,iDAAkD,CAC9DgR,SAAUJ,EACVK,OAAQH,KAEH,EAGTpR,QAAQC,IAAI,+CAAgDmR,EAC9D,MACEpR,QAAQK,KAAK,uDAKf,GAAwC,mBAA7BwR,EAAGE,sBAAsC,CAClD,MAAMP,EAAoBK,EAAGE,wBAG7B,KAFyBP,IAAsBL,GAS7C,OANAnR,QAAQM,MAAM,2DAA4D,CACxEgR,SAAU,GAAGH,EAAoBpE,UAAU,EAAG,SAC9CwE,OAAQC,EAAoB,GAAGA,EAAkBzE,UAAU,EAAG,cAAWlL,EACzE6P,eAAgBP,EAAoBlQ,OACpC0Q,aAAcH,GAAmBvQ,UAE5B,EAGTjB,QAAQC,IAAI,4DAA6DuR,EAAkBvQ,OAC7F,MACEjB,QAAQK,KAAK,iEAKf,GAAIwR,EAAGG,kBAAmB,CACxB,MAAMZ,EAAaS,EAAGG,kBAAkB1O,KAGxC,KAFkB8N,IAAeF,GAO/B,OAJAlR,QAAQM,MAAM,uDAAwD,CACpEgR,SAAUJ,EACVK,OAAQH,KAEH,EAGTpR,QAAQC,IAAI,sDAAuDmR,GAEnE,MAAMI,EAAoBK,EAAGG,kBAAkBC,oBAG/C,KAFyBT,IAAsBL,GAS7C,OANAnR,QAAQM,MAAM,sEAAuE,CACnFgR,SAAU,GAAGH,EAAoBpE,UAAU,EAAG,SAC9CwE,OAAQC,EAAoB,GAAGA,EAAkBzE,UAAU,EAAG,cAAWlL,EACzE6P,eAAgBP,EAAoBlQ,OACpC0Q,aAAcH,GAAmBvQ,UAE5B,EAGTjB,QAAQC,IACN,wEACAuR,EAAkBvQ,OAEtB,MACEjB,QAAQK,KAAK,mDAUf,MAJ6B,mBAAnBwR,EAAGC,aAA8BD,EAAGC,gBAAkBZ,GACzB,mBAA7BW,EAAGE,uBAAwCF,EAAGE,0BAA4BZ,GACjFU,EAAGG,mBAAqBH,EAAGG,kBAAkB1O,OAAS4N,GAOzDlR,QAAQC,IAAI,qCACL,IALLD,QAAQM,MAAM,2CACP,EAKX,CAAE,MAAOA,GAKP,OAJAN,QAAQM,MAAM,oCAAqC,CACjDA,MAAQA,EAAgBmH,QACxBE,MAAQrH,EAAgBqH,SAEnB,CACT,CACF,CAQA,eAAOuK,CAAShB,EAAsBC,GACpCnR,QAAQC,IAAI,uDACZD,QAAQC,IAAI,kCAAmCiR,GAC/ClR,QAAQC,IAAI,kCAAmCkR,EAAoBlQ,QAEnE,MAAMkR,EAAmB,GACnBtH,EAAU,CACduH,sBAAsB,EACtBC,kBAAkB,EAClBC,WAAW,EACXC,kBAAkB,GAIdC,EAAkBzS,KAAKkR,wBAAwBC,EAAcC,GAGnE,GAFAtG,EAAQuH,qBAAuBI,EAE1BA,EAyBH3H,EAAQyH,WAAY,EACpBzH,EAAQ0H,kBAAmB,MA1BP,CACpBJ,EAAOrM,KAAK,iBAGZ,IACE,MAAM3C,EAAaC,aAAa,CAAErC,KAAM,WAClCqQ,EAAajO,EAAWkO,YACxBG,EAAoBrO,EAAWsO,mBAErC5G,EAAQyH,UAAYlB,IAAeF,EACnCrG,EAAQ0H,iBAAmBf,IAAsBL,EAE5CtG,EAAQyH,WACXH,EAAOrM,KAAK,wBAAwBoL,WAAsBE,MAGvDvG,EAAQ0H,kBACXJ,EAAOrM,KACL,gCAAgCqL,EAAoBlQ,gBAAgBuQ,GAAmBvQ,QAAU,IAGvG,CAAE,MAAOX,GACP6R,EAAOrM,KAAK,aAAcxF,EAAgBmH,UAC5C,CACF,CAMA,MAAM4K,EAAmBtS,KAAK6R,oBAAoBV,EAAcC,GAChEtG,EAAQwH,iBAAmBA,EAEtBA,GACHF,EAAOrM,KAAK,wBAId,MAAMvB,EAAUiO,GAAmBH,EAanC,OAXI9N,EACFvE,QAAQC,IAAI,qCAEZD,QAAQM,MAAM,qCAAsC,CAClD6R,SACAtH,YAIJ7K,QAAQC,IAAI,qDAEL,CACLsE,UACA4N,SACAtH,UAEJ,EC4NK,MAAM4H,EAAuB,IA3cpC,MACU9S,aAAc,EAGd+S,iBAAqC,CAC3CC,SAAS,EACTC,YAAa,KACbC,mBAAoB,MAIdC,gBAAmC,CAAC,EAM5C,wBAAMC,GACJ,IACE/S,QAAQC,IAAI,qDAGZ,MAAM+S,EAAa1F,YAAY2F,KAAKhS,OACpCjB,QAAQC,IAAI,kDAAmD+S,GAG/D,IAAIE,EAAkB,GACtB,IACEA,EAAWC,gBAAgB,uBAC3BnT,QAAQC,IAAI,gDAAiDiT,EAASjS,OACxE,CAAE,MAAOX,GACPN,QAAQC,IAAI,uDAAwDK,EACtE,CAGA,MAAM8S,EAA6B,IAAfJ,GAAwC,IAApBE,EAASjS,OAGjD,GAFAjB,QAAQC,IAAI,mCAAoCmT,IAE3CA,EAEH,OADApT,QAAQC,IAAI,2CACL,EAIT,MAAMoT,GAAiB,SAIvB,OAHArT,QAAQC,IAAI,mDAAoDoT,EAAepR,WAC/EjC,QAAQC,IAAI,gDAAiDoT,EAAe1R,QAExE0R,EAAepR,WACjBjC,QAAQC,IAAI,2CACL,IAITD,QAAQC,IAAI,2CAA4CF,KAAKJ,aACzDI,KAAKJ,aACPK,QAAQC,IAAI,wCACL,IAGTD,QAAQC,IAAI,iDACZF,KAAKJ,aAAc,EAInBK,QAAQC,IAAI,kEACZqT,UAAU,qCACVtT,QAAQC,IAAI,iCAEL,GACT,CAAE,MAAOK,GAEP,OADAN,QAAQM,MAAM,oCAAqCA,IAC5C,CACT,CACF,CAKA,uBAAMiT,GACJ,IACEvT,QAAQC,IAAI,0CAEZ,MACMoE,GADiB,SACU1C,OAEjC,IAAK0C,EAEH,YADArE,QAAQK,KAAK,sCAIfL,QAAQC,IAAI,+BAAgCoE,EAAUf,MAEtD,MAAM2G,EAAclK,KAAKyT,2BAA2BnP,GACpDrE,QAAQC,IAAI,oCAAqCgK,EAAYhJ,QAG7D2C,wBACE,CACEyN,YAAahN,EAAUf,KACvBmO,mBAAoBxH,GAEtB,CAAElJ,KAAM,WAIVhB,KAAK0T,iBAAiBpP,EAAUf,KAAM2G,GAGtCjK,QAAQC,IAAI,kCAAmCF,KAAK2S,kBAEpD1S,QAAQC,IAAI,2CACZkE,OAAOI,QAAQ,YACjB,CAAE,MAAOjE,GACPN,QAAQM,MAAM,uCAAwCA,GACtD6D,OAAO7D,MAAM,aAAgBA,EAAgBmH,QAC/C,CACF,CAMA,gBAAAiM,GACE,IACE1T,QAAQC,IAAI,wDACZD,QAAQC,IAAI,kCAAmCF,KAAK2S,kBAEpD,MAAMb,EAAKvE,YAmBX,GAhBIvN,KAAK+S,gBAAgBhB,aACvBD,EAAGC,YAAc/R,KAAK+S,gBAAgBhB,YACtC9R,QAAQC,IAAI,kDAEZD,QAAQC,IAAI,sDAIVF,KAAK+S,gBAAgBf,uBACvBF,EAAGE,sBAAwBhS,KAAK+S,gBAAgBf,sBAChD/R,QAAQC,IAAI,4DAEZD,QAAQC,IAAI,gEAIV4R,EAAGG,kBAAmB,CACxB,WAESH,EAAGG,kBAAkB1O,KAC5BtD,QAAQC,IAAI,0DACd,CAAE,MAAOK,GACPN,QAAQK,KAAK,4DAA6DC,EAC5E,CAEA,WACSuR,EAAGG,kBAAkBC,oBAC5BjS,QAAQC,IAAI,yEACd,CAAE,MAAOK,GACPN,QAAQK,KAAK,2EAA4EC,EAC3F,CACF,CAGAP,KAAK2S,iBAAmB,CACtBC,SAAS,EACTC,YAAa,KACbC,mBAAoB,MAGtB7S,QAAQC,IAAI,uCACZD,QAAQC,IAAI,kCAAmCF,KAAK2S,kBACpD1S,QAAQC,IAAI,uDACd,CAAE,MAAOK,GAMP,MALAN,QAAQM,MAAM,oCAAqC,CACjDA,MAAQA,EAAgBmH,QACxBE,MAAQrH,EAAgBqH,MACxBgM,aAAc5T,KAAK2S,mBAEfpS,CACR,CACF,CAMQ,gBAAAmT,CAAiBG,EAAoBC,GAC3C,IACE7T,QAAQC,IAAI,wDACZD,QAAQC,IAAI,+BAAgC2T,GAC5C5T,QAAQC,IAAI,+BAAgC4T,EAAkB5S,QAE9D,MAAM4Q,EAAKvE,YAmCX,GAhCKvN,KAAK+S,gBAAgBhB,aAAyC,mBAAnBD,EAAGC,cACjD/R,KAAK+S,gBAAgBhB,YAAcD,EAAGC,YACtC9R,QAAQC,IAAI,kDAGTF,KAAK+S,gBAAgBf,uBAA6D,mBAA7BF,EAAGE,wBAC3DhS,KAAK+S,gBAAgBf,sBAAwBF,EAAGE,sBAChD/R,QAAQC,IAAI,4DAIgB,mBAAnB4R,EAAGC,cACZD,EAAGC,YAAc,WAEf,OADA9R,QAAQC,IAAI,kDAAmD2T,GACxDA,CACT,EACA5T,QAAQC,IAAI,6CAI0B,mBAA7B4R,EAAGE,wBACZF,EAAGE,sBAAwB,WAKzB,OAJA/R,QAAQC,IACN,+DACA4T,EAAkB5S,QAEb4S,CACT,EACA7T,QAAQC,IAAI,uDAIV4R,EAAGG,kBAAmB,CACxB,MAAM8B,EAAYjC,EAAGG,kBAGrBjO,OAAOgQ,eAAeD,EAAW,OAAQ,CACvClR,IAAK,WAEH,OADA5C,QAAQC,IAAI,6DAA8D2T,GACnEA,CACT,EACA1P,IAAK,WACHlE,QAAQC,IAAI,yDACd,EACA+T,cAAc,IAGhBjQ,OAAOgQ,eAAeD,EAAW,sBAAuB,CACtDlR,IAAK,WAKH,OAJA5C,QAAQC,IACN,+EACA4T,EAAkB5S,QAEb4S,CACT,EACA3P,IAAK,WACHlE,QAAQC,IAAI,wEACd,EACA+T,cAAc,IAGhBhU,QAAQC,IAAI,mDACd,CAGAF,KAAK2S,iBAAmB,CACtBC,SAAS,EACTC,YAAagB,EACbf,mBAAoBgB,GAGtB7T,QAAQC,IAAI,0CACZD,QAAQC,IAAI,gCAAiCF,KAAK2S,kBAClD1S,QAAQC,IAAI,uDACd,CAAE,MAAOK,GAOP,MANAN,QAAQM,MAAM,oCAAqC,CACjDA,MAAQA,EAAgBmH,QACxBE,MAAQrH,EAAgBqH,MACxBiM,aACAK,kBAAmBJ,EAAkB5S,SAEjCX,CACR,CACF,CAQA,2BAAM4T,CAAsBhD,EAAsBC,GAChD,IACEnR,QAAQC,IAAI,yDAGZ,MAAM2H,EAASoJ,EAAqBkB,SAAShB,EAAcC,GAE3D,OAAKvJ,EAAOrD,SAeZvE,QAAQC,IAAI,uCACZD,QAAQC,IAAI,+BAAgC2H,EAAOiD,SACnD7K,QAAQC,IAAI,yDAEL,IAjBLD,QAAQM,MAAM,qCAAsC,CAClD6R,OAAQvK,EAAOuK,OACftH,QAASjD,EAAOiD,UAIlB1G,OAAOkE,QAAQ,YAAYT,EAAOuK,OAAOzH,KAAK,OAAQ,OAAQ,CAAEyJ,QAAS,MAEzEnU,QAAQC,IAAI,yDACL,EASX,CAAE,MAAOK,GAOP,OANAN,QAAQM,MAAM,qCAAsC,CAClDA,MAAQA,EAAgBmH,QACxBE,MAAQrH,EAAgBqH,QAG1BxD,OAAO7D,MAAM,eAAgB,SACtB,CACT,CACF,CAKQ,0BAAAkT,CAA2BnP,GACjC,MAAM+P,EAAkB,GAGxBA,EAAMtO,KAAK,MAAMzB,EAAUf,QACvBe,EAAUyC,KACZsN,EAAMtO,KAAK,MAAMzB,EAAUyC,OAEzBzC,EAAU0C,YACZqN,EAAMtO,KAAK,MAAMzB,EAAU0C,cAEzB1C,EAAU2C,YACZoN,EAAMtO,KAAK,MAAMzB,EAAU2C,cAI7BoN,EAAMtO,KAAK,IACXsO,EAAMtO,KAAK,OACX,MAAMnB,EAAaN,EAAUM,WAC7ByP,EAAMtO,KAAK,eAAenB,EAAW0P,OACrCD,EAAMtO,KAAK,eAAenB,EAAW2P,OACrCF,EAAMtO,KAAK,eAAenB,EAAW4P,OACrCH,EAAMtO,KAAK,eAAenB,EAAW6P,OACrCJ,EAAMtO,KAAK,eAAenB,EAAW8P,OACrCL,EAAMtO,KAAK,eAAenB,EAAW+P,OACrCN,EAAMtO,KAAK,eAAenB,EAAWgQ,OACrCP,EAAMtO,KAAK,eAAenB,EAAWiQ,OACrCR,EAAMtO,KAAK,eAAenB,EAAWkQ,OAGrCT,EAAMtO,KAAK,IACXsO,EAAMtO,KAAK,SACX,MAAMgP,EAAUzQ,EAAUQ,aAiB1B,OAhBAuP,EAAMtO,KAAK,eAAegP,EAAQC,MAAMD,EAAQE,SAChDZ,EAAMtO,KAAK,eAAegP,EAAQG,MAAMH,EAAQI,SAChDd,EAAMtO,KAAK,gBAAgBgP,EAAQK,OAAOL,EAAQM,UAClDhB,EAAMtO,KAAK,gBAAgBgP,EAAQO,OACnCjB,EAAMtO,KAAK,gBAAgBgP,EAAQQ,MACnClB,EAAMtO,KAAK,iBAAiBgP,EAAQS,SAGhClR,EAAUmR,QAAUnR,EAAUmR,OAAO/S,KAAO,IAC9C2R,EAAMtO,KAAK,IACXsO,EAAMtO,KAAK,OACXzB,EAAUmR,OAAOvR,QAAQ,CAAC9B,EAAOmB,KAC/B8Q,EAAMtO,KAAK,KAAKxC,MAASnB,QAItBiS,EAAM1J,KAAK,KACpB,CAMA,wBAAM+K,CAAmBpR,GACvB,IACErE,QAAQC,IAAI,2DAGZD,QAAQC,IAAI,qDACNF,KAAKwT,oBACXvT,QAAQC,IAAI,qCAGZD,QAAQC,IAAI,+CACZ,IAEE,MAAM,iBAAEyV,SAA2B,4CAC7BA,EAAiBC,wBACvB3V,QAAQC,IAAI,0CACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,wCAAyCA,GACvD6D,OAAOkE,QAAQ,qBAEjB,CAGArI,QAAQC,IAAI,8CACZ,MAAM,oBAAE0G,SAA8B,qCAItC,SADqBA,EAAoBuC,SAavClJ,QAAQC,IAAI,6CAZD,CACXD,QAAQC,IAAI,wCACZ,UACQ0G,EAAoBC,YAAYvC,GACtCrE,QAAQC,IAAI,uCACZkE,OAAOI,QAAQ,YACjB,CAAE,MAAOjE,GACPN,QAAQM,MAAM,uCAAwCA,GACtD6D,OAAO7D,MAAM,0BAEf,CACF,CAKAN,QAAQC,IAAI,4CACZ,MAAMgK,EAAclK,KAAKyT,2BAA2BnP,SACnBtE,KAAKmU,sBAAsB7P,EAAUf,KAAM2G,GAM1EjK,QAAQC,IAAI,qCAFZD,QAAQK,KAAK,4CAKfL,QAAQC,IAAI,yDACd,CAAE,MAAOK,GAGP,MAFAN,QAAQM,MAAM,sCAAuCA,GACrD6D,OAAO7D,MAAM,aACPA,CACR,CACF,CAMA,KAAAoG,GACE3G,KAAKJ,aAAc,EACnBK,QAAQC,IAAI,kCACd,E,kDCxRK,MAAMwK,EAAqB,IAxMlC,MAOE,qBAAMK,CAAgBtC,EAAYoN,GAAuB,GAGvD,aAAaC,eAAe,YAAa3S,UACvC,IACElD,QAAQC,IAAI,oCAAoCuI,EAAKlF,QACrDa,OAAOoB,KAAK,iBAGZ,MAAM3E,EAAYgV,EAAc,OAAS,OACnC/O,EAAS,6DAGhB2B,EAAKlF,gBACHkF,EAAKyB,uBACLrJ,aACA4H,EAAK2B,YAAc,IAAM,2NAS3ByL,EAAc,gBAAkB,4KAOxBlF,KAAKC,yFAILD,KAAKC,uFAMZnI,EAAKlF,cAIL,IAAI2D,EACJ,IACEA,QAAa6O,YAAY,CACvBC,gBAAiB,CAAC,CAAEC,KAAM,OAAQC,QAASpP,MAE7C7G,QAAQC,IAAI,uCACd,CAAE,MAAOuH,GASP,OARAxH,QAAQM,MAAM,iCAAkC,CAC9CA,MAAOkH,aAAoB9C,MAAQ8C,EAASC,QAAUC,OAAOF,GAC7DG,MAAOH,aAAoB9C,MAAQ8C,EAASG,WAAQ9F,IAItD7B,QAAQC,IAAI,0CACZkE,OAAOkE,QAAQ,GAAGG,EAAKlF,0BAChBvD,KAAKmW,uBAAuB1N,EAAMoN,EAC3C,CAEA,MAAMhO,QAAe7H,KAAKoW,qBAAqBlP,GAE/C,OADA9C,OAAOI,QAAQ,eACRqD,CACT,CAAE,MAAOtH,GAGP,OAFAN,QAAQM,MAAM,mCAAoCA,GAClD6D,OAAOkE,QAAQ,YACRtI,KAAKmW,uBAAuB1N,EAAMoN,EAC3C,GAEJ,CAKQ,0BAAMO,CAAqBlP,GACjC,MAAMkC,YAAc,4CAAgBC,QAEpCpJ,QAAQC,IAAI,kCAGZ,MAAMoJ,EAAW,CACf,CAAEC,MAAO,2BAA4BhG,KAAM,WAC3C,CAAEgG,MAAO,0BAA2BhG,KAAM,UAC1C,CAAEgG,MAAO,uBAAwBhG,KAAM,QAGzC,IAAK,MAAM,MAAEgG,EAAK,KAAEhG,KAAU+F,EAAU,CACtC,MAAMG,EAAQvC,EAAKuC,MAAMF,GACzB,GAAIE,EAAO,CACTxJ,QAAQC,IAAI,+BAA+BqD,MAC3C,IACE,MAAMsF,EAAOO,KAAKM,MAAMD,EAAM,IAC9B,GAAIzJ,KAAKqW,gBAAgBxN,GAEvB,OADA5I,QAAQC,IAAI,6BACLF,KAAKsW,aAAazN,EAE7B,CAAE,MAAOmB,GACP/J,QAAQK,KAAK,kCAAmC0J,EAClD,CACF,CACF,CAGA,IACE,MAAMnB,EAAOO,KAAKM,MAAMxC,GACxB,GAAIlH,KAAKqW,gBAAgBxN,GAEvB,OADA5I,QAAQC,IAAI,+BACLF,KAAKsW,aAAazN,EAE7B,CAAE,MAAOmB,GACP/J,QAAQK,KAAK,+BAAgC0J,EAC/C,CAEA,MAAM,IAAIrF,MAAM,WAClB,CAKQ,eAAA0R,CAAgBxN,GACtB,OACEA,GACgB,iBAATA,GACqB,iBAArBA,EAAK0N,aACe,iBAApB1N,EAAK2N,YACZlU,MAAM2H,QAAQpB,EAAKwC,MAEvB,CAKQ,YAAAiL,CAAazN,GACnB,MAAO,CACL0N,YAAa1N,EAAK0N,YAClBC,WAAY3N,EAAK2N,WACjBnL,MAAOxC,EAAKwC,MAAM1K,IAAK6K,IAAc,CACnC5I,GAAI4I,EAAK5I,IAAM,QAAQ+N,KAAKC,SAASzK,KAAKsQ,SAASC,SAAS,IAAIC,OAAO,EAAG,KAC1EpT,KAAMiI,EAAKjI,KACX2G,YAAasB,EAAKtB,YAClBlJ,KAAMwK,EAAKxK,QAGjB,CAKQ,sBAAAmV,CAAuB1N,EAAYoN,GACzC5V,QAAQC,IAAI,iCAEZ,MAAM0W,EAAuBf,EACzB,CACE,CACEjT,GAAI,QAAQ+N,KAAKC,UACjBrN,KAAM,MACN2G,YAAa,kBACblJ,KAAM,OAER,CACE4B,GAAI,QAAQ+N,KAAKC,UACjBrN,KAAM,KACN2G,YAAa,eACblJ,KAAM,OAGV,CACE,CACE4B,GAAI,QAAQ+N,KAAKC,UACjBrN,KAAM,OACN2G,YAAa,kBACblJ,KAAM,OAER,CACE4B,GAAI,QAAQ+N,KAAKC,UACjBrN,KAAM,OACN2G,YAAa,aACblJ,KAAM,OAId,MAAO,CACLuV,YAAa,GAAG9N,EAAKyB,oBAAoBzB,EAAK2B,YAAc,SAAW,UACvEoM,WAAY/N,EAAK2B,YAAc,YAAc,YAC7CiB,MAAOuL,EAEX,E,+DCvMK,MAAMC,EAAuB,EAAAC,EAAEC,OAAO,CAC3CzC,IAAK,EAAAwC,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAAKiD,QAAQ,IACxCkL,IAAK,EAAAuC,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAAKiD,QAAQ,IACxCmL,IAAK,EAAAsC,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAAKiD,QAAQ,IACxCoL,IAAK,EAAAqC,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAAKiD,QAAQ,IACxCqL,IAAK,EAAAoC,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAAKiD,QAAQ,IACxCsL,IAAK,EAAAmC,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAAKiD,QAAQ,IACxCuL,IAAK,EAAAkC,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAAKiD,QAAQ,IACxCwL,IAAK,EAAAiC,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAAKiD,QAAQ,IACxCyL,IAAK,EAAAgC,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAAKiD,QAAQ,MAM7B4N,EAAqB,EAAAH,EAAEC,OAAO,CACzC/B,GAAI,EAAA8B,EAAEE,SAAS3Q,IAAI,GACnB4O,MAAO,EAAA6B,EAAEE,SAAS3Q,IAAI,GACtB6O,GAAI,EAAA4B,EAAEE,SAAS3Q,IAAI,GACnB8O,MAAO,EAAA2B,EAAEE,SAAS3Q,IAAI,GACtB+O,IAAK,EAAA0B,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,IAC3BiP,OAAQ,EAAAyB,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,IAC9BkP,IAAK,EAAAwB,EAAEE,SAAS3Q,IAAI,GACpBkP,GAAI,EAAAuB,EAAEI,SACN1B,MAAO,EAAAsB,EAAEE,WAMEG,EAAuB,EAAAL,EAAEC,OAAO,CAC3C/V,KAAM,EAAA8V,EAAEI,SACR9U,MAAO,EAAA0U,EAAEE,SACT9M,YAAa,EAAA4M,EAAEI,SAASE,aAGbC,EAAuC,EAAAP,EAAEQ,KAAK,IACzD,EAAAR,EAAEC,OAAO,CACPnU,GAAI,EAAAkU,EAAEI,SACN3T,KAAM,EAAAuT,EAAEI,SACRK,OAAQ,EAAAT,EAAEI,SAASE,WACnBI,OAAQ,EAAAV,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAAKiD,QAAQ,GAC3CoO,QAAS,EAAAX,EAAEY,MAAMP,GAAsB9N,QAAQ,IAC/CsO,SAAU,EAAAb,EAAEY,MAAML,GAAsBD,cAc/BQ,GAPc,EAAAd,EAAEC,OAAO,CAClCxT,KAAM,EAAAuT,EAAEI,SACR9U,MAAO,EAAA0U,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAC7ByR,eAAgB,EAAAf,EAAEgB,UAAUV,aAIJ,EAAAN,EAAEC,OAAO,CACjCnU,GAAI,EAAAkU,EAAEI,SACN3T,KAAM,EAAAuT,EAAEI,SACRhN,YAAa,EAAA4M,EAAEI,SACfa,SAAU,EAAAjB,EAAEE,SAAS3Q,IAAI,GAAGgD,QAAQ,GACpCrI,KAAM,EAAA8V,EAAEI,SAASE,cAMNY,EAAsB,EAAAlB,EAAEC,OAAO,CAC1CnU,GAAI,EAAAkU,EAAEI,SACN3T,KAAM,EAAAuT,EAAEI,SACRnQ,IAAK,EAAA+P,EAAEE,SAASI,WAChBpQ,WAAY,EAAA8P,EAAEI,SAASE,WACvBnQ,WAAY,EAAA6P,EAAEI,SAASE,WACvBxS,WAAYiS,EACZ/R,aAAcmS,EACdxB,OAAQ,EAAAqB,EAAEmB,OAAO,EAAAnB,EAAEI,SAAU,EAAAJ,EAAEE,UAAUkB,UAAUC,GAAO,IAAInW,IAAIgC,OAAOC,QAAQkU,KACjFpT,UAAW,EAAA+R,EAAEY,MAAML,GAAsBhO,QAAQ,IACjD0C,UAAW,EAAA+K,EAAEY,MAAME,GAAYvO,QAAQ,IACvC+O,SAAU,EAAAtB,EAAEI,SAASE,aAGViB,EAAwBL,EAAoBM,OAAO,CAC9DtX,KAAM,EAAA8V,EAAEyB,QAAQ,YAGLC,EAAqBR,EAAoBM,OAAO,CAC3DtX,KAAM,EAAA8V,EAAEyB,QAAQ,OAChBnT,UAAW,EAAA0R,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAAKiD,QAAQ,IAC9CpG,YAAa,EAAA6T,EAAEgB,UAAUzO,SAAQ,GACjC3C,OAAQ,EAAAoQ,EAAEY,MAAM,EAAAZ,EAAEI,UAAU7N,QAAQ,IACpCoP,aAAc,EAAA3B,EAAEI,SAASE,aAGdsB,EAAkB,EAAA5B,EAAE6B,MAAM,CAACN,EAAuBG,IAKlDI,EAAmB,EAAA9B,EAAEC,OAAO,CACvCrR,YAAa,EAAAoR,EAAEI,SACf2B,IAAK,EAAA/B,EAAEI,SACP4B,SAAU,EAAAhC,EAAEiC,KAAK,CAAC,OAAQ,SAAU,QAAS,WAC7CzZ,EAAG,EAAAwX,EAAEE,SAASI,WACd/X,EAAG,EAAAyX,EAAEE,SAASI,WACd4B,MAAO,EAAAlC,EAAEE,SAAS3N,QAAQ,GAC1B4P,QAAS,EAAAnC,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,GAAGiD,QAAQ,KAM/B6P,EAAa,EAAApC,EAAEC,OAAO,CACjCnU,GAAI,EAAAkU,EAAEI,SACN3T,KAAM,EAAAuT,EAAEI,SACRhN,YAAa,EAAA4M,EAAEI,SACfjQ,WAAY,EAAA6P,EAAEI,SAASE,WACvBjN,eAAgB,EAAA2M,EAAEY,MAAM,EAAAZ,EAAEI,UAAU7N,QAAQ,IAC5C3C,OAAQ,EAAAoQ,EAAEY,MAAM,EAAAZ,EAAEI,UAAUE,WAC5BlO,aAAc,EAAA4N,EAAEgB,UAAUzO,SAAQ,GAClCe,YAAa,EAAA0M,EAAEgB,UAAUV,aAKd+B,EAAmB,EAAArC,EAAEC,OAAO,CACvCxU,KAAM,EAAAuU,EAAEI,SACRzM,GAAI,EAAAqM,EAAEI,SACNkC,SAAU,EAAAtC,EAAEgB,UAAUV,WACtBiC,YAAa,EAAAvC,EAAEI,SAASE,aAGbkC,EAAgB,EAAAxC,EAAEC,OAAO,CACpC5O,MAAO,EAAA2O,EAAEmB,OAAO,EAAAnB,EAAEI,SAAUgC,GAAYhB,UAAUC,GAAO,IAAInW,IAAIgC,OAAOC,QAAQkU,KAChFzP,YAAa,EAAAoO,EAAEY,MAAMyB,GAAkB9P,QAAQ,IAC/ChB,eAAgB,EAAAyO,EAAEI,SAClB9O,UAAW,EAAA0O,EAAEI,WAMFqC,EAA4B,EAAAzC,EAAEC,OAAO,CAChDrR,YAAa,EAAAoR,EAAEI,SACf5S,UAAWoU,EACXzV,YAAa,EAAA6T,EAAEgB,UAAUzO,SAAQ,GACjCmQ,gBAAiB,EAAA1C,EAAEI,SAASE,WAC5BqC,SAAU,EAAA3C,EAAEI,SAASE,aAGVsC,EAAuB,EAAA5C,EAAEC,OAAO,CAC3CnU,GAAI,EAAAkU,EAAEI,SACNpG,QAAS,EAAAgG,EAAEI,SACXyC,UAAW,EAAA7C,EAAEE,SACb4C,SAAU,EAAA9C,EAAEI,SAASE,WACrByC,mBAAoB,EAAA/C,EAAEY,MAAM,EAAAZ,EAAEI,UAAU7N,QAAQ,IAChDyQ,aAAc,EAAAhD,EAAEI,SAASE,aAKd2C,EAAuB,EAAAjD,EAAEC,OAAO,CAC3CnU,GAAI,EAAAkU,EAAEI,SACN3T,KAAM,EAAAuT,EAAEI,SACRlW,KAAM,EAAA8V,EAAEI,SACR8C,WAAY,EAAAlD,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,GAClCwJ,aAAc,EAAAkH,EAAEI,SAChBvW,IAAK2Y,EACL1V,WAAY,EAAAkT,EAAEY,MAAM6B,GAA2BlQ,QAAQ,IACvD3C,OAAQ,EAAAoQ,EAAEY,MAAMgC,GAAsBrQ,QAAQ,IAC9CoH,UAAW,EAAAqG,EAAEE,SACbtG,QAAS,EAAAoG,EAAEE,SAASI,WACpB6C,OAAQ,EAAAnD,EAAEI,SAASE,WACnB8C,SAAU,EAAApD,EAAEgB,UAAUzO,SAAQ,GAC9B8Q,aAAc,EAAArD,EAAEI,SAASE,aAMdgD,EAAmB,EAAAtD,EAAEiC,KAAK,CACrC,mBACA,kBACA,eACA,UACA,UACA,qBAGWsB,EAAiB,EAAAvD,EAAEC,OAAO,CACrCuD,KAAM,EAAAxD,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAC5BmU,MAAO,EAAAzD,EAAEE,SAAS3Q,IAAI,GAAGD,IAAI,KAC7ByB,OAAQuS,EACRI,UAAW,EAAA1D,EAAEI,SAASE,WACtBuC,UAAW,EAAA7C,EAAEE,WAKFyD,EAAqB,EAAA3D,EAAEC,OAAO,CACzCnU,GAAI,EAAAkU,EAAEI,SACN3T,KAAM,EAAAuT,EAAEI,SACRlW,KAAM,EAAA8V,EAAEiC,KAAK,CAAC,OAAQ,WACtB7O,YAAa,EAAA4M,EAAEI,SACfwD,SAAU,EAAA5D,EAAEE,SACZ2D,OAAQ,EAAA7D,EAAEC,OAAO,CACf6D,UAAW,EAAA9D,EAAEI,SAASE,WACtByD,SAAU,EAAA/D,EAAEE,SAASI,WACrB0D,eAAgB,EAAAhE,EAAEE,SAASI,eAIlB2D,EAAc,EAAAjE,EAAEC,OAAO,CAClCnU,GAAI,EAAAkU,EAAEI,SACN3T,KAAM,EAAAuT,EAAEI,SACRhN,YAAa,EAAA4M,EAAEI,SAASE,WACxBxS,WAAYiS,EACZ/R,aAAcmS,EACdxB,OAAQ,EAAAqB,EAAEmB,OAAO,EAAAnB,EAAEI,SAAU,EAAAJ,EAAEE,UAAUkB,UAAUC,GAAO,IAAInW,IAAIgC,OAAOC,QAAQkU,KACjFpT,UAAW,EAAA+R,EAAEY,MAAML,GAAsBhO,QAAQ,IACjD+O,SAAU,EAAAtB,EAAEI,SAASE,WACrB4D,cAAe,EAAAlE,EAAEI,SAASE,WAC1B6D,KAAM,EAAAnE,EAAEY,MAAME,GAAYR,aAKf8D,EAAqB,EAAApE,EAAEC,OAAO,CACzC/V,KAAM,EAAA8V,EAAEiC,KAAK,CAAC,SAAU,QAAS,SAAU,YAC3CoC,QAAS,EAAArE,EAAEI,SACXkE,SAAU,EAAAtE,EAAEI,SAASE,WACrBiE,WAAY,EAAAvE,EAAEiC,KAAK,CAAC,QAAS,SAAU,QAAS,YAAY3B,WAC5DkE,UAAW,EAAAxE,EAAEI,SAASE,WACtBkD,KAAMD,EAAejD,WACrBI,OAAQ,EAAAV,EAAEE,SAASI,WACnBmE,YAAa,EAAAzE,EAAEI,SAASE,WACxBlN,YAAa,EAAA4M,EAAEI,SAASE,aAGboE,EAAoB,EAAA1E,EAAEC,OAAO,CACxC0E,YAAa,EAAA3E,EAAEE,SACf0E,QAAS,EAAA5E,EAAEY,MAAMwD,GAAoB7R,QAAQ,IAC7CsQ,UAAW,EAAA7C,EAAEE,WAGF2E,EAA0B,EAAA7E,EAAEC,OAAO,CAC9CnU,GAAI,EAAAkU,EAAEI,SACN5S,UAAWoU,EAAgBtB,WAC3BwE,MAAOb,EAAY3D,WACnByE,SAAU,EAAA/E,EAAEgB,UACZgE,UAAW,EAAAhF,EAAEE,SACb+E,UAAW,EAAAjF,EAAEE,SACbgF,WAAY,EAAAlF,EAAEE,SACdiF,cAAe,EAAAnF,EAAEY,MAAM+C,GAAoBpR,QAAQ,IACnD6S,WAAY,EAAApF,EAAEE,WAiBHmF,GAdoB,EAAArF,EAAEC,OAAO,CACxCnU,GAAI,EAAAkU,EAAEI,SACNkF,aAAc,EAAAtF,EAAEY,MAAMiE,GACtBU,aAAc,EAAAvF,EAAEE,SAAS3N,QAAQ,GACjCiT,YAAa,EAAAxF,EAAEE,SAAS3N,QAAQ,GAChC9C,OAAQ,EAAAuQ,EAAEiC,KAAK,CAAC,SAAU,UAAW,SAAU,YAC/CwD,OAAQ,EAAAzF,EAAEY,MAAM8D,GAAmBnS,QAAQ,IAC3CoH,UAAW,EAAAqG,EAAEE,SACbT,YAAa,EAAAO,EAAEI,SAASE,aAMQ,EAAAN,EAAEC,OAAO,CACzCyF,QAAS,EAAA1F,EAAEI,SACXhB,QAAS,EAAAY,EAAEI,SACXyC,UAAW,EAAA7C,EAAEE,SACbtR,YAAa,EAAAoR,EAAEI,SAASE,cAgBbqF,GAVkB,EAAA3F,EAAEC,OAAO,CACtC9P,WAAY,EAAA6P,EAAEI,SACdwF,QAAS,EAAA5F,EAAEY,MAAMkB,GAAkBvP,QAAQ,IAC3CL,OAAQ,EAAA8N,EAAEI,SAASE,WACnBlN,YAAa,EAAA4M,EAAEI,SAASE,aAMO,EAAAN,EAC9BC,OAAO,CACN4F,KAAM,EAAA7F,EACHC,OAAO,CACN1I,kBAAmB,EAAAyI,EAAEI,SAASE,WAC9B1I,YAAa,EAAAoI,EAAEI,SAASE,WACxBwF,KAAM,EAAA9F,EAAEiC,KAAK,CAAC,OAAQ,SAAU,YAAa,aAAa1P,QAAQ,UAEnEA,QAAQ,KAAM,CAAGuT,KAAM,UAC1BhZ,WAAY,EAAAkT,EACTC,OAAO,CACNnV,OAAQyW,EAAsBjB,WAC9BrV,KAAM,EAAA+U,EAAEmB,OAAO,EAAAnB,EAAEI,SAAUsB,GAAoBnP,QAAQ,CAAC,KAEzDA,QAAQ,KAAM,CAAGtH,KAAM,CAAC,KAC3BuM,UAAW,EAAAwI,EAAEmB,OAAO,EAAAnB,EAAEI,SAAU6C,GAAsB1Q,QAAQ,CAAC,GAC/DwT,YAAa,EAAA/F,EACVC,OAAO,CACN+F,UAAW,EAAAhG,EAAEY,MAAMyE,GAAoB9S,QAAQ,MAEhDA,QAAQ,KAAM,CAAGyT,UAAW,QAEhCzT,QAAQ,KAAM,CACbsT,KAAM,CAAEC,KAAM,QACdhZ,WAAY,CAAE7B,KAAM,CAAC,GACrBuM,UAAW,CAAC,EACZuO,YAAa,CAAEC,UAAW,QC0DvB,MAAMpZ,EAAa,IAlX1B,MACU9D,aAAc,EAMtB,gBAAMG,GACJ,GAAIC,KAAKJ,YAEP,YADAK,QAAQC,IAAI,+BAIdD,QAAQC,IAAI,iCACZ,MAAMuQ,EAAYE,KAAKC,MAEvB,IACE3Q,QAAQC,IAAI,2CACN6c,sBAAsB,OAE5B/c,KAAKJ,aAAc,EACnB,MAAM8a,EAAW/J,KAAKC,MAAQH,EAE9BxQ,QAAQC,IAAI,+BACZD,QAAQC,IAAI,uBAAwBwa,EAAU,KAChD,CAAE,MAAOna,GAIP,MAHAN,QAAQM,MAAM,2BAA4BA,GAC1CN,QAAQM,MAAM,yBAA0BoQ,KAAKC,MAAQH,EAAW,MAChErM,OAAO7D,MAAM,+BACPA,CACR,CACF,CAKQ,iBAAAyc,GACN,IAAKhd,KAAKJ,YACR,MAAM,IAAI+E,MAAM,qCAEpB,CAOA,kBAAMhB,CAAasZ,EAAoB,GACrCjd,KAAKgd,oBAEL,IAEE,MAAME,EAAUC,IAAIC,WAAW,CAAEpc,KAAM,UAAWqc,WAAYJ,IAK9D,GAHAhd,QAAQC,IAAI,sBAAuBgd,IAG9BA,GAA2C,IAAhClZ,OAAO/C,KAAKic,GAAShc,OAAc,CACjDjB,QAAQC,IAAI,kCACZ,MAAMod,EAAcb,EAAkB/S,MAAM,CAAC,GAG7C,aADM1J,KAAKiP,aAAaqO,EAAaL,GAC9BK,CACT,CAGA,MAAMC,EAAgBd,EAAkB/S,MAAMwT,GAG9C,OADAjd,QAAQC,IAAI,0BACLqd,CACT,CAAE,MAAOhd,GAIP,GAHAN,QAAQM,MAAM,0BAA2BA,GAGrCA,aAAiBoE,OAAS,WAAYpE,EAAO,CAC/C,MAAM,eAAEid,SAAyB,sCAC3BC,EAAYD,EAAejd,GACjCN,QAAQM,MAAM,0BAA2Bkd,GACzCrZ,OAAOkE,QAAQ,qBACjB,MACElE,OAAO7D,MAAM,YAIf,MAAM+c,EAAcb,EAAkB/S,MAAM,CAAC,GAE7C,UACQ1J,KAAKiP,aAAaqO,EAAaL,EACvC,CAAE,MAAOS,GACPzd,QAAQM,MAAM,0BAA2Bmd,EAC3C,CACA,OAAOJ,CACT,CACF,CAQA,kBAAMrO,CAAapG,EAAuBoU,EAAoB,GAC5Djd,KAAKgd,oBAEL/c,QAAQC,IAAI,8BAA+B+c,GAC3C,MAAMxM,EAAYE,KAAKC,MAEvB,IAEE3Q,QAAQC,IAAI,wCACZ,MAAMyd,GAAY,IAAA7O,OAAMjG,GAGxB5I,QAAQC,IAAI,kCACZ,MAGM0d,EAAiB,IAHAT,IAAIC,WAAW,CAAEpc,KAAM,UAAWqc,WAAYJ,IAKnEY,UAAWF,GAIb1d,QAAQC,IAAI,oCACNid,IAAIW,eAAeF,EAAgB,CAAE5c,KAAM,UAAWqc,WAAYJ,IAExE,MAAMvC,EAAW/J,KAAKC,MAAQH,EAC9BxQ,QAAQC,IAAI,6BAA8Bwa,EAAU,KACtD,CAAE,MAAOna,GAIP,MAHAN,QAAQM,MAAM,0BAA2BA,GACzCN,QAAQM,MAAM,wBAAyBoQ,KAAKC,MAAQH,EAAW,MAC/DrM,OAAO7D,MAAM,YACPA,CACR,CACF,CAQA,2BAAMyE,CACJU,EACAhB,EACAuY,EAAoB,GAEpBjd,KAAKgd,oBAEL,IACE,MAAMnU,QAAa7I,KAAK2D,aAAasZ,GAErC,GAAoB,WAAhBvX,EAA0B,CAC5B,IAAKmD,EAAKjF,WAAWhC,OACnB,MAAM,IAAI+C,MAAM,WAIdD,EAAQE,YACVZ,OAAOa,OAAOgE,EAAKjF,WAAWhC,OAAOgD,WAAYF,EAAQE,YAEvDF,EAAQI,cACVd,OAAOa,OAAOgE,EAAKjF,WAAWhC,OAAOkD,aAAcJ,EAAQI,cAEzDJ,EAAQK,YACV8D,EAAKjF,WAAWhC,OAAOmD,UAAYL,EAAQK,UAE/C,KAAO,CAEL,MAAMhC,EAAM8F,EAAKjF,WAAW7B,KAAK2D,GACjC,IAAK3C,EACH,MAAM,IAAI4B,MAAM,OAAOe,SAGrBhB,EAAQE,YACVZ,OAAOa,OAAO9B,EAAI6B,WAAYF,EAAQE,YAEpCF,EAAQI,cACVd,OAAOa,OAAO9B,EAAI+B,aAAcJ,EAAQI,cAEtCJ,EAAQK,YACVhC,EAAIgC,UAAYL,EAAQK,gBAEAjD,IAAtB4C,EAAQU,YACVrC,EAAIqC,UAAYV,EAAQU,UAE5B,OAEMpF,KAAKiP,aAAapG,EAAMoU,GAC9Bhd,QAAQC,IAAI,oBAAoBwF,WAClC,CAAE,MAAOnF,GAGP,MAFAN,QAAQM,MAAM,sBAAsBmF,UAAqBnF,GACzD6D,OAAO7D,MAAM,YACPA,CACR,CACF,CAOA,mBAAMgE,CAAcD,EAAsB2Y,EAAoB,GAC5Djd,KAAKgd,oBAEL,IACE,MAAMnU,QAAa7I,KAAK2D,aAAasZ,GAEd,WAAnB3Y,EAAUtD,KACZ6H,EAAKjF,WAAWhC,OAAS0C,EAEzBuE,EAAKjF,WAAW7B,KAAKuC,EAAU1B,IAAM0B,QAGjCtE,KAAKiP,aAAapG,EAAMoU,GAC9Bhd,QAAQC,IAAI,oBAAoBoE,EAAUf,YAC5C,CAAE,MAAOhD,GAGP,MAFAN,QAAQM,MAAM,sBAAsB+D,EAAUf,WAAYhD,GAC1D6D,OAAO7D,MAAM,YACPA,CACR,CACF,CAOA,eAAM8E,CAAUF,EAAe8X,EAAoB,GACjDjd,KAAKgd,oBAEL,IACE,MAAMnU,QAAa7I,KAAK2D,aAAasZ,GAErC,IAAKpU,EAAKjF,WAAW7B,KAAKoD,GACxB,MAAM,IAAIR,MAAM,OAAOQ,gBAGlB0D,EAAKjF,WAAW7B,KAAKoD,SAEtBnF,KAAKiP,aAAapG,EAAMoU,GAC9Bhd,QAAQC,IAAI,qBAAqBiF,SACnC,CAAE,MAAO5E,GAGP,MAFAN,QAAQM,MAAM,wBAAwB4E,QAAa5E,GACnD6D,OAAO7D,MAAM,aACPA,CACR,CACF,CAOA,0BAAMwI,CAAqBC,EAAgBiU,EAAoB,GAC7Djd,KAAKgd,oBAEL,IACE,MAAMnU,QAAa7I,KAAK2D,aAAasZ,GAErC,IAAKpU,EAAK8T,KAAKtO,kBACb,MAAM,IAAI1J,MAAM,aAGlB,MAAMkK,EAAWhG,EAAKyF,UAAUzF,EAAK8T,KAAKtO,mBAC1C,IAAKQ,EACH,MAAM,IAAIlK,MAAM,WAGlBkK,EAASlO,IAAI0H,eAAiBW,EAC9BH,EAAK8T,KAAKjO,YAAc1F,QAElBhJ,KAAKiP,aAAapG,EAAMoU,GAC9Bhd,QAAQC,IAAI,0BAA0B8I,IACxC,CAAE,MAAOzI,GAGP,MAFAN,QAAQM,MAAM,0BAA2BA,GACzC6D,OAAO7D,MAAM,YACPA,CACR,CACF,CAOA,oBAAMwd,CAAeC,EAAuDf,EAAoB,GAC9Fjd,KAAKgd,oBAEL,IACE,MAAMnU,QAAa7I,KAAK2D,aAAasZ,GACrCpU,EAAK8T,KAAKC,KAAOoB,QACXhe,KAAKiP,aAAapG,EAAMoU,GAC9Bhd,QAAQC,IAAI,0BAA0B8d,IACxC,CAAE,MAAOzd,GAGP,MAFAN,QAAQM,MAAM,0BAA2BA,GACzC6D,OAAO7D,MAAM,YACPA,CACR,CACF,CAOA,wBAAM2O,CAAmBC,EAAoB8N,EAAoB,GAC/Djd,KAAKgd,oBAEL,IACE,MAAMnU,QAAa7I,KAAK2D,aAAasZ,GACrCpU,EAAK8T,KAAKtO,kBAAoBc,QACxBnP,KAAKiP,aAAapG,EAAMoU,GAC9Bhd,QAAQC,IAAI,0BAA0BiP,IACxC,CAAE,MAAO5O,GAGP,MAFAN,QAAQM,MAAM,0BAA2BA,GACzC6D,OAAO7D,MAAM,YACPA,CACR,CACF,CAQA,+BAAM0d,CAA0BvW,EAAiBuV,EAAoB,GACnEjd,KAAKgd,oBAEL,IAEE,IAAKhd,KAAKke,oBAAoBxW,GAE5B,OADAzH,QAAQC,IAAI,0CACCF,KAAK2D,aAAasZ,GAIjC,MAAMkB,EAAiBhB,IAAIC,WAAW,CAAEpc,KAAM,UAAWqc,WAAYJ,IAI/DmB,QAAmBjB,IAAIkB,aAAa3W,EAASyW,GAG7CZ,EAAgBd,EAAkB/S,MAAO0U,GAAYP,WAAqB,CAAC,GAMjF,aAHM7d,KAAKiP,aAAasO,EAAeN,GAEvChd,QAAQC,IAAI,+BACLqd,CACT,CAAE,MAAOhd,GAGP,MAFAN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,oBACPA,CACR,CACF,CAMQ,mBAAA2d,CAAoBxW,GAE1B,OAAOA,EAAQ5B,SAAS,OAAS4B,EAAQ5B,SAAS,KACpD,E,+DC9KK,MAAMwY,EAAqB,IA5LlC,MACU1e,aAAc,EACd2e,cAAgB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAKnE,UAAAxe,GACMC,KAAKJ,YACPK,QAAQC,IAAI,qCAIdD,QAAQC,IAAI,oCACZF,KAAKJ,aAAc,EACrB,CAQA,6BAAM4e,CAAwBrP,EAAoBsP,EAAkBC,GAClE,IAEE,IAAK1e,KAAK2e,uBAAuBF,GAC/B,OAIF,MAAM3N,EAAU9Q,KAAK4e,qBAAqBH,GAGpC3O,EAAa9P,KAAK6e,iBAAiBJ,GAGnChY,EAAwB,CAC5B7D,GAAI5C,KAAK8e,kBACThO,UACA6I,UAAWhJ,KAAKC,MAChBiJ,mBAAoB6E,GAIhBK,GAAgB,IAAA3Q,oBAChBS,EAAWkQ,EAAczP,YAAYH,GAE3C,IAAKN,EAEH,YADA5O,QAAQM,MAAM,iCAAiC4O,KAKjDN,EAASnI,OAAOX,KAAKU,SAGfsY,EAAc1P,eAAeF,EAAY,CAC7CzI,OAAQmI,EAASnI,SAGnBzG,QAAQC,IAAI,iCAAiC4Q,WAAiBhB,KAChE,CAAE,MAAOvP,GACPN,QAAQM,MAAM,iCAAkCA,EAElD,CACF,CAOA,sBAAAoe,CAAuBzX,GACrB,OAAOlH,KAAKue,cAAc3U,KAAKoV,GAAW9X,EAAKpB,SAASkZ,GAC1D,CAOA,oBAAAJ,CAAqB1X,GAEnB,MAAM+X,EAAY/X,EAAKgY,MAAM,WAG7B,IAAK,MAAMC,KAAYF,EAAW,CAChC,MAAMG,EAAUD,EAASE,OAGzB,KAAID,EAAQle,OAAS,IAAMke,EAAQle,OAAS,MAKxClB,KAAKue,cAAc3U,KAAKoV,GAAWI,EAAQtZ,SAASkZ,IACtD,OAAOI,CAEX,CAGA,IAAK,MAAMD,KAAYF,EAAW,CAChC,MAAMG,EAAUD,EAASE,OACzB,GAAID,EAAQle,QAAU,IAAMke,EAAQle,QAAU,IAC5C,OAAOke,CAEX,CAGA,OAAOlY,EAAK8F,UAAU,EAAG,IAAIqS,OAAS,KACxC,CAOA,gBAAAR,CAAiB3X,GASf,MAPqB,CAAC,KAAM,KAAM,MAOjB0C,KAAKoV,GAAW9X,EAAKpB,SAASkZ,IACtC,OANc,CAAC,KAAM,KAAM,MAUjBpV,KAAKoV,GAAW9X,EAAKpB,SAASkZ,IACxC,UATW,CAAC,KAAM,MAaXpV,KAAKoV,GAAW9X,EAAKpB,SAASkZ,IACrC,MAKX,CAMQ,eAAAF,GACN,MAAO,SAASnO,KAAKC,SAASzK,KAAKsQ,SAASC,SAAS,IAAI1J,UAAU,EAAG,IACxE,CAOA,iBAAAsS,CAAkBnQ,GAChB,MACMN,GADgB,IAAAT,oBACSkB,YAAYH,GAE3C,OAAKN,EAKEA,EAASnI,QAAU,IAJxBzG,QAAQM,MAAM,iCAAiC4O,KACxC,GAIX,CAOA,kBAAAoQ,CAAmBpQ,GAKjB,OAJenP,KAAKsf,kBAAkBnQ,GAIxBrM,OAAO2D,GACE,CAAC,KAAM,KAAM,MACdmD,KAAKoV,GAAWvY,EAAMqK,QAAQhL,SAASkZ,IAE/D,E,UCtMF7f,EAAOC,QAAUogB,OAAO,gD,gDC4SjB,MAAMC,EAAmB,IA/RhC,MACUC,QAAiC,KACjC7f,aAA0B,YAC1BD,aAAc,EAMtB,gBAAMG,GACJ,GAAIC,KAAKJ,YACPK,QAAQC,IAAI,sCAId,IACED,QAAQC,IAAI,uCACNF,KAAK2f,cACX3f,KAAKJ,aAAc,EACnBK,QAAQC,IAAI,6BACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,8BAA+BA,GACvCA,CACR,CACF,CAKA,iBAAMof,GACJ,IACE,MACMC,EADgBvc,aAAa,CAAErC,KAAM,WACR6e,YAenC,OAbID,GACF5f,KAAK0f,QAAUE,EACf3f,QAAQC,IAAI,8BAA+BF,KAAK0f,WAGhD1f,KAAK0f,QAAU,CACbI,UAAW,KACXC,WAAY,KACZC,UAAW,MAEb/f,QAAQC,IAAI,0CAGPF,KAAK0f,OACd,CAAE,MAAOnf,GAQP,OAPAN,QAAQM,MAAM,+BAAgCA,GAE9CP,KAAK0f,QAAU,CACbI,UAAW,KACXC,WAAY,KACZC,UAAW,MAENhgB,KAAK0f,OACd,CACF,CAKA,iBAAMO,CAAYP,GAChB,IACE1f,KAAK0f,QAAUA,QAET7b,wBAAwB,CAAEgc,YAAaH,GAAW,CAAE1e,KAAM,WAChEf,QAAQC,IAAI,8BAA+Bwf,GAC3Ctb,OAAOI,QAAQ,YACjB,CAAE,MAAOjE,GAGP,MAFAN,QAAQM,MAAM,+BAAgCA,GAC9C6D,OAAO7D,MAAM,eACPA,CACR,CACF,CAMA,aAAA2f,GACE,IAAKlgB,KAAK0f,QAER,OADAzf,QAAQK,KAAK,sCACN,KAGT,MAAM+M,EAASrN,KAAK0f,QAAQ1f,KAAKH,cAEjC,OADAI,QAAQC,IAAI,gCAAgCF,KAAKH,0BAA2BwN,GACrEA,CACT,CAKA,WAAA8S,CAAYC,GACV,OAAKpgB,KAAK0f,QAKH1f,KAAK0f,QAAQU,IAJlBngB,QAAQK,KAAK,sCACN,KAIX,CAKA,aAAA+f,GACE,OAAKrgB,KAAK0f,QASH,CACLI,UAAW9f,KAAK0f,QAAQI,UAAY,IAAK9f,KAAK0f,QAAQI,WAAc,KACpEC,WAAY/f,KAAK0f,QAAQK,WAAa,IAAK/f,KAAK0f,QAAQK,YAAe,KACvEC,UAAWhgB,KAAK0f,QAAQM,UAAY,IAAKhgB,KAAK0f,QAAQM,WAAc,MAX7D,CACLF,UAAW,KACXC,WAAY,KACZC,UAAW,KAUjB,CAKA,oBAAMM,CAAeF,EAAkB/S,GACrC,IACOrN,KAAK0f,eACF1f,KAAK2f,cAGT3f,KAAK0f,UACP1f,KAAK0f,QAAQU,GAAS/S,QAChBrN,KAAKigB,YAAYjgB,KAAK0f,SAC5Bzf,QAAQC,IAAI,4BAA4BkgB,cAE5C,CAAE,MAAO7f,GAEP,MADAN,QAAQM,MAAM,2BAA2B6f,gBAAqB7f,GACxDA,CACR,CACF,CAKA,iBAAAggB,GACEvgB,KAAKH,aAAe,YACpBI,QAAQC,IAAI,oCACd,CAKA,kBAAAsgB,GACExgB,KAAKH,aAAe,aACpBI,QAAQC,IAAI,mCACd,CAKA,iBAAAugB,GACEzgB,KAAKH,aAAe,YACpBI,QAAQC,IAAI,kCACd,CAKA,eAAAoB,GACE,OAAOtB,KAAKH,YACd,CAOA,oBAAM6gB,CAAeC,GAEnB,MAAMC,EAAgB5gB,KAAKH,aAE3B,IACEI,QAAQC,IAAI,6BAA6BygB,iBAIrB,cAAhBA,EAA6B3gB,KAAKugB,oBACb,eAAhBI,EAA8B3gB,KAAKwgB,qBACnB,cAAhBG,GAA6B3gB,KAAKygB,oBAI3C,MAAM1T,QAAiBgJ,YAAY,CACjCC,gBAAiB,CAAC,CAAEC,KAAM,OAAQC,QAAS,+BAI7C,OAAInJ,GAAYA,EAAS7L,OAAS,GAChCjB,QAAQC,IAAI,mCACL,CACLsE,SAAS,EACTkD,QAAS,eAGXzH,QAAQK,KAAK,kCACN,CACLkE,SAAS,EACTkD,QAAS,aAGf,CAAE,MAAOnH,GAEP,OADAN,QAAQM,MAAM,mCAAoCA,GAC3C,CACLiE,SAAS,EACTkD,QAAS,SAASnH,aAAiBoE,MAAQpE,EAAMmH,QAAU,SAE/D,C,QAEEzH,QAAQC,IAAI,qCAAqC0gB,KAC3B,cAAlBA,EAA+B5gB,KAAKugB,oBACb,eAAlBK,EAAgC5gB,KAAKwgB,qBACnB,cAAlBI,GAA+B5gB,KAAKygB,mBAC/C,CACF,CAKA,cAAAI,CAAexT,GACb,MAAM+E,EAAmB,GAEpB/E,EAAOyT,QAAmC,KAAzBzT,EAAOyT,OAAOzB,OAExBhS,EAAOyT,OAAOC,WAAW,YAAe1T,EAAOyT,OAAOC,WAAW,aAC3E3O,EAAOrM,KAAK,mCAFZqM,EAAOrM,KAAK,cAuBd,OAjBuBsH,EAAOyT,OAAOhb,SAAS,cAAgBuH,EAAOyT,OAAOhb,SAAS,cAC5DuH,EAAO2T,KAA6B,KAAtB3T,EAAO2T,IAAI3B,QAChDjN,EAAOrM,KAAK,0BAGTsH,EAAOK,OAAiC,KAAxBL,EAAOK,MAAM2R,QAChCjN,EAAOrM,KAAK,aAGVsH,EAAO4T,YAAc,GAAK5T,EAAO4T,YAAc,IACjD7O,EAAOrM,KAAK,kBAGVsH,EAAO6T,YAAc,GACvB9O,EAAOrM,KAAK,oBAGP,CACLob,MAAyB,IAAlB/O,EAAOlR,OACdkR,SAEJ,CAKA,kBAAMgP,GACJ,IACE,MAAMC,EAAiC,CACrCvB,UAAW,KACXC,WAAY,KACZC,UAAW,YAGPhgB,KAAKigB,YAAYoB,GACvBphB,QAAQC,IAAI,kCACZkE,OAAOI,QAAQ,YACjB,CAAE,MAAOjE,GAGP,MAFAN,QAAQM,MAAM,+BAAgCA,GAC9C6D,OAAO7D,MAAM,UACPA,CACR,CACF,E,wDCxSF,MAAM,EAA+B+gB,E,sCCkB9B,MAAMC,GAAe,IAAA5f,aAAY,OAAQ,KAE9C,MAAM/B,GAAc,IAAAiC,MAAI,GAClB+a,GAAsB,IAAA/a,KAAI,QAC1BwM,GAAoB,IAAAxM,UAAwBC,GAC5C4M,GAAc,IAAA7M,UAAwBC,GAGtC0f,GAAe,IAAA3f,KAAe,CAClCoF,WAAY,GACZyV,QAAS,GACT1T,YAAQlH,EACRoI,iBAAapI,IAIT2f,GAAc,IAAA5f,MAAI,GAClB6f,GAAgB,IAAA7f,KAAI,IACpB8f,GAAoB,IAAA9f,KAA6B,MACjD+f,GAAgB,IAAA/f,KAA6B,MAG7CggB,GAAa,IAAA1f,UAAS,IAAqB,WAAfya,EAAKxa,OACjC0f,GAAgB,IAAA3f,UAAS,IAAqB,cAAfya,EAAKxa,OACpC2f,GAAe,IAAA5f,UAAS,IAAqB,aAAfya,EAAKxa,OACnC4f,GAAe,IAAA7f,UAAS,IAAqB,SAAfya,EAAKxa,OAwGzC,SAAS6f,EAAYC,GACnBV,EAAapf,MAAQ,IAChBof,EAAapf,SACb8f,GAELjiB,QAAQC,IAAI,wBAAyBshB,EAAapf,MACpD,CAKAe,eAAe+L,EAAmBC,GAChC,IAGE,GAFAd,EAAkBjM,MAAQ+M,QAAcrN,EAEpCqN,EAAY,OACRzL,EAAW,WAAAwL,mBAAmBC,GAGpC,MAAM,iBAAExP,SAA2B,2CAC7BA,EAAiByB,4BAEvBnB,QAAQC,IAAI,yBAAyBiP,IACvC,KAAO,CAEL,MAAM,iBAAExP,SAA2B,2CAC7BA,EAAiBa,2BAEvBP,QAAQC,IAAI,4BACd,CACF,CAAE,MAAOK,GACPN,QAAQM,MAAM,yBAA0BA,GACxC6D,OAAO7D,MAAM,SACf,CACF,CAKA4C,eAAegf,EAAenZ,GAC5B,IACE0F,EAAYtM,MAAQ4G,QACdtF,EAAW,WAAAqF,qBAAqBC,GACtC/I,QAAQC,IAAI,yBAAyB8I,IACvC,CAAE,MAAOzI,GACPN,QAAQM,MAAM,yBAA0BA,GACxC6D,OAAO7D,MAAM,SACf,CACF,CAiCA,SAAS6hB,IACPX,EAAYrf,OAAQ,EACpBsf,EAActf,MAAQ,GACtBuf,EAAkBvf,MAAQ,IAC5B,CAwTA,MAAO,CAELxC,cACAgd,OACAvO,oBACAK,cACA8S,eACAC,cACAC,gBACAC,oBACAC,gBAGAC,aACAC,gBACAC,eACAC,eAGAjiB,WAhgBFoD,iBACE,GAAIvD,EAAYwC,MACdnC,QAAQC,IAAI,8BAId,IACED,QAAQC,IAAI,+BAGNwD,EAAW,WAAA3D,aAGjB,MAAM0D,QAAiBC,EAAW,WAAAC,eAQlC,GALAiZ,EAAKxa,MAAQqB,EAASkZ,KAAKC,KAC3BvO,EAAkBjM,MAAQqB,EAASkZ,KAAKtO,kBACxCK,EAAYtM,MAAQqB,EAASkZ,KAAKjO,YAG9BL,EAAkBjM,OAASqB,EAAS6K,UAAUD,EAAkBjM,OAAQ,CAC1E,MAAMyM,EAAWpL,EAAS6K,UAAUD,EAAkBjM,OAChDqG,EAAOoG,EAASlO,IAAIwH,MAAMtF,IAAI6L,EAAYtM,OAASyM,EAASlO,IAAIyH,WAElEK,IACF+Y,EAAapf,MAAQ,CACnB6E,WAAYwB,EAAKxB,YAAc,GAC/ByV,QAAS,GACT1T,OAAQP,EAAK7F,GACbsH,YAAazB,EAAKyB,aAGxB,CAEAtK,EAAYwC,OAAQ,EACpBnC,QAAQC,IAAI,sBAehB,WAEE,MAAMmiB,EAAgB,aAAWlf,UAC/B,IACE,MAAMM,QAAiBC,EAAW,WAAAC,eAGlCF,EAASkZ,KAAKC,KAAOA,EAAKxa,MAC1BqB,EAASkZ,KAAKtO,kBAAoBA,EAAkBjM,MACpDqB,EAASkZ,KAAKjO,YAAcA,EAAYtM,YAGlCsB,EAAW,WAAAuL,cAAa,IAAAH,OAAMrL,IACpCxD,QAAQC,IAAI,4BACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,uBAAwBA,EACxC,GACC,MAGH,IAAA+hB,aAAY,KACL1iB,EAAYwC,OAGjBigB,KAEJ,CAtCIE,EACF,CAAE,MAAOhiB,GAGP,MAFAN,QAAQM,MAAM,sBAAuBA,GACrC6D,OAAO7D,MAAM,aACPA,CACR,CACF,EAodEiiB,QA/aFrf,eAAuB6a,GACrB,IACEpB,EAAKxa,MAAQ4b,QACPta,EAAW,WAAAqa,eAAeC,GAChC/d,QAAQC,IAAI,yBAAyB8d,IACvC,CAAE,MAAOzd,GACPN,QAAQM,MAAM,yBAA0BA,GACxC6D,OAAO7D,MAAM,WACf,CACF,EAuaE0hB,cACA/S,qBACAiT,iBACAM,wBA/WF,SAAiCC,GAC/Bf,EAAkBvf,MAAQsgB,EAC1BjB,EAAYrf,MAAqB,OAAbsgB,CACtB,EA6WEC,iBAvWF,SAA0BD,GACxBd,EAAcxf,MAAQsgB,EACtBf,EAAkBvf,MAAQ,KAC1Bqf,EAAYrf,OAAQ,EACpBnC,QAAQC,IAAI,uBAAwBwiB,EACtC,EAmWEE,oBA9VF,SAA6B1b,GAC3Bwa,EAActf,MAAQ8E,EACtBua,EAAYrf,MAAQ8E,EAAKhG,OAAS,CACpC,EA4VEkhB,iBACAS,iBA7UF1f,eACEkK,EAMI,CAAC,GAEL,IACEpN,QAAQC,IAAI,yBAA0B,CACpCc,KAAMqM,EAAOrM,KACbgZ,WAAY3M,EAAO2M,WACnB8I,UAAWzV,EAAOyV,UAClBrgB,SAAU4K,EAAOtL,MAAMb,OACvB6hB,kBAAmB1V,EAAO8M,eAE5B/V,OAAOoB,KAAK,aAGZ,MAAM,iBAAE4I,SAA2B,sCAC7B2Q,EAAgB3Q,IAGhBe,EAAa,YAAYwB,KAAKC,QAG9BoS,EAAgB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAC3DC,EAAY5V,EAAOrM,MAAQgiB,EAAc7c,KAAK+c,MAAM/c,KAAKsQ,SAAWuM,EAAc9hB,SAClFiiB,EAAkB9V,EAAO2M,YAAc7T,KAAK+c,MAAsB,EAAhB/c,KAAKsQ,UAAgB,EACvEqM,EAAYzV,EAAOyV,WAAa3c,KAAK+c,MAAsB,EAAhB/c,KAAKsQ,UAAgB,EAEtExW,QAAQC,IAAI,qBAAsB,CAChCiP,aACAnO,KAAMiiB,EACNjJ,WAAYmJ,EACZL,cAIF,IAAI/gB,EAA+D,GACnE,GAAIsL,EAAOtL,KAETA,EAAOsL,EAAOtL,KAAKpB,IAAIoC,IAAO,CAC5B2C,YAAa3C,EAAIH,GACjB0B,UAAWvB,EAAIuB,UACfrB,aAAcF,EAAI+M,YAAc,IAAM,EACtCA,WAAY/M,EAAI+M,WAChBsT,OAAQrgB,EAAIqgB,OACZrT,gBAAiB,KAEnB9P,QAAQC,IAAI,sBAAsB6B,EAAKb,qBAGvC,IACE,MAAM,yBAAEmiB,SAAmC,sCAGrC5gB,EAAW4gB,EAAyBC,kBAAkBH,GAC5DljB,QAAQC,IAAI,oBAAoBuC,WAChC2B,OAAOoB,KAAK,QAAQ/C,cAkBpBV,SAf4BshB,EAAyBE,mBACnD9gB,EACAwgB,OACAnhB,EACA,CAAC0hB,EAASvY,KACRhL,QAAQC,IAAI,0BAA0BsjB,KAAWvY,KAEjD7G,OAAOoB,KAAK,SAASge,KAAWvY,aAAkB,OAAQ,CACxDmJ,QAAS,IACTqP,gBAAiB,OAMF9iB,IAAIoC,IAEvB,MAAM+M,EAAc3J,KAAK+c,MAAsB,EAAhB/c,KAAKsQ,UAAgB,EAEpD,MAAO,CACL/Q,YAAa3C,EAAIH,GACjB0B,UAAWvB,EACXE,YAAa6M,GAAc,EAC3BA,aACAC,gBAAiB,KAIrB9P,QAAQC,IAAI,uBAAuB6B,EAAKb,gBACxCkD,OAAOI,QAAQ,QAAQzC,EAAKb,eAAgB,OAAQ,CAAEkT,QAAS,KACjE,CAAE,MAAO7T,GAEPN,QAAQM,MAAM,yBAA0BA,GACxC6D,OAAOkE,QAAQ,0BACfvG,EAAO,EACT,CAIF,IAAI2hB,EAAU,GACd,MAAM1gB,EAAgBjB,EAAKe,OAAOC,IAAQA,EAAI+M,YAAc,IAAM,GAE9D9M,EAAc9B,OAAS,IACzBwiB,EAAU,oCACV1gB,EAAckB,QAAQnB,IACpB2gB,GAAW,KAAK3gB,EAAIuB,UAAUf,aAAaR,EAAI+M,iBAAiB/M,EAAIuB,UAAU0C,YAAc,UAAUjE,EAAIuB,UAAU2C,YAAc,cAEpIhH,QAAQC,IAAI,mBAAmB8C,EAAc9B,mBAI/C,IAAI4F,EAAS,GAIXA,EAFEuG,EAAO8M,aAEA,qBACf9M,EAAO8M,wBAEFgJ,eACEL,IAAYY,4DAKbT,kBACME,gYAkBG,QAAQF,iBAAyBE,yBAGzCL,uEAIMY,EAAU,gCAAkC,KAAKA,4DAKxDT,kBACME,gYAkBRljB,QAAQC,IAAI,oCACZkE,OAAOoB,KAAK,cAAe,QAG3B,MAAM0B,QAAaK,SAAS,CAC1BC,WAAYV,EACZK,eAAe,IAGjBlH,QAAQC,IAAI,iCAGZ,MAAMyjB,EAAYzc,EAAKuC,MAAM,4BAC7B,IAAKka,EAEH,MADA1jB,QAAQM,MAAM,mCACR,IAAIoE,MAAM,sBAGlB,MACMif,SADc,4CAAgBva,QACTK,MAAMia,EAAU,IAE3C1jB,QAAQC,IAAI,yBAA0B,CACpCqD,KAAMqgB,EAAcrgB,KACpBuf,UAAWc,EAAcjjB,KAAKwH,OAAOjH,SAIvC,MAAMiH,EAAQ,IAAInG,IACd4hB,EAAcjjB,KAAKwH,OACrByb,EAAcjjB,IAAIwH,MAAMjE,QAASuE,IAC/BN,EAAMhE,IAAIsE,EAAK7F,GAAI,IACd6F,EACHS,aAAcT,EAAK7F,KAAOghB,EAAcjjB,IAAIyH,UAC5CiC,YAAa5B,EAAK4B,aAAe,OAKvC,MAAMwZ,EAA6D,CACjEjhB,GAAIuM,EACJ5L,KAAMqgB,EAAcrgB,MAAQ,GAAG0f,MAC/BjiB,KAAMiiB,EACNjJ,WAAYmJ,EACZvT,aAAcgU,EAAchU,cAAgB,GAC5CjP,IAAK,CACHwH,QACAO,YAAakb,EAAcjjB,KAAK+H,aAAe,GAC/CL,eAAgBub,EAAcjjB,KAAKyH,WAAa,SAChDA,UAAWwb,EAAcjjB,KAAKyH,WAAa,UAE7CxE,WAAY7B,EACZ2E,OAAQ,GACRyJ,SAAU,GACV5J,OAAQ,QACRkK,UAAWE,KAAKC,MAChBsJ,UAAU,EACVC,aAAc9M,EAAO8M,cAGvBla,QAAQC,IAAI,gDAGN6e,EAAc3P,YAAYyU,GAEhC5jB,QAAQC,IAAI,2BAA4B,CACtCiP,aACA5L,KAAMsgB,EAAetgB,KACrBuf,UAAW3a,EAAMzF,aAIbwM,EAAmBC,SAGnBgT,EAAe0B,EAAeljB,IAAIyH,WAGxC,MAAMA,EAAYD,EAAMtF,IAAIghB,EAAeljB,IAAIyH,WAqB/C,OApBIA,GACF6Z,EAAY,CACVhb,WAAYmB,EAAUnB,YAAc,GACpCyV,QAAS,GACT1T,OAAQZ,EAAUxF,GAClBsH,YAAa9B,EAAU8B,cAI3BjK,QAAQC,IAAI,yBAA0B,CACpCiP,aACA5L,KAAMsgB,EAAetgB,KACrBvC,KAAMiiB,EACNjJ,WAAYmJ,EACZL,UAAW3a,EAAMzF,KACjBD,SAAUV,EAAKb,SAGjBkD,OAAOI,QAAQ,MAAMqf,EAAetgB,aAAc,QAE3C4L,CACT,CAAE,MAAO5O,GAMP,MALAN,QAAQM,MAAM,uBAAwB,CACpCA,MAAOA,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,GACvDqH,MAAOrH,aAAiBoE,MAAQpE,EAAMqH,WAAQ9F,IAEhDsC,OAAO7D,MAAM,aAAc,QACrBA,CACR,CACF,EAkDEoG,MA7CF,WACE/G,EAAYwC,OAAQ,EACpBwa,EAAKxa,MAAQ,OACbiM,EAAkBjM,WAAQN,EAC1B4M,EAAYtM,WAAQN,EACpB0f,EAAapf,MAAQ,CACnB6E,WAAY,GACZyV,QAAS,GACT1T,YAAQlH,EACRoI,iBAAapI,GAEfsgB,IACAniB,QAAQC,IAAI,uBACd,I,UC7hBFf,EAAOC,QAAUgF,M,gBCQV,SAAS0f,IACd,OAAO3d,KAAK+c,MAAsB,IAAhB/c,KAAKsQ,UAAkB,CAC3C,CAQO,SAASsN,EAAazJ,EAAcC,GAEzC,OAAa,IAATD,EACK,mBAII,MAATA,GAAiBA,GAAQ,IAAMC,EAAQ,GAClC,mBAILD,GAAQC,EAAQ,EACX,kBAILD,GAAQC,EAAQ,EACX,eAILD,GAAQC,EACH,UAIF,SACT,CAQO,SAASyJ,EAAkBxJ,EAAmByJ,GACnD,MAAM3J,EAAOwJ,IAGb,MAAO,CACLxJ,OACAC,MAAO0J,EACPpc,OALakc,EAAazJ,EAAM2J,GAMhCzJ,YACAb,UAAWhJ,KAAKC,MAEpB,CAOO,SAASsT,EAAkBtf,GAChC,MAAM,IAAE0P,EAAG,IAAEG,EAAG,IAAED,GAAQ5P,EAG1B,OAAI0P,EAAME,GAAOC,EAAMD,EACd,GAIJF,GAAOE,GAAOC,GAAOD,IAAQF,EAAM,EAAIE,GAAOC,EAAM,EAAID,EACpD,EAILF,GAAO,EAAIE,GAAOC,GAAO,EAAID,EACxB,EAGF,CACT,CAOO,SAAS2P,EAAqBvf,GACnC,MAAMwf,EAAMxf,EAAW0P,IAAM1P,EAAW4P,IAExC,OAAI4P,GAAO,GACF,CAAE7O,GAAI,KAAMC,OAAQ,GAClB4O,GAAO,GACT,CAAE7O,GAAI,KAAMC,OAAQ,GAClB4O,GAAO,IACT,CAAE7O,GAAI,IAAKC,MAAO,GAChB4O,GAAO,IACT,CAAE7O,GAAI,OAAQC,MAAO,GACnB4O,GAAO,IACT,CAAE7O,GAAI,OAAQC,MAAO,GACnB4O,GAAO,IACT,CAAE7O,GAAI,OAAQC,MAAO,GACnB4O,GAAO,IACT,CAAE7O,GAAI,OAAQC,MAAO,GACnB4O,GAAO,IACT,CAAE7O,GAAI,OAAQC,MAAO,GAErB,CAAED,GAAI,OAAQC,MAAO,EAEhC,CAOO,SAAS6O,EAAsBzf,GACpC,MAAM,IAAE2P,EAAG,IAAEC,EAAG,IAAEI,GAAQhQ,EAGpBqQ,EAAQ9O,KAAK+c,OAAO3O,EAAMC,GAAO,IAGjCW,EAAQhP,KAAK+c,MAAMtO,EAAM,GAGzBS,EAAST,EAGTU,EAAM4O,EAAkBtf,IAGxB,GAAE2Q,EAAE,MAAEC,GAAU2O,EAAqBvf,GAE3C,MAAO,CACLoQ,GAAIC,EACJA,QACAC,GAAIC,EACJA,QACAC,IAAKC,EACLA,SACAC,MACAC,KACAC,QAEJ,CAOO,SAAS8O,EAAyBC,EAA8B,SACrE,MAAMC,EAAgB,KACpB,GAAe,UAAXD,EAAoB,CAItB,OAAc,GADZpe,KAAK+c,MAAsB,EAAhB/c,KAAKsQ,UAAgB,GAAKtQ,KAAK+c,MAAsB,EAAhB/c,KAAKsQ,UAAgB,IAAMtQ,KAAK+c,MAAsB,EAAhB/c,KAAKsQ,UAAgB,GAE/G,CAGE,OAAc,GADDtQ,KAAK+c,MAAsB,EAAhB/c,KAAKsQ,UAAgB,GAAKtQ,KAAK+c,MAAsB,EAAhB/c,KAAKsQ,UAAgB,GAAK,IAK3F,MAAO,CACLnC,IAAKkQ,IACLjQ,IAAKiQ,IACLhQ,IAAKgQ,IACL/P,IAAK+P,IACL9P,IAAK8P,IACL7P,IAAK6P,IACL5P,IAAK4P,IACL3P,IAAK2P,IACL1P,IAAK0P,IAET,CAQO,SAASC,EACdC,EACAC,GAEA,MAAMC,EAAeZ,EAAkB,KAAMU,GACvCG,EAAeb,EAAkB,KAAMW,GAGvCG,EAA4C,CAChDC,iBAAkB,EAClBC,gBAAiB,EACjBC,aAAc,EACdzgB,QAAS,EACT0gB,QAAS,EACTC,iBAAkB,GAGdC,EAAgBN,EAAcF,EAAa/c,QAC3Cwd,EAAgBP,EAAcD,EAAahd,QAEjD,IAAIA,EASJ,OAPEA,EADEud,EAAgBC,EACT,gBACAA,EAAgBD,EAChB,gBAEA,MAGJ,CAAEvd,SAAQ+c,eAAcC,eACjC,CAQO,SAASS,EAAgBC,EAAoBC,EAAgB,GAElE,OADerf,KAAKC,IAAI,EAAGmf,EAAaC,EAE1C,CAQO,SAASC,EACdzJ,EACA0J,GAKA,MAAMC,EAAS3J,EAAa0J,EAG5B,OAAIA,GAAW,EACN,CAAEE,UAAU,EAAM5kB,KAAM,aAI7B2kB,GAAU,EACL,CAAEC,UAAU,EAAM5kB,KAAM,aAK7B2kB,EAAS,GACJ,CAAEC,UAAU,EAAM5kB,KAAM,cAG1B,CAAE4kB,UAAU,EACrB,CAOO,SAASC,EAAkBhe,GAShC,MAR0C,CACxCkd,iBAAkB,MAClBC,gBAAiB,OACjBC,aAAc,OACdzgB,QAAS,KACT0gB,QAAS,KACTC,iBAAkB,OAEPtd,EACf,C,8JChSA1I,EAAOC,QAAU0X,C,+CCQjB,MAAMgP,EAAa,CAEjBC,OAAQ,gBAERC,eAAgB,IAEhBC,YAAY,GAMd,IAAKC,GAAL,SAAKA,GACH,cACA,eACA,gBACA,cACA,YACA,aACA,WACD,CARD,CAAKA,IAAAA,EAAa,KA6LlB,MAAMC,EAAS,IA9Kf,MAIE,cAAAC,CAAeC,EAAe9jB,EAAiBkI,GAC7CxK,QAAQC,IAAI,GAAG4lB,EAAWC,WAAWM,MAAUH,EAAcI,UAAU/jB,OAAUkI,KAE7Eqb,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,YAAgB5b,IAEnE,CAKA,iBAAA+b,CAAkBH,EAAejG,GAC/BngB,QAAQC,IAAI,GAAG4lB,EAAWC,WAAWM,MAAUH,EAAcO,qBAAqBrG,KAE9E0F,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,gBAEnD,CAKA,aAAAK,CAAcL,EAAejG,GAC3BngB,QAAQC,IAAI,GAAG4lB,EAAWC,WAAWM,MAAUH,EAAcS,kBAAkBvG,KAE3E0F,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,iBAEnD,CAKA,eAAAO,CAAgBP,EAAe9jB,EAAiBkI,GAC9CxK,QAAQC,IAAI,GAAG4lB,EAAWC,WAAWM,MAAUH,EAAcW,WAAWtkB,OAAUkI,KAE9Eqb,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,YAAgB5b,IAEnE,CAKA,kBAAAqc,CAAmBT,EAAejG,GAChCngB,QAAQC,IAAI,GAAG4lB,EAAWC,WAAWM,MAAUH,EAAcO,qBAAqBrG,KAE9E0F,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,gBAEnD,CAKA,QAAAU,CAASV,EAAe9jB,EAAiBkI,GACvCxK,QAAQC,IAAI,GAAG4lB,EAAWC,WAAWM,MAAUH,EAAcc,aAAazkB,OAAUkI,KAEhFqb,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,cAAkBA,IAErE,CAKA,OAAAY,CAAQZ,EAAe9jB,EAAiBkI,GACtCxK,QAAQC,IAAI,GAAG4lB,EAAWC,WAAWM,MAAUH,EAAcgB,YAAY3kB,OAAUkI,KAE/Eqb,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,cAAkBA,EAAQ,IAE7E,CAKA,kBAAAc,CAAmBd,EAAe3L,GAChC,MAAM0M,EAAS1M,EAAWoL,EAAWE,eAC/BqB,EAAaD,EAAS,UAAY,GAExCnnB,QAAQC,IACN,GAAG4lB,EAAWC,WAAWM,MAAUH,EAAcO,sBAAsB/L,EAAS4M,QAAQ,QAAQD,KAG9FvB,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,mBAAuB3L,EAAS4M,QAAQ,QAGrFF,GACFnnB,QAAQK,KACN,GAAGwlB,EAAWC,WAAWM,gBAAoB3L,EAAS4M,QAAQ,aAAaxB,EAAWE,mBAG5F,CAKA,gBAAAuB,CAAiBlB,EAAe3L,EAAkBna,GAChDN,QAAQM,MACN,GAAGulB,EAAWC,WAAWM,MAAUH,EAAcsB,oBAAoB9M,EAAS4M,QAAQ,SACtF/mB,GAGEA,aAAiBoE,OAASpE,EAAMqH,OAClC3H,QAAQM,MAAM,GAAGulB,EAAWC,WAAWM,WAAgB9lB,EAAMqH,OAG3Dke,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,WAAgB,CAC7D9iB,KAAMhD,aAAiBoE,MAAQpE,EAAMgD,KAAO,UAC5CmE,QAASnH,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,GACzDma,SAAU,GAAGA,EAAS4M,QAAQ,QAGpC,CAKA,gBAAAG,CAAiBpB,EAAe3e,EAAiBnH,GAC/CN,QAAQM,MAAM,GAAGulB,EAAWC,WAAWM,aAAiB3e,IAAWnH,GAAS,IAExEA,aAAiBoE,OAASpE,EAAMqH,OAClC3H,QAAQM,MAAM,GAAGulB,EAAWC,WAAWM,WAAgB9lB,EAAMqH,OAG3Dke,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,aAAkB,CAC/D3e,UACAnH,MAAOA,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,IAG7D,CAKA,UAAAmnB,CAAWrB,EAAe3e,EAAiBoD,GACzC7K,QAAQK,KAAK,GAAGwlB,EAAWC,WAAWM,MAAU3e,IAAWoD,GAAW,IAElEgb,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,WAAgBvb,EAEnE,CAKA,QAAA6c,CAAStB,EAAe3e,EAAiBmB,GACnCid,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,mBAAmBM,MAAU3e,IAAWmB,GAAQ,GAEhF,CAKA,aAAA+e,CAAchgB,GACRke,EAAWG,YACbhmB,QAAQsmB,MAAM,GAAGT,EAAWC,yBAA0B,CACpD8B,MAAOjgB,EAAM1G,OACb0G,MAAO,IAAIA,IAGjB,GAsBF,SAASkgB,EAAc1H,GAErB,IACE,OAAQA,GACN,IAAK,YACH,EAAAX,iBAAiBc,oBACjB,MACF,IAAK,aACH,EAAAd,iBAAiBe,qBACjB,MACF,IAAK,YACH,EAAAf,iBAAiBgB,oBAGvB,CAAE,MAAOlgB,GAKP,MAHAN,QAAQM,MAAM,GAAGulB,EAAWC,cAAc3F,QAAa7f,GAEvD6D,OAAO7D,MAAM,SAAS6f,oBAChB7f,CACR,CACF,CAgPA,MAAMwnB,EAAoB,IA5M1B,MASUC,aAA4B,GAyDpC,iBAAMC,CAAeC,EAAwBC,GAE3C,MAAMtoB,EA7FV,WAEE,IACE,OAAO,EAAA4f,iBAAiBne,iBAC1B,CAAE,MAAOf,GAKP,OAHAN,QAAQK,KAAK,GAAGwlB,EAAWC,mCAAoCxlB,GAE/D6D,OAAOkE,QAAQ,wBACR,WACT,CACF,CAkFyB8f,GAGrBpoB,KAAKgoB,aAAajiB,KAAKlG,GAEvB,MAAMwmB,EAAQrmB,KAAKgoB,aAAa9mB,OAMhC,GAHAilB,EAAOyB,cAAc5nB,KAAKgoB,cAGtBnoB,IAAiBqoB,GAAyB,IAAV7B,EAAa,CAE/CF,EAAOO,cAAcL,EAAO6B,GAE5B,MAAMzX,EAAY4X,YAAYzX,MAE9B,IACE,MAAM/I,QAAesgB,IAEfzN,EAAW2N,YAAYzX,MAAQH,EAGrC,OAFA0V,EAAOgB,mBAAmBd,EAAO3L,GAE1B7S,CACT,CAAE,MAAOtH,GAEP,MAAMma,EAAW2N,YAAYzX,MAAQH,EAGrC,MAFA0V,EAAOoB,iBAAiBlB,EAAO3L,EAAUna,GAEnCA,CACR,C,QAEEP,KAAKgoB,aAAaM,MAClBnC,EAAOyB,cAAc5nB,KAAKgoB,aAC5B,CACF,CAGA7B,EAAOY,SAASV,EAAOxmB,EAAcqoB,GAErC,MAAMzX,EAAY4X,YAAYzX,MAE9B,IAEEuV,EAAOC,eAAeC,EAAOxmB,EAAcqoB,GAE3CJ,EAAcI,GAEd/B,EAAOK,kBAAkBH,EAAO6B,GAGhC/B,EAAOwB,SAAStB,EAAO,QAAS,CAAE6B,cAAaK,cAAe,EAAA9I,iBAAiBne,oBAG/E,MAAMuG,QAAesgB,IAGfzN,EAAW2N,YAAYzX,MAAQH,EAGrC,OAFA0V,EAAOgB,mBAAmBd,EAAO3L,GAE1B7S,CACT,CAAE,MAAOtH,GAEP,MAAMma,EAAW2N,YAAYzX,MAAQH,EAGrC,MAFA0V,EAAOoB,iBAAiBlB,EAAO3L,EAAUna,GAEnCA,CACR,C,QAEE,MAAMioB,EAAexoB,KAAKgoB,aAAaM,MAEvC,GAAIE,EAAc,CAEhBrC,EAAOc,QAAQZ,EAAO6B,EAAaM,GAGnC,IAEErC,EAAOS,gBAAgBP,EAAO6B,EAAaM,GAE3CV,EAAcU,GAEdrC,EAAOW,mBAAmBT,EAAOmC,GAGjCrC,EAAOwB,SAAStB,EAAO,UAAW,CAAEmC,eAAcD,cAAe,EAAA9I,iBAAiBne,mBACpF,CAAE,MAAOmnB,GAEPtC,EAAOsB,iBAAiBpB,EAAO,OAAOmC,OAAmBC,GAGzD,IACEtC,EAAOuB,WAAWrB,EAAO,uBACzByB,EAAc,aACd3B,EAAOW,mBAAmBT,EAAO,aACjCjiB,OAAOkE,QAAQ,uBACjB,CAAE,MAAOC,GAEP4d,EAAOsB,iBAAiBpB,EAAO,YAAa9d,GAC5CnE,OAAO7D,MAAM,oBACf,CACF,CACF,MAEE4lB,EAAOsB,iBAAiBpB,EAAO,gBAIjCF,EAAOyB,cAAc5nB,KAAKgoB,aAC5B,CACF,CAoBA,aAAAU,GACE,OAAO1oB,KAAKgoB,aAAa9mB,MAC3B,GA0HK,MAAM4U,EAAiBiS,EAAkBE,YAAYU,KAAKZ,E,qEC5L1D,MAAMa,EAAmB,IA5VhC,MACUhpB,aAAc,EAKtB,gBAAMG,GACJ,GAAIC,KAAKJ,YAEP,YADAK,QAAQC,IAAI,6BAIdD,QAAQC,IAAI,+BAEZ,IAAI8f,QAAkBhgB,KAAK6oB,eAEtB7I,IAEHA,EAAY,CACV8I,gBAAiB,wBACjBC,UAAW,GACX5Y,SAAU,GACV6Y,YAAa,GACbC,oBAAqB,UAEjBjpB,KAAKkpB,cAAclJ,GACzB/f,QAAQC,IAAI,+BAGdF,KAAKJ,aAAc,EACnBK,QAAQC,IAAI,6BACd,CAKA,kBAAM2oB,GACJ,IAEE,OADgBxlB,aAAa,CAAErC,KAAM,WACrBmoB,gBAAoC,IACtD,CAAE,MAAO5oB,GAEP,OADAN,QAAQM,MAAM,+BAAgCA,GACvC,IACT,CACF,CAKA,mBAAM2oB,CAAclJ,GAClB,IAEE,MAAMoJ,GAAiB,IAAAta,OAAMkR,GAC7Bnc,wBAAwB,CAAEslB,eAAgBC,GAAkB,CAAEpoB,KAAM,WACpEf,QAAQC,IAAI,6BACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,+BAAgCA,GACxCA,CACR,CACF,CAKA,eAAM8oB,CAAUC,GACd,IACErpB,QAAQC,IAAI,iCAAkCopB,GAE9C,MAAMtJ,QAAkBhgB,KAAK6oB,eAC7B,IAAK7I,EACH,MAAM,IAAIrb,MAAM,WAIlB,MAAM4kB,EAAmC,CACvC3mB,GAAI5C,KAAKwpB,aACTF,SACAnW,SAAU,GACVsW,UAAW9Y,KAAKC,OAGlBoP,EAAUiJ,oBAAoBljB,KAAKwjB,SAC7BvpB,KAAKkpB,cAAclJ,GAIzB,MAAM,iBAAErgB,SAA2B,2CAC7BA,EAAiB0B,iCACvBpB,QAAQC,IAAI,sCAGNF,KAAK0pB,yBAAyBJ,GAEpCllB,OAAOI,QAAQ,OAAO8kB,EAAOpoB,mBAC/B,CAAE,MAAOX,GAGP,MAFAN,QAAQM,MAAM,gCAAiCA,GAC/C6D,OAAO7D,MAAM,aACPA,CACR,CACF,CAMQ,8BAAMmpB,CAAyBJ,GACrC,IACE,MAAMtJ,QAAkBhgB,KAAK6oB,eAC7B,IAAK7I,EACH,MAAM,IAAIrb,MAAM,WAIlB,IAAIglB,EAAoB,YACxBA,GAAqB,oBAAoB3pB,KAAK4pB,oBAAoB5J,SAGlE,IAAK,MAAM7a,KAASmkB,EAAQ,CAC1B,MAAMO,QAAqB,IAAsBC,mBAAmB3kB,GAChE0kB,IACFF,GAAqB,SAASxkB,cAC9BwkB,GAAqBE,EAAe,KAExC,CAGAE,cAAc,CACZ,CACEnnB,GAAI,oBACJsT,QAASyT,EACT7Q,SAAU,UACV+O,MAAO,EACP5R,KAAM,YAIVhW,QAAQC,IAAI,8BACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,gCAAiCA,GACzCA,CACR,CACF,CAKA,sBAAMypB,CAAiBte,GACrB,IACE,MAAMsU,QAAkBhgB,KAAK6oB,eAC7B,IAAK7I,EACH,MAAM,IAAIrb,MAAM,WAGlB,MAAM6G,EAAOxL,KAAKiqB,SAASjK,EAAWtU,GACtC,IAAKF,EACH,MAAO,SAGTvL,QAAQC,IAAI,4BAA6BsL,EAAKjI,MAG9C,MAAMwJ,QAAiB+I,eAAe,YAAa3S,UACjD,MAAM2D,EAAS,aAAa0E,EAAKjI,wBAEjC,aAAawS,YAAY,CACvBC,gBAAiB,CAAC,CAAEC,KAAM,OAAQC,QAASpP,QAK/C,OADA7G,QAAQC,IAAI,gCACL6M,CACT,CAAE,MAAOxM,GAEP,OADAN,QAAQM,MAAM,8BAA+BA,GACtC,YACT,CACF,CAKA,gBAAM0P,CAAWC,EAAkB4I,GACjC,IACE,MAAMkH,QAAkBhgB,KAAK6oB,eAC7B,IAAK7I,EACH,MAAM,IAAIrb,MAAM,WAGlBqb,EAAU7P,SAASpK,KAAK,CACtBmkB,UAAWha,EAAQtN,GACnBkW,WACAE,MAAO,UAGHhZ,KAAKkpB,cAAclJ,GACzB5b,OAAOI,QAAQ,IAAI0L,EAAQ3M,eAC3BtD,QAAQC,IAAI,6BAA8BgQ,EAAQ3M,KACpD,CAAE,MAAOhD,GAGP,MAFAN,QAAQM,MAAM,8BAA+BA,GAC7C6D,OAAO7D,MAAM,WACPA,CACR,CACF,CAKQ,mBAAAqpB,CAAoB5J,GAC1B,MAAM3U,EAAkB,GAQxB,OALAA,EAAMtF,QAAQia,EAAU+I,UAAUpoB,IAAIwpB,GAAKA,EAAE5mB,OAG7C8H,EAAMtF,QAAQia,EAAU7P,SAASxP,IAAIyP,GAAK,OAAOA,EAAE8Z,eAE9B,IAAjB7e,EAAMnK,OACD,gBAGF,MAAMmK,EAAM+e,MAAM,EAAG,GAAGzf,KAAK,OAAOU,EAAMnK,OAAS,EAAI,MAAQ,IACxE,CAKQ,QAAA+oB,CAASjK,EAA0BtU,GAEzC,MAAMqd,EAAY/I,EAAU+I,UAAUpc,KAAKwd,GAAKA,EAAEvnB,KAAO8I,GACzD,GAAIqd,EACF,MAAO,CAAExlB,KAAMwlB,EAAUxlB,MAI3B,MAAM2M,EAAU8P,EAAU7P,SAASxD,KAAKyD,GAAKA,EAAE8Z,YAAcxe,GAC7D,OAAIwE,EACK,CAAE3M,KAAM2M,EAAQga,WAGlB,IACT,CAOA,sBAAMG,CAAiBf,EAAkBnW,GACvC,IACE,MAAM6M,QAAkBhgB,KAAK6oB,eAC7B,IAAK7I,EACH,MAAM,IAAIrb,MAAM,WAIlB,MAAM2lB,EAAe,IAAIhB,GAAQiB,OAC3BC,EAAuBxK,EAAUiJ,oBAAoBtc,KAAK8d,IAC9D,MAAMC,EAAmB,IAAID,EAAKnB,QAAQiB,OAC1C,OAAOI,KAAKC,UAAUF,KAAsBC,KAAKC,UAAUN,KAG7D,GAAIE,EAEFA,EAAqBrX,SAAWA,EAChCqX,EAAqBK,QAAUla,KAAKC,MACpC3Q,QAAQC,IAAI,8BAA+BsqB,EAAqB5nB,QAC3D,CAEL,MAAMkoB,EAAsC,CAC1CloB,GAAI5C,KAAKwpB,aACTF,SACAnW,WACAsW,UAAW9Y,KAAKC,MAChBia,QAASla,KAAKC,OAEhBoP,EAAUiJ,oBAAoBljB,KAAK+kB,GACnC7qB,QAAQC,IAAI,+BAAgC4qB,EAAgBloB,GAC9D,OAEM5C,KAAKkpB,cAAclJ,GACzB/f,QAAQC,IAAI,6BACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,6BAA8BA,GACtCA,CACR,CACF,CAOA,4BAAMwqB,CAAuBzB,GAC3B,IACE,MAAMtJ,QAAkBhgB,KAAK6oB,eAC7B,IAAK7I,EACH,OAAO,KAIT,MAAMsK,EAAe,IAAIhB,GAAQiB,OAC3BhB,EAAevJ,EAAUiJ,oBAAoBtc,KAAK8d,IACtD,MAAMC,EAAmB,IAAID,EAAKnB,QAAQiB,OAC1C,OAAOI,KAAKC,UAAUF,KAAsBC,KAAKC,UAAUN,KAS7D,OANIf,EACFtpB,QAAQC,IAAI,6BAA8BqpB,EAAa3mB,GAAI,OAAQ2mB,EAAapW,SAASjS,QAEzFjB,QAAQC,IAAI,8BAGPqpB,GAAgB,IACzB,CAAE,MAAOhpB,GAEP,OADAN,QAAQM,MAAM,+BAAgCA,GACvC,IACT,CACF,CAKA,mBAAMyqB,GACJ,IACE/qB,QAAQC,IAAI,8BAIZ,MAAM,iBAAEP,SAA2B,2CAC7BA,EAAiBa,2BACvBP,QAAQC,IAAI,kCAEZkE,OAAOI,QAAQ,UACjB,CAAE,MAAOjE,GAGP,MAFAN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,UACPA,CACR,CACF,CAKQ,UAAAipB,GACN,MAAO,aAAa7Y,KAAKC,SAASzK,KAAKsQ,SAASC,SAAS,IAAI1J,UAAU,EAAG,KAC5E,E,4DCvWK,SAASwQ,EAAejd,GAM7B,MAAO,YALQA,EAAM0qB,OAAOtqB,IAAIuqB,GAEvB,OADMA,EAAMC,KAAKxgB,KAAK,MACP,UAAUugB,EAAMxjB,WAGdiD,KAAK,OACjC,C,6DC2PO,MAAMgL,EAAmB,IAjThC,MAIE,uBAAMyV,GACJ,IACEnrB,QAAQC,IAAI,2CAGN6c,sBAAsB,OAG5B,MAAMsO,EAA4B,CAChCC,sBAAuB,GACvBzN,UAAW,CAAC,EACZ0N,aAAc,CAAC,EACfC,WAAY,CAAC,GAGf,IAAIC,EAAe,EAGnB,IACE,MAAMC,EAAWvO,IAAIC,WAAW,CAAEpc,KAAM,UAAWqc,WAAY,IAC3DqO,GAAY1nB,OAAO/C,KAAKyqB,EAAS7N,WAAa,CAAC,GAAG3c,OAAS,UACvDic,IAAIW,eAAeuN,EAAc,CAAErqB,KAAM,UAAWqc,WAAY,IACtEoO,IACAxrB,QAAQC,IAAI,uCAEhB,CAAE,MAAOK,GACPN,QAAQK,KAAK,wCAAyCC,EACxD,CAGA,IACE,MAAM4S,EAAWC,gBAAgB,uBACjCnT,QAAQC,IAAI,yBAAyBiT,EAASjS,gBAG9C,IAAK,MAAMwG,KAAWyL,EAAU,CAC9B,MAAM8J,EAAYvV,EAAQ2V,WAC1B,IAEE,MAAMsO,EAAUxO,IAAIC,WAAW,CAAEpc,KAAM,UAAWqc,WAAYJ,IAE1D0O,GAAW3nB,OAAO/C,KAAK0qB,EAAQ9N,WAAa,CAAC,GAAG3c,OAAS,UAErDic,IAAIW,eAAeuN,EAAc,CAAErqB,KAAM,UAAWqc,WAAYJ,IACtEwO,IACAxrB,QAAQC,IAAI,2BAA2B+c,eAE3C,CAAE,MAAO1c,GACPN,QAAQK,KAAK,0BAA0B2c,iBAA0B1c,EACnE,CACF,CACF,CAAE,MAAOA,GACPN,QAAQC,IAAI,yCAA0CK,EACxD,CAEAN,QAAQC,IAAI,uCAAuCurB,QACrD,CAAE,MAAOlrB,GAEP,MADAN,QAAQM,MAAM,oCAAqCA,GAC7C,IAAIoE,MAAM,gBAAiBpE,EAAgBmH,UACnD,CACF,CAKA,0BAAMkkB,GACJ,IACE3rB,QAAQC,IAAI,kCAGZ,MAAM2rB,EAAmBxoB,aAAa,CAAErC,KAAM,WACxC8qB,EAAgB9nB,OAAO/C,KAAK4qB,GAClC5rB,QAAQC,IAAI,yBAAyB4rB,EAAc5qB,gBAAiB4qB,GAGpEC,iBAAiB,CAAC,EAAG,CAAE/qB,KAAM,WAE7Bf,QAAQC,IAAI,qCAAqC4rB,EAAc5qB,aACjE,CAAE,MAAOX,GAEP,MADAN,QAAQM,MAAM,iCAAkCA,GAC1C,IAAIoE,MAAM,aAAcpE,EAAgBmH,UAChD,CACF,CAKA,wBAAMskB,GACJ,IACE/rB,QAAQC,IAAI,kCAGZ,MAAM2rB,EAAmBxoB,aAAa,CAAErC,KAAM,SACxC8qB,EAAgB9nB,OAAO/C,KAAK4qB,GAClC5rB,QAAQC,IAAI,yBAAyB4rB,EAAc5qB,gBAAiB4qB,GAGpEC,iBAAiB,CAAC,EAAG,CAAE/qB,KAAM,SAE7Bf,QAAQC,IAAI,qCAAqC4rB,EAAc5qB,aACjE,CAAE,MAAOX,GAEP,MADAN,QAAQM,MAAM,iCAAkCA,GAC1C,IAAIoE,MAAM,aAAcpE,EAAgBmH,UAChD,CACF,CAKA,oBAAMukB,GACJ,IACEhsB,QAAQC,IAAI,gCAEZ,MAAMgsB,GAAiB,IAAA/gB,qBAGjBmB,EAAiB4f,EAAe9gB,mBAAmBC,MAAMnK,OACzDqL,EAAgB2f,EAAe5gB,kBAAkBD,MAAMnK,OAC7DjB,QAAQC,IAAI,iCAAiCoM,KAC7CrM,QAAQC,IAAI,+BAA+BqM,KAG3C2f,EAAevlB,cAGTulB,EAAepgB,eAErB7L,QAAQC,IAAI,mCAAmCoM,EAAiBC,QAClE,CAAE,MAAOhM,GAEP,MADAN,QAAQM,MAAM,+BAAgCA,GACxC,IAAIoE,MAAM,WAAYpE,EAAgBmH,UAC9C,CACF,CAMA,0BAAMykB,GACJ,IACElsB,QAAQC,IAAI,oCAGZ,MAAM2rB,EAAmBxoB,aAAa,CAAErC,KAAM,WAGxCorB,EAAgBP,EAAiBva,YACjC+a,EAAuBR,EAAiBna,mBAE9CzR,QAAQC,IAAI,6BAA8B,CACxCoR,YAAa8a,EACb1a,mBAAoB2a,EAAuB,GAAGA,EAAqBrf,UAAU,EAAG,cAAWlL,SAIxDA,IAAjC+pB,EAAiBva,oBACZua,EAAiBva,YACxBrR,QAAQC,IAAI,2CAA4CksB,IAExDnsB,QAAQC,IAAI,gDAI8B4B,IAAxC+pB,EAAiBna,2BACZma,EAAiBna,mBACxBzR,QAAQC,IAAI,qDAAsDmsB,GAAsBnrB,QAAU,IAElGjB,QAAQC,IAAI,kDAId6rB,iBAAiBF,EAAkB,CAAE7qB,KAAM,WAC3Cf,QAAQC,IAAI,gCAGZD,QAAQC,IAAI,qCAEZ,MAAM,qBAAEwS,SAA+B,sCACvCA,EAAqBiB,mBACrB1T,QAAQC,IAAI,mCAEZD,QAAQC,IAAI,oCACd,CAAE,MAAOK,GAKP,MAJAN,QAAQM,MAAM,mCAAoC,CAChDA,MAAQA,EAAgBmH,QACxBE,MAAQrH,EAAgBqH,QAEpB,IAAIjD,MAAM,eAAgBpE,EAAgBmH,UAClD,CACF,CAKA,2BAAMkO,GACJ,IACE3V,QAAQC,IAAI,qCAGZ,MAAM2rB,EAAmBxoB,aAAa,CAAErC,KAAM,WAE1C6qB,EAAiBS,YACnBrsB,QAAQC,IAAI,+CAGL2rB,EAAiBS,WACxBP,iBAAiBF,EAAkB,CAAE7qB,KAAM,WAE3Cf,QAAQC,IAAI,wCAEZD,QAAQC,IAAI,wCAEhB,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,oCAAqCA,GAC7C,IAAIoE,MAAM,gBAAiBpE,EAAgBmH,UACnD,CACF,CAMA,sBAAM6kB,GACJtsB,QAAQC,IAAI,uDAEZ,MAAMkS,EAAqD,GACrDoa,EAA0D,GAGhE,UACQxsB,KAAKmsB,uBACXK,EAAQzmB,KAAK,CAAE0mB,UAAW,OAAQjoB,SAAS,GAC7C,CAAE,MAAOjE,GACP6R,EAAOrM,KAAK,CAAE0mB,UAAW,OAAQlsB,MAAOA,IACxCisB,EAAQzmB,KAAK,CAAE0mB,UAAW,OAAQjoB,SAAS,IAC3CvE,QAAQM,MAAM,+BAAgCA,EAChD,CAGA,UACQP,KAAKorB,oBACXoB,EAAQzmB,KAAK,CAAE0mB,UAAW,SAAUjoB,SAAS,GAC/C,CAAE,MAAOjE,GACP6R,EAAOrM,KAAK,CAAE0mB,UAAW,SAAUlsB,MAAOA,IAC1CisB,EAAQzmB,KAAK,CAAE0mB,UAAW,SAAUjoB,SAAS,IAC7CvE,QAAQM,MAAM,kCAAmCA,EACnD,CAGA,UACQP,KAAK4rB,uBACXY,EAAQzmB,KAAK,CAAE0mB,UAAW,OAAQjoB,SAAS,GAC7C,CAAE,MAAOjE,GACP6R,EAAOrM,KAAK,CAAE0mB,UAAW,OAAQlsB,MAAOA,IACxCisB,EAAQzmB,KAAK,CAAE0mB,UAAW,OAAQjoB,SAAS,IAC3CvE,QAAQM,MAAM,+BAAgCA,EAChD,CAGA,UACQP,KAAKgsB,qBACXQ,EAAQzmB,KAAK,CAAE0mB,UAAW,OAAQjoB,SAAS,GAC7C,CAAE,MAAOjE,GACP6R,EAAOrM,KAAK,CAAE0mB,UAAW,OAAQlsB,MAAOA,IACxCisB,EAAQzmB,KAAK,CAAE0mB,UAAW,OAAQjoB,SAAS,IAC3CvE,QAAQM,MAAM,+BAAgCA,EAChD,CAGA,UACQP,KAAKisB,iBACXO,EAAQzmB,KAAK,CAAE0mB,UAAW,KAAMjoB,SAAS,GAC3C,CAAE,MAAOjE,GACP6R,EAAOrM,KAAK,CAAE0mB,UAAW,KAAMlsB,MAAOA,IACtCisB,EAAQzmB,KAAK,CAAE0mB,UAAW,KAAMjoB,SAAS,IACzCvE,QAAQM,MAAM,6BAA8BA,EAC9C,CAWA,GARAN,QAAQC,IAAI,mDACZD,QAAQC,IAAI,4BACZssB,EAAQtoB,QAAQ2D,IACd,MAAMtB,EAASsB,EAAOrD,QAAU,OAAS,OACzCvE,QAAQC,IAAI,wBAAwB2H,EAAO4kB,cAAclmB,OAIvD6L,EAAOlR,OAAS,EAAG,CACrB,MAAM+L,EAAemF,EAAOzR,IAAIqJ,GAAK,GAAGA,EAAEyiB,cAAcziB,EAAEzJ,MAAMmH,WAAWiD,KAAK,MAChF1K,QAAQM,MAAM,iCAAkC0M,GAChD7I,OAAOkE,QAAQ,cAAc2E,IAC/B,MACEhN,QAAQC,IAAI,sCACZkE,OAAOI,QAAQ,aAGjBvE,QAAQC,IAAI,8DACd,E,UCrTFf,EAAOC,QAAUgK,I,6CC6QV,MAAMsjB,EAAwB,IAvOrC,MACU9sB,aAAc,EACd+sB,WAAY,EAKpB,gBAAM5sB,GACJ,GAAIC,KAAKJ,YAEP,YADAK,QAAQC,IAAI,kCAIdD,QAAQC,IAAI,0CAGWF,KAAK4sB,wBAEpB5sB,KAAK6sB,aAAa,IAG1B7sB,KAAKJ,aAAc,EACnBK,QAAQC,IAAI,kCACd,CAKA,cAAA4sB,GACM9sB,KAAK2sB,UACP1sB,QAAQC,IAAI,kCAIdD,QAAQC,IAAI,yCAEZ6sB,QAAQC,cAAcC,4BAA6B9pB,MAAO+pB,EAAUC,KAClE,IACE,MAAM1O,EAAWyO,GAAY,SACvBltB,KAAKotB,oBAAoB3O,EACjC,CAAE,MAAOle,GACPN,QAAQM,MAAM,oCAAqCA,EACrD,IAGFP,KAAK2sB,WAAY,EACjB1sB,QAAQC,IAAI,iCACd,CAMQ,yBAAMktB,CAAoBlmB,GAChC,MAAMqC,EAAQ,mGACd,IAAIE,EACA4jB,EAAgB,EAEpB,KAAsC,QAA9B5jB,EAAQF,EAAM+jB,KAAKpmB,KAAiB,CAC1C,MAAO,CAAElG,EAAMmE,EAAO+E,GAAeT,EAE/BhD,EAAqB,CACzB7D,GAAI5C,KAAKwpB,aACTtf,YAAaA,EAAYmV,OACzBre,KAAMA,EACN2Y,UAAWhJ,KAAKC,MAChB2c,qBAAsBvtB,KAAKwtB,8BAGvBxtB,KAAKytB,eAAetoB,EAAOsB,GACjC4mB,GACF,CAEIA,EAAgB,GAClBptB,QAAQC,IAAI,+BAA+BmtB,UAE/C,CAKA,oBAAMI,CAAetoB,EAAesB,GAClC,MAAMinB,QAAiB1tB,KAAK4sB,iBAC5B,IAAIe,EAAUD,EAAS/gB,KAAK9C,GAAKA,EAAE1E,QAAUA,GAExCwoB,IAEHA,EAAU,CACRxoB,QACAG,cAAetF,KAAK4tB,WAAWzoB,GAC/B0oB,kBAAmB,EACnBC,SAAU,GACVC,gBAAiBpd,KAAKC,OAExB8c,EAAS3nB,KAAK4nB,IAIhBA,EAAQG,SAAS/nB,KAAKU,GACtBknB,EAAQI,gBAAkBpd,KAAKC,MAGZ,aAAfnK,EAAMzF,KACR2sB,EAAQE,kBAAoB1nB,KAAKE,IAAI,IAAKsnB,EAAQE,kBAAoB,GAC9C,aAAfpnB,EAAMzF,OACf2sB,EAAQE,kBAAoB1nB,KAAKC,KAAK,IAAKunB,EAAQE,kBAAoB,UAGnE7tB,KAAK6sB,aAAaa,GAExBztB,QAAQC,IACN,iCAAiCytB,EAAQroB,eAAemB,EAAMzF,iBAAiB2sB,EAAQE,oBAE3F,CAKA,oBAAMjB,GACJ,IACE,MACM/jB,EADgBxF,aAAa,CAAErC,KAAM,WAChBgtB,oBAC3B,OAAO1rB,MAAM2H,QAAQpB,GAAQA,EAAO,EACtC,CAAE,MAAOtI,GAEP,OADAN,QAAQM,MAAM,oCAAqCA,GAC5C,EACT,CACF,CAKA,gBAAM0tB,CAAW9oB,GAEf,aADuBnF,KAAK4sB,kBACZjgB,KAAK9C,GAAKA,EAAE1E,QAAUA,IAAU,IAClD,CAKQ,kBAAM0nB,CAAaa,GACzB,IAEE,MAAMQ,GAAgB,IAAApf,OAAM4e,SACtB7pB,wBAAwB,CAAEmqB,oBAAqBE,GAAiB,CAAEltB,KAAM,UAChF,CAAE,MAAOT,GAEP,MADAN,QAAQM,MAAM,oCAAqCA,GAC7CA,CACR,CACF,CAKQ,0BAAMitB,GACZ,IAGE,OADkBnqB,aAAa,CAAErC,KAAM,WACtBmtB,qBAAuB,SAC1C,CAAE,MAAO5tB,GAEP,OADAN,QAAQM,MAAM,wCAAyCA,GAChD,SACT,CACF,CAKQ,gBAAMqtB,CAAWzoB,GACvB,IAEE,MACMmJ,EADgBjL,aAAa,CAAErC,KAAM,WACXsN,WAAa,GAC7C,IAAK,MAAMO,KAAYvM,MAAM2H,QAAQqE,GAAaA,EAAY,GAAI,CAChE,MAAMvL,EAAM8L,EAASjL,YAAY+I,KAAMnC,GAAWA,EAAE9E,cAAgBP,GACpE,GAAIpC,EACF,OAAOA,EAAIuB,WAAWf,MAAQ4B,CAElC,CACA,OAAOA,CACT,CAAE,MAAO5E,GAEP,OADAN,QAAQM,MAAM,uCAAwCA,GAC/C4E,CACT,CACF,CAKA,wBAAM2kB,CAAmB3kB,GACvB,MAAMwoB,QAAgB3tB,KAAKiuB,WAAW9oB,GACtC,IAAKwoB,GAAuC,IAA5BA,EAAQG,SAAS5sB,OAC/B,MAAO,GAIT,MAAMktB,EAAiB,IAAIT,EAAQG,UAAUvD,KAAK,CAAC1gB,EAAGwkB,IAAMA,EAAE1U,UAAY9P,EAAE8P,WAAWyQ,MAAM,EAAG,GAEhG,IAAItjB,EAAS,kBACb,IAAK,MAAMwnB,KAAUF,EACnBtnB,GAAU,KAAKwnB,EAAOpkB,gBAMxB,OAHApD,GAAU,YAAY9G,KAAKuuB,2BAA2BZ,EAAQE,qBAC9D/mB,GAAU,uCAEHA,CACT,CAKQ,0BAAAynB,CAA2BC,GACjC,OAAIA,EAAQ,GAAW,OACnBA,EAAQ,GAAW,KACnBA,EAAQ,GAAW,KACnBA,GAAS,GAAW,KACpBA,GAAS,GAAW,KACpBA,GAAS,GAAW,KACjB,IACT,CAKQ,UAAAhF,GACN,MAAO,UAAU7Y,KAAKC,SAASzK,KAAKsQ,SAASC,SAAS,IAAI1J,UAAU,EAAG,KACzE,E,8CCsLK,MAAMyhB,EAAuB,IAvbpC,MAKE,oBAAMC,CAAeC,GACnB,IACE1uB,QAAQC,IAAI,0CAGZ,IA2BI6M,EA3BAjG,EAAS,2BAET6nB,IACF7nB,GAAU,QAAQ6nB,MAClB7nB,GAAU,UAAU6nB,iBAGtB7nB,GAAU,uQAqBV,IACEiG,QAAiBxF,SAAS,CACxBC,WAAYV,EACZK,eAAe,GAEnB,CAAE,MAAO5G,GAEP,MADAN,QAAQM,MAAM,sCAAuCA,GAC/C,IAAIoE,MAAM,wBAClB,CAGA,MAAMiqB,EAAY7hB,EAAStD,MAAM,4BACjC,IAAKmlB,EAEH,MADA3uB,QAAQM,MAAM,yCAA0CwM,GAClD,IAAIpI,MAAM,oBAGlB,IAAIkqB,EACJ,IACEA,EAAUlE,KAAKjhB,MAAMklB,EAAU,GACjC,CAAE,MAAOruB,GAEP,MADAN,QAAQM,MAAM,sCAAuCA,GAC/C,IAAIoE,MAAM,uBAClB,CAGA,IAAKkqB,EAAQtrB,OAASsrB,EAAQ7nB,WAE5B,MADA/G,QAAQM,MAAM,yCAA0CsuB,GAClD,IAAIlqB,MAAM,wBAIlB,MAAM5B,QAAY/C,KAAK8uB,2BAA2B,CAChDvrB,KAAMsrB,EAAQtrB,KACdwD,IAAK8nB,EAAQ9nB,IACbC,WAAY6nB,EAAQ7nB,WACpBC,WAAY4nB,EAAQ5nB,WACpB8nB,YAAaF,EAAQE,cASvB,OALIF,EAAQpW,eACV1V,EAAI0V,aAAeoW,EAAQpW,cAG7BxY,QAAQC,IAAI,qCAAsC6C,EAAIQ,MAC/CR,CACT,CAAE,MAAOxC,GAGP,MAFAN,QAAQM,MAAM,wCAAyCA,GAEjDA,CACR,CACF,CAOA,oBAAMyuB,CAAe7U,EAAsBwU,GACzC,IACE1uB,QAAQC,IAAI,2CAGZ,IAyBI6M,EAzBAjG,EAAS,0BAA0BqT,QAEnCwU,IACF7nB,GAAU,QAAQ6nB,OAGpB7nB,GAAU,gQAoBV,IACEiG,QAAiBxF,SAAS,CACxBC,WAAYV,EACZK,eAAe,GAEnB,CAAE,MAAO5G,GAEP,MADAN,QAAQM,MAAM,sCAAuCA,GAC/C,IAAIoE,MAAM,wBAClB,CAGA,MAAMiqB,EAAY7hB,EAAStD,MAAM,4BACjC,IAAKmlB,EAEH,MADA3uB,QAAQM,MAAM,yCAA0CwM,GAClD,IAAIpI,MAAM,oBAGlB,IAAIkqB,EACJ,IACEA,EAAUlE,KAAKjhB,MAAMklB,EAAU,GACjC,CAAE,MAAOruB,GAEP,MADAN,QAAQM,MAAM,sCAAuCA,GAC/C,IAAIoE,MAAM,uBAClB,CAGA,IAAKkqB,EAAQtrB,OAASsrB,EAAQ7nB,WAE5B,MADA/G,QAAQM,MAAM,yCAA0CsuB,GAClD,IAAIlqB,MAAM,wBAIlB,MAAM5B,QAAY/C,KAAK8uB,2BAA2B,CAChDvrB,KAAMsrB,EAAQtrB,KACdwD,IAAK8nB,EAAQ9nB,IACbC,WAAY6nB,EAAQ7nB,WACpBC,WAAY4nB,EAAQ5nB,WACpB8nB,YAAaF,EAAQE,cASvB,OALIF,EAAQpW,eACV1V,EAAI0V,aAAeoW,EAAQpW,cAG7BxY,QAAQC,IAAI,yCAA0C6C,EAAIQ,MACnDR,CACT,CAAE,MAAOxC,GAGP,MAFAN,QAAQM,MAAM,yCAA0CA,GAElDA,CACR,CACF,CAQA,wBAAM0uB,CAAmBN,EAAsBtkB,GAC7C,IACEpK,QAAQC,IAAI,yCAGZ,MAAMgvB,EAAc7kB,EACjB1J,IACCoC,GACE,KAAKA,EAAIQ,QAAQR,EAAIiE,YAAc,WAAWjE,EAAIkE,YAAY+F,UAAU,EAAG,MAAQ,WAEtFrC,KAAK,MAGR,IAsBIoC,EAtBAjG,EAAS,0BAA0BooB,QACvCpoB,GAAU,QAAQ6nB,QAClB7nB,GAAU,2DACVA,GAAU,wRAgBV6nB,MAIA,IACE5hB,QAAiBxF,SAAS,CACxBC,WAAYV,EACZK,eAAe,GAEnB,CAAE,MAAO5G,GAEP,MADAN,QAAQM,MAAM,sCAAuCA,GAC/C,IAAIoE,MAAM,wBAClB,CAGA,MAAMiqB,EAAY7hB,EAAStD,MAAM,4BACjC,IAAKmlB,EAEH,MADA3uB,QAAQM,MAAM,yCAA0CwM,GAClD,IAAIpI,MAAM,oBAGlB,IAAIkqB,EACJ,IACEA,EAAUlE,KAAKjhB,MAAMklB,EAAU,GACjC,CAAE,MAAOruB,GAEP,MADAN,QAAQM,MAAM,sCAAuCA,GAC/C,IAAIoE,MAAM,uBAClB,CAGA,IAAKkqB,EAAQtrB,OAASsrB,EAAQ7nB,WAE5B,MADA/G,QAAQM,MAAM,yCAA0CsuB,GAClD,IAAIlqB,MAAM,wBAIlB,MAAM5B,QAAY/C,KAAK8uB,2BAA2B,CAChDvrB,KAAMsrB,EAAQtrB,KACdwD,IAAK8nB,EAAQ9nB,IACbC,WAAY6nB,EAAQ7nB,WACpBC,WAAY4nB,EAAQ5nB,WACpB8nB,YAAaF,EAAQE,cAOvB,OAHAhsB,EAAI0V,aAAeoW,EAAQpW,aAE3BxY,QAAQC,IAAI,sCAAuC6C,EAAIQ,MAChDR,CACT,CAAE,MAAOxC,GAGP,MAFAN,QAAQM,MAAM,sCAAuCA,GAE/CA,CACR,CACF,CAOA,gCAAMuuB,CAA2BK,GAO/B,IACElvB,QAAQC,IAAI,+CAGZ,MAAM0E,GAAa,IAAA0f,4BACnBrkB,QAAQC,IAAI,kCAAmC0E,GAG/C,MAAME,GAAe,IAAAuf,uBAAsBzf,GAC3C3E,QAAQC,IAAI,oCAAqC4E,GAGjD,MAAM2Q,QAAezV,KAAKovB,4BAA4BD,EAAUnoB,YAChE/G,QAAQC,IAAI,oCAAqCuV,EAAO/S,MAGxD,MAAMK,EAAoB,CACxBH,GAAI,OAAO+N,KAAKC,SAASzK,KAAKsQ,SAASC,SAAS,IAAI1J,UAAU,EAAG,KACjEhM,KAAM,MACNuC,KAAM4rB,EAAU5rB,KAChBwD,IAAKooB,EAAUpoB,IACfC,WAAYmoB,EAAUnoB,WACtBC,WAAYkoB,EAAUloB,WACtBrC,aACAE,eACA2Q,SACA1Q,UAAW/E,KAAKqvB,2BAChBtjB,UAAW,GACX3G,UAAW,GACXnC,aAAa,EACbyD,OAAQ,IAIV,OADAzG,QAAQC,IAAI,sCAAuC6C,EAAIQ,MAChDR,CACT,CAAE,MAAOxC,GAEP,MADAN,QAAQM,MAAM,sCAAuCA,GAC/C,IAAIoE,MAAM,YAClB,CACF,CAOQ,iCAAMyqB,CAA4BpoB,GACxC,MAAMyO,EAAS,IAAIzT,IAgBnB,GAbmB,CACjB,CAAEuB,KAAM,KAAMnB,MAAO,IACrB,CAAEmB,KAAM,KAAMnB,MAAO,IACrB,CAAEmB,KAAM,QAASnB,MAAO,IACxB,CAAEmB,KAAM,KAAMnB,MAAO,IACrB,CAAEmB,KAAM,KAAMnB,MAAO+D,KAAK+c,OAAM,IAAAoB,4BAA2B7P,IAAM,KAGxDvQ,QAAQqW,IACjB9E,EAAOtR,IAAIoW,EAAMhX,KAAMgX,EAAMnY,SAI3B4E,EACF,IACE,MAAMF,EAAS,QAAQE,8MAqBjB4nB,SALiBrnB,SAAS,CAC9BC,WAAYV,EACZK,eAAe,KAGUsC,MAAM,4BACjC,GAAImlB,EAAW,CACb,MAAMU,EAAY3E,KAAKjhB,MAAMklB,EAAU,IACnCU,EAAU7Z,QAAUnT,MAAM2H,QAAQqlB,EAAU7Z,SAC9C6Z,EAAU7Z,OAAOvR,QAASqW,IACnB9E,EAAOxM,IAAIsR,EAAMhX,OACpBkS,EAAOtR,IAAIoW,EAAMhX,KAAMgX,EAAMnY,QAIrC,CACF,CAAE,MAAO7B,GACPN,QAAQK,KAAK,4CAA6CC,EAC5D,CAGF,OAAOkV,CACT,CAKQ,wBAAA4Z,GACN,MAAO,CACL,CACEzsB,GAAI,OACJW,KAAM,KACNiU,OAAQ,EACRC,QAAS,IAEX,CACE7U,GAAI,QACJW,KAAM,KACNiU,OAAQ,EACRC,QAAS,IAEX,CACE7U,GAAI,WACJW,KAAM,KACNiU,OAAQ,EACRC,QAAS,IAEX,CACE7U,GAAI,YACJW,KAAM,KACNiU,OAAQ,EACRC,QAAS,IAEX,CACE7U,GAAI,WACJW,KAAM,KACNiU,OAAQ,EACRC,QAAS,IAEX,CACE7U,GAAI,YACJW,KAAM,KACNiU,OAAQ,EACRC,QAAS,IAGf,E,cCvbFrY,EAAQ,EAAU,CAACmwB,EAAKC,KACpB,MAAMC,EAASF,EAAIG,WAAaH,EAChC,IAAK,MAAOvO,EAAK7I,KAAQqX,EACrBC,EAAOzO,GAAO7I,EAElB,OAAOsX,E,4DCKCE,E,mBAAZ,SAAYA,GACV,kDACA,4BACA,gCACA,+BACD,CALD,CAAYA,IAAAA,EAAsB,KAkkB3B,MAAMtM,EAA2B,IAniBxC,MAYU,kBAAAuM,CAAmBC,GAEzB,OAAKA,EAMW,cAAZA,GAA2BA,EAAQ/pB,SAAS,OAC9C7F,QAAQC,IAAI,0DACL,aAIO,cAAZ2vB,GAA2BA,EAAQ/pB,SAAS,SAAW+pB,EAAQ/pB,SAAS,OAC1E7F,QAAQC,IAAI,4DACL,cAITD,QAAQC,IAAI,sCAAsC2vB,wBAC3C,eAlBL5vB,QAAQC,IAAI,uDACL,aAkBX,CAQA,iBAAAojB,CAAkBtJ,IACZA,EAAa,GAAKA,EAAa,KACjC/Z,QAAQK,KAAK,sDACb0Z,EAAa,GAKf,MACMzJ,EAAQyJ,EADU7T,KAAK+c,MAAsB,EAAhB/c,KAAKsQ,UAIxC,OADAxW,QAAQC,IAAI,mCAAmC8Z,gBAAyBzJ,KACjEA,CACT,CAOQ,aAAAuf,CAAcvvB,GACpB,MAAM0M,EAAe1M,EAAMmH,QAAQqoB,cAEnC,OAAI9iB,EAAanH,SAAS,OAASmH,EAAanH,SAAS,YAAcmH,EAAanH,SAAS,eACpF6pB,EAAuBK,uBAG5B/iB,EAAanH,SAAS,UAAYmH,EAAanH,SAAS,SAAWmH,EAAanH,SAAS,UACpF6pB,EAAuBM,YAG5BhjB,EAAanH,SAAS,YAAcmH,EAAanH,SAAS,YAAcmH,EAAanH,SAAS,SACzF6pB,EAAuBO,cAGzBP,EAAuBQ,aAChC,CAOQ,2BAAAC,CAA4BC,GAClC,OAAQA,GACN,KAAKV,EAAuBK,uBAC1B,MAAO,0BACT,KAAKL,EAAuBM,YAC1B,MAAO,mBACT,KAAKN,EAAuBO,cAC1B,MAAO,iBACT,KAAKP,EAAuBQ,cAC1B,MAAO,WACT,QACE,MAAO,OAEb,CAQQ,8BAAMG,CAAyB3B,GACrC1uB,QAAQC,IAAI,kDAGZ,MAAM,yBAAEokB,EAAwB,sBAAED,SAAgC,sCAG5Dzf,EAAa0f,IACbxf,EAAeuf,EAAsBzf,GAGrC2rB,EAAc,CAAC,MAAO,KAAM,KAAM,KAAM,KAAM,KAAM,MAAO,OAC3DvpB,EAAaupB,EAAYpqB,KAAK+c,MAAM/c,KAAKsQ,SAAW8Z,EAAYrvB,SAGhEuU,EAAS,IAAIzT,IACnByT,EAAOtR,IAAI,KAAM,IACjBsR,EAAOtR,IAAI,KAAM,IACjBsR,EAAOtR,IAAI,QAAS,IACpBsR,EAAOtR,IAAI,KAAM,IACjBsR,EAAOtR,IAAI,KAAMgC,KAAK+c,MAAMte,EAAW6P,IAAM,IAG7C,MAUM1R,EAAoB,CACxBH,GAAI,OAAO+N,KAAKC,SAASzK,KAAKsQ,SAASC,SAAS,IAAI1J,UAAU,EAAG,KACjEhM,KAAM,MACNuC,KAAM,GAAGyD,IAAab,KAAK+c,MAAsB,IAAhB/c,KAAKsQ,YACtC1P,IAAKZ,KAAK+c,MAAsB,GAAhB/c,KAAKsQ,UAAiB,GACtCzP,aACAC,WAAY,QAAQD,MAAe2nB,iBACnC/pB,aACAE,eACA2Q,SACA1Q,UApBgB,CAChB,CAAEnC,GAAI,OAAQW,KAAM,KAAMiU,OAAQ,EAAGC,QAAS,IAC9C,CAAE7U,GAAI,QAASW,KAAM,KAAMiU,OAAQ,EAAGC,QAAS,IAC/C,CAAE7U,GAAI,WAAYW,KAAM,KAAMiU,OAAQ,EAAGC,QAAS,IAClD,CAAE7U,GAAI,YAAaW,KAAM,KAAMiU,OAAQ,EAAGC,QAAS,IACnD,CAAE7U,GAAI,WAAYW,KAAM,KAAMiU,OAAQ,EAAGC,QAAS,IAClD,CAAE7U,GAAI,YAAaW,KAAM,KAAMiU,OAAQ,EAAGC,QAAS,KAenD1L,UAAW,GACX3G,UAAW,GACXnC,aAAa,EACbyD,OAAQ,IAIV,OADAzG,QAAQC,IAAI,4CAA6C6C,EAAIQ,MACtDR,CACT,CAUA,wBAAMwgB,CACJhT,EACAoe,EACA6B,EACAC,GAEAxwB,QAAQC,IAAI,uCAAuCqQ,gBACnDtQ,QAAQC,IAAI,sCAAsCyuB,KAG9B3uB,KAAK4vB,mBAAmBjB,GAA5C,MAEMnC,EAA0B,GAC1Bpa,EAA+B,GACrC,IAAIse,EAAsB,EAI1B,IAAK,IAAIlnB,EAAI,EAAGA,EAAI+G,EAAO/G,IACzB,IACEvJ,QAAQC,IAAI,sCAAsCsJ,EAAI,KAAK+G,cAGvDkgB,GACFA,EAAWjnB,EAAI,EAAG+G,GAKpB,MAAMxN,QAAY,QAAe,YAAaI,eAC/B,EAAAwtB,EAAqBjC,eAAeC,IAGnDnC,EAAQzmB,KAAKhD,GACb2tB,EAAsB,EAEtBzwB,QAAQC,IAAI,oCAAoCsJ,EAAI,iBAAiBzG,EAAIQ,OAC3E,CAAE,MAAOhD,GAEP,MAAMqwB,EAAMrwB,EACN8vB,EAAYrwB,KAAK8vB,cAAcc,GAarC,GAZAF,IAEAzwB,QAAQM,MAAM,oCAAoCiJ,EAAI,gBAAiBjJ,GAEvE6R,EAAOrM,KAAK,CACV/E,KAAMqvB,EACN3oB,QAAS1H,KAAKowB,4BAA4BC,GAC1CQ,cAAeD,EACfjlB,MAAOnC,EAAI,IAITknB,GAtCyB,EAsCwB,CACnDzwB,QAAQK,KAAK,qCAAqCowB,mBAClDtsB,OAAOkE,QAAQ,2BAA4B,SAAU,CAAE8L,QAAS,MAEhE,IACE,MAAM0c,QAAoB9wB,KAAKswB,yBAAyB3B,GACxDnC,EAAQzmB,KAAK+qB,GACbJ,EAAsB,EACtBzwB,QAAQC,IAAI,8CAA8C4wB,EAAYvtB,OACxE,CAAE,MAAOgF,GACPtI,QAAQM,MAAM,yCAA0CgI,EAE1D,CACF,CACF,CAOF,GAHAtI,QAAQC,IAAI,yCAAyCssB,EAAQtrB,UAAUqP,KAGhD,IAAnBic,EAAQtrB,QAAgBkR,EAAOlR,OAAS,EAAG,CAC7C,MAAM+L,EAAe,cACrBhN,QAAQM,MAAM,gCAAgC0M,KAG9C,MAAM8jB,EAAa,IAAIC,IAAI5e,EAAOzR,IAAIqJ,GAAKA,EAAEhJ,OAC7C,IAAIiwB,EAAa,GAejB,MAZEA,EADEF,EAAW9nB,IAAI0mB,EAAuBK,wBAC3B,mBACJe,EAAW9nB,IAAI0mB,EAAuBO,eAClC,UAEA,YAGf9rB,OAAO7D,MAAM,GAAG0M,KAAgBgkB,IAAc,WAAY,CACxD7c,QAAS,IACT8c,aAAa,IAGT,IAAIvsB,MAAMsI,EAClB,CAGA,GAAImF,EAAOlR,OAAS,EAAG,CACrB,MAAMiwB,EAAiB,GAAG/e,EAAOlR,2BAA2BsrB,EAAQtrB,WACpEjB,QAAQK,KAAK,gCAAgC6wB,KAG7C,MAAMC,EAAkB,IAAIpvB,IAC5BoQ,EAAOlO,QAAQ3D,IACb6wB,EAAgBjtB,IAAI5D,EAAMS,MAAOowB,EAAgBvuB,IAAItC,EAAMS,OAAS,GAAK,KAI3E,IAAIqwB,EAAkBF,EACtB,GAAIC,EAAgB1uB,KAAO,EAAG,CAC5B,MAAM4uB,EAAehvB,MAAMC,KAAK6uB,EAAgBntB,WAC7CtD,IAAI,EAAEK,EAAMuP,KAAW,GAAGvQ,KAAKowB,4BAA4BpvB,OAAUuP,OACrE5F,KAAK,KACR0mB,GAAmB,QAAQC,GAC7B,CAEAltB,OAAOkE,QAAQ+oB,EAAiB,SAAU,CACxCjd,QAAS,IACT8c,aAAa,GAEjB,MAEE9sB,OAAOI,QAAQ,QAAQgoB,EAAQtrB,eAAgB,SAAU,CAAEkT,QAAS,MAItE,OADAnU,QAAQC,IAAI,4CAA4CssB,EAAQtrB,gBACzDsrB,CACT,CAQA,sBAAM+E,CAAiBrnB,EAAqBykB,GAC1C1uB,QAAQC,IAAI,+CACZD,QAAQC,IAAI,mCAAoCgK,GAG5BlK,KAAK4vB,mBAAmBjB,GAE5C,IAGE,MAAM5rB,QAAY,QAAe,YAAaI,eAC/B,EAAAwtB,EAAqB3B,eAAe9kB,EAAaykB,IAKhE,OAFA1uB,QAAQC,IAAI,0CAA2C6C,EAAIQ,MAC3Da,OAAOI,QAAQ,YAAYzB,EAAIQ,OAAQ,SAAU,CAAE6Q,QAAS,MACrDrR,CACT,CAAE,MAAOxC,GACP,MAAMqwB,EAAMrwB,EACN8vB,EAAYrwB,KAAK8vB,cAAcc,GAErC3wB,QAAQM,MAAM,0CAA2CA,GAGzD,MAAM0M,EAAejN,KAAKowB,4BAA4BC,GAetD,MAdAjsB,OAAO7D,MAAM,QAAQ0M,IAAgB,SAAU,CAC7CmH,QAAS,IACT8c,aAAa,IAIXb,IAAcV,EAAuBK,yBACvC/vB,QAAQC,IAAI,mDACZkE,OAAOoB,KAAK,wBAAyB,SAAU,CAC7C4O,QAAS,IACT8c,aAAa,KAIX,IAAIvsB,MAAMsI,EAClB,CACF,CAOA,0BAAMukB,GAGJ,OAFAvxB,QAAQC,IAAI,4CAEL,IAAIuxB,QAA6BC,IAEtC,MAAMC,EAAiBrtB,IACrBrE,QAAQC,IAAI,uCAAwCoE,EAAUf,MAE9DquB,oBAAoB,kCAAmCD,GACvDC,oBAAoB,kCAAmCC,GACvDH,EAAQptB,IAGJutB,EAAkB,KACtB5xB,QAAQC,IAAI,wCAEZ0xB,oBAAoB,kCAAmCD,GACvDC,oBAAoB,kCAAmCC,GACvDH,EAAQ,OAIV3E,QAAQ,kCAAmC4E,GAC3C5E,QAAQ,kCAAmC8E,GAG3C5xB,QAAQC,IAAI,sEACZqT,UAAU,oCAEd,CAUA,0BAAMue,CACJ9X,EACA2U,EACAoD,EACAtB,GAEAxwB,QAAQC,IAAI,gDACZD,QAAQC,IAAI,8CAA+C6xB,EAAW7wB,QAGtE,MAAMsL,EAAaxM,KAAKsjB,kBAAkBtJ,GACpCgY,EAAcxlB,EAAaulB,EAAW7wB,OAM5C,GAJAjB,QAAQC,IACN,oCAAoCsM,WAAoBulB,EAAW7wB,gBAAgB8wB,KAGjFA,GAAe,EAGjB,OAFA/xB,QAAQC,IAAI,6CACZkE,OAAOoB,KAAK,4BAA6B,WAAY,CAAE4O,QAAS,MACzD,GAGT,MAAMoY,EAA0B,GAC1Bpa,EAA+B,GACrC,IAAIse,EAAsB,EAC1B,MAGMuB,EAAgBF,EAAW7wB,OAAS,EAGtBlB,KAAK4vB,mBAAmBjB,GAE5C,IAAK,IAAInlB,EAAI,EAAGA,EAAIwoB,EAAaxoB,IAC/B,IACEvJ,QAAQC,IAAI,sCAAsCsJ,EAAI,KAAKwoB,gBAGvDvB,GACFA,EAAWjnB,EAAI,EAAGwoB,GAKpB,MAAMjvB,QAAY,QAAe,YAAaI,SAExC8uB,GACFhyB,QAAQC,IAAI,0DACC,EAAAywB,EAAqB1B,mBAAmBN,EAAcoD,UAGtD,EAAApB,EAAqBjC,eAAeC,IAIrDnC,EAAQzmB,KAAKhD,GACb2tB,EAAsB,EACtBzwB,QAAQC,IAAI,oCAAoCsJ,EAAI,iBAAiBzG,EAAIQ,OAC3E,CAAE,MAAOhD,GAEP,MAAMqwB,EAAMrwB,EACN8vB,EAAYrwB,KAAK8vB,cAAcc,GAarC,GAZAF,IAEAzwB,QAAQM,MAAM,oCAAoCiJ,EAAI,gBAAiBjJ,GAEvE6R,EAAOrM,KAAK,CACV/E,KAAMqvB,EACN3oB,QAAS1H,KAAKowB,4BAA4BC,GAC1CQ,cAAeD,EACfjlB,MAAOnC,EAAI,IAITknB,GAjDyB,EAiDwB,CACnDzwB,QAAQK,KAAK,qCAAqCowB,mBAClDtsB,OAAOkE,QAAQ,2BAA4B,WAAY,CAAE8L,QAAS,MAElE,IACE,MAAM0c,QAAoB9wB,KAAKswB,yBAAyB3B,GACxDnC,EAAQzmB,KAAK+qB,GACbJ,EAAsB,EACtBzwB,QAAQC,IAAI,8CAA8C4wB,EAAYvtB,OACxE,CAAE,MAAOgF,GACPtI,QAAQM,MAAM,yCAA0CgI,EAE1D,CACF,CACF,CAOF,GAHAtI,QAAQC,IAAI,2CAA2CssB,EAAQtrB,UAAU8wB,KAGlD,IAAnBxF,EAAQtrB,QAAgBkR,EAAOlR,OAAS,EAAG,CAC7C,MAAM+L,EAAe,kBACrBhN,QAAQM,MAAM,gCAAgC0M,KAG9C,MAAM8jB,EAAa,IAAIC,IAAI5e,EAAOzR,IAAIqJ,GAAKA,EAAEhJ,OAC7C,IAAIiwB,EAAa,GAejB,MAZEA,EADEF,EAAW9nB,IAAI0mB,EAAuBK,wBAC3B,mBACJe,EAAW9nB,IAAI0mB,EAAuBO,eAClC,UAEA,wBAGf9rB,OAAO7D,MAAM,GAAG0M,KAAgBgkB,IAAc,aAAc,CAC1D7c,QAAS,IACT8c,aAAa,IAGT,IAAIvsB,MAAMsI,EAClB,CAGA,GAAImF,EAAOlR,OAAS,EAAG,CACrB,MAAMiwB,EAAiB,GAAG/e,EAAOlR,6BAA6BsrB,EAAQtrB,WACtEjB,QAAQK,KAAK,gCAAgC6wB,KAG7C,MAAMC,EAAkB,IAAIpvB,IAC5BoQ,EAAOlO,QAAQ3D,IACb6wB,EAAgBjtB,IAAI5D,EAAMS,MAAOowB,EAAgBvuB,IAAItC,EAAMS,OAAS,GAAK,KAI3E,IAAIqwB,EAAkBF,EACtB,GAAIC,EAAgB1uB,KAAO,EAAG,CAI5B2uB,GAAmB,QAHE/uB,MAAMC,KAAK6uB,EAAgBntB,WAC7CtD,IAAI,EAAEK,EAAMuP,KAAW,GAAGvQ,KAAKowB,4BAA4BpvB,OAAUuP,OACrE5F,KAAK,MAEV,CAEAvG,OAAOkE,QAAQ+oB,EAAiB,WAAY,CAC1Cjd,QAAS,IACT8c,aAAa,GAEjB,MAEE9sB,OAAOI,QAAQ,UAAUgoB,EAAQtrB,iBAAkB,WAAY,CAAEkT,QAAS,MAI5E,OADAnU,QAAQC,IAAI,6CAA6CssB,EAAQtrB,kBAC1DsrB,CACT,E,GC3kBE0F,EAA2B,CAAC,EAGhC,SAAS3yB,EAAoB4yB,GAE5B,IAAIC,EAAeF,EAAyBC,GAC5C,QAAqBrwB,IAAjBswB,EACH,OAAOA,EAAahzB,QAGrB,IAAID,EAAS+yB,EAAyBC,GAAY,CAGjD/yB,QAAS,CAAC,GAOX,OAHAizB,EAAoBF,GAAUhzB,EAAQA,EAAOC,QAASG,GAG/CJ,EAAOC,OACf,CCrBAG,EAAoBoxB,EAAKxxB,IACxB,IAAImzB,EAASnzB,GAAUA,EAAOozB,WAC7B,IAAOpzB,EAAiB,QACxB,IAAM,EAEP,OADAI,EAAoBC,EAAE8yB,EAAQ,CAAEzoB,EAAGyoB,IAC5BA,GjCNJpzB,EAAW8E,OAAOwuB,eAAkBC,GAASzuB,OAAOwuB,eAAeC,GAASA,GAASA,EAAa,UAQtGlzB,EAAoBmzB,EAAI,SAAStwB,EAAOwa,GAEvC,GADU,EAAPA,IAAUxa,EAAQpC,KAAKoC,IAChB,EAAPwa,EAAU,OAAOxa,EACpB,GAAoB,iBAAVA,GAAsBA,EAAO,CACtC,GAAW,EAAPwa,GAAaxa,EAAMmwB,WAAY,OAAOnwB,EAC1C,GAAW,GAAPwa,GAAoC,mBAAfxa,EAAMuwB,KAAqB,OAAOvwB,CAC5D,CACA,IAAIwwB,EAAK5uB,OAAO6uB,OAAO,MACvBtzB,EAAoBuzB,EAAEF,GACtB,IAAIG,EAAM,CAAC,EACX9zB,EAAiBA,GAAkB,CAAC,KAAMC,EAAS,CAAC,GAAIA,EAAS,IAAKA,EAASA,IAC/E,IAAI,IAAIskB,EAAiB,EAAP5G,GAAYxa,GAA0B,iBAAXohB,GAAyC,mBAAXA,MAA4BvkB,EAAe+zB,QAAQxP,GAAUA,EAAUtkB,EAASskB,GAC1Jxf,OAAOivB,oBAAoBzP,GAAStf,QAAS8c,GAAS+R,EAAI/R,GAAO,IAAO5e,EAAM4e,IAI/E,OAFA+R,EAAa,QAAI,IAAM,EACvBxzB,EAAoBC,EAAEozB,EAAIG,GACnBH,CACR,EkCxBArzB,EAAoBC,EAAI,CAACJ,EAAS8zB,KACjC,IAAI,IAAIlS,KAAOkS,EACX3zB,EAAoB4zB,EAAED,EAAYlS,KAASzhB,EAAoB4zB,EAAE/zB,EAAS4hB,IAC5Ehd,OAAOgQ,eAAe5U,EAAS4hB,EAAK,CAAEoS,YAAY,EAAMvwB,IAAKqwB,EAAWlS,MCJ3EzhB,EAAoB4zB,EAAI,CAACV,EAAKY,IAAUrvB,OAAOsvB,UAAUC,eAAeC,KAAKf,EAAKY,GCClF9zB,EAAoBuzB,EAAK1zB,IACH,oBAAXq0B,QAA0BA,OAAOC,aAC1C1vB,OAAOgQ,eAAe5U,EAASq0B,OAAOC,YAAa,CAAEtxB,MAAO,WAE7D4B,OAAOgQ,eAAe5U,EAAS,aAAc,CAAEgD,OAAO,K,wDCwVhD,MAAMuxB,EAAgB,IA1U7B,MACUC,UAAkC,CAAC,EACnCC,cAAwB,GAKhC,UAAA9zB,GACEC,KAAK6zB,cAAgB7zB,KAAK8zB,mBAC1B7zB,QAAQC,IAAI,kCAAmCF,KAAK6zB,cACtD,CAOA,gBAAAC,GACE,IACE,MAAMC,EAASxmB,YAAYumB,mBAC3B,OAAKC,IACH9zB,QAAQK,KAAK,8BACN,GAGX,CAAE,MAAOC,GAEP,OADAN,QAAQM,MAAM,iCAAkCA,GACzC,EACT,CACF,CAKA,qBAAAyzB,GACE,IAEE,OAAOzmB,YAAY7H,aAAe,EACpC,CAAE,MAAOnF,GAEP,OADAN,QAAQM,MAAM,iCAAkCA,GACzC,EACT,CACF,CAKA,eAAA6S,GACE,IACE,OAAOA,gBAAgB,sBACzB,CAAE,MAAO7S,GAEP,OADAN,QAAQM,MAAM,6BAA8BA,GACrC,EACT,CACF,CASA,yBAAM0zB,CAAoB3vB,GACxB,IACE,IAAKA,IAAcA,EAAUf,KAC3B,MAAM,IAAIoB,MAAM,UAIlB,MAAMuF,EAAclK,KAAKk0B,0BAA0B5vB,GAEnDrE,QAAQC,IAAI,+BAAgCgK,EAAYhJ,QAGxD,MAAMwE,EAAc6H,YAAY7H,YAChCzF,QAAQC,IAAI,6BAA8BwF,GAE1C,MAAMyuB,EAAc5mB,YAAY3J,WAAWwwB,OAAO1uB,IAElD,IAAKyuB,EAEH,MADAl0B,QAAQM,MAAM,0CAA2CmF,GACnD,IAAIf,MAAM,aAGlB1E,QAAQC,IAAI,4BAA6Bi0B,EAAY5wB,MACrDtD,QAAQC,IAAI,0BAA2Bi0B,EAAYjqB,aAAahJ,QAAU,GAG1EizB,EAAYjqB,YAAcA,EAC1BjK,QAAQC,IAAI,gCAGNqN,YAAY8mB,eAClBp0B,QAAQC,IAAI,oCAEZD,QAAQC,IAAI,6BAA8BoE,EAAUf,MACpDa,OAAOI,QAAQ,MAAMF,EAAUf,cACjC,CAAE,MAAOhD,GAGP,MAFAN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,aACPA,CACR,CACF,CAMQ,yBAAA2zB,CAA0B5vB,GAChC,MAAM,KAAEf,EAAI,IAAEwD,EAAG,WAAEC,EAAU,WAAEC,EAAU,WAAErC,EAAU,aAAEE,GAAiBR,EAIxE,MAFoB,OAAOf,MAASwD,EAAM,OAAOA,MAAU,KAAKC,EAAa,OAAOA,MAAiB,KAAKC,EAAa,OAAOA,QAAmB,oBAAoBrC,EAAW0P,kBAAkB1P,EAAW2P,kBAAkB3P,EAAW4P,kBAAkB5P,EAAW6P,kBAAkB7P,EAAW8P,kBAAkB9P,EAAW+P,kBAAkB/P,EAAWgQ,kBAAkBhQ,EAAWiQ,kBAAkBjQ,EAAWkQ,2BAA2BhQ,EAAakQ,MAAMlQ,EAAamQ,oBAAoBnQ,EAAaoQ,MAAMpQ,EAAaqQ,qBAAqBrQ,EAAasQ,OAAOtQ,EAAauQ,sBAAsBvQ,EAAawQ,mBAAmBxQ,EAAayQ,mBAAmBzQ,EAAa0Q,SAGlqB,CAKA,gBAAA8e,GACE,IAEE,OAAO/mB,YAAY3J,YAAc,EACnC,CAAE,MAAOrD,GAEP,OADAN,QAAQM,MAAM,6BAA8BA,GACrC,EACT,CACF,CAOA,mBAAAg0B,GAEExH,QAAQyH,cAAcC,aAAeV,IACnC9zB,QAAQC,IAAI,0BAA2B6zB,GACvC/zB,KAAK6zB,cAAgBE,EAEjB/zB,KAAK4zB,UAAUc,eACjB10B,KAAK4zB,UAAUc,cAAcX,KAKjChH,QAAQyH,cAAcG,iBAAmBjtB,IACvCzH,QAAQC,IAAI,2BAERF,KAAK4zB,UAAUgB,mBACjB50B,KAAK4zB,UAAUgB,kBAAkBltB,KAKrCqlB,QAAQyH,cAAcK,iBAAmBhtB,IACvC5H,QAAQC,IAAI,0BAA2B2H,EAAOitB,QAAQlyB,IAElD5C,KAAK4zB,UAAUmB,oBAAsBltB,EAAOitB,QAAQlyB,IACtD5C,KAAK4zB,UAAUmB,mBAAmBltB,EAAOitB,OAAOlyB,MAKpDmqB,QAAQyH,cAAcQ,mBAAoB,KACxC/0B,QAAQC,IAAI,4BAERF,KAAK4zB,UAAUqB,qBACjBj1B,KAAK4zB,UAAUqB,wBAKnBlI,QAAQyH,cAAcU,mBAAoB,KACxCj1B,QAAQC,IAAI,4BAERF,KAAK4zB,UAAUuB,qBACjBn1B,KAAK4zB,UAAUuB,wBAInBl1B,QAAQC,IAAI,4BACd,CAKA,YAAAk1B,CAAaxB,GACX5zB,KAAK4zB,UAAY,IAAK5zB,KAAK4zB,aAAcA,EAC3C,CAKA,cAAAyB,GACEr1B,KAAK4zB,UAAY,CAAC,CACpB,CAQA,cAAMrsB,CAAS+tB,GACb,IACMA,GAAS9tB,iBACLD,SAAS,CAAEC,WAAY8tB,EAAQ9tB,mBAE/BD,SAAS,CAAC,EAEpB,CAAE,MAAOhH,GAEP,MADAN,QAAQM,MAAM,2BAA4BA,GACpCA,CACR,CACF,CAKA,cAAAg1B,GACE,IAGEt1B,QAAQC,IAAI,0BACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,2BAA4BA,EAC5C,CACF,CAQA,yBAAMi1B,CAAoB11B,GACxB,IAEE,MAAMmE,QAAgBvD,aAAaZ,GACnC,OAAOwC,MAAMC,KAAK0B,EACpB,CAAE,MAAO1D,GAEP,OADAN,QAAQM,MAAM,4BAA6BA,GACpC,EACT,CACF,CAOA,qBAAMk1B,CAAgB31B,EAAuBmE,GAC3C,UACQ9C,iBAAiBrB,EAAemE,GACtChE,QAAQC,IAAI,2BACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,4BAA6BA,GACrCA,CACR,CACF,CAOA,kBAAAm1B,GACE,IACE,OAAOryB,aAAa,CAAErC,KAAM,UAC9B,CAAE,MAAOT,GAEP,OADAN,QAAQM,MAAM,6BAA8BA,GACrC,CAAC,CACV,CACF,CAKA,wBAAMo1B,CAAmBC,GACvB,UACQ7J,iBAAiB6J,EAAW,CAAE50B,KAAM,WAC1Cf,QAAQC,IAAI,4BACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,6BAA8BA,GACtCA,CACR,CACF,CAOA,UAAAs1B,GACE,OAAOtoB,WACT,CAOA,gBAAAuoB,CAAiBpuB,EAAiB1G,EAAiD,QACjFoD,OAAOpD,GAAM0G,EACf,CAMA,oBAAMquB,CAAeC,GACnB,IACE,aAAaC,aAAaD,EAC5B,CAAE,MAAOz1B,GAEP,MADAN,QAAQM,MAAM,2BAA4By1B,EAASz1B,GAC7CA,CACR,CACF,CAKA,eAAA21B,GACEC,OAAOvc,SAASpY,QAClB,G,8BCjSF,MAAM40B,EAUJ,mBAAMC,GACJ,IAEE,GAAmB,oBAARlZ,IAET,OADAld,QAAQK,KAAK,wCACN,CACL8f,MAAO,YACPkW,WAAY,MACZlT,OAAQ,WAKZ,UACQrG,sBAAsB,MAC9B,CAAE,MAAOxc,GAEP,OADAN,QAAQK,KAAK,iCAAkCC,GACxC,CACL6f,MAAO,YACPkW,WAAY,MACZlT,OAAQ,UAEZ,CAGA,IAAIuI,EACJ,IACEA,EAAUxO,IAAIC,WAAW,CAAEpc,KAAM,QACnC,CAAE,MAAOT,GAGP,OADAN,QAAQK,KAAK,6BAA8BC,GACpC,CACL6f,MAAO,YACPkW,WAAY,MACZlT,OAAQ,UAEZ,CAEA,IAAKuI,IAAYA,EAAQ9N,UAEvB,OADA5d,QAAQK,KAAK,sCACN,CACL8f,MAAO,YACPkW,WAAY,MACZlT,OAAQ,WAKZ,MAAM1U,EAAcid,EAAQ9N,UAAU0Y,aAEtC,IAAK7nB,EAEH,OADAzO,QAAQK,KAAK,oDACN,CACL8f,MAAO,YACPkW,WAAY,MACZlT,OAAQ,WAIZ,MAAM3a,EAAOiG,EAIb,MAAkB,cAAdjG,EAAKzH,MACPf,QAAQC,IAAI,2CACL,CACLkgB,MAAO,YACPkW,WAAY,OACZlT,OAAQ,SAKgB,IAAxB3a,EAAK+tB,gBACPv2B,QAAQC,IAAI,4CACL,CACLkgB,MAAO,aACPkW,WAAY,OACZlT,OAAQ,SAKZnjB,QAAQC,IAAI,2CACL,CACLkgB,MAAO,YACPkW,WAAY,OACZlT,OAAQ,OAEZ,CAAE,MAAO7iB,GAKP,OAHAN,QAAQM,MAAM,wCAAyCA,GAGhD,CACL6f,MAAO,YACPkW,WAAY,MACZlT,OAAQ,UAEZ,CACF,CAMA,iBAAAqT,GACE,IAEE,MAAM52B,EAAe4f,EAAiB,iBAAAne,kBAEtC,OAAIzB,GACFI,QAAQC,IAAI,qCAAqCL,KAC1C,CACLugB,MAAOvgB,EACPy2B,WAAY,SACZlT,OAAQ,aAKZnjB,QAAQK,KAAK,0CACN,CACL8f,MAAO,YACPkW,WAAY,MACZlT,OAAQ,WAEZ,CAAE,MAAO7iB,GAEP,OADAN,QAAQM,MAAM,qCAAsCA,GAC7C,CACL6f,MAAO,YACPkW,WAAY,MACZlT,OAAQ,UAEZ,CACF,CAMA,YAAMsT,GACJz2B,QAAQC,IAAI,gCAGZ,IACE,MAAMy2B,QAAkB32B,KAAKq2B,gBAG7B,GAAyB,QAArBM,EAAUvT,QAA6C,SAAzBuT,EAAUL,WAE1C,OADAr2B,QAAQC,IAAI,8BAA8By2B,EAAUvW,eAAeuW,EAAUL,eACtEK,EAIgB,YAArBA,EAAUvT,QACZnjB,QAAQK,KAAK,mCAEjB,CAAE,MAAOC,GACPN,QAAQM,MAAM,kCAAmCA,EACnD,CAGA,IACE,MAAMq2B,EAAgB52B,KAAKy2B,oBAG3B,GAA6B,YAAzBG,EAAcxT,QAAqD,WAA7BwT,EAAcN,WAEtD,OADAr2B,QAAQC,IAAI,kCAAkC02B,EAAcxW,eAAewW,EAAcN,eAClFM,EAIoB,YAAzBA,EAAcxT,QAChBnjB,QAAQK,KAAK,uCAEjB,CAAE,MAAOC,GACPN,QAAQM,MAAM,sCAAuCA,EACvD,CAIA,OADAN,QAAQK,KAAK,iDACN,CACL8f,MAAO,YACPkW,WAAY,MACZlT,OAAQ,UAEZ,EAOF,MAAMyT,EAEIC,MAAQ,IAAI90B,IAGZ+0B,eAAiB,IAAI/0B,IAGrBg1B,SAAW,IAUnB,SAAAC,CAAU7W,GACR,IAEE,MAAMzG,EAAY3Z,KAAK+2B,eAAel0B,IAAIud,GACpCxP,EAAMD,KAAKC,MAEjB,GAAI+I,GAAa/I,EAAM+I,EAAY3Z,KAAKg3B,SAAU,CAEhD,MAAME,EAASl3B,KAAK82B,MAAMj0B,IAAIud,GAE9B,OADAngB,QAAQC,IAAI,6BAA6BkgB,KAClC8W,GAAU,IACnB,CAGA,IAAI7pB,EAA2B,KAE/B,IACEA,EAASoS,EAAiB,iBAAAU,YAAYC,EACxC,CAAE,MAAO7f,GAEPN,QAAQM,MAAM,wBAAwB6f,UAAe7f,GACrD6D,OAAOkE,QAAQ,MAAM8X,wBAGrB/S,EAAS,IACX,CAGA,GAAIA,EACF,IACE,MAAM8pB,EAAa1X,EAAiB,iBAAAoB,eAAexT,GAE9C8pB,EAAWhW,QAEdlhB,QAAQM,MAAM,qBAAqB6f,YAAiB+W,EAAW/kB,QAC/DhO,OAAO7D,MAAM,GAAG6f,eAAmB+W,EAAW/kB,OAAOzH,KAAK,mBAG1D0C,EAAS,KAEb,CAAE,MAAO9M,GACPN,QAAQM,MAAM,wBAAwB6f,aAAkB7f,GACxD6D,OAAOkE,QAAQ,MAAM8X,2BAGrB/S,EAAS,IACX,CAQF,OAJArN,KAAK82B,MAAM3yB,IAAIic,EAAO/S,GACtBrN,KAAK+2B,eAAe5yB,IAAIic,EAAOxP,GAE/B3Q,QAAQC,IAAI,8BAA8BkgB,IAAS/S,EAAS,SAAW,YAChEA,CACT,CAAE,MAAO9M,GAMP,OAJAN,QAAQM,MAAM,wBAAwB6f,iBAAsB7f,GAC5D6D,OAAO7D,MAAM,MAAM6f,wBAGZ,IACT,CACF,CAMA,UAAAgX,CAAWhX,GACLA,GAEFpgB,KAAK82B,MAAMvxB,OAAO6a,GAClBpgB,KAAK+2B,eAAexxB,OAAO6a,GAC3BngB,QAAQC,IAAI,2BAA2BkgB,OAGvCpgB,KAAK82B,MAAM/yB,QACX/D,KAAK+2B,eAAehzB,QACpB9D,QAAQC,IAAI,4BAEhB,CAMA,oBAAMm3B,GACJp3B,QAAQC,IAAI,qCAEZ,MAAMo3B,EAAsB,CAAC,YAAa,aAAc,aAExD,IAAK,MAAMlX,KAASkX,EAClB,IAEE,MAAMjqB,EAASrN,KAAKi3B,UAAU7W,GAC9BngB,QAAQC,IAAI,yBAAyBkgB,QAAa/S,EAAS,SAAW,WACxE,CAAE,MAAO9M,GACPN,QAAQM,MAAM,yBAAyB6f,UAAe7f,EAExD,CAGFN,QAAQC,IAAI,4BACd,EAOF,MAAMq3B,EAKJ,eAAAC,CAAgBnqB,EAAwBoqB,GAEtC,GAAIpqB,EAAOqqB,WAET,OADAz3B,QAAQC,IAAI,6CACLmN,EAIT,IAAKoqB,EAEH,OADAx3B,QAAQC,IAAI,sCACLmN,EAIT,MAAM8pB,EAAa1X,EAAiB,iBAAAoB,eAAe4W,GACnD,IAAKN,EAAWhW,MAId,OAHAlhB,QAAQM,MAAM,2BAA4B42B,EAAW/kB,QACrDhO,OAAO7D,MAAM,aAAa42B,EAAW/kB,OAAOzH,KAAK,SAE1C0C,EAIT,MAAMsqB,EAAiC,IAClCtqB,EACHqqB,WAAY,CACV5W,OAAQ2W,EAAU3W,OAClBE,IAAKyW,EAAUzW,IACftT,MAAO+pB,EAAU/pB,MACjBuT,YAAawW,EAAUxW,YACvBC,WAAYuW,EAAUvW,WACtBkC,OAAQ,WAWZ,OAPAnjB,QAAQC,IAAI,iDAAkD,CAC5DwN,MAAO+pB,EAAU/pB,MACjBoT,OAAQ2W,EAAU3W,OAAO9T,UAAU,EAAG,IAAM,MAC5CiU,YAAawW,EAAUxW,YACvBC,WAAYuW,EAAUvW,aAGjByW,CACT,CAMA,kBAAAC,CAAmBvqB,EAA2BoqB,GAE5C,GAAIpqB,EAAOqqB,WAET,OADAz3B,QAAQC,IAAI,6CACLmN,EAIT,IAAKoqB,EAEH,OADAx3B,QAAQC,IAAI,sCACLmN,EAIT,MAAM8pB,EAAa1X,EAAiB,iBAAAoB,eAAe4W,GACnD,IAAKN,EAAWhW,MAId,OAHAlhB,QAAQM,MAAM,2BAA4B42B,EAAW/kB,QACrDhO,OAAO7D,MAAM,aAAa42B,EAAW/kB,OAAOzH,KAAK,SAE1C0C,EAKT,MAAMsqB,EAAoC,IACrCtqB,EACHqqB,WAAY,CACV5W,OAAQ2W,EAAU3W,OAClBE,IAAKyW,EAAUzW,IACftT,MAAO+pB,EAAU/pB,MACjBuT,YAAawW,EAAUxW,YACvBC,WAAYuW,EAAUvW,WACtBkC,OAAQ,WAYZ,OARAnjB,QAAQC,IAAI,oDAAqD,CAC/DwN,MAAO+pB,EAAU/pB,MACjBoT,OAAQ2W,EAAU3W,OAAO9T,UAAU,EAAG,IAAM,MAC5CiU,YAAawW,EAAUxW,YACvBC,WAAYuW,EAAUvW,WACtB2W,sBAAuBxqB,EAAO2I,kBAGzB2hB,CACT,CAMA,QAAAxlB,CAAS9E,GAEP,IAAKA,EAAOqqB,WAEV,OADAz3B,QAAQC,IAAI,qCACL,EAIT,MAAMu3B,EAAuB,CAC3B3W,OAAQzT,EAAOqqB,WAAW5W,OAC1BE,IAAK3T,EAAOqqB,WAAW1W,KAAO,GAC9BtT,MAAOL,EAAOqqB,WAAWhqB,MACzBuT,YAAa5T,EAAOqqB,WAAWzW,aAAe,EAC9CC,WAAY7T,EAAOqqB,WAAWxW,YAAc,KAIxCiW,EAAa1X,EAAiB,iBAAAoB,eAAe4W,GAEnD,OAAKN,EAAWhW,OAMhBlhB,QAAQC,IAAI,8BACL,IANLD,QAAQM,MAAM,6BAA8B42B,EAAW/kB,QACvDhO,OAAO7D,MAAM,eAAe42B,EAAW/kB,OAAOzH,KAAK,UAC5C,EAKX,EAwhCK,MAAMmtB,EAAuB,IAjhCpC,MAEUl4B,aAAc,EAGdC,aAA0B,YAG1Bk4B,MAA0B,CAChCC,SAAS,EACTn4B,aAAc,YACdo4B,gBAAiBtnB,KAAKC,MACtBsnB,aAAc,EACdC,WAAY,GAINC,iBAA2C,KAG3CC,oBAAiD,KAGjDC,cAAgB,IAAIlC,EAGpBmC,eAAiB,IAAI1B,EAGrB2B,gBAAkB,IAAIjB,EAGtBkB,gBAAuC,KAGvCC,WAAY,EAUpB,gBAAM34B,GACJ,GAAIC,KAAKJ,YACPK,QAAQC,IAAI,mCAId,IACED,QAAQC,IAAI,8BAGZ,UACQuf,EAAiB,iBAAA1f,aACvBE,QAAQC,IAAI,2CACd,CAAE,MAAOK,GAEPN,QAAQM,MAAM,4CAA6CA,GAC3D6D,OAAOkE,QAAQ,2BAEftI,KAAKE,IAAI,CACPmmB,MAAO,QACP3e,QAAS,yBACTnH,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,KAI7D,CAGA,IACEP,KAAKH,mBAAqBG,KAAK24B,qBAC/B34B,KAAK+3B,MAAMl4B,aAAeG,KAAKH,aAC/BI,QAAQC,IAAI,+BAA+BF,KAAKH,eAClD,CAAE,MAAOU,GACPN,QAAQM,MAAM,8BAA+BA,GAE7CP,KAAKH,aAAe,YACpBG,KAAK+3B,MAAMl4B,aAAe,WAC5B,CAGA,UACQG,KAAKu4B,eAAelB,iBAC1Bp3B,QAAQC,IAAI,4BACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAOkE,QAAQ,yBAEftI,KAAKE,IAAI,CACPmmB,MAAO,OACP3e,QAAS,UACTnH,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,KAI7D,CAGA,IACEP,KAAK44B,oBACL34B,QAAQC,IAAI,4BACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,mBAEbP,KAAKE,IAAI,CACPmmB,MAAO,QACP3e,QAAS,UACTnH,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,MAK3DP,KAAK+3B,MAAMC,SAAU,CACvB,CAGA,IACEh4B,KAAK64B,oBACL54B,QAAQC,IAAI,+BACd,CAAE,MAAOK,GAEPN,QAAQM,MAAM,gCAAiCA,GAG5B,oBAAR4c,KACTld,QAAQK,KAAK,2CACb8D,OAAOoB,KAAK,8BAEZpB,OAAOkE,QAAQ,uBAGjBtI,KAAKE,IAAI,CACPmmB,MAAO,OACP3e,QAAS,aACTnH,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,KAI7D,CAEAP,KAAKJ,aAAc,EACnBI,KAAK+3B,MAAMC,SAAU,EACrB/3B,QAAQC,IAAI,2BACZkE,OAAOI,QAAQ,gBACjB,CAAE,MAAOjE,GAEPN,QAAQM,MAAM,oCAAqCA,GACnD6D,OAAO7D,MAAM,0BAEbP,KAAKE,IAAI,CACPmmB,MAAO,QACP3e,QAAS,iBACTnH,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,MAI3DP,KAAK+3B,MAAMC,SAAU,CACvB,CACF,CAMA,iBAAAY,GACE34B,QAAQC,IAAI,kCAKmB,mBAApBi2B,OAAO5uB,UAChBvH,KAAKo4B,iBAAmBjC,OAAO5uB,SAC/BtH,QAAQC,IAAI,0CAEZD,QAAQK,KAAK,yCAGmB,mBAAvB61B,OAAOpgB,aAChB/V,KAAKq4B,oBAAsBlC,OAAOpgB,YAClC9V,QAAQC,IAAI,6CAEZD,QAAQK,KAAK,4CAKXN,KAAKo4B,mBACPjC,OAAO5uB,SAAWvH,KAAK84B,kBAAkBnQ,KAAK3oB,MAC9CC,QAAQC,IAAI,0CAGVF,KAAKq4B,sBACPlC,OAAOpgB,YAAc/V,KAAK+4B,qBAAqBpQ,KAAK3oB,MACpDC,QAAQC,IAAI,6CAGdD,QAAQC,IAAI,8BACd,CAKA,wBAAA84B,GACE/4B,QAAQC,IAAI,iCAGRF,KAAKo4B,mBACPjC,OAAO5uB,SAAWvH,KAAKo4B,iBACvBn4B,QAAQC,IAAI,uCACZF,KAAKo4B,iBAAmB,MAItBp4B,KAAKq4B,sBACPlC,OAAOpgB,YAAc/V,KAAKq4B,oBAC1Bp4B,QAAQC,IAAI,0CACZF,KAAKq4B,oBAAsB,MAG7Bp4B,QAAQC,IAAI,6BACd,CAUA,wBAAMy4B,GACJ,IACE,MAAM9wB,QAAe7H,KAAKs4B,cAAc5B,SAGlCuC,EAAiC,QAAtBpxB,EAAOyuB,WAAuB,OAAS,OAmBxD,MAhBsB,YAAlBzuB,EAAOub,QACTnjB,QAAQK,KAAK,+CAEbN,KAAKE,IAAI,CACPmmB,MAAO,OACP3e,QAAS,mBAAmBG,EAAOuY,cAAcvY,EAAOub,gBAAgBvb,EAAOyuB,cAC/ElW,MAAOvY,EAAOuY,SAGhBpgB,KAAKE,IAAI,CACPmmB,MAAO4S,EACPvxB,QAAS,UAAUG,EAAOuY,cAAcvY,EAAOub,gBAAgBvb,EAAOyuB,cACtElW,MAAOvY,EAAOuY,QAIXvY,EAAOuY,KAChB,CAAE,MAAO7f,GAWP,OATAN,QAAQM,MAAM,qCAAsCA,GAEpDP,KAAKE,IAAI,CACPmmB,MAAO,QACP3e,QAAS,qCACTnH,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,MAIpD,WACT,CACF,CAQA,iBAAAs4B,GACE54B,QAAQC,IAAI,mCAKZ,IAEE,GAAmB,oBAARid,IAET,YADAld,QAAQK,KAAK,0CAMf,MAAM44B,EAAe/1B,MAAOyyB,IAEtBA,EAAU/X,WAAa+X,EAAU/X,UAAU0Y,eAC7Ct2B,QAAQC,IAAI,+CAGNF,KAAKm5B,sBAKfpM,QAAQ5P,IAAIzW,OAAO0yB,sBAAuBF,GAC1Cj5B,QAAQC,IAAI,qCAGZF,KAAKy4B,gBAAkB,KACrB7G,oBAAoBzU,IAAIzW,OAAO0yB,sBAAuBF,GACtDj5B,QAAQC,IAAI,qCAEhB,CAAE,MAAOK,GACPN,QAAQM,MAAM,qCAAsCA,EACtD,CAKA,IAEE,MAAM84B,EAA4B5Z,EAAiB,iBAAAc,kBAAkBoI,KAAKlJ,EAAAA,kBACpE6Z,EAA6B7Z,EAAiB,iBAAAe,mBAAmBmI,KAAKlJ,EAAAA,kBACtE8Z,EAA4B9Z,EAAiB,iBAAAgB,kBAAkBkI,KAAKlJ,EAAAA,kBAG1EA,EAAiB,iBAAAc,kBAAoBpd,UACnClD,QAAQC,IAAI,kCACZm5B,UACMr5B,KAAKm5B,qBAGb1Z,EAAiB,iBAAAe,mBAAqBrd,UACpClD,QAAQC,IAAI,iCACZo5B,UACMt5B,KAAKm5B,qBAGb1Z,EAAiB,iBAAAgB,kBAAoBtd,UACnClD,QAAQC,IAAI,gCACZq5B,UACMv5B,KAAKm5B,qBAGbl5B,QAAQC,IAAI,gCACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,kCAAmCA,EACnD,CAEAN,QAAQC,IAAI,+BACd,CAaQ,uBAAMi5B,GACZ,IACEl5B,QAAQC,IAAI,iCAGZ,MAAMs5B,EAAWx5B,KAAKH,aAGhB45B,QAAiBz5B,KAAK24B,qBAG5B,GAAIa,IAAaC,EAEf,YADAx5B,QAAQC,IAAI,+BAA+Bu5B,KAI7Cx5B,QAAQC,IAAI,2BAA2Bs5B,OAAcC,KAGrDz5B,KAAKH,aAAe45B,EACpBz5B,KAAK+3B,MAAMl4B,aAAe45B,EAC1Bz5B,KAAK+3B,MAAME,gBAAkBtnB,KAAKC,MAIlC5Q,KAAKu4B,eAAenB,aACpBn3B,QAAQC,IAAI,6BAGZ,MAAMw5B,EAAY15B,KAAKu4B,eAAetB,UAAUwC,GAGhDz5B,KAAKE,IAAI,CACPmmB,MAAO,OACP3e,QAAS,WAAW8xB,OAAcC,IAClCrZ,MAAOqZ,EACPhC,UAAWiC,EACP,CACEhsB,MAAOgsB,EAAUhsB,MACjBoT,OAAQ4Y,EAAU5Y,aAEpBhf,IAIN,MAAM63B,EAAY35B,KAAK45B,oBAAoBH,GACrCI,EAAUH,EAAY,YAAYA,EAAUhsB,SAAW,WAE7DtJ,OAAOI,QAAQ,WAAWm1B,gBAAwBE,IAAW,SAAU,CACrEzlB,QAAS,IACTqP,gBAAiB,IACjByN,aAAa,EACb4I,aAAa,IAGf75B,QAAQC,IAAI,6BACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,8BAA+BA,GAE7CP,KAAKE,IAAI,CACPmmB,MAAO,QACP3e,QAAS,WACTnH,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,KAE7D,CACF,CAKQ,mBAAAq5B,CAAoBxZ,GAM1B,MALgD,CAC9CN,UAAW,OACXC,WAAY,QACZC,UAAW,MAEOI,IAAUA,CAChC,CAOA,mBAAA2Z,GACE,IAEE,MAAM1sB,EAASrN,KAAKu4B,eAAetB,UAAUj3B,KAAKH,cAWlD,OANIwN,EACFpN,QAAQC,IAAI,wBAAwBF,KAAKH,4BAEzCI,QAAQC,IAAI,qBAAqBF,KAAKH,yBAGjCwN,CACT,CAAE,MAAO9M,GASP,OARAP,KAAKE,IAAI,CACPmmB,MAAO,QACP3e,QAAS,MAAM1H,KAAKH,0BACpBugB,MAAOpgB,KAAKH,aACZU,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,MAIpD,IACT,CACF,CAgBQ,uBAAMu4B,CAAkBzrB,GAC9B,IAEErN,KAAK+3B,MAAMG,eAGXj4B,QAAQC,IAAI,qCAAqCF,KAAK+3B,MAAMG,gBAGxDl4B,KAAK04B,YACPz4B,QAAQ+5B,MAAM,wCAAwCh6B,KAAK+3B,MAAMG,gBACjEj4B,QAAQC,IAAI,UAAW,CACrBsH,WACE6F,EAAO7F,YAAYwF,UAAU,EAAG,MAAQK,EAAO7F,YAAc6F,EAAO7F,WAAWtG,OAAS,IAAM,MAAQ,IACxGiG,cAAekG,EAAOlG,cACtB8yB,iBAAkB5sB,EAAOqqB,cAO7B13B,KAAK+3B,MAAMl4B,aAAeG,KAAKH,aAG3BG,KAAK04B,WACPz4B,QAAQC,IAAI,QAASF,KAAKH,cAI5B,MAAM43B,EAAYz3B,KAAK+5B,sBAGnB/5B,KAAK04B,YACHjB,EACFx3B,QAAQC,IAAI,gBAAiB,CAC3BwN,MAAO+pB,EAAU/pB,MACjBoT,OAAQ2W,EAAU3W,OAAO9T,UAAU,EAAG,IAAM,MAC5CiU,YAAawW,EAAUxW,YACvBC,WAAYuW,EAAUvW,aAGxBjhB,QAAQC,IAAI,eAKhB,IAyBI2H,EAzBA8vB,EAAiBtqB,EACjBoqB,IACFE,EAAiB33B,KAAKk6B,yBAAyB7sB,EAAQoqB,GAGlDz3B,KAAKm6B,sBAAsBxC,GAQrB33B,KAAK04B,WAEdz4B,QAAQC,IAAI,0BAA2B,CACrCwN,MAAOiqB,EAAeD,YAAYhqB,MAClCoT,OAAQ6W,EAAeD,YAAY5W,QAAQ9T,UAAU,EAAG,IAAM,MAC9DiU,YAAa0W,EAAeD,YAAYzW,YACxCC,WAAYyW,EAAeD,YAAYxW,cAbzCjhB,QAAQK,KAAK,mCACbq3B,EAAiBtqB,EAGbrN,KAAK04B,WACPz4B,QAAQK,KAAK,oBAenB,IAEE,MAAMmQ,EAAYzQ,KAAK04B,UAAY/nB,KAAKC,MAAQ,EAQhD,GANA/I,QAAe7H,KAAKo4B,iBAAkBT,GAGtC13B,QAAQC,IAAI,oCAAoCF,KAAK+3B,MAAMG,gBAGvDl4B,KAAK04B,UAAW,CAClB,MAAMhe,EAAW/J,KAAKC,MAAQH,EAC9BxQ,QAAQC,IAAI,QAAS,CACnBwa,SAAU,GAAGA,MACb0f,gBAAiBvyB,EAAO3G,OACxBm5B,iBAAkBxyB,EAAOmF,UAAU,EAAG,MAAQnF,EAAO3G,OAAS,IAAM,MAAQ,MAE9EjB,QAAQq6B,UACV,CACF,CAAE,MAAO/5B,GAEPP,KAAK+3B,MAAMI,aAGX,MAAMlrB,EAAe1M,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,GAoCrE,MAlCAN,QAAQM,MAAM,oCAAoCP,KAAK+3B,MAAMI,cAAelrB,GAGxEjN,KAAK04B,YACPz4B,QAAQM,MAAM,UAAW,CACvBA,MAAOA,EACP6f,MAAOpgB,KAAKH,aACZ43B,UAAWA,EACP,CACE/pB,MAAO+pB,EAAU/pB,MACjBoT,OAAQ2W,EAAU3W,OAAO9T,UAAU,EAAG,IAAM,OAE9C,WAEN/M,QAAQq6B,YAGVt6B,KAAKE,IAAI,CACPmmB,MAAO,QACP3e,QAAS,sBAAsB1H,KAAK+3B,MAAMI,gBAAgBlrB,IAC1DmT,MAAOpgB,KAAKH,aACZU,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,IACzDk3B,UAAWA,EACP,CACE/pB,MAAO+pB,EAAU/pB,MACjBoT,OAAQ2W,EAAU3W,OAAO9T,UAAU,EAAG,IAAM,YAE9ClL,IAINsC,OAAO7D,MAAM,cAAc0M,KAGrB1M,CACR,CAEA,OAAOsH,CACT,CAAE,MAAOtH,GAEPP,KAAK+3B,MAAMI,aAGX,MAAMlrB,EAAe1M,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,GAkBrE,MAhBAN,QAAQM,MAAM,yCAAyCP,KAAK+3B,MAAMI,cAAelrB,GAG7EjN,KAAK04B,YACPz4B,QAAQM,MAAM,UAAWA,GACzBN,QAAQq6B,YAGVt6B,KAAKE,IAAI,CACPmmB,MAAO,QACP3e,QAAS,2BAA2B1H,KAAK+3B,MAAMI,gBAAgBlrB,IAC/DmT,MAAOpgB,KAAKH,aACZU,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,MAIrDA,CACR,CACF,CAgBQ,0BAAMw4B,CAAqB1rB,GACjC,IAQE,GANArN,KAAK+3B,MAAMG,eAGXj4B,QAAQC,IAAI,wCAAwCF,KAAK+3B,MAAMG,gBAG3Dl4B,KAAK04B,YACPz4B,QAAQ+5B,MAAM,2CAA2Ch6B,KAAK+3B,MAAMG,gBACpEj4B,QAAQC,IAAI,UAAW,CACrBq6B,sBAAuBltB,EAAO2I,iBAAiB9U,QAAU,EACzD+4B,iBAAkB5sB,EAAOqqB,aAEvBrqB,EAAO2I,iBAAmB3I,EAAO2I,gBAAgB9U,OAAS,GAAG,CAC/D,MAAMs5B,EAAcntB,EAAO2I,gBAAgB,GAEhB,iBAAhBwkB,GAA4B,SAAUA,GAAe,YAAaA,EAC3Ev6B,QAAQC,IAAI,cAAe,CACzB+V,KAAMukB,EAAYvkB,KAClBC,QAASskB,EAAYtkB,QAAQlJ,UAAU,EAAG,MAAQwtB,EAAYtkB,QAAQhV,OAAS,IAAM,MAAQ,MAI/FjB,QAAQC,IAAI,cAAes6B,EAE/B,CAMFx6B,KAAK+3B,MAAMl4B,aAAeG,KAAKH,aAG3BG,KAAK04B,WACPz4B,QAAQC,IAAI,QAASF,KAAKH,cAI5B,MAAM43B,EAAYz3B,KAAK+5B,sBAGnB/5B,KAAK04B,YACHjB,EACFx3B,QAAQC,IAAI,gBAAiB,CAC3BwN,MAAO+pB,EAAU/pB,MACjBoT,OAAQ2W,EAAU3W,OAAO9T,UAAU,EAAG,IAAM,MAC5CiU,YAAawW,EAAUxW,YACvBC,WAAYuW,EAAUvW,aAGxBjhB,QAAQC,IAAI,eAKhB,IAyBI2H,EAzBA8vB,EAAiBtqB,EACjBoqB,IACFE,EAAiB33B,KAAKy6B,4BAA4BptB,EAAQoqB,GAGrDz3B,KAAKm6B,sBAAsBxC,GAQrB33B,KAAK04B,WAEdz4B,QAAQC,IAAI,0BAA2B,CACrCwN,MAAOiqB,EAAeD,YAAYhqB,MAClCoT,OAAQ6W,EAAeD,YAAY5W,QAAQ9T,UAAU,EAAG,IAAM,MAC9DiU,YAAa0W,EAAeD,YAAYzW,YACxCC,WAAYyW,EAAeD,YAAYxW,cAbzCjhB,QAAQK,KAAK,mCACbq3B,EAAiBtqB,EAGbrN,KAAK04B,WACPz4B,QAAQK,KAAK,oBAenB,IAEE,MAAMmQ,EAAYzQ,KAAK04B,UAAY/nB,KAAKC,MAAQ,EAQhD,GANA/I,QAAe7H,KAAKq4B,oBAAqBV,GAGzC13B,QAAQC,IAAI,uCAAuCF,KAAK+3B,MAAMG,gBAG1Dl4B,KAAK04B,UAAW,CAClB,MAAMhe,EAAW/J,KAAKC,MAAQH,EAC9BxQ,QAAQC,IAAI,QAAS,CACnBwa,SAAU,GAAGA,MACb0f,gBAAiBvyB,EAAO3G,OACxBm5B,iBAAkBxyB,EAAOmF,UAAU,EAAG,MAAQnF,EAAO3G,OAAS,IAAM,MAAQ,MAE9EjB,QAAQq6B,UACV,CACF,CAAE,MAAO/5B,GAEPP,KAAK+3B,MAAMI,aAGX,MAAMlrB,EAAe1M,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,GAoCrE,MAlCAN,QAAQM,MAAM,uCAAuCP,KAAK+3B,MAAMI,cAAelrB,GAG3EjN,KAAK04B,YACPz4B,QAAQM,MAAM,UAAW,CACvBA,MAAOA,EACP6f,MAAOpgB,KAAKH,aACZ43B,UAAWA,EACP,CACE/pB,MAAO+pB,EAAU/pB,MACjBoT,OAAQ2W,EAAU3W,OAAO9T,UAAU,EAAG,IAAM,OAE9C,WAEN/M,QAAQq6B,YAGVt6B,KAAKE,IAAI,CACPmmB,MAAO,QACP3e,QAAS,yBAAyB1H,KAAK+3B,MAAMI,gBAAgBlrB,IAC7DmT,MAAOpgB,KAAKH,aACZU,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,IACzDk3B,UAAWA,EACP,CACE/pB,MAAO+pB,EAAU/pB,MACjBoT,OAAQ2W,EAAU3W,OAAO9T,UAAU,EAAG,IAAM,YAE9ClL,IAINsC,OAAO7D,MAAM,cAAc0M,KAGrB1M,CACR,CAEA,OAAOsH,CACT,CAAE,MAAOtH,GAEPP,KAAK+3B,MAAMI,aAGX,MAAMlrB,EAAe1M,aAAiBoE,MAAQpE,EAAMmH,QAAUC,OAAOpH,GAkBrE,MAhBAN,QAAQM,MAAM,4CAA4CP,KAAK+3B,MAAMI,cAAelrB,GAGhFjN,KAAK04B,YACPz4B,QAAQM,MAAM,UAAWA,GACzBN,QAAQq6B,YAGVt6B,KAAKE,IAAI,CACPmmB,MAAO,QACP3e,QAAS,8BAA8B1H,KAAK+3B,MAAMI,gBAAgBlrB,IAClEmT,MAAOpgB,KAAKH,aACZU,MAAOA,aAAiBoE,MAAQpE,EAAQ,IAAIoE,MAAMgD,OAAOpH,MAIrDA,CACR,CACF,CAKQ,wBAAA25B,CAAyB7sB,EAAwBoqB,GACvD,OAAOz3B,KAAKw4B,gBAAgBhB,gBAAgBnqB,EAAQoqB,EACtD,CAKQ,2BAAAgD,CAA4BptB,EAA2BoqB,GAC7D,OAAOz3B,KAAKw4B,gBAAgBZ,mBAAmBvqB,EAAQoqB,EACzD,CAKQ,qBAAA0C,CAAsB9sB,GAC5B,OAAOrN,KAAKw4B,gBAAgBrmB,SAAS9E,EACvC,CAKA,aAAMqtB,GACJ,IACEz6B,QAAQC,IAAI,6BAGZF,KAAKg5B,2BAGDh5B,KAAKy4B,kBACPz4B,KAAKy4B,kBACLz4B,KAAKy4B,gBAAkB,KACvBx4B,QAAQC,IAAI,+BAIdF,KAAKu4B,eAAenB,aACpBn3B,QAAQC,IAAI,6BAGZF,KAAK+3B,MAAQ,CACXC,SAAS,EACTn4B,aAAc,YACdo4B,gBAAiBtnB,KAAKC,MACtBsnB,aAAc,EACdC,WAAY,GAGdn4B,KAAKJ,aAAc,EACnBI,KAAK+3B,MAAMC,SAAU,EACrB/3B,QAAQC,IAAI,yBACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,0BAA2BA,GACnCA,CACR,CACF,CAKA,QAAAo6B,GACE,MAAO,IAAK36B,KAAK+3B,MACnB,CAMA,eAAA6C,GACE56B,KAAK04B,WAAY,EACjBz4B,QAAQC,IAAI,6BACZkE,OAAOoB,KAAK,8BACd,CAKA,gBAAAq1B,GACE76B,KAAK04B,WAAY,EACjBz4B,QAAQC,IAAI,6BACZkE,OAAOoB,KAAK,kBACd,CAKA,eAAAs1B,GACM96B,KAAK04B,UACP14B,KAAK66B,mBAEL76B,KAAK46B,iBAET,CAKA,WAAAG,GACE,OAAO/6B,KAAK04B,SACd,CAaQ,GAAAx4B,CAAIU,GACV,MAAMo6B,EAAqB,IACtBp6B,EACH+Y,UAAWhJ,KAAKC,OAKZ+I,EAAY,IAAIhJ,KAAKqqB,EAASrhB,WAAWshB,cACzCC,EAAYF,EAAS5a,MAAQ,KAAK4a,EAAS5a,SAAW,GAG5D,IAAI+a,EAAgB,GACpB,GAAIH,EAASvD,UAAW,CACtB,MAAM2D,EAAkB,CAAC,EAGzB,GAAIJ,EAASvD,UAAUzW,IAAK,CAC1B,MAAMA,EAAMga,EAASvD,UAAUzW,IAC3BA,EAAI9f,OAAS,EACfk6B,EAAWpa,IAAM,GAAGA,EAAIhU,UAAU,EAAG,QAAQgU,EAAIhU,UAAUgU,EAAI9f,OAAS,KAExEk6B,EAAWpa,IAAM,KAErB,CAGA,GAAIga,EAASvD,UAAU3W,OAAQ,CAC7B,MAAMjI,EAAMmiB,EAASvD,UAAU3W,OAC3BjI,EAAI3X,OAAS,GACfk6B,EAAWta,OAASjI,EAAI7L,UAAU,EAAG,IAAM,MAE3CouB,EAAWta,OAASjI,CAExB,CAGImiB,EAASvD,UAAU/pB,QACrB0tB,EAAW1tB,MAAQstB,EAASvD,UAAU/pB,YAED5L,IAAnCk5B,EAASvD,UAAUxW,cACrBma,EAAWna,YAAc+Z,EAASvD,UAAUxW,kBAERnf,IAAlCk5B,EAASvD,UAAUvW,aACrBka,EAAWla,WAAa8Z,EAASvD,UAAUvW,YAG7Cia,EAAgB,UAAUxQ,KAAKC,UAAUwQ,KAC3C,CAGA,MAAMC,EAAc,sBAAc1hB,KAAauhB,KAAaF,EAAStzB,UAAUyzB,IAG/E,OAAQH,EAAS3U,OACf,IAAK,OACHpmB,QAAQC,IAAIm7B,GACRL,EAASz6B,OACXN,QAAQC,IAAI,mBAAoB86B,EAASz6B,OAE3C,MACF,IAAK,OACHN,QAAQK,KAAK+6B,GACTL,EAASz6B,OACXN,QAAQK,KAAK,mBAAoB06B,EAASz6B,OAE5C,MACF,IAAK,QACHN,QAAQM,MAAM86B,GACVL,EAASz6B,QACXN,QAAQM,MAAM,mBAAoBy6B,EAASz6B,OACvCy6B,EAASz6B,MAAMqH,OACjB3H,QAAQM,MAAM,iBAAkBy6B,EAASz6B,MAAMqH,QAKzD,GC3hDI0zB,EAAa,CAAEC,MAAO,oBACtBC,EAAa,CAAED,MAAO,oBACtBE,EAAa,CAAEF,MAAO,YACtBG,EAAa,CAAEH,MAAO,cACtBI,EAAa,CAAEJ,MAAO,YACtBK,EAAa,CACf5a,IAAK,EACLua,MAAO,uBAELM,EAAa,CAAEN,MAAO,cACtBO,EAAa,CAAEP,MAAO,eACtBQ,EAAa,CAAC,WACdC,EAAc,CAAET,MAAO,eACvBU,EAAc,CAAEV,MAAO,cACvBW,EAAc,CAAEX,MAAO,cACvBY,EAAc,CAAC,WACfC,EAAc,CAAEb,MAAO,cACvBc,EAAc,CAAEd,MAAO,cACvBe,EAAc,CAAEf,MAAO,cACvBgB,EAAc,CAAEhB,MAAO,qBACvBiB,EAAc,CAAEjB,MAAO,iBACvBkB,EAAc,CAAC,QAAS,WACxBC,EAAc,CAAEnB,MAAO,cACvBoB,EAAc,CAAEpB,MAAO,cACvBqB,EAAc,CAAErB,MAAO,cACvBsB,EAAc,CAAEtB,MAAO,gBACvBuB,EAAc,CAAC,YACfC,EAAc,CAAExB,MAAO,sBACvByB,EAAc,CAAEzB,MAAO,oBACvB0B,EAAc,CAAC,WAKrB,GAA6B,qBAAiB,CAC1CC,OAAQ,iBACRC,MAAO,CAAC,SACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMD,EAAOC,EAEPjG,EAAS,CACX,CAAEtW,IAAK,YAAazd,KAAM,QAC1B,CAAEyd,IAAK,aAAczd,KAAM,SAC3B,CAAEyd,IAAK,YAAazd,KAAM,OAGxBi6B,EAAe,CAEjB,CACIC,MAAO,iBACPr7B,MAAO,wBACP0e,OAAQ,6EACR5W,YAAa,8CAEjB,CACIuzB,MAAO,mBACPr7B,MAAO,uBACP0e,OAAQ,6EACR5W,YAAa,4CAEjB,CACIuzB,MAAO,iBACPr7B,MAAO,wBACP0e,OAAQ,6EACR5W,YAAa,yCAEjB,CACIuzB,MAAO,mBACPr7B,MAAO,0BACP0e,OAAQ,6EACR5W,YAAa,wCAEjB,CACIuzB,MAAO,aACPr7B,MAAO,aACP0e,OAAQ,6EACR5W,YAAa,oCAGjB,CACIuzB,MAAO,QACPr7B,MAAO,QACP0e,OAAQ,sEACR5W,YAAa,oCAEjB,CACIuzB,MAAO,cACPr7B,MAAO,sBACP0e,OAAQ,sEACR5W,YAAa,oCAEjB,CACIuzB,MAAO,UACPr7B,MAAO,gBACP0e,OAAQ,sEACR5W,YAAa,oCAGjB,CACIuzB,MAAO,gBACPr7B,MAAO,yBACP0e,OAAQ,yEACR5W,YAAa,uCAEjB,CACIuzB,MAAO,kBACPr7B,MAAO,2BACP0e,OAAQ,yEACR5W,YAAa,uCAEjB,CACIuzB,MAAO,iBACPr7B,MAAO,0BACP0e,OAAQ,yEACR5W,YAAa,wCAIfwzB,GAAY,IAAA77B,KAAI,aAChB6d,GAAU,IAAA7d,KAAI,CAChBie,UAAW,KACXC,WAAY,KACZC,UAAW,OAET2d,GAAU,IAAA97B,MAAI,GACdsM,GAAa,IAAAtM,KAAI,MACjB62B,GAAY,IAAA72B,MAAI,GAEhB+7B,GAAmB,IAAAz7B,UAAS,KAC9B,MAAMtC,EAAe4f,EAAiB,iBAAAne,kBAChC8e,EAAQkX,EAAO3qB,KAAKkxB,GAAKA,EAAE7c,MAAQnhB,GACzC,OAAOugB,EAAQA,EAAM7c,KAAO,OAE1Bu6B,GAAmB,IAAA37B,UAAS,KAC9B,MAAMtC,EAAe4f,EAAiB,iBAAAne,kBAChCinB,EAAgB7I,EAAQtd,MAAMvC,GACpC,OAAI0oB,EAEO,CACHwV,UAAU,EACVC,YAAa,UACbtwB,MAAO6a,EAAc7a,OAAS,OAK3B,CACHqwB,UAAU,EACVC,YAAa,WACbtwB,MAAO,QA2CnBvK,eAAeud,IACX,MAAMrT,EAASqS,EAAQtd,MAAMs7B,EAAUt7B,OACvC,IAAKiL,EAED,YADAjJ,OAAOkE,QAAQ,eAInB,MAAM6uB,EAAa1X,EAAiB,iBAAAoB,eAAexT,GACnD,GAAK8pB,EAAWhW,MAAhB,CAOAwc,EAAQv7B,OAAQ,EAChB+L,EAAW/L,MAAQ,KACnB,IACI,MAAMyF,QAAe4X,EAAiB,iBAAAiB,eAAegd,EAAUt7B,OAC/D+L,EAAW/L,MAAQyF,EACfA,EAAOrD,QACPJ,OAAOI,QAAQ,eAGfJ,OAAO7D,MAAM,aAErB,CACA,MAAOA,GACHN,QAAQM,MAAM,6BAA8BA,GAC5C4N,EAAW/L,MAAQ,CACfoC,SAAS,EACTkD,QAAS,SAASnH,aAAiBoE,MAAQpE,EAAMmH,QAAU,UAE/DtD,OAAO7D,MAAM,SACjB,CACA,QACIo9B,EAAQv7B,OAAQ,CACpB,CAvBA,MALI+L,EAAW/L,MAAQ,CACfoC,SAAS,EACTkD,QAASyvB,EAAW/kB,OAAOzH,KAAK,MA2B5C,CAEAxH,eAAe8c,IACX,IAEI,IAAK,MAAMG,KAASkX,EAAQ,CACxB,MAAMjqB,EAASqS,EAAQtd,MAAMge,EAAMY,KACnC,GAAI3T,EAAQ,CACR,MAAM8pB,EAAa1X,EAAiB,iBAAAoB,eAAexT,GACnD,IAAK8pB,EAAWhW,MAEZ,YADA/c,OAAO7D,MAAM,GAAG6f,EAAM7c,cAAc4zB,EAAW/kB,OAAOzH,KAAK,QAGnE,CACJ,OACM8U,EAAiB,iBAAAQ,YAAYP,EAAQtd,OAC3CgC,OAAOI,QAAQ,YACnB,CACA,MAAOjE,GACHN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,SACjB,CACJ,CAEA4C,eAAeie,IACX,GAAK6c,QAAQ,sCAGb,UACUxe,EAAiB,iBAAA2B,eACvB1B,EAAQtd,MAAQ,CACZ0d,UAAW,KACXC,WAAY,KACZC,UAAW,MAEf7R,EAAW/L,MAAQ,KACnBgC,OAAOI,QAAQ,QACnB,CACA,MAAOjE,GACHN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,SACjB,CACJ,CAEA,SAAS29B,IACLZ,EAAK,QACT,CAoBA,SAASxC,IACLhD,EAAqBgD,kBACrBpC,EAAUt2B,MAAQ01B,EAAqBiD,aAC3C,CACA,OAlJA,IAAAoD,WAAUh7B,UACN,UACUsc,EAAiB,iBAAA1f,aACvB2f,EAAQtd,MAAQqd,EAAiB,iBAAAY,gBACjCqY,EAAUt2B,MAAQ01B,EAAqBiD,cACvC96B,QAAQC,IAAI,4BAA6Bwf,EAAQtd,MACrD,CACA,MAAO7B,GACHN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,cACjB,IAwIG,CAAC69B,EAAMC,MACF,kBAAc,wBAAoB,MAAO/C,EAAY,CACzD+C,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAE9C,MAAO,eAAiB,YAAa,IAC7F8C,EAAO,MAAQA,EAAO,KAAM,wBAAoB,IAAK,CAAE9C,MAAO,qBAAuB,+CAAgD,KACrI,wBAAoB,gBACpB,wBAAoB,MAAOC,EAAY,EACnC,wBAAoB,MAAOC,EAAY,CACnC4C,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,SAAU,KACzF,wBAAoB,OAAQG,GAAY,qBAAiBkC,EAAiBx7B,OAAQ,MAEtF,wBAAoB,MAAOu5B,EAAY,CACnC0C,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,cAAe,KAC9F,wBAAoB,OAAQ,CACxBA,OAAO,oBAAgB,CAAC,aAAcuC,EAAiB17B,MAAM27B,SAAW,aAAe,kBACxF,qBAAiBD,EAAiB17B,MAAM47B,aAAc,KAE5DF,EAAiB17B,MAAM27B,UAAYD,EAAiB17B,MAAMsL,QACpD,kBAAc,wBAAoB,MAAOkuB,EAAY,CACpDyC,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,OAAQ,KACvF,wBAAoB,OAAQM,GAAY,qBAAiBiC,EAAiB17B,MAAMsL,OAAQ,OAE1F,wBAAoB,QAAQ,MAEtC,wBAAoB,YACpB,wBAAoB,MAAOouB,EAAY,GAClC,kBAAc,wBAAoB,WAAW,MAAM,gBAAYxE,EAASlX,IAC9D,wBAAoB,SAAU,CACjCY,IAAKZ,EAAMY,IACXua,OAAO,oBAAgB,CAAC,aAAc,CAAE+C,OAAQZ,EAAUt7B,QAAUge,EAAMY,OAC1Eud,QAAUC,GAAYd,EAAUt7B,MAAQge,EAAMY,MAC/C,qBAAiBZ,EAAM7c,MAAO,GAA6Bw4B,IAC9D,QAER,wBAAoB,WACpB,wBAAoB,MAAOC,EAAa,EACpC,wBAAoB,MAAOC,EAAa,EACpC,wBAAoB,QAASC,EAAa,EACtC,wBAAoB,QAAS,CACzBl7B,KAAM,WACNy9B,QAA4C,OAAnC/e,EAAQtd,MAAMs7B,EAAUt7B,OACjCs8B,SAAUL,EAAO,KAAOA,EAAO,GAAMG,IAAW,OA7KlDpe,EA6KgEsd,EAAUt7B,MAAOo8B,EA5K5E/O,OACVgP,QAET/e,EAAQtd,MAAQ,IACTsd,EAAQtd,MACX,CAACge,GAAQ,CACLU,OAAQ,GACRE,IAAK,GACLtT,MAAO,GACPuT,YAAa,EACbC,WAAY,MAMpBxB,EAAQtd,MAAQ,IACTsd,EAAQtd,MACX,CAACge,GAAQ,WAGjBjS,EAAW/L,MAAQ,MAtBvB,IAAsBge,KA8KC,KAAM,GAAgC+b,GACzCkC,EAAO,KAAOA,EAAO,IAAK,qBAAiB,+BAAgC,QAG/C,OAAnC3e,EAAQtd,MAAMs7B,EAAUt7B,SAClB,kBAAc,wBAAoB,WAAW,CAAE4e,IAAK,GAAK,EACxD,wBAAoB,MAAOob,EAAa,CACpCiC,EAAO,MAAQA,EAAO,KAAM,wBAAoB,QAAS,CAAE9C,MAAO,cAAgB,UAAW,KAC7F,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8C,EAAO,KAAOA,EAAO,GAAMG,GAAa9e,EAAQtd,MAAMs7B,EAAUt7B,OAAa,OAAIo8B,GACxGx9B,KAAM,OACNu6B,MAAO,aACPoD,YAAa,+CACd,KAAM,KAAuB,CAC5B,CAAC,aAAajf,EAAQtd,MAAMs7B,EAAUt7B,OAAO0e,aAGrD,wBAAoB,MAAOub,EAAa,CACpCgC,EAAO,MAAQA,EAAO,KAAM,wBAAoB,QAAS,CAAE9C,MAAO,cAAgB,UAAW,KAC7F,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8C,EAAO,KAAOA,EAAO,GAAMG,GAAa9e,EAAQtd,MAAMs7B,EAAUt7B,OAAU,IAAIo8B,GACrGx9B,KAAM,WACNu6B,MAAO,aACPoD,YAAa,4BACd,KAAM,KAAuB,CAC5B,CAAC,aAAajf,EAAQtd,MAAMs7B,EAAUt7B,OAAO4e,OAEjDqd,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,gBAAkB,sDAAuD,OAE9I,wBAAoB,MAAOe,EAAa,CACpC+B,EAAO,MAAQA,EAAO,KAAM,wBAAoB,QAAS,CAAE9C,MAAO,cAAgB,QAAS,KAC3F,wBAAoB,MAAOgB,EAAa,EACpC,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8B,EAAO,KAAOA,EAAO,GAAMG,GAAa9e,EAAQtd,MAAMs7B,EAAUt7B,OAAY,MAAIo8B,GACvGx9B,KAAM,OACNu6B,MAAO,aACPoD,YAAa,gBACd,KAAM,KAAuB,CAC5B,CAAC,aAAajf,EAAQtd,MAAMs7B,EAAUt7B,OAAOsL,UAEjD,wBAAoB,MAAO8uB,EAAa,GACnC,kBAAc,wBAAoB,WAAW,MAAM,gBAAYgB,EAAeoB,IACpE,wBAAoB,SAAU,CACjC5d,IAAK4d,EAAOx8B,MACZpB,KAAM,SACNu6B,MAAO,cACPsD,MAAOD,EAAO10B,YACdq0B,QAAUC,GA9GlD,SAAqBM,GACjB,MAAMvW,EAAgB7I,EAAQtd,MAAMs7B,EAAUt7B,OAC9C,GAAImmB,EAAe,CAEf,MAAMqW,EAASpB,EAAa7wB,KAAKoyB,GAAKA,EAAE38B,QAAU08B,GAElDpf,EAAQtd,MAAQ,IACTsd,EAAQtd,MACX,CAACs7B,EAAUt7B,OAAQ,IACZmmB,EACH7a,MAAOoxB,EACPhe,OAAQ8d,GAAQ9d,QAAUyH,EAAczH,SAGhD3S,EAAW/L,MAAQ,IACvB,CACJ,CA8F6D,CAAaw8B,EAAOx8B,SAC1C,qBAAiBw8B,EAAOnB,OAAQ,EAAqBhB,IACxD,SAGZ4B,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,+BAAgC,OAErH,wBAAoB,MAAOmB,EAAa,EACpC,wBAAoB,QAASC,EAAa,UAAW,qBAAiBjd,EAAQtd,MAAMs7B,EAAUt7B,OAAO6e,aAAe,IAAK,IACzH,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuBod,EAAO,KAAOA,EAAO,GAAMG,GAAa9e,EAAQtd,MAAMs7B,EAAUt7B,OAAkB,YAAIo8B,GAC7Gx9B,KAAM,QACNqF,IAAK,IACLD,IAAK,IACL44B,KAAM,MACNzD,MAAO,cACR,KAAM,KAAuB,CAC5B,CACI,aACA7b,EAAQtd,MAAMs7B,EAAUt7B,OAAO6e,iBAC/B,EACA,CAAEjK,QAAQ,MAGlBqnB,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,wBAAyB,OAE9G,wBAAoB,MAAOqB,EAAa,CACpCyB,EAAO,MAAQA,EAAO,KAAM,wBAAoB,QAAS,CAAE9C,MAAO,cAAgB,cAAe,KACjG,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8C,EAAO,KAAOA,EAAO,GAAMG,GAAa9e,EAAQtd,MAAMs7B,EAAUt7B,OAAiB,WAAIo8B,GAC5Gx9B,KAAM,SACNqF,IAAK,IACLD,IAAK,QACLm1B,MAAO,aACPoD,YAAa,QACd,KAAM,KAAuB,CAC5B,CACI,aACAjf,EAAQtd,MAAMs7B,EAAUt7B,OAAO8e,gBAC/B,EACA,CAAElK,QAAQ,SAItB,wBAAoB,aACpB,wBAAoB,MAAO6lB,EAAa,EACpC,wBAAoB,SAAU,CAC1BtB,MAAO,eACP0D,SAAUtB,EAAQv7B,MAClBm8B,QAAS7d,IACV,qBAAiBid,EAAQv7B,MAAQ,SAAW,QAAS,EAAqB06B,MAEjF,wBAAoB,UACnB3uB,EAAgB,QACV,kBAAc,wBAAoB,MAAO,CACxC6S,IAAK,EACLua,OAAO,oBAAgB,CAAC,cAAeptB,EAAW/L,MAAMoC,QAAU,UAAY,YAC/E,qBAAiB2J,EAAW/L,MAAMsF,SAAU,KAC7C,wBAAoB,QAAQ,IACnC,MACD,wBAAoB,QAAQ,MAEtC,wBAAoB,aACpB,wBAAoB,MAAOq1B,EAAa,EACpC,wBAAoB,QAASC,EAAa,EACtC,wBAAoB,QAAS,CACzBh8B,KAAM,WACNy9B,QAAS/F,EAAUt2B,MACnBs8B,SAAU5D,GACX,KAAM,GAAgCmC,GACzCoB,EAAO,MAAQA,EAAO,KAAM,qBAAiB,sBAAuB,SAG5E,wBAAoB,aACpB,wBAAoB,MAAO,CAAE9C,MAAO,iBAAmB,EACnD,wBAAoB,SAAU,CAC1BA,MAAO,kBACPgD,QAASte,GACV,SACH,wBAAoB,SAAU,CAC1Bsb,MAAO,oBACPgD,QAASnd,GACV,UACH,wBAAoB,SAAU,CAC1Bma,MAAO,oBACPgD,QAASL,GACV,UAInB,I,aC1dJ,MAEA,IAFiC,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBCsGhE,SAASgB,GAAoBC,GAClC,MAAMC,EAAK,aAYX,OAVAA,EAAG30B,GAAG00B,EAAS,CACbnmB,MAAO,IACP0B,SAAU,GACV2kB,KAAM,cACL50B,GAAG00B,EAAS,CACbnmB,MAAO,EACP0B,SAAU,GACV2kB,KAAM,eAGDD,CACT,CAQO,SAASE,GACdH,EACAI,EAAoB,GACpB7kB,EAAmB,IAEnB,MAAM0kB,EAAK,aAGLI,EAAgB9kB,EADH,EAGnB,IAAK,IAAIlR,EAAI,EAAGA,EAHG,EAGaA,IAAK,CACnC,MAAMlK,GAAK6G,KAAKsQ,SAAW,IAAO8oB,EAAY,EACxClgC,GAAK8G,KAAKsQ,SAAW,IAAO8oB,EAAY,EAE9CH,EAAG30B,GAAG00B,EAAS,CACb7/B,IACAD,IACAqb,SAAU8kB,EACVH,KAAM,gBAEV,CASA,OAPAD,EAAG30B,GAAG00B,EAAS,CACb7/B,EAAG,EACHD,EAAG,EACHqb,SAAU8kB,EACVH,KAAM,eAGDD,CACT,CA8KO,SAASK,GACdN,EACAO,EAAuB,CAAC,YAAa,YAErC,MAAMC,EAAwB,iBAAZR,EAAuBS,SAASC,cAAcV,GAAWA,EACvEQ,aAAcG,cAChBH,EAAGI,MAAMC,WAAaN,EAAW/0B,KAAK,MAE1C,CAMO,SAASs1B,GAA2Bd,GACzC,MAAMQ,EAAwB,iBAAZR,EAAuBS,SAASC,cAAcV,GAAWA,EACvEQ,aAAcG,cAChBH,EAAGI,MAAMC,WAAa,OAE1B,CC/VA,MAAM,GAAa,CAAC,OAMpB,IAA6B,qBAAiB,CAC1C9C,OAAQ,aACR,KAAAE,CAAMC,GACF,MAAM6C,GAAY,IAAA3e,gBAEZ4e,GAAgB,IAAAt+B,KAAI,MACpBu+B,GAAoB,IAAAv+B,KAAI,IACxBw+B,EAAkB,IAAIr+B,IAmF5B,OAxDA,IAAAm8B,WAAU,KAEF+B,EAAU1e,aAAava,aACvBm5B,EAAkBh+B,MAAQ89B,EAAU1e,aAAava,YAGjDk5B,EAAc/9B,OACdq9B,GAAqBU,EAAc/9B,MAAO,CAAC,eAInD,IAAAk+B,OAAM,IAAMJ,EAAU1e,aAAava,WAAY9D,MAAOo9B,EAAeC,KACjE,GAAID,IAAkBC,EAGtB,GAAKD,EAAL,CAKA,UAxCkB1nB,EAyCK0nB,EAvCnBF,EAAgBp3B,IAAI4P,GACb4Y,QAAQC,QAAQ2O,EAAgBx9B,IAAIgW,IAExC,IAAI4Y,QAAQ,CAACC,EAAS+O,KACzB,MAAMC,EAAM,IAAIC,MAChBD,EAAIE,OAAS,KACTP,EAAgBl8B,IAAI0U,EAAK6nB,GACzBzgC,QAAQC,IAAI,wBAAyB2Y,GACrC6Y,EAAQgP,IAEZA,EAAIG,QAAU,KACV5gC,QAAQM,MAAM,wBAAyBsY,GACvC4nB,EAAO,IAAI97B,MAAM,4BAA4BkU,OAEjD6nB,EAAII,IAAMjoB,IA0Bd,CACA,MAAOtY,GACHN,QAAQM,MAAM,+BAAgCA,EAClD,CA7CJ,IAAsBsY,EA+Cb2nB,GAAkBJ,EAAkBh+B,MAKrC+9B,EAAc/9B,OACd,KAAQ+9B,EAAc/9B,MAAO,CACzB6W,QAAS,EACTyB,SAAU,GACV2kB,KAAM,YACN0B,WAAY,KAERX,EAAkBh+B,MAAQm+B,EAE1B,KAAQJ,EAAc/9B,MAAO,CACzB6W,QAAS,EACTyB,SAAU,GACV2kB,KAAM,kBAhBlBe,EAAkBh+B,MAAQm+B,CAV9B,MAFIH,EAAkBh+B,MAAQ,MAmClC,IAAA4+B,iBAAgB,KACRb,EAAc/9B,OACd69B,GAA2BE,EAAc/9B,SAG1C,CAACg8B,EAAMC,MACF,kBAAc,wBAAoB,MAAO,CAC7C4C,QAAS,gBACTp/B,IAAKs+B,EACL5E,MAAO,oBACR,CACE6E,EAAuB,QACjB,kBAAc,wBAAoB,MAAO,CACxCpf,IAAK,EACL8f,IAAKV,EAAkBh+B,MACvB8+B,IAAK,OACL3F,MAAO,oBACR,KAAM,EAAe,MACtB,wBAAoB,QAAQ,IACnC,KAEX,IC1GJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qB,cCJvE,MAAM,GAAa,CAAEA,MAAO,qBACtB,GAAa,CAAEA,MAAO,kBACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CAAEA,MAAO,oBACtB,GAAa,CAAEA,MAAO,mBACtB,GAAa,CAAEA,MAAO,WACtB,GAAa,CAAEA,MAAO,aACtB,GAAa,CAAEA,MAAO,cACtB,GAAa,CAAEA,MAAO,cACtB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAC,SACf,GAAc,CAChBva,IAAK,EACLua,MAAO,cAEL,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,WACvB,GAAc,CAAEA,MAAO,mBACvB,GAAc,CAAEA,MAAO,mBACvB,GAAc,CAAC,uBACf,GAAc,CAAEA,MAAO,WACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAAEA,MAAO,cACvB4F,GAAc,CAAE5F,MAAO,aACvB6F,GAAc,CAAE7F,MAAO,cACvB8F,GAAc,CAAE9F,MAAO,aACvB+F,GAAc,CAAE/F,MAAO,cACvBgG,GAAc,CAChBvgB,IAAK,EACLua,MAAO,WAELiG,GAAc,CAAEjG,MAAO,eACvBkG,GAAc,CAAElG,MAAO,aACvBmG,GAAc,CAAEnG,MAAO,aACvBoG,GAAc,CAAEpG,MAAO,eACvBqG,GAAc,CAAErG,MAAO,eACvBsG,GAAc,CAAC,uBACfC,GAAc,CAAC,uBACfC,GAAc,CAAC,WACfC,GAAc,CAAEzG,MAAO,aACvB0G,GAAc,CAAE1G,MAAO,mBACvB2G,GAAc,CAAC,YAQrB,IAA6B,qBAAiB,CAC1ChF,OAAQ,mBACR1N,MAAO,CACH2S,aAAc,CAAEnhC,KAAM+M,QAAS1E,SAAS,GACxC+4B,cAAe,CAAE/4B,QAAS,UAC1Bg5B,WAAY,CAAErhC,KAAM+M,QAAS1E,SAAS,GACtCi5B,iBAAkB,CAAEj5B,aAASvH,IAEjCq7B,MAAO,CAAC,WACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAM/N,EAAQ6N,EAERC,EAAOC,EAEPjqB,GAAiB,SAEjBivB,GAAW,IAAAC,UAAS,CACtBj/B,KAAM,GACNwD,SAAKjF,EACLkF,WAAY,GACZC,WAAY,GACZrC,WAAY,CACR0P,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,MAGP2tB,GAAiB,IAAA5gC,KAAI,IACrB6gC,GAAe,IAAA7gC,KAAI,IACnB8gC,GAAqB,IAAA9gC,KAAI,IACzB+gC,GAAmB,IAAA/gC,KAAI,IAEvB0uB,EAAc,CAChB,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,MACA,MACA,OACA,MACA,MAGEzrB,GAAe,IAAA3C,UAAS,KACnB,KAAAkiB,uBAAsBke,EAAS39B,aAEpCi+B,GAAU,IAAA1gC,UAAS,KACrB,MAAM2gC,EAAUP,EAASh/B,KAAK8b,OAAOne,OAAS,EACxC6hC,EAAkD,OAA7BJ,EAAmBvgC,OAAkBwgC,EAAiBxgC,MAAMid,OAAOne,OAAS,EACvG,OAAO4hC,GAAWC,GAAsBC,EAAiB5gC,QAGvD6gC,GAAqB,IAAA9gC,UAAS,IACC,EAA1BogC,EAAS39B,WAAWiQ,KAGzBquB,GAAiB,IAAA/gC,UAAS,IACK,EAA1BogC,EAAS39B,WAAW+P,KAGzBwuB,GAAyB,IAAAhhC,UAAS,IAC7BsgC,EAAergC,MACjBU,OAAOyX,GAA6B,iBAApBA,EAAM6oB,WACtBC,OAAO,CAACjf,EAAK7J,IAAU6J,EAAM7J,EAAMnY,MAAO,IAG7CkhC,GAAqB,IAAAnhC,UAAS,IACzBsgC,EAAergC,MACjBU,OAAOyX,GAA6B,aAApBA,EAAM6oB,WACtBC,OAAO,CAACjf,EAAK7J,IAAU6J,EAAM7J,EAAMnY,MAAO,IAG7CmhC,GAA8B,IAAAphC,UAAS,IAClC8gC,EAAmB7gC,MAAQ+gC,EAAuB/gC,OAGvDohC,GAA0B,IAAArhC,UAAS,IAC9B+gC,EAAe9gC,MAAQkhC,EAAmBlhC,OAG/C4gC,GAAmB,IAAA7gC,UAAS,IACvBohC,EAA4BnhC,OAAS,GAAKohC,EAAwBphC,OAAS,GAMtF,SAASqhC,EAAiBziB,GAYtB,MAXc,CACV1M,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,MAEIkM,IAAQA,CACzB,CAIA,SAAS0iB,IACL,MAAMC,GAAc,KAAArf,0BAAyB,SAC7CtgB,OAAOa,OAAO09B,EAAS39B,WAAY++B,GAEnCv/B,OAAOI,QAAQ,UACnB,CAIA,SAASo/B,IAET,CAIA,SAASC,IAC4B,OAA7BlB,EAAmBvgC,MACnBmgC,EAASv7B,WAAa,IAGtBu7B,EAASv7B,WAAa27B,EAAmBvgC,MACzCwgC,EAAiBxgC,MAAQ,GAEjC,CAIA,SAAS0hC,IACL,MAAMtpB,EAAYkoB,EAAatgC,MAAMid,OAChC7E,EAIDioB,EAAergC,MAAMwH,KAAKm6B,GAAKA,EAAExgC,OAASiX,GAC1CpW,OAAOkE,QAAQ,WAGnBm6B,EAAergC,MAAM2D,KAAK,CAAExC,KAAMiX,EAAWpY,MAAO,GAAIghC,UAAW,iBACnEV,EAAatgC,MAAQ,IARjBgC,OAAOkE,QAAQ,UASvB,CAUAnF,eAAe0vB,IACX,GAAKgQ,EAAQzgC,MAYb,IAEqC,OAA7BugC,EAAmBvgC,QACnBmgC,EAASv7B,WAAa47B,EAAiBxgC,MAAMid,QAGjD,MAAM3Z,EAAc8pB,EAAM8S,kBAAkB1/B,IAAM,QAAQ+N,KAAKC,SAASzK,KAAKsQ,SAASC,SAAS,IAAIC,OAAO,EAAG,KAEvGqtB,EAAY,IAAIhiC,IACtBygC,EAAergC,MAAM8B,QAAQqW,IACzBypB,EAAU7/B,IAAIoW,EAAMhX,KAAMgX,EAAMnY,SAGpC,MAAM2C,EAwGH,CACH,CACInC,GAAI,OACJW,KAAM,KACNiU,OAAQ,EACRC,QAAS,GACTE,SAAU,CACN,CAAE/U,GAAI,OAAQW,KAAM,KAAMgU,OAAQ,OAAQC,OAAQ,EAAGC,QAAS,IAC9D,CAAE7U,GAAI,QAASW,KAAM,KAAMgU,OAAQ,OAAQC,OAAQ,EAAGC,QAAS,IAC/D,CAAE7U,GAAI,OAAQW,KAAM,KAAMgU,OAAQ,OAAQC,OAAQ,EAAGC,QAAS,IAC9D,CAAE7U,GAAI,OAAQW,KAAM,KAAMgU,OAAQ,OAAQC,OAAQ,EAAGC,QAAS,MAGtE,CACI7U,GAAI,QACJW,KAAM,KACNiU,OAAQ,EACRC,QAAS,GACTE,SAAU,CACN,CAAE/U,GAAI,QAASW,KAAM,KAAMgU,OAAQ,QAASC,OAAQ,EAAGC,QAAS,IAChE,CAAE7U,GAAI,UAAWW,KAAM,KAAMgU,OAAQ,QAASC,OAAQ,EAAGC,QAAS,IAClE,CAAE7U,GAAI,OAAQW,KAAM,KAAMgU,OAAQ,QAASC,OAAQ,EAAGC,QAAS,MAGvE,CACI7U,GAAI,QACJW,KAAM,KACNiU,OAAQ,EACRC,QAAS,GACTE,SAAU,CACN,CAAE/U,GAAI,WAAYW,KAAM,KAAMgU,OAAQ,QAASC,OAAQ,EAAGC,QAAS,IACnE,CAAE7U,GAAI,YAAaW,KAAM,KAAMgU,OAAQ,QAASC,OAAQ,EAAGC,QAAS,IACpE,CAAE7U,GAAI,WAAYW,KAAM,KAAMgU,OAAQ,QAASC,OAAQ,EAAGC,QAAS,IACnE,CAAE7U,GAAI,YAAaW,KAAM,KAAMgU,OAAQ,QAASC,OAAQ,EAAGC,QAAS,OAvItEwsB,EAAgB,CAClBrhC,GAAI8C,EACJnC,KAAMg/B,EAASh/B,KACfwD,IAAKw7B,EAASx7B,IACdC,WAAYu7B,EAASv7B,iBAAclF,EACnCmF,WAAYs7B,EAASt7B,iBAAcnF,EACnC8C,WAAY,IAAK29B,EAAS39B,YAC1BE,aAAc,IAAKA,EAAa1C,OAChCqT,OAAQuuB,EACRj/B,YACAgH,UAAW,IAEf,IAAIzH,EAuBJ,GArBIA,EADwB,WAAxBkrB,EAAM4S,cACM,IACL6B,EACHjjC,KAAM,UAIE,IACLijC,EACHjjC,KAAM,MACNoE,UAAW,GACXnC,aAAa,EACbyD,OAAQ,UAIVhD,EAAW,WAAAa,cAAcD,GAE3BkrB,EAAM2S,cAAwC,WAAxB3S,EAAM4S,qBACtBzO,EAAcM,oBAAoB3vB,GAGhB,WAAxBkrB,EAAM4S,eAGN,SAFM9uB,EAAejP,UAAUC,IAE1BkrB,EAAM8S,iBACP,IACI,MAAM,oBAAE17B,SAA8B,2CACjBA,EAAoBuC,WAErClJ,QAAQC,IAAI,0CACN0G,EAAoBC,YAAYvC,GAE9C,CACA,MAAO/D,GACHN,QAAQM,MAAM,iCAAkCA,GAEhD6D,OAAOkE,QAAQ,qBACnB,aAIEgL,EAAerO,OAAOX,GAEhCF,OAAOI,QAAQ,MAAMF,EAAUf,aAE/B+5B,EAAK,UAAWh5B,GAEY,WAAxBkrB,EAAM4S,gBACNniC,QAAQC,IAAI,gDACZqT,UAAU,qBAElB,CACA,MAAOhT,GACHN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,SACjB,MA/FSyiC,EAAiB5gC,MAGgB,OAA7BugC,EAAmBvgC,OAAmBwgC,EAAiBxgC,MAAMid,OAIlEjb,OAAO7D,MAAM,UAHb6D,OAAO7D,MAAM,cAHb6D,OAAO7D,MAAM,uBA+FzB,CAsEA,OApEA,IAAA49B,WAAU,KAEN,GAAI3O,EAAM8S,iBAAkB,CACxBC,EAASh/B,KAAOisB,EAAM8S,iBAAiB/+B,KACvCg/B,EAASx7B,IAAMyoB,EAAM8S,iBAAiBv7B,IACtCw7B,EAASv7B,WAAawoB,EAAM8S,iBAAiBt7B,YAAc,GAC3Du7B,EAASt7B,WAAauoB,EAAM8S,iBAAiBr7B,YAAc,GAC3DjD,OAAOa,OAAO09B,EAAS39B,WAAY4qB,EAAM8S,iBAAiB19B,YAE1D,MAAMoC,EAAawoB,EAAM8S,iBAAiBt7B,YAAc,GACpDupB,EAAYzqB,SAASkB,GACrB27B,EAAmBvgC,MAAQ4E,EAEtBA,IACL27B,EAAmBvgC,MAAQ,KAC3BwgC,EAAiBxgC,MAAQ4E,GAG7B,MAAMk9B,EAAc5hC,MAAMC,KAAKitB,EAAM8S,iBAAiB7sB,OAAOxR,WAC7Dw+B,EAAergC,MAAQ8hC,EAAYvjC,IAAKC,IAAU,CAC9C2C,KAAM3C,EAAM,GACZwB,MAAOxB,EAAM,GACbwiC,UAAW,iBAEnB,IA4CG,CAAChF,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,KAAM,IAAY,qBAAiBhB,EAAQiF,iBAAmB,OAAS,QAAS,IACpG,wBAAoB,IAAK,GAAY,cAAe,qBAAiBjF,EAAQiF,iBAAmB,KAAO,MAAQ,OAAQ,MAE3H,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,WACpB,wBAAoB,UAAW,GAAY,CACvCjE,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAE9C,MAAO,iBAAmB,QAAS,KAC3F,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,GAAY,CACnC8C,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,CAAE9C,MAAO,cAAgB,QAAS,KACzF,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8C,EAAO,KAAOA,EAAO,GAAMG,GAAa+D,EAAa,KAAI/D,GAChFx9B,KAAM,OACNu6B,MAAO,aACPoD,YAAa,UACd,KAAM,KAAuB,CAC5B,CAAC,aAAa4D,EAASh/B,WAG/B,wBAAoB,MAAO,GAAY,CACnC86B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,CAAE9C,MAAO,cAAgB,MAAO,KACvF,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8C,EAAO,KAAOA,EAAO,GAAMG,GAAa+D,EAAY,IAAI/D,GAC/Ex9B,KAAM,SACNu6B,MAAO,aACPoD,YAAa,OACbt4B,IAAK,KACLD,IAAK,MACN,KAAM,KAAuB,CAC5B,CACI,aACAm8B,EAASx7B,SACT,EACA,CAAEiQ,QAAQ,SAItB,wBAAoB,MAAO,GAAa,CACpCqnB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,CAAE9C,MAAO,cAAgB,MAAO,KACvF,qBAAgB,wBAAoB,SAAU,CAC1C,sBAAuB8C,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAqBp8B,MAAQo8B,GAC3FjD,MAAO,cACPmD,SAAUmF,GACX,CACCxF,EAAO,KAAOA,EAAO,IAAK,wBAAoB,SAAU,CAAEj8B,MAAO,IAAM,QAAS,MAC/E,kBAAc,wBAAoB,WAAW,MAAM,gBAAYmuB,EAAcvpB,IACnE,wBAAoB,SAAU,CACjCga,IAAKha,EACL5E,MAAO4E,IACR,qBAAiBA,GAAa,EAAqB,KACtD,MACL,KAAuC,CACtC,CAAC,eAAe27B,EAAmBvgC,WAGb,OAA7BugC,EAAmBvgC,QACb,kBAAc,wBAAoB,MAAO,GAAa,CACrDi8B,EAAO,MAAQA,EAAO,KAAM,wBAAoB,QAAS,CAAE9C,MAAO,cAAgB,WAAY,KAC9F,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8C,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAmBp8B,MAAQo8B,GACzFx9B,KAAM,OACNu6B,MAAO,aACPoD,YAAa,UACd,KAAM,KAAuB,CAC5B,CAAC,aAAaiE,EAAiBxgC,aAGrC,wBAAoB,QAAQ,MAEtC,wBAAoB,MAAO,GAAa,CACpCi8B,EAAO,MAAQA,EAAO,KAAM,wBAAoB,QAAS,CAAE9C,MAAO,cAAgB,QAAS,KAC3F,qBAAgB,wBAAoB,WAAY,CAC5C,sBAAuB8C,EAAO,KAAOA,EAAO,GAAMG,GAAa+D,EAAmB,WAAI/D,GACtFjD,MAAO,gBACPoD,YAAa,eACbwF,KAAM,KACP,KAAM,KAAuB,CAC5B,CAAC,aAAa5B,EAASt7B,mBAInC,wBAAoB,cACpB,wBAAoB,UAAW,GAAa,EACxC,wBAAoB,MAAO,CAAEs0B,MAAO,kBAAoB,CACpD8C,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAE9C,MAAO,iBAAmB,WAAY,KAC9F,wBAAoB,SAAU,CAC1BA,MAAO,gBACPgD,QAASmF,GACV,IAAKrF,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,CAAE9C,MAAO,YAAc,MAAO,IAC1D,qBAAiB,UAAW,UAGxC,wBAAoB,MAAO,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYgH,EAAS39B,WAAY,CAAC0c,EAAGN,MACjF,kBAAc,wBAAoB,MAAO,CAC7CA,IAAKA,EACLua,MAAO,kBACR,EACC,wBAAoB,QAAS,IAAa,qBAAiBkI,EAAiBziB,IAAO,IACnF,qBAAgB,wBAAoB,QAAS,CACzC,sBAAwBwd,GAAa+D,EAAS39B,WAAWoc,GAAQwd,EACjEx9B,KAAM,SACNu6B,MAAO,kBACPl1B,IAAK,IACLD,IAAK,MACLg+B,QAASR,GACV,KAAM,GAAgC,IAAc,CACnD,CACI,aACArB,EAAS39B,WAAWoc,QACpB,EACA,CAAEhK,QAAQ,UAItB,WAGZ,wBAAoB,WACpB,wBAAoB,UAAW,GAAa,CACxCqnB,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAE9C,MAAO,iBAAmB,cAAe,KACjG,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,MAAO,GAAa,CACpC8C,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,YAAa,KAC9F,wBAAoB,OAAQ,IAAa,qBAAiBz2B,EAAa1C,MAAM4S,IAAM,OAAQ,qBAAiBlQ,EAAa1C,MAAM6S,OAAQ,MAE3I,wBAAoB,MAAO,GAAa,CACpCopB,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,YAAa,KAC9F,wBAAoB,OAAQ,IAAa,qBAAiBz2B,EAAa1C,MAAM8S,IAAM,OAAQ,qBAAiBpQ,EAAa1C,MAAM+S,OAAQ,MAE3I,wBAAoB,MAAO,GAAa,CACpCkpB,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,aAAc,KAC/F,wBAAoB,OAAQ,IAAa,qBAAiBz2B,EAAa1C,MAAMgT,KAAO,OAAQ,qBAAiBtQ,EAAa1C,MAAMiT,QAAS,MAE7I,wBAAoB,MAAO,GAAa,CACpCgpB,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,aAAc,KAC/F,wBAAoB,OAAQ,IAAa,qBAAiBz2B,EAAa1C,MAAMkT,KAAM,MAEvF,wBAAoB,MAAO6rB,GAAa,CACpC9C,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,aAAc,KAC/F,wBAAoB,OAAQ6F,IAAa,qBAAiBt8B,EAAa1C,MAAMmT,IAAK,MAEtF,wBAAoB,MAAO8rB,GAAa,CACpChD,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,cAAe,KAChG,wBAAoB,OAAQ+F,IAAa,qBAAiBx8B,EAAa1C,MAAMoT,OAAQ,UAIjG,wBAAoB,WACnB6nB,EAAkB,aACZ,kBAAc,wBAAoB,UAAWkE,GAAa,CACzDlD,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAE9C,MAAO,iBAAmB,SAAU,KAC5F,wBAAoB,MAAOiG,GAAa,EACpC,wBAAoB,IAAKC,GAAa,CAClCpD,EAAO,MAAQA,EAAO,KAAM,qBAAiB,YAAa,KAC1D,wBAAoB,OAAQ,CACxB9C,OAAO,oBAAgB,CAAC,eAAgB,CAAE,kBAAmBgI,EAA4BnhC,MAAQ,OAClG,qBAAiBmhC,EAA4BnhC,OAAS,OAAQ,qBAAiB6gC,EAAmB7gC,OAAQ,MAEjH,wBAAoB,IAAKs/B,GAAa,CAClCrD,EAAO,MAAQA,EAAO,KAAM,qBAAiB,YAAa,KAC1D,wBAAoB,OAAQ,CACxB9C,OAAO,oBAAgB,CAAC,eAAgB,CAAE,kBAAmBiI,EAAwBphC,MAAQ,OAC9F,qBAAiBohC,EAAwBphC,OAAS,OAAQ,qBAAiB8gC,EAAe9gC,OAAQ,QAG7G,wBAAoB,MAAOu/B,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYc,EAAergC,MAAQmY,KAC/E,kBAAc,wBAAoB,MAAO,CAC7CyG,IAAKzG,EAAMhX,KACXg4B,MAAO,cACR,EACC,wBAAoB,QAASqG,IAAa,qBAAiBrnB,EAAMhX,MAAO,IACxE,qBAAgB,wBAAoB,QAAS,CACzC,sBAAwBi7B,GAAajkB,EAAW,MAAIikB,EACpDx9B,KAAM,SACNu6B,MAAO,cACPl1B,IAAK,IACLD,IAAK,OACN,KAAM,EAAey7B,IAAc,CAClC,CACI,aACAtnB,EAAMnY,WACN,EACA,CAAE4U,QAAQ,OAGlB,qBAAgB,wBAAoB,SAAU,CAC1C,sBAAwBwnB,GAAajkB,EAAe,UAAIikB,EACxDjD,MAAO,qBACR,IAAK8C,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,SAAU,CAAEj8B,MAAO,gBAAkB,OAAQ,IACjE,wBAAoB,SAAU,CAAEA,MAAO,YAAc,OAAQ,MAC3D,EAAe0/B,IAAc,CACnC,CAAC,eAAevnB,EAAM6oB,cAE1B,wBAAoB,SAAU,CAC1B7H,MAAO,aACPgD,QAAUC,IAAW,OAxXpChkB,EAwXiDD,EAAMhX,UAvXxEk/B,EAAergC,MAAQqgC,EAAergC,MAAMU,OAAOihC,GAAKA,EAAExgC,OAASiX,IADvE,IAAqBA,IAyXc,IAAK,EAAeunB,QAE3B,SAER,wBAAoB,MAAOC,GAAa,EACpC,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB3D,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAep8B,MAAQo8B,GACrFx9B,KAAM,OACNu6B,MAAO,aACPoD,YAAa,SACb0F,SAAS,cAAUP,EAAU,CAAC,WAC/B,KAAM,KAAuC,CAC5C,CAAC,aAAapB,EAAatgC,UAE/B,wBAAoB,SAAU,CAC1Bm5B,MAAO,gBACPgD,QAASuF,GACV,cAGT,wBAAoB,QAAQ,MAEtC,wBAAoB,WACpB,wBAAoB,MAAO7B,GAAa,EACpC,wBAAoB,SAAU,CAC1B1G,MAAO,cACP0D,UAAW4D,EAAQzgC,MACnBm8B,QAAS1L,IACV,qBAAiBwK,EAAQiF,iBAAmB,OAASjF,EAAQ8E,aAAe,WAAa,QAAS,EAAqBD,QAI1I,IC3mBJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAE3G,MAAO,mBACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CAAEA,MAAO,oBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,kBAEL,GAAa,CAAEA,MAAO,kBACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CAAEA,MAAO,gBACtB,GAAa,CAAEA,MAAO,cACtB,GAAa,CAAEA,MAAO,aACtB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,mBACvB,GAAc,CAAEA,MAAO,sBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,mBACvB,GAAc,CAAEA,MAAO,mBACvB,GAAc,CAAEA,MAAO,mBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAC,WACf,GAAc,CAAEA,MAAO,eACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,sBAEL,GAAc,CAAEA,MAAO,cACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,WAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,gBAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,gBAKX,IAA6B,qBAAiB,CAC1C2B,OAAQ,iBACRC,MAAO,CAAC,QAAS,QACjB,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMD,EAAOC,EAEPjqB,GAAiB,SAEjBgxB,GAAgB,IAAAziC,KAAI,IAAImvB,KAK9B,SAASuT,IACAjxB,EAAe1R,QAEpB07B,EAAK,OAAQhqB,EAAe1R,OAChC,CAIA,SAAS4iC,IACLlH,EAAK,QACT,CAIA,SAASmG,EAAiBziB,GAYtB,MAXc,CACV1M,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,MAEIkM,IAAQA,CACzB,CAeA,SAASyjB,EAAejtB,GACpB,OAAe,IAAXA,EACO,cACPA,EAAS,GACF,eACPA,EAAS,GACF,kBACPA,EAAS,GACF,eACJ,iBACX,CACA,MAAO,CAAC4mB,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,WACpB,wBAAoB,MAAO,CAAE9C,MAAO,gBAAkB,CAClD8C,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAE9C,MAAO,eAAiB,QAAS,KACvF,wBAAoB,SAAU,CAC1BA,MAAO,YACPgD,QAASiG,GACV,QAEP,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,aACpB,wBAAoB,MAAO,GAAY,EAClC,WAAOlxB,GAAsB,SACvB,kBAAc,wBAAoB,MAAO,GAAY,EACpD,wBAAoB,aACpB,wBAAoB,UAAW,GAAY,EACvC,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,KAAM,IAAY,sBAAiB,WAAOA,GAAgB1R,OAAO2B,MAAO,IAC5F,wBAAoB,MAAO,CAAEg4B,MAAO,kBAAoB,EACpD,wBAAoB,SAAU,CAC1BA,MAAO,WACPgD,QAASgG,GACV,cAGX,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,GAAY,CACnClG,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,OAAQ,KACvF,wBAAoB,OAAQ,IAAa,sBAAiB,WAAOjoB,GAAgB1R,OAAOmF,KAAO,KAAM,MAEzG,wBAAoB,MAAO,GAAa,CACpCs3B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,OAAQ,KACvF,wBAAoB,OAAQ,IAAa,sBAAiB,WAAOjoB,GAAgB1R,OAAOoF,YAAc,KAAM,QAGpH,wBAAoB,MAAO,GAAa,CACpCq3B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,IAAK,CAAE9C,MAAO,cAAgB,SAAU,KACtF,wBAAoB,IAAK,IAAa,sBAAiB,WAAOjoB,GAAgB1R,OAAOqF,YAAc,UAAW,QAGtH,wBAAoB,cACpB,wBAAoB,UAAW,GAAa,CACxCo3B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAE9C,MAAO,oBAAsB,WAAY,KAC/F,wBAAoB,MAAO,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,iBAAY,WAAOjoB,GAAgB1R,OAAOgD,WAAY,CAACxC,EAAO4e,MAC1G,kBAAc,wBAAoB,MAAO,CAC7CA,IAAKA,EACLua,MAAO,kBACR,EACC,wBAAoB,OAAQ,IAAa,qBAAiBkI,EAAiBziB,IAAO,IAClF,wBAAoB,OAAQ,IAAa,qBAAiB5e,GAAQ,OAEtE,WAGZ,wBAAoB,WACpB,wBAAoB,UAAW,GAAa,CACxCi8B,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAE9C,MAAO,oBAAsB,QAAS,KAC9F,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,MAAO,GAAa,CACpC8C,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,iBAAmB,YAAa,KAC/F,wBAAoB,OAAQ,IAAa,sBAAiB,WAAOjoB,GAAgB1R,OAAOkD,aAAakQ,IAAM,OAAQ,sBAAiB,WAAO1B,GAAgB1R,OAAOkD,aAAamQ,OAAQ,MAE3L,wBAAoB,MAAO,GAAa,CACpCopB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,iBAAmB,YAAa,KAC/F,wBAAoB,OAAQ,IAAa,sBAAiB,WAAOjoB,GAAgB1R,OAAOkD,aAAaoQ,IAAM,OAAQ,sBAAiB,WAAO5B,GAAgB1R,OAAOkD,aAAaqQ,OAAQ,MAE3L,wBAAoB,MAAO,GAAa,CACpCkpB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,iBAAmB,aAAc,KAChG,wBAAoB,OAAQ,IAAa,sBAAiB,WAAOjoB,GAAgB1R,OAAOkD,aAAasQ,KAAO,OAAQ,sBAAiB,WAAO9B,GAAgB1R,OAAOkD,aAAauQ,QAAS,MAE7L,wBAAoB,MAAO,GAAa,CACpCgpB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,iBAAmB,aAAc,KAChG,wBAAoB,OAAQ,IAAa,sBAAiB,WAAOjoB,GAAgB1R,OAAOkD,aAAawQ,KAAM,MAE/G,wBAAoB,MAAO,GAAa,CACpC+oB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,iBAAmB,aAAc,KAChG,wBAAoB,OAAQ,IAAa,sBAAiB,WAAOjoB,GAAgB1R,OAAOkD,aAAayQ,IAAK,MAE9G,wBAAoB,MAAO,GAAa,CACpC8oB,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,iBAAmB,cAAe,KACnG,wBAAoB,OAAQ,IAAa,sBAAiB,WAAOjoB,GAAgB1R,OAAOkD,aAAa0Q,OAAQ,UAIzH,wBAAoB,WACpB,wBAAoB,UAAW,GAAa,CACxC6oB,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAE9C,MAAO,oBAAsB,QAAS,KAC9F,wBAAoB,MAAO,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,iBAAY,WAAOjoB,GAAgB1R,OAAOmD,UAAY2/B,KAClG,kBAAc,wBAAoB,MAAO,CAC7C1jB,IAAK0jB,EAAK9hC,GACV24B,MAAO,mBACR,EACC,wBAAoB,MAAO,CACvBA,MAAO,mBACPgD,QAAUC,IAAW,OAxHzCmG,EAwHyDD,EAAK9hC,QAvH9E0hC,EAAcliC,MAAM6G,IAAI07B,GACxBL,EAAcliC,MAAMmD,OAAOo/B,GAG3BL,EAAcliC,MAAMwiC,IAAID,IALhC,IAAwBA,IAyHmB,EACC,wBAAoB,OAAQ,IAAa,qBAAiBL,EAAcliC,MAAM6G,IAAIy7B,EAAK9hC,IAAM,IAAM,KAAM,IACzG,wBAAoB,OAAQ,IAAa,qBAAiB8hC,EAAKnhC,MAAO,IACtE,wBAAoB,OAAQ,CACxBg4B,OAAO,oBAAgB,CAAC,cAAekJ,EAAeC,EAAKltB,WAC5D,SAAU,qBAAiBktB,EAAKltB,QAAU,KAAM,IACpD,EAAe,KAClB,wBAAoB,SACnB8sB,EAAcliC,MAAM6G,IAAIy7B,EAAK9hC,KAAO8hC,EAAK/sB,WACnC,kBAAc,wBAAoB,MAAO,GAAa,GACpD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY+sB,EAAK/sB,SAAWktB,KACxE,kBAAc,wBAAoB,MAAO,CAC7C7jB,IAAK6jB,EAAMjiC,GACX24B,MAAO,mBACR,EACC,wBAAoB,OAAQ,IAAa,qBAAiBsJ,EAAMthC,MAAO,IACvE,wBAAoB,OAAQ,CACxBg4B,OAAO,oBAAgB,CAAC,eAAgBkJ,EAAeI,EAAMrtB,YAC9D,qBAAiBqtB,EAAMrtB,QAAU,KAAM,GACzCqtB,EAAMptB,SAAWotB,EAAMptB,QAAQvW,OAAS,IAClC,kBAAc,wBAAoB,MAAO,GAAa,GACpD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY2jC,EAAMptB,QAAS,CAACqtB,EAAQn5B,MAChF,kBAAc,wBAAoB,OAAQ,CAC9CqV,IAAKrV,EACL4vB,MAAO,eACR,qBAAiBuJ,EAAO9jC,MAAO,KAClC,UAEN,wBAAoB,QAAQ,OAEtC,UAEN,wBAAoB,QAAQ,IAClC,wBAAoB,eACnB0jC,EAAKjtB,SAAWitB,EAAKjtB,QAAQvW,OAAS,IAChC,kBAAc,wBAAoB,MAAO,GAAa,GACpD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYwjC,EAAKjtB,QAAS,CAACqtB,EAAQn5B,MAC/E,kBAAc,wBAAoB,OAAQ,CAC9CqV,IAAKrV,EACL4vB,MAAO,eACR,qBAAiBuJ,EAAO9jC,MAAO,KAClC,UAEN,wBAAoB,QAAQ,OAEtC,eAIb,kBAAc,wBAAoB,MAAO,GAAa,IAAKq9B,EAAO,MAAQA,EAAO,IAAM,EAClF,wBAAoB,IAAK,KAAM,UAAW,cAM1E,ICnRJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAE9C,MAAO,gBACtB,GAAa,CAAC,MAAO,OAM3B,IAA6B,qBAAiB,CAC1C2B,OAAQ,kBACR,KAAAE,CAAMC,GACF,MAAM6C,GAAY,IAAA3e,gBAEZwjB,GAAa,IAAAljC,KAAI,IAAIG,KACrBgjC,GAAiB,IAAAnjC,KAAI,IACrBw+B,EAAkB,IAAIr+B,IAO5B,SAASijC,EAAapsB,GAElB,OAAIwnB,EAAgBp3B,IAAI4P,GACb4Y,QAAQC,QAAQ2O,EAAgBx9B,IAAIgW,IAExC,IAAI4Y,QAAQ,CAACC,EAAS+O,KACzB,MAAMC,EAAM,IAAIC,MAChBD,EAAIE,OAAS,KACTP,EAAgBl8B,IAAI0U,EAAK6nB,GACzBzgC,QAAQC,IAAI,6BAA8B2Y,GAC1C6Y,EAAQgP,IAEZA,EAAIG,QAAU,KACV5gC,QAAQM,MAAM,6BAA8BsY,GAC5C4nB,EAAO,IAAI97B,MAAM,6BAA6BkU,OAElD6nB,EAAII,IAAMjoB,GAElB,CAeA,SAASqsB,EAAuBC,GAC5B,MAAwB,WAApBA,EAAOrsB,SACA,kBAEJ,YAAYqsB,EAAOrsB,UAC9B,CAIA,SAASssB,EAAeD,GACpB,MAAMpF,EAAQ,CACV9mB,SAAUksB,EAAOlsB,SAAW,GAAGvC,WAC/BwB,UAAW,SAASitB,EAAOnsB,OAAS,MAOxC,MAJwB,WAApBmsB,EAAOrsB,eAAsChX,IAAbqjC,EAAO7lC,QAAgCwC,IAAbqjC,EAAO9lC,IACjE0gC,EAAMsF,KAAO,GAAGF,EAAO7lC,MACvBygC,EAAMuF,IAAM,GAAGH,EAAO9lC,OAEnB0gC,CACX,CAgIA,OA3CA,IAAAO,OAAM,IAAMJ,EAAU1e,aAAa9E,QAAS,CAAC6oB,EAAYC,KACrD,IAAKA,EAGD,YADAR,EAAe5iC,MAAQ,IAAImjC,IAI/B,MAAME,EAAS,IAAIzU,IAAIwU,EAAW7kC,IAAIojC,GAAKA,EAAEr+B,cACvCggC,EAAS,IAAI1U,IAAIuU,EAAW5kC,IAAIojC,GAAKA,EAAEr+B,cAE7C8/B,EAAWthC,QAAQihC,IACVO,EAAOz8B,IAAIk8B,EAAOz/B,cApE/B,SAAsBA,GAClB,MAAMi6B,EAAKoF,EAAW3iC,MAAMS,IAAI6C,GAC5Bi6B,EACA,KAAQA,EAAI,CACR1mB,QAAS,EACTyB,SAAU,GACV2kB,KAAM,YACN0B,WAAY,KACRiE,EAAe5iC,MAAQ4iC,EAAe5iC,MAAMU,OAAOihC,GAAKA,EAAEr+B,cAAgBA,GAC1Eq/B,EAAW3iC,MAAMmD,OAAOG,MAKhCs/B,EAAe5iC,MAAQ4iC,EAAe5iC,MAAMU,OAAOihC,GAAKA,EAAEr+B,cAAgBA,EAElF,CAqDYigC,CAAaR,EAAOz/B,eAI5B6/B,EAAWrhC,QAAQihC,IACf,GAAKM,EAAOx8B,IAAIk8B,EAAOz/B,aAIlB,CAED,MAAMkgC,EAAYJ,EAAW74B,KAAKo3B,GAAKA,EAAEr+B,cAAgBy/B,EAAOz/B,aAC5DkgC,GAAaA,EAAU/sB,MAAQssB,EAAOtsB,KA7DtD1V,eAA4BgiC,GACxB,MAAMx5B,EAAQq5B,EAAe5iC,MAAMwJ,UAAUm4B,GAAKA,EAAEr+B,cAAgBy/B,EAAOz/B,aAC3E,IAAe,IAAXiG,EACA,OAEJ,UACUs5B,EAAaE,EAAOtsB,IAC9B,CACA,MAAOtY,GACHN,QAAQM,MAAM,oCAAqCA,EACvD,CACA,MAAMo/B,EAAKoF,EAAW3iC,MAAMS,IAAIsiC,EAAOz/B,aACnCi6B,EAEA,KAAQA,EAAI,CACR1mB,QAAS,EACTyB,SAAU,GACV2kB,KAAM,YACN0B,WAAY,KAERiE,EAAe5iC,MAAMuJ,GAASw5B,EAE9BU,WAAW,KACP,KAAQlG,EAAI,CACR1mB,QAASksB,EAAOlsB,SAAW,EAC3ByB,SAAU,GACV2kB,KAAM,gBAEX,OAKX2F,EAAe5iC,MAAMuJ,GAASw5B,CAEtC,CA2BgBW,CAAaX,EAErB,MA5GRhiC,eAAyBgiC,GAErB,UACUF,EAAaE,EAAOtsB,IAC9B,CACA,MAAOtY,GACHN,QAAQM,MAAM,oCAAqCA,EACvD,CACAykC,EAAe5iC,MAAM2D,KAAKo/B,GAE1BU,WAAW,KACP,MAAMlG,EAAKoF,EAAW3iC,MAAMS,IAAIsiC,EAAOz/B,aACnCi6B,GACA,SAAYA,EAAI,CAAE1mB,QAAS,GAAK,CAC5BA,QAASksB,EAAOlsB,SAAW,EAC3ByB,SAAU,GACV2kB,KAAM,gBAGf,GACP,CAgFY0G,CAAUZ,MAUnB,CAAEa,MAAM,KAEX,IAAA7H,WAAU,KAEF+B,EAAU1e,aAAa9E,QAAQxb,OAAS,IACxC8jC,EAAe5iC,MAAQ,IAAI89B,EAAU1e,aAAa9E,aAG1D,IAAAskB,iBAAgB,KAEZ+D,EAAW3iC,MAAM8B,QAAQy7B,IACrBM,GAA2BN,OAG5B,CAACvB,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,GACxD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY2G,EAAe5iC,MAAQ+iC,KAC/E,kBAAc,wBAAoB,MAAO,CAC7CnkB,IAAKmkB,EAAOz/B,YACZugC,SAAS,EACTpkC,IAAK89B,GApKrB,SAAsBj6B,EAAai6B,GAC3BA,IACAoF,EAAW3iC,MAAM+B,IAAIuB,EAAai6B,GAElCF,GAAqBE,EAAI,CAAC,UAAW,cAE7C,CA8J2BuG,CAAaf,EAAOz/B,YAAai6B,GAC5CpE,OAAO,oBAAgB,CAAC,mBAAoB2J,EAAuBC,KACnEpF,OAAO,oBAAgBqF,EAAeD,KACvC,EACC,wBAAoB,MAAO,CACvBrE,IAAKqE,EAAOtsB,IACZqoB,IAAK,GAAGiE,EAAOz/B,iBACf61B,MAAO,gBACR,KAAM,EAAe,KACzB,KACH,QAGhB,ICvNJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBC0ZhE,MAAM4K,GAAc,IA7Y3B,MAME,QAAAriB,GACE,OAAOsiB,GAAA,IACT,CAOA,YAAAriB,CAAazJ,EAAcC,GACzB,OAAO6rB,GAAA,GAAuB9rB,EAAMC,EACtC,CAOA,iBAAAyJ,CAAkBxJ,EAAmByJ,GACnC,OAAOmiB,GAAA,GAA4B5rB,EAAWyJ,EAChD,CAKA,iBAAA4B,CAAkBhe,GAChB,OAAOu+B,GAAA,GAA4Bv+B,EACrC,CAOA,kBAAA4c,CAAmBC,EAAkBC,GACnC,OAAOyhB,GAAA,GAA6B1hB,EAAUC,EAChD,CAQA,qBAAAN,CAAsBzf,GACpB,OAAOwhC,GAAU/hB,sBAAsBzf,EACzC,CAKA,iBAAAsf,CAAkBtf,GAChB,OAAOwhC,GAAA,GAA4BxhC,EACrC,CAKA,oBAAAuf,CAAqBvf,GACnB,OAAOwhC,GAAA,GAA+BxhC,EACxC,CAMA,wBAAA0f,CAAyBC,EAA8B,SACrD,OAAO6hB,GAAU9hB,yBAAyBC,EAC5C,CASA,eAAAe,CAAgBC,EAAoBC,EAAgB,GAClD,OAAO4gB,GAAA,GAA0B7gB,EAAYC,EAC/C,CAMQ,eAAA6gB,CAAgBC,GACtB,GAAW,MAAPA,GAAqB,OAAPA,GAAsB,OAAPA,EAC/B,OAAOC,SAASD,GAIlB,MAAM78B,EAAQ68B,EAAG78B,MAAM,kBACvB,GAAIA,EAAO,CACT,MAAM8G,EAAQg2B,SAAS98B,EAAM,IACvB+8B,EAAQD,SAAS98B,EAAM,IAC7B,IAAIwB,EAAQ,EACZ,IAAK,IAAIzB,EAAI,EAAGA,EAAI+G,EAAO/G,IACzByB,GAAS9E,KAAK+c,MAAM/c,KAAKsQ,SAAW+vB,GAAS,EAE/C,OAAOv7B,CACT,CAEA,OAAO,CACT,CAQA,qBAAAw7B,CAAsB/hB,EAA6BgiB,EAAsBlhB,EAAgB,GACvF,MACMmhB,EAAcD,EADJ1mC,KAAKqmC,gBAAgB3hB,EAAS5f,aAAayQ,IAE3D,OAAOvV,KAAKslB,gBAAgBqhB,EAAanhB,EAC3C,CAMA,mBAAAohB,CAAoBC,GAIlB,OAFiBA,EAAYjiC,WAAW6P,KAC3BtO,KAAK+c,MAAsB,GAAhB/c,KAAKsQ,UAAiB,EAEhD,CAUA,aAAAqwB,CACEpiB,EACAC,EACAoiB,EACAC,EACAN,GAGA,MAAMO,EAAUjnC,KAAKykB,mBAAmBsiB,EAAaC,GAE/CE,EAAuB,CAC3BlmC,KAAM,SACNma,QAASuJ,EAAS9hB,GAClBwY,SAAUuJ,EAAS/hB,GACnByY,WAAY,QACZC,UAAW,KACXhB,KAAM2sB,EAAQriB,cAIhB,GAAuB,kBAAnBqiB,EAAQp/B,OAA4B,CAEtC,MAAMs/B,EAASziB,EAASpgB,WAAaogB,EAAS9I,MAC9C,GAAIurB,EAAQ,CACV,MAAM3vB,EAASxX,KAAKymC,sBAAsBU,EAAQT,GAClDQ,EAAO1vB,OAASA,EAChB0vB,EAAOh9B,YAAc,GAAGwa,EAAS9hB,cAAc4U,QAG/CmN,EAAS7I,UAAY3V,KAAKC,IAAI,EAAGue,EAAS7I,UAAYtE,EACxD,CACF,KAA8B,kBAAnByvB,EAAQp/B,OACjBq/B,EAAOh9B,YAAc,GAAGya,EAAS/hB,YAEjCskC,EAAOh9B,YAAc,YAGvB,OAAOg9B,CACT,CAOA,aAAAE,CAAcC,EAA4BC,GAExC,MAAMC,EAAaF,EAAQ/iC,WAAWM,WAAW6P,KAAO4yB,EAAQzrB,OAAOhX,WAAW6P,KAAO,GACnF+yB,EAAYF,EAAOhjC,WAAWM,WAAW6P,KAAO6yB,EAAO1rB,OAAOhX,WAAW6P,KAAO,GAEhFwyB,EAAUjnC,KAAKykB,mBAAmB8iB,EAAYC,GAE9ChjC,EAA6B,kBAAnByiC,EAAQp/B,OAExB,MAAO,CACLrD,UACA8V,KAAM2sB,EAAQriB,aACd6iB,YAAajjC,OAAU1C,EAAY,kBAEvC,CAQA,aAAA4lC,CAAc9lC,EAAmBga,EAAc+rB,EAAoB,IACjE,IAIE,GAHA1nC,QAAQC,IAAI,uBAAwB0B,EAAO2B,KAAM,KAAMqY,EAAMrY,OAGxD3B,IAAWga,EACd,MAAM,IAAIjX,MAAM,aAGlB,GAAIgjC,GAAa,EACf,MAAM,IAAIhjC,MAAM,eAIlB,MAAMijC,EAAuC,CAC3ChlC,GAAIhB,EAAOgB,GACX0B,UAAW1C,EACXia,UAAU,EACVC,UAAWla,EAAOkD,aAAakQ,GAC/B+G,UAAWna,EAAOkD,aAAaoQ,GAC/B8G,WAAYpa,EAAOkD,aAAasQ,IAChC6G,cAAe,GACfC,WAAYlc,KAAK4mC,oBAAoBhlC,IAGjCimC,EAAsC,CAC1CjlC,GAAIgZ,EAAMhZ,GACVgZ,QACAC,UAAU,EACVC,UAAWF,EAAM9W,aAAakQ,GAC9B+G,UAAWH,EAAM9W,aAAaoQ,GAC9B8G,WAAYJ,EAAM9W,aAAasQ,IAC/B6G,cAAe,GACfC,WAAYlc,KAAK4mC,oBAAoBhrB,IAGjCW,EAAwB,GAC9B,IAAIF,EAAe,EACf9V,EAAsD,SAG1D,KAAO8V,GAAgBsrB,GAAwB,WAAXphC,GAAqB,CACvD,MAAMmV,EAA0B,GAG1BosB,EACJF,EAAkB1rB,YAAc2rB,EAAiB3rB,WAC7C,CAAC0rB,EAAmBC,GACpB,CAACA,EAAkBD,GAGzB,IAAK,MAAMG,KAASD,EAAO,CACzB,MAAMrY,EAASsY,IAAUH,EAAoBC,EAAmBD,EAGhE,GAAIG,EAAMjsB,WAAa,GAAK2T,EAAO3T,WAAa,EAC9C,MAIF,MAAMirB,EAAcgB,EAAMzjC,WAAWmR,OAAO5S,IAAI,OAASklC,EAAMnsB,OAAOnG,OAAO5S,IAAI,OAAS,GACpFmkC,EAAavX,EAAOnrB,WAAWmR,OAAO5S,IAAI,OAAS4sB,EAAO7T,OAAOnG,OAAO5S,IAAI,OAAS,GAGrFqkC,EAASlnC,KAAK8mC,cAAciB,EAAOtY,EAAQsX,EAAaC,EAAY,GAC1EtrB,EAAQ3V,KAAKmhC,EACf,CAGA3qB,EAAOxW,KAAK,CACV0V,YAAaY,EACbX,UACA/B,UAAWhJ,KAAKC,QAIdg3B,EAAkB9rB,WAAa,EACjCvV,EAAS,SACAshC,EAAiB/rB,WAAa,IACvCvV,EAAS,WAGX8V,GACF,CAGe,WAAX9V,IACFA,EAAS,SACTtG,QAAQC,IAAI,gCAGd,MAAM2H,EAAuB,CAC3BtB,SACAgW,SACAyrB,OAAmB,YAAXzhC,EAAuB3E,EAAOgB,GAAgB,WAAX2D,EAAsBqV,EAAMhZ,QAAKd,EAC5EmmC,MAAkB,YAAX1hC,EAAuBqV,EAAMhZ,GAAgB,WAAX2D,EAAsB3E,EAAOgB,QAAKd,EAC3E4O,QAASC,KAAKC,OAYhB,MARe,YAAXrK,GAAwBqV,EAAMX,OAChCpT,EAAOqgC,QAAU,CACf78B,MAAOuQ,EAAMX,KACbktB,WAAoC,GAAxBvsB,EAAM9W,aAAakQ,KAInC/U,QAAQC,IAAI,uBAAwBqG,GAC7BsB,CACT,CAAE,MAAOtH,GAGP,MAFAN,QAAQM,MAAM,yBAA0BA,GACxC6D,OAAO7D,MAAM,UACPA,CACR,CACF,CASA,aAAAklB,CAAczJ,EAAoB0J,GAChC,OAAO0gB,GAAA,GAAwBpqB,EAAY0J,EAC7C,CAOA,kBAAA0iB,CACE9jC,EACAohB,GAMA,MAAMpL,EAAOta,KAAKgkB,kBAAkB,KAAM1f,EAAUQ,aAAasQ,KAC3DizB,EAA6B,YAAhB/tB,EAAKzS,OAAuB6d,EAAQR,QAAUQ,EAAQlhB,QAGzE,MAAO,CAAE8V,OAAM+tB,aAAYC,SAFVtoC,KAAKylB,cAAcnhB,EAAUQ,aAAasQ,IAAKizB,GAGlE,CAUA,aAAAE,CAAcjkC,EAA8BkW,EAAmBguB,EAAuB,IACpF,OAAOlkC,EAAUmR,OAAO5S,IAAI2X,IAAcguB,CAC5C,CAQA,aAAAC,CAAcnkC,EAA8BkW,EAAmBpY,GAC7DkC,EAAUmR,OAAOtR,IAAIqW,EAAWrU,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKjE,IAC5D,CAMA,gBAAAsmC,CAAiBC,GAIf,GAFa3oC,KAAK8jB,WAEP6kB,EAAc,CACvB,MAAMC,EAAcziC,KAAK+c,MAAsB,GAAhB/c,KAAKsQ,UAAiB,EAErD,MAAO,CAAEoyB,UAAU,EAAMC,SADR3iC,KAAKE,IAAI,IAAKsiC,EAAeC,GAEhD,CAEA,MAAO,CAAEC,UAAU,EAAOC,SAAUH,EACtC,GClZWI,IAAiB,IAAApnC,aAAY,SAAU,KAElD,MAAMqnC,GAAgB,IAAAnnC,UAA6BC,GAC7C+f,GAAa,IAAAhgB,MAAI,GACjBonC,GAAgB,IAAApnC,KAAmB,IAGnCqnC,GAAW,IAAA/mC,UAAS,IAAM6mC,EAAc5mC,OAAOQ,IAE/CyZ,GAAe,IAAAla,UAAS,IAAM6mC,EAAc5mC,OAAOia,cAAgB,GAEnEC,GAAc,IAAAna,UAAS,IAAM6mC,EAAc5mC,OAAOka,aAAe,GAEjE/V,GAAS,IAAApE,UAAS,IAAM6mC,EAAc5mC,OAAOmE,QAAU,UAEvD6V,GAAe,IAAAja,UAAS,IAAM6mC,EAAc5mC,OAAOga,cAAgB,IAEnE+sB,GAAqB,IAAAhnC,UAAS,IAAMia,EAAaha,MAAMU,OAAOi8B,GAAKA,EAAEljB,WAErEutB,GAAoB,IAAAjnC,UAAS,IAAMia,EAAaha,MAAMU,OAAOi8B,IAAMA,EAAEljB,WAErEwtB,GAAqB,IAAAlnC,UAAS,KAClC,GAAK6mC,EAAc5mC,MACnB,OAAOga,EAAaha,MAAM4mC,EAAc5mC,MAAMka,eAG1CgtB,GAAe,IAAAnnC,UAAS,IAAMknC,EAAmBjnC,OAAOyZ,WAAY,GAEpEU,GAAS,IAAApa,UAAS,IAAM6mC,EAAc5mC,OAAOma,QAAU,IAEvDgtB,GAAc,IAAApnC,UAAS,KAC3B,GAA4B,IAAxBoa,EAAOna,MAAMlB,OACjB,OAAOqb,EAAOna,MAAMma,EAAOna,MAAMlB,OAAS,KAGtCgZ,GAAW,IAAA/X,UAAS,IAAuB,WAAjBoE,EAAOnE,OAEjConC,GAAY,IAAArnC,UAAS,IAAuB,YAAjBoE,EAAOnE,OAElCqnC,GAAW,IAAAtnC,UAAS,IAAuB,WAAjBoE,EAAOnE,OAEjCsnC,GAAY,IAAAvnC,UAAS,IAAuB,YAAjBoE,EAAOnE,OAmExC,SAASwkC,EAAoB+C,GAE3B,OAAOA,EAAMxjC,KAAK+c,MAAsB,GAAhB/c,KAAKsQ,UAAiB,CAChD,CAoEA,SAASmzB,IACP,IAAKZ,EAAc5mC,MAAO,OAE1B,MAAMynC,EAAeV,EAAmB/mC,MAAMwH,KAAKm1B,GAAKA,EAAEjjB,UAAY,GAChEguB,EAAeV,EAAkBhnC,MAAMwH,KAAKm1B,GAAKA,EAAEjjB,UAAY,GAEhE+tB,EAEOC,GACVC,EAAU,WAFVA,EAAU,SAId,CAKA,SAASC,IACFhB,EAAc5mC,QAEnB4mC,EAAc5mC,MAAMka,cAGhB0sB,EAAc5mC,MAAMka,aAAeF,EAAaha,MAAMlB,QACxD+oC,IAEJ,CAKA,SAASA,IACFjB,EAAc5mC,QAEnB4mC,EAAc5mC,MAAMia,eACpB2sB,EAAc5mC,MAAMka,YAAc,EAYpC,WACE,IAAK0sB,EAAc5mC,MAAO,OAE1Bga,EAAaha,MAAM8B,QAAQ2iC,IAEzBA,EAAY5qB,cAAc/X,QAAQyW,IAC5BA,EAAOA,OAAOG,iBAChB+rB,EAAY/qB,UAAY3V,KAAKC,IAAI,EAAGygC,EAAY/qB,UAAYnB,EAAOA,OAAOG,gBAC1E7a,QAAQC,IAAI,kBAAkB2mC,EAAYjkC,SAAS+X,EAAOpX,UAAUoX,EAAOA,OAAOG,uBAIhFH,EAAOD,SAAW,GACpBC,EAAOD,aAKXmsB,EAAY5qB,cAAgB4qB,EAAY5qB,cAAcnZ,OAAO6X,GAA8B,IAApBA,EAAOD,YAIhFkvB,GACF,CAhCEM,GAEAjqC,QAAQC,IAAI,sBAAsB8oC,EAAc5mC,MAAMia,mBACtDjY,OAAOoB,KAAK,KAAKwjC,EAAc5mC,MAAMia,mBACvC,CAsFA,SAAS0tB,EAAUI,GACjB,GAAKnB,EAAc5mC,MAEnB,IAUE,OATA4mC,EAAc5mC,MAAMmE,OAAS4jC,EAC7BtoB,EAAWzf,OAAQ,EAGnB6mC,EAAc7mC,MAAM2D,KAAKijC,EAAc5mC,OAEvCnC,QAAQC,IAAI,uBAAwBiqC,GAG5BA,GACN,IAAK,UACH/lC,OAAOI,QAAQ,SACf,MACF,IAAK,SACHJ,OAAO7D,MAAM,WACb,MACF,IAAK,UACH6D,OAAOoB,KAAK,QAGlB,CAAE,MAAOjF,GAEP,MADAN,QAAQM,MAAM,yBAA0BA,GAClCA,CACR,CACF,CA+DA,MAAO,CAELyoC,gBACAnnB,aACAonB,gBAGAC,WACA7sB,eACAC,cACA/V,SACA6V,eACA+sB,qBACAC,oBACAC,qBACAC,eACA/sB,SACAgtB,cACArvB,WACAsvB,YACAC,WACAC,YAGAU,YArXF,SAAqBxoC,EAAmByoC,EAAkB9zB,GACxD,IAEE,MAAM6F,EAAoC,GAG1CA,EAAarW,KAAK,CAChBnD,GAAIhB,EAAOgB,GACX0B,UAAW1C,EACXia,UAAU,EACVC,UAAWla,EAAOkD,aAAakQ,GAC/B+G,UAAWna,EAAOkD,aAAaoQ,GAC/B8G,WAAYpa,EAAOkD,aAAasQ,IAChC6G,cAAe,GACfC,WAAY0qB,EAAoBhlC,EAAOgD,WAAW6P,OAIpD41B,EAAQnmC,QAAQ0X,IACdQ,EAAarW,KAAK,CAChBnD,GAAIgZ,EAAMhZ,GACVgZ,QACAC,UAAU,EACVC,UAAWF,EAAM9W,aAAakQ,GAC9B+G,UAAWH,EAAM9W,aAAaoQ,GAC9B8G,WAAYJ,EAAM9W,aAAasQ,IAC/B6G,cAAe,GACfC,WAAY0qB,EAAoBhrB,EAAMhX,WAAW6P,SAKrD2H,EAAamO,KAAK,CAAC1gB,EAAGwkB,IAAMA,EAAEnS,WAAarS,EAAEqS,YAG7C8sB,EAAc5mC,MAAQ,CACpBQ,GAAI,UAAU+N,KAAKC,QACnBwL,eACAC,aAAc,EACdC,YAAa,EACb/V,OAAQ,SACRgW,OAAQ,GACR9L,UAAWE,KAAKC,MAChB2F,eAGFsL,EAAWzf,OAAQ,EAEnBnC,QAAQC,IAAI,uBAAwB8oC,EAAc5mC,MAAMQ,IACxDwB,OAAOkE,QAAQ,QACjB,CAAE,MAAO/H,GAGP,MAFAN,QAAQM,MAAM,yBAA0BA,GACxC6D,OAAO7D,MAAM,UACPA,CACR,CACF,EA+TE+pC,cAlTF,SAAuBpD,GACrB,IAAK8B,EAAc5mC,MACjB,MAAM,IAAIuC,MAAM,cAGlB,IAEE,IAAI4lC,EAAmBhuB,EAAOna,MAAMuK,KAAKmmB,GAAKA,EAAErX,cAAgBY,EAAaja,OAExEmoC,IAEHA,EAAmB,CACjB9uB,YAAaY,EAAaja,MAC1BsZ,QAAS,GACT/B,UAAWhJ,KAAKC,OAElBo4B,EAAc5mC,MAAMma,OAAOxW,KAAKwkC,IAIlCA,EAAiB7uB,QAAQ3V,KAAKmhC,GAE9BjnC,QAAQC,IAAI,uBAAwBgnC,EAAOlmC,MAiB/C,SAA8BkmC,GAC5B,IAAK8B,EAAc5mC,MAAO,OAG1B,GAAI8kC,EAAO1vB,QAAU0vB,EAAO9rB,SAAU,CACpC,MAAMqU,EAASrT,EAAaha,MAAMuK,KAAKoyB,GAAKA,EAAEn8B,KAAOskC,EAAO9rB,UACxDqU,IACFA,EAAO3T,UAAY3V,KAAKC,IAAI,EAAGqpB,EAAO3T,UAAYorB,EAAO1vB,QACzDvX,QAAQC,IAAI,kBAAkBgnC,EAAO9rB,eAAe8rB,EAAO1vB,cAGlC,IAArBiY,EAAO3T,WACT7b,QAAQC,IAAI,kBAAkBgnC,EAAO9rB,iBAG3C,CAGAwuB,GACF,CAjCIY,CAAqBtD,GAGrB8C,GACF,CAAE,MAAOzpC,GAGP,MAFAN,QAAQM,MAAM,yBAA0BA,GACxC6D,OAAO7D,MAAM,UACPA,CACR,CACF,EAiREypC,WACAC,YACAQ,gBA5KF,SAAyBC,EAAuB/vB,GAC9C,MAAMksB,EAAczqB,EAAaha,MAAMuK,KAAKoyB,GAAKA,EAAEn8B,KAAO8nC,GAC1D,IAAK7D,EACH,MAAM,IAAIliC,MAAM,OAAO+lC,SAGzB7D,EAAY5qB,cAAclW,KAAK4U,GAC/B1a,QAAQC,IAAI,kBAAkBwqC,aAAyB/vB,EAAOpX,QAE9D,MAAMonC,EAA6B,SAAhBhwB,EAAO3Z,KAAkB,KAAO,KACnDoD,OAAOoB,KAAK,GAAGmlC,KAAchwB,EAAOpX,OACtC,EAkKEqnC,mBA7JF,SAA4BF,EAAuBG,GACjD,MAAMhE,EAAczqB,EAAaha,MAAMuK,KAAKoyB,GAAKA,EAAEn8B,KAAO8nC,GAC1D,IAAK7D,EACH,MAAM,IAAIliC,MAAM,OAAO+lC,SAGzB,MAAM/vB,EAASksB,EAAY5qB,cAActP,KAAK3C,GAAKA,EAAEpH,KAAOioC,GACxDlwB,IACFksB,EAAY5qB,cAAgB4qB,EAAY5qB,cAAcnZ,OAAOkH,GAAKA,EAAEpH,KAAOioC,GAC3E5qC,QAAQC,IAAI,kBAAkBwqC,aAAyB/vB,EAAOpX,QAElE,EAmJE6jC,cA9IF,WACE,IAAK4B,EAAc5mC,MACjB,MAAM,IAAIuC,MAAM,cAIlB,MAAMH,EAAU2B,KAAKsQ,SAAW,GAShC,OAPIjS,GACFulC,EAAU,WACV3lC,OAAOI,QAAQ,UAEfJ,OAAOkE,QAAQ,SAGV9D,CACT,EA+HEulC,YACAe,eA1FF,SAAwBJ,GACtB,OAAOtuB,EAAaha,MAAMuK,KAAKoyB,GAAKA,EAAEn8B,KAAO8nC,EAC/C,EAyFEK,kBApFF,SAA2BL,EAAuBhmC,GAChD,MAAMmiC,EAAczqB,EAAaha,MAAMuK,KAAKoyB,GAAKA,EAAEn8B,KAAO8nC,GAC1D,IAAK7D,EACH,MAAM,IAAIliC,MAAM,OAAO+lC,SAGzB1mC,OAAOa,OAAOgiC,EAAaniC,GAC3BzE,QAAQC,IAAI,sBAAsBwqC,UACpC,EA6EEM,eAxEF,WACE,OAAKhC,EAAc5mC,MAEZ,CACL6oC,WAAY5uB,EAAaja,MACzB8oC,YAAa3uB,EAAOna,MAAMihC,OAAO,CAACjf,EAAK+mB,IAAU/mB,EAAM+mB,EAAMzvB,QAAQxa,OAAQ,GAC7EwZ,SAAU/J,KAAKC,MAAQo4B,EAAc5mC,MAAMqO,UAC3C26B,SAAUjC,EAAmB/mC,MAAMzB,IAAIo+B,IAAK,CAC1Cn8B,GAAIm8B,EAAEn8B,GACN4gB,QAASub,EAAEjjB,UACX1V,IAAK24B,EAAEz6B,WAAWQ,aAAamQ,OAAS,KAE1Co2B,QAASjC,EAAkBhnC,MAAMzB,IAAIo+B,IAAK,CACxCn8B,GAAIm8B,EAAEn8B,GACN4gB,QAASub,EAAEjjB,UACX1V,IAAK24B,EAAEnjB,OAAO9W,aAAamQ,OAAS,MAdP,IAiBnC,EAuDEtO,MAlDF,WACEqiC,EAAc5mC,WAAQN,EACtB+f,EAAWzf,OAAQ,EACnBnC,QAAQC,IAAI,yBACd,EA+CEorC,aA1CF,WACErC,EAAc7mC,MAAQ,GACtBnC,QAAQC,IAAI,yBACd,KClZI,GAAa,CAAEq7B,MAAO,qBACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,iBAEL,GAAa,CACfva,IAAK,EACLua,MAAO,kBAEL,GAAa,CACfva,IAAK,EACLua,MAAO,iBAEL,GAAa,CACfva,IAAK,EACLua,MAAO,kBAEL,GAAa,CAAEA,MAAO,iBACtB,GAAa,CAAEA,MAAO,gBACtB,GAAa,CAAEA,MAAO,qBACtB,GAAc,CAAEA,MAAO,oBACvB,GAAc,CAAEA,MAAO,qBACvB,GAAc,CAAEA,MAAO,mBACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,YACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,qBACvB,GAAc,CAAEA,MAAO,oBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,kBAEL,GAAc,CAAC,YACf,GAAc,CAAC,YACf,GAAc,CAChBva,IAAK,EACLua,MAAO,sBAMX,IAA6B,qBAAiB,CAC1C2B,OAAQ,cACRC,MAAO,CAAC,SACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMgO,EAAcxC,KACdyC,GAAe,IAAA3pC,MAAI,GACzB,SAAS4pC,EAAgB5E,GACrB,MAAM5xB,EAAQ4xB,EAAYviC,WAAWQ,aAAamQ,OAAS4xB,EAAYjrB,OAAO9W,aAAamQ,OAAS,EACpG,OAAO9O,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAMwgC,EAAY/qB,UAAY7G,EAAS,KACvE,CACA,SAASy2B,EAAqB7E,GAC1B,OAAO0E,EAAYlC,oBAAoBzmC,KAAOikC,EAAYjkC,EAC9D,CACAO,eAAewoC,IACX,GAAKJ,EAAYvC,gBAAiBwC,EAAappC,MAE/C,IACIopC,EAAappC,OAAQ,EACrB,MAAMR,EAAS2pC,EAAYpC,mBAAmB,GACxCvtB,EAAQ2vB,EAAYnC,kBAAkBz8B,KAAK3C,GAAKA,EAAE8R,UAAY,GACpE,KAAKla,GAAWga,GAAUha,EAAO0C,WAAcsX,EAAMA,OAEjD,YADAxX,OAAO7D,MAAM,aAGjB,MAAMwmC,EAAcZ,GAAYoC,cAAc3mC,EAAO0C,UAAW,KAAM,IAChE0iC,EAAab,GAAYoC,cAAc3sB,EAAMA,MAAO,KAAM,IAC1DsrB,EAASf,GAAYW,cAAcllC,EAAQga,EAAOmrB,EAAaC,EAAY,GACjFuE,EAAYjB,cAAcpD,GACrBqE,EAAYrxB,gBAYzB/W,iBACI,IACI,MAAMvB,EAAS2pC,EAAYpC,mBAAmB,GAC9C,IAAKvnC,IAAWA,EAAO0C,UACnB,aACEZ,EAAW,WAAAsB,sBAAsB,SAAU,CAC7CF,aAAc,CACVkQ,GAAIpT,EAAOka,UACX5G,GAAItT,EAAOma,UACX3G,IAAKxT,EAAOoa,WACZ/G,MAAOrT,EAAO0C,UAAUQ,aAAamQ,MACrCE,MAAOvT,EAAO0C,UAAUQ,aAAaqQ,MACrCE,OAAQzT,EAAO0C,UAAUQ,aAAauQ,OACtCC,IAAK1T,EAAO0C,UAAUQ,aAAawQ,IACnCC,GAAI3T,EAAO0C,UAAUQ,aAAayQ,GAClCC,MAAO5T,EAAO0C,UAAUQ,aAAa0Q,QAGjD,CACA,MAAOjV,GACHN,QAAQM,MAAM,8BAA+BA,EACjD,CACJ,CAjCkBqrC,EAEd,CACA,MAAOrrC,GACHN,QAAQM,MAAM,uBAAwBA,GACtC6D,OAAO7D,MAAM,OACjB,CACA,QACIirC,EAAappC,OAAQ,CACzB,CACJ,CAwBA,MAAMk7B,EAAOC,EACb,MAAO,CAACa,EAAMC,MACF,kBAAc,wBAAoB,MAAO,CAC7C9C,OAAO,oBAAgB,CAAC,eAAgB,CAAE,iBAAiB,WAAOgQ,GAAarxB,aAChF,EACC,wBAAoB,YACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,GAAY,EAClC,WAAOqxB,GAAqB,WACtB,kBAAc,wBAAoB,OAAQ,GAAY,SACtD,WAAOA,GAAsB,YACzB,kBAAc,wBAAoB,OAAQ,GAAY,QACtD,WAAOA,GAAqB,WACxB,kBAAc,wBAAoB,OAAQ,GAAY,QACtD,WAAOA,GAAsB,YACzB,kBAAc,wBAAoB,OAAQ,GAAY,SACvD,wBAAoB,QAAQ,QAGtD,wBAAoB,cACpB,wBAAoB,SAAU,CAC1BhQ,MAAO,wBACPsD,MAAO,OACPN,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAYlB,EAAK,WACtD,MACH,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,KAAM,KAAM,WAAY,sBAAiB,WAAOiO,GAAalvB,cAAgB,MAAO,MAE5G,wBAAoB,MAAO,GAAY,CACnCgiB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,MAAO,KACjE,wBAAoB,MAAO,GAAY,GAClC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,iBAAY,WAAOkN,GAAanC,kBAAoBxtB,KAChG,kBAAc,wBAAoB,MAAO,CAC7CoF,IAAKpF,EAAMhZ,GACX24B,OAAO,oBAAgB,CAAC,oBAAqB,CAAEsQ,KAAMjwB,EAAME,WAAa,EAAGwiB,OAAQoN,EAAqB9vB,OACzG,EACC,wBAAoB,MAAO,IAAa,qBAAiBA,EAAMA,OAAOrY,MAAQqY,EAAMhZ,IAAK,IACzF,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,MAAO,GAAa,CACpCy7B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,KAAM,MAAO,KACpE,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,MAAO,CACvB9C,MAAO,cACPwE,OAAO,oBAAgB,CAAE+L,MAAOL,EAAgB7vB,GAAS,OAC1D,KAAM,IACT,wBAAoB,OAAQ,IAAa,qBAAiBA,EAAME,WAAa,OAAQ,qBAAiBF,EAAMA,OAAO9W,aAAamQ,OAAQ,UAIrJ,KACH,WAGZ,wBAAoB,MAAO,GAAa,CACpCopB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,MAAO,KACjE,wBAAoB,MAAO,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,iBAAY,WAAOkN,GAAapC,mBAAqBvnC,KACjG,kBAAc,wBAAoB,MAAO,CAC7Cof,IAAKpf,EAAOgB,GACZ24B,OAAO,oBAAgB,CAAC,qBAAsB,CAAEsQ,KAAMjqC,EAAOka,WAAa,EAAGwiB,OAAQoN,EAAqB9pC,OAC3G,EACC,wBAAoB,MAAO,IAAa,qBAAiBA,EAAO0C,WAAWf,MAAQ3B,EAAOgB,IAAK,IAChG,KACH,WAGX,WAAO2oC,GAAqB,WACtB,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,SAAU,CAC1BhQ,MAAO,aACP0D,SAAUuM,EAAappC,SAAU,WAAOmpC,GAAajC,aACrD/K,QAASoN,IACV,qBAAiBH,EAAappC,MAAQ,SAAW,MAAO,EAAqB,KAChF,wBAAoB,SAAU,CAC1Bm5B,MAAO,aACP0D,SAAUuM,EAAappC,MACvBm8B,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAYlB,EAAK,WACtD,KAAM,EAAe,SAEzB,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,SAAU,CAC1B/B,MAAO,YACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAYlB,EAAK,WACtD,cAEZ,GAEX,IC3LJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCiahE,MAAMyO,GAAqB,IAnZlC,MAIU,QAAAC,CAAS9kC,EAAc+kC,GAE7B,MAAMC,EAAa,IAAIC,OAAO,GAAGF,eAC3BG,EAAWllC,EAAKuC,MAAMyiC,GAC5B,GAAIE,EACF,OAAO7F,SAAS6F,EAAS,IAI3B,MAAMC,EAAsC,CAC1C,GAAI,EACJ,GAAI,GACJ,GAAI,GACJ,GAAI,GACJ,GAAI,GACJ,GAAI,GACJ,GAAI,GACJ,GAAI,GACJ,GAAI,GACJ,GAAI,IAGN,IAAK,MAAOrtB,EAASjY,KAAQ/C,OAAOC,QAAQooC,GAAc,CAExD,GADgB,IAAIF,OAAO,GAAGntB,OAAaitB,KAAiBA,OAAmBjtB,KACnEstB,KAAKplC,GACf,OAAOH,CAEX,CAGF,CAKQ,eAAAwlC,CAAgBrlC,EAAc+kC,GACpC,MAAM1b,EAAc,CAClB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,MACA,MAGF,IAAK,MAAMvpB,KAAcupB,EAAa,CAEpC,GADgB,IAAI4b,OAAO,GAAGF,OAAmBjlC,KAAcA,OAAgBilC,KACnEK,KAAKplC,GACf,OAAOF,CAEX,CAGF,CAMQ,eAAAwlC,CAAgBtlC,EAAc+kC,EAAuBllC,GAC3D,MAAMnC,EAA6B,CACjC0P,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,GACLC,IAAK,IAoDD23B,EAAiB,CAACC,EAA4BC,KAClD,MAAMC,EAAU,IAAIT,OAAO,GAAGF,WAAuBA,KAC/CY,EAAe3lC,EAAKuC,MAAMmjC,KAAW,IAAM1lC,EAEjD,IAAK,MAAM8X,KAAW2tB,EAASG,KAC7B,GAAID,EAAa/mC,SAASkZ,GAAU,CAClCpa,EAAW8nC,GAAQvmC,KAAKE,IAAI,GAAIzB,EAAW8nC,GAAQ,IACnD,KACF,CAGF,IAAK,MAAM1tB,KAAW2tB,EAASI,IAC7B,GAAIF,EAAa/mC,SAASkZ,GAAU,CAClCpa,EAAW8nC,GAAQvmC,KAAKC,IAAI,GAAIxB,EAAW8nC,GAAQ,IACnD,KACF,GAgCJ,OA5BAD,EAAe,MAnEK,CAClBK,KAAM,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAC3CC,IAAK,CAAC,KAAM,KAAM,KAAM,KAAM,QAkEhCN,EAAe,MA9DK,CAClBK,KAAM,CAAC,KAAM,KAAM,KAAM,OAAQ,OACjCC,IAAK,CAAC,KAAM,KAAM,KAAM,KAAM,QA6DhCN,EAAe,MAzDK,CAClBK,KAAM,CAAC,KAAM,KAAM,KAAM,KAAM,MAC/BC,IAAK,CAAC,KAAM,KAAM,KAAM,KAAM,QAwDhCN,EAAe,MApDK,CAClBK,KAAM,CAAC,KAAM,KAAM,KAAM,KAAM,OAAQ,QACvCC,IAAK,CAAC,KAAM,KAAM,KAAM,UAmD1BN,EAAe,MA/CK,CAClBK,KAAM,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACjDC,IAAK,CAAC,KAAM,KAAM,OAAQ,UA8C5BN,EAAe,MA1CK,CAClBK,KAAM,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MACrCC,IAAK,CAAC,KAAM,KAAM,KAAM,QAyC1BN,EAAe,MArCK,CAClBK,KAAM,CAAC,KAAM,KAAM,OAAQ,KAAM,KAAM,MACvCC,IAAK,CAAC,KAAM,KAAM,KAAM,KAAM,QAoChCN,EAAe,MAhCK,CAClBK,KAAM,CAAC,KAAM,OAAQ,OAAQ,KAAM,KAAM,MACzCC,IAAK,CAAC,KAAM,KAAM,cAiCRjrC,IAARiF,IACEA,EAAM,IAERnC,EAAW0P,IAAMnO,KAAKC,IAAI,GAAIxB,EAAW0P,IAAM,IAC/C1P,EAAW4P,IAAMrO,KAAKC,IAAI,GAAIxB,EAAW4P,IAAM,IAC/C5P,EAAWiQ,IAAM1O,KAAKC,IAAI,GAAIxB,EAAWiQ,IAAM,KACtC9N,GAAO,KAEhBnC,EAAW0P,IAAMnO,KAAKC,IAAI,GAAIxB,EAAW0P,IAAM,IAC/C1P,EAAW6P,IAAMtO,KAAKC,IAAI,GAAIxB,EAAW6P,IAAM,IAC/C7P,EAAW2P,IAAMpO,KAAKC,IAAI,GAAIxB,EAAW2P,IAAM,IAC/C3P,EAAWiQ,IAAM1O,KAAKE,IAAI,GAAIzB,EAAWiQ,IAAM,MAKnDjQ,EAAWkQ,IAAM,GAAK3O,KAAK+c,MAAsB,GAAhB/c,KAAKsQ,UAE/B7R,CACT,CAKQ,qBAAAyf,CAAsBzf,GAE5B,MAAMqQ,EAAQ9O,KAAK+c,OAAOte,EAAW2P,IAAM3P,EAAW4P,KAAO,IAGvDW,EAAQhP,KAAK+c,MAAMte,EAAWgQ,IAAM,GAIpCQ,EAAMxQ,EAAWgQ,IAGvB,IAAIU,EAAM,EACN1Q,EAAW6P,IAAM7P,EAAW4P,KAAO5P,EAAW0P,IAAM1P,EAAW4P,IACjEc,EAAM,EACG1Q,EAAW6P,KAAO7P,EAAW4P,KAAO5P,EAAW0P,KAAO1P,EAAW4P,MAC1Ec,EAAM,GAIR,MAAM8O,EAAMxf,EAAW0P,IAAM1P,EAAW4P,IACxC,IAAIe,EAAK,IACLC,EAAQ,EAsBZ,OApBI4O,GAAO,IACT7O,EAAK,KACLC,GAAS,GACA4O,GAAO,IAChB7O,EAAK,KACLC,GAAS,GACA4O,GAAO,KAChB7O,EAAK,IACLC,EAAQ,GACC4O,GAAO,KAChB7O,EAAK,OACLC,EAAQ,GACC4O,GAAO,KAChB7O,EAAK,OACLC,EAAQ,IAERD,EAAK,OACLC,EAAQ,GAGH,CACLR,GAAIC,EACJA,QACAC,GAAIC,EACJA,QACAC,MACAC,OA1Ca,GA2CbC,MACAC,KACAC,QAEJ,CAKQ,0BAAAw3B,CAA2BhmC,EAAqBpC,GACtD,MAAM6Q,EAAS,IAAIzT,IA0BnB,GAvBmB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAAO,QAAS,MAGvDkC,QAAQqW,IACjB,IAAInY,EAAQ,GAGRwC,IACY,OAAV2V,GAAkB3V,EAAW6P,IAC/BrS,EAAQ+D,KAAK+c,MAAMte,EAAW6P,IAAM,GACjB,OAAV8F,GAAkB3V,EAAWiQ,IACtCzS,EAAQwC,EAAWiQ,IACA,OAAV0F,GAAkB3V,EAAW+P,IACtCvS,EAAQ,GAAK+D,KAAK+c,OAAOte,EAAW+P,IAAM,IAAM,GAC7B,OAAV4F,GAAkB3V,EAAW+P,MACtCvS,EAAQ,GAAK+D,KAAK+c,OAAOte,EAAW+P,IAAM,IAAM,KAIpDc,EAAOtR,IAAIoW,EAAOpU,KAAKC,IAAI,EAAGD,KAAKE,IAAI,GAAIjE,OAIzC4E,EAAY,CACWhH,KAAKitC,oBAAoBjmC,GACjC9C,QAAQqW,IAEvB,MAAMnY,EAAQ,GAAK+D,KAAK+c,MAAsB,GAAhB/c,KAAKsQ,UACnChB,EAAOtR,IAAIoW,EAAOnY,IAEtB,CAEA,OAAOqT,CACT,CAKQ,mBAAAw3B,CAAoBjmC,GAqB1B,MApBsD,CACpD,GAAI,CAAC,KAAM,KAAM,MAAO,MAAO,KAAM,UACrC,GAAI,CAAC,KAAM,KAAM,MAAO,KAAM,MAC9B,GAAI,CAAC,MAAO,MAAO,KAAM,QAAS,MAClC,GAAI,CAAC,QAAS,KAAM,KAAM,MAC1B,GAAI,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MACnC,GAAI,CAAC,KAAM,KAAM,KAAM,KAAM,MAC7B,GAAI,CAAC,KAAM,MAAO,KAAM,KAAM,MAC9B,GAAI,CAAC,KAAM,MAAO,KAAM,QAAS,MACjC,GAAI,CAAC,KAAM,KAAM,KAAM,MAAO,KAAM,SACpC,IAAK,CAAC,KAAM,QAAS,KAAM,SAC3B,IAAK,CAAC,OAAQ,OAAQ,QAAS,MAC/B,GAAI,CAAC,KAAM,KAAM,MAAO,QAAS,MACjC,IAAK,CAAC,KAAM,KAAM,MAAO,MACzB,GAAI,CAAC,KAAM,QAAS,MAAO,MAC3B,GAAI,CAAC,KAAM,KAAM,OACjB,GAAI,CAAC,KAAM,OAAQ,MACnB,GAAI,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,OAGVA,IAAe,CAAC,KAAM,MAAO,KAC1D,CAKQ,iBAAAkmC,CAAkBhmC,EAAc+kC,GACtC,MAAMkB,EAA+C,CACnD,GAAI,KACJ,GAAI,KACJ,GAAI,KACJ,GAAI,KACJ,GAAI,KACJ,GAAI,KACJ,GAAI,KACJ,GAAI,KACJ,GAAI,KACJ,GAAI,KACJ,IAAK,MACL,GAAI,KACJ,GAAI,KACJ,GAAI,KACJ,GAAI,KACJ,GAAI,KACJ,GAAI,MAGN,IAAK,MAAOnuB,EAASvG,KAAiBzU,OAAOC,QAAQkpC,GAAuB,CAE1E,GADgB,IAAIhB,OAAO,GAAGF,OAAmBjtB,KAAWA,OAAaitB,KAC7DK,KAAKplC,GACf,OAAOuR,CAEX,CAGF,CAQA,WAAA20B,CAAYlmC,EAAc+kC,GAExB,MAAMllC,EAAM/G,KAAKgsC,SAAS9kC,EAAM+kC,IAAkB,GAAK9lC,KAAK+c,MAAsB,GAAhB/c,KAAKsQ,UACjEzP,EAAahH,KAAKusC,gBAAgBrlC,EAAM+kC,IAAkB,MAG1DrnC,EAAa5E,KAAKwsC,gBAAgBtlC,EAAM+kC,EAAellC,GAGvDjC,EAAe9E,KAAKqkB,sBAAsBzf,GAG1C6Q,EAASzV,KAAKgtC,2BAA2BhmC,EAAYpC,GAGrD6T,EAAezY,KAAKktC,kBAAkBhmC,EAAM+kC,GAGlD,IAAIhlC,EAAa,GAAGglC,OAAmBllC,SAAWC,IAIlD,OAHIyR,IAAcxR,GAAc,WAAWwR,KAC3CxR,GAAc,IAEP,CACLrC,aACAE,eACAkC,aACAD,MACAE,aACAwO,SACAgD,eAEJ,G,wBCrRK,MAAM40B,GAAuB,IAtIpC,MAME,wBAAAC,CAAyBvrC,GACvB,IAAKA,GAAwB,IAAhBA,EAAKb,OAChB,MAAO,GAIT,MAAMqsC,EAAa,IAAIxrC,GAAMwoB,KAAK,CAAC1gB,EAAGwkB,KACpC,MAAMmf,EAAc3jC,EAAEiG,aAAejG,EAAE5G,YAAc,EAAI,GAEzD,OADoBorB,EAAEve,aAAeue,EAAEprB,YAAc,EAAI,IACpCuqC,IAGvB,IAAI1mC,EAAS,cAEb,IAAK,MAAM+nB,KAAW0e,EAAY,CAChC,MAAMz9B,EAAa+e,EAAQ/e,aAAe+e,EAAQ5rB,YAAc,EAAI,GAC9DwqC,EAAYztC,KAAK0tC,wBAAwB59B,GACzCxL,EAAYuqB,EAAQvqB,UAE1BwC,GAAU,KAAKxC,EAAUf,QAAQe,EAAU0C,YAAc,WAAWymC,MACpE3mC,GAAU,QAAQxC,EAAU2C,YAAc,WAC5C,CAIA,OAFAH,GAAU,qDAEHA,CACT,CAOQ,uBAAA4mC,CAAwB59B,GAC9B,MAAM69B,EAAuC,CAC3C,EAAG,eACH,EAAG,YACH,EAAG,YACH,EAAG,iBACH,EAAG,eAGL,OAAOA,EAAa79B,IAAe69B,EAAa,EAClD,CAQA,eAAAC,CAAgB/e,EAA8Bgf,GAC5C,MAAM/9B,EAAa+e,EAAQ/e,aAAe+e,EAAQ5rB,YAAc,EAAI,GAC9DqB,EAAYuqB,EAAQvqB,UAIpBwpC,EAA+B,IAAbh+B,EAGlBi+B,EAAeF,EAAa/nC,SAASxB,EAAUf,MAAQ,GAAM,EAG7DyqC,EAAehuC,KAAKiuC,sBAAsBpf,GAG1Cqf,EAAmB/nC,KAAKE,IAAI,EAAGynC,EAAkBC,EAAeC,GAGtE,OAAO7nC,KAAKsQ,SAAWy3B,CACzB,CAQA,qBAAAD,CAAsBpf,GACpB,MAAM/e,EAAa+e,EAAQ/e,aAAe+e,EAAQ5rB,YAAc,EAAI,GAC9D8M,EAAkB8e,EAAQ9e,iBAAmB,EAI7Co+B,EAAmC,EAAbr+B,EAG5B,OAAIC,EAAwC,GAAtBo+B,EACb,GAILp+B,EAAwC,IAAtBo+B,EACb,GAGF,CACT,CAOA,8BAAAC,CAA+BrsC,GAC7B,IAAKA,GAAwB,IAAhBA,EAAKb,OAChB,MAAO,GAiBT,MAAO,QAdY,IAAIa,GAAMwoB,KAAK,CAAC1gB,EAAGwkB,KACpC,MAAMmf,EAAc3jC,EAAEiG,aAAejG,EAAE5G,YAAc,EAAI,GAEzD,OADoBorB,EAAEve,aAAeue,EAAEprB,YAAc,EAAI,IACpCuqC,IAIpB7sC,IAAIkuB,IACH,MAAM/e,EAAa+e,EAAQ/e,aAAe+e,EAAQ5rB,YAAc,EAAI,GAC9DorC,EAAQ,IAAIC,OAAOx+B,GACzB,MAAO,GAAG+e,EAAQvqB,UAAUf,QAAQ8qC,OAErC1jC,KAAK,wBAGV,GCuKK,MAAM4jC,GAAgB,IA5R7B,MACU3a,UAA6B,CAAC,EAC9BnS,aAAc,EACd+sB,kBAAoB,GAM5B,oBAAAC,GAEE1hB,QAAQC,cAAc0hB,oCAAsCxnC,IAC1DlH,KAAK2uC,sBAAsBznC,KAI7B6lB,QAAQC,cAAcC,4BAA8B/lB,IAClDlH,KAAK4uC,eAAe1nC,KAGtBjH,QAAQC,IAAI,8BACd,CAKQ,qBAAAyuC,CAAsBznC,GAC5BlH,KAAKyhB,aAAc,EACnBzhB,KAAKwuC,kBAAoBtnC,EAGrBlH,KAAK4zB,UAAUib,eACjB7uC,KAAK4zB,UAAUib,cAAc3nC,EAEjC,CAKQ,oBAAM0nC,CAAe1nC,GAC3B,IACElH,KAAKyhB,aAAc,EACnBzhB,KAAKwuC,kBAAoBtnC,QAGnBlH,KAAK8uC,0BAA0B5nC,SAG/BlH,KAAK+uC,aAAa7nC,GAGpBlH,KAAK4zB,UAAUmN,YACjB/gC,KAAK4zB,UAAUmN,WAAW75B,EAE9B,CAAE,MAAO3G,GACPN,QAAQM,MAAM,6BAA8BA,GACxCP,KAAK4zB,UAAUob,SACjBhvC,KAAK4zB,UAAUob,QAAQzuC,EAE3B,CACF,CAMQ,+BAAMuuC,CAA0B5nC,GACtC,IACE,MAAM6X,GAAgB,KAAA3Q,oBAChBG,EAAkBwQ,EAAcxQ,gBAEtC,IAAKA,GAA8C,WAA3BA,EAAgBhI,OACtC,OAIF,IAAK,MAAMsoB,KAAWtgB,EAAgB3K,WAAY,CAChD,MAAMU,EAAYuqB,EAAQvqB,UAG1B,GAAI4C,EAAKpB,SAASxB,EAAUf,MAAO,CACjC,MAAM0rC,EAAepgB,EAAQ9e,iBAAmB,EAChD8e,EAAQ9e,gBAAkBk/B,EAAe,EAEzChvC,QAAQC,IAAI,wBAAwBoE,EAAUf,gBAAgBsrB,EAAQ9e,kBACxE,CACF,OAGMgP,EAAc1P,eAAed,EAAgB3L,GAAI,CACrDgB,WAAY2K,EAAgB3K,aAI9B,IACE,GAAIF,EAAAA,WAAY,CACd,MAAMD,QAAiBC,EAAW,WAAAC,eAC9BF,EAAS6K,UAAUC,EAAgB3L,MACrCa,EAAS6K,UAAUC,EAAgB3L,IAAIgB,WAAa2K,EAAgB3K,iBAC9DF,EAAW,WAAAuL,aAAaxL,GAElC,CACF,CAAE,MAAOyrC,GACPjvC,QAAQK,KAAK,uCAAwC4uC,EACvD,CACF,CAAE,MAAO3uC,GACPN,QAAQM,MAAM,kCAAmCA,EAEnD,CACF,CAMQ,kBAAMwuC,CAAa7nC,GACzB,IACE,MACMqH,GADgB,KAAAH,oBACgBG,gBAEtC,IAAKA,GAA8C,WAA3BA,EAAgBhI,OACtC,OAIF,MAAMmY,EAAcnQ,EAAgB3K,WACjCd,OAAO+rB,GAAW3nB,EAAKpB,SAAS+oB,EAAQvqB,UAAUf,OAClD5C,IAAIkuB,GAAWA,EAAQnpB,mBAGpB4Y,GAAmB,mBAAAE,wBAAwBjQ,EAAgB3L,GAAIsE,EAAMwX,GAG3E,IACE,GAAIhb,EAAAA,WAAY,CACd,MAAMD,QAAiBC,EAAW,WAAAC,eAC9BF,EAAS6K,UAAUC,EAAgB3L,MACrCa,EAAS6K,UAAUC,EAAgB3L,IAAI8D,OAAS6H,EAAgB7H,aAC1DhD,EAAW,WAAAuL,aAAaxL,GAElC,CACF,CAAE,MAAOyrC,GACPjvC,QAAQK,KAAK,yCAA0C4uC,EACzD,CACF,CAAE,MAAO3uC,GACPN,QAAQM,MAAM,2BAA4BA,EAE5C,CACF,CAMA,iBAAM4uC,CAAYznC,GAChB,IACEzH,QAAQC,IAAI,yBAA0BwH,SAGhC1H,KAAKovC,kCAGL7nC,SAAS,CACbC,WAAYE,EACZP,eAAe,IAGjBlH,QAAQC,IAAI,kCACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,2BAA4BA,GAC1C6D,OAAO7D,MAAM,UACTP,KAAK4zB,UAAUob,SACjBhvC,KAAK4zB,UAAUob,QAAQzuC,EAE3B,CACF,CAMQ,+BAAM6uC,GACZ,IACE,MACM7gC,GADgB,KAAAH,oBACgBG,gBAGtC,IAAKA,GAA8C,WAA3BA,EAAgBhI,OACtC,OAIF,IAAKgI,EAAgB3K,YAAoD,IAAtC2K,EAAgB3K,WAAW1C,OAC5D,OAIF,MAAMmuC,EAAmBhC,GAAqBC,yBAAyB/+B,EAAgB3K,YAEvF,IAAKyrC,EACH,OAGFpvC,QAAQC,IAAI,iCAGZ6pB,cACE,CACE,CACEnnB,GAAI,yBACJsT,QAASm5B,EACTv2B,SAAU,UACV+O,MAAO,EACP5R,KAAM,WAGV,CAAEq5B,MAAM,GAEZ,CAAE,MAAO/uC,GACPN,QAAQM,MAAM,mCAAoCA,EAEpD,CACF,CAKA,YAAA60B,CAAaxB,GACX5zB,KAAK4zB,UAAYA,EACjB3zB,QAAQC,IAAI,2BACd,CAKA,cAAAm1B,GACEr1B,KAAK4zB,UAAY,CAAC,EAClB3zB,QAAQC,IAAI,2BACd,CAKA,cAAAqvC,GACE,OAAOvvC,KAAKyhB,WACd,CAKA,cAAA+tB,GACE,OAAOxvC,KAAKwuC,iBACd,CAKA,6BAAMiB,CAAwBC,EAAoBl1B,EAAmB0sB,GACnE,IACE,MAAMpgC,EAAS,QAAQogC,UAAe1sB,UAAkBk1B,2BAElD1vC,KAAKmvC,YAAYroC,EACzB,CAAE,MAAOvG,GACPN,QAAQM,MAAM,2BAA4BA,GAC1C6D,OAAO7D,MAAM,SACf,CACF,CAKA,uBAAMovC,CAAkBC,GACtB,IACE,MAAM9oC,EAAS,SAAS8oC,+BAElB5vC,KAAKmvC,YAAYroC,EACzB,CAAE,MAAOvG,GACPN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,WACf,CACF,GChSF,SAASsvC,GAAgB35B,GAEvB,MAAO,2BAA2Bo2B,KAAKp2B,EACzC,CA4EA,SAAS45B,GAAuBC,EAAmBC,GACjD,MAAMnoC,EAAmB,GAGzB,GAAIkoC,EAAU7uC,QAAU8uC,EAEtB,OADAnoC,EAAO9B,KAAKgqC,GACLloC,EAIT,IAAIooC,EAAQ,EACZ,KAAOA,EAAQF,EAAU7uC,QAAQ,CAC/B,IAAIgvC,EAAMD,EAAQD,EAGlB,GAAIE,EAAMH,EAAU7uC,OAAQ,CAE1B,MAAMivC,EAAoB,WACpBC,EAAkB,UAClBC,EAAQ,KAEd,IAAIC,GAAa,EACbC,EAAY,EAIhB,MAAMC,EAAcrqC,KAAKC,IAAI6pC,EAAQ9pC,KAAK+c,MAAkB,GAAZ8sB,GAAkBC,EAAQ,IACpEQ,EAAYtqC,KAAKE,IAAI6pC,EAAM/pC,KAAK+c,MAAkB,GAAZ8sB,GAAkBD,EAAU7uC,QAExE,IAAK,IAAIsI,EAAIgnC,EAAahnC,EAAIinC,EAAWjnC,IACnC2mC,EAAkB7D,KAAKyD,EAAUvmC,KAAO+mC,EAAY,GACtDD,EAAY9mC,EAAI,EAChB+mC,EAAY,GACHH,EAAgB9D,KAAKyD,EAAUvmC,KAAO+mC,EAAY,GAC3DD,EAAY9mC,EAAI,EAChB+mC,EAAY,GACHF,EAAM/D,KAAKyD,EAAUvmC,KAAO+mC,EAAY,IACjDD,EAAY9mC,EAAI,EAChB+mC,EAAY,GAKZD,EAAYL,IACdC,EAAMI,EAEV,CAEA,MAAMI,EAAUX,EAAU3lB,MAAM6lB,EAAOC,GAAK7wB,OACxCqxB,GACF7oC,EAAO9B,KAAK2qC,GAEdT,EAAQC,CACV,CAEA,OAAOroC,CACT,CAaO,SAAS8oC,GAAoBzpC,GAElC,MAAM0pC,EAxID,SAA0B1pC,GAC/B,IAAI0pC,EAAU1pC,EAuDd,OAnDA0pC,EAAUA,EAAQC,QAAQ,uBAAwB,IAGlDD,EAAUA,EAAQC,QAAQ,uBAAwB,IAGlDD,EAAUA,EAAQC,QAAQ,kBAAmB,IAG7CD,EAAUA,EAAQC,QAAQ,WAAY,IAGtCD,EAAUA,EAAQC,QAAQ,oBAAqB,IAG/CD,EAAUA,EAAQC,QAAQ,WAAY,IAItCD,EAAUA,EAAQC,QAAQ,0BAA2B,CAACpnC,EAAOqnC,EAAQ56B,KAKnE,GAJAjW,QAAQC,IAAI,sBAAuBuJ,EAAMuD,UAAU,EAAG,KACtD/M,QAAQC,IAAI,qBAAsB4wC,GAClC7wC,QAAQC,IAAI,qBAAsBgW,GAClCjW,QAAQC,IAAI,sBAAuB2vC,GAAgB35B,IAC/C25B,GAAgB35B,GAAU,CAC5B,MAAMrO,EAAS,GAAGipC,OAAY56B,OAE9B,OADAjW,QAAQC,IAAI,oBAAqB2H,EAAOmF,UAAU,EAAG,KAC9CnF,CACT,CACA,OAAO4B,IAITmnC,EAAUA,EAAQC,QAAQ,0BAA2B,CAACpnC,EAAOqnC,EAAQ56B,IAC/D25B,GAAgB35B,GACX,GAAG46B,OAAY56B,OAEjBzM,GAITmnC,EAAUA,EAAQC,QAAQ,0BAA2B,CAACpnC,EAAOqnC,EAAQ56B,IAC/D25B,GAAgB35B,GACX,GAAG46B,OAAY56B,OAEjBzM,GAITmnC,EAAUA,EAAQvxB,OAEXuxB,CACT,CA+EkBG,CAAiB7pC,GAS3B8oC,EAD6B,oBAAX7Z,QAA0BA,OAAO6a,WAAa,IAHjD,IADF,IAQbC,EAAoBL,EACvB1xB,MAAM,MACNve,IAAIo+B,GAAKA,EAAE1f,QACXvc,OAAOi8B,GAAKA,EAAE79B,OAAS,GAGpB2G,EAAmB,GACzB,IAAK,MAAMkoC,KAAakB,EAAmB,CACzC,MAAMC,EAAgBpB,GAAuBC,EAAWC,GACxDnoC,EAAO9B,QAAQmrC,EACjB,CAEA,OAAOrpC,CACT,CAMO,SAASspC,GAAwBjqC,GAEtC,OADuBypC,GAAoBzpC,GACrBvG,IAAIuV,IAAW,CAAGA,YAC1C,CCnMA,MAAM,GAAa,CACf8K,IAAK,EACLua,MAAO,oBAEL,GAAa,CACfva,IAAK,EACLua,MAAO,iBAEL,GAAa,CACfva,IAAK,EACLua,MAAO,wBAEL,GAAa,CACfva,IAAK,EACLua,MAAO,0BAEL,GAAa,CAAC,aACd,GAAa,CAAC,YACd,GAAa,CAAEva,IAAK,GACpB,GAAa,CAAEA,IAAK,GAS1B,IAA6B,qBAAiB,CAC1Ckc,OAAQ,cACRC,MAAO,CAAC,cACR,KAAAC,CAAMC,GAAW+T,OAAQC,EAAU/T,KAAMC,IACrC,MAAM2C,GAAY,IAAA3e,gBACZjO,GAAiB,SACjByL,GAAgB,KAAA3Q,oBAEhBkvB,EAAOC,EAEP+T,GAAW,IAAAzvC,MAAI,GACf0vC,GAAc,IAAA1vC,KAAI,IAClBm8B,GAAc,IAAAn8B,KAAI,IAClB2vC,GAAkB,IAAA3vC,KAAI,MACtB4vC,GAAqB,IAAA5vC,KAAI,MACzB6vC,GAAkB,IAAA7vC,KAAI,IACtB8vC,GAAkB,IAAA9vC,MAAI,GACtB+vC,GAAiB,IAAA/vC,KAAI,MAErBgwC,GAAe,IAAAhwC,MAAI,GAEnBiwC,GAAa,IAAAjwC,KAAI,IACjBkwC,GAAwB,IAAAlwC,KAAI,GAE5BmwC,GAAa,IAAAnwC,KAAI,MAyBvB,SAASowC,IACD/R,EAAUze,cAIVswB,EAAsB3vC,MAAQ0vC,EAAW1vC,MAAMlB,OAAS,GACxD6wC,EAAsB3vC,QACtB8vC,MAIAL,EAAazvC,OAAQ,GAErB,IAAA+vC,UAAS,KACLP,EAAexvC,OAAOgwC,WAGlC,CAQA,SAASC,KAEL,IAAAF,UAAS,MAEL,IAAAA,UAAS,KACDV,EAAmBrvC,QACnBqvC,EAAmBrvC,MAAMkwC,UAAYb,EAAmBrvC,MAAMmwC,aAC9DtyC,QAAQC,IAAI,oCAAqCuxC,EAAmBrvC,MAAMmwC,kBAI1F,CAIA,SAASL,IACL,GAAIH,EAAsB3vC,OAAS0vC,EAAW1vC,MAAMlB,OAChD,OAEJ,MAAM6uC,EAAY+B,EAAW1vC,MAAM2vC,EAAsB3vC,OAErD2tC,EAAU75B,UACV8nB,EAAY57B,MAAQ2tC,EAAU75B,QAE9Bm8B,IAER,CAKAlvC,eAAeqvC,EAAmBtrC,GAC9B,IAAKA,EACD,OAEJ,MAAMurC,EAAmB,8BACnBC,EAAW,GACjB,IAAIjpC,EACJ,KAAiD,QAAzCA,EAAQgpC,EAAiBnlB,KAAKpmB,KAClCwrC,EAAS3sC,KAAK0D,EAAM,GAAG4V,QAE3B,GAAwB,IAApBqzB,EAASxxC,OACT,OACJ,MAAMyxC,OAA+C7wC,IAAhCo+B,EAAU7xB,kBAC/B,IAAK,MAAM9K,KAAQmvC,EACf,IACI,MAAME,EAAct/B,EAAejR,QAAQsK,KAAK5J,GAAOA,EAAIQ,OAASA,GACpE,GAAIqvC,GAEA,GAAID,GAAgBzS,EAAU7xB,kBAAmB,CAC7C,MAAMQ,EAAWkQ,EAAczP,YAAY4wB,EAAU7xB,mBAC/CwkC,EAAahkC,GAAUjL,WAAWgG,KAAKY,GAAKA,EAAE9E,cAAgBktC,EAAYhwC,IAC3EiwC,UACK9zB,EAAclP,uBAAuBqwB,EAAU7xB,kBAAmBukC,GAAa,GACrFxuC,OAAOoB,KAAK,GAAGjC,UAEvB,MAEC,CAED,MAAMsrB,EAAUkd,GAAmBqB,YAAYlmC,EAAM3D,GAC/CuvC,EAAS,CACXlwC,GAAI,OAAO+N,KAAKC,SAASzK,KAAKsQ,SAASC,SAAS,IAAI1J,UAAU,EAAG,KACjEhM,KAAM,MACNuC,OACAwD,IAAK8nB,EAAQ9nB,IACbC,WAAY6nB,EAAQ7nB,WACpBC,WAAY4nB,EAAQ5nB,WACpBwR,aAAcoW,EAAQpW,aACtB7T,WAAYiqB,EAAQjqB,WACpBE,aAAc+pB,EAAQ/pB,aACtB2Q,OAAQoZ,EAAQpZ,OAChB1Q,UAAW,GACXgH,UAAW,GACX3G,UAAW,GACXnC,aAAa,EACbyD,OAAQ,UAEN4M,EAAerO,OAAO6tC,GACxBH,GAAgBzS,EAAU7xB,yBACpB0Q,EAAclP,uBAAuBqwB,EAAU7xB,kBAAmBykC,GAAQ,GAEpF,MAAMttC,EAAO,CAACqpB,EAAQ7nB,WAAY,GAAG6nB,EAAQ9nB,QACzC8nB,EAAQpW,cACRjT,EAAKO,KAAK8oB,EAAQpW,cACtBrU,OAAOI,QAAQ,OAAOjB,KAAQiC,EAAKmF,KAAK,WAC5C,CACJ,CACA,MAAOpK,GACHN,QAAQM,MAAM,sBAAsBgD,QAAYhD,GAChD6D,OAAO7D,MAAM,QAAQgD,OACzB,CAER,CAmCAJ,eAAe4vC,EAAkB7rC,GAiB7B,GAfA2qC,EAAazvC,OAAQ,EAErBmvC,EAAYnvC,MAAQ8E,QAEdsrC,EAAmBtrC,GAEzB4qC,EAAW1vC,MAAQ+uC,GAAwBjqC,GAC3C6qC,EAAsB3vC,MAAQ,EAE9BnC,QAAQC,IAAI,sBAAuBgH,EAAK8F,UAAU,EAAG,KAAO,OAC5D/M,QAAQC,IAAI,uBAAwB4xC,EAAW1vC,MAAMlB,QACrD4wC,EAAW1vC,MAAM8B,QAAQ,CAAC66B,EAAGv1B,KACzBvJ,QAAQC,IAAI,oBAAoBsJ,EAAI,KAAMu1B,EAAE7oB,QAAQlJ,UAAU,EAAG,KAAO+xB,EAAE7oB,QAAQhV,OAAS,GAAK,MAAQ,OAGxG4wC,EAAW1vC,MAAMlB,OAAS,EAAG,CAC7B,MAAM6uC,EAAY+B,EAAW1vC,MAAM,GACnC47B,EAAY57B,MAAQ2tC,EAAU75B,QAE9Bm8B,IAEgC,IAA5BP,EAAW1vC,MAAMlB,SACjB2wC,EAAazvC,OAAQ,GACrB,IAAA+vC,UAAS,KACLP,EAAexvC,OAAOgwC,UAGlC,MAEInyC,QAAQK,KAAK,4BACb09B,EAAY57B,MAAQ,EAE5B,CA6CA,SAAS4wC,IACL/yC,QAAQC,IAAI,0BACZquC,GAAcnZ,aAAa,CACvByZ,cAAe1rC,MAAO+D,IAClBjH,QAAQC,IAAI,4BAA6BgH,EAAKhG,QAE1CgG,GAAQA,EAAKmY,eAnH7Blc,eAAwB+D,GAEpB2qC,EAAazvC,OAAQ,EAErBmvC,EAAYnvC,MAAQ8E,QAEdsrC,EAAmBtrC,GAEzB4qC,EAAW1vC,MAAQ+uC,GAAwBjqC,GAC3C6qC,EAAsB3vC,MAAQ,EAE9BnC,QAAQC,IAAI,sBAAuBgH,EAAK8F,UAAU,EAAG,KAAO,OAC5D/M,QAAQC,IAAI,uBAAwB4xC,EAAW1vC,MAAMlB,QACrD4wC,EAAW1vC,MAAM8B,QAAQ,CAAC66B,EAAGv1B,KACzBvJ,QAAQC,IAAI,oBAAoBsJ,EAAI,KAAMu1B,EAAE7oB,QAAQlJ,UAAU,EAAG,KAAO+xB,EAAE7oB,QAAQhV,OAAS,GAAK,MAAQ,OAGxG4wC,EAAW1vC,MAAMlB,OAAS,GAC1BgxC,IAEAG,KAGApyC,QAAQK,KAAK,2BAErB,CA2FsB2yC,CAAS/rC,GAEfo2B,EAAK,cAEDgU,EAASlvC,QACTnC,QAAQC,IAAI,mCACZoxC,EAASlvC,OAAQ,KAI7B2+B,WAAY59B,MAAO+D,IACfjH,QAAQC,IAAI,6BAA8BgH,EAAKhG,QAE3CgG,GAAQA,EAAKmY,eACP0zB,EAAkB7rC,GAExBo2B,EAAK,cAEDgU,EAASlvC,QACTnC,QAAQC,IAAI,mCACZoxC,EAASlvC,OAAQ,KAI7B4sC,QAAUzuC,IACNN,QAAQM,MAAM,wBAAyBA,GACvC6D,OAAO7D,MAAM,YAGzB,CAKA4C,eAAe+vC,IACX,IAAKxB,EAAgBtvC,MAAMid,QAAUsyB,EAAgBvvC,MACjD,OACJ,MAAMsF,EAAUgqC,EAAgBtvC,MAAMid,OACtC,IACIsyB,EAAgBvvC,OAAQ,EACxBnC,QAAQC,IAAI,sBAAuBwH,GAEnC,MAAMyrC,EAAkBC,EAAE,iBAAkBjd,OAAO5e,OAAOqoB,UACpDyT,EAAcD,EAAE,YAAajd,OAAO5e,OAAOqoB,UAC7CuT,EAAgBjyC,OAAS,GAAKmyC,EAAYnyC,OAAS,GAEnDiyC,EAAgBh7B,IAAIzQ,GAEpByrC,EAAgBG,QAAQ,SACxBrzC,QAAQC,IAAI,8BAEZwxC,EAAgBtvC,MAAQ,GACxByvC,EAAazvC,OAAQ,EAErBmvC,EAAYnvC,MAAQ,cACpB47B,EAAY57B,MAAQ,cAEpBixC,EAAYC,QAAQ,SACpBrzC,QAAQC,IAAI,6BAGZD,QAAQM,MAAM,+BACd6D,OAAO7D,MAAM,mBAEbmxC,EAAgBtvC,MAAQsF,EAEhC,CACA,MAAOnH,GACHN,QAAQM,MAAM,wBAAyBA,GACvC6D,OAAO7D,MAAM,UAEbmxC,EAAgBtvC,MAAQsF,CAC5B,CACA,QACIiqC,EAAgBvvC,OAAQ,CAC5B,CACJ,CA2BA,OAnUAivC,EAAS,CACLkC,aApCJ,WACIjC,EAASlvC,OAAQ,EAEb4vC,EAAW5vC,QACXmvC,EAAYnvC,MAAQ4vC,EAAW5vC,MAAMmvC,YACrCvT,EAAY57B,MAAQ4vC,EAAW5vC,MAAM47B,YACrC8T,EAAW1vC,MAAQ4vC,EAAW5vC,MAAM0vC,WACpCC,EAAsB3vC,MAAQ4vC,EAAW5vC,MAAM2vC,sBAC/C9xC,QAAQC,IAAI,6BAEpB,KAmUA,IAAAi+B,WAAUh7B,UACNlD,QAAQC,IAAI,wBAEZ8yC,UAjIJ7vC,iBACI,IACIlD,QAAQC,IAAI,6BAEZ,MAAMszC,EAAepgC,iBAAiB,GACtC,GAAIogC,GAAgBA,EAAatyC,OAAS,EAAG,CACzC,MAAMuyC,EAAcD,EAAa,GACjCvzC,QAAQC,IAAI,wBAAyB,CACjC+V,KAAMw9B,EAAYx9B,KAClBoH,WAAYo2B,EAAYp2B,WACxBnH,QAASu9B,EAAY/rC,QAAQsF,UAAU,EAAG,IAAM,QAG1B,cAArBymC,EAAYx9B,MAA6C,WAArBw9B,EAAYx9B,OAAsBw9B,EAAY/rC,QAKzD,SAArB+rC,EAAYx9B,OAEjBhW,QAAQC,IAAI,oCACZqxC,EAAYnvC,MAAQ,cACpB47B,EAAY57B,MAAQ,gBARpBnC,QAAQC,IAAI,mCAEN6yC,EAAkBU,EAAY/rC,SAQ5C,MAEIzH,QAAQC,IAAI,gCACZqxC,EAAYnvC,MAAQ,YACpB47B,EAAY57B,MAAQ,YAGxBiwC,GACJ,CACA,MAAO9xC,GACHN,QAAQM,MAAM,0BAA2BA,EAC7C,CACJ,CA+FUmzC,GACNzzC,QAAQC,IAAI,2BAGhB,IAAAogC,OAAM,IAAMJ,EAAUtjB,KAAM,CAACoB,EAAS21B,KAClC1zC,QAAQC,IAAI,wBAAyByzC,EAAS,KAAM31B,GACpC,SAAZA,GAAkC,SAAZ21B,IACtB1zC,QAAQC,IAAI,oCACZ8yC,QAIR,IAAAhS,iBAAgB,KACZ/gC,QAAQC,IAAI,wBAKZD,QAAQC,IAAI,oCAET,CAACk+B,EAAMC,MACF,kBAAc,wBAAoB,MAAO,KAAM,CACjDiT,EAASlvC,OAqDL,wBAAoB,QAAQ,KApD3B,kBAAc,wBAAoB,MAAO,CACxC4e,IAAK,EACLua,MAAO,eACPgD,QAAS0T,GACV,EACC,wBAAoB,WACpB,wBAAoB,MAAO,CACvBhR,QAAS,qBACTp/B,IAAK4vC,EACLlW,MAAO,oBACR,CACEgW,EAAiB,QACX,kBAAc,wBAAoB,MAAO,GAAY,EACpD,wBAAoB,MAAO,CACvBtQ,QAAS,kBACTp/B,IAAK2vC,EACLjW,MAAO,kBACR,qBAAiByC,EAAY57B,OAAQ,KACvC2vC,EAAsB3vC,MAAQ0vC,EAAW1vC,MAAMlB,OAAS,IAClD,kBAAc,wBAAoB,MAAO,GAAY,UACtD,wBAAoB,QAAQ,QAEnC,kBAAc,wBAAoB,MAAO,GAAY,IAAKm9B,EAAO,KAAOA,EAAO,GAAK,EAC/E,wBAAoB,IAAK,KAAM,aAAc,IAC7C,wBAAoB,IAAK,CAAE9C,MAAO,QAAU,eAAgB,SAEzE,MACH,wBAAoB,qCACnBsW,EAAkB,QACZ,kBAAc,wBAAoB,MAAO,GAAY,EACpD,qBAAgB,wBAAoB,WAAY,CAC5C5Q,QAAS,iBACTp/B,IAAK+vC,EACL,sBAAuBvT,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAkBp8B,MAAQo8B,GACxFjD,MAAO,qBACPoD,YAAa,YACbiV,WAAW,eAAU,mBAAeV,EAAkB,CAAC,SAAU,CAAC,WACnE,KAAM,GAAgC,IAAa,CAClD,CAAC,aAAaxB,EAAgBtvC,UAElC,wBAAoB,SAAU,CAC1Bm5B,MAAO,qBACP0D,UAAWyS,EAAgBtvC,MAAMid,QAAUsyB,EAAgBvvC,MAC3Dm8B,QAAS2U,GACV,CACGvB,EAAgBvvC,QAEX,kBAAc,wBAAoB,OAAQ,GAAY,aADtD,kBAAc,wBAAoB,OAAQ,GAAY,QAE9D,EAAe,QAEpB,wBAAoB,QAAQ,QAKtD,ICvdJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAEm5B,MAAO,mBACtB,GAAa,CAAC,YACd,GAAa,CAAC,SACd,GAAa,CAAEA,MAAO,gBACtB,GAAa,CAAC,YACd,GAAa,CAAC,YACd,GAAa,CACfva,IAAK,EACLua,MAAO,eAEL,GAAa,CAAEA,MAAO,cACtB,GAAa,CAAEA,MAAO,eACtB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAC,YAQrB,IAA6B,qBAAiB,CAC1C2B,OAAQ,aACRC,MAAO,CAAC,SACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMjqB,GAAiB,SAEjBugC,GAAgB,IAAAhyC,KAAI,IACpBiyC,GAAW,IAAAjyC,KAAI,MACfkyC,GAAY,IAAAlyC,MAAI,GAChBmyC,GAAe,IAAAnyC,MAAI,GACnBoyC,GAAa,IAAApyC,KAAI,IAEjBqyC,GAAgB,IAAAryC,OAChBsyC,GAAkB,IAAAtyC,OAClBuyC,GAAoB,IAAAvyC,OACpBwyC,GAAiB,IAAAxyC,OAMjByyC,GAAkB,IAAAnyC,UAAS,KAC7B,IAAKmR,EAAe1R,OAChB,MAAO,GAEX,MAAM6T,EAAS,GAkBf,OAhBInC,EAAe1R,OAAO6T,kBAAkBzT,IACxCsR,EAAe1R,OAAO6T,OAAOvR,QAAQ,CAAC9B,EAAOmB,KACzCkS,EAAO1P,KAAK,CAAExC,OAAMnB,YAGnBkR,EAAe1R,OAAO6T,QAAkD,iBAAjCnC,EAAe1R,OAAO6T,QAElEzR,OAAOC,QAAQqP,EAAe1R,OAAO6T,QAAQvR,QAAQ,EAAEX,EAAMnB,MACzDqT,EAAO1P,KAAK,CAAExC,OAAMnB,MAAOA,MAIb,IAAlBqT,EAAOvU,QACPuU,EAAO1P,KAAK,CAAExC,KAAM,KAAMnB,MAAO,IAAM,CAAEmB,KAAM,KAAMnB,MAAO,IAAM,CAAEmB,KAAM,QAASnB,MAAO,IAAM,CAAEmB,KAAM,KAAMnB,MAAO,IAAM,CAAEmB,KAAM,KAAMnB,MAAO,IAAM,CAAEmB,KAAM,KAAMnB,MAAO,KAGxKqT,EAAO8U,KAAK,CAAC1gB,EAAGwkB,IAAMxkB,EAAEtG,KAAKgxC,cAAclmB,EAAE9qB,SAMxDJ,eAAeqxC,IACX,GAAKX,EAAczxC,QAAS2xC,EAAU3xC,MAGtC,IACI2xC,EAAU3xC,OAAQ,EAElB,MAAM6hB,EAAaqwB,EAAgBlyC,MAAMuK,KAAKo3B,GAAKA,EAAExgC,OAASswC,EAAczxC,QAAQA,OAAS,GAM7F,GAJI8xC,EAAc9xC,OACd,GAA8B8xC,EAAc9xC,OAG5CiyC,EAAejyC,MAAO,CAEtB,MACMqyC,EAAa,GACbC,EAFoB,EAEgBD,EAC1C,IAAK,IAAIjrC,EAAI,EAAGA,EAAIirC,EAAYjrC,IAE5B,SADM,IAAIioB,QAAQC,GAAWmU,WAAWnU,EAAyB,IAAhBgjB,IAC7CL,EAAejyC,MAAO,CACtB,MAAMuyC,EAAcxuC,KAAK+c,MAAsB,IAAhB/c,KAAKsQ,UAAkB,EACtD49B,EAAejyC,MAAMy9B,cAAc,eAAe+U,YAAcD,EAAYj+B,UAChF,CAER,CAEA,MAAM4D,EAAO6rB,GAAYniB,kBAAkB6vB,EAAczxC,MAAO6hB,GAGhE,GAFA6vB,EAAS1xC,MAAQkY,EAEb+5B,EAAejyC,MAAO,CACtB,MAAMyyC,EAAYR,EAAejyC,MAAMy9B,cAAc,eACjDgV,IACAA,EAAUD,YAAct6B,EAAKA,KAAK5D,WAEd,qBAAhB4D,EAAKzS,OACL,GAAgBwsC,EAAejyC,MAAO,GAAI,IAErB,qBAAhBkY,EAAKzS,QACV,GAAgBwsC,EAAejyC,MAAO,GAAI,IAGtD,CACAnC,QAAQC,IAAI,sBAAuBoa,GACnClW,OAAOoB,KAAK,GAAGquC,EAAczxC,cAAa,SAAkBkY,EAAKzS,UACrE,CACA,MAAOtH,GACHN,QAAQM,MAAM,sBAAuBA,GACrC6D,OAAO7D,MAAM,OACjB,CACA,QACIwzC,EAAU3xC,OAAQ,CACtB,CACJ,CAIAe,eAAe2xC,IACPX,EAAgB/xC,OAChB,GAA8B+xC,EAAgB/xC,OAGlD0xC,EAAS1xC,MAAQ,WAEX,IAAIqvB,QAAQC,GAAWmU,WAAWnU,EAAS,YAC3C8iB,GACV,CAIArxC,eAAe4xC,IACX,GAAKjB,EAAS1xC,QAAS4xC,EAAa5xC,MAGpC,IACI4xC,EAAa5xC,OAAQ,EACjBgyC,EAAkBhyC,OAClB,GAA8BgyC,EAAkBhyC,OAGpD,MAAM4yC,GAAa,SAAkBlB,EAAS1xC,MAAMyF,QAC9C2S,EAAYs5B,EAAS1xC,MAAMoY,WAAaq5B,EAAczxC,YAEtDmsC,GAAckB,wBAAwBuF,EAAYx6B,EAAWy5B,EAAW7xC,OAAS,QACvFnC,QAAQC,IAAI,wBACZkE,OAAOI,QAAQ,sBAET,IAAIitB,QAAQC,GAAWmU,WAAWnU,EAAS,MAEjD4L,EAAK,QACT,CACA,MAAO/8B,GACHN,QAAQM,MAAM,wBAAyBA,GACvC6D,OAAO7D,MAAM,SACjB,CACA,QACIyzC,EAAa5xC,OAAQ,CACzB,CACJ,CAEA,MAAMk7B,EAAOC,EAMb,OAHI+W,EAAgBlyC,MAAMlB,OAAS,IAC/B2yC,EAAczxC,MAAQkyC,EAAgBlyC,MAAM,GAAGmB,MAE5C,CAAC66B,EAAMC,MACF,kBAAc,wBAAoB,MAAO,CAC7C9C,OAAO,oBAAgB,CAAC,cAAe,CAAE,aAAcwY,EAAU3xC,UAClE,EACC,wBAAoB,WACpBi8B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAE9C,MAAO,iBAAmB,EAC7E,wBAAoB,KAAM,KAAM,UAChC,KACJ,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,CACnC8C,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,CAAE4W,IAAK,gBAAkB,SAAU,KAC1F,qBAAgB,wBAAoB,SAAU,CAC1CryC,GAAI,eACJ,sBAAuBy7B,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAgBp8B,MAAQo8B,GACtFS,SAAU8U,EAAU3xC,OACrB,GACE,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYkyC,EAAgBlyC,MAAQmY,KAChF,kBAAc,wBAAoB,SAAU,CAChDyG,IAAKzG,EAAMhX,KACXnB,MAAOmY,EAAMhX,OACd,qBAAiBgX,EAAMhX,MAAQ,MAAO,qBAAiBgX,EAAMnY,OAAS,KAAM,EAAqB,MACpG,OACL,EAAe,IAAa,CAC3B,CAAC,eAAeyxC,EAAczxC,YAGtC,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,SAAU,CAC1B6+B,QAAS,gBACTp/B,IAAKqyC,EACL3Y,MAAO,WACP0D,UAAW4U,EAAczxC,OAAS2xC,EAAU3xC,MAC5Cm8B,QAASiW,IACV,qBAAiBT,EAAU3xC,MAAQ,SAAW,MAAO,EAAqB,IAC5E0xC,EAAc,QACR,kBAAc,wBAAoB,SAAU,CAC3C9yB,IAAK,EACLigB,QAAS,kBACTp/B,IAAKsyC,EACL5Y,MAAO,aACP0D,SAAU8U,EAAU3xC,MACpBm8B,QAASuW,GACV,SAAU,EAAe,MAC1B,wBAAoB,QAAQ,MAEtC,wBAAoB,aACpB,iBAAa,aAAa,CAAEvxC,KAAM,QAAU,CACxC8F,SAAS,aAAS,IAAM,CACnByqC,EAAc,QACR,kBAAc,wBAAoB,MAAO,GAAY,EACpD,wBAAoB,MAAO,CACvB7S,QAAS,iBACTp/B,IAAKwyC,EACL9Y,MAAO,gBACR,EACC,wBAAoB,MAAO,IAAY,qBAAiBuY,EAAS1xC,MAAMkY,MAAO,IAC/E,MACH,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,CACvBihB,OAAO,oBAAgB,CAAC,eAAgB,UAAUuY,EAAS1xC,MAAMyF,aAClE,sBAAiB,WAAO,MAAP,CAA0BisC,EAAS1xC,MAAMyF,SAAU,IACvE,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,OAAQ,KAAM,SAAU,qBAAiBisC,EAAS1xC,MAAMmY,OAAQ,IACpF,wBAAoB,OAAQ,KAAM,QAAS,qBAAiBu5B,EAAS1xC,MAAMkY,MAAO,QAG1F,wBAAoB,aACpB,wBAAoB,SAAU,CAC1B2mB,QAAS,oBACTp/B,IAAKuyC,EACL7Y,MAAO,eACP0D,SAAU+U,EAAa5xC,MACvBm8B,QAASwW,IACV,qBAAiBf,EAAa5xC,MAAQ,SAAW,YAAa,EAAqB,QAExF,wBAAoB,QAAQ,KAEtCkf,EAAG,KAER,GAEX,IC5PJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qB,cCJvE,MAAM,GAAa,CAAEia,MAAO,sBACtB,GAAa,CAAEA,MAAO,uBACtB,GAAa,CAAEA,MAAO,qBACtB,GAAa,CAAEA,MAAO,cACtB,GAAa,CAAEA,MAAO,uBACtB,GAAa,CAAC,WACd,GAAa,CAAEA,MAAO,cACtB,GAAa,CAAEA,MAAO,cACtB,GAAa,CAAEA,MAAO,6BACtB,GAAc,CAAEA,MAAO,YACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,aAEL,GAAc,CAAEA,MAAO,YACvB,GAAc,CAAEA,MAAO,YACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAC,uBACf,GAAc,CAAC,WACf,GAAc,CAAEA,MAAO,eACvB,GAAc,CAAC,YACf,GAAc,CAAEva,IAAK,GACrB,GAAc,CAAEA,IAAK,GACrB,GAAc,CAAC,YACf,GAAc,CAAEua,MAAO,gBACvB,GAAc,CAAC,YACf,GAAc,CAAEva,IAAK,GACrB,GAAc,CAAEA,IAAK,GACrB,GAAc,CAAC,YACf,GAAc,CAAEA,IAAK,GACrB,GAAc,CAAEA,IAAK,GACrB,GAAc,CAChBA,IAAK,EACLua,MAAO,uBAEL,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,qBAEL,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,qBAEL,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAC,YACf,GAAc,CAAEva,IAAK,GACrB,GAAc,CAAEA,IAAK,GAM3B,IAA6B,qBAAiB,CAC1Ckc,OAAQ,oBACRC,MAAO,CAAC,SACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMD,EAAOC,EAEP2C,GAAY,IAAA3e,gBACZvH,GAAa,IAAAnY,KAAI,GACjB8sB,GAAe,IAAA9sB,KAAI,IACnBsY,GAAe,IAAAtY,KAAI,IACnBmyC,GAAe,IAAAnyC,MAAI,GACnBqzC,GAAe,IAAArzC,KAAI,IACnBszC,GAAsB,IAAAtzC,KAAI,IAE1BE,GAAO,IAAAF,KAAI,IACXuzC,GAAkB,IAAAvzC,MAAI,GACtBwzC,GAAmB,IAAAxzC,MAAI,GACvByzC,GAAkB,IAAAzzC,KAAI,IAEtB0zC,GAAiB,IAAA1zC,KAAI,MACrB2zC,GAAkB,IAAA3zC,KAAI,MACtB4zC,GAAkB,IAAA5zC,KAAI,MACtB6zC,GAAiB,IAAA7zC,KAAI,MACrB8zC,GAAqB,IAAA9zC,KAAI,MACzB+zC,GAAqB,IAAA/zC,KAAI,MAK/BsB,eAAe0yC,IACPF,EAAmBvzC,OACnB,GAA8BuzC,EAAmBvzC,OAErD,IACIgzC,EAAgBhzC,OAAQ,EAExB,MAAMW,QAAY0rB,GAAAkC,EAAqBjC,eAAeC,EAAavsB,YAASN,GAE5EC,EAAKK,MAAM2D,KAAK,CACZnD,GAAIG,EAAIH,GACR8C,YAAa3C,EAAIH,GACjB0B,UAAWvB,EACX+M,WAAY,EACZC,gBAAiB,EACjB9M,aAAa,IAEjBmB,OAAOI,QAAQ,OAAOzB,EAAIQ,YAC9B,CACA,MAAOhD,GACHN,QAAQM,MAAM,kCAAmCA,GACjD6D,OAAO7D,MAAM,gBACjB,CACA,QACI60C,EAAgBhzC,OAAQ,CAC5B,CACJ,CAIA,SAAS0zC,IACDF,EAAmBxzC,OACnB,GAA8BwzC,EAAmBxzC,OAErDizC,EAAiBjzC,OAAQ,EACzBkzC,EAAgBlzC,MAAQ,EAC5B,CAIA,SAAS2zC,IACLV,EAAiBjzC,OAAQ,EACzBkzC,EAAgBlzC,MAAQ,EAC5B,CAIAe,eAAe6yC,IACX,GAAKV,EAAgBlzC,MAAMid,OAI3B,IACI+1B,EAAgBhzC,OAAQ,EAExB,MAAMW,QAAY0rB,GAAAkC,EAAqB3B,eAAesmB,EAAgBlzC,MAAOusB,EAAavsB,YAASN,GAEnGC,EAAKK,MAAM2D,KAAK,CACZnD,GAAIG,EAAIH,GACR8C,YAAa3C,EAAIH,GACjB0B,UAAWvB,EACX+M,WAAY,EACZC,gBAAiB,EACjB9M,aAAa,IAEjBmB,OAAOI,QAAQ,OAAOzB,EAAIQ,aAC1BwyC,GACJ,CACA,MAAOx1C,GACHN,QAAQM,MAAM,qCAAsCA,GACpD6D,OAAO7D,MAAM,gBACjB,CACA,QACI60C,EAAgBhzC,OAAQ,CAC5B,MAzBIgC,OAAOkE,QAAQ,aA0BvB,CAcAnF,eAAe8yC,IACPT,EAAgBpzC,OAChB,GAA8BozC,EAAgBpzC,OAElD,IACI4xC,EAAa5xC,OAAQ,EACrB8yC,EAAa9yC,MAAQ,YACrB+yC,EAAoB/yC,MAAQ,GAC5B,MAAMiL,EAAS,CACX2M,WAAYA,EAAW5X,MACvBL,KAAMA,EAAKK,OAGXusB,EAAavsB,QACbiL,EAAOrM,KAAO2tB,EAAavsB,OAG/B,MAAM+M,QAAmB+wB,EAAUrd,iBAAiBxV,GACpD8nC,EAAoB/yC,MAAQ+M,EAC5B+lC,EAAa9yC,MAAQ,SACzB,CACA,MAAO7B,GACHN,QAAQM,MAAM,+BAAgCA,GAC9C6D,OAAO7D,MAAM,aACjB,CACA,QACIyzC,EAAa5xC,OAAQ,CACzB,CACJ,CAIAe,eAAe+yC,IACX,GAAK/7B,EAAa/X,MAAMid,OAAxB,CAIIo2B,EAAgBrzC,OAChB,GAA8BqzC,EAAgBrzC,OAElD,IACI4xC,EAAa5xC,OAAQ,EACrB8yC,EAAa9yC,MAAQ,iBACrB+yC,EAAoB/yC,MAAQ,GAC5B,MAAMiL,EAAS,CACX2M,WAAYA,EAAW5X,MACvB+X,aAAcA,EAAa/X,MAC3BL,KAAMA,EAAKK,OAGXusB,EAAavsB,QACbiL,EAAOrM,KAAO2tB,EAAavsB,OAG/B,MAAM+M,QAAmB+wB,EAAUrd,iBAAiBxV,GACpD8nC,EAAoB/yC,MAAQ+M,EAC5B+lC,EAAa9yC,MAAQ,SACzB,CACA,MAAO7B,GACHN,QAAQM,MAAM,+BAAgCA,GAC9C6D,OAAO7D,MAAM,aACjB,CACA,QACIyzC,EAAa5xC,OAAQ,CACzB,CA5BA,MAFIgC,OAAOkE,QAAQ,YA+BvB,CAIAnF,eAAegzC,IACX,GAAKhB,EAAoB/yC,MAAzB,CAGIszC,EAAetzC,OACf,GAA8BszC,EAAetzC,OAEjD,UAEU89B,EAAU1d,QAAQ,QACxBpe,OAAOI,QAAQ,SA4BnBwV,EAAW5X,MAAQ,EACnBusB,EAAavsB,MAAQ,GACrB+X,EAAa/X,MAAQ,GACrB+yC,EAAoB/yC,MAAQ,GAC5B8yC,EAAa9yC,MAAQ,GACrBL,EAAKK,MAAQ,GACbizC,EAAiBjzC,OAAQ,EACzBkzC,EAAgBlzC,MAAQ,GA/BpBk7B,EAAK,QACT,CACA,MAAO/8B,GACHN,QAAQM,MAAM,+BAAgCA,GAC9C6D,OAAO7D,MAAM,SACjB,CAhBA,CAiBJ,CACA,SAAS61C,IACDb,EAAenzC,OACf,GAA8BmzC,EAAenzC,OAEjDk7B,EAAK,QACT,CAqBA,OAnBA,IAAAa,WAAU,KACUyB,SAASyW,iBAAiB,yBAClCnyC,QAAQoyC,IACZ,GAA+BA,EAAK,CAAC,YAAa,mBAgBnD,CAAClY,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,SAAU,CAC1B4C,QAAS,iBACTp/B,IAAK0zC,EACLha,MAAO,YACPsD,MAAO,KACPN,QAAS6X,GACV,IAAK,KACR/X,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAE9C,MAAO,mBAAqB,SAAU,KAC9F,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,CACnC8C,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,CAAE4W,IAAK,cAAgB,QAAS,KACvF,wBAAoB,MAAO,GAAY,GAClC,kBAAc,wBAAoB,WAAW,MAAM,gBAAY,EAAI5uB,IACzD,wBAAoB,SAAU,CACjCrF,IAAKqF,EACLkV,OAAO,oBAAgB,CAAC,iBAAkB,CAAE+C,OAAQtkB,EAAW5X,QAAUikB,KACzEkY,QAAUC,GAAYxkB,EAAW5X,MAAQikB,IAC1C,qBAAiBA,GAAQ,GAA6B,KACzD,UAGZ,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,CACnCgY,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,CAAE4W,IAAK,QAAU,YAAa,KACrF,qBAAgB,wBAAoB,SAAU,CAC1CryC,GAAI,OACJ,sBAAuBy7B,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAep8B,MAAQo8B,GACrFjD,MAAO,gBACR,IAAK8C,EAAO,KAAOA,EAAO,GAAK,EAC1B,uBAAmB,+ZAAkb,MACnc,KAAuB,CAC7B,CAAC,eAAe1P,EAAavsB,YAGrC,wBAAoB,aACpB,wBAAoB,MAAO,GAAY,CACnCi8B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,CAAE4W,IAAK,gBAAkB,cAAe,KAC/F,qBAAgB,wBAAoB,WAAY,CAC5CryC,GAAI,eACJ,sBAAuBy7B,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAep8B,MAAQo8B,GACrFjD,MAAO,eACP4I,KAAM,IACNxF,YAAa,yCACd,KAAM,KAAuB,CAC5B,CAAC,aAAaxkB,EAAa/X,YAGnC,wBAAoB,eACpB,wBAAoB,MAAO,GAAY,CACnCi8B,EAAO,MAAQA,EAAO,KAAM,wBAAoB,QAAS,KAAM,UAAW,KAC1E,wBAAoB,MAAO,GAAa,CACb,IAAtBt8B,EAAKK,MAAMlB,SACL,kBAAc,wBAAoB,MAAO,GAAa,IAAKm9B,EAAO,KAAOA,EAAO,GAAK,EAChF,wBAAoB,IAAK,KAAM,mBAAoB,SAEzD,wBAAoB,QAAQ,KACjC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYt8B,EAAKK,MAAO,CAACW,EAAK4I,MAC1E,kBAAc,wBAAoB,MAAO,CAC7CqV,IAAKje,EAAIH,GACT24B,MAAO,YACR,EACC,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,OAAQ,IAAa,qBAAiBx4B,EAAIuB,UAAUf,MAAO,IAC/E,wBAAoB,OAAQ,IAAa,qBAAiBR,EAAIuB,UAAU0C,YAAc,QAAS,MAEnG,wBAAoB,MAAO,GAAa,CACpCq3B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,CAAE9C,MAAO,oBAAsB,SAAU,KAChG,qBAAgB,wBAAoB,SAAU,CAC1C,sBAAwBiD,GAAaz7B,EAAc,WAAIy7B,EACvDjD,MAAO,uBACR,IAAK8C,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,SAAU,CAAEj8B,MAAO,GAAK,UAAW,IACvD,wBAAoB,SAAU,CAAEA,MAAO,GAAK,UAAW,IACvD,wBAAoB,SAAU,CAAEA,MAAO,GAAK,UAAW,IACvD,wBAAoB,SAAU,CAAEA,MAAO,GAAK,UAAW,IACvD,wBAAoB,SAAU,CAAEA,MAAO,GAAK,UAAW,MACrD,EAAe,IAAc,CACnC,CAAC,eAAeW,EAAI+M,eAExB,wBAAoB,SAAU,CAC1ByrB,MAAO,aACPsD,MAAO,KACPN,QAAUC,GApNlD,SAAmB7yB,GACf,MAAM5I,EAAMhB,EAAKK,MAAMuJ,GACnB5I,IACAhB,EAAKK,MAAMyJ,OAAOF,EAAO,GACzBvH,OAAOoB,KAAK,WAAWzC,EAAIuB,UAAUf,QAE7C,CA8M6D,CAAWoI,IACjC,IAAK,EAAe,UAG/B,SAER,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,SAAU,CAC1Bs1B,QAAS,qBACTp/B,IAAK8zC,EACLpa,MAAO,oBACP0D,SAAU+U,EAAa5xC,OAASgzC,EAAgBhzC,MAChDm8B,QAASsX,GACV,CACGT,EAAgBhzC,QAEX,kBAAc,wBAAoB,OAAQ,GAAa,aADvD,kBAAc,wBAAoB,OAAQ,GAAa,cAE/D,EAAe,KAClB,wBAAoB,SAAU,CAC1B6+B,QAAS,qBACTp/B,IAAK+zC,EACLra,MAAO,oBACP0D,SAAU+U,EAAa5xC,OAASgzC,EAAgBhzC,MAChDm8B,QAASuX,GACV,YAAa,EAAe,SAGvC,wBAAoB,WACpB,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,SAAU,CAC1B7U,QAAS,kBACTp/B,IAAK2zC,EACLja,MAAO,kBACP0D,SAAU+U,EAAa5xC,MACvBm8B,QAAS0X,GACV,CACGjC,EAAa5xC,QAER,kBAAc,wBAAoB,OAAQ,GAAa,aADvD,kBAAc,wBAAoB,OAAQ,GAAa,YAE/D,EAAe,IACjB+X,EAAkB,QACZ,kBAAc,wBAAoB,SAAU,CAC3C6G,IAAK,EACLigB,QAAS,kBACTp/B,IAAK4zC,EACLla,MAAO,oBACP0D,SAAU+U,EAAa5xC,MACvBm8B,QAAS2X,GACV,CACGlC,EAAa5xC,QAER,kBAAc,wBAAoB,OAAQ,GAAa,aADvD,kBAAc,wBAAoB,OAAQ,GAAa,aAE/D,EAAe,MAChB,wBAAoB,QAAQ,MAEtC,wBAAoB,UACnB4xC,EAAkB,QACZ,kBAAc,wBAAoB,MAAO,GAAa,CACrD3V,EAAO,MAAQA,EAAO,KAAM,wBAAoB,MAAO,CAAE9C,MAAO,gBAAkB,EAC9E,wBAAoB,MAAO,CAAEA,MAAO,oBACpC,KACJ,wBAAoB,IAAK,IAAa,qBAAiB2Z,EAAa9yC,OAAQ,OAE9E,wBAAoB,QAAQ,IAClC,wBAAoB,UACnB+yC,EAAoB/yC,QAAU4xC,EAAa5xC,QACrC,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,MAAO,GAAa,CACpCi8B,EAAO,MAAQA,EAAO,KAAM,wBAAoB,IAAK,CAAE9C,MAAO,cAAgB,MAAO,IACrF8C,EAAO,MAAQA,EAAO,KAAM,wBAAoB,IAAK,KAAM,WAAY,KACvE,wBAAoB,SAAU,CAC1B4C,QAAS,iBACTp/B,IAAK6zC,EACLna,MAAO,kBACPgD,QAAS4X,GACV,OAAQ,WAGjB,wBAAoB,QAAQ,QAG1C,wBAAoB,iBACnBd,EAAsB,QAChB,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,MAAO,GAAa,CACpChX,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,KAAM,WAAY,KACxE,qBAAgB,wBAAoB,WAAY,CAC5C,sBAAuBA,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAkBp8B,MAAQo8B,GACxFjD,MAAO,eACP4I,KAAM,IACNxF,YAAa,6CACd,KAAM,KAAuB,CAC5B,CAAC,aAAa2W,EAAgBlzC,UAElC,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,SAAU,CAC1Bm5B,MAAO,kBACP0D,UAAWqW,EAAgBlzC,MAAMid,QAAU+1B,EAAgBhzC,MAC3Dm8B,QAASyX,GACV,CACGZ,EAAgBhzC,QAEX,kBAAc,wBAAoB,OAAQ,GAAa,aADvD,kBAAc,wBAAoB,OAAQ,GAAa,QAE/D,EAAe,KAClB,wBAAoB,SAAU,CAC1Bm5B,MAAO,oBACPgD,QAASwX,GACV,cAIb,wBAAoB,QAAQ,KAG9C,ICpeJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCqQhE,MAAMQ,GAAqB,IAlQlC,MACU32C,aAAc,EAKtB,gBAAMG,GACJ,GAAIC,KAAKJ,YACPK,QAAQC,IAAI,wCAId,IACED,QAAQC,IAAI,yCAENuf,EAAiB,iBAAA1f,aACvBC,KAAKJ,aAAc,EACnBK,QAAQC,IAAI,+BACd,CAAE,MAAOK,GAEP,MADAN,QAAQM,MAAM,gCAAiCA,GACzCA,CACR,CACF,CAMA,0BAAMi2C,GACJ,IACEv2C,QAAQC,IAAI,wCAGZ,MAAMiT,EAAWnT,KAAKy2C,iBACtB,GAAwB,IAApBtjC,EAASjS,OACX,MAAO,cAIT,MAAMw1C,EAAkBvjC,EAASxS,IAAIg2C,IAAO,CAC1C1gC,KAAM0gC,EAAI1gC,KACVC,QAASlW,KAAK42C,cAAcD,EAAIjvC,YAI5BZ,EAAS9G,KAAK62C,kBAAkBH,EAAiB,QAMjDI,EADar3B,EAAiB,iBAAAY,gBACDP,UAC7Bi3B,QAAe/2C,KAAKg3C,eAAelwC,EAAQgwC,GAGjD,OADA72C,QAAQC,IAAI,uCACL62C,CACT,CAAE,MAAOx2C,GAEP,MADAN,QAAQM,MAAM,qCAAsCA,GAC9CA,CACR,CACF,CAOA,yBAAM02C,CAAoB9nC,GACxB,IACElP,QAAQC,IAAI,qCAAsCiP,GAGlD,MAAMgE,EAAWnT,KAAKy2C,iBACtB,GAAwB,IAApBtjC,EAASjS,OACX,MAAO,YAIT,MAAMw1C,EAAkBvjC,EAASxS,IAAIg2C,IAAO,CAC1C1gC,KAAM0gC,EAAI1gC,KACVC,QAASlW,KAAK42C,cAAcD,EAAIjvC,YAI5BiyB,EAAYxqB,EAAa,MAAMA,IAAe,QAC9CrI,EAAS9G,KAAK62C,kBAAkBH,EAAiB/c,GAMjDud,EADaz3B,EAAiB,iBAAAY,gBACAN,WAC9Bg3B,QAAe/2C,KAAKg3C,eAAelwC,EAAQowC,GAGjD,OADAj3C,QAAQC,IAAI,qCACL62C,CACT,CAAE,MAAOx2C,GAEP,MADAN,QAAQM,MAAM,mCAAoCA,GAC5CA,CACR,CACF,CAOA,aAAA42C,CAAcn4B,GACZ,IAGE,GAFA/e,QAAQC,IAAI,gCAAiC8e,IAExCA,GAA8B,KAAnBA,EAAQK,OACtB,MAAO,GAGT,MAAMlM,EAAWnT,KAAKy2C,iBAChBjqB,EAAmE,GAczE,OAZArZ,EAASjP,QAAQ,CAACyyC,EAAKhrC,KACrB,MAAMyrC,EAAiBp3C,KAAK42C,cAAcD,EAAIjvC,SAC1C0vC,EAAernB,cAAcjqB,SAASkZ,EAAQ+Q,gBAChDvD,EAAQzmB,KAAK,CACX4F,QACAsK,KAAM0gC,EAAI1gC,KACVC,QAASkhC,MAKfn3C,QAAQC,IAAI,6BAA6BssB,EAAQtrB,gBAC1CsrB,CACT,CAAE,MAAOjsB,GAEP,OADAN,QAAQM,MAAM,+BAAgCA,GACvC,EACT,CACF,CAMQ,cAAAk2C,GACN,IAIE,OAFoBrjC,gBAAgB,uBAEjBzS,IAAIg2C,IAAO,CAC5B1gC,KAAM0gC,EAAI1gC,KACVvO,QAASivC,EAAIjvC,UAEjB,CAAE,MAAOnH,GAEP,OADAN,QAAQM,MAAM,mCAAoCA,GAC3C,EACT,CACF,CAMA,aAAAq2C,CAAc1gC,GACZ,IAAKA,EAAS,MAAO,GAErB,IAAI06B,EAAU16B,EAmCd,OAhCA06B,EAAUA,EAAQC,QAAQ,WAAY,IAGtCD,EAAUA,EAAQC,QAAQ,iBAAkB,IAG5CD,EAAUA,EAAQC,QAAQ,kBAAmB,IAG7CD,EAAUA,EAAQC,QAAQ,WAAY,IAGtCD,EAAUA,EAAQC,QAAQ,eAAgB,IAG1CD,EAAUA,EAAQC,QAAQ,mBAAoB,MAC9CD,EAAUA,EAAQC,QAAQ,eAAgB,MAC1CD,EAAUA,EAAQC,QAAQ,eAAgB,MAC1CD,EAAUA,EAAQC,QAAQ,aAAc,MAGxCD,EAAUA,EAAQC,QAAQ,gBAAiB,IAG3CD,EAAUA,EAAQC,QAAQ,oDAAqD,IAG/ED,EAAUA,EAAQC,QAAQ,UAAW,QAGrCD,EAAUA,EAAQvxB,OAEXuxB,CACT,CAKQ,iBAAAiG,CAAkB1jC,EAAoDwmB,GAC5E,IAAI7yB,EAAS,QAAQ6yB,0BACrB7yB,GAAU,QACVA,GAAU,qBACVA,GAAU,kBACVA,GAAU,sBACVA,GAAU,mBACVA,GAAU,YAaV,OATuBqM,EAASiX,OADZ,IAGLlmB,QAAQ,CAACyyC,EAAKhrC,KAC3B,MAAM6Q,EAAuB,SAAbm6B,EAAI1gC,KAAkB,KAAO,KAC7CnP,GAAU,IAAI6E,EAAQ,MAAM6Q,KAAWm6B,EAAIzgC,gBAG7CpP,GAAU,aAEHA,CACT,CAOQ,oBAAMkwC,CAAelwC,EAAgBuG,GAG3C,aAAayI,eAAe,YAAa3S,UACvC,IACElD,QAAQC,IAAI,sCAEZ,MAAMm3C,EAAqB,CACzBrhC,gBAAiB,CAAC,CAAEC,KAAM,OAAQC,QAASpP,KAI7C7G,QAAQC,IAAI,sCAIZ,aAFuB6V,YAAYshC,EAGrC,CAAE,MAAO92C,GAEP,MADAN,QAAQM,MAAM,mCAAoCA,GAC5CA,CACR,GAEJ,GCrQI,GAAa,CAAEg7B,MAAO,eACtB,GAAa,CAAEA,MAAO,sBACtB,GAAa,CAAEA,MAAO,wBACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,iBAEL,GAAa,CAAC,SACd,GAAa,CAAEA,MAAO,8BACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CAAC,YACd,GAAc,CAAEva,IAAK,GACrB,GAAc,CAAEA,IAAK,GACrB,GAAc,CAAEua,MAAO,uBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,qBAEL,GAAc,CAAEA,MAAO,oBACvB,GAAc,CAAEA,MAAO,qBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,iBAEL,GAAc,CAAEA,MAAO,eACvB,GAAc,CAAEva,IAAK,GACrB,GAAc,CAAEA,IAAK,GACrB,GAAc,CAAEua,MAAO,iBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAC,WAKrB,IAA6B,qBAAiB,CAC1C2B,OAAQ,aACR1N,MAAO,CACHrgB,WAAY,CAAC,GAEjBguB,MAAO,CAAC,SACR,KAAAC,CAAMC,GACF,MAAM7N,EAAQ6N,EAERte,GAAgB,KAAA3Q,oBAEhB+E,GAAW,IAAAtR,KAAI,IACfy1C,GAAU,IAAAz1C,MAAI,GACd01C,GAAmB,IAAA11C,KAAI,IAAImvB,KAC3BwmB,GAAgB,IAAA31C,KAAI,aACpB41C,GAAqB,IAAA51C,KAAI,IACzB61C,GAAgB,IAAA71C,KAAI,IACpB81C,GAAgB,IAAA91C,KAAI,IACpB+1C,GAAkB,IAAA/1C,KAAI,IACtBg2C,GAAmB,IAAAh2C,MAAI,GAEvByM,GAAY,IAAAnM,UAAS,IAAM4c,EAAcxP,mBACzCuoC,GAAkB,IAAA31C,UAAS,IACzBu1C,EAAct1C,OAASu1C,EAAcv1C,MAAMlB,OAAS,EAE7Cy2C,EAAcv1C,MAAMzB,IAAIkH,IAEpB,IADasL,EAAS/Q,MAAMyF,EAAO8D,OAGtCosC,cAAelwC,EAAO8D,MACtBqsC,eAAe,KAKpB7kC,EAAS/Q,MAAMzB,IAAI,CAACg2C,EAAKhrC,KAAU,IACnCgrC,EACHoB,cAAepsC,MAOvBxI,eAAe80C,IACXX,EAAQl1C,OAAQ,EAChB,IACInC,QAAQC,IAAI,0BAEZ,IAAIg4C,EAAe9kC,gBAAgB,uBAGnC,GAFAnT,QAAQC,IAAI,uBAAwBg4C,EAAah3C,OAAQ,OAE7B,IAAxBg3C,EAAah3C,OAAc,CAC3BjB,QAAQC,IAAI,gCAEZ,MAAMi4C,EAAU/kC,iBAAiB,GACjC,GAAI+kC,GAAWA,EAAQj3C,OAAS,EAAG,CAC/B,MAAMk3C,EAASD,EAAQ,GAAG96B,WAC1Bpd,QAAQC,IAAI,0BAA2Bk4C,GAEvCF,EAAe9kC,gBAAgB,KAAKglC,KACpCn4C,QAAQC,IAAI,uBAAwBg4C,EAAah3C,OAAQ,MAC7D,CACJ,CAEAiS,EAAS/Q,MAAQ81C,EAAav3C,IAAI,CAACg2C,EAAKhrC,KAAU,CAC9CpI,KAAMozC,EAAIpzC,KACV80C,QAAsB,SAAb1B,EAAI1gC,KACbqiC,UAAwB,WAAb3B,EAAI1gC,KACfsiC,IAAK5B,EAAIjvC,QACT8wC,eAAW12C,EACXi2C,cAAepsC,KAEnB1L,QAAQC,IAAI,oBAAqBiT,EAAS/Q,MAAMlB,OAAQ,OAExDiS,EAAS/Q,MAAMgoB,MAAM,EAAG,GAAGlmB,QAAQ,CAACyyC,EAAKntC,KACrCvJ,QAAQC,IAAI,mBAAmBsJ,KAAMmtC,EAAIpzC,KAAMozC,EAAI0B,QAAU,OAAS,OAAQ1B,EAAI4B,IAAIvrC,UAAU,EAAG,IAAM,QAEjH,CACA,MAAOzM,GACHN,QAAQM,MAAM,uBAAwBA,GACtC6D,OAAO7D,MAAM,YACb4S,EAAS/Q,MAAQ,EACrB,CACA,QACIk1C,EAAQl1C,OAAQ,CACpB,CACJ,CAIA,SAASq2C,IACLx4C,QAAQC,IAAI,qBAAsBs3C,EAAcp1C,OAEhDs1C,EAAct1C,MAAQ,GACtBu1C,EAAcv1C,MAAQ,GACtBw1C,EAAgBx1C,MAAQ,GAExB61C,GACJ,CAIA,SAASS,IACLz4C,QAAQC,IAAI,qBAAsBu3C,EAAmBr1C,OAErDs1C,EAAct1C,MAAQ,GACtBu1C,EAAcv1C,MAAQ,GACtBw1C,EAAgBx1C,MAAQ,GAExB61C,GACJ,CAIA,SAASU,IACL,IAAKjB,EAAct1C,OAAwC,KAA/Bs1C,EAAct1C,MAAMid,OAG5C,OAFAs4B,EAAcv1C,MAAQ,QACtBgC,OAAOoB,KAAK,YAGhBvF,QAAQC,IAAI,sBAAuBw3C,EAAct1C,OACjD,IACI,MAAMoqB,EAAU+pB,GAAmBY,cAAcO,EAAct1C,OAC/Du1C,EAAcv1C,MAAQoqB,EACC,IAAnBA,EAAQtrB,OACRkD,OAAOoB,KAAK,YAGZpB,OAAOI,QAAQ,MAAMgoB,EAAQtrB,eAErC,CACA,MAAOX,GACHN,QAAQM,MAAM,qBAAsBA,GACpC6D,OAAO7D,MAAM,OACjB,CACJ,CAIA4C,eAAey1C,IACX,IAAIf,EAAiBz1C,MAArB,CAEAy1C,EAAiBz1C,OAAQ,EACzBw1C,EAAgBx1C,MAAQ,GACxB,IAII,IAAI20C,EAHJ92C,QAAQC,IAAI,oCAENq2C,GAAmBx2C,aAGrBg3C,EADwB,cAAxBS,EAAcp1C,YACCm0C,GAAmBC,6BAGnBD,GAAmBU,oBAAoBQ,EAAmBr1C,YAASN,GAEtF81C,EAAgBx1C,MAAQ20C,EACxB3yC,OAAOI,QAAQ,aAEfqhC,WAAW,IAAMgT,IAAe,IACpC,CACA,MAAOt4C,GACHN,QAAQM,MAAM,2BAA4BA,GAC1C6D,OAAO7D,MAAM,aACjB,CACA,QACIs3C,EAAiBz1C,OAAQ,CAC7B,CAzBU,CA0Bd,CAIA,SAAS02C,EAAoB5iC,GACzB,IAAKA,EACD,MAAO,GACX,IAAI06B,EAAU16B,EAwBd,OAtBA06B,EAAUA,EAAQC,QAAQ,WAAY,IAEtCD,EAAUA,EAAQC,QAAQ,iBAAkB,IAE5CD,EAAUA,EAAQC,QAAQ,4BAA6B,IAEvDD,EAAUA,EAAQC,QAAQ,kBAAmB,IAE7CD,EAAUA,EAAQC,QAAQ,WAAY,IAEtCD,EAAUA,EAAQC,QAAQ,eAAgB,IAE1CD,EAAUA,EAAQC,QAAQ,mBAAoB,MAC9CD,EAAUA,EAAQC,QAAQ,eAAgB,MAC1CD,EAAUA,EAAQC,QAAQ,eAAgB,MAC1CD,EAAUA,EAAQC,QAAQ,aAAc,MAExCD,EAAUA,EAAQC,QAAQ,gBAAiB,IAE3CD,EAAUA,EAAQC,QAAQ,UAAW,QAErCD,EAAUA,EAAQvxB,OACXuxB,CACX,CAIAztC,eAAe41C,UACLd,IACN7zC,OAAOI,QAAQ,UACnB,CAIA,SAASq0C,IACL,MAAM3iC,EAAU0pB,SAASC,cAAc,kBACnC3pB,GACAA,EAAQ8iC,SAAS,CAAE1T,IAAK,EAAG2T,SAAU,UAE7C,CAIA,SAAS5G,IACL,MAAMn8B,EAAU0pB,SAASC,cAAc,kBACnC3pB,GACAA,EAAQ8iC,SAAS,CAAE1T,IAAKpvB,EAAQq8B,aAAc0G,SAAU,UAEhE,CAqBA,OARA,IAAA9a,WAAU,KAEF3O,EAAMrgB,aACNqoC,EAAcp1C,MAAQ,aACtBq1C,EAAmBr1C,MAAQotB,EAAMrgB,YAErC8oC,MAEG,CAAC7Z,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,MAAO,GAAY,CACnCA,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAE9C,MAAO,qBAAuB,WAAY,KAChG,wBAAoB,SAAU,CAC1BA,MAAO,YACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAYJ,EAAK8a,MAAM,WAC5D,QAEP,wBAAoB,kBACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,GAAY,CACnC7a,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,CAAE9C,MAAO,iBAAmB,OAAQ,KAC3F,qBAAgB,wBAAoB,SAAU,CAC1C,sBAAuB8C,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAgBp8B,MAAQo8B,GACtFjD,MAAO,iBACPmD,SAAU+Z,GACX,IAAKpa,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,SAAU,CAAEj8B,MAAO,aAAe,QAAS,IAC/D,wBAAoB,SAAU,CAAEA,MAAO,cAAgB,SAAU,MAC/D,KAAuC,CAC7C,CAAC,eAAeo1C,EAAcp1C,YAGtC,wBAAoB,uBACK,eAAxBo1C,EAAcp1C,QACR,kBAAc,wBAAoB,MAAO,GAAY,CACpDi8B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,CAAE9C,MAAO,iBAAmB,OAAQ,KAC3F,qBAAgB,wBAAoB,SAAU,CAC1C,sBAAuB8C,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAqBp8B,MAAQo8B,GAC3FjD,MAAO,oBACPmD,SAAUga,GACX,CACCra,EAAO,KAAOA,EAAO,IAAK,wBAAoB,SAAU,CAAEj8B,MAAO,IAAM,QAAS,MAC/E,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYkM,EAAUlM,MAAQyM,KAC1E,kBAAc,wBAAoB,SAAU,CAChDmS,IAAKnS,EAASjM,GACdR,MAAOyM,EAASjM,KACjB,qBAAiBiM,EAAStL,MAAO,EAAqB,MACzD,OACL,KAAuC,CACtC,CAAC,eAAek0C,EAAmBr1C,aAGzC,wBAAoB,QAAQ,IAClC,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,EACnC,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuBi8B,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAgBp8B,MAAQo8B,GACtFx9B,KAAM,OACNu6B,MAAO,eACPoD,YAAa,WACb0F,SAAS,cAAUsU,EAAe,CAAC,WACpC,KAAM,KAAuC,CAC5C,CAAC,aAAajB,EAAct1C,UAEhC,wBAAoB,SAAU,CAC1Bm5B,MAAO,aACPgD,QAASoa,GACV,SAEP,wBAAoB,cACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,SAAU,CAC1Bpd,MAAO,gBACP0D,SAAU4Y,EAAiBz1C,MAC3Bm8B,QAASqa,GACV,CACGf,EAAiBz1C,QAEZ,kBAAc,wBAAoB,OAAQ,GAAa,aADvD,kBAAc,wBAAoB,OAAQ,GAAa,aAE/D,EAAe,SAG1B,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,aACnBw1C,EAAqB,QACf,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,MAAO,GAAa,CACpCvZ,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,KAAM,cAAe,KAC3E,wBAAoB,SAAU,CAC1B9C,MAAO,mBACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAYoZ,EAAgBx1C,MAAQ,KACzE,QAEP,wBAAoB,MAAO,IAAa,qBAAiBw1C,EAAgBx1C,OAAQ,OAEnF,wBAAoB,QAAQ,IAClC,wBAAoB,UACnBk1C,EAAa,QACP,kBAAc,wBAAoB,MAAO,GAAa,IAAKjZ,EAAO,MAAQA,EAAO,IAAM,EAClF,wBAAoB,MAAO,CAAE9C,MAAO,mBAAqB,MAAO,IAChE,wBAAoB,IAAK,KAAM,UAAW,QAEd,IAAjCuc,EAAgB11C,MAAMlB,SAClB,kBAAc,wBAAoB,WAAW,CAAE8f,IAAK,GAAK,EACxD,wBAAoB,UACpB,wBAAoB,MAAO,GAAa,CACpCqd,EAAO,MAAQA,EAAO,KAAM,wBAAoB,IAAK,KAAM,MAAO,IACjEqZ,EAAmB,QACb,kBAAc,wBAAoB,IAAK,GAAa,eACpD,kBAAc,wBAAoB,IAAK,GAAa,cAEhE,SACA,kBAAc,wBAAoB,WAAW,CAAE12B,IAAK,GAAK,EACxD,wBAAoB,WACpB,wBAAoB,MAAO,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY82B,EAAgB11C,MAAO,CAACsF,EAASiE,MACzF,kBAAc,wBAAoB,MAAO,CAC7CqV,IAAKrV,EACL4vB,OAAO,oBAAgB,CAAC,eAAgB,CAChC,UAAW7zB,EAAQ2wC,QACnB,YAAa3wC,EAAQ4wC,UACrB,iBAAkB5wC,EAAQswC,kBAEnC,EACC,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,OAAQ,IAAa,qBAAiBtwC,EAAQnE,MAAO,IACzE,wBAAoB,OAAQ,GAAa,KAAM,qBAAiBmE,EAAQqwC,cAAgB,GAAI,MAEhG,wBAAoB,MAAO,CACvBxc,OAAO,oBAAgB,CAAC,kBAAmB,CAAE,gBAAiBgc,EAAiBn1C,MAAM6G,IAAI0C,MACzF4yB,QAAUC,GA3IlD,SAAsB7yB,GACd4rC,EAAiBn1C,MAAM6G,IAAI0C,GAC3B4rC,EAAiBn1C,MAAMmD,OAAOoG,GAG9B4rC,EAAiBn1C,MAAMwiC,IAAIj5B,EAEnC,CAoI6D,CAAcA,KACpC,qBAAiBmtC,EAAoBpxC,EAAQ6wC,MAAO,GAA6B,KACrF,KACH,SAET,UAEf,wBAAoB,MAAO,CAAEhd,MAAO,sBAAwB,EACxD,wBAAoB,SAAU,CAC1BA,MAAO,aACPgD,QAASwa,GACV,IAAK1a,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,KAAM,MAAO,IACzC,wBAAoB,OAAQ,KAAM,MAAO,QAEjD,wBAAoB,SAAU,CAC1B9C,MAAO,aACPgD,QAASsa,GACV,IAAKxa,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,KAAM,MAAO,IACzC,wBAAoB,OAAQ,KAAM,QAAS,QAEnD,wBAAoB,SAAU,CAC1B9C,MAAO,aACPgD,QAAS8T,GACV,IAAKhU,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,KAAM,MAAO,IACzC,wBAAoB,OAAQ,KAAM,QAAS,WAKnE,IC/aJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAE9C,MAAO,mBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,sBAEL,GAAa,CACfva,IAAK,EACLua,MAAO,eAEL,GAAa,CACfva,IAAK,EACLua,MAAO,iBAEL,GAAa,CAAC,WACd,GAAa,CAAEA,MAAO,wBACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,eAEL,GAAa,CACfva,IAAK,EACLua,MAAO,gBAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,mBAEL,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,aAEL,GAAc,CAAEA,MAAO,wBACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAAEA,MAAO,YACvB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,YACvB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,YACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,oBAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,mBAEL,GAAc,CAAC,WACf,GAAc,CAAEA,MAAO,mBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,oBAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,mBAEL,GAAc,CAAEA,MAAO,eACvB4d,GAAc,CAChBn4B,IAAK,EACLua,MAAO,qBAEL6d,GAAc,CAAE7d,MAAO,kBACvB8d,GAAc,CAChBr4B,IAAK,EACLua,MAAO,mBAEL+d,GAAc,CAChBt4B,IAAK,EACLua,MAAO,mBAELge,GAAc,CAChBv4B,IAAK,EACLua,MAAO,mBAELie,GAAc,CAAEje,MAAO,qBACvBke,GAAc,CAAC,WACfC,GAAc,CAAEne,MAAO,kBACvBoe,GAAc,CAAEpe,MAAO,iBACvBqe,GAAc,CAChB54B,IAAK,EACLua,MAAO,gBAELse,GAAc,CAChB74B,IAAK,EACLua,MAAO,eAELue,GAAc,CAAEve,MAAO,gBACvBwe,GAAc,CAAExe,MAAO,cACvBye,GAAc,CAChBh5B,IAAK,EACLua,MAAO,kBAEL0e,GAAc,CAAE1e,MAAO,iBACvB2e,GAAc,CAChBl5B,IAAK,EACLua,MAAO,oBAEL4e,GAAc,CAChBn5B,IAAK,EACLua,MAAO,kBAEL6e,GAAc,CAAE7e,MAAO,iBACvB8e,GAAc,CAAE9e,MAAO,iBACvB+e,GAAc,CAAE/e,MAAO,kBACvBgf,GAAc,CAAEhf,MAAO,gBACvBif,GAAc,CAAEjf,MAAO,gBACvBkf,GAAc,CAAElf,MAAO,uBACvBmf,GAAc,CAChB15B,IAAK,EACLua,MAAO,kBAELof,GAAc,CAAEpf,MAAO,eACvBqf,GAAc,CAAErf,MAAO,iCACvBsf,GAAc,CAAEtf,MAAO,kBACvBuf,GAAc,CAAEvf,MAAO,qBACvBwf,GAAc,CAAExf,MAAO,iBAO7B,IAA6B,qBAAiB,CAC1C2B,OAAQ,iBACRC,MAAO,CAAC,SACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMD,EAAOC,EAEPxe,GAAgB,KAAA3Q,oBAEhB4sC,GAAmB,IAAAn5C,KAAI,MACvBo5C,GAAqB,IAAAp5C,KAAI,IAAImvB,KAC7BkqB,GAAuB,IAAAr5C,MAAI,GAC3Bs5C,GAAiB,IAAAt5C,MAAI,GAErBu5C,GAAsB,IAAAj5C,UAAS,IAC5B64C,EAAiB54C,MAEf2c,EAAczQ,UAAUzL,IAAIm4C,EAAiB54C,OADzC,MAGTi5C,GAAe,IAAAl5C,UAAS,IACrBi5C,EAAoBh5C,MAElB,IAAIg5C,EAAoBh5C,MAAMsE,QAAQ6jB,KAAK,CAAC1gB,EAAGwkB,IAAMxkB,EAAE8P,UAAY0U,EAAE1U,WADjE,IAsCfxW,eAAem4C,EAAuBh3C,GAClC,GAAK02C,EAAiB54C,MAGtB,GAAuB,QAAnBkC,EAAUtD,KAId,IAEI,MAAM6N,EAAWusC,EAAoBh5C,MACrC,GAAIyM,EAAU,CACV,MAAM0sC,EAAoBx8B,EAAcpP,2BAA2Bd,EAASe,cACtE4rC,EAmBlB,SAAgCvP,EAAe39B,GAC3C,IAAK,MAAMO,KAAYP,EAAW,CAC9B,MAAMmtC,EAAQ5sC,EAASjL,WAAW+I,KAAKnC,GAAKA,EAAElG,UAAUf,OAAS0oC,GACjE,GAAIwP,EACA,OAAOA,EAAMn3C,SAErB,CACA,OAAO,IACX,CA3BuCo3C,CAAuBp3C,EAAUf,KAAMg4C,GAC9DC,IAEAv7C,QAAQC,IAAI,yBAAyBoE,EAAUf,YAC/Ca,OAAOoB,KAAK,OAAOlB,EAAUf,kBAGrC,OAEMwb,EAAclP,uBAAuBmrC,EAAiB54C,MAAOkC,GAAW,GAC9E42C,EAAqB94C,OAAQ,CACjC,CACA,MAAO7B,GACHN,QAAQM,MAAM,8BAA+BA,EACjD,MAtBIN,QAAQK,KAAK,kCAuBrB,CAyBA,SAASq7C,EAAWhiC,GAChB,MAAMiiC,EAAO,IAAIjrC,KAAKgJ,GAChB/I,EAAM,IAAID,KAGhB,OAFaC,EAAIirC,UAAYD,EAAKC,UAEvB,OAAuBD,EAAKE,YAAclrC,EAAIkrC,UAC9CF,EAAKG,mBAAmB,QAAS,CAAEC,KAAM,UAAWC,OAAQ,YAGnEL,EAAKM,gBAAkBtrC,EAAIsrC,cACpBN,EAAKO,mBAAmB,QAAS,CAAEC,MAAO,UAAWC,IAAK,UAAWL,KAAM,UAAWC,OAAQ,YAGlGL,EAAKO,mBAAmB,QAAS,CACpCG,KAAM,UACNF,MAAO,UACPC,IAAK,UACLL,KAAM,UACNC,OAAQ,WAEhB,CAeA,SAASM,IACLpB,EAAe/4C,OAAQ,CAC3B,CAKAe,eAAeq5C,IACX,IAAKxB,EAAiB54C,MAClB,OAGJ,GADkB67B,QAAQ,oFAG1B,UAEUlf,EAAc/N,iBAAiBgqC,EAAiB54C,OAEtDqd,EAAiB,iBAAAc,oBAEjB,MAAM,iBAAE5gB,SAA2B,2CAC7BA,EAAiBa,2BAEvB4D,OAAOI,QAAQ,sBAEfw2C,EAAiB54C,MAAQ,IAC7B,CACA,MAAO7B,GACHN,QAAQM,MAAM,2BAA4BA,GAC1C6D,OAAO7D,MAAM,SACjB,CACJ,CAKA4C,eAAes5C,IACX,GAAKzB,EAAiB54C,MAEtB,IAEIqd,EAAiB,iBAAAc,oBAEjB,MAAM,iBAAE5gB,SAA2B,2CAC7BA,EAAiBa,2BAEvB,MAAM,aAAE+gB,SAAuB,sCACzB2e,EAAY3e,UACZ2e,EAAUhxB,mBAAmB,MACnC9K,OAAOoB,KAAK,iBAEZw1C,EAAiB54C,MAAQ,IAC7B,CACA,MAAO7B,GACHN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,WACjB,CACJ,CACA,MAAO,CAAC69B,EAAMC,KACV,OAAQ,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,cACpB,wBAAoB,SAAU,CAC1B9C,MAAO,oBACPsD,MAAO,KACPN,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAYlB,EAAK,WACtD,MACH,wBAAoB,YAClB0d,EAAiB54C,MAiDZg5C,EAAyB,QACrB,kBAAc,wBAAoB,WAAW,CAAEp6B,IAAK,GAAK,EACxD,wBAAoB,aACpB,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,SAAU,CAC1Bua,MAAO,WACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAYwc,EAAiB54C,MAAQ,OAC1E,IAAKi8B,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,CAAE9C,MAAO,aAAe,KAAM,IAC1D,qBAAiB,UAAW,QAEpC,wBAAoB,KAAM,IAAa,qBAAiB6f,EAAoBh5C,MAAMmB,MAAO,MAE7F,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,WACpB,wBAAoB,UAAW,GAAa,CACxC86B,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAE9C,MAAO,iBAAmB,QAAS,KAC3F,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,MAAO,GAAa,CACpC8C,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,OAAQ,KACzF,wBAAoB,OAAQ,IAAa,qBAAiB6f,EAAoBh5C,MAAMpB,MAAO,MAE/F,wBAAoB,MAAO,GAAa,CACpCq9B,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,OAAQ,KACzF,wBAAoB,OAAQ,IAAa,qBAAiB,IAAI+S,OAAO8M,EAAoBh5C,MAAM4X,aAAc,MAEjH,wBAAoB,MAAO,GAAa,CACpCqkB,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,OAAQ,KACzF,wBAAoB,OAAQ,CACxBA,OAAO,oBAAgB,CAAC,0BAA2B,UAAU6f,EAAoBh5C,MAAMmE,aACxF,sBA9JpBA,EA8JmD60C,EAAoBh5C,MAAMmE,OA7J9E,CACdm2C,MAAO,KACPpe,OAAQ,MACRqe,UAAW,OAEEp2C,IAAWA,IAwJ8E,UAIlF,wBAAoB,aACpB,wBAAoB,UAAW,GAAa,CACxC83B,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAE9C,MAAO,iBAAmB,UAAW,KAC7F,wBAAoB,IAAK,IAAa,qBAAiB6f,EAAoBh5C,MAAMwN,cAAe,MAEpG,wBAAoB,WACpB,wBAAoB,UAAW,GAAa,EACxC,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,KAAM,GAAa,UAAW,qBAAiBwrC,EAAoBh5C,MAAMwB,WAAW1C,QAAU,IAAK,IACvH,wBAAoB,SAAU,CAC1Bq6B,MAAO,UACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAY0c,EAAqB94C,OAAQ,IAC9E,IAAKi8B,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,CAAE9C,MAAO,YAAc,KAAM,IACzD,qBAAiB,UAAW,SAGS,IAAhD6f,EAAoBh5C,MAAMwB,WAAW1C,SAC/B,kBAAc,wBAAoB,MAAO,GAAa,IAAKm9B,EAAO,MAAQA,EAAO,IAAM,EAClF,wBAAoB,IAAK,CAAE9C,MAAO,cAAgB,UAAW,UAElE,kBAAc,wBAAoB,MAAO,GAAa,GACpD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY6f,EAAoBh5C,MAAMwB,WAAa8L,KAC/F,kBAAc,wBAAoB,MAAO,CAC7CsR,IAAKtR,EAAehK,YACpB61B,OAAO,oBAAgB,CAAC,iBAAkB,CAAEqhB,UAAWltC,EAAezM,gBACvE,EACC,wBAAoB,MAAO,CACvBs4B,MAAO,mBACPgD,QAAUC,IAAW,OApS1C94B,EAoSiEgK,EAAehK,iBAnSvGu1C,EAAmB74C,MAAM6G,IAAIvD,GAC7Bu1C,EAAmB74C,MAAMmD,OAAOG,GAGhCu1C,EAAmB74C,MAAMwiC,IAAIl/B,IALrC,IAA+BA,IAqSoB,EACC,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,OAAQ,IAAa,qBAAiBgK,EAAepL,UAAUf,MAAO,GACzFmM,EAAyB,aACnB,kBAAc,wBAAoB,OAAQ,IAAa,qBAAiB,IAAI4+B,OAAO5+B,EAAeI,aAAc,IAChHJ,EAA0B,cACtB,kBAAc,wBAAoB,OAAQ,GAAa,QACxD,wBAAoB,QAAQ,MAE1C,wBAAoB,OAAQ,IAAa,qBAAiBurC,EAAmB74C,MAAM6G,IAAIyG,EAAehK,aAAe,IAAM,KAAM,IAClI,EAAe,IACjBu1C,EAAmB74C,MAAM6G,IAAIyG,EAAehK,eACtC,kBAAc,wBAAoB,MAAOyzC,GAAa,EACrD,wBAAoB,MAAOC,GAAa,CACnC1pC,EAAepL,UAAoB,aAC7B,kBAAc,wBAAoB,IAAK+0C,GAAa,SAAU,qBAAiB3pC,EAAepL,UAAU0C,YAAa,KACtH,wBAAoB,QAAQ,GACjC0I,EAAepL,UAAoB,aAC7B,kBAAc,wBAAoB,IAAKg1C,IAAa,qBAAiB5pC,EAAepL,UAAU2C,YAAa,KAC5G,wBAAoB,QAAQ,GACjCyI,EAA8B,kBACxB,kBAAc,wBAAoB,IAAK6pC,GAAa,WAAY,qBAAiB7pC,EAAe8J,iBAAkB,KACnH,wBAAoB,QAAQ,MAEtC,wBAAoB,MAAOggC,GAAa,EACpC,wBAAoB,SAAU,CAC1Bje,MAAO,uBACPgD,QAAUC,GArT1Er7B,eAA+BuC,GAC3B,GAAKs1C,EAAiB54C,MAEtB,UACU2c,EAActP,mBAAmBurC,EAAiB54C,MAAOsD,EACnE,CACA,MAAOnF,GACHN,QAAQM,MAAM,8BAA+BA,EACjD,CACJ,CA4SqF,CAAiBmP,EAAehK,eACtD,qBAAiBgK,EAAezM,YAAc,OAAS,QAAS,EAAqBw2C,UAG9F,wBAAoB,QAAQ,IACnC,KACH,YAGhB,wBAAoB,WACpB,wBAAoB,UAAWC,GAAa,EACxC,wBAAoB,KAAMC,GAAa,UAAW,qBAAiByB,EAAoBh5C,MAAMsE,OAAOxF,QAAU,IAAK,GACtE,IAA5Ck6C,EAAoBh5C,MAAMsE,OAAOxF,SAC3B,kBAAc,wBAAoB,MAAO04C,GAAa,IAAKvb,EAAO,MAAQA,EAAO,IAAM,EAClF,wBAAoB,IAAK,CAAE9C,MAAO,cAAgB,YAAa,UAEpE,kBAAc,wBAAoB,MAAOse,GAAa,GACpD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYwB,EAAaj5C,MAAQqE,KAC7E,kBAAc,wBAAoB,MAAO,CAC7Cua,IAAKva,EAAM7D,GACX24B,MAAO,cACR,EACC,wBAAoB,MAAOue,GAAa,EACpC,wBAAoB,OAAQC,IAAa,qBAAiB4B,EAAWl1C,EAAMkT,YAAa,GACvFlT,EAAc,WACR,kBAAc,wBAAoB,OAAQuzC,IAAa,qBAAiBvzC,EAAMmT,UAAW,KAC1F,wBAAoB,QAAQ,MAEtC,wBAAoB,IAAKqgC,IAAa,qBAAiBxzC,EAAMqK,SAAU,GACtErK,EAAMoT,mBAAmB3Y,OAAS,IAC5B,kBAAc,wBAAoB,MAAOg5C,GAAa,CACrD7b,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAE9C,MAAO,kBAAoB,SAAU,MAC9F,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY90B,EAAMoT,mBAAqBgjC,KACnF,kBAAc,wBAAoB,OAAQ,CAC9C77B,IAAK67B,EACLthB,MAAO,uBACR,qBAhS/D,SAA0B71B,GACtB,IAAK01C,EAAoBh5C,MACrB,MAAO,KACX,MAAMsN,EAAiB0rC,EAAoBh5C,MAAMwB,WAAW+I,KAAMnC,GAAMA,EAAE9E,cAAgBA,GAC1F,OAAOgK,GAAgBpL,UAAUf,MAAQ,IAC7C,CA2RgFu5C,CAAiBD,IAAU,KAC/C,UAEN,wBAAoB,QAAQ,OAEtC,YAGhB,wBAAoB,SACnBzB,EAAoBh5C,MAAM+N,UAAYirC,EAAoBh5C,MAAM+N,SAASjP,OAAS,IAC5E,kBAAc,wBAAoB,UAAWi5C,GAAa,EACzD,wBAAoB,KAAMC,GAAa,SAAU,qBAAiBgB,EAAoBh5C,MAAM+N,SAASjP,QAAU,IAAK,IACpH,wBAAoB,MAAOm5C,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYe,EAAoBh5C,MAAM+N,SAAWD,KAC7F,kBAAc,wBAAoB,MAAO,CAC7C8Q,IAAK9Q,EAAQtN,GACb24B,MAAO,gBACR,EACC,wBAAoB,MAAO+e,GAAa,EACpC,wBAAoB,OAAQC,IAAa,qBAAiBrqC,EAAQ3M,MAAO,IACzE,wBAAoB,OAAQi3C,IAAa,qBAAiBmB,EAAWzrC,EAAQ6sC,aAAc,MAE/F,wBAAoB,IAAKtC,IAAa,qBAAiBvqC,EAAQhG,aAAc,OAEjF,YAGV,wBAAoB,QAAQ,IAClC,wBAAoB,QACnBkxC,EAAoBh5C,MAAY,SAC1B,kBAAc,wBAAoB,UAAWs4C,GAAa,CACzDrc,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAE9C,MAAO,iBAAmB,QAAS,KAC3F,wBAAoB,IAAKof,IAAa,qBAAiBS,EAAoBh5C,MAAM6X,QAAS,OAE5F,wBAAoB,QAAQ,IAClC,wBAAoB,WACpB,wBAAoB,UAAW2gC,GAAa,EACxC,wBAAoB,MAAOC,GAAa,EACpC,wBAAoB,SAAU,CAC1Btf,MAAO,mCACPgD,QAASge,GACV,IAAKle,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,CAAE9C,MAAO,eAAiB,MAAO,IAC7D,wBAAoB,OAAQ,CAAEA,MAAO,eAAiB,QAAS,OAEjC,WAArC6f,EAAoBh5C,MAAMmE,SACpB,kBAAc,wBAAoB,SAAU,CAC3Cya,IAAK,EACLua,MAAO,oCACPgD,QAASie,GACV,IAAKne,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,CAAE9C,MAAO,eAAiB,MAAO,IAC7D,wBAAoB,OAAQ,CAAEA,MAAO,eAAiB,QAAS,SAErE,wBAAoB,QAAQ,IAClC,wBAAoB,SAAU,CAC1BA,MAAO,sCACPgD,QAASke,GACV,IAAKpe,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,CAAE9C,MAAO,eAAiB,MAAO,IAC7D,wBAAoB,OAAQ,CAAEA,MAAO,eAAiB,UAAW,gBAM1F,QACD,wBAAoB,QAAQ,KAnP/B,kBAAc,wBAAoB,MAAO,GAAY,CACpD8C,EAAO,MAAQA,EAAO,KAAM,wBAAoB,MAAO,CAAE9C,MAAO,iBAAmB,EAC/E,wBAAoB,KAAM,CAAEA,MAAO,gBAAkB,SACrD,wBAAoB,IAAK,CAAEA,MAAO,mBAAqB,qBACvD,IACqC,KAAxC,WAAOxc,GAAexS,gBAChB,kBAAc,wBAAoB,MAAO,GAAY,IAAK8xB,EAAO,KAAOA,EAAO,GAAK,EAC/E,wBAAoB,IAAK,CAAE9C,MAAO,cAAgB,UAAW,IAC7D,wBAAoB,IAAK,CAAEA,MAAO,cAAgB,oBAAqB,UAE5E,kBAAc,wBAAoB,MAAO,GAAY,GACnD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,iBAAY,WAAOxc,GAAetQ,aAAeI,KAC7F,kBAAc,wBAAoB,MAAO,CAC7CmS,IAAKnS,EAASjM,GACd24B,OAAO,oBAAgB,CAAC,gBAAiB,CAAE+C,OAAQzvB,EAASqL,YAC5DqkB,QAAUC,IAAW,OA1M7BrvB,EA0M6CN,EAASjM,GAzM1Eo4C,EAAiB54C,MAAQ+M,OACzB8rC,EAAmB74C,MAAM2B,QAF7B,IAAwBoL,IA2MO,EACC,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,KAAM,IAAY,qBAAiBN,EAAStL,MAAO,GAClD,UAApBsL,EAAStI,SACH,kBAAc,wBAAoB,OAAQ,GAAY,OAClC,WAApBsI,EAAStI,SACL,kBAAc,wBAAoB,OAAQ,GAAY,QAClC,cAApBsI,EAAStI,SACL,kBAAc,wBAAoB,OAAQ,GAAa,SACxD,wBAAoB,QAAQ,MAE9C,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,OAAQ,GAAa,CACrC83B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,OAAQ,KACvF,wBAAoB,OAAQ,IAAa,qBAAiB1sB,EAAS7N,MAAO,MAE9E,wBAAoB,OAAQ,GAAa,CACrCq9B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,OAAQ,KACvF,wBAAoB,OAAQ,IAAa,qBAAiB,IAAI+S,OAAOz/B,EAASmL,aAAc,QAGpG,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,OAAQ,IAAa,qBAAiBnL,EAASjL,WAAW1C,QAAU,MAAO,IAC/F,wBAAoB,OAAQ,IAAa,qBAAiB2N,EAASnI,OAAOxF,QAAU,MAAO,GAC1F2N,EAASsB,UAAYtB,EAASsB,SAASjP,OAAS,IAC1C,kBAAc,wBAAoB,OAAQ,IAAa,qBAAiB2N,EAASsB,SAASjP,QAAU,QAAS,KAC9G,wBAAoB,QAAQ,MAEvC,GAAuB,MAC1B,aAuMpB,wBAAoB,YACnBi6C,EAAoB,QACd,kBAAc,wBAAoB,MAAO,CACxCn6B,IAAK,EACLua,MAAO,gBACPgD,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAgBG,GAAY2c,EAAe/4C,OAAQ,EAAQ,CAAC,WAChG,EACC,wBAAoB,MAAO04C,GAAa,EACpC,iBAAakC,GAAY,CACrB,cAAehC,EAAiB54C,YAASN,EACzCm7C,QAAS5e,EAAO,KAAOA,EAAO,GAAMG,GAAY2c,EAAe/4C,OAAQ,IACxE,KAAM,EAAe,CAAC,sBAG/B,wBAAoB,QAAQ,IAClC,wBAAoB,YACnB84C,EAA0B,QACpB,kBAAc,wBAAoB,MAAO,CACxCl6B,IAAK,EACLua,MAAO,gBACPgD,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAgBG,GAAY0c,EAAqB94C,OAAQ,EAAQ,CAAC,WACtG,EACC,wBAAoB,MAAO24C,GAAa,EACpC,iBAAamC,GAAkB,CAC3B,kBAAkB,EAClB,iBAAkB,MAClBC,UAAW7B,EACX8B,YAAa/e,EAAO,KAAOA,EAAO,GAAMG,GAAY0c,EAAqB94C,OAAQ,WAI3F,wBAAoB,QAAQ,KAlW1C,IAAuBmE,EAqW3B,ICnnBJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qB,cCJvE,MAAM,GAAa,CAAEg1B,MAAO,mBACtB,GAAa,CAAEA,MAAO,kBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,qBAEL,GAAa,CACfva,IAAK,EACLua,MAAO,mBAEL,GAAa,CACfva,IAAK,EACLua,MAAO,cAEL,GAAa,CAAC,WACd,GAAa,CAAEA,MAAO,eACtB,GAAa,CAAEA,MAAO,aACtB,GAAa,CACfva,IAAK,EACLua,MAAO,aAEL,GAAc,CAAEA,MAAO,oBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,aAEL,GAAc,CAAEA,MAAO,eACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,qBAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,mBAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,cAEL,GAAc,CAAC,WACf,GAAc,CAAEA,MAAO,eACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,aAEL,GAAc,CAAEA,MAAO,oBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,aAEL,GAAc,CAAEA,MAAO,eACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,eAEL,GAAc,CAAEA,MAAO,sBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,eAEL,GAAc,CAAEva,IAAK,GACrB,GAAc,CAAEua,MAAO,kBAI7B,IAA6B,qBAAiB,CAC1C2B,OAAQ,iBACRC,MAAO,CAAC,SACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAEMrR,GAAiB,KAAA/gB,qBACjBkyC,GAAa,IAAAx7C,KAAI,aACjBy7C,GAAe,IAAAz7C,KAAI,MAKzB,SAAS07C,EAAW/xC,GAChB8xC,EAAal7C,MAAQoJ,CACzB,CAIA,SAASgyC,IACAF,EAAal7C,QAElBgC,OAAOoB,KAAK,OAAO83C,EAAal7C,MAAMmB,QAEtC+5C,EAAal7C,MAAQ,KACzB,CAIAe,eAAes6C,IACX,IAAKH,EAAal7C,MACd,OACJ,MAAMoJ,EAAO8xC,EAAal7C,MACpBs7C,EAAWlyC,EAAKjI,KACtB,IAE6B,cAArB85C,EAAWj7C,MACX8pB,EAAejgB,oBAAoBT,EAAK5I,IAGxCspB,EAAezgB,mBAAmBD,EAAK5I,UAGrCspB,EAAepgB,eACrB1H,OAAOI,QAAQ,QAAQk5C,KACvBJ,EAAal7C,MAAQ,IACzB,CACA,MAAO7B,GACHN,QAAQM,MAAM,2BAA4BA,GAC1C6D,OAAO7D,MAAM,SACjB,CACJ,CACA,MAAO,CAAC69B,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,SAAU,CAC1B9C,MAAO,YACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAYJ,EAAK8a,MAAM,WAC5D,KACH7a,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAE9C,MAAO,eAAiB,MAAO,KACrF,wBAAoB,YACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,SAAU,CAC1BA,OAAO,oBAAgB,CAAC,UAAW,CAAE+C,OAA6B,cAArB+e,EAAWj7C,SACxDm8B,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAY6e,EAAWj7C,MAAQ,cACpE,SAAU,IACb,wBAAoB,SAAU,CAC1Bm5B,OAAO,oBAAgB,CAAC,UAAW,CAAE+C,OAA6B,aAArB+e,EAAWj7C,SACxDm8B,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAY6e,EAAWj7C,MAAQ,aACpE,SAAU,MAEjB,wBAAoB,YACE,cAArBi7C,EAAWj7C,QACL,kBAAc,wBAAoB,MAAO,GAAY,CACQ,KAA3D,WAAO8pB,GAAgB9gB,mBAAmBC,MAAMnK,SAC1C,kBAAc,wBAAoB,MAAO,GAAY,IAAKm9B,EAAO,KAAOA,EAAO,GAAK,EAC/E,wBAAoB,IAAK,KAAM,SAAU,UAE9C,kBAAc,wBAAoB,MAAO,GAAY,GACnD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,iBAAY,WAAOnS,GAAgB9gB,mBAAmBC,MAAQG,KAC1G,kBAAc,wBAAoB,MAAO,CAC7CwV,IAAKxV,EAAK5I,GACV24B,MAAO,YACPgD,QAAUC,GAAY+e,EAAW/xC,IAClC,EACC,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,OAAQ,IAAY,qBAAiBA,EAAKjI,MAAO,GACpEiI,EAAS,OACH,kBAAc,wBAAoB,OAAQ,IAAY,qBAAiBA,EAAKxK,MAAO,KACpF,wBAAoB,QAAQ,MAEtC,wBAAoB,IAAK,IAAa,qBAAiBwK,EAAKtB,aAAc,GACzEsB,EAAa,WACP,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,OAAQ,GAAa,QAAS,qBAAiBA,EAAKmyC,UAAW,OAErF,wBAAoB,QAAQ,IACnC,EAAe,MAClB,aAGd,wBAAoB,QAAQ,IAClC,wBAAoB,UACE,aAArBN,EAAWj7C,QACL,kBAAc,wBAAoB,MAAO,GAAa,CACM,KAA1D,WAAO8pB,GAAgB5gB,kBAAkBD,MAAMnK,SACzC,kBAAc,wBAAoB,MAAO,GAAa,IAAKm9B,EAAO,KAAOA,EAAO,GAAK,EAChF,wBAAoB,IAAK,KAAM,SAAU,UAE9C,kBAAc,wBAAoB,MAAO,GAAa,GACpD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,iBAAY,WAAOnS,GAAgB5gB,kBAAkBD,MAAQG,KACzG,kBAAc,wBAAoB,MAAO,CAC7CwV,IAAKxV,EAAK5I,GACV24B,MAAO,YACPgD,QAAUC,GAAY+e,EAAW/xC,IAClC,EACC,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,OAAQ,IAAa,qBAAiBA,EAAKjI,MAAO,GACrEiI,EAAS,OACH,kBAAc,wBAAoB,OAAQ,IAAa,qBAAiBA,EAAKxK,MAAO,KACrF,wBAAoB,QAAQ,MAEtC,wBAAoB,IAAK,IAAa,qBAAiBwK,EAAKtB,aAAc,GACzEsB,EAAa,WACP,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,OAAQ,GAAa,QAAS,qBAAiBA,EAAKmyC,UAAW,OAErF,wBAAoB,QAAQ,IACnC,EAAe,MAClB,aAGd,wBAAoB,QAAQ,IAClC,wBAAoB,aACnBL,EAAkB,QACZ,kBAAc,wBAAoB,MAAO,CACxCt8B,IAAK,EACLua,MAAO,sBACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAY8e,EAAal7C,MAAQ,OACtE,EACC,wBAAoB,MAAO,CACvBm5B,MAAO,oBACPgD,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,wBAAoB,KAAM,MAAM,qBAAiBif,EAAal7C,MAAMmB,MAAO,GAC1E+5C,EAAal7C,MAAU,OACjB,kBAAc,wBAAoB,IAAK,GAAa,QAAS,qBAAiBk7C,EAAal7C,MAAMpB,MAAO,KACzG,wBAAoB,QAAQ,IAClC,wBAAoB,IAAK,IAAa,qBAAiBs8C,EAAal7C,MAAM8H,aAAc,GACvFozC,EAAal7C,MAAc,WACrB,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,IAAK,KAAM,QAAS,qBAAiBk7C,EAAal7C,MAAMu7C,UAAW,GACtFL,EAAal7C,MAAgB,aACvB,kBAAc,wBAAoB,IAAK,GAAa,UAAW,qBAAiB,IAAIuO,KAAK2sC,EAAal7C,MAAM26C,YAAYa,kBAAmB,KAC5I,wBAAoB,QAAQ,OAEpC,wBAAoB,QAAQ,IAClC,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,SAAU,CAC1BriB,MAAO,qBACPgD,QAASif,GACV,OACH,wBAAoB,SAAU,CAC1BjiB,MAAO,yBACPgD,QAASkf,GACV,OACH,wBAAoB,SAAU,CAC1BliB,MAAO,8BACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAY8e,EAAal7C,MAAQ,OACtE,cAIb,wBAAoB,QAAQ,KAG9C,IC3OJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAEm5B,MAAO,eACtB,GAAa,CACfva,IAAK,EACLua,MAAO,WAEL,GAAa,CACfva,IAAK,EACLua,MAAO,mBAEL,GAAa,CAAEA,MAAO,kBACtB,GAAa,CAAEA,MAAO,kBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,kBAEL,GAAa,CAAEA,MAAO,cACtB,GAAa,CAAC,WACd,GAAa,CAAEA,MAAO,eACtB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,aAEL,GAAc,CAAEA,MAAO,oBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,gBAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,YAKX,IAA6B,qBAAiB,CAC1C2B,OAAQ,mBACR1N,MAAO,CACH/mB,KAAM,CAAC,EACPoN,YAAa,CAAE7U,KAAM+M,UAEzBovB,MAAO,CAAC,QAAS,eAAgB,oBACjC,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAM/N,EAAQ6N,EAERC,EAAOC,EAEPrR,GAAiB,KAAA/gB,qBACjBmsC,GAAU,IAAAz1C,MAAI,GACdiJ,GAAU,IAAAjJ,KAAI,MACdy7C,GAAe,IAAAz7C,KAAI,MAsCzBsB,eAAe06C,IACX,IAAKP,EAAal7C,QAAU0I,EAAQ1I,MAChC,OACJ,MAAMoJ,EAAO8xC,EAAal7C,MAC1B,IAEIoJ,EAAKuxC,WAAapsC,KAAKC,MACvBpF,EAAKmyC,SAAWnuB,EAAM/mB,KAAKlF,KAEvBisB,EAAM3Z,YACNqW,EAAe3gB,eAAeC,GAG9B0gB,EAAelgB,cAAcR,GAGjC,MAAMG,EAAQb,EAAQ1I,MAAMiJ,MAAMO,UAAUpC,GAAKA,EAAE5G,KAAO4I,EAAK5I,KAChD,IAAX+I,GACAb,EAAQ1I,MAAMiJ,MAAMQ,OAAOF,EAAO,SAGhCugB,EAAepgB,eAErBwxB,EAAK,eAAgB9xB,EAAK5I,IAC1BwB,OAAOI,QAAQ,QAAQgH,EAAKjI,QAC5B+5C,EAAal7C,MAAQ,IACzB,CACA,MAAO7B,GACHN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,SACjB,CACJ,CAKA,OAHA,IAAA49B,WAAU,MAlEVh7B,iBAEI,GAAIqsB,EAAM/mB,KAAKqC,QACXA,EAAQ1I,MAAQotB,EAAM/mB,KAAKqC,YAD/B,CAKAwsC,EAAQl1C,OAAQ,EAChB,IACI,MAAM,mBAAEsI,SAA6B,sCAC/BozC,QAAkBpzC,EAAmBK,gBAAgBykB,EAAM/mB,KAAM+mB,EAAM3Z,aAC7E/K,EAAQ1I,MAAQ07C,EAEhBxgB,EAAK,mBAAoBwgB,EAC7B,CACA,MAAOv9C,GACHN,QAAQM,MAAM,+BAAgCA,GAC9C6D,OAAO7D,MAAM,WACjB,CACA,QACI+2C,EAAQl1C,OAAQ,CACpB,CAhBA,CAiBJ,CA6CI27C,KAEG,CAAC3f,EAAMC,MACF,kBAAc,wBAAoB,MAAO,CAC7C9C,MAAO,6BACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAYJ,EAAK8a,MAAM,WAC5D,EACC,wBAAoB,MAAO,CACvB3d,MAAO,qBACPgD,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,wBAAoB,SAAU,CAC1B9C,MAAO,YACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAYJ,EAAK8a,MAAM,WAC5D,MACH,wBAAoB,KAAM,IAAY,qBAAiB7b,EAAQ50B,KAAKlF,MAAO,GAC1E+zC,EAAa,QACP,kBAAc,wBAAoB,MAAO,GAAY,IAAKjZ,EAAO,KAAOA,EAAO,GAAK,EAC/E,wBAAoB,IAAK,KAAM,iBAAkB,QAEtDvzB,EAAa,QACT,kBAAc,wBAAoB,MAAO,GAAY,EACpD,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,CACnCuzB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,MAAO,KACjE,wBAAoB,IAAK,MAAM,qBAAiBvzB,EAAQ1I,MAAMmU,aAAc,MAEhF,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,CACnC8nB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,MAAO,KACjE,wBAAoB,IAAK,MAAM,qBAAiBvzB,EAAQ1I,MAAMoU,YAAa,MAE/E,wBAAoB,WACnB1L,EAAQ1I,MAAMiJ,OAASP,EAAQ1I,MAAMiJ,MAAMnK,OAAS,IAC9C,kBAAc,wBAAoB,MAAO,GAAY,CACpDm9B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,SAAU,KACpE,wBAAoB,MAAO,GAAY,GAClC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYvzB,EAAQ1I,MAAMiJ,MAAQG,KAC9E,kBAAc,wBAAoB,MAAO,CAC7CwV,IAAKxV,EAAK5I,GACV24B,OAAO,oBAAgB,CAAC,YAAa,CAAEyiB,SAAUV,EAAal7C,OAAOQ,KAAO4I,EAAK5I,MACjF27B,QAAUC,GAlFtD,SAAoBhzB,GAChB8xC,EAAal7C,MAAQoJ,EACrBvL,QAAQC,IAAI,4BAA4BsL,EAAKjI,OACjD,CA+EiE,CAAYiI,IAClC,EACC,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,OAAQ,IAAa,qBAAiBA,EAAKjI,MAAO,GACrEiI,EAAS,OACH,kBAAc,wBAAoB,OAAQ,IAAa,qBAAiBA,EAAKxK,MAAO,KACrF,wBAAoB,QAAQ,MAEtC,wBAAoB,IAAK,IAAa,qBAAiBwK,EAAKtB,aAAc,IAC3E,GAAuB,MAC1B,SAER,wBAAoB,aACnBozC,EAAkB,QACZ,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,SAAU,CAC1B/hB,MAAO,wBACPgD,QAASsf,GACV,OACH,wBAAoB,SAAU,CAC1BtiB,MAAO,6BACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAY8e,EAAal7C,MAAQ,OACtE,UAEL,wBAAoB,QAAQ,QAEnC,kBAAc,wBAAoB,MAAO,GAAa,IAAKi8B,EAAO,KAAOA,EAAO,GAAK,EAChF,wBAAoB,IAAK,KAAM,cAAe,YAG5D,wBAAoB,QAAQ,OAItD,IC/LJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAE9C,MAAO,aACtB,GAAa,CAAEA,MAAO,cACtB,GAAa,CAAEA,MAAO,YACtB,GAAa,CACfva,IAAK,EACLua,MAAO,iBAEL,GAAa,CAAEva,IAAK,GACpB,GAAa,CACfA,IAAK,EACLua,MAAO,UAEL,GAAa,CAAEva,IAAK,GACpB,GAAa,CACfA,IAAK,EACLua,MAAO,gBAEL,GAAa,CAAEA,MAAO,qBACtB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,oBAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,mBAEL,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAC,WACf,GAAc,CAAEA,MAAO,aACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,oBAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,kBAEL,GAAc,CAAEva,IAAK,GACrB,GAAc,CAChBA,IAAK,EACLua,MAAO,UAEL,GAAc,CAAEva,IAAK,GACrB,GAAc,CAChBA,IAAK,EACLua,MAAO,gBAEL,GAAc,CAAEA,MAAO,qBACvB,GAAc,CAAEA,MAAO,aACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,oBAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,mBAEL,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAC,WACf,GAAc,CAAEA,MAAO,aACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,oBAEL,GAAc,CAChBva,IAAK,EACLua,MAAO,kBAQX,IAA6B,qBAAiB,CAC1C2B,OAAQ,WACRC,MAAO,CAAC,SACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMD,EAAOC,EACPxe,GAAgB,KAAA3Q,oBAChBkF,GAAiB,SACjB4Y,GAAiB,KAAA/gB,qBACjB8yC,GAAW,IAAAp8C,MAAI,GACfw7C,GAAa,IAAAx7C,KAAI,aACjBq8C,GAAe,IAAAr8C,KAAI,MACnBs8C,GAAwB,IAAAt8C,KAAI,MAC5Bu8C,GAAuB,IAAAv8C,KAAI,MAC3Bw8C,GAAkB,IAAAx8C,MAAI,GACtBy8C,GAAa,IAAAz8C,KAAI,MACjB08C,GAAqB,IAAA18C,MAAI,GAEzB28C,GAAuB,IAAAr8C,UAAS,KAClC,IAAK+7C,EAAa97C,MACd,OAAO,KACX,MAAMiG,EAAiB61C,EAAa97C,MAAMiG,eAC1C,OAAO61C,EAAa97C,MAAM+F,MAAMtF,IAAIwF,IAAmB,OAGrDo2C,GAA0B,IAAAt8C,UAAS,IAChCq8C,EAAqBp8C,MAEnBo8C,EAAqBp8C,MAAM+H,eAC7BxJ,IAAIqI,GAAUk1C,EAAa97C,OAAO+F,MAAMtF,IAAImG,IAC5ClG,OAAQ2F,QAAkB3G,IAAT2G,GAHX,IAMftF,eAAeu7C,IACX,IACI,MAAM,oBAAE93C,SAA8B,qCACtCs3C,EAAa97C,YAAcwE,EAAoBgC,UAC/C3I,QAAQC,IAAI,yBAA0Bg+C,EAAa97C,MAAQ,KAAO,MACtE,CACA,MAAO7B,GACHN,QAAQM,MAAM,yBAA0BA,EAC5C,CACJ,CAEA4C,eAAew7C,IACX,GAAKrrC,EAAe1R,OAIpB,IACIwC,OAAOoB,KAAK,iBACZ,MAAM,oBAAEoB,SAA8B,qCACtCs3C,EAAa97C,YAAcwE,EAAoBC,YAAYyM,EAAe1R,QAC1EwC,OAAOI,QAAQ,cACnB,CACA,MAAOjE,GACHN,QAAQM,MAAM,yBAA0BA,GACxC6D,OAAO7D,MAAM,aACjB,MAZI6D,OAAO7D,MAAM,WAarB,CAsBA4C,eAAey7C,IACX,IAAKT,EAAsB/7C,OAAS67C,EAAS77C,MACzC,OACJ,MAAMy8C,EAAaV,EAAsB/7C,MACzC,IACI67C,EAAS77C,OAAQ,EAEjB,MAAM,oBAAEwE,SAA8B,2CAChCA,EAAoBmC,qBAAqB81C,EAAWj8C,UAEpD87C,IAENP,EAAsB/7C,MAAQ,KAC9BgC,OAAOI,QAAQ,SAASq6C,EAAWt7C,QACnCtD,QAAQC,IAAI,2BAA2B2+C,EAAWt7C,OACtD,CACA,MAAOhD,GACHN,QAAQM,MAAM,oBAAqBA,GACnC6D,OAAO7D,MAAM,OACjB,CACA,QACI09C,EAAS77C,OAAQ,CACrB,CACJ,CAEAe,eAAe27C,IACX,GAAIb,EAAS77C,MACT,OACJ,MAAMyR,EAAaP,EAAe1R,QAAQ2B,MAAQ,KAC5Cw7C,EAAkBP,EAAqBp8C,OAAOmB,MAAQ,OAC5D,IACI06C,EAAS77C,OAAQ,EAEjB,MAAMsF,EAAU,GAAGmM,KAAckrC,IACjC9+C,QAAQC,IAAI,uBAAuBwH,WAE7BH,SAAS,CAAEC,WAAYE,IAC7BtD,OAAOI,QAAQ,WAEf84B,EAAK,QACT,CACA,MAAO/8B,GACHN,QAAQM,MAAM,sBAAuBA,GACrC6D,OAAO7D,MAAM,SACjB,CACA,QACI09C,EAAS77C,OAAQ,CACrB,CACJ,CAEAe,eAAe67C,IACX,IAAKZ,EAAqBh8C,OAAS67C,EAAS77C,MACxC,OACJ,MAAMy8C,EAAaT,EAAqBh8C,MACxC,IACI67C,EAAS77C,OAAQ,QAEX2c,EAAchW,qBAAqB81C,EAAWj8C,IAC/Ci8C,EAAW31C,oBACN6V,EAAc/O,aAAa6uC,EAAWj8C,IAGhDw7C,EAAqBh8C,MAAQ,KAC7BgC,OAAOI,QAAQ,SAASq6C,EAAWt7C,QACnCtD,QAAQC,IAAI,yBAAyB2+C,EAAWt7C,OACpD,CACA,MAAOhD,GACHN,QAAQM,MAAM,oBAAqBA,GACnC6D,OAAO7D,MAAM,OACjB,CACA,QACI09C,EAAS77C,OAAQ,CACrB,CACJ,CAEAe,eAAe87C,IACX,GAAIhB,EAAS77C,MACT,OACJ,MAAMyR,EAAaP,EAAe1R,QAAQ2B,MAAQ,KAC5Cw7C,EAAkBhgC,EAAcrQ,aAAanL,MAAQ,OAC3D,IACI06C,EAAS77C,OAAQ,EAEjB,MAAMsF,EAAU,GAAGmM,KAAckrC,IACjC9+C,QAAQC,IAAI,uBAAuBwH,WAE7BH,SAAS,CAAEC,WAAYE,IAC7BtD,OAAOI,QAAQ,WAEf84B,EAAK,QACT,CACA,MAAO/8B,GACHN,QAAQM,MAAM,sBAAuBA,GACrC6D,OAAO7D,MAAM,SACjB,CACA,QACI09C,EAAS77C,OAAQ,CACrB,CACJ,CAEA,SAAS88C,IACAV,EAAqBp8C,OAE1B+8C,EAAgBX,EAAqBp8C,OAAO,EAChD,CAEA,SAASg9C,IACArgC,EAAcrQ,aAEnBywC,EAAgBpgC,EAAcrQ,aAAa,EAC/C,CAEA,SAASywC,EAAgB12C,EAAMoN,GAC3ByoC,EAAWl8C,MAAQqG,EACnB81C,EAAmBn8C,MAAQyT,EAC3BwoC,EAAgBj8C,OAAQ,CAC5B,CAEA,SAASi9C,IACLhB,EAAgBj8C,OAAQ,EACxBk8C,EAAWl8C,MAAQ,IACvB,CAEAe,eAAem8C,EAAuBx0C,GAClC,GAAKwzC,EAAWl8C,MAEhB,IAII,GAFAk8C,EAAWl8C,MAAM0I,QAAUA,EAEvByzC,EAAmBn8C,MAAO,CAC1B,MAAM,oBAAEwE,SAA8B,qCAClCs3C,EAAa97C,aACPwE,EAAoBoB,QAAQk2C,EAAa97C,MAEvD,YAEU2c,EAAcpQ,YAExB1O,QAAQC,IAAI,uBAChB,CACA,MAAOK,GACHN,QAAQM,MAAM,yBAA0BA,EAC5C,CACJ,CAEA4C,eAAeo8C,IACX,IAEI,GAAIhB,EAAmBn8C,MAAO,CAC1B,MAAM,oBAAEwE,SAA8B,qCAClCs3C,EAAa97C,aACPwE,EAAoBoB,QAAQk2C,EAAa97C,MAEvD,YAEU2c,EAAcpQ,YAExB1O,QAAQC,IAAI,qBAChB,CACA,MAAOK,GACHN,QAAQM,MAAM,uBAAwBA,EAC1C,CACJ,CAWA,OAVA,IAAA49B,WAAUh7B,UACN,UACUu7C,UACAxyB,EAAetf,gBACzB,CACA,MAAOrM,GACHN,QAAQM,MAAM,oBAAqBA,EAEvC,IAEG,CAAC69B,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,MAAO,GAAY,CACnCA,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,MAAO,KACjE,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,SAAU,CAC1B9C,OAAO,oBAAgB,CAAC,UAAW,CAAE+C,OAA6B,cAArB+e,EAAWj7C,SACxDm8B,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAY6e,EAAWj7C,MAAQ,cACpE,SAAU,IACZ,WAAO2c,GAA8B,kBAC/B,kBAAc,wBAAoB,SAAU,CAC3CiC,IAAK,EACLua,OAAO,oBAAgB,CAAC,UAAW,CAAE+C,OAA6B,aAArB+e,EAAWj7C,SACxDm8B,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAY6e,EAAWj7C,MAAQ,aACpE,SAAU,KACX,wBAAoB,QAAQ,KAEhB,aAArBi7C,EAAWj7C,QAAwB,WAAO2c,GAAexQ,kBACnD,kBAAc,wBAAoB,MAAO,IAAY,sBAAiB,WAAOwQ,GAAexQ,gBAAgBhL,MAAO,KACpH,wBAAoB,QAAQ,MAEtC,wBAAoB,YACE,cAArB85C,EAAWj7C,QACL,kBAAc,wBAAoB,MAAO,GAAY,CAClD87C,EAAa97C,QAQR,kBAAc,wBAAoB,MAAO,GAAY,CACnDo8C,EAA0B,QACpB,kBAAc,wBAAoB,MAAO,GAAY,CACpDngB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,QAAS,KACnE,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,IAAa,qBAAiBmgB,EAAqBp8C,MAAMmB,MAAO,GAC1Fi7C,EAAqBp8C,MAAiB,cAChC,kBAAc,wBAAoB,MAAO,IAAa,qBAAiBo8C,EAAqBp8C,MAAM8H,aAAc,KACjH,wBAAoB,QAAQ,IAClC,wBAAoB,SAAU,CAC1BqxB,MAAO,mBACPgD,QAAS2gB,GACV,cAGT,wBAAoB,QAAQ,GACjCT,EAAwBr8C,MAAMlB,OAAS,IACjC,kBAAc,wBAAoB,MAAO,GAAa,CACrDm9B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,UAAW,KACrE,wBAAoB,MAAO,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYogB,EAAwBr8C,MAAQqG,KACxF,kBAAc,wBAAoB,MAAO,CAC7CuY,IAAKvY,EAAK7F,GACV24B,OAAO,oBAAgB,CAAC,YAAa,CAAEikB,WAAY/2C,EAAKS,aAAc80C,SAAUG,EAAsB/7C,OAAOQ,KAAO6F,EAAK7F,MACzH27B,QAAUC,GA1PtD,SAA6B/1B,GACrBA,EAAK7F,KAAO47C,EAAqBp8C,OAAOQ,IAI5Cu7C,EAAsB/7C,MAAQqG,EAC9B21C,EAAqBh8C,MAAQ,KAC7BnC,QAAQC,IAAI,yBAAyBuI,EAAKlF,SALtCa,OAAOoB,KAAK,YAMpB,CAkPiE,CAAqBiD,IAC3C,EACC,wBAAoB,MAAO,IAAa,qBAAiBA,EAAKS,aAAeT,EAAKlF,KAAO,OAAQ,GAChGkF,EAAKS,cAAgBT,EAAKyB,cACpB,kBAAc,wBAAoB,MAAO,IAAa,qBAAiBzB,EAAKyB,aAAc,KAC3F,wBAAoB,QAAQ,IACnC,GAAuB,MAC1B,SAER,wBAAoB,aACnBi0C,EAA2B,QACrB,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,SAAU,CAC1B5iB,MAAO,sBACPgD,QAASqgB,GACV,OACH,wBAAoB,SAAU,CAC1BrjB,MAAO,yBACPgD,QAASugB,GACV,UAEL,wBAAoB,QAAQ,OAEpC,wBAAoB,QAAQ,QAtDnC,kBAAc,wBAAoB,MAAO,GAAY,CACpDzgB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,IAAK,KAAM,cAAe,KACxE,wBAAoB,SAAU,CAC1B9C,MAAO,eACPgD,QAASogB,GACV,eAoDb,wBAAoB,QAAQ,IAClC,wBAAoB,UACE,aAArBtB,EAAWj7C,QACL,kBAAc,wBAAoB,MAAO,GAAa,EACnD,WAAO2c,GAAexQ,kBAIjB,kBAAc,wBAAoB,MAAO,GAAa,EACpD,WAAOwQ,GAA0B,cAC3B,kBAAc,wBAAoB,MAAO,GAAa,CACrDsf,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,QAAS,KACnE,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,MAAO,IAAa,sBAAiB,WAAOtf,GAAerQ,YAAYnL,MAAO,IACjG,WAAOwb,GAAerQ,YAAuB,cACvC,kBAAc,wBAAoB,MAAO,IAAa,sBAAiB,WAAOqQ,GAAerQ,YAAYxE,aAAc,KACxH,wBAAoB,QAAQ,IAClC,wBAAoB,SAAU,CAC1BqxB,MAAO,mBACPgD,QAAS6gB,GACV,cAGT,wBAAoB,QAAQ,IACjC,WAAOrgC,GAAe5U,eAAejJ,OAAS,IACxC,kBAAc,wBAAoB,MAAO,GAAa,CACrDm9B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,UAAW,KACrE,wBAAoB,MAAO,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,iBAAY,WAAOtf,GAAe5U,eAAiB1B,KAC/F,kBAAc,wBAAoB,MAAO,CAC7CuY,IAAKvY,EAAK7F,GACV24B,OAAO,oBAAgB,CAAC,YAAa,CAAEikB,WAAY/2C,EAAKS,aAAc80C,SAAUI,EAAqBh8C,OAAOQ,KAAO6F,EAAK7F,MACxH27B,QAAUC,GA1StD,SAA4B/1B,GACpBA,EAAK7F,KAAOmc,EAAcrQ,aAAa9L,IAI3Cw7C,EAAqBh8C,MAAQqG,EAC7B01C,EAAsB/7C,MAAQ,KAC9BnC,QAAQC,IAAI,uBAAuBuI,EAAKlF,SALpCa,OAAOoB,KAAK,YAMpB,CAkSiE,CAAoBiD,IAC1C,EACC,wBAAoB,MAAO,IAAa,qBAAiBA,EAAKS,aAAeT,EAAKlF,KAAO,OAAQ,GAChGkF,EAAKS,cAAgBT,EAAKyB,cACpB,kBAAc,wBAAoB,MAAO,IAAa,qBAAiBzB,EAAKyB,aAAc,KAC3F,wBAAoB,QAAQ,IACnC,GAAuB,MAC1B,SAER,wBAAoB,aACnBk0C,EAA0B,QACpB,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,SAAU,CAC1B7iB,MAAO,sBACPgD,QAASygB,GACV,OACH,wBAAoB,SAAU,CAC1BzjB,MAAO,yBACPgD,QAAS0gB,GACV,UAEL,wBAAoB,QAAQ,OAEpC,wBAAoB,QAAQ,QAlDnC,kBAAc,wBAAoB,MAAO,GAAa,IAAK5gB,EAAO,KAAOA,EAAO,GAAK,EAChF,wBAAoB,IAAK,KAAM,aAAc,YAoD3D,wBAAoB,QAAQ,IAClC,wBAAoB,aACnBggB,EAAgBj8C,OAASk8C,EAAWl8C,QAC9B,kBAAc,iBAAaq9C,GAAkB,CAC5Cz+B,IAAK,EACLvY,KAAM61C,EAAWl8C,MACjB,gBAAiBm8C,EAAmBn8C,MACpC66C,QAASoC,EACTK,eAAgBH,EAChBI,mBAAoBL,GACrB,KAAM,EAAe,CAAC,OAAQ,oBAC/B,wBAAoB,QAAQ,KAG9C,IC7dJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qB,uBCkVhE,MAAMM,GAAiB,IA5T9B,MACUhgD,aAAc,EAKtB,gBAAMG,GACJ,GAAIC,KAAKJ,YAEP,YADAK,QAAQC,IAAI,4BAIdD,QAAQC,IAAI,oCAGUF,KAAK6/C,wBAEnB7/C,KAAK8/C,gBAAgB,IAG7B9/C,KAAKJ,aAAc,EACnBK,QAAQC,IAAI,4BACd,CASA,0BAAM6/C,CAAqBC,EAAkBC,EAAoBC,GAG/D,aAAapqC,eAAe,YAAa3S,UACvC,IACElD,QAAQC,IAAI,uBAAuB+/C,eAGnC,MAAMv5C,QAAe1G,KAAKmgD,kBAAkBH,EAAUE,GAGhDpyB,QAAiB9tB,KAAKogD,oBAAoBJ,EAAUE,GAKpD7I,EAAqB,CACzBrhC,gBAAiB,CAAC,CAAEC,KAAM,OAAQC,QAHrBlW,KAAKqgD,mBAAmBJ,EAAYv5C,EAAQonB,EAAUoyB,MAOrEjgD,QAAQC,IAAI,iCAGZ,MAAMogD,QAAuBvqC,YAAYshC,GAGzC,OADAp3C,QAAQC,IAAI,kCAAkCogD,EAAep/C,UACtDo/C,CACT,CAAE,MAAO//C,GAEP,MADAN,QAAQM,MAAM,8BAA+BA,GACvCA,CACR,GAEJ,CAKQ,kBAAA8/C,CACNJ,EACAv5C,EACAonB,EACAyyB,GAEA,IAAIz5C,EAAS,MAAMm5C,yBAiCnB,OA/BAn5C,GAAU,cACVA,GAAU,2CACVA,GAAU,uCACVA,GAAU,8BACVA,GAAU,8BACVA,GAAU,2BAGNJ,EAAOxF,OAAS,IAClB4F,GAAU,iBACVJ,EAAO0jB,MAAM,EAAG,GAAGlmB,QAAQ,CAACuC,EAAOkF,KACjC7E,GAAU,GAAG6E,EAAQ,MAAMlF,EAAMqK,cAEnChK,GAAU,MAIRgnB,EAAS5sB,OAAS,IACpB4F,GAAU,eACVgnB,EAAS1D,MAAM,EAAG,GAAGlmB,QAAQ,CAACoqB,EAAQ3iB,KACpC7E,GAAU,GAAG6E,EAAQ,MAAM2iB,EAAOpkB,kBAEpCpD,GAAU,MAGU,IAAlBJ,EAAOxF,QAAoC,IAApB4sB,EAAS5sB,SAClC4F,GAAU,oCAGZA,GAAU,SAASm5C,mBAEZn5C,CACT,CAQA,uBAAMq5C,CAAkBH,EAAkBE,GACxC,IACE,MACMM,GADgB,KAAApyC,oBACamB,kBAEnC,GAAI2wC,EAAmB,CAErB,MAAMO,EAA8B,GACpC,IAAK,MAAM5xC,KAAY2xC,EACjB3xC,EAASnI,QAAUmI,EAASnI,OAAOxF,OAAS,GAC9Cu/C,EAAU16C,QAAQ8I,EAASnI,QAI/B,OAAO+5C,EAAUl2B,KAAK,CAAC1gB,EAAGwkB,IAAMA,EAAE1U,UAAY9P,EAAE8P,UAClD,CAAO,CAEL,MAAM+mC,EAAeF,EAAa19C,OAAO+L,GACvCA,EAASjL,WAAWgG,KAAK+2C,GAAQA,EAAKj7C,cAAgBs6C,IAGlDY,EAA8B,GACpC,IAAK,MAAM/xC,KAAY6xC,EACrB,GAAI7xC,EAASnI,QAAUmI,EAASnI,OAAOxF,OAAS,EAAG,CAEjD,MAAM2/C,EAAiBhyC,EAASnI,OAAO5D,OACrC2D,GAASA,EAAMoT,oBAAsBpT,EAAMoT,mBAAmB/T,SAASk6C,IAEzEY,EAAU76C,QAAQ86C,EACpB,CAIF,OAAOD,EAAUr2B,KAAK,CAAC1gB,EAAGwkB,IAAMA,EAAE1U,UAAY9P,EAAE8P,UAClD,CACF,CAAE,MAAOpZ,GAEP,OADAN,QAAQM,MAAM,8BAA+BA,GACtC,EACT,CACF,CAQA,yBAAM6/C,CAAoBJ,EAAkBE,GAC1C,IACE,GAAIA,EAAmB,CAErB,MAAMY,QAAoBp0B,EAAA,EAAsBE,iBAC1Cm0B,EAA6B,GAEnC,IAAK,MAAMpzB,KAAWmzB,EAChBnzB,EAAQG,UAAYH,EAAQG,SAAS5sB,OAAS,GAChD6/C,EAAYh7C,QAAQ4nB,EAAQG,UAKhC,OAAOizB,EAAYx2B,KAAK,CAAC1gB,EAAGwkB,IAAMA,EAAE1U,UAAY9P,EAAE8P,UACpD,CAAO,CAEL,MAAMgU,QAAgBjB,EAAA,EAAsBuB,WAAW+xB,GACvD,OAAIryB,GAAWA,EAAQG,SAEd,IAAIH,EAAQG,UAAUvD,KAAK,CAAC1gB,EAAGwkB,IAAMA,EAAE1U,UAAY9P,EAAE8P,WAEvD,EACT,CACF,CAAE,MAAOpZ,GAEP,OADAN,QAAQM,MAAM,8BAA+BA,GACtC,EACT,CACF,CAMA,iBAAMygD,CAAYpgD,GAChB,IACE,MAAMqD,QAAgBjE,KAAK6/C,iBAC3B57C,EAAQ8B,KAAKnF,SACPZ,KAAK8/C,gBAAgB77C,GAC3BhE,QAAQC,IAAI,4BAA4BU,EAAMq/C,gBAAgBr/C,EAAMgC,MACpEwB,OAAOI,QAAQ,QACjB,CAAE,MAAOjE,GAGP,MAFAN,QAAQM,MAAM,4BAA6BA,GAC3C6D,OAAO7D,MAAM,UACPA,CACR,CACF,CAOA,mBAAM0gD,CAAcC,EAAmBhrC,GACrC,IACE,MAAMjS,QAAgBjE,KAAK6/C,iBACrBj/C,EAAQqD,EAAQ0I,KAAK3C,GAAKA,EAAEpH,KAAOs+C,GAEzC,IAAKtgD,EACH,MAAM,IAAI+D,MAAM,UAAUu8C,KAG5BtgD,EAAMsV,QAAUA,EAChBtV,EAAMugD,SAAWxwC,KAAKC,YAEhB5Q,KAAK8/C,gBAAgB77C,GAC3BhE,QAAQC,IAAI,4BAA4BghD,KACxC98C,OAAOI,QAAQ,QACjB,CAAE,MAAOjE,GAGP,MAFAN,QAAQM,MAAM,4BAA6BA,GAC3C6D,OAAO7D,MAAM,UACPA,CACR,CACF,CAMA,mBAAM6gD,CAAcF,GAClB,IACE,MAAMj9C,QAAgBjE,KAAK6/C,iBACrBwB,EAAkBp9C,EAAQnB,OAAOkH,GAAKA,EAAEpH,KAAOs+C,GAErD,GAAIG,EAAgBngD,SAAW+C,EAAQ/C,OACrC,MAAM,IAAIyD,MAAM,UAAUu8C,WAGtBlhD,KAAK8/C,gBAAgBuB,GAC3BphD,QAAQC,IAAI,4BAA4BghD,KACxC98C,OAAOI,QAAQ,QACjB,CAAE,MAAOjE,GAGP,MAFAN,QAAQM,MAAM,4BAA6BA,GAC3C6D,OAAO7D,MAAM,UACPA,CACR,CACF,CAOA,yBAAM+gD,CAAoBtB,GACxB,IAEE,aADsBhgD,KAAK6/C,kBACZ/8C,OAAOkH,GAAKA,EAAEg2C,WAAaA,GAAUz1B,KAAK,CAAC1gB,EAAGwkB,IAAMA,EAAEkzB,UAAY13C,EAAE03C,UACrF,CAAE,MAAOhhD,GAEP,OADAN,QAAQM,MAAM,8BAA+BA,GACtC,EACT,CACF,CAMA,oBAAMs/C,GACJ,IACE,MAAM2B,EAAUn+C,aAAa,CAAErC,KAAM,WAErC,OADawgD,EAAQC,iBACN,EACjB,CAAE,MAAOlhD,GAEP,OADAN,QAAQM,MAAM,8BAA+BA,GACtC,EACT,CACF,CAMQ,qBAAMu/C,CAAgB77C,GAC5B,IAEE,MAAMy9C,GAAe,KAAA5yC,OAAM7K,SACrBJ,wBAAwB,CAAE49C,gBAAiBC,GAAgB,CAAE1gD,KAAM,UAC3E,CAAE,MAAOT,GAEP,MADAN,QAAQM,MAAM,8BAA+BA,GACvCA,CACR,CACF,CAKA,UAAAipB,GACE,MAAO,WAAW7Y,KAAKC,SAASzK,KAAKsQ,SAASC,SAAS,IAAIC,OAAO,EAAG,IACvE,GClVI,GAAa,CAAE4kB,MAAO,gBACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CAAEA,MAAO,gBACtB,GAAa,CAAEA,MAAO,mBACtB,GAAa,CAAEkC,MAAO,QACtB,GAAa,CAAC,SACd,GAAa,CACfzc,IAAK,EACLyc,MAAO,OAEL,GAAa,CAAC,SACd,GAAa,CAAElC,MAAO,mBACtB,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,iBAEL,GAAc,CAAC,WACf,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,kBAEL,GAAc,CAAEA,MAAO,mBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,eAEL,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,kBAEL,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAC,YACf,GAAc,CAAC,YACf,GAAc,CAAEA,MAAO,eACvB,GAAc,CAAC,cAAe,YAC9B,GAAc,CAChBva,IAAK,EACLua,MAAO,gBAOX,IAA6B,qBAAiB,CAC1C2B,OAAQ,cACRC,MAAO,CAAC,SACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMD,EAAOC,EAEPjqB,GAAiB,SACjByL,GAAgB,KAAA3Q,oBAEhBuzC,GAAmB,IAAA9/C,KAAI,IACvB+/C,GAAoB,IAAA//C,KAAI,IACxBy+C,GAAiB,IAAAz+C,KAAI,IACrBggD,GAAiB,IAAAhgD,KAAI,IACrBmyC,GAAe,IAAAnyC,MAAI,GACnBigD,GAAW,IAAAjgD,MAAI,GAEfkgD,GAAkB,IAAA5/C,UAAS,IAAMmR,EAAe1R,QAChDogD,GAAkB,IAAA7/C,UAAS,IACtB,kDAEL8/C,GAAgB,IAAA9/C,UAAS,KAE3B,MAAMq+C,EAAezhC,EAAcxP,kBAC7B2yC,EAAS,IAAIlgD,IACnB,IAAK,MAAM6M,KAAY2xC,EACnB,IAAK,MAAM9wC,KAAkBb,EAASjL,WAC9B8L,EAAepL,YAAc49C,EAAOj5C,IAAIyG,EAAehK,cACvDw8C,EAAO/9C,IAAIuL,EAAehK,YAAa,CACnC9C,GAAI8M,EAAehK,YACnBnC,KAAMmM,EAAepL,UAAUf,OAK/C,OAAOjB,MAAMC,KAAK2/C,EAAO1/C,YA0B7BW,eAAeg/C,UACLC,GACV,CAIAj/C,eAAei/C,IACX,GAAKT,EAAiBv/C,MAItB,IACIy/C,EAAez/C,YAAcw9C,GAAe0B,oBAAoBK,EAAiBv/C,MACrF,CACA,MAAO7B,GACHN,QAAQM,MAAM,wBAAyBA,GACvC6D,OAAO7D,MAAM,SACjB,MATIshD,EAAez/C,MAAQ,EAU/B,CAcAe,eAAek/C,IACX,GAAKV,EAAiBv/C,MAItB,IACI4xC,EAAa5xC,OAAQ,EAErB,MAAM69C,EAAaqC,IACbpC,EAAoByB,EAAiBv/C,QAAU2/C,EAAgB3/C,OAAOQ,GAEtE85C,QAAckD,GAAeG,qBAAqB4B,EAAiBv/C,MAAO69C,EAAYC,GAC5FI,EAAel+C,MAAQs6C,EACvBt4C,OAAOI,QAAQ,UACnB,CACA,MAAOjE,GACHN,QAAQM,MAAM,0BAA2BA,GACzC6D,OAAO7D,MAAM,WACjB,CACA,QACIyzC,EAAa5xC,OAAQ,CACzB,MAnBIgC,OAAOkE,QAAQ,SAoBvB,CAIAnF,eAAe69C,IACX,GAAKW,EAAiBv/C,MAItB,GAAKk+C,EAAel+C,MAAMid,OAI1B,IAEI,GADAyiC,EAAS1/C,OAAQ,EACbw/C,EAAkBx/C,YAEZw9C,GAAeqB,cAAcW,EAAkBx/C,MAAOk+C,EAAel+C,WAE1E,CAED,MAAMmgD,EAAa,CACf3/C,GAAIg9C,GAAep2B,aACnBw2B,SAAU2B,EAAiBv/C,MAC3B69C,WAAYqC,IACZpsC,QAASoqC,EAAel+C,MACxBogD,cAAe,GACfC,gBAAiB,GACjBlB,UAAW5wC,KAAKC,aAEdgvC,GAAeoB,YAAYuB,GACjCX,EAAkBx/C,MAAQmgD,EAAW3/C,EACzC,OAEMw/C,GACV,CACA,MAAO7hD,GACHN,QAAQM,MAAM,wBAAyBA,EAC3C,CACA,QACIuhD,EAAS1/C,OAAQ,CACrB,MA/BIgC,OAAOkE,QAAQ,iBAJflE,OAAOkE,QAAQ,SAoCvB,CAIA,SAASo6C,IACAd,EAAkBx/C,OAGnB67B,QAAQ,wBAOhB96B,iBACI,IAAKy+C,EAAkBx/C,MACnB,OAEJ,UACUw9C,GAAewB,cAAcQ,EAAkBx/C,OAErDw/C,EAAkBx/C,MAAQ,GAC1Bk+C,EAAel+C,MAAQ,SAEjBggD,GACV,CACA,MAAO7hD,GACHN,QAAQM,MAAM,wBAAyBA,EAC3C,CACJ,CArBQ6gD,EAER,CAuBA,SAASuB,IACLf,EAAkBx/C,MAAQ,GAC1Bk+C,EAAel+C,MAAQ,EAC3B,CAIA,SAASkgD,IACL,GAAIX,EAAiBv/C,QAAU2/C,EAAgB3/C,OAAOQ,GAClD,OAAOm/C,EAAgB3/C,MAAMmB,KAEjC,MAAMR,EAAMk/C,EAAc7/C,MAAMuK,KAAKgkB,GAAKA,EAAE/tB,KAAO++C,EAAiBv/C,OACpE,OAAOW,GAAKQ,MAAQ,IACxB,CAIA,SAASq/C,EAAWjpC,GAChB,MAAMiiC,EAAO,IAAIjrC,KAAKgJ,GAMtB,MAAO,GALMiiC,EAAKM,iBACJv0C,OAAOi0C,EAAKiH,WAAa,GAAGC,SAAS,EAAG,QAC1Cn7C,OAAOi0C,EAAKE,WAAWgH,SAAS,EAAG,QACjCn7C,OAAOi0C,EAAKmH,YAAYD,SAAS,EAAG,QAClCn7C,OAAOi0C,EAAKoH,cAAcF,SAAS,EAAG,MAE1D,CAcA,SAASte,IACLlH,EAAK,QACT,CACA,OAhMA,IAAAa,WAAUh7B,gBACAy8C,GAAe7/C,aAEjBgiD,EAAgB3/C,QAChBu/C,EAAiBv/C,MAAQ2/C,EAAgB3/C,MAAMQ,SACzCw/C,QAMd,IAAA9hB,OAAMqhB,EAAkBx+C,gBACdi/C,IAENR,EAAkBx/C,MAAQ,GAC1Bk+C,EAAel+C,MAAQ,KAiLpB,CAACg8B,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,WACpB,wBAAoB,MAAO,CAAE9C,MAAO,gBAAkB,CAClD8C,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAE9C,MAAO,eAAiB,UAAW,KACzF,wBAAoB,SAAU,CAC1BA,MAAO,YACPgD,QAASiG,GACV,QAEP,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,cACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,YACpB,wBAAoB,MAAO,GAAY,CACnCnG,EAAO,KAAOA,EAAO,IAAK,wBAAoB,QAAS,CAAE4W,IAAK,iBAAmB,SAAU,KAC3F,qBAAgB,wBAAoB,SAAU,CAC1CryC,GAAI,gBACJ,sBAAuBy7B,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAmBp8B,MAAQo8B,GACzFE,SAAUyjB,GACX,CACC9jB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,SAAU,CAAEj8B,MAAO,IAAM,aAAc,KACrF,wBAAoB,WAAY,GAAY,CACvC2/C,EAAqB,QACf,kBAAc,wBAAoB,SAAU,CAC3C/gC,IAAK,EACL5e,MAAO2/C,EAAgB3/C,MAAMQ,KAC9B,qBAAiBm/C,EAAgB3/C,MAAMmB,MAAO,EAAqB,MACpE,wBAAoB,QAAQ,KAErC0+C,EAAc7/C,MAAMlB,OAAS,IACvB,kBAAc,wBAAoB,WAAY,GAAY,GACxD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY+gD,EAAc7/C,MAAQW,KAC9E,kBAAc,wBAAoB,SAAU,CAChDie,IAAKje,EAAIH,GACTR,MAAOW,EAAIH,KACZ,qBAAiBG,EAAIQ,MAAO,EAAqB,MACpD,UAEN,wBAAoB,QAAQ,IACnC,KAAuC,CACtC,CAAC,eAAeo+C,EAAiBv/C,YAGzC,wBAAoB,aACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,KAAM,GAAa,UAAW,qBAAiBy/C,EAAez/C,MAAMlB,QAAU,IAAK,GACtG2gD,EAAez/C,MAAMlB,OAAS,IACxB,kBAAc,wBAAoB,MAAO,GAAa,GACpD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY2gD,EAAez/C,MAAQ6gD,IACvF,OAAQ,kBAAc,wBAAoB,MAAO,CAC7CjiC,IAAKiiC,EAAQrgD,GACb24B,OAAO,oBAAgB,CAAC,eAAgB,CAAE+C,OAAQsjB,EAAkBx/C,QAAU6gD,EAAQrgD,MACtF27B,QAAUC,GA5M9C,SAAuB0iB,GACnB,MAAM+B,EAAUpB,EAAez/C,MAAMuK,KAAKu2C,GAAKA,EAAEtgD,KAAOs+C,GACpD+B,IACArB,EAAkBx/C,MAAQ6gD,EAAQrgD,GAClC09C,EAAel+C,MAAQ6gD,EAAQ/sC,QAEvC,CAsMyD,CAAe+sC,EAAQrgD,KAC7C,EACC,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,OAAQ,IAAa,qBAAiBggD,EAAWK,EAAQ1B,YAAa,GACzF0B,EAAgB,WACV,kBAAc,wBAAoB,OAAQ,GAAa,WACxD,wBAAoB,QAAQ,MAEtC,wBAAoB,MAAO,IAAa,sBA3ExD/sC,EA2EoF+sC,EAAQ/sC,QAzExGA,EAAQhV,QADM,GAEPgV,EAEJA,EAAQlJ,UAAU,EAJP,IAIuB,QAsE8E,IACxF,GAAuB,IA5E1D,IAAoBkJ,IA6EY,WAEL,kBAAc,wBAAoB,MAAO,GAAa,IAAKmoB,EAAO,KAAOA,EAAO,GAAK,EAChF,wBAAoB,IAAK,KAAM,QAAS,aAI5D,wBAAoB,eACpB,wBAAoB,MAAO,GAAa,CACnCsjB,EAAsB,QAChB,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,YACpB,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,KAAM,IAAa,qBAAiBC,EAAkBx/C,MAAQ,OAAS,QAAS,IACpG,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,SAAU,CAC1Bm5B,MAAO,eACP0D,SAAU+U,EAAa5xC,MACvBm8B,QAAS8jB,IACV,qBAAiBrO,EAAa5xC,MAAQ,SAAW,SAAU,EAAqB,KACnF,wBAAoB,SAAU,CAC1Bm5B,MAAO,WACP0D,UAAWqhB,EAAel+C,MAAMid,QAAUyiC,EAAS1/C,MACnDm8B,QAASyiB,IACV,qBAAiBc,EAAS1/C,MAAQ,SAAW,SAAU,EAAqB,IAC9Ew/C,EAAuB,QACjB,kBAAc,wBAAoB,SAAU,CAC3C5gC,IAAK,EACLua,MAAO,aACPgD,QAASmkB,GACV,YACD,wBAAoB,QAAQ,IAClC,wBAAoB,SAAU,CAC1BnnB,MAAO,UACPgD,QAASokB,GACV,aAGX,wBAAoB,YACpB,wBAAoB,MAAO,GAAa,EACpC,qBAAgB,wBAAoB,WAAY,CAC5C,sBAAuBtkB,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAiBp8B,MAAQo8B,GACvFjD,MAAO,mBACPoD,YAAaqjB,EAAgB5/C,MAC7B68B,SAAU+U,EAAa5xC,OACxB,KAAM,EAAe,IAAc,CAClC,CAAC,aAAak+C,EAAel+C,YAGrC,wBAAoB,UACpBi8B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAE9C,MAAO,iBAAmB,EAC7E,wBAAoB,IAAK,CAAEA,MAAO,eAAiB,sDACnD,SAEL,kBAAc,wBAAoB,MAAO,GAAa,IAAK8C,EAAO,KAAOA,EAAO,GAAK,EAChF,wBAAoB,IAAK,KAAM,YAAa,cAM5E,ICjZJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAE9C,MAAO,kBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,uBAEL,GAAa,CAAC,WACd,GAAa,CAAC,MAAO,OACrB,GAAa,CACfva,IAAK,EACLua,MAAO,oBAEL,GAAa,CAAC,WACd,GAAa,CAAEA,MAAO,qBACtB,GAAa,CAAEA,MAAO,kBACtB,GAAa,CAAEA,MAAO,eACtB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,eAEL,GAAc,CAAEA,MAAO,mBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,wBACvB,GAAc,CAAC,aACf,GAAc,CAAC,YACf,GAAc,CAAEva,IAAK,GACrB,GAAc,CAAEA,IAAK,GACrB,GAAc,CAAEua,MAAO,iBACvB,GAAc,CAAEA,MAAO,YACvB,GAAc,CAAC,SACf,GAAc,CAAEA,MAAO,YACvB,GAAc,CAAEA,MAAO,YACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAAC,YACf,GAAc,CAAEA,MAAO,2BAM7B,IAA6B,qBAAiB,CAC1C2B,OAAQ,gBACRC,MAAO,CAAC,SACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMxe,GAAgB,KAAA3Q,oBAEhBkvB,EAAOC,EAEP4lB,GAAc,IAAAthD,KAAI,aAElBme,GAAY,IAAAne,KAAI,MAChBuhD,GAAmB,IAAAvhD,MAAI,GACvBwhD,GAAoB,IAAAxhD,MAAI,GACxByhD,GAAe,IAAAzhD,KAAI,IACnB0hD,GAAc,IAAA1hD,MAAI,GAClB2hD,GAAY,IAAA3hD,MAAI,GAEhB4hD,GAAY,IAAA5hD,KAAI,IAChB6hD,GAAY,IAAA7hD,MAAI,GAChBq2C,GAAe,IAAAr2C,KAAI,IACnB8hD,GAAkB,IAAA9hD,KAAI,MACtB+hD,GAAqB,IAAA/hD,KAAI,IAEzBgiD,GAAkB,IAAA1hD,UAAS,IACxB6d,EAAU5d,MAER,CACH0mB,gBAAiB,OAAO9I,EAAU5d,MAAM0mB,oBAFjC,CAAC,GAKVm5B,GAAgB,IAAA9/C,UAAS,KAC3B,MAAMq+C,EAAezhC,EAAcxP,kBAC7BxN,EAAO,GACb,IAAK,MAAM8M,KAAY2xC,EACnB,IAAK,MAAM9wC,KAAkBb,EAASjL,WAC9B8L,EAAepL,WACfvC,EAAKgE,KAAK,CACNnD,GAAI8M,EAAehK,YACnBnC,KAAMmM,EAAepL,UAAUf,KAC/ByD,WAAY0I,EAAepL,UAAU0C,YAAc,OAKnE,OAAOjF,IAEL+hD,GAAkB,IAAA3hD,UAAS,KAC7B,GAAwC,IAApCyhD,EAAmBxhD,MAAMlB,OACzB,MAAO,GAKX,OAJc0iD,EAAmBxhD,MAAMzB,IAAIwE,IACvC,MAAMpC,EAAMk/C,EAAc7/C,MAAMuK,KAAKgkB,GAAKA,EAAE/tB,KAAOuC,GACnD,OAAOpC,EAAMA,EAAIQ,KAAO4B,IAEfwF,KAAK,OAStB,SAASo5C,EAAgB7zC,GACrB,MAAO,CACHm1B,KAAM,GAAGn1B,EAAQ4I,SAASxZ,MAC1BgmC,IAAK,GAAGp1B,EAAQ4I,SAASzZ,MACzB6Y,UAAW,SAAShI,EAAQ8I,SAEpC,CACA,SAASgrC,IACLT,EAAYnhD,OAASmhD,EAAYnhD,MAC7BmhD,EAAYnhD,MACZgC,OAAOoB,KAAK,oBAGZpB,OAAOI,QAAQ,OAEvB,CAuBArB,eAAe8gD,IACX,GAAkC,IAA9BX,EAAalhD,MAAMlB,OAIvB,IACIsiD,EAAUphD,OAAQ,QACZwmB,GAAiB,iBAAAS,UAAUi6B,EAAalhD,OAE9CwhD,EAAmBxhD,MAAQ,IAAIkhD,EAAalhD,OAE5CghD,EAAiBhhD,OAAQ,EACzBkhD,EAAalhD,MAAQ,SA+G7Be,iBACI,IACI,GAAwC,IAApCygD,EAAmBxhD,MAAMlB,OAEzB,YADAg3C,EAAa91C,MAAQ,IAGzB,MAAM8hD,QAAgBt7B,GAAiB,iBAAAmC,uBAAuB64B,EAAmBxhD,OAC7E8hD,GAAWA,EAAQ/wC,UAAY+wC,EAAQ/wC,SAASjS,OAAS,GACzDg3C,EAAa91C,MAAQ8hD,EAAQ/wC,SAC7BlT,QAAQC,IAAI,+BAAgCgkD,EAAQ/wC,SAASjS,cAEvD,IAAAixC,YACNgS,IACA//C,OAAOoB,KAAK,OAAO0+C,EAAQ/wC,SAASjS,kBAGpCg3C,EAAa91C,MAAQ,GACrBnC,QAAQC,IAAI,+BAEpB,CACA,MAAOK,GACHN,QAAQM,MAAM,4BAA6BA,GAC3C23C,EAAa91C,MAAQ,EACzB,CACJ,CArIcgiD,GAENjB,EAAY/gD,MAAQ,OACpBgC,OAAOI,QAAQ,kBACnB,CACA,MAAOjE,GACHN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,OACjB,CACA,QACIijD,EAAUphD,OAAQ,CACtB,MAvBIgC,OAAOkE,QAAQ,cAwBvB,CAKAnF,eAAekhD,IAEX,GAAIT,EAAmBxhD,MAAMlB,OAAS,GAAKg3C,EAAa91C,MAAMlB,OAAS,EACnE,UACU0nB,GAAiB,iBAAAyB,iBAAiBu5B,EAAmBxhD,MAAO81C,EAAa91C,OAC/EnC,QAAQC,IAAI,0BAChB,CACA,MAAOK,GACHN,QAAQM,MAAM,4BAA6BA,EAC/C,CAGJkf,EAAiB,iBAAAc,oBACjBtgB,QAAQC,IAAI,gCAEZijD,EAAY/gD,MAAQ,YAEpBwhD,EAAmBxhD,MAAQ,GAC3BgC,OAAOoB,KAAK,QAChB,CAIArC,eAAemhD,IACX,IAAKb,EAAUrhD,MAAMid,QAAUqkC,EAAUthD,MACrC,OACJ,MAAMsF,EAAU+7C,EAAUrhD,MAAMid,OAChC,IACIqkC,EAAUthD,OAAQ,EAElB81C,EAAa91C,MAAM2D,KAAK,CACpBkQ,KAAM,OACNsuC,OAAQ,IACRruC,QAASxO,IAGb+7C,EAAUrhD,MAAQ,SAEZ,IAAA+vC,YACNgS,IACAlkD,QAAQC,IAAI,2BAA4BwH,GAExC,MAAM+vB,EAAYhY,EAAiB,iBAAAS,gBACnC,IAAInT,EAGAA,EAFA0qB,QAEiB1hB,YAAY,CACzBC,gBAAiB,CAAC,CAAEC,KAAM,OAAQC,QAASxO,IAC3CgwB,WAAY,CACR5W,OAAQ2W,EAAU3W,OAClBE,IAAKyW,EAAUzW,IACftT,MAAO+pB,EAAU/pB,MACjBuT,YAAawW,EAAUxW,YACvBC,WAAYuW,EAAUvW,oBAMb3Z,SAAS,CAAEC,WAAYE,IAG5CwwC,EAAa91C,MAAM2D,KAAK,CACpBkQ,KAAM,YACNsuC,OAAQT,EAAgB1hD,OAAS,MACjC8T,QAASnJ,UAGP,IAAAolC,YACNgS,IACAlkD,QAAQC,IAAI,2BAChB,CACA,MAAOK,GACHN,QAAQM,MAAM,0BAA2BA,GACzC6D,OAAO7D,MAAM,SACjB,CACA,QACImjD,EAAUthD,OAAQ,CACtB,CACJ,CAIA,SAAS+hD,IACDR,EAAgBvhD,QAChBuhD,EAAgBvhD,MAAMkwC,UAAYqR,EAAgBvhD,MAAMmwC,aAEhE,CAiCA,SAASiS,IACLlnB,EAAK,SACLl5B,OAAOoB,KAAK,QAChB,CAaA,OAXA,IAAA24B,WAAUh7B,UACN,UACUylB,GAAiB,iBAAA7oB,aACvBigB,EAAU5d,YAAcwmB,GAAiB,iBAAAC,eACzC5oB,QAAQC,IAAI,0BAChB,CACA,MAAOK,GACHN,QAAQM,MAAM,4BAA6BA,GAC3C6D,OAAO7D,MAAM,SACjB,IAEG,CAAC69B,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,UACG,cAAtB8kB,EAAY/gD,QACN,kBAAc,wBAAoB,MAAO,GAAY,EACpD,wBAAoB,WACpB,wBAAoB,MAAO,CACvBm5B,MAAO,uBACPwE,OAAO,oBAAgB8jB,EAAgBzhD,QACxC,EACC,wBAAoB,YACnB,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY4d,EAAU5d,OAAO2mB,WAAa,GAAKA,IACnG,OAAQ,kBAAc,wBAAoB,MAAO,CAC7C/H,IAAK+H,EAAUnmB,GACf24B,MAAO,iBACPwE,OAAO,qBAlObjnB,EAkO0CiQ,EAAUjQ,SAjO/D,CACHusB,KAAM,GAAGvsB,EAASxZ,MAClBgmC,IAAK,GAAGxsB,EAASzZ,SAgOGk/B,QAAUC,GA7MtCr7B,eAA+BuI,EAAQgyC,GACnC,GAAK6F,EAAYnhD,MAEjB,IACI,MAAM8H,QAAoB0e,GAAiB,iBAAAoB,iBAAiBte,GAC5DtH,OAAOoB,KAAK,GAAGk4C,MAAaxzC,IAChC,CACA,MAAO3J,GACHN,QAAQM,MAAM,0BAA2BA,EAC7C,CACJ,CAmMiD,CAAiBwoB,EAAUnmB,GAAImmB,EAAUxlB,OAC/D,CACEwlB,EAAkB,WACZ,kBAAc,wBAAoB,MAAO,CACxC/H,IAAK,EACL8f,IAAK/X,EAAU07B,SACfvjB,IAAKnY,EAAUxlB,MAChB,KAAM,EAAe,OACrB,kBAAc,wBAAoB,MAAO,IAAY,qBAAiBwlB,EAAUxlB,MAAO,KAC/F,GAAuB,IA5OlD,IAAsBuV,IA6OE,OACJ,wBAAoB,aACnB,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYkH,EAAU5d,OAAO+N,UAAY,GAAKD,KAC1F,kBAAc,wBAAoB,MAAO,CAC7C8Q,IAAK9Q,EAAQga,UACbqR,MAAO,eACPwE,OAAO,oBAAgBgkB,EAAgB7zC,IACvCquB,QAAUC,GAnNtCr7B,eAAkC+mB,GAC9B,GAAKq5B,EAAYnhD,MAEjB,IACI,MAAM8H,QAAoB0e,GAAiB,iBAAAoB,iBAAiBE,GAC5D9lB,OAAOoB,KAAK,QAAQ0E,IACxB,CACA,MAAO3J,GACHN,QAAQM,MAAM,2BAA4BA,EAC9C,CACJ,CAyMiD,CAAoB2P,EAAQga,YAClD,IAAKmU,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,MAAO,CAAE9C,MAAO,uBAAyB,OAAQ,MACnE,GAAuB,MACjC,OACL,IACH,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,SAAU,CAC1BA,MAAO,aACPgD,QAASylB,GACV,EACC,wBAAoB,OAAQ,MAAM,qBAAiBT,EAAYnhD,MAAQ,OAAS,MAAO,MAE3F,wBAAoB,SAAU,CAC1Bm5B,MAAO,aACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAY4kB,EAAiBhhD,OAAQ,IAC1E,IAAKi8B,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,OAAQ,KAAM,UAAW,QAErD,wBAAoB,SAAU,CAC1B9C,MAAO,aACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAY6kB,EAAkBjhD,OAAQ,IAC3E,IAAKi8B,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,KAAM,MAAO,QAEjD,wBAAoB,SAAU,CAC1B9C,MAAO,uBACPgD,QAASimB,GACV,IAAKnmB,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,KAAM,MAAO,YAIhC,SAAtB8kB,EAAY/gD,QACR,kBAAc,wBAAoB,WAAW,CAAE4e,IAAK,GAAK,EACxD,wBAAoB,YACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,aACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,OAAQ,KAAM,MAAO,qBAAiB8iC,EAAgB1hD,OAAS,OAAQ,MAE/F,wBAAoB,SAAU,CAC1Bm5B,MAAO,WACPgD,QAAS8lB,GACV,IAAKhmB,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,KAAM,QAAS,UAGvD,wBAAoB,aACpB,wBAAoB,MAAO,CACvB4C,QAAS,kBACTp/B,IAAK8hD,EACLpoB,MAAO,iBACR,CACgC,IAA9B2c,EAAa91C,MAAMlB,SACb,kBAAc,wBAAoB,MAAO,GAAa,IAAKm9B,EAAO,MAAQA,EAAO,IAAM,EAClF,wBAAoB,IAAK,KAAM,kBAAmB,SAExD,wBAAoB,QAAQ,KACjC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY6Z,EAAa91C,MAAO,CAACsF,EAASiE,MACtF,kBAAc,wBAAoB,MAAO,CAC7CqV,IAAKrV,EACL4vB,OAAO,oBAAgB,CAAC,eAAgB7zB,EAAQuO,QACjD,EACC,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,MAAO,IAAa,qBAAiBvO,EAAQ68C,QAAS,IAC1E,wBAAoB,MAAO,IAAa,qBAAiB78C,EAAQwO,SAAU,MAEhF,KACH,OACL,MACH,wBAAoB,aACpB,wBAAoB,MAAO,GAAa,EACpC,qBAAgB,wBAAoB,WAAY,CAC5C,sBAAuBmoB,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAYp8B,MAAQo8B,GAClFjD,MAAO,aACPoD,YAAa,4BACbiV,WAAW,eAAU,mBAAe0Q,EAAiB,CAAC,SAAU,CAAC,WAClE,KAAM,GAAgC,IAAc,CACnD,CAAC,aAAab,EAAUrhD,UAE5B,wBAAoB,SAAU,CAC1Bm5B,MAAO,WACP0D,UAAWwkB,EAAUrhD,MAAMid,QAAUqkC,EAAUthD,MAC/Cm8B,QAAS+lB,GACV,CACGZ,EAAUthD,QAEL,kBAAc,wBAAoB,OAAQ,GAAa,aADvD,kBAAc,wBAAoB,OAAQ,GAAa,QAE/D,EAAe,SAG3B,QACD,wBAAoB,QAAQ,IACtC,wBAAoB,eACnBghD,EAAsB,QAChB,kBAAc,wBAAoB,MAAO,CACxCpiC,IAAK,EACLua,MAAO,gBACPgD,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAgBG,GAAY4kB,EAAiBhhD,OAAQ,EAAQ,CAAC,WAClG,EACC,wBAAoB,MAAO,GAAa,CACpCi8B,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,KAAM,UAAW,KACvE,wBAAoB,MAAO,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY4jB,EAAc7/C,MAAQW,KAC9E,kBAAc,wBAAoB,MAAO,CAC7Cie,IAAKje,EAAIH,GACT24B,MAAO,cACR,EACC,wBAAoB,QAAS,KAAM,EAC/B,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8C,EAAO,KAAOA,EAAO,GAAMG,GAAY,EAAep8B,MAAQo8B,GACrFx9B,KAAM,WACNoB,MAAOW,EAAIH,IACZ,KAAM,EAAe,IAAc,CAClC,CAAC,iBAAiB0gD,EAAalhD,UAEnC,wBAAoB,OAAQ,IAAa,qBAAiBW,EAAIQ,MAAO,IACrE,wBAAoB,OAAQ,IAAa,qBAAiBR,EAAIiE,YAAa,SAGnF,SAER,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,SAAU,CAC1Bu0B,MAAO,cACP0D,SAAwC,IAA9BqkB,EAAalhD,MAAMlB,OAC7Bq9B,QAAS0lB,GACV,WAAY,qBAAiBX,EAAalhD,MAAMlB,QAAU,KAAM,EAAqB,KACxF,wBAAoB,SAAU,CAC1Bq6B,MAAO,gBACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAY4kB,EAAiBhhD,OAAQ,IAC1E,cAIb,wBAAoB,QAAQ,IAClC,wBAAoB,aACnB,kBAAc,iBAAa,WAAW,CAAEqI,GAAI,QAAU,CAClD44C,EAAuB,QACjB,kBAAc,wBAAoB,MAAO,CACxCriC,IAAK,EACLua,MAAO,gBACPgD,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAgBG,GAAY6kB,EAAkBjhD,OAAQ,EAAQ,CAAC,WACnG,EACC,wBAAoB,MAAO,GAAa,EACpC,iBAAasiD,GAAa,CACtBzH,QAAS5e,EAAO,KAAOA,EAAO,GAAMG,GAAY6kB,EAAkBjhD,OAAQ,WAIpF,wBAAoB,QAAQ,QAIlD,IC5eJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CACf4e,IAAK,EACLua,MAAO,cAEL,GAAa,CAAEA,MAAO,kBACtB,GAAa,CAAEA,MAAO,eACtB,GAAa,CAAEA,MAAO,YACtB,GAAa,CAAEA,MAAO,uBACtB,GAAa,CAAEA,MAAO,YACtB,GAAa,CAAEA,MAAO,uBACtB,GAAa,CAAEA,MAAO,YACtB,GAAa,CAAEA,MAAO,wBAM5B,IAA6B,qBAAiB,CAC1C2B,OAAQ,YACR,KAAAE,CAAMC,GACF,MAAM/pB,GAAiB,SAEjBqxC,GAAY,IAAA9iD,KAAI,MAChB+iD,GAAY,IAAA/iD,KAAI,MAChBgjD,GAAa,IAAAhjD,KAAI,MACjBijD,GAAa,IAAAjjD,KAAI,MACjBkjD,GAAa,IAAAljD,KAAI,MACjBmjD,GAAc,IAAAnjD,KAAI,MAElBojD,GAAa,IAAApjD,KAAI,GACjBqjD,GAAa,IAAArjD,KAAI,GACjBsjD,GAAc,IAAAtjD,KAAI,GAElBD,GAAS,IAAAO,UAAS,IAAMmR,EAAe1R,QACvCwjD,GAAe,IAAAjjD,UAAS,IACrBP,EAAOQ,MAEJR,EAAOQ,MAAM0C,aAAakQ,GAAKpT,EAAOQ,MAAM0C,aAAamQ,MAAS,IAD/D,GAGTowC,GAAe,IAAAljD,UAAS,IACrBP,EAAOQ,MAEJR,EAAOQ,MAAM0C,aAAaoQ,GAAKtT,EAAOQ,MAAM0C,aAAaqQ,MAAS,IAD/D,GAGTmwC,GAAgB,IAAAnjD,UAAS,IACtBP,EAAOQ,MAEJR,EAAOQ,MAAM0C,aAAasQ,IAAMxT,EAAOQ,MAAM0C,aAAauQ,OAAU,IADjE,GAOf,SAASkwC,EAAoBpmB,EAASqmB,GAClC,IAAKrmB,EACD,QvC8KT,SACLA,EACAsmB,EAAgB,UAChB/qC,EAAmB,IAEnB,MAAM0kB,EAAK,aAEXA,EAAG30B,GAAG00B,EAAS,CACbumB,gBAAiBD,EACjB/qC,SAAUA,EAAW,EACrB2kB,KAAM,eACL50B,GAAG00B,EAAS,CACbumB,gBAAiB,cACjBhrC,SAAUA,EAAW,EACrB2kB,KAAM,aAIV,CuC9LYsmB,CAAexmB,EADDqmB,EAAa,UAAY,UACR,GACnC,CAIA,SAASI,EAAiBzmB,EAAS58B,EAAMkI,EAAIrE,GACzC,IAAK+4B,EACD,OACJ,MAAM1M,EAAM,CAAErwB,MAAOG,GACrB,KAAQkwB,EAAK,CACTrwB,MAAOqI,EACPiQ,SAAU,GACV2kB,KAAM,aACNwmB,SAAU,KACN1mB,EAAQyV,YAAc,GAAGzuC,KAAKglC,MAAM1Y,EAAIrwB,YAAYgE,MAGhE,CAiDA,OA/CA,IAAAk6B,OAAM,IAAM1+B,EAAOQ,OAAO0C,aAAakQ,GAAI,CAAC8wC,EAAOC,UACjCjkD,IAAVgkD,QAAiChkD,IAAVikD,GAEvBD,IAAUC,IAGdR,EAAoBZ,EAAUviD,MAAO0jD,EAAQC,GAEzCjB,EAAW1iD,OAASR,EAAOQ,OAC3BwjD,EAAiBd,EAAW1iD,MAAO2jD,EAAOD,EAAOlkD,EAAOQ,MAAM0C,aAAamQ,OAE/EgwC,EAAW7iD,MAAQ0jD,MAEvB,IAAAxlB,OAAM,IAAM1+B,EAAOQ,OAAO0C,aAAaoQ,GAAI,CAAC8wC,EAAOC,UACjCnkD,IAAVkkD,QAAiClkD,IAAVmkD,GAEvBD,IAAUC,IAGdV,EAAoBX,EAAUxiD,MAAO4jD,EAAQC,GAEzClB,EAAW3iD,OAASR,EAAOQ,OAC3BwjD,EAAiBb,EAAW3iD,MAAO6jD,EAAOD,EAAOpkD,EAAOQ,MAAM0C,aAAaqQ,OAE/E+vC,EAAW9iD,MAAQ4jD,MAEvB,IAAA1lB,OAAM,IAAM1+B,EAAOQ,OAAO0C,aAAasQ,IAAK,CAACuQ,EAAQugC,UAClCpkD,IAAX6jB,QAAmC7jB,IAAXokD,GAExBvgC,IAAWugC,IAGfX,EAAoBV,EAAWziD,MAAOujB,EAASugC,GAE3ClB,EAAY5iD,OAASR,EAAOQ,OAC5BwjD,EAAiBZ,EAAY5iD,MAAO8jD,EAAQvgC,EAAQ/jB,EAAOQ,MAAM0C,aAAauQ,QAElF8vC,EAAY/iD,MAAQujB,MAGxB,IAAAwY,WAAU,KACFv8B,EAAOQ,QACP6iD,EAAW7iD,MAAQR,EAAOQ,MAAM0C,aAAakQ,GAC7CkwC,EAAW9iD,MAAQR,EAAOQ,MAAM0C,aAAaoQ,GAC7CiwC,EAAY/iD,MAAQR,EAAOQ,MAAM0C,aAAasQ,OAG/C,CAACgpB,EAAMC,IACFz8B,EAAY,QACb,kBAAc,wBAAoB,MAAO,GAAY,EACpD,wBAAoB,WACpB,wBAAoB,MAAO,IAAY,qBAAiBA,EAAOQ,MAAMmB,MAAO,IAC5E,wBAAoB,UACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,CACnC86B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,MAAO,KACtF,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,CACvB0F,QAAS,YACTp/B,IAAK8iD,EACLppB,MAAO,gBACPwE,OAAO,oBAAgB,CAAE+L,MAAOsZ,EAAahjD,MAAQ,OACtD,KAAM,IACT,wBAAoB,OAAQ,CACxB6+B,QAAS,aACTp/B,IAAKijD,EACLvpB,MAAO,eACR,qBAAiB35B,EAAOQ,MAAM0C,aAAakQ,IAAM,OAAQ,qBAAiBpT,EAAOQ,MAAM0C,aAAamQ,OAAQ,UAGvH,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,CACnCopB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,MAAO,KACtF,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,CACvB0F,QAAS,YACTp/B,IAAK+iD,EACLrpB,MAAO,gBACPwE,OAAO,oBAAgB,CAAE+L,MAAOuZ,EAAajjD,MAAQ,OACtD,KAAM,IACT,wBAAoB,OAAQ,CACxB6+B,QAAS,aACTp/B,IAAKkjD,EACLxpB,MAAO,eACR,qBAAiB35B,EAAOQ,MAAM0C,aAAaoQ,IAAM,OAAQ,qBAAiBtT,EAAOQ,MAAM0C,aAAaqQ,OAAQ,UAGvH,wBAAoB,YACpB,wBAAoB,MAAO,GAAY,CACnCkpB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAE9C,MAAO,cAAgB,OAAQ,KACvF,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,CACvB0F,QAAS,aACTp/B,IAAKgjD,EACLtpB,MAAO,gBACPwE,OAAO,oBAAgB,CAAE+L,MAAOwZ,EAAcljD,MAAQ,OACvD,KAAM,IACT,wBAAoB,OAAQ,CACxB6+B,QAAS,cACTp/B,IAAKmjD,EACLzpB,MAAO,eACR,qBAAiB35B,EAAOQ,MAAM0C,aAAasQ,KAAO,OAAQ,qBAAiBxT,EAAOQ,MAAM0C,aAAauQ,QAAS,eAK/H,wBAAoB,QAAQ,EAE1C,ICnLJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qB,aCigBhE,MAAM8wC,GAAyB,IArftC,MACUC,YAA4B,GAKpC,iBAAMC,GAqBJ,OApBArmD,KAAKomD,YAAc,GAEnBhiD,OAAOoB,KAAK,qBAGNxF,KAAKsmD,sBAGLtmD,KAAKumD,yBAGLvmD,KAAKwmD,4BAGLxmD,KAAKymD,+BAGLzmD,KAAK0mD,8BAEX1mD,KAAK2mD,iBACE3mD,KAAKomD,WACd,CAKA,mBAAME,GACJrmD,QAAQC,IAAI,6BAEZ,IAEE,MAAM0mD,EAAannC,EAAiB,iBAAAS,gBACpClgB,KAAK6mD,UAAU,CACbC,SAAU,uBACVC,QAAQ,EACRr/C,QAASk/C,EAAa,gBAAkB,eACxC97C,QAAS87C,UAILnnC,EAAiB,iBAAAc,oBACvB,MAAMymC,EAAevnC,EAAiB,iBAAAS,gBACtClgB,KAAK6mD,UAAU,CACbC,SAAU,uBACVC,QAAQ,EACRr/C,QAAS,gBACToD,QAASk8C,UAILvnC,EAAiB,iBAAAe,qBACvB,MAAMymC,EAAgBxnC,EAAiB,iBAAAS,gBACvClgB,KAAK6mD,UAAU,CACbC,SAAU,sBACVC,QAAQ,EACRr/C,QAAS,eACToD,QAASm8C,UAILxnC,EAAiB,iBAAAgB,oBACvB,MAAMymC,EAAeznC,EAAiB,iBAAAS,gBACtClgB,KAAK6mD,UAAU,CACbC,SAAU,qBACVC,QAAQ,EACRr/C,QAAS,cACToD,QAASo8C,IAIX,MAAMC,QAAmB1nC,EAAiB,iBAAAY,gBACpC+mC,EAA8C,OAAzBD,EAAWrnC,UACtC9f,KAAK6mD,UAAU,CACbC,SAAU,sBACVC,QAAQ,EACRr/C,QAAS0/C,EAAqB,cAAgB,0BAC9Ct8C,QAAS,CAAEs8C,qBAAoBD,gBAIjC,MAAME,EAAa,CACjBvmC,OAAQ,uBACRE,IAAK,WACLtT,MAAO,aACPuT,YAAa,GACbC,WAAY,WAGRzB,EAAiB,iBAAAQ,YAAY,CACjCH,UAAWunC,EACXtnC,WAAYsnC,EACZrnC,UAAWqnC,IAGb,MAAMC,QAAsB7nC,EAAiB,iBAAAY,gBACvCknC,EACJD,EAAcxnC,WAAWgB,SAAWumC,EAAWvmC,QAAUwmC,EAAcxnC,WAAWkB,MAAQqmC,EAAWrmC,IAEvGhhB,KAAK6mD,UAAU,CACbC,SAAU,uBACVC,OAAQQ,EACR7/C,QAAS6/C,EAAgB,gBAAkB,gBAC3Cz8C,QAAS,CAAE08C,MAAOH,EAAYI,OAAQH,EAAcxnC,YAExD,CAAE,MAAOvf,GACPP,KAAK6mD,UAAU,CACbC,SAAU,oBACVC,QAAQ,EACRr/C,QAAS,cAAcnH,IACvBuK,QAASvK,GAEb,CACF,CAKA,sBAAMgmD,GACJtmD,QAAQC,IAAI,yBAEZ,IAEE,MAAMwnD,EAAY,eACZ/5B,QAAgBjB,EAAA,EAAsBuB,WAAWy5B,GAUvD,GARA1nD,KAAK6mD,UAAU,CACbC,SAAU,kBACVC,QAAQ,EACRr/C,QAASimB,EAAU,UAAU+5B,UAAoB,OAAOA,WACxD58C,QAAS6iB,IAIPA,GAAWA,EAAQG,SAAS5sB,OAAS,EAAG,CAC1C,MAAM2oB,QAAqB6C,EAAA,EAAsB5C,mBAAmB49B,GAC9DC,EAAmB99B,EAAa3oB,OAAS,EAE/ClB,KAAK6mD,UAAU,CACbC,SAAU,gBACVC,OAAQY,EACRjgD,QAASigD,EAAmB,YAAc,YAC1C78C,QAAS,CAAEhE,OAAQ+iB,IAEvB,MACE7pB,KAAK6mD,UAAU,CACbC,SAAU,gBACVC,QAAQ,EACRr/C,QAAS,kBACToD,QAAS,OAKb,MAAM88C,EAAej6B,GAASE,mBAAqB,EAEnD7tB,KAAK6mD,UAAU,CACbC,SAAU,kBACVC,QAAQ,EACRr/C,QAAS,WAAWkgD,IACpB98C,QAAS,CAAE88C,kBAIb,MAAM9G,QAAoBp0B,EAAA,EAAsBE,iBAEhD5sB,KAAK6mD,UAAU,CACbC,SAAU,mBACVC,QAAQ,EACRr/C,QAAS,eAAeo5C,EAAY5/C,cACpC4J,QAAS,CAAE+8C,cAAe/G,EAAY5/C,SAE1C,CAAE,MAAOX,GACPP,KAAK6mD,UAAU,CACbC,SAAU,gBACVC,QAAQ,EACRr/C,QAAS,cAAcnH,IACvBuK,QAASvK,GAEb,CACF,CAKA,yBAAMimD,GACJvmD,QAAQC,IAAI,yBAEZ,UAEQ0oB,GAAiB,iBAAA7oB,aACvB,MAAMigB,QAAkB4I,GAAiB,iBAAAC,eAEzC7oB,KAAK6mD,UAAU,CACbC,SAAU,iBACVC,OAAsB,OAAd/mC,EACRtY,QAASsY,EAAY,UAAY,UACjClV,QAASkV,IAIX,MAAM8nC,EAAa,CAAC,gBAEpB,UACQl/B,GAAiB,iBAAAS,UAAUy+B,GACjC,MAAMC,QAAyBn/B,GAAiB,iBAAAC,eAC1Cm/B,EAAuC,OAArBD,GAA6BA,EAAiB9+B,oBAAoB/nB,OAAS,EAEnGlB,KAAK6mD,UAAU,CACbC,SAAU,sBACVC,OAAQiB,EACRtgD,QAASsgD,EAAkB,mBAAqB,WAChDl9C,QAASi9C,GAAkB9+B,qBAE/B,CAAE,MAAO1oB,GACPP,KAAK6mD,UAAU,CACbC,SAAU,sBACVC,QAAQ,EACRr/C,QAAS,iBAAiBnH,IAC1BuK,QAASvK,GAEb,CAGA,MAAM0nD,EAAc,CAClBrlD,GAAI,mBACJW,KAAM,QACN2G,YAAa,WACbqjB,eAAgB,gBAChBwvB,WAAYpsC,KAAKC,aAGbgY,GAAiB,iBAAA3Y,WAAWg4C,EAAa,CAAE3oD,EAAG,IAAKD,EAAG,MAC5D,MAAM6oD,QAA6Bt/B,GAAiB,iBAAAC,eAC9Cs/B,EAAuC,OAAzBD,GAAiCA,EAAqB/3C,SAASjP,OAAS,EAE5FlB,KAAK6mD,UAAU,CACbC,SAAU,iBACVC,OAAQoB,EACRzgD,QAASygD,EAAc,UAAY,UACnCr9C,QAASo9C,GAAsB/3C,WAIjC,MAAM8Y,EAAsBi/B,GAAsBj/B,qBAAuB,GACnEm/B,EAAan/B,EAAoB/nB,OAAS,EAEhDlB,KAAK6mD,UAAU,CACbC,SAAU,mBACVC,OAAQqB,EACR1gD,QAAS0gD,EAAa,WAAa,YACnCt9C,QAAS,CAAEu9C,aAAcp/B,EAAoB/nB,UAI/C,MAAM0lD,EAAannC,EAAiB,iBAAAS,gBAEpClgB,KAAK6mD,UAAU,CACbC,SAAU,kBACVC,OAAuB,OAAfH,GAAsC,OAAfA,EAC/Bl/C,QAASk/C,EAAa,aAAe,eACrC97C,QAAS87C,GAEb,CAAE,MAAOrmD,GACPP,KAAK6mD,UAAU,CACbC,SAAU,gBACVC,QAAQ,EACRr/C,QAAS,cAAcnH,IACvBuK,QAASvK,GAEb,CACF,CAKA,4BAAMkmD,GACJxmD,QAAQC,IAAI,2BAEZ,IACE,MAGMsgD,GAHgB,KAAApyC,oBAGamB,kBAEnCvP,KAAK6mD,UAAU,CACbC,SAAU,kBACVC,QAAQ,EACRr/C,QAAS,eAAe84C,EAAat/C,cACrC4J,QAAS,CAAEyB,cAAei0C,EAAat/C,UAIzC,MAAMonD,EAAkB9H,EAAa19C,OAAO0G,GAAkB,WAAbA,EAAEjD,QAC7CgiD,EAAqB/H,EAAa19C,OAAO0G,GAAkB,cAAbA,EAAEjD,QAEtDvG,KAAK6mD,UAAU,CACbC,SAAU,kBACVC,QAAQ,EACRr/C,QAAS,SAAS4gD,EAAgBpnD,kBAAkBqnD,EAAmBrnD,SACvE4J,QAAS,CAAE09C,YAAaF,EAAgBpnD,OAAQunD,eAAgBF,EAAmBrnD,UAIrF,MAAMwnD,EAAsBlI,EAAa19C,OAAO0G,GAAKA,EAAE9C,QAAU8C,EAAE9C,OAAOxF,OAAS,GAEnFlB,KAAK6mD,UAAU,CACbC,SAAU,kBACVC,QAAQ,EACRr/C,QAAS,GAAGghD,EAAoBxnD,mBAChC4J,QAAS,CAAE49C,oBAAqBA,EAAoBxnD,UAItD,MAAMynD,EAAwBnI,EAAa19C,OAAO0G,GAAKA,EAAE2G,UAAY3G,EAAE2G,SAASjP,OAAS,GAEzFlB,KAAK6mD,UAAU,CACbC,SAAU,iBACVC,QAAQ,EACRr/C,QAAS,GAAGihD,EAAsBznD,kBAClC4J,QAAS,CAAE69C,sBAAuBA,EAAsBznD,SAE5D,CAAE,MAAOX,GACPP,KAAK6mD,UAAU,CACbC,SAAU,kBACVC,QAAQ,EACRr/C,QAAS,cAAcnH,IACvBuK,QAASvK,GAEb,CACF,CAKA,iCAAMmmD,GACJzmD,QAAQC,IAAI,4BAEZ,IAEE,MAAM0oD,EAAgBr7C,YAAYumB,oBAAsBvmB,YAAY2F,MAAMhS,QAAU,GAAK,GAAK,EACxFiS,EAAWy1C,GAAiB,EAAIx1C,gBAAgB,KAAKw1C,KAAmB,GACxEv1C,EAAkC,IAApBF,EAASjS,OAE7BlB,KAAK6mD,UAAU,CACbC,SAAU,kBACVC,QAAQ,EACRr/C,QAAS2L,EAAc,WAAa,QAAQF,EAASjS,WACrD4J,QAAS,CAAE+9C,aAAc11C,EAASjS,UAIpC,MACM6gD,EADgB1+C,aAAa,CAAErC,KAAM,WACLsC,iBAChCwlD,EAAe/G,QAUrB,GARA/hD,KAAK6mD,UAAU,CACbC,SAAU,kBACVC,QAAQ,EACRr/C,QAASohD,EAAe,UAAY,UACpCh+C,QAASi3C,IAIP+G,EACF,IACE,MAAMj5B,EAAUtiB,YACVsvC,EAAShtB,EAAQnqB,YACjByuB,EAActE,EAAQjsB,WAAWi5C,GACjCkM,EAAiB50B,GAAeA,EAAYjqB,aAAeiqB,EAAYjqB,YAAYhJ,OAAS,EAElGlB,KAAK6mD,UAAU,CACbC,SAAU,iBACVC,OAAQgC,IAAkB,EAC1BrhD,QAASqhD,EAAiB,WAAa,cACvCj+C,QAAS,CAAEoJ,kBAAmBigB,GAAajqB,aAAahJ,QAAU,IAEtE,CAAE,MAAOX,GACPP,KAAK6mD,UAAU,CACbC,SAAU,iBACVC,QAAQ,EACRr/C,QAAS,iBAAiBnH,IAC1BuK,QAASvK,GAEb,MAEAP,KAAK6mD,UAAU,CACbC,SAAU,iBACVC,QAAQ,EACRr/C,QAAS,oBACToD,QAAS,OAKb,MAAMozC,QAAqBt3C,GAAoB,oBAAAgC,UACzCO,EAA0B,OAAjB+0C,GAAyBA,EAAa/1C,OAAS+1C,EAAa/1C,MAAMzF,KAAO,EAExF1C,KAAK6mD,UAAU,CACbC,SAAU,kBACVC,OAAQ59C,EACRzB,QAASyB,EAAS,cAAc+0C,EAAa/1C,MAAMzF,YAAc,YACjEoI,QAASozC,GAEb,CAAE,MAAO39C,GACPP,KAAK6mD,UAAU,CACbC,SAAU,mBACVC,QAAQ,EACRr/C,QAAS,cAAcnH,IACvBuK,QAASvK,GAEb,CACF,CAKQ,SAAAsmD,CAAUh/C,GAChB7H,KAAKomD,YAAYrgD,KAAK8B,GAEtB,MAAMmhD,EAAOnhD,EAAOk/C,OAAS,IAAM,IAC7BtB,EAAQ59C,EAAOk/C,OAAS,QAAU,MAExC9mD,QAAQC,IAAI,KAAK8oD,KAAQnhD,EAAOi/C,aAAaj/C,EAAOH,UAAW,UAAU+9C,KAErE59C,EAAOiD,SACT7K,QAAQC,IAAI,QAAS2H,EAAOiD,QAEhC,CAKQ,cAAA67C,GACN,MAAMsC,EAAajpD,KAAKomD,YAAYllD,OAC9BgoD,EAAclpD,KAAKomD,YAAYtjD,OAAOgwB,GAAKA,EAAEi0B,QAAQ7lD,OACrDioD,EAAcF,EAAaC,EAEjCjpD,QAAQC,IAAI,oBACZD,QAAQC,IAAI,SAAS+oD,KACrBhpD,QAAQC,IAAI,SAASgpD,IAAe,gBACpCjpD,QAAQC,IAAI,SAASipD,IAAe,cACpClpD,QAAQC,IAAI,SAAUgpD,EAAcD,EAAc,KAAK3hC,QAAQ,OAE3D6hC,EAAc,GAChBlpD,QAAQC,IAAI,YACZF,KAAKomD,YACFtjD,OAAOgwB,IAAMA,EAAEi0B,QACf7iD,QAAQ4uB,IACP7yB,QAAQC,IAAI,OAAO4yB,EAAEg0B,aAAah0B,EAAEprB,UAAW,gBAGnDtD,OAAOkE,QAAQ,WAAW4gD,KAAeD,SAEzC7kD,OAAOI,QAAQ,cAAcykD,KAAcA,KAE/C,CAKA,UAAAG,GACE,OAAOppD,KAAKomD,WACd,CAKA,cAAAiD,GACE,MAAMJ,EAAajpD,KAAKomD,YAAYllD,OAC9BgoD,EAAclpD,KAAKomD,YAAYtjD,OAAOgwB,GAAKA,EAAEi0B,QAAQ7lD,OAE3D,IAAIkM,EAAS,gCAmBb,OAlBAA,GAAU,cAAa,IAAIuD,MAAOitC,uBAClCxwC,GAAU,aAAa87C,KAAeD,UAAoBC,EAAcD,EAAc,KAAK3hC,QAAQ,WAEnGla,GAAU,cAEVpN,KAAKomD,YAAYliD,QAAQ2D,IACvB,MAAMtB,EAASsB,EAAOk/C,OAAS,OAAS,OACxC35C,GAAU,OAAOvF,EAAOi/C,aACxB15C,GAAU,WAAW7G,MACrB6G,GAAU,WAAWvF,EAAOH,YAExBG,EAAOiD,UACTsC,GAAU,0BAA0Bud,KAAKC,UAAU/iB,EAAOiD,QAAS,KAAM,gBAG3EsC,GAAU,OAGLA,CACT,G,cClgBF,MAAM,GAAa,CAAEmuB,MAAO,cACtB,GAAa,CAAEA,MAAO,eACtB,GAAa,CAAEA,MAAO,gBACtB,GAAa,CAAEA,MAAO,gBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,eAEL,GAAa,CAAEA,MAAO,gBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,eAEL,GAAa,CAAEA,MAAO,gBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,eAEL,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,eAEL,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,eAEL,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAChBva,IAAK,EACLua,MAAO,eASX,IAA6B,qBAAiB,CAC1C2B,OAAQ,YACRC,MAAO,CAAC,SACR,KAAAC,CAAMC,GACF,MAAMisB,GAAmB,IAAAznD,KAAI,IACvB0nD,GAAgB,IAAA1nD,KAAI,IACpB2nD,GAAkB,IAAA3nD,KAAI,IACtB4nD,GAAgB,IAAA5nD,KAAI,IACpB6nD,GAAe,IAAA7nD,KAAI,IACnB8nD,GAAwB,IAAA9nD,KAAI,IAC5Bkd,GAAgB,KAAA3Q,oBAEtBjL,eAAeymD,IACX,IACIN,EAAiBlnD,MAAQ,cAEzB,MAAMynD,EAAY,CACdjnD,GAAI,QAAQ+N,KAAKC,QACjB1G,YAAa,iBACblJ,KAAM,WACN2Y,UAAWhJ,KAAKC,MAChB2c,eAAgB,uBAEdb,EAAA,EAAsBe,eAAe,eAAgBo8B,GAC3DP,EAAiBlnD,MAAQ,qBAC7B,CACA,MAAO7B,GACH+oD,EAAiBlnD,MAAQ,WAAW7B,GACxC,CACJ,CACA4C,eAAe2mD,IACX,IACI,MAAMp8B,QAAiBhB,EAAA,EAAsBE,iBAC7C08B,EAAiBlnD,MAAQ,gBAAgBsrB,EAASxsB,WAAWypB,KAAKC,UAAU8C,EAAU,KAAM,IAChG,CACA,MAAOntB,GACH+oD,EAAiBlnD,MAAQ,WAAW7B,GACxC,CACJ,CACA4C,eAAe4mD,IACX,IACI,MAAMjjD,QAAe4lB,EAAA,EAAsB5C,mBAAmB,gBAC9Dw/B,EAAiBlnD,MAAQ0E,EAAS,cAAcA,IAAW,eAC/D,CACA,MAAOvG,GACH+oD,EAAiBlnD,MAAQ,WAAW7B,GACxC,CACJ,CAEA4C,eAAe6mD,IACX,IACIT,EAAcnnD,MAAQ,gBACtB,MAAMmM,EAAkBwQ,EAAcxQ,gBACtC,IAAKA,EAED,YADAg7C,EAAcnnD,MAAQ,YAG1B,MAAML,QAAashB,GAAyB,yBAAAE,mBAAmB,EAAGhV,EAAgBvN,MAAQ,QAAS,IACnGuoD,EAAcnnD,MAAQ,gBAAgBL,EAAKb,cAC/C,CACA,MAAOX,GACHgpD,EAAcnnD,MAAQ,WAAW7B,GACrC,CACJ,CACA4C,eAAe8mD,IACX,IACI,MAAM17C,EAAkBwQ,EAAcxQ,gBACtC,IAAKA,IAAoBA,EAAgB3K,WAAW1C,OAEhD,YADAqoD,EAAcnnD,MAAQ,gBAG1B,MAAMysB,EAAUtgB,EAAgB3K,WAAW,GAC3C2lD,EAAcnnD,MAAQ,WAAWysB,EAAQvqB,UAAUf,eAAesrB,EAAQ9e,iBAAmB,GACjG,CACA,MAAOxP,GACHgpD,EAAcnnD,MAAQ,WAAW7B,GACrC,CACJ,CAEA4C,eAAe+mD,IACX,IACIV,EAAgBpnD,MAAQ,cACxB,MAAMmM,EAAkBwQ,EAAcxQ,gBACtC,IAAKA,EAED,YADAi7C,EAAgBpnD,MAAQ,kBAGtBkc,GAAmB,mBAAAE,wBAAwBjQ,EAAgB3L,GAAI,wBAAyB,IAC9F4mD,EAAgBpnD,MAAQ,WAC5B,CACA,MAAO7B,GACHipD,EAAgBpnD,MAAQ,WAAW7B,GACvC,CACJ,CACA4C,eAAegnD,IACX,IACI,MAAM57C,EAAkBwQ,EAAcxQ,gBACtC,IAAKA,EAED,YADAi7C,EAAgBpnD,MAAQ,YAG5B,MAAMsE,EAAS6H,EAAgB7H,QAAU,GACzC8iD,EAAgBpnD,MAAQ,YAAYsE,EAAOxF,eAAeypB,KAAKC,UAAUlkB,EAAO0jB,OAAO,GAAI,KAAM,IACrG,CACA,MAAO7pB,GACHipD,EAAgBpnD,MAAQ,WAAW7B,GACvC,CACJ,CAEA4C,eAAeinD,IACX,IACIX,EAAcrnD,MAAQ,cACtB,MAAMioD,EAAgB,CAClBznD,GAAI,cACJ5B,KAAM,SACNuC,KAAM,OACNwD,IAAK,GACLC,WAAY,MACZC,WAAY,cACZrC,WAAY,CAAE0P,IAAK,GAAIC,IAAK,GAAIC,IAAK,GAAIC,IAAK,GAAIC,IAAK,GAAIC,IAAK,GAAIC,IAAK,GAAIC,IAAK,GAAIC,IAAK,IAC3FhQ,aAAc,CACVkQ,GAAI,GACJE,GAAI,GACJE,IAAK,GACLk1C,KAAM,GACNh1C,IAAK,EACLC,GAAI,IACJg1C,MAAO,EACP/0C,MAAO,EACPP,MAAO,GACPE,MAAO,GACPE,OAAQ,IAEZI,OAAQ,IAAIzT,IACZ+C,UAAW,GACXgH,UAAW,IAETpL,QAAYiG,GAAoB,oBAAAC,YAAYwjD,GAClDZ,EAAcrnD,MAAQ,oBAAoBzB,EAAIwH,MAAMzF,eAAe/B,EAAIyH,WAC3E,CACA,MAAO7H,GACHkpD,EAAcrnD,MAAQ,WAAW7B,GACrC,CACJ,CACA4C,eAAeqnD,IACX,IACIf,EAAcrnD,MAAQ,YAC1B,CACA,MAAO7B,GACHkpD,EAAcrnD,MAAQ,WAAW7B,GACrC,CACJ,CAEA4C,eAAesnD,IACX,IACIf,EAAatnD,MAAQ,gBACrB,MAAM,cAAEyK,SAAwB,sCAC1BhF,QAAegF,IACjBhF,EAAOrD,QACPklD,EAAatnD,MAAQ,KAAKyF,EAAOH,mBAAmBijB,KAAKC,UAAU/iB,EAAOiD,QAAS,KAAM,KAGzF4+C,EAAatnD,MAAQ,KAAKyF,EAAOH,cAAcG,EAAOiD,SAASoC,WAAa,IAEpF,CACA,MAAO3M,GACHmpD,EAAatnD,MAAQ,WAAW7B,GACpC,CACJ,CACA4C,eAAeunD,IACX,IACIhB,EAAatnD,MAAQ,cACrB,MAAM,mBAAE+K,SAA6B,sCAC/BC,QAAeD,IACrBu8C,EAAatnD,MAAQgL,CACzB,CACA,MAAO7M,GACHmpD,EAAatnD,MAAQ,WAAW7B,GACpC,CACJ,CAEA4C,eAAewnD,IACX,IACIhB,EAAsBvnD,MAAQ,sBACxB+jD,GAAuBE,cAC7B,MAAM75B,EAAU25B,GAAuBiD,aACvCO,EAAsBvnD,MAAQ,cAAcoqB,EAAQ1pB,OAAOgwB,GAAKA,EAAEi0B,QAAQ7lD,UAAUsrB,EAAQtrB,aAAasrB,EAAQ7rB,IAAImyB,GAAK,GAAGA,EAAEi0B,OAAS,IAAM,OAAOj0B,EAAEg0B,aAAah0B,EAAEprB,WAAWiD,KAAK,OAC1L,CACA,MAAOpK,GACHopD,EAAsBvnD,MAAQ,WAAW7B,GAC7C,CACJ,CACA,MAAO,CAAC69B,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,MAAO,GAAY,CACnCA,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,aAAc,KACxE,wBAAoB,SAAU,CAC1B9C,MAAO,YACPgD,QAASF,EAAO,KAAOA,EAAO,GAAMG,GAAYJ,EAAK8a,MAAM,WAC5D,QAEP,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,eACpB,wBAAoB,MAAO,GAAY,CACnC7a,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,aAAc,KACxE,wBAAoB,MAAO,CAAE9C,MAAO,gBAAkB,EAClD,wBAAoB,SAAU,CAAEgD,QAASqrB,GAAqB,WAC9D,wBAAoB,SAAU,CAAErrB,QAASurB,GAAsB,WAC/D,wBAAoB,SAAU,CAAEvrB,QAASwrB,GAAuB,YAEnET,EAAsB,QAChB,kBAAc,wBAAoB,MAAO,IAAY,qBAAiBA,EAAiBlnD,OAAQ,KAChG,wBAAoB,QAAQ,MAEtC,wBAAoB,iBACpB,wBAAoB,MAAO,GAAY,CACnCi8B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,eAAgB,KAC1E,wBAAoB,MAAO,CAAE9C,MAAO,gBAAkB,EAClD,wBAAoB,SAAU,CAAEgD,QAASyrB,GAAqB,aAC9D,wBAAoB,SAAU,CAAEzrB,QAAS0rB,GAAqB,eAEjEV,EAAmB,QACb,kBAAc,wBAAoB,MAAO,IAAY,qBAAiBA,EAAcnnD,OAAQ,KAC7F,wBAAoB,QAAQ,MAEtC,wBAAoB,eACpB,wBAAoB,MAAO,GAAY,CACnCi8B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,aAAc,KACxE,wBAAoB,MAAO,CAAE9C,MAAO,gBAAkB,EAClD,wBAAoB,SAAU,CAAEgD,QAAS2rB,GAAmB,WAC5D,wBAAoB,SAAU,CAAE3rB,QAAS4rB,GAAoB,YAEhEX,EAAqB,QACf,kBAAc,wBAAoB,MAAO,IAAY,qBAAiBA,EAAgBpnD,OAAQ,KAC/F,wBAAoB,QAAQ,MAEtC,wBAAoB,eACpB,wBAAoB,MAAO,GAAa,CACpCi8B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,cAAe,KACzE,wBAAoB,MAAO,CAAE9C,MAAO,gBAAkB,EAClD,wBAAoB,SAAU,CAAEgD,QAAS6rB,GAAqB,WAC9D,wBAAoB,SAAU,CAAE7rB,QAASisB,GAAmB,YAE/Df,EAAmB,QACb,kBAAc,wBAAoB,MAAO,IAAa,qBAAiBA,EAAcrnD,OAAQ,KAC9F,wBAAoB,QAAQ,MAEtC,wBAAoB,cACpB,wBAAoB,MAAO,GAAa,CACpCi8B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,cAAe,KACzE,wBAAoB,MAAO,CAAE9C,MAAO,gBAAkB,EAClD,wBAAoB,SAAU,CAAEgD,QAASksB,GAAoB,aAC7D,wBAAoB,SAAU,CAAElsB,QAASmsB,GAAoB,UAEhEhB,EAAkB,QACZ,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,MAAO,MAAM,qBAAiBA,EAAatnD,OAAQ,OAEzE,wBAAoB,QAAQ,MAEtC,wBAAoB,WACpB,wBAAoB,MAAO,GAAa,CACpCi8B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,WAAY,KACtE,wBAAoB,MAAO,CAAE9C,MAAO,gBAAkB,EAClD,wBAAoB,SAAU,CAC1BA,MAAO,cACPgD,QAASosB,GACV,YAENhB,EAA2B,QACrB,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,MAAO,MAAM,qBAAiBA,EAAsBvnD,OAAQ,OAElF,wBAAoB,QAAQ,SAKtD,ICxTJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qB,cCJvE,MAAM,GAAa,CAAEm5B,MAAO,gBACtB,GAAa,CAAEA,MAAO,kBACtB,GAAa,CAAEA,MAAO,kBAE5B,IAA6B,qBAAiB,CAC1C2B,OAAQ,gBACR1N,MAAO,CACHo7B,KAAM,CAAE5pD,KAAM+M,SACd8wB,MAAO,CAAC,EACRn3B,QAAS,CAAC,EACVmjD,YAAa,CAAExhD,QAAS,MACxByhD,WAAY,CAAEzhD,QAAS,MACvB0hD,WAAY,CAAE/pD,KAAM+M,QAAS1E,SAAS,IAE1C8zB,MAAO,CAAC,UAAW,UACnB,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAM/N,EAAQ6N,EAERC,EAAOC,EAKb,SAASytB,IACL1tB,EAAK,UACT,CAIA,SAAS2tB,IACL3tB,EAAK,SACT,CAIA,SAAS4tB,IACL5tB,EAAK,SACT,CAIA,SAAS6tB,EAAa1kD,GACA,WAAdA,EAAMua,KAAoBwO,EAAMo7B,MAChCttB,EAAK,SAEb,CAQA,OANA,IAAAa,WAAU,KACNhI,OAAOi1B,iBAAiB,UAAWD,MAEvC,IAAAE,aAAY,KACRl1B,OAAOm1B,oBAAoB,UAAWH,KAEnC,CAAC/sB,EAAMC,MACF,kBAAc,iBAAa,WAAW,CAAE5zB,GAAI,QAAU,EAC1D,iBAAa,aAAa,CAAElH,KAAM,QAAU,CACxC8F,SAAS,aAAS,IAAM,CACnBg0B,EAAY,OACN,kBAAc,wBAAoB,MAAO,CACxCrc,IAAK,EACLua,MAAO,yBACPgD,QAAS2sB,GACV,EACC,iBAAa,aAAa,CAAE3nD,KAAM,SAAW,CACzC8F,SAAS,aAAS,IAAM,CACnBg0B,EAAY,OACN,kBAAc,wBAAoB,MAAO,CACxCrc,IAAK,EACLua,MAAO,iBACPgD,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,wBAAoB,KAAM,IAAY,qBAAiBhB,EAAQwB,OAAQ,IACvE,wBAAoB,IAAK,IAAY,qBAAiBxB,EAAQ31B,SAAU,IACxE,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,SAAU,CAC1B6zB,MAAO,wBACPgD,QAAS0sB,IACV,qBAAiB5tB,EAAQytB,YAAa,IACzC,wBAAoB,SAAU,CAC1BvvB,OAAO,oBAAgB,CAAC,yBAA0B,CAAE,aAAc8B,EAAQ0tB,cAC1ExsB,QAASysB,IACV,qBAAiB3tB,EAAQwtB,aAAc,SAGhD,wBAAoB,QAAQ,KAEtCvpC,EAAG,QAGT,wBAAoB,QAAQ,KAEtCA,EAAG,MAInB,ICzFJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAEia,MAAO,yBAc5B,IAA6B,qBAAiB,CAC1C2B,OAAQ,eACRC,MAAO,CAAC,kBAAmB,YAC3B,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMguB,GAAoB,IAAA1pD,MAAI,GAExBy7B,EAAOC,EAKb,SAASiuB,IACLD,EAAkBnpD,OAAQ,CAC9B,CAKAe,eAAesoD,IACXF,EAAkBnpD,OAAQ,EAC1B,UAEUuT,GAAiB,iBAAA4W,mBAEvB+Q,EAAK,kBACT,CACA,MAAO/8B,GACHN,QAAQM,MAAM,2BAA4BA,GAC1C6D,OAAO7D,MAAM,sBACjB,CACJ,CAKA,SAASmrD,IACLH,EAAkBnpD,OAAQ,CAC9B,CAIA,SAASupD,IACLruB,EAAK,WACT,CACA,MAAO,CAACc,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,MAAO,CAAE9C,MAAO,iBAAmB,EACnD,wBAAoB,MAAO,CAAEA,MAAO,mBAAqB,CACrD8C,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAE9C,MAAO,iBAAmB,aAAc,KAC9F,wBAAoB,MAAO,CAAEA,MAAO,gBAAkB,EAClD,wBAAoB,SAAU,CAC1BA,MAAO,wBACPgD,QAASitB,GACV,SACH,wBAAoB,SAAU,CAC1BjwB,MAAO,0BACPgD,QAASotB,GACV,eAIf,wBAAoB,YACpB,iBAAaC,GAAe,CACxBhB,KAAMW,EAAkBnpD,MACxBy8B,MAAO,UACPn3B,QA1EG,2FA2EH,eAAgB,KAChB,cAAe,KACf,eAAe,EACfmkD,UAAWJ,EACXK,SAAUJ,GACX,KAAM,EAAe,CAAC,WAGrC,IClFJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAEnwB,MAAO,kBACtB,GAAa,CAAEA,MAAO,0BACtB,GAAa,CAAEA,MAAO,sBACtB,GAAa,CAAEA,MAAO,kBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,iCAEL,GAAa,CACfva,IAAK,EACLua,MAAO,4CAEL,GAAa,CACfva,IAAK,EACLua,MAAO,iBAEL,GAAa,CAAC,SACd,GAAa,CAAC,SACd,GAAc,CAAC,SACf,GAAc,CAChBva,IAAK,EACLua,MAAO,iBA4BX,IAA6B,qBAAiB,CAC1C2B,OAAQ,gBACR,KAAAE,CAAMC,GACF,MAAM/pB,GAAiB,SACjB4sB,GAAY,IAAA3e,gBAEZwqC,GAAc,IAAAlqD,MAAI,GAClBmqD,GAAqB,IAAAnqD,MAAI,GACzBq5C,GAAuB,IAAAr5C,MAAI,GAC3BoqD,GAAiB,IAAApqD,MAAI,GACrBqqD,GAAe,IAAArqD,MAAI,GACnBsqD,GAAgB,IAAAtqD,MAAI,GACpBuqD,GAAwB,IAAAvqD,MAAI,GAC5BwqD,GAAqB,IAAAxqD,MAAI,GACzBs5C,GAAiB,IAAAt5C,MAAI,GACrByqD,GAAgB,IAAAzqD,MAAI,GACpB0qD,GAAgB,IAAA1qD,MAAI,GACpB2qD,GAAiB,IAAA3qD,MAAI,GACrB4qD,GAAW,IAAA5qD,MAAI,GACf6qD,GAAe,IAAA7qD,MAAI,GACnB8qD,GAAiB,IAAA9qD,KAAI,MACrBygC,GAAmB,IAAAzgC,UAAIC,GAEvBs+B,GAAoB,IAAAj+B,UAAS,IACxB+9B,EAAU1e,cAAcva,YAAc,IAE3C2lD,GAAgB,IAAAzqD,UAAS,IACpB+9B,EAAU1e,cAAc9E,SAAW,IAa9C,SAASmwC,IACLb,EAAmB5pD,OAAS4pD,EAAmB5pD,KACnD,CAIA,SAAS0qD,IACLb,EAAe7pD,OAAS6pD,EAAe7pD,KAC3C,CAIA,SAAS2qD,IACkB,WAAnB7sB,EAAUtjB,KACVowC,IAGA9sB,EAAU1d,QAAQ,SAE1B,CAIA,SAASwqC,IACL9sB,EAAU1d,QAAQ,OACtB,CAIA,SAASyqC,IACLf,EAAa9pD,OAAS8pD,EAAa9pD,KACvC,CAIA,SAAS8qD,IACLf,EAAc/pD,OAAS+pD,EAAc/pD,KACzC,CAIA,SAAS+qD,IACLf,EAAsBhqD,OAASgqD,EAAsBhqD,KACzD,CAIA,SAASgrD,IACLjS,EAAe/4C,OAAS+4C,EAAe/4C,KAC3C,CAIA,SAASirD,IACLhB,EAAmBjqD,OAASiqD,EAAmBjqD,KACnD,CAIA,SAASkrD,IACLhB,EAAclqD,OAASkqD,EAAclqD,KACzC,CAIA,SAASmrD,IACLhB,EAAcnqD,OAASmqD,EAAcnqD,KACzC,CAIA,SAASorD,IACkB,cAAnBttB,EAAUtjB,KACV6wC,IAGAvtB,EAAU1d,QAAQ,YAE1B,CAIA,SAASirC,IACLvtB,EAAU1d,QAAQ,OACtB,CAUA,SAASgpC,IACLvrD,QAAQC,IAAI,iCACZ6rD,EAAY3pD,OAAQ,EAEpB89B,EAAU1d,QAAQ,WACtB,CAIA,SAASmpC,IACL1rD,QAAQC,IAAI,+BACZ6rD,EAAY3pD,OAAQ,CAExB,CAIAe,eAAem4C,EAAuBh3C,GAUlC,GATArE,QAAQC,IAAI,0BAA2BoE,EAAUf,MACjD23C,EAAqB94C,OAAQ,EAC7BkgC,EAAiBlgC,WAAQN,EAEF,aAAnBo+B,EAAUtjB,MA3BdsjB,EAAU1d,QAAQ,QA8BlBpe,OAAOI,QAAQ,MAAMF,EAAUf,cAER,WAAnBe,EAAUtD,KAAmB,CAC7Bf,QAAQC,IAAI,0EACZ,IACI,MAAM,qBAAEwS,SAA+B,4CACjCA,EAAqBgD,mBAAmBpR,GAC9CrE,QAAQC,IAAI,gCAChB,CACA,MAAOK,GACHN,QAAQM,MAAM,iCAAkCA,GAChD6D,OAAO7D,MAAM,mBACjB,CACJ,CACJ,CAIA,SAASmtD,EAAoBppD,GACzBg+B,EAAiBlgC,MAAQkC,EACzB0nD,EAAmB5pD,OAAQ,EAC3B84C,EAAqB94C,OAAQ,CACjC,CAKA,SAASurD,IACL1tD,QAAQC,IAAI,iCACRssD,EAAepqD,QACfoqD,EAAepqD,OAAQ,EACvBuqD,EAAevqD,OAAOmxC,eAE9B,CAIA,SAASqa,IACDpB,EAAepqD,OAEfoqD,EAAepqD,OAAQ,EACvBuqD,EAAevqD,OAAOmxC,gBAItBiZ,EAAepqD,OAAQ,CAE/B,CAIA,SAASyrD,IACLpB,EAASrqD,OAASqqD,EAASrqD,KAC/B,CAIA,SAAS0rD,IACL,MAAM3uB,EAAUS,SAASmuB,gBACpBrB,EAAatqD,MAYTw9B,SAASouB,eAEdpuB,SAASouB,iBAEJpuB,SAASquB,qBACdruB,SAASquB,uBAEJruB,SAASsuB,kBACdtuB,SAASsuB,mBAlBL/uB,EAAQgvB,kBACRhvB,EAAQgvB,oBAEHhvB,EAAQivB,wBACbjvB,EAAQivB,0BAEHjvB,EAAQkvB,qBACblvB,EAAQkvB,qBAapB,CAIA,SAASC,IACL5B,EAAatqD,SAAWw9B,SAAS2uB,mBAC7B3uB,SAAS4uB,yBACT5uB,SAAS6uB,oBACjB,CAyHA,OAlVA,IAAAnuB,OAAM,IAAMJ,EAAUtjB,KAAMoB,IACR,SAAZA,GAAsBm9B,EAAe/4C,QACrC+4C,EAAe/4C,OAAQ,MA2R/B,IAAA+7B,WAAU,KAENl+B,QAAQC,IAAI,8BAEZ0/B,SAASwrB,iBAAiB,mBAAoBkD,GAC9C1uB,SAASwrB,iBAAiB,yBAA0BkD,GACpD1uB,SAASwrB,iBAAiB,qBAAsBkD,GAGhDvhC,QAAQ,oBAAqB5pB,UACzBlD,QAAQC,IAAI,yCACZ,IAEI,MAAM,qBAAEwS,SAA+B,4CACjCA,EAAqBc,oBAE3B,MAAM,oBAAE5M,SAA8B,qCAChC0M,GAAiB,SACvB,GAAIA,EAAe1R,OAAQ,OAEFgF,EAAoBuC,SAOrClJ,QAAQC,IAAI,mCALZD,QAAQC,IAAI,uCACN0G,EAAoBC,YAAYyM,EAAe1R,QACrD3B,QAAQC,IAAI,8BAKpB,CACJ,CACA,MAAOK,GACHN,QAAQM,MAAM,6BAA8BA,GAC5C6D,OAAO7D,MAAM,mBACjB,CACA,QAE2B,aAAnB2/B,EAAUtjB,MACVsjB,EAAU1d,QAAQ,OAE1B,IAEJviB,QAAQC,IAAI,sCAEZ2lC,WAAW,MA5Gf1iC,iBACI,IACIlD,QAAQC,IAAI,4BAEZD,QAAQC,IAAI,2CACNwD,EAAW,WAAA3D,aAEjBE,QAAQC,IAAI,kCACZyzB,EAAc5zB,aACd4zB,EAAcY,sBAEdt0B,QAAQC,IAAI,uCACNoT,EAAepQ,cACrBjD,QAAQC,IAAI,sCAAuCoT,EAAepR,WAElEjC,QAAQC,IAAI,wCACNggC,EAAUngC,aAEhBE,QAAQC,IAAI,0CACNwsB,EAAA,EAAsB3sB,aAC5B2sB,EAAA,EAAsBI,iBAEtB7sB,QAAQC,IAAI,oCACZ,MAAM,mBAAEoe,SAA6B,sCACrCA,EAAmBve,aAEnBE,QAAQC,IAAI,uCACZ,MAAM,iBAAEuf,SAA2B,4CAC7BA,EAAiB1f,aAEvBE,QAAQC,IAAI,mCACZ,MAAM,iBAAE0oB,SAA2B,4CAC7BA,EAAiB7oB,aAEvBE,QAAQC,IAAI,mCACZ,IACI,MAAM,kBAAEiL,SAA4B,sCAC9B+gB,EAAiB/gB,UACjB+gB,EAAetf,iBACrB3M,QAAQC,IAAI,4BAChB,CACA,MAAOK,GACHN,QAAQM,MAAM,6BAA8BA,EAEhD,CAEAN,QAAQC,IAAI,sCACZ,MAAM,qBAAEwS,SAA+B,4CACfA,EAAqBM,qBAEzC/S,QAAQC,IAAI,wCAGZD,QAAQC,IAAI,gCAEhBD,QAAQC,IAAI,2BACZkE,OAAOI,QAAQ,aACnB,CACA,MAAOjE,GACHN,QAAQM,MAAM,2BAA4BA,GAC1C6D,OAAO7D,MAAM,gBACjB,CACJ,CA+CQR,IACD,MAEP,IAAAihC,iBAAgB,KACZpB,SAAS0rB,oBAAoB,mBAAoBgD,GACjD1uB,SAAS0rB,oBAAoB,yBAA0BgD,GACvD1uB,SAAS0rB,oBAAoB,qBAAsBgD,KAEhD,CAAClwB,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,oDACpB,wBAAoB,MAAO,GAAY,EACnC,iBAAaqwB,GAAY,CAAE,iBAAkBtuB,EAAkBh+B,OAAS,KAAM,EAAe,CAAC,sBAElG,wBAAoB,oDACpB,wBAAoB,MAAO,GAAY,GAClC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYwqD,EAAcxqD,MAAQ+iC,KAC9E,kBAAc,iBAAawpB,GAAiB,CAChD3tC,IAAKmkB,EAAOz/B,YACZ,cAAey/B,GAChB,KAAM,EAAe,CAAC,kBACzB,SAER,wBAAoB,qDACpB,qBAAgB,wBAAoB,MAAO,GAAY,EACnD,wBAAoB,cACQ,UAA3B,WAAOjF,GAAWtjB,OACZ,kBAAc,wBAAoB,WAAW,CAAEoE,IAAK,GAAK,EACxD,wBAAoB,UACpB,qBAAgB,iBAAa4tC,GAAW,KAAM,KAAM,KAAuB,CACvE,CAAC,SAAQ,WAAOt7C,GAAgBpR,cAEpC,wBAAoB,UACpB,qBAAgB,iBAAa2sD,GAAa,CACtC5tB,QAAS,iBACTp/B,IAAK8qD,EACLmC,aAAcnB,GACf,KAAM,KAAuB,CAC5B,CAAC,SAASnB,EAAepqD,UAE9B,MACD,wBAAoB,QAAQ,IACnC,KAAuB,CACtB,CAAC,SAASqqD,EAASrqD,UAEvB,wBAAoB,yDACQ,YAA3B,WAAO89B,GAAWtjB,MAAsB6vC,EAASrqD,OAY5C,wBAAoB,QAAQ,KAX3B,kBAAc,wBAAoB,MAAO,CACxC4e,IAAK,EACLua,MAAO,gBACPgD,QAASyuB,GACV,EACC,wBAAoB,MAAO,CACvBzuB,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,iBAAa0wB,GAAa,CAAE9R,QAAS+P,UAIjD,wBAAoB,yDACQ,eAA3B,WAAO9sB,GAAWtjB,MAAyB6vC,EAASrqD,OAS/C,wBAAoB,QAAQ,KAR3B,kBAAc,wBAAoB,MAAO,GAAY,EACpD,wBAAoB,MAAO,CACvBm5B,MAAO,sBACPgD,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,iBAAa2wB,GAAe,CAAE/R,QAASwQ,UAInD,wBAAoB,2DACQ,cAA3B,WAAOvtB,GAAWtjB,MAAwB6vC,EAASrqD,OAY9C,wBAAoB,QAAQ,KAX3B,kBAAc,wBAAoB,MAAO,GAAY,EACpD,wBAAoB,MAAO,CACvBm8B,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,iBAAa6e,GAAkB,CAC3B,kBAAkB,EAClB,iBAAkB,SAClBC,UAAW7B,UAK3B,wBAAoB,yDACnByQ,EAAiB,QACX,kBAAc,iBAAakD,GAAc,CACxCjuC,IAAK,EACLkuC,kBAAmB1D,EACnB2D,WAAYxD,MAEd,wBAAoB,QAAQ,IAClC,wBAAoB,wDAClBc,EAASrqD,OAAoC,UAA3B,WAAO89B,GAAWtjB,MAsDhC,wBAAoB,QAAQ,KArD3B,kBAAc,wBAAoB,MAAO,GAAY,EACpD,wBAAoB,SAAU,CAC1B2e,OAAO,oBAAgB,CAAC,cAAe,CAAE+C,OAAQ0tB,EAAmB5pD,SACpEy8B,MAAO,OACPN,QAASsuB,GACV,OAAQ,IACX,wBAAoB,6BACpB,wBAAoB,SAAU,CAC1BtxB,OAAO,oBAAgB,CAAC,cAAe,CAAE+C,OAAQ8tB,EAAsBhqD,SACvEy8B,MAAO,QACPN,QAAS4uB,GACV,OAAQ,IACX,wBAAoB,SAAU,CAC1B5xB,OAAO,oBAAgB,CAAC,cAAe,CAAE+C,OAAQ+tB,EAAmBjqD,SACpEy8B,MAAO,OACPN,QAAS8uB,GACV,OAAQ,IACX,wBAAoB,SAAU,CAC1B9xB,OAAO,oBAAgB,CAAC,cAAe,CAAE+C,OAAmC,eAA3B,WAAO4B,GAAWtjB,QACnEiiB,MAAO,KACPN,QAASivB,GACV,OAAQ,IACX,wBAAoB,SAAU,CAC1BjyB,OAAO,oBAAgB,CAAC,cAAe,CAAE+C,OAAQ2tB,EAAe7pD,SAChEy8B,MAAO,MACPN,QAASuuB,GACV,OAAQ,IACX,wBAAoB,SAAU,CAC1BvxB,OAAO,oBAAgB,CAAC,cAAe,CAAE+C,OAAmC,YAA3B,WAAO4B,GAAWtjB,QACnEiiB,MAAO,OACPN,QAASwuB,GACV,OAAQ,IACX,wBAAoB,SAAU,CAC1BxxB,OAAO,oBAAgB,CAAC,cAAe,CAAE+C,OAAQ4tB,EAAa9pD,SAC9Dy8B,MAAO,KACPN,QAAS0uB,GACV,MAAO,IACV,wBAAoB,SAAU,CAC1B1xB,OAAO,oBAAgB,CAAC,cAAe,CAAE+C,OAAQ6tB,EAAc/pD,SAC/Dy8B,MAAO,KACPN,QAAS2uB,GACV,KAAM,IACT,wBAAoB,SAAU,CAC1B3xB,OAAO,oBAAgB,CAAC,cAAe,CAAE+C,OAAQguB,EAAclqD,SAC/Dy8B,MAAO,SACPN,QAAS+uB,GACV,OAAQ,IACX,wBAAoB,SAAU,CAC1B/xB,OAAO,oBAAgB,CAAC,cAAe,CAAE+C,OAAQiuB,EAAcnqD,SAC/Dy8B,MAAO,OACPN,QAASgvB,GACV,OAAQ,OAGnB,wBAAoB,qBACpB,wBAAoB,SAAU,CAC1BhyB,OAAO,oBAAgB,CAAC,gBAAiB,CAAE,YAAakxB,EAASrqD,SACjEy8B,MAAO4tB,EAASrqD,MAAQ,OAAS,OACjCm8B,QAASsvB,IACV,qBAAiBpB,EAASrqD,MAAQ,MAAQ,MAAO,GAA6B,KACjF,wBAAoB,kBAClBqqD,EAASrqD,OAAoC,UAA3B,WAAO89B,GAAWtjB,MAOhC,wBAAoB,QAAQ,KAN3B,kBAAc,wBAAoB,SAAU,CAC3CoE,IAAK,EACLua,OAAO,oBAAgB,CAAC,sBAAuB,CAAE+C,QAASkuB,EAAepqD,SACzEy8B,MAAO2tB,EAAepqD,MAAQ,QAAU,QACxCm8B,QAASqvB,GACV,OAAQ,GAAuB,MAEtC,wBAAoB,eAClBnB,EAASrqD,OAAoC,eAA3B,WAAO89B,GAAWtjB,MAOhC,wBAAoB,QAAQ,KAN3B,kBAAc,wBAAoB,SAAU,CAC3CoE,IAAK,EACLua,MAAO,iBACPsD,MAAO6tB,EAAatqD,MAAQ,OAAS,OACrCm8B,QAASuvB,IACV,qBAAiBpB,EAAatqD,MAAQ,KAAO,KAAM,EAAqB,MAE/E,wBAAoB,eACnB4pD,EAAmB5pD,QAAUqqD,EAASrqD,QAChC,kBAAc,wBAAoB,MAAO,CACxC4e,IAAK,EACLua,MAAO,gBACPgD,QAASsuB,GACV,EACC,wBAAoB,MAAO,CACvBtuB,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,iBAAa+wB,GAAgB,CACzBnS,QAAS4P,EACTwC,OAAQ3B,UAIlB,wBAAoB,QAAQ,IAClC,wBAAoB,gBACnBxS,EAAqB94C,QAAUqqD,EAASrqD,QAClC,kBAAc,wBAAoB,MAAO,GAAa,EACrD,wBAAoB,MAAO,CACvBm8B,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,iBAAa6e,GAAkB,CAC3B,kBAAkB,EAClB,iBAAkB5a,EAAiBlgC,OAAOpB,MAAQ,SAClD,oBAAqBshC,EAAiBlgC,MACtC+6C,UAAW7B,GACZ,KAAM,EAAe,CAAC,iBAAkB,4BAGjD,wBAAoB,QAAQ,IAClC,wBAAoB,cACnB2Q,EAAe7pD,QAAUqqD,EAASrqD,QAC5B,kBAAc,wBAAoB,MAAO,CACxC4e,IAAK,EACLua,MAAO,gBACPgD,QAASuuB,GACV,EACC,wBAAoB,MAAO,CACvBvuB,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,iBAAaixB,GAAY,CAAErS,QAAS6P,UAG1C,wBAAoB,QAAQ,IAClC,wBAAoB,eACnBZ,EAAa9pD,QAAUqqD,EAASrqD,QAC1B,kBAAc,wBAAoB,MAAO,CACxC4e,IAAK,GACLua,MAAO,gBACPgD,QAAS0uB,GACV,EACC,wBAAoB,MAAO,CACvB1uB,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,iBAAakxB,UAGnB,wBAAoB,QAAQ,IAClC,wBAAoB,eACnBpD,EAAc/pD,QAAUqqD,EAASrqD,QAC3B,kBAAc,wBAAoB,MAAO,CACxC4e,IAAK,GACLua,MAAO,gBACPgD,QAAS2uB,GACV,EACC,wBAAoB,MAAO,CACvB3uB,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,iBAAamxB,GAAgB,CAAEvS,QAASiQ,UAG9C,wBAAoB,QAAQ,IAClC,wBAAoB,gBACnBd,EAAsBhqD,QAAUqqD,EAASrqD,QACnC,kBAAc,wBAAoB,MAAO,CACxC4e,IAAK,GACLua,MAAO,gBACPgD,QAAS4uB,GACV,EACC,wBAAoB,MAAO,CACvB5uB,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,iBAAaoxB,GAAmB,CAAExS,QAASkQ,UAGjD,wBAAoB,QAAQ,IAClC,wBAAoB,eACnBd,EAAmBjqD,QAAUqqD,EAASrqD,QAChC,kBAAc,wBAAoB,MAAO,CACxC4e,IAAK,GACLua,MAAO,gBACPgD,QAAS8uB,GACV,EACC,wBAAoB,MAAO,CACvB9uB,QAASF,EAAO,KAAOA,EAAO,IAAK,mBAAe,OAAW,CAAC,WAC/D,EACC,iBAAaqxB,GAAgB,CAAEzS,QAASoQ,UAG9C,wBAAoB,QAAQ,IAClC,wBAAoB,mBACnBf,EAAclqD,QAAUqqD,EAASrqD,QAC3B,kBAAc,wBAAoB,MAAO,CACxC4e,IAAK,GACLua,MAAO,gBACPgD,QAAS+uB,GACV,EACC,wBAAoB,MAAO,CACvB/uB,QAASF,EAAO,MAAQA,EAAO,KAAM,mBAAe,OAAW,CAAC,WACjE,EACC,iBAAasxB,GAAgB,CAAE1S,QAASqQ,UAG9C,wBAAoB,QAAQ,IAClC,wBAAoB,iBACnBf,EAAcnqD,QAAUqqD,EAASrqD,QAC3B,kBAAc,wBAAoB,MAAO,CACxC4e,IAAK,GACLua,MAAO,gBACPgD,QAASgvB,GACV,EACC,wBAAoB,MAAO,CACvBhvB,QAASF,EAAO,MAAQA,EAAO,KAAM,mBAAe,OAAW,CAAC,WACjE,EACC,iBAAauxB,GAAW,CAAE3S,QAASsQ,UAGzC,wBAAoB,QAAQ,IAClC,wBAAoB,wBACnBpS,EAAe/4C,QAAUqqD,EAASrqD,OAAoC,UAA3B,WAAO89B,GAAWtjB,OACvD,kBAAc,iBAAaogC,GAAY,CACtCh8B,IAAK,GACLi8B,QAASmQ,MAEX,wBAAoB,QAAQ,IAClC,wBAAoB,yBAClBX,EAASrqD,OAAoC,UAA3B,WAAO89B,GAAWtjB,MAOhC,wBAAoB,QAAQ,KAN3B,kBAAc,wBAAoB,SAAU,CAC3CoE,IAAK,GACLua,OAAO,oBAAgB,CAAC,kBAAmB,CAAE+C,OAAQ6c,EAAe/4C,SACpEy8B,MAAO,OACPN,QAAS6uB,GACV,OAAQ,MAI3B,ICptBJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAE7xB,MAAO,sBACtB,GAAa,CACfva,IAAK,EACLua,MAAO,mBAEL,GAAa,CAAEA,MAAO,mBACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CAAEA,MAAO,iBAI5B,IAA6B,qBAAiB,CAC1C2B,OAAQ,MACR,KAAAE,CAAMC,GACF,MAAMmmB,GAAY,IAAA3hD,MAAI,GAChBguD,GAAW,IAAAhuD,MAAI,GACfoL,GAAe,IAAApL,KAAI,IACnBiuD,GAAiB,IAAAjuD,KAAI,YAE3BsB,eAAepD,IACXyjD,EAAUphD,OAAQ,EAClBytD,EAASztD,OAAQ,EACjB6K,EAAa7K,MAAQ,GACrB,IACI0tD,EAAe1tD,MAAQ,gBACvBnC,QAAQC,IAAI,kBAEZD,QAAQC,IAAI,iBACZsjD,EAAUphD,OAAQ,CACtB,CACA,MAAO7B,GACHN,QAAQM,MAAM,iBAAkBA,GAChCsvD,EAASztD,OAAQ,EACjB6K,EAAa7K,MAAQ7B,aAAiBoE,MAAQpE,EAAMmH,QAAU,OAC9DtD,OAAO7D,MAAM,WACbijD,EAAUphD,OAAQ,CACtB,CACJ,CACA,SAAS2tD,IACLhwD,GACJ,CAKA,OAHA,IAAAo+B,WAAU,KACNp+B,MAEG,CAACq+B,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,EACzD,wBAAoB,UACnBmlB,EAAe,QACT,kBAAc,wBAAoB,MAAO,GAAY,EACpD,wBAAoB,MAAO,GAAY,CACnCnlB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAE9C,MAAO,mBAAqB,MAAO,KAC1F,wBAAoB,IAAK,MAAM,qBAAiBu0B,EAAe1tD,OAAQ,QAG5EytD,EAAc,QACV,kBAAc,wBAAoB,WAAW,CAAE7uC,IAAK,GAAK,EACxD,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,GAAY,CACnCqd,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,KAAM,YAAa,KACvE,wBAAoB,IAAK,MAAM,qBAAiBpxB,EAAa7K,OAAQ,IACrE,wBAAoB,SAAU,CAC1Bm5B,MAAO,eACPgD,QAASwxB,GACV,WAGZ,SACA,kBAAc,wBAAoB,WAAW,CAAE/uC,IAAK,GAAK,EACxD,wBAAoB,WACpB,iBAAagvC,KACd,SAGvB,ICrEJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCKvE75B,OAAOi1B,iBAAiB,QAAS3kD,IAC/BxG,QAAQM,MAAM,QAASkG,EAAMlG,OAC7B,UAAa,iBA+Df6yC,EAAE,KACAnzC,QAAQC,IAAI,mBACZD,QAAQC,IAAI,eAAe,IAAIyQ,MAAOitC,kBA3DxC,WACE,IACE39C,QAAQC,IAAI,wBAGZ,MAAM+vD,EAAY7c,EAAE,OAAQjd,OAAO5e,OAAOqoB,UAE1C3/B,QAAQC,IAAI,WAAY+vD,EAAU/uD,OAAQ,OAE1C,IAAIgvD,EAAc,EAGlBD,EAAUE,KAAK,CAACxkD,EAAOwzB,KACrB,MAAMixB,EAAWhd,EAAEjU,GAGbkxB,EAAQD,EAAS1jB,KAAK,SAE5BzsC,QAAQC,IAAI,YAAYyL,YAAgB0kD,KAG1B,MAAVA,QAA2BvuD,IAAVuuD,GACnBD,EAASE,SAAS,2BAA2BC,OAC7CL,IACAjwD,QAAQC,IAAI,qBAAqBmwD,MAEjCpwD,QAAQC,IAAI,qBAAqBmwD,eAIrCpwD,QAAQC,IAAI,YAAagwD,EAAa,mBACxC,CAAE,MAAO3vD,GACPN,QAAQM,MAAM,gBAAiBA,EACjC,CACF,CA4BEiwD,GAGAvwD,QAAQC,IAAI,2BACZ6c,sBAAsB,OACnB4V,KAAKxvB,UACJlD,QAAQC,IAAI,uBAGZD,QAAQC,IAAI,sBACZquC,GAAcE,uBACdxuC,QAAQC,IAAI,qBAGZD,QAAQC,IAAI,4BACNwsB,EAAA,EAAsB3sB,aAC5B2sB,EAAA,EAAsBI,iBACtB7sB,QAAQC,IAAI,mBAGZD,QAAQC,IAAI,0BACN0oB,GAAiB,iBAAA7oB,aACvBE,QAAQC,IAAI,iBAGZD,QAAQC,IAAI,2BACZ,UACQ43B,EAAqB/3B,aAC3BE,QAAQC,IAAI,sBACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,yBAA0BA,GACxCN,QAAQM,MAAM,cAAeA,GAC7B,YAAe,4BAEjB,CAGAN,QAAQC,IAAI,sBACZ,MAAMuwD,GAAS,IAAAC,WAAUC,IAGzB1wD,QAAQC,IAAI,0BACZ,MAAM0wD,GAAQ,IAAAC,eACdJ,EAAOK,IAAIF,GAGX3wD,QAAQC,IAAI,4BACZuwD,EAAOM,MAAM,QAEb9wD,QAAQC,IAAI,2BACZ,YAAe,YAGf,MAAM8wD,EAAUzjD,YAAYumB,mBAC5B7zB,QAAQC,IAAI,iBAAkB8wD,GAC9B/wD,QAAQC,IAAI,wBAEZ6sB,QAAQyH,cAAcC,aAAcw8B,IAClChxD,QAAQC,IAAI,mBACZD,QAAQC,IAAI,gBAAiB8wD,GAC7B/wD,QAAQC,IAAI,gBAAiB+wD,GAEzBD,IAAYC,IACdhxD,QAAQC,IAAI,6BACZ,SAAY,qBACZi2B,OAAOvc,SAASpY,YAIpBvB,QAAQC,IAAI,yBAEbgxD,MAAM3wD,IACLN,QAAQM,MAAM,mBAAoBA,GAClCN,QAAQM,MAAM,cAAe,CAC3BmH,QAASnH,EAAMmH,QACfE,MAAOrH,EAAMqH,MACbrE,KAAMhD,EAAMgD,OAEd,UAAa,mCAKnB6vC,EAAEjd,QAAQg7B,GAAG,WAAYhuD,UACvBlD,QAAQC,IAAI,kBACZD,QAAQC,IAAI,eAAe,IAAIyQ,MAAOitC,kBAGtC,IACE39C,QAAQC,IAAI,gCACN43B,EAAqB4C,UAC3Bz6B,QAAQC,IAAI,sBACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,wBAAyBA,EAEzC,EAtHF,WACE,IACEN,QAAQC,IAAI,uBAGZ,MAAMkxD,EAAkBhe,EAAE,2BAA4Bjd,OAAO5e,OAAOqoB,UAEpE3/B,QAAQC,IAAI,WAAYkxD,EAAgBlwD,OAAQ,WAGhDkwD,EAAgBC,YAAY,2BAA2BzG,OAEvD3qD,QAAQC,IAAI,oBACd,CAAE,MAAOK,GACPN,QAAQM,MAAM,gBAAiBA,EACjC,CACF,CAyGE+wD,GAEArxD,QAAQC,IAAI,0BACZ,SAAY","sources":["src://tavern_helper_template/webpack/runtime/create fake namespace object","src://tavern_helper_template/external module \"https://testingcf.jsdelivr.net/npm/klona/+esm\"","src://tavern_helper_template/external module \"https://testingcf.jsdelivr.net/npm/pinia/+esm\"","src://tavern_helper_template/src//services/worldBookService.ts","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src//stores/characterStore.ts","src://tavern_helper_template/src//services/realWorldMapService.ts","src://tavern_helper_template/src//stores/inventoryStore.ts","src://tavern_helper_template/src//utils/aiServiceDiagnostics.ts","src://tavern_helper_template/src//stores/instanceStore.ts","src://tavern_helper_template/src//utils/protagonistValidator.ts","src://tavern_helper_template/src//services/characterInitializer.ts","src://tavern_helper_template/src//services/areaDetailsService.ts","src://tavern_helper_template/src//types/schemas.ts","src://tavern_helper_template/src//services/mvuService.ts","src://tavern_helper_template/src//services/eventRecordService.ts","src://tavern_helper_template/external import \"https://testingcf.jsdelivr.net/npm/klona/+esm\"","src://tavern_helper_template/src//services/apiConfigService.ts","src://tavern_helper_template/external var \"_\"","src://tavern_helper_template/src//stores/gameStore.ts","src://tavern_helper_template/external var \"toastr\"","src://tavern_helper_template/src//utils/coc7Rules.ts","src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src//utils/apiContext.ts","src://tavern_helper_template/src//services/sanctuaryService.ts","src://tavern_helper_template/src//utils/validators.ts","src://tavern_helper_template/src//services/gameResetService.ts","src://tavern_helper_template/external var \"YAML\"","src://tavern_helper_template/src//services/memoryFragmentService.ts","src://tavern_helper_template/src//services/npcGenerationService.ts","src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/src//services/npcGenerationCoordinator.ts","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/webpack/runtime/make namespace object","src://tavern_helper_template/src//services/tavernService.ts","src://tavern_helper_template/src//services/apiAutoSwitchService.ts","webpack://tavern_helper_template/./src//components/APIConfigPanel.vue?41ff","webpack://tavern_helper_template/src//components/APIConfigPanel.vue?4c16","src://tavern_helper_template/src//utils/animation.ts","webpack://tavern_helper_template/./src//components/Background.vue?b770","webpack://tavern_helper_template/src//components/Background.vue?3120","webpack://tavern_helper_template/./src//components/CharacterCreator.vue?810e","webpack://tavern_helper_template/src//components/CharacterCreator.vue?f6e0","webpack://tavern_helper_template/./src//components/CharacterPanel.vue?0788","webpack://tavern_helper_template/src//components/CharacterPanel.vue?87b6","webpack://tavern_helper_template/./src//components/CharacterSprite.vue?0ca3","webpack://tavern_helper_template/src//components/CharacterSprite.vue?f8a5","src://tavern_helper_template/src//services/coc7Service.ts","src://tavern_helper_template/src//stores/combatStore.ts","webpack://tavern_helper_template/./src//components/CombatPanel.vue?c1c4","webpack://tavern_helper_template/src//components/CombatPanel.vue?de05","src://tavern_helper_template/src//services/npcAnalysisService.ts","src://tavern_helper_template/src//services/npcAppearanceService.ts","src://tavern_helper_template/src//services/streamService.ts","src://tavern_helper_template/src//utils/textParser.ts","webpack://tavern_helper_template/./src//components/DialogueBox.vue?d57e","webpack://tavern_helper_template/src//components/DialogueBox.vue?f340","webpack://tavern_helper_template/./src//components/DiceRoller.vue?6749","webpack://tavern_helper_template/src//components/DiceRoller.vue?5027","webpack://tavern_helper_template/./src//components/InstanceGenerator.vue?dfae","webpack://tavern_helper_template/src//components/InstanceGenerator.vue?6f90","src://tavern_helper_template/src//services/storyReviewService.ts","webpack://tavern_helper_template/./src//components/PlotReview.vue?96a2","webpack://tavern_helper_template/src//components/PlotReview.vue?6a07","webpack://tavern_helper_template/./src//components/InstanceRecord.vue?2c90","webpack://tavern_helper_template/src//components/InstanceRecord.vue?7511","webpack://tavern_helper_template/./src//components/InventoryPanel.vue?421d","webpack://tavern_helper_template/src//components/InventoryPanel.vue?adc7","webpack://tavern_helper_template/./src//components/AreaDetailsModal.vue?51d3","webpack://tavern_helper_template/src//components/AreaDetailsModal.vue?51d7","webpack://tavern_helper_template/./src//components/MapPanel.vue?d01d","webpack://tavern_helper_template/src//components/MapPanel.vue?c7f5","src://tavern_helper_template/src//services/journalService.ts","webpack://tavern_helper_template/./src//components/JournalView.vue?c8df","webpack://tavern_helper_template/src//components/JournalView.vue?fcf8","webpack://tavern_helper_template/./src//components/SanctuaryView.vue?11f9","webpack://tavern_helper_template/src//components/SanctuaryView.vue?72d3","webpack://tavern_helper_template/./src//components/StatusBar.vue?f0ac","webpack://tavern_helper_template/src//components/StatusBar.vue?5253","src://tavern_helper_template/src//services/integrationTestService.ts","webpack://tavern_helper_template/./src//components/TestPanel.vue?2054","webpack://tavern_helper_template/src//components/TestPanel.vue?5ae6","webpack://tavern_helper_template/./src//components/ConfirmDialog.vue?431f","webpack://tavern_helper_template/src//components/ConfirmDialog.vue?2dcb","webpack://tavern_helper_template/./src//components/WelcomeModal.vue?8dc1","webpack://tavern_helper_template/src//components/WelcomeModal.vue?4065","webpack://tavern_helper_template/./src//components/MainInterface.vue?3281","webpack://tavern_helper_template/src//components/MainInterface.vue?2649","webpack://tavern_helper_template/./src//app.vue?a691","webpack://tavern_helper_template/src//app.vue?1bc5","src://tavern_helper_template/src//index.ts"],"sourcesContent":["var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; (typeof current == 'object' || typeof current == 'function') && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","var x = (y) => {\n\tvar x = {}; __webpack_require__.d(x, y); return x\n} \nvar y = (x) => (() => (x))\nmodule.exports = x({ [\"klona\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_klona_esm_74666e88__.klona) });","var x = (y) => {\n\tvar x = {}; __webpack_require__.d(x, y); return x\n} \nvar y = (x) => (() => (x))\nmodule.exports = x({ [\"createPinia\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_pinia_esm_b723a504__.createPinia), [\"defineStore\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_pinia_esm_b723a504__.defineStore) });","/**\n * \n * \n */\n\nimport type { WorldType } from './apiConfigService';\n\n/**\n * \n * \n */\nclass WorldBookService {\n  private initialized = false;\n  private currentWorld: WorldType = 'realWorld';\n  private worldbookName: string | null = null;\n\n  /**\n   * \n   * \n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      console.log('[WorldBookService] ');\n      return;\n    }\n\n    try {\n      console.log('[WorldBookService] ...');\n\n      // \n      const charWorldbooks = getCharWorldbookNames('current');\n\n      if (charWorldbooks.primary) {\n        this.worldbookName = charWorldbooks.primary;\n        console.log('[WorldBookService] :', this.worldbookName);\n      } else {\n        console.warn('[WorldBookService] ');\n        this.worldbookName = null;\n      }\n\n      this.initialized = true;\n      console.log('[WorldBookService] ');\n    } catch (error) {\n      console.error('[WorldBookService] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   *  constant selective\n   */\n  async activateRealWorldEntries(): Promise<void> {\n    try {\n      if (!this.worldbookName) {\n        console.warn('[WorldBookService] ');\n        return;\n      }\n\n      console.log('[WorldBookService] ...');\n\n      // \n      const worldbook = await getWorldbook(this.worldbookName);\n\n      // \n      const updatedWorldbook = worldbook.map(entry => {\n        //  extra \n        const worldType = entry.extra?.worldType as string | undefined;\n\n        if (worldType === 'realWorld') {\n          //  constant\n          return {\n            ...entry,\n            strategy: {\n              ...entry.strategy,\n              type: 'constant' as const,\n            },\n          };\n        } else if (worldType === 'innerWorld' || worldType === 'sanctuary') {\n          //  selective\n          return {\n            ...entry,\n            strategy: {\n              ...entry.strategy,\n              type: 'selective' as const,\n              keys: entry.strategy.keys.length > 0 ? entry.strategy.keys : ['__never_match__'], // \n            },\n          };\n        } else {\n          // \n          return entry;\n        }\n      });\n\n      // \n      await replaceWorldbook(this.worldbookName, updatedWorldbook);\n\n      this.currentWorld = 'realWorld';\n      console.log('[WorldBookService] ');\n    } catch (error) {\n      console.error('[WorldBookService] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   *  constant selective\n   */\n  async activateInnerWorldEntries(): Promise<void> {\n    try {\n      if (!this.worldbookName) {\n        console.warn('[WorldBookService] ');\n        return;\n      }\n\n      console.log('[WorldBookService] ...');\n\n      // \n      const worldbook = await getWorldbook(this.worldbookName);\n\n      // \n      const updatedWorldbook = worldbook.map(entry => {\n        //  extra \n        const worldType = entry.extra?.worldType as string | undefined;\n\n        if (worldType === 'innerWorld') {\n          //  constant\n          return {\n            ...entry,\n            strategy: {\n              ...entry.strategy,\n              type: 'constant' as const,\n            },\n          };\n        } else if (worldType === 'realWorld' || worldType === 'sanctuary') {\n          //  selective\n          return {\n            ...entry,\n            strategy: {\n              ...entry.strategy,\n              type: 'selective' as const,\n              keys: entry.strategy.keys.length > 0 ? entry.strategy.keys : ['__never_match__'], // \n            },\n          };\n        } else {\n          // \n          return entry;\n        }\n      });\n\n      // \n      await replaceWorldbook(this.worldbookName, updatedWorldbook);\n\n      this.currentWorld = 'innerWorld';\n      console.log('[WorldBookService] ');\n    } catch (error) {\n      console.error('[WorldBookService] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   *  constant selective\n   */\n  async activateInteractionRoomEntries(): Promise<void> {\n    try {\n      if (!this.worldbookName) {\n        console.warn('[WorldBookService] ');\n        return;\n      }\n\n      console.log('[WorldBookService] ...');\n\n      // \n      const worldbook = await getWorldbook(this.worldbookName);\n\n      // \n      const updatedWorldbook = worldbook.map(entry => {\n        //  extra \n        const worldType = entry.extra?.worldType as string | undefined;\n\n        if (worldType === 'sanctuary') {\n          //  constant\n          return {\n            ...entry,\n            strategy: {\n              ...entry.strategy,\n              type: 'constant' as const,\n            },\n          };\n        } else if (worldType === 'realWorld' || worldType === 'innerWorld') {\n          //  selective\n          return {\n            ...entry,\n            strategy: {\n              ...entry.strategy,\n              type: 'selective' as const,\n              keys: entry.strategy.keys.length > 0 ? entry.strategy.keys : ['__never_match__'], // \n            },\n          };\n        } else {\n          // \n          return entry;\n        }\n      });\n\n      // \n      await replaceWorldbook(this.worldbookName, updatedWorldbook);\n\n      this.currentWorld = 'sanctuary';\n      console.log('[WorldBookService] ');\n    } catch (error) {\n      console.error('[WorldBookService] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  getCurrentWorld(): WorldType {\n    return this.currentWorld;\n  }\n\n  /**\n   * \n   */\n  getWorldbookName(): string | null {\n    return this.worldbookName;\n  }\n\n  /**\n   * \n   * \n   */\n  async reload(): Promise<void> {\n    this.initialized = false;\n    await this.initialize();\n  }\n}\n\n// \nexport const worldBookService = new WorldBookService();\n","module.exports = Vue;","//  Store -  NPC \n\nimport { defineStore } from 'pinia';\nimport { computed, ref } from 'vue';\nimport { mvuService } from '../services/mvuService';\nimport type { Character, CharacterStatusUpdate, NPCCharacter, PlayerCharacter } from '../types/character';\n\n/**\n *  Store\n */\nexport const useCharacterStore = defineStore('character', () => {\n  // ====================  ====================\n  const player = ref<PlayerCharacter | undefined>(undefined);\n  const npcs = ref<Map<string, NPCCharacter>>(new Map());\n  const activeCharacters = ref<string[]>([]); //  ID\n\n  // ====================  ====================\n  const hasPlayer = computed(() => player.value !== undefined);\n\n  const npcList = computed(() => Array.from(npcs.value.values()));\n\n  const npcCount = computed(() => npcs.value.size);\n\n  const activeNPCs = computed(() => {\n    return activeCharacters.value.map(id => npcs.value.get(id)).filter((npc): npc is NPCCharacter => npc !== undefined);\n  });\n\n  const importantNPCs = computed(() => {\n    return npcList.value.filter(npc => npc.isImportant);\n  });\n\n  // ====================  ====================\n\n  /**\n   *  MVU \n   */\n  async function loadFromMVU(): Promise<void> {\n    try {\n      console.log('[Character Store]  MVU ...');\n\n      // \n      try {\n        const globalVars = getVariables({ type: 'global' });\n        if (globalVars.player_character) {\n          player.value = globalVars.player_character as PlayerCharacter;\n          console.log('[Character Store] :', player.value.name);\n        }\n      } catch (globalError) {\n        console.warn('[Character Store]  MVU :', globalError);\n      }\n\n      //  MVU \n      if (!player.value) {\n        const gameData = await mvuService.loadGameData();\n\n        // \n        if (gameData.characters.player) {\n          player.value = gameData.characters.player;\n          console.log('[Character Store]  MVU :', player.value.name);\n\n          // \n          try {\n            insertOrAssignVariables({ player_character: player.value }, { type: 'global' });\n            console.log('[Character Store] ');\n          } catch (syncError) {\n            console.warn('[Character Store] :', syncError);\n          }\n        }\n      }\n\n      //  NPC MVU\n      const gameData = await mvuService.loadGameData();\n      npcs.value.clear();\n      Object.entries(gameData.characters.npcs).forEach(([id, npc]) => {\n        npcs.value.set(id, npc);\n      });\n\n      console.log(`[Character Store]  ${npcs.value.size}  NPC`);\n    } catch (error) {\n      console.error('[Character Store] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  async function setPlayer(character: PlayerCharacter): Promise<void> {\n    try {\n      player.value = character;\n\n      //  MVU\n      await mvuService.saveCharacter(character);\n\n      // \n      try {\n        insertOrAssignVariables({ player_character: character }, { type: 'global' });\n        console.log('[Character Store] ');\n      } catch (globalError) {\n        console.warn('[Character Store] :', globalError);\n      }\n\n      console.log('[Character Store] :', character.name);\n      toastr.success(` ${character.name} `);\n    } catch (error) {\n      console.error('[Character Store] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  async function updatePlayer(updates: CharacterStatusUpdate): Promise<void> {\n    if (!player.value) {\n      throw new Error('');\n    }\n\n    try {\n      // \n      if (updates.attributes) {\n        Object.assign(player.value.attributes, updates.attributes);\n      }\n      if (updates.derivedStats) {\n        Object.assign(player.value.derivedStats, updates.derivedStats);\n      }\n      if (updates.bodyParts) {\n        player.value.bodyParts = updates.bodyParts;\n      }\n\n      //  MVU\n      await mvuService.updateCharacterStatus('player', updates);\n\n      // \n      try {\n        insertOrAssignVariables({ player_character: player.value }, { type: 'global' });\n        console.log('[Character Store] ');\n      } catch (globalError) {\n        console.warn('[Character Store] :', globalError);\n      }\n\n      console.log('[Character Store] ');\n    } catch (error) {\n      console.error('[Character Store] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   *  NPC\n   */\n  async function addNPC(npc: NPCCharacter): Promise<void> {\n    try {\n      npcs.value.set(npc.id, npc);\n      await mvuService.saveCharacter(npc);\n      console.log('[Character Store] NPC :', npc.name);\n      toastr.success(`NPC ${npc.name} `);\n    } catch (error) {\n      console.error('[Character Store]  NPC :', error);\n      toastr.error(' NPC ');\n      throw error;\n    }\n  }\n\n  /**\n   *  NPC \n   */\n  async function updateNPC(npcId: string, updates: CharacterStatusUpdate): Promise<void> {\n    const npc = npcs.value.get(npcId);\n    if (!npc) {\n      throw new Error(`NPC ${npcId} `);\n    }\n\n    try {\n      // \n      if (updates.attributes) {\n        Object.assign(npc.attributes, updates.attributes);\n      }\n      if (updates.derivedStats) {\n        Object.assign(npc.derivedStats, updates.derivedStats);\n      }\n      if (updates.bodyParts) {\n        npc.bodyParts = updates.bodyParts;\n      }\n      if (updates.affection !== undefined) {\n        npc.affection = updates.affection;\n      }\n\n      //  MVU\n      await mvuService.updateCharacterStatus(npcId, updates);\n      console.log(`[Character Store] NPC ${npc.name} `);\n    } catch (error) {\n      console.error(`[Character Store]  NPC ${npcId} :`, error);\n      toastr.error(' NPC ');\n      throw error;\n    }\n  }\n\n  /**\n   *  NPC\n   *  NPC \n   */\n  async function deleteNPC(npcId: string): Promise<void> {\n    const npc = npcs.value.get(npcId);\n    if (!npc) {\n      throw new Error(`NPC ${npcId} `);\n    }\n\n    try {\n      const npcName = npc.name;\n\n      // \n      npcs.value.delete(npcId);\n\n      // \n      activeCharacters.value = activeCharacters.value.filter(id => id !== npcId);\n\n      //  MVU \n      await mvuService.deleteNPC(npcId);\n\n      console.log(`[Character Store] NPC ${npcName} `);\n      toastr.info(`NPC ${npcName} `);\n    } catch (error) {\n      console.error(`[Character Store]  NPC ${npcId} :`, error);\n      toastr.error(' NPC ');\n      throw error;\n    }\n  }\n\n  /**\n   *  NPC\n   */\n  function getCharacter(characterId: string): Character | undefined {\n    if (characterId === 'player' || (player.value && player.value.id === characterId)) {\n      return player.value;\n    }\n    return npcs.value.get(characterId);\n  }\n\n  /**\n   * \n   * \n   */\n  function setActiveCharacters(characterIds: string[]): void {\n    activeCharacters.value = characterIds;\n    console.log('[Character Store] :', characterIds);\n  }\n\n  /**\n   * \n   */\n  function addActiveCharacter(characterId: string): void {\n    if (!activeCharacters.value.includes(characterId)) {\n      activeCharacters.value.push(characterId);\n      console.log(`[Character Store]  ${characterId} `);\n    }\n  }\n\n  /**\n   * \n   */\n  function removeActiveCharacter(characterId: string): void {\n    activeCharacters.value = activeCharacters.value.filter(id => id !== characterId);\n    console.log(`[Character Store]  ${characterId} `);\n  }\n\n  /**\n   *  NPC \n   */\n  async function updateAffection(npcId: string, affection: number): Promise<void> {\n    const npc = npcs.value.get(npcId);\n    if (!npc) {\n      throw new Error(`NPC ${npcId} `);\n    }\n\n    try {\n      //  0-100\n      const clampedAffection = Math.max(0, Math.min(100, affection));\n\n      npc.affection = clampedAffection;\n      await mvuService.updateCharacterStatus(npcId, { affection: clampedAffection });\n\n      console.log(`[Character Store] NPC ${npc.name} : ${clampedAffection}`);\n    } catch (error) {\n      console.error(`[Character Store]  NPC ${npcId} :`, error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   *  NPC \n   */\n  async function setNPCImportant(npcId: string, isImportant: boolean): Promise<void> {\n    const npc = npcs.value.get(npcId);\n    if (!npc) {\n      throw new Error(`NPC ${npcId} `);\n    }\n\n    try {\n      npc.isImportant = isImportant;\n      await mvuService.saveCharacter(npc);\n\n      const status = isImportant ? '' : '';\n      console.log(`[Character Store] NPC ${npc.name} ${status}`);\n      toastr.info(`${npc.name} ${status}`);\n    } catch (error) {\n      console.error(`[Character Store]  NPC ${npcId} :`, error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   *  NPC \n   */\n  async function addNPCEvent(npcId: string, event: string): Promise<void> {\n    const npc = npcs.value.get(npcId);\n    if (!npc) {\n      throw new Error(`NPC ${npcId} `);\n    }\n\n    try {\n      npc.events.push(event);\n      await mvuService.saveCharacter(npc);\n      console.log(`[Character Store] NPC ${npc.name} `);\n    } catch (error) {\n      console.error(`[Character Store]  NPC ${npcId} :`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  function reset(): void {\n    player.value = undefined;\n    npcs.value.clear();\n    activeCharacters.value = [];\n    console.log('[Character Store] ');\n  }\n\n  // ====================  ====================\n  return {\n    // \n    player,\n    npcs,\n    activeCharacters,\n\n    // \n    hasPlayer,\n    npcList,\n    npcCount,\n    activeNPCs,\n    importantNPCs,\n\n    // \n    loadFromMVU,\n    setPlayer,\n    updatePlayer,\n    addNPC,\n    updateNPC,\n    deleteNPC,\n    getCharacter,\n    setActiveCharacters,\n    addActiveCharacter,\n    removeActiveCharacter,\n    updateAffection,\n    setNPCImportant,\n    addNPCEvent,\n    reset,\n  };\n});\n","// \n\nimport type { PlayerCharacter } from '../types/character';\nimport type { Area, MapData } from '../types/instance';\nimport { withAPIContext } from '../utils/apiContext';\n\n/**\n * \n * \n */\nclass RealWorldMapService {\n  /**\n   * \n   * @param character \n   * @returns \n   */\n  async generateMap(character: PlayerCharacter): Promise<MapData> {\n    //  withAPIContext  sanctuary API\n    //  AI  API\n    return await withAPIContext('sanctuary', async () => {\n      try {\n        console.log('[RealWorldMapService] ...', character.name);\n        toastr.info('...');\n\n        //  AI \n        const prompt = `\n\n YAML \n\n\n- ${character.name}\n- ${character.age || ''}\n- ${character.occupation || ''}\n- ${character.background || ''}\n\n\n1.  \\`\\`\\`yaml \n2. id: home\n3. \n4.  3-5 \n5.  isDangerous  false\n\n\n\\`\\`\\`yaml\nstartArea: home\nareas:\n  - id: home\n    name: ${character.name}\n    description: \n    connectedAreas: [street]\n    isDangerous: false\n  - id: street\n    name: \n    description: \n    connectedAreas: [home, shop]\n    isDangerous: false\n  - id: shop\n    name: \n    description: 24\n    connectedAreas: [street]\n    isDangerous: false\nconnections:\n  - from: home\n    to: street\n  - from: street\n    to: shop\n\\`\\`\\`\n\n`;\n\n        //  generate  AI\n        console.log('[RealWorldMapService]  AI ...');\n        console.log('[RealWorldMapService] AI :', {\n          should_stream: false,\n          prompt_length: prompt.length,\n          character_name: character.name,\n          character_occupation: character.occupation || '',\n        });\n\n        let text: string;\n        try {\n          text = await generate({\n            user_input: prompt,\n            should_stream: false, // \n          });\n\n          console.log('[RealWorldMapService] AI ...');\n          console.log('[RealWorldMapService] AI :', text.length, '');\n          console.log('[RealWorldMapService] AI :', text);\n        } catch (apiError) {\n          console.error('[RealWorldMapService] API :', {\n            error: apiError instanceof Error ? apiError.message : String(apiError),\n            stack: apiError instanceof Error ? apiError.stack : undefined,\n          });\n\n          // API  catch \n          throw new Error(`API : ${apiError instanceof Error ? apiError.message : String(apiError)}`);\n        }\n\n        // \n        const result = await this.parseMapFromText(text, character);\n\n        // \n        console.log('[RealWorldMapService] ...');\n        await this.generateAreaDetails(result);\n\n        // \n        await this.saveMap(result);\n\n        console.log('[RealWorldMapService] ');\n        toastr.success('');\n\n        return result;\n      } catch (error) {\n        console.error('[RealWorldMapService] :', error);\n        console.error('[RealWorldMapService] :', {\n          message: error instanceof Error ? error.message : String(error),\n          stack: error instanceof Error ? error.stack : undefined,\n          character: character.name,\n        });\n        console.warn('[RealWorldMapService] AI ');\n\n        try {\n          // \n          console.log('[RealWorldMapService] : ');\n          const result = this.generateDefaultMap(character);\n          console.log('[RealWorldMapService] :', {\n            areas_count: result.areas.size,\n            startArea: result.startArea,\n            playerLocation: result.playerLocation,\n          });\n\n          // \n          console.log('[RealWorldMapService] ...');\n          await this.generateAreaDetails(result);\n\n          await this.saveMap(result);\n\n          console.log('[RealWorldMapService] ');\n          toastr.warning('AI ');\n\n          return result;\n        } catch (fallbackError) {\n          console.error('[RealWorldMapService] :', fallbackError);\n          console.error('[RealWorldMapService] :', {\n            message: fallbackError instanceof Error ? fallbackError.message : String(fallbackError),\n            stack: fallbackError instanceof Error ? fallbackError.stack : undefined,\n          });\n          toastr.error('');\n          throw fallbackError;\n        }\n      }\n    });\n  }\n\n  /**\n   * \n   * @param map \n   */\n  async saveMap(map: MapData): Promise<void> {\n    try {\n      console.log('[RealWorldMapService] ...');\n      //  Map \n      const serializedMap = {\n        areas: Array.from(map.areas.entries()).map(([, area]) => area),\n        connections: map.connections,\n        playerLocation: map.playerLocation,\n        startArea: map.startArea,\n      };\n\n      console.log('[RealWorldMapService] :', {\n        : serializedMap.areas.length,\n        : serializedMap.connections.length,\n        : serializedMap.playerLocation,\n        : serializedMap.startArea,\n      });\n\n      insertOrAssignVariables({ real_world_map: serializedMap }, { type: 'global' });\n      console.log('[RealWorldMapService]  ');\n    } catch (error) {\n      console.error('[RealWorldMapService]  :', error);\n      console.error('[RealWorldMapService] :', error instanceof Error ? error.message : String(error));\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @returns  null\n   */\n  async loadMap(): Promise<MapData | null> {\n    try {\n      const variables = getVariables({ type: 'global' });\n      const data = variables.real_world_map as any;\n\n      if (!data || !data.areas) {\n        console.log('[RealWorldMapService] ');\n        return null;\n      }\n\n      //  MapData \n      const areas = new Map<string, Area>();\n\n      const mapData: MapData = {\n        areas,\n        connections: data.connections || [],\n        playerLocation: data.playerLocation || data.startArea || 'home',\n        startArea: data.startArea || 'home',\n      };\n\n      console.log('[RealWorldMapService] ');\n      return mapData;\n    } catch (error) {\n      console.error('[RealWorldMapService] :', error);\n      return null;\n    }\n  }\n\n  /**\n   * \n   * @param areaId  ID\n   */\n  async updatePlayerLocation(areaId: string): Promise<void> {\n    try {\n      const map = await this.loadMap();\n      if (!map) {\n        throw new Error('');\n      }\n\n      if (!map.areas.has(areaId)) {\n        throw new Error(` ${areaId} `);\n      }\n\n      map.playerLocation = areaId;\n\n      // \n      const area = map.areas.get(areaId);\n      if (area) {\n        area.isDiscovered = true;\n      }\n\n      await this.saveMap(map);\n      console.log(`[RealWorldMapService] : ${areaId}`);\n    } catch (error) {\n      console.error('[RealWorldMapService] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @returns \n   */\n  async hasMap(): Promise<boolean> {\n    const map = await this.loadMap();\n    return map !== null;\n  }\n\n  /**\n   *  AI \n   * @param text AI \n   * @param character \n   * @returns \n   */\n  private async parseMapFromText(text: string, character: PlayerCharacter): Promise<MapData> {\n    const YAML = (await import('yaml')).default;\n\n    console.log('[RealWorldMapService] ==========  ==========');\n    console.log('[RealWorldMapService] :', text.length, '');\n\n    //  1:  YAML \n    console.log('[RealWorldMapService] ==========  1:  YAML  ==========');\n    const patterns = [\n      { regex: /```yaml\\n([\\s\\S]*?)\\n```/, name: '```yaml' },\n      { regex: /```yml\\n([\\s\\S]*?)\\n```/, name: '```yml' },\n      { regex: /```\\n([\\s\\S]*?)\\n```/, name: '```' },\n    ];\n\n    for (let i = 0; i < patterns.length; i++) {\n      const { regex, name } = patterns[i];\n      console.log(`[RealWorldMapService]  ${i + 1}: ${name}`);\n      const match = text.match(regex);\n      if (match) {\n        console.log(`[RealWorldMapService]   (: ${name})`);\n        console.log(`[RealWorldMapService] : ${match[1].length} `);\n        try {\n          const mapData = YAML.parse(match[1]);\n          console.log('[RealWorldMapService]  YAML ');\n          console.log('[RealWorldMapService] :', {\n            areas_count: mapData.areas?.length || 0,\n            startArea: mapData.startArea,\n            has_home: mapData.areas?.some((a: any) => a.id === 'home'),\n          });\n          if (this.validateMapData(mapData)) {\n            console.log('[RealWorldMapService]  ');\n            console.log('[RealWorldMapService] : AI ');\n            toastr.success('');\n            return this.buildMapData(mapData);\n          } else {\n            console.warn('[RealWorldMapService]  ');\n          }\n        } catch (e) {\n          console.warn(`[RealWorldMapService]  YAML :`, e instanceof Error ? e.message : String(e));\n          continue;\n        }\n      } else {\n        console.log(`[RealWorldMapService]  `);\n      }\n    }\n    console.log('[RealWorldMapService]  1 : ');\n\n    //  2: \n    console.log('[RealWorldMapService] ==========  2:  ==========');\n    try {\n      const mapData = YAML.parse(text);\n      console.log('[RealWorldMapService]  YAML ');\n      console.log('[RealWorldMapService] :', {\n        areas_count: mapData.areas?.length || 0,\n        startArea: mapData.startArea,\n        has_home: mapData.areas?.some((a: any) => a.id === 'home'),\n      });\n      if (this.validateMapData(mapData)) {\n        console.log('[RealWorldMapService]  ');\n        console.log('[RealWorldMapService] ==========  2  ==========');\n        console.log('[RealWorldMapService] : AI ');\n        toastr.success('');\n        return this.buildMapData(mapData);\n      } else {\n        console.warn('[RealWorldMapService]  ');\n      }\n    } catch (e) {\n      console.warn('[RealWorldMapService]  YAML :', e instanceof Error ? e.message : String(e));\n    }\n    console.log('[RealWorldMapService]  2 : ');\n\n    //  3: \n    console.warn('[RealWorldMapService] ==========  3: ==========');\n    console.warn('[RealWorldMapService]  AI ');\n    console.log('[RealWorldMapService] : AI ');\n    console.log('[RealWorldMapService] :', {\n      name: character.name,\n      occupation: character.occupation,\n      age: character.age,\n    });\n    console.log('[RealWorldMapService] : ');\n    toastr.warning('AI ');\n    return this.generateDefaultMap(character);\n  }\n\n  /**\n   *  YAML  MapData \n   * @param mapData  YAML \n   * @returns MapData \n   */\n  private buildMapData(mapData: any): MapData {\n    console.log('[RealWorldMapService]  MapData ...');\n\n    const areas = new Map<string, Area>();\n    const startArea = mapData.startArea || 'home';\n\n    if (mapData.areas && Array.isArray(mapData.areas)) {\n      mapData.areas.forEach((area: any) => {\n        areas.set(area.id, {\n          id: area.id,\n          name: area.name,\n          description: area.description,\n          background: area.background,\n          connectedAreas: area.connectedAreas || [],\n          isDiscovered: area.id === startArea, // \n          isDangerous: area.isDangerous || false,\n          relatedNPCs: area.relatedNPCs || [],\n        });\n      });\n    }\n\n    const result: MapData = {\n      areas,\n      connections: mapData.connections || [],\n      playerLocation: startArea,\n      startArea: startArea,\n    };\n\n    console.log('[RealWorldMapService] MapData ', areas.size, '');\n    return result;\n  }\n\n  /**\n   * \n   * @param mapData \n   * @returns \n   */\n  private validateMapData(mapData: any): boolean {\n    if (!mapData || typeof mapData !== 'object') {\n      console.warn('[RealWorldMapService] ');\n      return false;\n    }\n\n    if (!mapData.areas || !Array.isArray(mapData.areas)) {\n      console.warn('[RealWorldMapService]  areas ');\n      return false;\n    }\n\n    if (mapData.areas.length === 0) {\n      console.warn('[RealWorldMapService] areas ');\n      return false;\n    }\n\n    //  home \n    const hasHome = mapData.areas.some((area: any) => area.id === 'home');\n    if (!hasHome) {\n      console.warn('[RealWorldMapService]  home ');\n      return false;\n    }\n\n    // \n    for (const area of mapData.areas) {\n      if (!area.id || !area.name || !area.description) {\n        console.warn('[RealWorldMapService] :', area);\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * \n   * @param character \n   * @returns \n   */\n  private generateDefaultMap(character: PlayerCharacter): MapData {\n    console.log('[RealWorldMapService] ...');\n\n    const areas = new Map<string, Area>();\n\n    // \n    areas.set('home', {\n      id: 'home',\n      name: `${character.name}`,\n      description: `${character.name}`,\n      connectedAreas: ['street'],\n      isDiscovered: true,\n      isDangerous: false,\n      relatedNPCs: [],\n    });\n\n    // \n    areas.set('street', {\n      id: 'street',\n      name: '',\n      description: '',\n      connectedAreas: ['home', 'shop', 'park'],\n      isDiscovered: false,\n      isDangerous: false,\n      relatedNPCs: [],\n    });\n\n    // \n    areas.set('shop', {\n      id: 'shop',\n      name: '',\n      description: '24',\n      connectedAreas: ['street'],\n      isDiscovered: false,\n      isDangerous: false,\n      relatedNPCs: [],\n    });\n\n    // \n    areas.set('park', {\n      id: 'park',\n      name: '',\n      description: '',\n      connectedAreas: ['street'],\n      isDiscovered: false,\n      isDangerous: false,\n      relatedNPCs: [],\n    });\n\n    // \n    if (character.occupation && character.occupation !== '') {\n      console.log(`[RealWorldMapService]  (${character.occupation})`);\n      areas.set('work', {\n        id: 'work',\n        name: `${character.occupation}`,\n        description: `${character.name}`,\n        connectedAreas: ['street'],\n        isDiscovered: false,\n        isDangerous: false,\n        relatedNPCs: [],\n      });\n\n      // \n      const street = areas.get('street')!;\n      street.connectedAreas.push('work');\n    } else {\n      console.log('[RealWorldMapService] ');\n    }\n\n    const result = {\n      areas,\n      connections: this.generateConnections(areas),\n      playerLocation: 'home',\n      startArea: 'home',\n    };\n\n    console.log('[RealWorldMapService]  ', areas.size, '');\n    return result;\n  }\n\n  /**\n   * \n   * @param areas  Map\n   * @returns \n   */\n  private generateConnections(areas: Map<string, Area>): Array<{ from: string; to: string }> {\n    const connections: Array<{ from: string; to: string }> = [];\n\n    areas.forEach(area => {\n      area.connectedAreas.forEach(connectedId => {\n        // \n        const reverseExists = connections.some(c => c.from === connectedId && c.to === area.id);\n        if (!reverseExists) {\n          connections.push({ from: area.id, to: connectedId });\n        }\n      });\n    });\n\n    return connections;\n  }\n\n  /**\n   * \n   * @param mapData \n   */\n  private async generateAreaDetails(mapData: MapData): Promise<void> {\n    try {\n      const { areaDetailsService } = await import('./areaDetailsService');\n      const areas = Array.from(mapData.areas.values());\n\n      console.log(`[RealWorldMapService]  ${areas.length} `);\n      console.log('[RealWorldMapService] :', areas.map(a => a.name).join(', '));\n\n      let successCount = 0;\n      let failCount = 0;\n\n      // \n      for (let i = 0; i < areas.length; i++) {\n        const area = areas[i];\n        console.log(`[RealWorldMapService]  (${i + 1}/${areas.length}): ${area.name}`);\n\n        try {\n          const details = await areaDetailsService.generateDetails(area, true);\n          area.details = details;\n          successCount++;\n          console.log(`[RealWorldMapService]  ${area.name} `);\n        } catch (error) {\n          failCount++;\n          console.error(`[RealWorldMapService]  ${area.name} :`, {\n            error: error instanceof Error ? error.message : String(error),\n            area_id: area.id,\n          });\n          // \n        }\n      }\n\n      console.log('[RealWorldMapService] :', {\n        total: areas.length,\n        success: successCount,\n        failed: failCount,\n      });\n    } catch (error) {\n      console.error('[RealWorldMapService] :', {\n        error: error instanceof Error ? error.message : String(error),\n        stack: error instanceof Error ? error.stack : undefined,\n      });\n      // \n    }\n  }\n}\n\n// \nexport const realWorldMapService = new RealWorldMapService();\n","//  Store - \n\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\nimport type { Inventory, Item } from '../types/instance';\n\n/**\n *  Store\n */\nexport const useInventoryStore = defineStore('inventory', () => {\n  // ====================  ====================\n  const realWorldInventory = ref<Inventory>({ items: [] }); // \n  const instanceInventory = ref<Inventory>({ items: [] }); // \n\n  // ====================  ====================\n\n  /**\n   * \n   */\n  function addToRealWorld(item: Item): void {\n    realWorldInventory.value.items.push(item);\n    console.log(`[Inventory Store] : ${item.name}`);\n  }\n\n  /**\n   * \n   */\n  function addToInstance(item: Item): void {\n    instanceInventory.value.items.push(item);\n    console.log(`[Inventory Store] : ${item.name}`);\n  }\n\n  /**\n   * \n   */\n  function removeFromRealWorld(itemId: string): void {\n    const index = realWorldInventory.value.items.findIndex(item => item.id === itemId);\n    if (index !== -1) {\n      const item = realWorldInventory.value.items[index];\n      realWorldInventory.value.items.splice(index, 1);\n      console.log(`[Inventory Store] : ${item.name}`);\n    }\n  }\n\n  /**\n   * \n   */\n  function removeFromInstance(itemId: string): void {\n    const index = instanceInventory.value.items.findIndex(item => item.id === itemId);\n    if (index !== -1) {\n      const item = instanceInventory.value.items[index];\n      instanceInventory.value.items.splice(index, 1);\n      console.log(`[Inventory Store] : ${item.name}`);\n    }\n  }\n\n  /**\n   * \n   */\n  function clearInstanceInventory(): void {\n    const itemCount = instanceInventory.value.items.length;\n    instanceInventory.value.items = [];\n    console.log(`[Inventory Store]  ( ${itemCount} )`);\n  }\n\n  /**\n   * \n   */\n  function clearRealWorldInventory(): void {\n    const itemCount = realWorldInventory.value.items.length;\n    realWorldInventory.value.items = [];\n    console.log(`[Inventory Store]  ( ${itemCount} )`);\n    saveToGlobal();\n  }\n\n  /**\n   * \n   */\n  function clearAllInventories(): void {\n    const realWorldCount = realWorldInventory.value.items.length;\n    const instanceCount = instanceInventory.value.items.length;\n    const totalCount = realWorldCount + instanceCount;\n\n    realWorldInventory.value.items = [];\n    instanceInventory.value.items = [];\n\n    console.log(\n      `[Inventory Store]  (: ${realWorldCount} , : ${instanceCount} , : ${totalCount} )`,\n    );\n\n    saveToGlobal();\n  }\n\n  /**\n   * \n   */\n  function transferToRealWorld(itemIds: string[]): void {\n    itemIds.forEach(itemId => {\n      const item = instanceInventory.value.items.find(i => i.id === itemId);\n      if (item) {\n        addToRealWorld(item);\n        removeFromInstance(itemId);\n      }\n    });\n    console.log(`[Inventory Store] ${itemIds.length} `);\n  }\n\n  /**\n   * \n   */\n  async function saveToGlobal(): Promise<void> {\n    try {\n      const data = {\n        realWorldInventory: realWorldInventory.value,\n        instanceInventory: instanceInventory.value,\n      };\n      insertOrAssignVariables({ inventory: data }, { type: 'global' });\n      console.log('[Inventory Store] ');\n    } catch (error) {\n      console.error('[Inventory Store] :', error);\n      toastr.error('');\n    }\n  }\n\n  /**\n   * \n   */\n  async function loadFromGlobal(): Promise<void> {\n    try {\n      const variables = getVariables({ type: 'global' });\n      const data = variables.inventory as any;\n\n      if (data) {\n        if (data.realWorldInventory) {\n          realWorldInventory.value = data.realWorldInventory;\n        }\n        if (data.instanceInventory) {\n          instanceInventory.value = data.instanceInventory;\n        }\n        console.log('[Inventory Store] ');\n      }\n    } catch (error) {\n      console.error('[Inventory Store] :', error);\n    }\n  }\n\n  /**\n   *  store\n   */\n  function reset(): void {\n    realWorldInventory.value = { items: [] };\n    instanceInventory.value = { items: [] };\n    console.log('[Inventory Store] Store ');\n  }\n\n  // ====================  ====================\n  return {\n    // \n    realWorldInventory,\n    instanceInventory,\n\n    // \n    addToRealWorld,\n    addToInstance,\n    removeFromRealWorld,\n    removeFromInstance,\n    clearInstanceInventory,\n    clearRealWorldInventory,\n    clearAllInventories,\n    transferToRealWorld,\n    saveToGlobal,\n    loadFromGlobal,\n    reset,\n  };\n});\n","/**\n * AI \n *  AI \n */\n\n/**\n *  AI \n */\nexport async function testAIService(): Promise<{\n  success: boolean;\n  message: string;\n  details?: any;\n}> {\n  try {\n    console.log('[AI Diagnostics]  AI ...');\n\n    // \n    const testPrompt = '\"\"';\n\n    const response = await generate({\n      user_input: testPrompt,\n      should_stream: false,\n    });\n\n    console.log('[AI Diagnostics] AI :', response);\n\n    if (response && response.length > 0) {\n      return {\n        success: true,\n        message: 'AI ',\n        details: {\n          response: response.substring(0, 100),\n          length: response.length,\n        },\n      };\n    } else {\n      return {\n        success: false,\n        message: 'AI ',\n      };\n    }\n  } catch (error) {\n    console.error('[AI Diagnostics] AI :', error);\n\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    // \n    let diagnosis = '';\n    if (errorMessage.includes('500')) {\n      diagnosis = ' (500)\\n' + '- AI \\n' + '- API \\n' + '- ';\n    } else if (errorMessage.includes('404')) {\n      diagnosis = 'API  (404) API ';\n    } else if (errorMessage.includes('401') || errorMessage.includes('403')) {\n      diagnosis = ' API ';\n    } else if (errorMessage.includes('timeout')) {\n      diagnosis = '';\n    } else {\n      diagnosis = '';\n    }\n\n    return {\n      success: false,\n      message: `AI : ${errorMessage}`,\n      details: {\n        error: errorMessage,\n        diagnosis,\n      },\n    };\n  }\n}\n\n/**\n *  AI \n */\nexport function getAIConfigInfo(): {\n  model: string;\n  endpoint: string;\n  hasApiKey: boolean;\n} {\n  try {\n    //  SillyTavern \n    const chatSettings = SillyTavern.chatCompletionSettings;\n    const mainApi = SillyTavern.mainApi;\n\n    return {\n      model: chatSettings?.openai_model || mainApi || 'unknown',\n      endpoint: chatSettings?.api_url_scale || 'unknown',\n      hasApiKey: Boolean(chatSettings?.api_key_openai || chatSettings?.api_key_claude),\n    };\n  } catch (error) {\n    console.error('[AI Diagnostics] :', error);\n    return {\n      model: 'unknown',\n      endpoint: 'unknown',\n      hasApiKey: false,\n    };\n  }\n}\n\n/**\n * \n */\nexport async function runFullDiagnostics(): Promise<string> {\n  console.log('[AI Diagnostics] ...');\n\n  let report = '=== AI  ===\\n\\n';\n\n  // 1. \n  report += '1. \\n';\n  const config = getAIConfigInfo();\n  report += `   - : ${config.model}\\n`;\n  report += `   - : ${config.endpoint}\\n`;\n  report += `   - API : ${config.hasApiKey ? '' : ''}\\n\\n`;\n\n  // 2. \n  report += '2. \\n';\n  const testResult = await testAIService();\n  report += `   - : ${testResult.success ? ' ' : ' '}\\n`;\n  report += `   - : ${testResult.message}\\n`;\n\n  if (testResult.details) {\n    if (testResult.details.diagnosis) {\n      report += `   - : ${testResult.details.diagnosis}\\n`;\n    }\n    if (testResult.details.response) {\n      report += `   - : ${testResult.details.response}\\n`;\n    }\n  }\n\n  report += '\\n===  ===';\n\n  console.log('[AI Diagnostics] ');\n  console.log(report);\n\n  return report;\n}\n","//  Store - \n\nimport { defineStore } from 'pinia';\nimport { computed, ref } from 'vue';\nimport type { InstanceRecord } from '../types/instance';\n\n/**\n *  Store\n */\nexport const useInstanceStore = defineStore('instance', () => {\n  // ====================  ====================\n  const currentInstanceId = ref<string | null>(null);\n  const instances = ref<Map<string, InstanceRecord>>(new Map());\n\n  // ====================  ====================\n  const currentInstance = computed(() => {\n    if (!currentInstanceId.value) return null;\n    return instances.value.get(currentInstanceId.value) || null;\n  });\n\n  const hasActiveInstance = computed(() => {\n    return currentInstance.value?.status === 'active';\n  });\n\n  const instanceCount = computed(() => {\n    return instances.value.size;\n  });\n\n  const instanceList = computed(() => {\n    return Array.from(instances.value.values());\n  });\n\n  const currentArea = computed(() => {\n    if (!currentInstance.value) return null;\n    const playerLocation = currentInstance.value.map.playerLocation;\n    return currentInstance.value.map.areas.get(playerLocation) || null;\n  });\n\n  const connectedAreas = computed(() => {\n    if (!currentArea.value) return [];\n    return currentArea.value.connectedAreas\n      .map(areaId => currentInstance.value?.map.areas.get(areaId))\n      .filter((area): area is import('../types/instance').Area => area !== undefined);\n  });\n\n  // ====================  ====================\n\n  /**\n   * \n   */\n  function setCurrentInstance(instanceId: string | null): void {\n    currentInstanceId.value = instanceId;\n    console.log('[Instance Store] :', instanceId);\n  }\n\n  /**\n   * \n   */\n  function addInstance(instance: InstanceRecord): void {\n    instances.value.set(instance.id, instance);\n    console.log(`[Instance Store] : ${instance.name} (${instance.id})`);\n  }\n\n  /**\n   * \n   */\n  async function updateInstance(instanceId: string, updates: Partial<InstanceRecord>): Promise<void> {\n    const instance = instances.value.get(instanceId);\n    if (!instance) {\n      console.error(`[Instance Store] : ${instanceId}`);\n      return;\n    }\n\n    Object.assign(instance, updates);\n    instances.value.set(instanceId, instance);\n    console.log(`[Instance Store] : ${instanceId}`);\n  }\n\n  /**\n   * \n   */\n  function getInstance(instanceId: string): InstanceRecord | null {\n    return instances.value.get(instanceId) || null;\n  }\n\n  /**\n   * \n   */\n  function getAllInstances(): InstanceRecord[] {\n    return Array.from(instances.value.values());\n  }\n\n  /**\n   * \n   */\n  function removeInstance(instanceId: string): void {\n    instances.value.delete(instanceId);\n    if (currentInstanceId.value === instanceId) {\n      currentInstanceId.value = null;\n    }\n    console.log(`[Instance Store] : ${instanceId}`);\n  }\n\n  /**\n   * \n   */\n  async function toggleImportantNPC(instanceId: string, characterId: string): Promise<void> {\n    const instance = instances.value.get(instanceId);\n    if (!instance) {\n      console.error(`[Instance Store] : ${instanceId}`);\n      return;\n    }\n\n    const charInInstance = instance.characters.find(c => c.characterId === characterId);\n    if (!charInInstance) {\n      console.error(`[Instance Store] : ${characterId}`);\n      return;\n    }\n\n    // \n    charInInstance.isImportant = !charInInstance.isImportant;\n    console.log(`[Instance Store] : ${characterId} -> ${charInInstance.isImportant}`);\n  }\n\n  /**\n   * \n   */\n  function getInstancesByWorldSetting(worldSetting: string): InstanceRecord[] {\n    return Array.from(instances.value.values()).filter(instance => instance.worldSetting === worldSetting);\n  }\n\n  /**\n   * \n   */\n  async function addMemento(instanceId: string, memento: import('../types/instance').Memento): Promise<void> {\n    const instance = instances.value.get(instanceId);\n    if (!instance) {\n      console.error(`[Instance Store] : ${instanceId}`);\n      return;\n    }\n\n    // \n    const exists = instance.mementos.some(m => m.id === memento.id);\n    if (exists) {\n      console.warn(`[Instance Store] : ${memento.id}`);\n      return;\n    }\n\n    instance.mementos.push(memento);\n    console.log(`[Instance Store] : ${memento.name} (${memento.id})`);\n\n    //  mvuService \n    await saveToMVU();\n  }\n\n  /**\n   *  NPC \n   */\n  async function updateNPCImportance(\n    instanceId: string,\n    characterId: string,\n    importance: 1 | 2 | 3 | 4 | 5,\n  ): Promise<void> {\n    const instance = instances.value.get(instanceId);\n    if (!instance) {\n      console.error(`[Instance Store] : ${instanceId}`);\n      return;\n    }\n\n    const charInInstance = instance.characters.find(c => c.characterId === characterId);\n    if (!charInInstance) {\n      console.error(`[Instance Store] : ${characterId}`);\n      return;\n    }\n\n    charInInstance.importance = importance;\n    console.log(`[Instance Store] NPC : ${characterId} -> ${importance}`);\n\n    //  mvuService \n    await saveToMVU();\n  }\n\n  /**\n   *  NPC \n   */\n  async function updateNPCAppearanceCount(instanceId: string, characterId: string, count?: number): Promise<void> {\n    const instance = instances.value.get(instanceId);\n    if (!instance) {\n      console.error(`[Instance Store] : ${instanceId}`);\n      return;\n    }\n\n    const charInInstance = instance.characters.find(c => c.characterId === characterId);\n    if (!charInInstance) {\n      console.error(`[Instance Store] : ${characterId}`);\n      return;\n    }\n\n    if (count !== undefined) {\n      charInInstance.appearanceCount = count;\n    } else {\n      charInInstance.appearanceCount = (charInInstance.appearanceCount || 0) + 1;\n    }\n\n    console.log(`[Instance Store] NPC : ${characterId} -> ${charInInstance.appearanceCount}`);\n\n    //  mvuService \n    await saveToMVU();\n  }\n\n  /**\n   * \n   */\n  async function updateInstanceStatus(\n    instanceId: string,\n    status: import('../types/instance').InstanceStatus,\n  ): Promise<void> {\n    const instance = instances.value.get(instanceId);\n    if (!instance) {\n      console.error(`[Instance Store] : ${instanceId}`);\n      return;\n    }\n\n    instance.status = status;\n\n    // \n    if (status === 'active' && !instance.startTime) {\n      instance.startTime = Date.now();\n    } else if (status === 'completed' && !instance.endTime) {\n      instance.endTime = Date.now();\n    }\n\n    console.log(`[Instance Store] : ${instanceId} -> ${status}`);\n\n    //  mvuService \n    await saveToMVU();\n  }\n\n  /**\n   * \n   */\n  async function addEvent(instanceId: string, event: import('../types/instance').ImportantEvent): Promise<void> {\n    const instance = instances.value.get(instanceId);\n    if (!instance) {\n      console.error(`[Instance Store] : ${instanceId}`);\n      return;\n    }\n\n    // \n    const exists = instance.events.some(e => e.id === event.id);\n    if (exists) {\n      console.warn(`[Instance Store] : ${event.id}`);\n      return;\n    }\n\n    instance.events.push(event);\n    console.log(`[Instance Store] : ${event.summary} (${event.id})`);\n\n    //  mvuService \n    await saveToMVU();\n  }\n\n  /**\n   * \n   *  completed NPC \n   */\n  async function endInstance(instanceId: string): Promise<void> {\n    const instance = instances.value.get(instanceId);\n    if (!instance) {\n      console.error(`[Instance Store] : ${instanceId}`);\n      return;\n    }\n\n    // \n    instance.status = 'completed';\n    instance.endTime = Date.now();\n\n    //  NPC \n    instance.characters = [];\n\n    // \n    instance.map.areas.clear();\n    instance.map.connections = [];\n    instance.map.playerLocation = '';\n    instance.map.startArea = '';\n\n    // \n    console.log(`[Instance Store] : ${instanceId}`);\n    console.log(`[Instance Store]  ${instance.events.length} `);\n    console.log(`[Instance Store]  ${instance.mementos.length} `);\n\n    //  mvuService \n    await saveToMVU();\n  }\n\n  /**\n   * \n   *  completed NPC \n   *  endInstance \n   */\n  async function completeInstance(instanceId: string): Promise<void> {\n    const instance = instances.value.get(instanceId);\n    if (!instance) {\n      console.error(`[Instance Store] : ${instanceId}`);\n      return;\n    }\n\n    // \n    instance.status = 'completed';\n    instance.endTime = Date.now();\n\n    //  NPC characters \n    instance.characters = [];\n\n    // map.areas  connections\n    instance.map.areas.clear();\n    instance.map.connections = [];\n    instance.map.playerLocation = '';\n    instance.map.startArea = '';\n\n    // events \n    // mementos \n    console.log(`[Instance Store] : ${instanceId}`);\n    console.log(`[Instance Store]  ${instance.events.length} `);\n    console.log(`[Instance Store]  ${instance.mementos.length} `);\n\n    //  mvuService \n    await saveToMVU();\n  }\n\n  /**\n   *  MVU\n   */\n  async function saveToMVU(): Promise<void> {\n    try {\n      const { mvuService } = await import('../services/mvuService');\n      const data = await mvuService.loadGameData();\n\n      //  Map \n      const instancesObj: Record<string, any> = {};\n      for (const [id, instance] of instances.value.entries()) {\n        //  klona  Vue Proxy \n        const { klona } = await import('klona');\n        const cleanInstance = klona(instance);\n\n        //  Map  areas \n        const areasObj: Record<string, any> = {};\n        for (const [areaId, area] of instance.map.areas.entries()) {\n          areasObj[areaId] = klona(area);\n        }\n        cleanInstance.map.areas = areasObj as any;\n\n        instancesObj[id] = cleanInstance;\n      }\n\n      data.instances = instancesObj;\n      await mvuService.saveGameData(data);\n\n      console.log('[Instance Store]  MVU');\n    } catch (error) {\n      console.error('[Instance Store]  MVU :', error);\n      toastr.error('');\n    }\n  }\n\n  /**\n   * \n   */\n  async function addCharacterToInstance(\n    instanceId: string,\n    character: import('../types/character').Character,\n    isImportant: boolean = false,\n  ): Promise<void> {\n    const instance = instances.value.get(instanceId);\n    if (!instance) {\n      console.error(`[Instance Store] : ${instanceId}`);\n      return;\n    }\n\n    // \n    const exists = instance.characters.some(c => c.characterId === character.id);\n    if (exists) {\n      console.warn(`[Instance Store] : ${character.id}`);\n      return;\n    }\n\n    // \n    instance.characters.push({\n      characterId: character.id,\n      character,\n      isImportant,\n      importance: isImportant ? 3 : 2,\n      appearanceCount: 0,\n    });\n\n    console.log(`[Instance Store] : ${character.name} (${character.id})`);\n  }\n\n  /**\n   * \n   */\n  async function updatePlayerLocation(areaId: string): Promise<void> {\n    if (!currentInstance.value) {\n      console.error('[Instance Store] ');\n      return;\n    }\n\n    const area = currentInstance.value.map.areas.get(areaId);\n    if (!area) {\n      console.error(`[Instance Store] : ${areaId}`);\n      return;\n    }\n\n    currentInstance.value.map.playerLocation = areaId;\n    console.log(`[Instance Store] : ${area.name}`);\n  }\n\n  /**\n   * \n   */\n  async function discoverArea(areaId: string): Promise<void> {\n    if (!currentInstance.value) {\n      console.error('[Instance Store] ');\n      return;\n    }\n\n    const area = currentInstance.value.map.areas.get(areaId);\n    if (!area) {\n      console.error(`[Instance Store] : ${areaId}`);\n      return;\n    }\n\n    area.isDiscovered = true;\n    console.log(`[Instance Store] : ${area.name}`);\n  }\n\n  /**\n   *  store\n   */\n  function reset(): void {\n    currentInstanceId.value = null;\n    instances.value.clear();\n    console.log('[Instance Store] Store ');\n  }\n\n  // ====================  ====================\n  return {\n    // \n    currentInstanceId,\n    instances,\n\n    // \n    currentInstance,\n    hasActiveInstance,\n    instanceCount,\n    instanceList,\n    currentArea,\n    connectedAreas,\n\n    // \n    setCurrentInstance,\n    addInstance,\n    updateInstance,\n    getInstance,\n    getAllInstances,\n    removeInstance,\n    toggleImportantNPC,\n    getInstancesByWorldSetting,\n    addCharacterToInstance,\n    updatePlayerLocation,\n    discoverArea,\n    reset,\n\n    // \n    addMemento,\n    updateNPCImportance,\n    updateNPCAppearanceCount,\n    updateInstanceStatus,\n    addEvent,\n    endInstance,\n    completeInstance,\n    saveToMVU,\n  };\n});\n","// \n\n/**\n * \n */\nexport interface ValidationResult {\n  // \n  success: boolean;\n\n  // \n  errors: string[];\n\n  // \n  details: {\n    globalVariablesValid: boolean;\n    interceptorValid: boolean;\n    nameMatch: boolean;\n    descriptionMatch: boolean;\n  };\n}\n\n/**\n * \n * \n */\nexport class ProtagonistValidator {\n  /**\n   * \n   * @param expectedName \n   * @param expectedDescription \n   * @returns \n   */\n  static validateGlobalVariables(expectedName: string, expectedDescription: string): boolean {\n    try {\n      console.log('[ProtagonistValidator] ...');\n\n      // \n      const globalVars = getVariables({ type: 'global' });\n      console.log('[ProtagonistValidator] ');\n\n      //  player_name\n      const actualName = globalVars.player_name;\n      const nameMatch = actualName === expectedName;\n\n      if (!nameMatch) {\n        console.error('[ProtagonistValidator]  player_name :', {\n          expected: expectedName,\n          actual: actualName,\n        });\n        return false;\n      }\n\n      console.log('[ProtagonistValidator]  player_name :', actualName);\n\n      //  player_description\n      const actualDescription = globalVars.player_description;\n      const descriptionMatch = actualDescription === expectedDescription;\n\n      if (!descriptionMatch) {\n        console.error('[ProtagonistValidator]  player_description :', {\n          expected: `${expectedDescription.substring(0, 50)}...`,\n          actual: actualDescription ? `${actualDescription.substring(0, 50)}...` : undefined,\n          expectedLength: expectedDescription.length,\n          actualLength: actualDescription?.length,\n        });\n        return false;\n      }\n\n      console.log('[ProtagonistValidator]  player_description :', actualDescription.length);\n\n      console.log('[ProtagonistValidator]  ');\n      return true;\n    } catch (error) {\n      console.error('[ProtagonistValidator]  :', {\n        error: (error as Error).message,\n        stack: (error as Error).stack,\n      });\n      return false;\n    }\n  }\n\n  /**\n   *  SillyTavern \n   * @param expectedName \n   * @param expectedDescription \n   * @returns \n   */\n  static validateInterceptor(expectedName: string, expectedDescription: string): boolean {\n    try {\n      console.log('[ProtagonistValidator] ...');\n\n      const st = SillyTavern as any;\n\n      //  getUserName\n      if (typeof st.getUserName === 'function') {\n        const actualName = st.getUserName();\n        const nameMatch = actualName === expectedName;\n\n        if (!nameMatch) {\n          console.error('[ProtagonistValidator]  getUserName() :', {\n            expected: expectedName,\n            actual: actualName,\n          });\n          return false;\n        }\n\n        console.log('[ProtagonistValidator]  getUserName() :', actualName);\n      } else {\n        console.warn('[ProtagonistValidator]  getUserName ');\n        //  false\n      }\n\n      //  getPersonaDescription\n      if (typeof st.getPersonaDescription === 'function') {\n        const actualDescription = st.getPersonaDescription();\n        const descriptionMatch = actualDescription === expectedDescription;\n\n        if (!descriptionMatch) {\n          console.error('[ProtagonistValidator]  getPersonaDescription() :', {\n            expected: `${expectedDescription.substring(0, 50)}...`,\n            actual: actualDescription ? `${actualDescription.substring(0, 50)}...` : undefined,\n            expectedLength: expectedDescription.length,\n            actualLength: actualDescription?.length,\n          });\n          return false;\n        }\n\n        console.log('[ProtagonistValidator]  getPersonaDescription() :', actualDescription.length);\n      } else {\n        console.warn('[ProtagonistValidator]  getPersonaDescription ');\n        //  false\n      }\n\n      //  powerUserSettings \n      if (st.powerUserSettings) {\n        const actualName = st.powerUserSettings.name;\n        const nameMatch = actualName === expectedName;\n\n        if (!nameMatch) {\n          console.error('[ProtagonistValidator]  powerUserSettings.name :', {\n            expected: expectedName,\n            actual: actualName,\n          });\n          return false;\n        }\n\n        console.log('[ProtagonistValidator]  powerUserSettings.name :', actualName);\n\n        const actualDescription = st.powerUserSettings.persona_description;\n        const descriptionMatch = actualDescription === expectedDescription;\n\n        if (!descriptionMatch) {\n          console.error('[ProtagonistValidator]  powerUserSettings.persona_description :', {\n            expected: `${expectedDescription.substring(0, 50)}...`,\n            actual: actualDescription ? `${actualDescription.substring(0, 50)}...` : undefined,\n            expectedLength: expectedDescription.length,\n            actualLength: actualDescription?.length,\n          });\n          return false;\n        }\n\n        console.log(\n          '[ProtagonistValidator]  powerUserSettings.persona_description :',\n          actualDescription.length,\n        );\n      } else {\n        console.warn('[ProtagonistValidator]  powerUserSettings ');\n        //  false\n      }\n\n      // \n      const hasValidMethod =\n        (typeof st.getUserName === 'function' && st.getUserName() === expectedName) ||\n        (typeof st.getPersonaDescription === 'function' && st.getPersonaDescription() === expectedDescription) ||\n        (st.powerUserSettings && st.powerUserSettings.name === expectedName);\n\n      if (!hasValidMethod) {\n        console.error('[ProtagonistValidator]  ');\n        return false;\n      }\n\n      console.log('[ProtagonistValidator]  ');\n      return true;\n    } catch (error) {\n      console.error('[ProtagonistValidator]  :', {\n        error: (error as Error).message,\n        stack: (error as Error).stack,\n      });\n      return false;\n    }\n  }\n\n  /**\n   * \n   * @param expectedName \n   * @param expectedDescription \n   * @returns \n   */\n  static validate(expectedName: string, expectedDescription: string): ValidationResult {\n    console.log('[ProtagonistValidator] ==========  ==========');\n    console.log('[ProtagonistValidator] :', expectedName);\n    console.log('[ProtagonistValidator] :', expectedDescription.length);\n\n    const errors: string[] = [];\n    const details = {\n      globalVariablesValid: false,\n      interceptorValid: false,\n      nameMatch: false,\n      descriptionMatch: false,\n    };\n\n    // \n    const globalVarsValid = this.validateGlobalVariables(expectedName, expectedDescription);\n    details.globalVariablesValid = globalVarsValid;\n\n    if (!globalVarsValid) {\n      errors.push('');\n\n      // \n      try {\n        const globalVars = getVariables({ type: 'global' });\n        const actualName = globalVars.player_name;\n        const actualDescription = globalVars.player_description;\n\n        details.nameMatch = actualName === expectedName;\n        details.descriptionMatch = actualDescription === expectedDescription;\n\n        if (!details.nameMatch) {\n          errors.push(`player_name :  \"${expectedName}\",  \"${actualName}\"`);\n        }\n\n        if (!details.descriptionMatch) {\n          errors.push(\n            `player_description :  ${expectedDescription.length},  ${actualDescription?.length || 0}`,\n          );\n        }\n      } catch (error) {\n        errors.push(`: ${(error as Error).message}`);\n      }\n    } else {\n      details.nameMatch = true;\n      details.descriptionMatch = true;\n    }\n\n    // \n    const interceptorValid = this.validateInterceptor(expectedName, expectedDescription);\n    details.interceptorValid = interceptorValid;\n\n    if (!interceptorValid) {\n      errors.push('SillyTavern ');\n    }\n\n    // \n    const success = globalVarsValid && interceptorValid;\n\n    if (success) {\n      console.log('[ProtagonistValidator]  ');\n    } else {\n      console.error('[ProtagonistValidator]  :', {\n        errors,\n        details,\n      });\n    }\n\n    console.log('[ProtagonistValidator] ==========  ==========');\n\n    return {\n      success,\n      errors,\n      details,\n    };\n  }\n}\n","//  -  0 \n\nimport { useCharacterStore } from '../stores/characterStore';\nimport type { PlayerCharacter } from '../types/character';\nimport { ProtagonistValidator } from '../utils/protagonistValidator';\n\n/**\n * \n */\ninterface InterceptorState {\n  // \n  isSetup: boolean;\n\n  // \n  currentName: string | null;\n\n  // \n  currentDescription: string | null;\n}\n\n/**\n * \n */\ninterface OriginalMethods {\n  getUserName?: () => string;\n  getPersonaDescription?: () => string;\n}\n\n/**\n * \n *  0 \n */\nclass CharacterInitializer {\n  private initialized = false;\n\n  // \n  private interceptorState: InterceptorState = {\n    isSetup: false,\n    currentName: null,\n    currentDescription: null,\n  };\n\n  // \n  private originalMethods: OriginalMethods = {};\n\n  /**\n   * \n   *  0 \n   */\n  async checkAndInitialize(): Promise<boolean> {\n    try {\n      console.log('[CharacterInitializer] ==========  ==========');\n\n      // 1:  SillyTavern.chat \n      const chatLength = SillyTavern.chat.length;\n      console.log('[CharacterInitializer] SillyTavern.chat.length:', chatLength);\n\n      // 2:  getChatMessages\n      let messages: any[] = [];\n      try {\n        messages = getChatMessages('0-{{lastMessageId}}');\n        console.log('[CharacterInitializer] getChatMessages :', messages.length);\n      } catch (error) {\n        console.log('[CharacterInitializer] getChatMessages  0 :', error);\n      }\n\n      //  0 \n      const isFloorZero = chatLength === 0 && messages.length === 0;\n      console.log('[CharacterInitializer]  0 :', isFloorZero);\n\n      if (!isFloorZero) {\n        console.log('[CharacterInitializer]   0 ');\n        return false;\n      }\n\n      // \n      const characterStore = useCharacterStore();\n      console.log('[CharacterInitializer] characterStore.hasPlayer:', characterStore.hasPlayer);\n      console.log('[CharacterInitializer] characterStore.player:', characterStore.player);\n\n      if (characterStore.hasPlayer) {\n        console.log('[CharacterInitializer]  ');\n        return false;\n      }\n\n      // \n      console.log('[CharacterInitializer] this.initialized:', this.initialized);\n      if (this.initialized) {\n        console.log('[CharacterInitializer]  ');\n        return false;\n      }\n\n      console.log('[CharacterInitializer]  ');\n      this.initialized = true;\n\n      // \n      //  MainInterface \n      console.log('[CharacterInitializer] : character_initialization_required');\n      eventEmit('character_initialization_required');\n      console.log('[CharacterInitializer] ');\n\n      return true;\n    } catch (error) {\n      console.error('[CharacterInitializer]  :', error);\n      return false;\n    }\n  }\n\n  /**\n   * \n   */\n  async syncToSillyTavern(): Promise<void> {\n    try {\n      console.log('[CharacterInitializer] ...');\n\n      const characterStore = useCharacterStore();\n      const character = characterStore.player;\n\n      if (!character) {\n        console.warn('[CharacterInitializer] ');\n        return;\n      }\n\n      console.log('[CharacterInitializer] :', character.name);\n\n      const description = this.formatCharacterDescription(character);\n      console.log('[CharacterInitializer] :', description.length);\n\n      // \n      insertOrAssignVariables(\n        {\n          player_name: character.name,\n          player_description: description,\n        },\n        { type: 'global' },\n      );\n\n      //  setupInterceptor() \n      this.setupInterceptor(character.name, description);\n\n      // \n      console.log('[CharacterInitializer] :', this.interceptorState);\n\n      console.log('[CharacterInitializer]  ');\n      toastr.success('');\n    } catch (error) {\n      console.error('[CharacterInitializer]  :', error);\n      toastr.error(': ' + (error as Error).message);\n    }\n  }\n\n  /**\n   * \n   *  SillyTavern \n   */\n  resetInterceptor(): void {\n    try {\n      console.log('[CharacterInitializer] ==========  ==========');\n      console.log('[CharacterInitializer] :', this.interceptorState);\n\n      const st = SillyTavern as any;\n\n      //  SillyTavern.getUserName \n      if (this.originalMethods.getUserName) {\n        st.getUserName = this.originalMethods.getUserName;\n        console.log('[CharacterInitializer]  getUserName ');\n      } else {\n        console.log('[CharacterInitializer]  getUserName ');\n      }\n\n      //  SillyTavern.getPersonaDescription \n      if (this.originalMethods.getPersonaDescription) {\n        st.getPersonaDescription = this.originalMethods.getPersonaDescription;\n        console.log('[CharacterInitializer]  getPersonaDescription ');\n      } else {\n        console.log('[CharacterInitializer]  getPersonaDescription ');\n      }\n\n      //  powerUserSettings \n      if (st.powerUserSettings) {\n        try {\n          //  delete  defineProperty \n          delete st.powerUserSettings.name;\n          console.log('[CharacterInitializer]  powerUserSettings.name ');\n        } catch (error) {\n          console.warn('[CharacterInitializer]   powerUserSettings.name :', error);\n        }\n\n        try {\n          delete st.powerUserSettings.persona_description;\n          console.log('[CharacterInitializer]  powerUserSettings.persona_description ');\n        } catch (error) {\n          console.warn('[CharacterInitializer]   powerUserSettings.persona_description :', error);\n        }\n      }\n\n      // \n      this.interceptorState = {\n        isSetup: false,\n        currentName: null,\n        currentDescription: null,\n      };\n\n      console.log('[CharacterInitializer]  ');\n      console.log('[CharacterInitializer] :', this.interceptorState);\n      console.log('[CharacterInitializer] ==========  ==========');\n    } catch (error) {\n      console.error('[CharacterInitializer]  :', {\n        error: (error as Error).message,\n        stack: (error as Error).stack,\n        currentState: this.interceptorState,\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * \n   *  SillyTavern \n   */\n  private setupInterceptor(playerName: string, playerDescription: string): void {\n    try {\n      console.log('[CharacterInitializer] ==========  ==========');\n      console.log('[CharacterInitializer] :', playerName);\n      console.log('[CharacterInitializer] :', playerDescription.length);\n\n      const st = SillyTavern as any;\n\n      // \n      if (!this.originalMethods.getUserName && typeof st.getUserName === 'function') {\n        this.originalMethods.getUserName = st.getUserName;\n        console.log('[CharacterInitializer]   getUserName ');\n      }\n\n      if (!this.originalMethods.getPersonaDescription && typeof st.getPersonaDescription === 'function') {\n        this.originalMethods.getPersonaDescription = st.getPersonaDescription;\n        console.log('[CharacterInitializer]   getPersonaDescription ');\n      }\n\n      //  SillyTavern.getUserName\n      if (typeof st.getUserName === 'function') {\n        st.getUserName = function () {\n          console.log('[CharacterInitializer]  getUserName:', playerName);\n          return playerName;\n        };\n        console.log('[CharacterInitializer]  getUserName ');\n      }\n\n      //  SillyTavern.getPersonaDescription\n      if (typeof st.getPersonaDescription === 'function') {\n        st.getPersonaDescription = function () {\n          console.log(\n            '[CharacterInitializer]  getPersonaDescription:',\n            playerDescription.length,\n          );\n          return playerDescription;\n        };\n        console.log('[CharacterInitializer]  getPersonaDescription ');\n      }\n\n      //  powerUserSettings  name  persona_description \n      if (st.powerUserSettings) {\n        const powerUser = st.powerUserSettings;\n\n        //  Object.defineProperty \n        Object.defineProperty(powerUser, 'name', {\n          get: function () {\n            console.log('[CharacterInitializer]  powerUserSettings.name:', playerName);\n            return playerName;\n          },\n          set: function () {\n            console.log('[CharacterInitializer]  powerUserSettings.name ');\n          },\n          configurable: true,\n        });\n\n        Object.defineProperty(powerUser, 'persona_description', {\n          get: function () {\n            console.log(\n              '[CharacterInitializer]  powerUserSettings.persona_description:',\n              playerDescription.length,\n            );\n            return playerDescription;\n          },\n          set: function () {\n            console.log('[CharacterInitializer]  powerUserSettings.persona_description ');\n          },\n          configurable: true,\n        });\n\n        console.log('[CharacterInitializer]  powerUserSettings ');\n      }\n\n      // \n      this.interceptorState = {\n        isSetup: true,\n        currentName: playerName,\n        currentDescription: playerDescription,\n      };\n\n      console.log('[CharacterInitializer]  ');\n      console.log('[CharacterInitializer] :', this.interceptorState);\n      console.log('[CharacterInitializer] ==========  ==========');\n    } catch (error) {\n      console.error('[CharacterInitializer]  :', {\n        error: (error as Error).message,\n        stack: (error as Error).stack,\n        playerName,\n        descriptionLength: playerDescription.length,\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @param expectedName \n   * @param expectedDescription \n   * @returns \n   */\n  async verifyProtagonistInfo(expectedName: string, expectedDescription: string): Promise<boolean> {\n    try {\n      console.log('[CharacterInitializer] ==========  ==========');\n\n      //  ProtagonistValidator.validate() \n      const result = ProtagonistValidator.validate(expectedName, expectedDescription);\n\n      if (!result.success) {\n        // \n        console.error('[CharacterInitializer]  :', {\n          errors: result.errors,\n          details: result.details,\n        });\n\n        // \n        toastr.warning(`${result.errors.join('')}`, '', { timeOut: 5000 });\n\n        console.log('[CharacterInitializer] ========== ==========');\n        return false;\n      }\n\n      // \n      console.log('[CharacterInitializer]  ');\n      console.log('[CharacterInitializer] :', result.details);\n      console.log('[CharacterInitializer] ========== ==========');\n\n      return true;\n    } catch (error) {\n      console.error('[CharacterInitializer]  :', {\n        error: (error as Error).message,\n        stack: (error as Error).stack,\n      });\n\n      toastr.error('', '');\n      return false;\n    }\n  }\n\n  /**\n   * \n   */\n  private formatCharacterDescription(character: PlayerCharacter): string {\n    const lines: string[] = [];\n\n    // \n    lines.push(`${character.name}`);\n    if (character.age) {\n      lines.push(`${character.age}`);\n    }\n    if (character.occupation) {\n      lines.push(`${character.occupation}`);\n    }\n    if (character.background) {\n      lines.push(`${character.background}`);\n    }\n\n    // \n    lines.push('');\n    lines.push('');\n    const attributes = character.attributes;\n    lines.push(`-  (STR): ${attributes.STR}`);\n    lines.push(`-  (CON): ${attributes.CON}`);\n    lines.push(`-  (SIZ): ${attributes.SIZ}`);\n    lines.push(`-  (DEX): ${attributes.DEX}`);\n    lines.push(`-  (APP): ${attributes.APP}`);\n    lines.push(`-  (INT): ${attributes.INT}`);\n    lines.push(`-  (POW): ${attributes.POW}`);\n    lines.push(`-  (EDU): ${attributes.EDU}`);\n    lines.push(`-  (LUK): ${attributes.LUK}`);\n\n    // \n    lines.push('');\n    lines.push('');\n    const derived = character.derivedStats;\n    lines.push(`-  (HP): ${derived.HP}/${derived.maxHP}`);\n    lines.push(`-  (MP): ${derived.MP}/${derived.maxMP}`);\n    lines.push(`-  (SAN): ${derived.SAN}/${derived.maxSAN}`);\n    lines.push(`-  (MOV): ${derived.MOV}`);\n    lines.push(`-  (DB): ${derived.DB}`);\n    lines.push(`-  (BUILD): ${derived.BUILD}`);\n\n    // \n    if (character.skills && character.skills.size > 0) {\n      lines.push('');\n      lines.push('');\n      character.skills.forEach((value, name) => {\n        lines.push(`- ${name}: ${value}`);\n      });\n    }\n\n    return lines.join('\\n');\n  }\n\n  /**\n   * \n   *  API \n   */\n  async onCharacterCreated(character: PlayerCharacter): Promise<void> {\n    try {\n      console.log('[CharacterInitializer] ==========  ==========');\n\n      // 1. \n      console.log('[CharacterInitializer]  1/4: ...');\n      await this.syncToSillyTavern();\n      console.log('[CharacterInitializer]  ');\n\n      // 2.  API  API\n      console.log('[CharacterInitializer]  2/4:  API ...');\n      try {\n        // eslint-disable-next-line import-x/no-cycle -- Dynamic import breaks cycle at runtime\n        const { gameResetService } = await import('./gameResetService');\n        await gameResetService.resetAPIConfiguration();\n        console.log('[CharacterInitializer]  API ');\n      } catch (error) {\n        console.error('[CharacterInitializer]  API :', error);\n        toastr.warning('API ');\n        // \n      }\n\n      // 3. \n      console.log('[CharacterInitializer]  3/4: ...');\n      const { realWorldMapService } = await import('./realWorldMapService');\n\n      // \n      const hasMap = await realWorldMapService.hasMap();\n      if (!hasMap) {\n        console.log('[CharacterInitializer] ...');\n        try {\n          await realWorldMapService.generateMap(character);\n          console.log('[CharacterInitializer]  ');\n          toastr.success('');\n        } catch (error) {\n          console.error('[CharacterInitializer]  :', error);\n          toastr.error('');\n          // \n        }\n      } else {\n        console.log('[CharacterInitializer] ');\n      }\n\n      // 4. \n      console.log('[CharacterInitializer]  4/4: ...');\n      const description = this.formatCharacterDescription(character);\n      const verificationResult = await this.verifyProtagonistInfo(character.name, description);\n\n      if (!verificationResult) {\n        // \n        console.warn('[CharacterInitializer]  ');\n      } else {\n        console.log('[CharacterInitializer]  ');\n      }\n\n      console.log('[CharacterInitializer] ==========  ==========');\n    } catch (error) {\n      console.error('[CharacterInitializer]  :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * \n   */\n  reset(): void {\n    this.initialized = false;\n    console.log('[CharacterInitializer] ');\n  }\n}\n\n// \nexport const characterInitializer = new CharacterInitializer();\n","// \n\nimport type { Area, AreaDetails, Item } from '../types/instance';\n\n/**\n * \n */\nclass AreaDetailsService {\n  /**\n   * \n   * @param area \n   * @param isRealWorld \n   * @returns \n   */\n  async generateDetails(area: Area, isRealWorld: boolean = false): Promise<AreaDetails> {\n    //  withAPIContext  sanctuary API\n    //  AI  API\n    return await withAPIContext('sanctuary', async () => {\n      try {\n        console.log(`[AreaDetailsService] : ${area.name}`);\n        toastr.info('...');\n\n        //  AI \n        const worldType = isRealWorld ? '' : '';\n        const prompt = ` YAML \n\n\n- ${area.name}\n- ${area.description}\n- ${worldType}\n- ${area.isDangerous ? '' : ''}\n\n\n1.  \\`\\`\\`yaml \n2. environment: 50-100\n3. atmosphere: 30-50\n4. items: 2-4\n   -  idnamedescriptiontype\n   - \n   - ${isRealWorld ? '' : ''}\n\n\n\\`\\`\\`yaml\nenvironment: \natmosphere: \nitems:\n  - id: item_${Date.now()}_1\n    name: \n    description: \n    type: \n  - id: item_${Date.now()}_2\n    name: \n    description: \n    type: \n\\`\\`\\`\n\n ${area.name} `;\n\n        //  generateRaw \n        // withAPIContext  sanctuary API\n        let text: string;\n        try {\n          text = await generateRaw({\n            ordered_prompts: [{ role: 'user', content: prompt }],\n          });\n          console.log('[AreaDetailsService] AI ...');\n        } catch (apiError) {\n          console.error('[AreaDetailsService] API :', {\n            error: apiError instanceof Error ? apiError.message : String(apiError),\n            stack: apiError instanceof Error ? apiError.stack : undefined,\n          });\n\n          // API \n          console.log('[AreaDetailsService] API ');\n          toastr.warning(`${area.name} API `);\n          return this.generateDefaultDetails(area, isRealWorld);\n        }\n\n        const result = await this.parseDetailsFromText(text);\n        toastr.success('');\n        return result;\n      } catch (error) {\n        console.error('[AreaDetailsService] :', error);\n        toastr.warning('');\n        return this.generateDefaultDetails(area, isRealWorld);\n      }\n    });\n  }\n\n  /**\n   *  AI \n   */\n  private async parseDetailsFromText(text: string): Promise<AreaDetails> {\n    const YAML = (await import('yaml')).default;\n\n    console.log('[AreaDetailsService] ...');\n\n    //  YAML \n    const patterns = [\n      { regex: /```yaml\\n([\\s\\S]*?)\\n```/, name: '```yaml' },\n      { regex: /```yml\\n([\\s\\S]*?)\\n```/, name: '```yml' },\n      { regex: /```\\n([\\s\\S]*?)\\n```/, name: '```' },\n    ];\n\n    for (const { regex, name } of patterns) {\n      const match = text.match(regex);\n      if (match) {\n        console.log(`[AreaDetailsService]  (${name})`);\n        try {\n          const data = YAML.parse(match[1]);\n          if (this.validateDetails(data)) {\n            console.log('[AreaDetailsService] ');\n            return this.buildDetails(data);\n          }\n        } catch (e) {\n          console.warn('[AreaDetailsService] YAML :', e);\n        }\n      }\n    }\n\n    // \n    try {\n      const data = YAML.parse(text);\n      if (this.validateDetails(data)) {\n        console.log('[AreaDetailsService] ');\n        return this.buildDetails(data);\n      }\n    } catch (e) {\n      console.warn('[AreaDetailsService] :', e);\n    }\n\n    throw new Error('');\n  }\n\n  /**\n   * \n   */\n  private validateDetails(data: any): boolean {\n    return (\n      data &&\n      typeof data === 'object' &&\n      typeof data.environment === 'string' &&\n      typeof data.atmosphere === 'string' &&\n      Array.isArray(data.items)\n    );\n  }\n\n  /**\n   * \n   */\n  private buildDetails(data: any): AreaDetails {\n    return {\n      environment: data.environment,\n      atmosphere: data.atmosphere,\n      items: data.items.map((item: any) => ({\n        id: item.id || `item_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        name: item.name,\n        description: item.description,\n        type: item.type,\n      })),\n    };\n  }\n\n  /**\n   * \n   */\n  private generateDefaultDetails(area: Area, isRealWorld: boolean): AreaDetails {\n    console.log('[AreaDetailsService] ');\n\n    const defaultItems: Item[] = isRealWorld\n      ? [\n          {\n            id: `item_${Date.now()}_1`,\n            name: '',\n            description: '',\n            type: '',\n          },\n          {\n            id: `item_${Date.now()}_2`,\n            name: '',\n            description: '',\n            type: '',\n          },\n        ]\n      : [\n          {\n            id: `item_${Date.now()}_1`,\n            name: '',\n            description: '',\n            type: '',\n          },\n          {\n            id: `item_${Date.now()}_2`,\n            name: '',\n            description: '',\n            type: '',\n          },\n        ];\n\n    return {\n      environment: `${area.description}${area.isDangerous ? '' : ''}`,\n      atmosphere: area.isDangerous ? '' : '',\n      items: defaultItems,\n    };\n  }\n}\n\nexport const areaDetailsService = new AreaDetailsService();\n","// Zod schemas \n\nimport { z } from 'zod';\n\n// ==================== COC7  Schema ====================\nexport const COC7AttributesSchema = z.object({\n  STR: z.number().min(0).max(100).default(50),\n  CON: z.number().min(0).max(100).default(50),\n  SIZ: z.number().min(0).max(100).default(50),\n  DEX: z.number().min(0).max(100).default(50),\n  APP: z.number().min(0).max(100).default(50),\n  INT: z.number().min(0).max(100).default(50),\n  POW: z.number().min(0).max(100).default(50),\n  EDU: z.number().min(0).max(100).default(50),\n  LUK: z.number().min(0).max(100).default(50),\n});\n\nexport type COC7AttributesType = z.infer<typeof COC7AttributesSchema>;\n\n// ====================  Schema ====================\nexport const DerivedStatsSchema = z.object({\n  HP: z.number().min(0),\n  maxHP: z.number().min(0),\n  MP: z.number().min(0),\n  maxMP: z.number().min(0),\n  SAN: z.number().min(0).max(99),\n  maxSAN: z.number().min(0).max(99),\n  MOV: z.number().min(0),\n  DB: z.string(),\n  BUILD: z.number(),\n});\n\nexport type DerivedStatsType = z.infer<typeof DerivedStatsSchema>;\n\n// ====================  Schema ====================\nexport const BodyPartDebuffSchema = z.object({\n  type: z.string(),\n  value: z.number(),\n  description: z.string().optional(),\n});\n\nexport const BodyPartStatusSchema: z.ZodType<any> = z.lazy(() =>\n  z.object({\n    id: z.string(),\n    name: z.string(),\n    parent: z.string().optional(),\n    damage: z.number().min(0).max(100).default(0),\n    debuffs: z.array(BodyPartDebuffSchema).default([]),\n    children: z.array(BodyPartStatusSchema).optional(),\n  }),\n);\n\nexport type BodyPartStatusType = z.infer<typeof BodyPartStatusSchema>;\n\n// ====================  Schema ====================\nexport const SkillSchema = z.object({\n  name: z.string(),\n  value: z.number().min(0).max(100),\n  isOccupational: z.boolean().optional(),\n});\n\n// ====================  Schema ====================\nexport const ItemSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string(),\n  quantity: z.number().min(0).default(1),\n  type: z.string().optional(),\n});\n\nexport type ItemType = z.infer<typeof ItemSchema>;\n\n// ====================  Schema ====================\nexport const BaseCharacterSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  age: z.number().optional(),\n  occupation: z.string().optional(),\n  background: z.string().optional(),\n  attributes: COC7AttributesSchema,\n  derivedStats: DerivedStatsSchema,\n  skills: z.record(z.string(), z.number()).transform(val => new Map(Object.entries(val))),\n  bodyParts: z.array(BodyPartStatusSchema).default([]),\n  inventory: z.array(ItemSchema).default([]),\n  portrait: z.string().optional(),\n});\n\nexport const PlayerCharacterSchema = BaseCharacterSchema.extend({\n  type: z.literal('player'),\n});\n\nexport const NPCCharacterSchema = BaseCharacterSchema.extend({\n  type: z.literal('npc'),\n  affection: z.number().min(0).max(100).default(50),\n  isImportant: z.boolean().default(false),\n  events: z.array(z.string()).default([]),\n  relationship: z.string().optional(),\n});\n\nexport const CharacterSchema = z.union([PlayerCharacterSchema, NPCCharacterSchema]);\n\nexport type CharacterType = z.infer<typeof CharacterSchema>;\n\n// ====================  Schema ====================\nexport const SpriteDataSchema = z.object({\n  characterId: z.string(),\n  url: z.string(),\n  position: z.enum(['left', 'center', 'right', 'custom']),\n  x: z.number().optional(),\n  y: z.number().optional(),\n  scale: z.number().default(1),\n  opacity: z.number().min(0).max(1).default(1),\n});\n\nexport type SpriteDataType = z.infer<typeof SpriteDataSchema>;\n\n// ====================  Schema ====================\nexport const AreaSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string(),\n  background: z.string().optional(),\n  connectedAreas: z.array(z.string()).default([]),\n  events: z.array(z.string()).optional(),\n  isDiscovered: z.boolean().default(false),\n  isDangerous: z.boolean().optional(),\n});\n\nexport type AreaType = z.infer<typeof AreaSchema>;\n\nexport const ConnectionSchema = z.object({\n  from: z.string(),\n  to: z.string(),\n  isLocked: z.boolean().optional(),\n  requirement: z.string().optional(),\n});\n\nexport const MapDataSchema = z.object({\n  areas: z.record(z.string(), AreaSchema).transform(val => new Map(Object.entries(val))),\n  connections: z.array(ConnectionSchema).default([]),\n  playerLocation: z.string(),\n  startArea: z.string(),\n});\n\nexport type MapDataType = z.infer<typeof MapDataSchema>;\n\n// ====================  Schema ====================\nexport const CharacterInInstanceSchema = z.object({\n  characterId: z.string(),\n  character: CharacterSchema,\n  isImportant: z.boolean().default(false),\n  firstAppearance: z.string().optional(),\n  lastSeen: z.string().optional(),\n});\n\nexport const ImportantEventSchema = z.object({\n  id: z.string(),\n  summary: z.string(),\n  timestamp: z.number(),\n  location: z.string().optional(),\n  involvedCharacters: z.array(z.string()).default([]),\n  consequences: z.string().optional(),\n});\n\nexport type ImportantEventType = z.infer<typeof ImportantEventSchema>;\n\nexport const InstanceRecordSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  type: z.string(),\n  difficulty: z.number().min(1).max(5),\n  worldSetting: z.string(),\n  map: MapDataSchema,\n  characters: z.array(CharacterInInstanceSchema).default([]),\n  events: z.array(ImportantEventSchema).default([]),\n  startTime: z.number(),\n  endTime: z.number().optional(),\n  ending: z.string().optional(),\n  isActive: z.boolean().default(false),\n  customPrompt: z.string().optional(),\n});\n\nexport type InstanceRecordType = z.infer<typeof InstanceRecordSchema>;\n\n// ====================  Schema ====================\nexport const RollResultSchema = z.enum([\n  'critical_success',\n  'extreme_success',\n  'hard_success',\n  'success',\n  'failure',\n  'critical_failure',\n]);\n\nexport const DiceRollSchema = z.object({\n  roll: z.number().min(1).max(100),\n  skill: z.number().min(0).max(100),\n  result: RollResultSchema,\n  skillName: z.string().optional(),\n  timestamp: z.number(),\n});\n\nexport type DiceRollType = z.infer<typeof DiceRollSchema>;\n\nexport const StatusEffectSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  type: z.enum(['buff', 'debuff']),\n  description: z.string(),\n  duration: z.number(),\n  effect: z.object({\n    attribute: z.string().optional(),\n    modifier: z.number().optional(),\n    damagePerRound: z.number().optional(),\n  }),\n});\n\nexport const EnemySchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  attributes: COC7AttributesSchema,\n  derivedStats: DerivedStatsSchema,\n  skills: z.record(z.string(), z.number()).transform(val => new Map(Object.entries(val))),\n  bodyParts: z.array(BodyPartStatusSchema).default([]),\n  portrait: z.string().optional(),\n  attackPattern: z.string().optional(),\n  loot: z.array(ItemSchema).optional(),\n});\n\nexport type EnemyType = z.infer<typeof EnemySchema>;\n\nexport const CombatActionSchema = z.object({\n  type: z.enum(['attack', 'dodge', 'escape', 'special']),\n  actorId: z.string(),\n  targetId: z.string().optional(),\n  attackType: z.enum(['melee', 'ranged', 'magic', 'special']).optional(),\n  skillUsed: z.string().optional(),\n  roll: DiceRollSchema.optional(),\n  damage: z.number().optional(),\n  bodyPartHit: z.string().optional(),\n  description: z.string().optional(),\n});\n\nexport const CombatRoundSchema = z.object({\n  roundNumber: z.number(),\n  actions: z.array(CombatActionSchema).default([]),\n  timestamp: z.number(),\n});\n\nexport const CombatParticipantSchema = z.object({\n  id: z.string(),\n  character: CharacterSchema.optional(),\n  enemy: EnemySchema.optional(),\n  isPlayer: z.boolean(),\n  currentHP: z.number(),\n  currentMP: z.number(),\n  currentSAN: z.number(),\n  statusEffects: z.array(StatusEffectSchema).default([]),\n  initiative: z.number(),\n});\n\nexport const CombatStateSchema = z.object({\n  id: z.string(),\n  participants: z.array(CombatParticipantSchema),\n  currentRound: z.number().default(1),\n  currentTurn: z.number().default(0),\n  status: z.enum(['active', 'victory', 'defeat', 'escaped']),\n  rounds: z.array(CombatRoundSchema).default([]),\n  startTime: z.number(),\n  environment: z.string().optional(),\n});\n\nexport type CombatStateType = z.infer<typeof CombatStateSchema>;\n\n// ====================  Schema ====================\nexport const DialogueDataSchema = z.object({\n  speaker: z.string(),\n  content: z.string(),\n  timestamp: z.number(),\n  characterId: z.string().optional(),\n});\n\nexport type DialogueDataType = z.infer<typeof DialogueDataSchema>;\n\n// ====================  Schema ====================\nexport const SceneDataSchema = z.object({\n  background: z.string(),\n  sprites: z.array(SpriteDataSchema).default([]),\n  areaId: z.string().optional(),\n  description: z.string().optional(),\n});\n\nexport type SceneDataType = z.infer<typeof SceneDataSchema>;\n\n// ==================== MVU  Schema ====================\nexport const MVUGameDataSchema = z\n  .object({\n    game: z\n      .object({\n        currentInstanceId: z.string().optional(),\n        currentArea: z.string().optional(),\n        mode: z.enum(['main', 'combat', 'sanctuary', 'creation']).default('main'),\n      })\n      .default(() => ({ mode: 'main' as const })),\n    characters: z\n      .object({\n        player: PlayerCharacterSchema.optional(),\n        npcs: z.record(z.string(), NPCCharacterSchema).default({}),\n      })\n      .default(() => ({ npcs: {} })),\n    instances: z.record(z.string(), InstanceRecordSchema).default({}),\n    interaction: z\n      .object({\n        dialogues: z.array(DialogueDataSchema).default([]),\n      })\n      .default(() => ({ dialogues: [] })),\n  })\n  .default(() => ({\n    game: { mode: 'main' as const },\n    characters: { npcs: {} },\n    instances: {},\n    interaction: { dialogues: [] },\n  }));\n\nexport type MVUGameDataType = z.infer<typeof MVUGameDataSchema>;\n","// MVU  -  MVU \n\nimport { klona } from 'klona';\nimport type { Character, CharacterStatusUpdate } from '../types/character';\nimport { MVUGameDataSchema, type MVUGameDataType } from '../types/schemas';\n\n/**\n * MVU \n *  MVU \n */\nclass MVUService {\n  private initialized = false;\n\n  /**\n   *  MVU \n   *  MVU \n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      console.log('[MVU Service] ');\n      return;\n    }\n\n    console.log('[MVU Service]  MVU ...');\n    const startTime = Date.now();\n\n    try {\n      console.log('[MVU Service]  MVU ...');\n      await waitGlobalInitialized('Mvu');\n\n      this.initialized = true;\n      const duration = Date.now() - startTime;\n\n      console.log('[MVU Service] MVU ');\n      console.log('[MVU Service] :', duration, 'ms');\n    } catch (error) {\n      console.error('[MVU Service] MVU :', error);\n      console.error('[MVU Service] :', Date.now() - startTime, 'ms');\n      toastr.error('MVU  MVU ');\n      throw error;\n    }\n  }\n\n  /**\n   *  MVU \n   */\n  private ensureInitialized(): void {\n    if (!this.initialized) {\n      throw new Error('MVU Service  initialize()');\n    }\n  }\n\n  /**\n   * \n   *  MVU \n   * @param messageId  ID 0\n   */\n  async loadGameData(messageId: number = 0): Promise<MVUGameDataType> {\n    this.ensureInitialized();\n\n    try {\n      //  MVU  stat_data \n      const rawData = Mvu.getMvuData({ type: 'message', message_id: messageId });\n\n      console.log('[MVU Service] :', rawData);\n\n      // \n      if (!rawData || Object.keys(rawData).length === 0) {\n        console.log('[MVU Service] ');\n        const defaultData = MVUGameDataSchema.parse({});\n        // \n        await this.saveGameData(defaultData, messageId);\n        return defaultData;\n      }\n\n      //  Zod \n      const validatedData = MVUGameDataSchema.parse(rawData);\n\n      console.log('[MVU Service] ');\n      return validatedData;\n    } catch (error) {\n      console.error('[MVU Service] :', error);\n\n      //  Zod  formatZodError \n      if (error instanceof Error && 'issues' in error) {\n        const { formatZodError } = await import('../utils/validators');\n        const formatted = formatZodError(error as any);\n        console.error('[MVU Service] :\\n', formatted);\n        toastr.warning('');\n      } else {\n        toastr.error('');\n      }\n\n      // \n      const defaultData = MVUGameDataSchema.parse({});\n      // \n      try {\n        await this.saveGameData(defaultData, messageId);\n      } catch (saveError) {\n        console.error('[MVU Service] :', saveError);\n      }\n      return defaultData;\n    }\n  }\n\n  /**\n   * \n   *  MVU \n   * @param data \n   * @param messageId  ID 0\n   */\n  async saveGameData(data: MVUGameDataType, messageId: number = 0): Promise<void> {\n    this.ensureInitialized();\n\n    console.log('[MVU Service] ', messageId);\n    const startTime = Date.now();\n\n    try {\n      //  klona  Vue  Proxy \n      console.log('[MVU Service]  klona  Proxy ...');\n      const cleanData = klona(data);\n\n      //  MVU \n      console.log('[MVU Service]  MVU ...');\n      const currentMvuData = Mvu.getMvuData({ type: 'message', message_id: messageId });\n\n      //  stat_data \n      const updatedMvuData = {\n        ...currentMvuData,\n        stat_data: cleanData,\n      };\n\n      //  MVU \n      console.log('[MVU Service]  MVU ...');\n      await Mvu.replaceMvuData(updatedMvuData, { type: 'message', message_id: messageId });\n\n      const duration = Date.now() - startTime;\n      console.log('[MVU Service] :', duration, 'ms');\n    } catch (error) {\n      console.error('[MVU Service] :', error);\n      console.error('[MVU Service] :', Date.now() - startTime, 'ms');\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @param characterId  ID'player' \n   * @param updates \n   * @param messageId  ID\n   */\n  async updateCharacterStatus(\n    characterId: string,\n    updates: CharacterStatusUpdate,\n    messageId: number = 0,\n  ): Promise<void> {\n    this.ensureInitialized();\n\n    try {\n      const data = await this.loadGameData(messageId);\n\n      if (characterId === 'player') {\n        if (!data.characters.player) {\n          throw new Error('');\n        }\n\n        // \n        if (updates.attributes) {\n          Object.assign(data.characters.player.attributes, updates.attributes);\n        }\n        if (updates.derivedStats) {\n          Object.assign(data.characters.player.derivedStats, updates.derivedStats);\n        }\n        if (updates.bodyParts) {\n          data.characters.player.bodyParts = updates.bodyParts;\n        }\n      } else {\n        //  NPC\n        const npc = data.characters.npcs[characterId];\n        if (!npc) {\n          throw new Error(`NPC ${characterId} `);\n        }\n\n        if (updates.attributes) {\n          Object.assign(npc.attributes, updates.attributes);\n        }\n        if (updates.derivedStats) {\n          Object.assign(npc.derivedStats, updates.derivedStats);\n        }\n        if (updates.bodyParts) {\n          npc.bodyParts = updates.bodyParts;\n        }\n        if (updates.affection !== undefined) {\n          npc.affection = updates.affection;\n        }\n      }\n\n      await this.saveGameData(data, messageId);\n      console.log(`[MVU Service]  ${characterId} `);\n    } catch (error) {\n      console.error(`[MVU Service]  ${characterId} :`, error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @param character \n   * @param messageId  ID\n   */\n  async saveCharacter(character: Character, messageId: number = 0): Promise<void> {\n    this.ensureInitialized();\n\n    try {\n      const data = await this.loadGameData(messageId);\n\n      if (character.type === 'player') {\n        data.characters.player = character;\n      } else {\n        data.characters.npcs[character.id] = character;\n      }\n\n      await this.saveGameData(data, messageId);\n      console.log(`[MVU Service]  ${character.name} `);\n    } catch (error) {\n      console.error(`[MVU Service]  ${character.name} :`, error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   *  NPC\n   * @param npcId NPC ID\n   * @param messageId  ID\n   */\n  async deleteNPC(npcId: string, messageId: number = 0): Promise<void> {\n    this.ensureInitialized();\n\n    try {\n      const data = await this.loadGameData(messageId);\n\n      if (!data.characters.npcs[npcId]) {\n        throw new Error(`NPC ${npcId} `);\n      }\n\n      delete data.characters.npcs[npcId];\n\n      await this.saveGameData(data, messageId);\n      console.log(`[MVU Service] NPC ${npcId} `);\n    } catch (error) {\n      console.error(`[MVU Service]  NPC ${npcId} :`, error);\n      toastr.error(' NPC ');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @param areaId  ID\n   * @param messageId  ID\n   */\n  async updatePlayerLocation(areaId: string, messageId: number = 0): Promise<void> {\n    this.ensureInitialized();\n\n    try {\n      const data = await this.loadGameData(messageId);\n\n      if (!data.game.currentInstanceId) {\n        throw new Error('');\n      }\n\n      const instance = data.instances[data.game.currentInstanceId];\n      if (!instance) {\n        throw new Error('');\n      }\n\n      instance.map.playerLocation = areaId;\n      data.game.currentArea = areaId;\n\n      await this.saveGameData(data, messageId);\n      console.log(`[MVU Service] : ${areaId}`);\n    } catch (error) {\n      console.error('[MVU Service] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @param newMode \n   * @param messageId  ID\n   */\n  async updateGameMode(newMode: 'main' | 'combat' | 'sanctuary' | 'creation', messageId: number = 0): Promise<void> {\n    this.ensureInitialized();\n\n    try {\n      const data = await this.loadGameData(messageId);\n      data.game.mode = newMode;\n      await this.saveGameData(data, messageId);\n      console.log(`[MVU Service] : ${newMode}`);\n    } catch (error) {\n      console.error('[MVU Service] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @param instanceId  ID\n   * @param messageId  ID\n   */\n  async setCurrentInstance(instanceId: string, messageId: number = 0): Promise<void> {\n    this.ensureInitialized();\n\n    try {\n      const data = await this.loadGameData(messageId);\n      data.game.currentInstanceId = instanceId;\n      await this.saveGameData(data, messageId);\n      console.log(`[MVU Service] : ${instanceId}`);\n    } catch (error) {\n      console.error('[MVU Service] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   *  AI  MVU \n   *  AI  MVU \n   * @param message AI \n   * @param messageId  ID\n   */\n  async parseAndUpdateFromMessage(message: string, messageId: number = 0): Promise<MVUGameDataType> {\n    this.ensureInitialized();\n\n    try {\n      //  MVU \n      if (!this.containsMVUCommands(message)) {\n        console.log('[MVU Service]  MVU ');\n        return await this.loadGameData(messageId);\n      }\n\n      //  MVU \n      const currentMvuData = Mvu.getMvuData({ type: 'message', message_id: messageId });\n\n      //  MVU  parseMessage \n      // parseMessage  MVU \n      const newMvuData = await Mvu.parseMessage(message, currentMvuData);\n\n      //  stat_data \n      const validatedData = MVUGameDataSchema.parse((newMvuData?.stat_data as any) || {});\n\n      // \n      await this.saveGameData(validatedData, messageId);\n\n      console.log('[MVU Service] MVU ');\n      return validatedData;\n    } catch (error) {\n      console.error('[MVU Service]  MVU :', error);\n      toastr.error(' AI ');\n      throw error;\n    }\n  }\n\n  /**\n   *  MVU \n   * MVU  {{}} \n   */\n  private containsMVUCommands(message: string): boolean {\n    //  MVU \n    return message.includes('{{') && message.includes('}}');\n  }\n}\n\n// \nexport const mvuService = new MVUService();\n","//  - \n\nimport { useInstanceStore } from '../stores/instanceStore';\nimport type { ImportantEvent } from '../types/instance';\n\n/**\n * \n */\ntype EventImportance = 'low' | 'medium' | 'high';\n\n/**\n * \n *  AI \n */\nclass EventRecordService {\n  private initialized = false;\n  private eventKeywords = ['', '', '', '', '', '', '', ''];\n\n  /**\n   * \n   */\n  initialize(): void {\n    if (this.initialized) {\n      console.log('[Event Record Service] ');\n      return;\n    }\n\n    console.log('[Event Record Service] ');\n    this.initialized = true;\n  }\n\n  /**\n   *  AI \n   * @param instanceId  ID\n   * @param aiOutput AI \n   * @param currentNPCs  NPC ID \n   */\n  async recordEventFromAIOutput(instanceId: string, aiOutput: string, currentNPCs: string[]): Promise<void> {\n    try {\n      // \n      if (!this.containsImportantEvent(aiOutput)) {\n        return;\n      }\n\n      // \n      const summary = this.generateEventSummary(aiOutput);\n\n      // \n      const importance = this.detectImportance(aiOutput);\n\n      // \n      const event: ImportantEvent = {\n        id: this.generateEventId(),\n        summary,\n        timestamp: Date.now(),\n        involvedCharacters: currentNPCs,\n      };\n\n      // \n      const instanceStore = useInstanceStore();\n      const instance = instanceStore.getInstance(instanceId);\n\n      if (!instance) {\n        console.error(`[Event Record Service] : ${instanceId}`);\n        return;\n      }\n\n      // \n      instance.events.push(event);\n\n      // \n      await instanceStore.updateInstance(instanceId, {\n        events: instance.events,\n      });\n\n      console.log(`[Event Record Service] : ${summary} (: ${importance})`);\n    } catch (error) {\n      console.error('[Event Record Service] :', error);\n      // \n    }\n  }\n\n  /**\n   * \n   * @param text \n   * @returns \n   */\n  containsImportantEvent(text: string): boolean {\n    return this.eventKeywords.some(keyword => text.includes(keyword));\n  }\n\n  /**\n   * \n   * @param text AI \n   * @returns \n   */\n  generateEventSummary(text: string): string {\n    // \n    const sentences = text.split(/[\\n]/);\n\n    // \n    for (const sentence of sentences) {\n      const trimmed = sentence.trim();\n\n      // \n      if (trimmed.length < 10 || trimmed.length > 100) {\n        continue;\n      }\n\n      // \n      if (this.eventKeywords.some(keyword => trimmed.includes(keyword))) {\n        return trimmed;\n      }\n    }\n\n    // \n    for (const sentence of sentences) {\n      const trimmed = sentence.trim();\n      if (trimmed.length >= 10 && trimmed.length <= 100) {\n        return trimmed;\n      }\n    }\n\n    //  50 \n    return text.substring(0, 50).trim() + '...';\n  }\n\n  /**\n   * \n   * @param text AI \n   * @returns \n   */\n  detectImportance(text: string): EventImportance {\n    // \n    const highKeywords = ['', '', ''];\n    // \n    const mediumKeywords = ['', '', ''];\n    // \n    const lowKeywords = ['', ''];\n\n    // \n    if (highKeywords.some(keyword => text.includes(keyword))) {\n      return 'high';\n    }\n\n    // \n    if (mediumKeywords.some(keyword => text.includes(keyword))) {\n      return 'medium';\n    }\n\n    // \n    if (lowKeywords.some(keyword => text.includes(keyword))) {\n      return 'low';\n    }\n\n    // \n    return 'low';\n  }\n\n  /**\n   *  ID\n   * @returns  ID\n   */\n  private generateEventId(): string {\n    return `event_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n  }\n\n  /**\n   * \n   * @param instanceId  ID\n   * @returns \n   */\n  getInstanceEvents(instanceId: string): ImportantEvent[] {\n    const instanceStore = useInstanceStore();\n    const instance = instanceStore.getInstance(instanceId);\n\n    if (!instance) {\n      console.error(`[Event Record Service] : ${instanceId}`);\n      return [];\n    }\n\n    return instance.events || [];\n  }\n\n  /**\n   * \n   * @param instanceId  ID\n   * @returns \n   */\n  getImportantEvents(instanceId: string): ImportantEvent[] {\n    const events = this.getInstanceEvents(instanceId);\n\n    //  ImportantEvent  importance \n    // \n    return events.filter(event => {\n      const highKeywords = ['', '', ''];\n      return highKeywords.some(keyword => event.summary.includes(keyword));\n    });\n  }\n}\n\n// \nexport const eventRecordService = new EventRecordService();\n","module.exports = import(\"https://testingcf.jsdelivr.net/npm/klona/+esm\");;","// API  -  API \n\nimport type { APIConfig, MultiAPIConfig } from '../types/api';\n\n/**\n * \n */\nexport type WorldType = 'realWorld' | 'innerWorld' | 'sanctuary';\n\n/**\n * API \n *  API \n */\nclass APIConfigService {\n  private configs: MultiAPIConfig | null = null;\n  private currentWorld: WorldType = 'realWorld';\n  private initialized = false;\n\n  /**\n   * \n   * \n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      console.log('[API Config Service] ');\n      return;\n    }\n\n    try {\n      console.log('[API Config Service] ...');\n      await this.loadConfigs();\n      this.initialized = true;\n      console.log('[API Config Service] ');\n    } catch (error) {\n      console.error('[API Config Service] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  async loadConfigs(): Promise<MultiAPIConfig> {\n    try {\n      const allGlobalVars = getVariables({ type: 'global' });\n      const savedConfigs = allGlobalVars.api_configs as MultiAPIConfig | null;\n\n      if (savedConfigs) {\n        this.configs = savedConfigs;\n        console.log('[API Config Service] :', this.configs);\n      } else {\n        //  null API\n        this.configs = {\n          realWorld: null,\n          innerWorld: null,\n          sanctuary: null,\n        };\n        console.log('[API Config Service]  API');\n      }\n\n      return this.configs;\n    } catch (error) {\n      console.error('[API Config Service] :', error);\n      // \n      this.configs = {\n        realWorld: null,\n        innerWorld: null,\n        sanctuary: null,\n      };\n      return this.configs;\n    }\n  }\n\n  /**\n   * \n   */\n  async saveConfigs(configs: MultiAPIConfig): Promise<void> {\n    try {\n      this.configs = configs;\n      //  insertOrAssignVariables  api_configs \n      await insertOrAssignVariables({ api_configs: configs }, { type: 'global' });\n      console.log('[API Config Service] :', configs);\n      toastr.success('API ');\n    } catch (error) {\n      console.error('[API Config Service] :', error);\n      toastr.error(' API ');\n      throw error;\n    }\n  }\n\n  /**\n   *  API \n   * @returns API  null API\n   */\n  getCurrentAPI(): APIConfig | null {\n    if (!this.configs) {\n      console.warn('[API Config Service]  null');\n      return null;\n    }\n\n    const config = this.configs[this.currentWorld];\n    console.log(`[API Config Service]  (${this.currentWorld})  API :`, config);\n    return config;\n  }\n\n  /**\n   *  API \n   */\n  getWorldAPI(world: WorldType): APIConfig | null {\n    if (!this.configs) {\n      console.warn('[API Config Service]  null');\n      return null;\n    }\n\n    return this.configs[world];\n  }\n\n  /**\n   * \n   */\n  getAllConfigs(): MultiAPIConfig {\n    if (!this.configs) {\n      return {\n        realWorld: null,\n        innerWorld: null,\n        sanctuary: null,\n      };\n    }\n\n    //  Vue \n    return {\n      realWorld: this.configs.realWorld ? { ...this.configs.realWorld } : null,\n      innerWorld: this.configs.innerWorld ? { ...this.configs.innerWorld } : null,\n      sanctuary: this.configs.sanctuary ? { ...this.configs.sanctuary } : null,\n    };\n  }\n\n  /**\n   *  API \n   */\n  async updateWorldAPI(world: WorldType, config: APIConfig | null): Promise<void> {\n    try {\n      if (!this.configs) {\n        await this.loadConfigs();\n      }\n\n      if (this.configs) {\n        this.configs[world] = config;\n        await this.saveConfigs(this.configs);\n        console.log(`[API Config Service]  ${world}  API `);\n      }\n    } catch (error) {\n      console.error(`[API Config Service]  ${world}  API :`, error);\n      throw error;\n    }\n  }\n\n  /**\n   *  API\n   */\n  switchToRealWorld(): void {\n    this.currentWorld = 'realWorld';\n    console.log('[API Config Service]  API');\n  }\n\n  /**\n   *  API\n   */\n  switchToInnerWorld(): void {\n    this.currentWorld = 'innerWorld';\n    console.log('[API Config Service]  API');\n  }\n\n  /**\n   *  API\n   */\n  switchToSanctuary(): void {\n    this.currentWorld = 'sanctuary';\n    console.log('[API Config Service]  API');\n  }\n\n  /**\n   * \n   */\n  getCurrentWorld(): WorldType {\n    return this.currentWorld;\n  }\n\n  /**\n   *  API \n   *  apiAutoSwitchService \n   * @param worldToTest \n   */\n  async testConnection(worldToTest: WorldType): Promise<{ success: boolean; message: string }> {\n    // 1. \n    const originalWorld = this.currentWorld;\n\n    try {\n      console.log(`[API Config Service]  ${worldToTest}  API ...`);\n\n      // 2. \n      //  apiAutoSwitchService \n      if (worldToTest === 'realWorld') this.switchToRealWorld();\n      else if (worldToTest === 'innerWorld') this.switchToInnerWorld();\n      else if (worldToTest === 'sanctuary') this.switchToSanctuary();\n\n      // 3.  generateRaw  custom_api\n      //  apiAutoSwitchService \n      const response = await generateRaw({\n        ordered_prompts: [{ role: 'user', content: '\"\"' }],\n        //  custom_api\n      });\n\n      if (response && response.length > 0) {\n        console.log('[API Config Service] API ');\n        return {\n          success: true,\n          message: 'API ',\n        };\n      } else {\n        console.warn('[API Config Service] API ');\n        return {\n          success: false,\n          message: 'API ',\n        };\n      }\n    } catch (error) {\n      console.error('[API Config Service] API :', error);\n      return {\n        success: false,\n        message: `: ${error instanceof Error ? error.message : ''}`,\n      };\n    } finally {\n      // 4. \n      console.log(`[API Config Service]  API : ${originalWorld}`);\n      if (originalWorld === 'realWorld') this.switchToRealWorld();\n      else if (originalWorld === 'innerWorld') this.switchToInnerWorld();\n      else if (originalWorld === 'sanctuary') this.switchToSanctuary();\n    }\n  }\n\n  /**\n   *  API \n   */\n  validateConfig(config: APIConfig): { valid: boolean; errors: string[] } {\n    const errors: string[] = [];\n\n    if (!config.apiurl || config.apiurl.trim() === '') {\n      errors.push('API ');\n    } else if (!config.apiurl.startsWith('http://') && !config.apiurl.startsWith('https://')) {\n      errors.push('API  http://  https:// ');\n    }\n\n    // API \n    const isLocalBackend = config.apiurl.includes('localhost') || config.apiurl.includes('127.0.0.1');\n    if (!isLocalBackend && (!config.key || config.key.trim() === '')) {\n      errors.push('API ');\n    }\n\n    if (!config.model || config.model.trim() === '') {\n      errors.push('');\n    }\n\n    if (config.temperature < 0 || config.temperature > 2) {\n      errors.push(' 0-2 ');\n    }\n\n    if (config.max_tokens <= 0) {\n      errors.push(' token  0');\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n    };\n  }\n\n  /**\n   *  API\n   */\n  async resetConfigs(): Promise<void> {\n    try {\n      const defaultConfigs: MultiAPIConfig = {\n        realWorld: null,\n        innerWorld: null,\n        sanctuary: null,\n      };\n\n      await this.saveConfigs(defaultConfigs);\n      console.log('[API Config Service] ');\n      toastr.success('API ');\n    } catch (error) {\n      console.error('[API Config Service] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n}\n\n// \nexport const apiConfigService = new APIConfigService();\n","const __WEBPACK_NAMESPACE_OBJECT__ = _;","//  Store - \n\nimport { klona } from 'klona';\nimport _ from 'lodash';\nimport { defineStore } from 'pinia';\nimport { computed, type Ref, ref, watchEffect } from 'vue';\nimport { mvuService } from '../services/mvuService';\nimport type { SceneData } from '../types/instance';\nimport type { DialogueDataType } from '../types/schemas';\n\n/**\n * \n */\nexport type GameMode = 'main' | 'combat' | 'sanctuary' | 'creation';\n\n/**\n *  Store\n */\nexport const useGameStore = defineStore('game', () => {\n  // ====================  ====================\n  const initialized = ref(false);\n  const mode: Ref<GameMode> = ref('main');\n  const currentInstanceId = ref<string | undefined>(undefined);\n  const currentArea = ref<string | undefined>(undefined);\n\n  // \n  const currentScene = ref<SceneData>({\n    background: '',\n    sprites: [],\n    areaId: undefined,\n    description: undefined,\n  });\n\n  // \n  const isStreaming = ref(false);\n  const streamingText = ref('');\n  const streamingDialogue = ref<DialogueDataType | null>(null);\n  const finalDialogue = ref<DialogueDataType | null>(null);\n\n  // ====================  ====================\n  const isInCombat = computed(() => mode.value === 'combat');\n  const isInSanctuary = computed(() => mode.value === 'sanctuary');\n  const isInCreation = computed(() => mode.value === 'creation');\n  const isInMainGame = computed(() => mode.value === 'main');\n\n  // ====================  ====================\n\n  /**\n   * \n   *  MVU \n   */\n  async function initialize(): Promise<void> {\n    if (initialized.value) {\n      console.log('[Game Store] ');\n      return;\n    }\n\n    try {\n      console.log('[Game Store] ...');\n\n      //  MVU \n      await mvuService.initialize();\n\n      // \n      const gameData = await mvuService.loadGameData();\n\n      // \n      mode.value = gameData.game.mode;\n      currentInstanceId.value = gameData.game.currentInstanceId;\n      currentArea.value = gameData.game.currentArea;\n\n      // \n      if (currentInstanceId.value && gameData.instances[currentInstanceId.value]) {\n        const instance = gameData.instances[currentInstanceId.value];\n        const area = instance.map.areas.get(currentArea.value || instance.map.startArea);\n\n        if (area) {\n          currentScene.value = {\n            background: area.background || '',\n            sprites: [],\n            areaId: area.id,\n            description: area.description,\n          };\n        }\n      }\n\n      initialized.value = true;\n      console.log('[Game Store] ');\n\n      //  MVU\n      setupAutoSync();\n    } catch (error) {\n      console.error('[Game Store] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   *  MVU\n   *  watchEffect \n   */\n  function setupAutoSync(): void {\n    // \n    const debouncedSave = _.debounce(async () => {\n      try {\n        const gameData = await mvuService.loadGameData();\n\n        // \n        gameData.game.mode = mode.value;\n        gameData.game.currentInstanceId = currentInstanceId.value;\n        gameData.game.currentArea = currentArea.value;\n\n        //  klona  Proxy \n        await mvuService.saveGameData(klona(gameData));\n        console.log('[Game Store]  MVU ');\n      } catch (error) {\n        console.error('[Game Store] :', error);\n      }\n    }, 1000); // 1 \n\n    // \n    watchEffect(() => {\n      if (!initialized.value) return;\n\n      // \n      debouncedSave();\n    });\n  }\n\n  /**\n   * \n   */\n  async function setMode(newMode: GameMode): Promise<void> {\n    try {\n      mode.value = newMode;\n      await mvuService.updateGameMode(newMode);\n      console.log(`[Game Store] : ${newMode}`);\n    } catch (error) {\n      console.error('[Game Store] :', error);\n      toastr.error('');\n    }\n  }\n\n  /**\n   * \n   */\n  function updateScene(scene: Partial<SceneData>): void {\n    currentScene.value = {\n      ...currentScene.value,\n      ...scene,\n    };\n    console.log('[Game Store] :', currentScene.value);\n  }\n\n  /**\n   * \n   */\n  async function setCurrentInstance(instanceId: string | null): Promise<void> {\n    try {\n      currentInstanceId.value = instanceId || undefined;\n\n      if (instanceId) {\n        await mvuService.setCurrentInstance(instanceId);\n\n        // \n        const { worldBookService } = await import('../services/worldBookService');\n        await worldBookService.activateInnerWorldEntries();\n\n        console.log(`[Game Store] : ${instanceId}`);\n      } else {\n        // \n        const { worldBookService } = await import('../services/worldBookService');\n        await worldBookService.activateRealWorldEntries();\n\n        console.log('[Game Store] ');\n      }\n    } catch (error) {\n      console.error('[Game Store] :', error);\n      toastr.error('');\n    }\n  }\n\n  /**\n   * \n   */\n  async function setCurrentArea(areaId: string): Promise<void> {\n    try {\n      currentArea.value = areaId;\n      await mvuService.updatePlayerLocation(areaId);\n      console.log(`[Game Store] : ${areaId}`);\n    } catch (error) {\n      console.error('[Game Store] :', error);\n      toastr.error('');\n    }\n  }\n\n  /**\n   * \n   * \n   */\n  function updateStreamingDialogue(dialogue: DialogueDataType | null): void {\n    streamingDialogue.value = dialogue;\n    isStreaming.value = dialogue !== null;\n  }\n\n  /**\n   * \n   * \n   */\n  function setFinalDialogue(dialogue: DialogueDataType): void {\n    finalDialogue.value = dialogue;\n    streamingDialogue.value = null;\n    isStreaming.value = false;\n    console.log('[Game Store] :', dialogue);\n  }\n\n  /**\n   * \n   */\n  function updateStreamingText(text: string): void {\n    streamingText.value = text;\n    isStreaming.value = text.length > 0;\n  }\n\n  /**\n   * \n   */\n  function clearStreaming(): void {\n    isStreaming.value = false;\n    streamingText.value = '';\n    streamingDialogue.value = null;\n  }\n\n  /**\n   * \n   * \n   * @param config \n   */\n  async function generateInstance(\n    config: {\n      type?: string;\n      difficulty?: number;\n      customPrompt?: string;\n      areaCount?: number;\n      npcs?: Array<import('../types/instance').CharacterInInstance & { id: string }>;\n    } = {},\n  ): Promise<string> {\n    try {\n      console.log('[Game Store] ...', {\n        type: config.type,\n        difficulty: config.difficulty,\n        areaCount: config.areaCount,\n        npcCount: config.npcs?.length,\n        hasCustomPrompt: !!config.customPrompt,\n      });\n      toastr.info('...');\n\n      //  store\n      const { useInstanceStore } = await import('./instanceStore');\n      const instanceStore = useInstanceStore();\n\n      //  ID\n      const instanceId = `instance_${Date.now()}`;\n\n      // \n      const instanceTypes = ['', '', '', '', '', '', '', ''];\n      const finalType = config.type || instanceTypes[Math.floor(Math.random() * instanceTypes.length)];\n      const finalDifficulty = config.difficulty || Math.floor(Math.random() * 5) + 1;\n      const areaCount = config.areaCount || Math.floor(Math.random() * 6) + 5; // 5-10 \n\n      console.log('[Game Store] :', {\n        instanceId,\n        type: finalType,\n        difficulty: finalDifficulty,\n        areaCount,\n      });\n\n      //  NPC\n      let npcs: Array<import('../types/instance').CharacterInInstance> = [];\n      if (config.npcs) {\n        //  NPC\n        npcs = config.npcs.map(npc => ({\n          characterId: npc.id,\n          character: npc.character,\n          isImportant: (npc.importance || 0) >= 3,\n          importance: npc.importance,\n          source: npc.source,\n          appearanceCount: 0,\n        }));\n        console.log(`[Game Store]  ${npcs.length}  NPC`);\n      } else {\n        //  NPC\n        try {\n          const { npcGenerationCoordinator } = await import('../services/npcGenerationCoordinator');\n\n          //  NPC \n          const npcCount = npcGenerationCoordinator.calculateNPCCount(finalDifficulty);\n          console.log(`[Game Store]  ${npcCount}  NPC`);\n          toastr.info(` ${npcCount}  NPC...`);\n\n          //  NPC\n          const generatedNPCs = await npcGenerationCoordinator.generateRandomNPCs(\n            npcCount,\n            finalType,\n            undefined,\n            (current, total) => {\n              console.log(`[Game Store] NPC : ${current}/${total}`);\n              // \n              toastr.info(` ${current}/${total}  NPC...`, '', {\n                timeOut: 800,\n                extendedTimeOut: 0,\n              });\n            },\n          );\n\n          //  NPC  CharacterInInstance \n          npcs = generatedNPCs.map(npc => {\n            // 1-3\n            const importance = (Math.floor(Math.random() * 3) + 1) as 1 | 2 | 3;\n\n            return {\n              characterId: npc.id,\n              character: npc,\n              isImportant: importance >= 3,\n              importance,\n              appearanceCount: 0,\n            };\n          });\n\n          console.log(`[Game Store]   ${npcs.length}  NPC`);\n          toastr.success(` ${npcs.length}  NPC`, '', { timeOut: 2000 });\n        } catch (error) {\n          // NPC \n          console.error('[Game Store] NPC :', error);\n          toastr.warning('NPC  NPC ');\n          npcs = [];\n        }\n      }\n\n      //  NPC \n      let npcInfo = '';\n      const importantNPCs = npcs.filter(npc => (npc.importance || 0) >= 3);\n\n      if (importantNPCs.length > 0) {\n        npcInfo = '\\n\\n NPC  NPC \\n';\n        importantNPCs.forEach(npc => {\n          npcInfo += `- ${npc.character.name}${npc.importance}/5${npc.character.occupation || ''}${npc.character.background || ''}\\n`;\n        });\n        console.log(`[Game Store]  ${importantNPCs.length}  NPC`);\n      }\n\n      //  AI \n      let prompt = '';\n\n      if (config.customPrompt) {\n        // \n        prompt = `\n${config.customPrompt}\n\n${finalDifficulty}/5\n${areaCount}${npcInfo}\n\n YAML \n\\`\\`\\`yaml\nname: \ntype: ${finalType}\ndifficulty: ${finalDifficulty}\nworldSetting: \nmap:\n  startArea: ID\n  areas:\n    - id: area_1\n      name: \n      description: \n      background: URL GitHub \n      connectedAreas: [area_2, area_3]\n      isDangerous: false\n      relatedNPCs: [npc_id_1, npc_id_2]  #  NPC ID\n  connections:\n    - from: area_1\n      to: area_2\n\\`\\`\\``;\n      } else {\n        // \n        prompt = `${finalType} ${finalDifficulty}/5\n\n\n-  ${areaCount} \n- \n- \n- \n- ${npcInfo ? '\\n-  NPC ' : ''}${npcInfo}\n\n YAML \n\\`\\`\\`yaml\nname: \ntype: ${finalType}\ndifficulty: ${finalDifficulty}\nworldSetting: \nmap:\n  startArea: ID\n  areas:\n    - id: area_1\n      name: \n      description: \n      background: URL GitHub \n      connectedAreas: [area_2, area_3]\n      isDangerous: false\n      relatedNPCs: [npc_id_1, npc_id_2]  #  NPC ID\n  connections:\n    - from: area_1\n      to: area_2\n\\`\\`\\``;\n      }\n\n      console.log('[Game Store]  AI  ()');\n      toastr.info('...', '');\n\n      //  AI \n      const text = await generate({\n        user_input: prompt,\n        should_stream: false, // \n      });\n\n      console.log('[Game Store] AI ');\n\n      //  YAML \n      const yamlMatch = text.match(/```yaml\\n([\\s\\S]*?)\\n```/);\n      if (!yamlMatch) {\n        console.error('[Game Store]  YAML ');\n        throw new Error(' YAML ');\n      }\n\n      const YAML = (await import('yaml')).default;\n      const generatedData = YAML.parse(yamlMatch[1]);\n\n      console.log('[Game Store] :', {\n        name: generatedData.name,\n        areaCount: generatedData.map?.areas?.length,\n      });\n\n      // \n      const areas = new Map<string, any>();\n      if (generatedData.map?.areas) {\n        generatedData.map.areas.forEach((area: any) => {\n          areas.set(area.id, {\n            ...area,\n            isDiscovered: area.id === generatedData.map.startArea, // \n            relatedNPCs: area.relatedNPCs || [], //  AI  NPC \n          });\n        });\n      }\n\n      const instanceRecord: import('../types/instance').InstanceRecord = {\n        id: instanceId,\n        name: generatedData.name || `${finalType}`,\n        type: finalType,\n        difficulty: finalDifficulty as import('../types/instance').InstanceDifficulty,\n        worldSetting: generatedData.worldSetting || '',\n        map: {\n          areas,\n          connections: generatedData.map?.connections || [],\n          playerLocation: generatedData.map?.startArea || 'area_1',\n          startArea: generatedData.map?.startArea || 'area_1',\n        },\n        characters: npcs, //  NPC \n        events: [],\n        mementos: [], // \n        status: 'draft', // \n        startTime: Date.now(),\n        isActive: true,\n        customPrompt: config.customPrompt,\n      };\n\n      console.log('[Game Store]  instanceStore ');\n\n      //  instanceStore  MVU\n      await instanceStore.addInstance(instanceRecord);\n\n      console.log('[Game Store] :', {\n        instanceId,\n        name: instanceRecord.name,\n        areaCount: areas.size,\n      });\n\n      // \n      await setCurrentInstance(instanceId);\n\n      // \n      await setCurrentArea(instanceRecord.map.startArea);\n\n      // \n      const startArea = areas.get(instanceRecord.map.startArea);\n      if (startArea) {\n        updateScene({\n          background: startArea.background || '',\n          sprites: [],\n          areaId: startArea.id,\n          description: startArea.description,\n        });\n      }\n\n      console.log('[Game Store]  :', {\n        instanceId,\n        name: instanceRecord.name,\n        type: finalType,\n        difficulty: finalDifficulty,\n        areaCount: areas.size,\n        npcCount: npcs.length,\n      });\n\n      toastr.success(`${instanceRecord.name}`, '');\n\n      return instanceId;\n    } catch (error) {\n      console.error('[Game Store] :', {\n        error: error instanceof Error ? error.message : String(error),\n        stack: error instanceof Error ? error.stack : undefined,\n      });\n      toastr.error('', '');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  function reset(): void {\n    initialized.value = false;\n    mode.value = 'main';\n    currentInstanceId.value = undefined;\n    currentArea.value = undefined;\n    currentScene.value = {\n      background: '',\n      sprites: [],\n      areaId: undefined,\n      description: undefined,\n    };\n    clearStreaming();\n    console.log('[Game Store] ');\n  }\n\n  // ====================  ====================\n  return {\n    // \n    initialized,\n    mode,\n    currentInstanceId,\n    currentArea,\n    currentScene,\n    isStreaming,\n    streamingText,\n    streamingDialogue,\n    finalDialogue,\n\n    // \n    isInCombat,\n    isInSanctuary,\n    isInCreation,\n    isInMainGame,\n\n    // \n    initialize,\n    setMode,\n    updateScene,\n    setCurrentInstance,\n    setCurrentArea,\n    updateStreamingDialogue,\n    setFinalDialogue,\n    updateStreamingText,\n    clearStreaming,\n    generateInstance,\n    reset,\n  };\n});\n","module.exports = toastr;","// COC7 \n\nimport type { COC7Attributes, DerivedStats } from '../types/character';\nimport type { DiceRoll, RollResult } from '../types/combat';\n\n/**\n *  1d100\n */\nexport function rollDice(): number {\n  return Math.floor(Math.random() * 100) + 1;\n}\n\n/**\n * \n * @param roll  (1-100)\n * @param skill  (0-100)\n * @returns \n */\nexport function evaluateRoll(roll: number, skill: number): RollResult {\n  //  1\n  if (roll === 1) {\n    return 'critical_success';\n  }\n\n  //  100 96-99  50\n  if (roll === 100 || (roll >= 96 && skill < 50)) {\n    return 'critical_failure';\n  }\n\n  //   /5\n  if (roll <= skill / 5) {\n    return 'extreme_success';\n  }\n\n  //   /2\n  if (roll <= skill / 2) {\n    return 'hard_success';\n  }\n\n  //   \n  if (roll <= skill) {\n    return 'success';\n  }\n\n  // \n  return 'failure';\n}\n\n/**\n * \n * @param skillName \n * @param skillValue \n * @returns \n */\nexport function performSkillCheck(skillName: string, skillValue: number): DiceRoll {\n  const roll = rollDice();\n  const result = evaluateRoll(roll, skillValue);\n\n  return {\n    roll,\n    skill: skillValue,\n    result,\n    skillName,\n    timestamp: Date.now(),\n  };\n}\n\n/**\n *  (MOV)\n * @param attributes COC7 \n * @returns \n */\nexport function calculateMovement(attributes: COC7Attributes): number {\n  const { STR, DEX, SIZ } = attributes;\n\n  //  STR  DEX  SIZ\n  if (STR < SIZ && DEX < SIZ) {\n    return 7;\n  }\n\n  //  STR  DEX  SIZ 2SIZ\n  if ((STR >= SIZ || DEX >= SIZ) && STR < 2 * SIZ && DEX < 2 * SIZ) {\n    return 8;\n  }\n\n  //  STR  DEX  2SIZ\n  if (STR >= 2 * SIZ && DEX >= 2 * SIZ) {\n    return 9;\n  }\n\n  return 8; // \n}\n\n/**\n *  (DB)  (BUILD)\n * @param attributes COC7 \n * @returns { DB, BUILD }\n */\nexport function calculateDamageBonus(attributes: COC7Attributes): { DB: string; BUILD: number } {\n  const sum = attributes.STR + attributes.SIZ;\n\n  if (sum <= 64) {\n    return { DB: '-2', BUILD: -2 };\n  } else if (sum <= 84) {\n    return { DB: '-1', BUILD: -1 };\n  } else if (sum <= 124) {\n    return { DB: '0', BUILD: 0 };\n  } else if (sum <= 164) {\n    return { DB: '+1d4', BUILD: 1 };\n  } else if (sum <= 204) {\n    return { DB: '+1d6', BUILD: 2 };\n  } else if (sum <= 284) {\n    return { DB: '+2d6', BUILD: 3 };\n  } else if (sum <= 364) {\n    return { DB: '+3d6', BUILD: 4 };\n  } else if (sum <= 444) {\n    return { DB: '+4d6', BUILD: 5 };\n  } else {\n    return { DB: '+5d6', BUILD: 6 };\n  }\n}\n\n/**\n * \n * @param attributes COC7 \n * @returns \n */\nexport function calculateDerivedStats(attributes: COC7Attributes): DerivedStats {\n  const { CON, SIZ, POW } = attributes;\n\n  //  HP = (CON + SIZ) / 10\n  const maxHP = Math.floor((CON + SIZ) / 10);\n\n  //  MP = POW / 5\n  const maxMP = Math.floor(POW / 5);\n\n  //  SAN = POW\n  const maxSAN = POW;\n\n  //  MOV\n  const MOV = calculateMovement(attributes);\n\n  //  DB  BUILD\n  const { DB, BUILD } = calculateDamageBonus(attributes);\n\n  return {\n    HP: maxHP,\n    maxHP,\n    MP: maxMP,\n    maxMP,\n    SAN: maxSAN,\n    maxSAN,\n    MOV,\n    DB,\n    BUILD,\n  };\n}\n\n/**\n *  COC7 \n * @param method '3d6x5'  '2d6+6x5'\n * @returns COC7 \n */\nexport function generateRandomAttributes(method: '3d6x5' | '2d6+6x5' = '3d6x5'): COC7Attributes {\n  const rollAttribute = (): number => {\n    if (method === '3d6x5') {\n      // 3d6  5\n      const roll =\n        Math.floor(Math.random() * 6) + 1 + (Math.floor(Math.random() * 6) + 1) + (Math.floor(Math.random() * 6) + 1);\n      return roll * 5;\n    } else {\n      // (2d6 + 6)  5\n      const roll = Math.floor(Math.random() * 6) + 1 + (Math.floor(Math.random() * 6) + 1) + 6;\n      return roll * 5;\n    }\n  };\n\n  return {\n    STR: rollAttribute(),\n    CON: rollAttribute(),\n    SIZ: rollAttribute(),\n    DEX: rollAttribute(),\n    APP: rollAttribute(),\n    INT: rollAttribute(),\n    POW: rollAttribute(),\n    EDU: rollAttribute(),\n    LUK: rollAttribute(),\n  };\n}\n\n/**\n * \n * @param attacker \n * @param defender \n * @returns 'attacker_wins' | 'defender_wins' | 'tie'\n */\nexport function resolveOpposedRoll(\n  attacker: number,\n  defender: number,\n): { result: 'attacker_wins' | 'defender_wins' | 'tie'; attackerRoll: DiceRoll; defenderRoll: DiceRoll } {\n  const attackerRoll = performSkillCheck('', attacker);\n  const defenderRoll = performSkillCheck('', defender);\n\n  // \n  const successLevels: Record<RollResult, number> = {\n    critical_success: 5,\n    extreme_success: 4,\n    hard_success: 3,\n    success: 2,\n    failure: 1,\n    critical_failure: 0,\n  };\n\n  const attackerLevel = successLevels[attackerRoll.result];\n  const defenderLevel = successLevels[defenderRoll.result];\n\n  let result: 'attacker_wins' | 'defender_wins' | 'tie';\n  if (attackerLevel > defenderLevel) {\n    result = 'attacker_wins';\n  } else if (defenderLevel > attackerLevel) {\n    result = 'defender_wins';\n  } else {\n    result = 'tie';\n  }\n\n  return { result, attackerRoll, defenderRoll };\n}\n\n/**\n * \n * @param baseDamage \n * @param armor \n * @returns \n */\nexport function calculateDamage(baseDamage: number, armor: number = 0): number {\n  const damage = Math.max(0, baseDamage - armor);\n  return damage;\n}\n\n/**\n * \n * @param currentSAN \n * @param sanLoss \n * @returns \n */\nexport function checkInsanity(\n  currentSAN: number,\n  sanLoss: number,\n): {\n  isInsane: boolean;\n  type?: 'temporary' | 'indefinite' | 'permanent';\n} {\n  const newSAN = currentSAN - sanLoss;\n\n  //  5+ \n  if (sanLoss >= 5) {\n    return { isInsane: true, type: 'temporary' };\n  }\n\n  //  0\n  if (newSAN <= 0) {\n    return { isInsane: true, type: 'permanent' };\n  }\n\n  //  POW  1/5\n  //  POW \n  if (newSAN < 20) {\n    return { isInsane: true, type: 'indefinite' };\n  }\n\n  return { isInsane: false };\n}\n\n/**\n * \n * @param result \n * @returns \n */\nexport function getRollResultText(result: RollResult): string {\n  const texts: Record<RollResult, string> = {\n    critical_success: '',\n    extreme_success: '',\n    hard_success: '',\n    success: '',\n    failure: '',\n    critical_failure: '',\n  };\n  return texts[result];\n}\n","module.exports = z;","// API \n//  API  API\n\nimport { apiConfigService, type WorldType } from '../services/apiConfigService';\n\n/**\n * \n */\nconst LOG_CONFIG = {\n  /**  */\n  PREFIX: '[API Context]',\n  /**  */\n  SLOW_THRESHOLD: 1000,\n  /**  */\n  DEBUG_MODE: false,\n};\n\n/**\n * \n */\nenum OperationType {\n  SWITCH = '',\n  RESTORE = '',\n  COMPLETE = '',\n  FAILED = '',\n  SKIP = '',\n  ENTER = '',\n  EXIT = '',\n}\n\n/**\n * \n *\n * \n */\nclass ContextLogger {\n  /**\n   * \n   */\n  logSwitchStart(level: number, from: WorldType, to: WorldType): void {\n    console.log(`${LOG_CONFIG.PREFIX} L${level}: ${OperationType.SWITCH} ${from}  ${to}`);\n\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}:  ${to}`);\n    }\n  }\n\n  /**\n   * \n   */\n  logSwitchComplete(level: number, world: WorldType): void {\n    console.log(`${LOG_CONFIG.PREFIX} L${level}: ${OperationType.COMPLETE} : ${world}`);\n\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}: `);\n    }\n  }\n\n  /**\n   * \n   */\n  logSkipSwitch(level: number, world: WorldType): void {\n    console.log(`${LOG_CONFIG.PREFIX} L${level}: ${OperationType.SKIP}  ${world}`);\n\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}: `);\n    }\n  }\n\n  /**\n   * \n   */\n  logRestoreStart(level: number, from: WorldType, to: WorldType): void {\n    console.log(`${LOG_CONFIG.PREFIX} L${level}: ${OperationType.RESTORE} ${from}  ${to}`);\n\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}:  ${to}`);\n    }\n  }\n\n  /**\n   * \n   */\n  logRestoreComplete(level: number, world: WorldType): void {\n    console.log(`${LOG_CONFIG.PREFIX} L${level}: ${OperationType.COMPLETE} : ${world}`);\n\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}: `);\n    }\n  }\n\n  /**\n   * \n   */\n  logEnter(level: number, from: WorldType, to: WorldType): void {\n    console.log(`${LOG_CONFIG.PREFIX} L${level}: ${OperationType.ENTER}  ${from}  ${to}`);\n\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}: : ${level}`);\n    }\n  }\n\n  /**\n   * \n   */\n  logExit(level: number, from: WorldType, to: WorldType): void {\n    console.log(`${LOG_CONFIG.PREFIX} L${level}: ${OperationType.EXIT}  ${from}  ${to}`);\n\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}: : ${level - 1}`);\n    }\n  }\n\n  /**\n   * \n   */\n  logCallbackSuccess(level: number, duration: number): void {\n    const isSlow = duration > LOG_CONFIG.SLOW_THRESHOLD;\n    const slowMarker = isSlow ? '  ' : '';\n\n    console.log(\n      `${LOG_CONFIG.PREFIX} L${level}: ${OperationType.COMPLETE}  (: ${duration.toFixed(2)}ms)${slowMarker}`,\n    );\n\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}:  - : ${duration.toFixed(2)}ms`);\n    }\n\n    if (isSlow) {\n      console.warn(\n        `${LOG_CONFIG.PREFIX} L${level}:  ${duration.toFixed(2)}ms  ${LOG_CONFIG.SLOW_THRESHOLD}ms`,\n      );\n    }\n  }\n\n  /**\n   * \n   */\n  logCallbackError(level: number, duration: number, error: unknown): void {\n    console.error(\n      `${LOG_CONFIG.PREFIX} L${level}: ${OperationType.FAILED}  (: ${duration.toFixed(2)}ms):`,\n      error,\n    );\n\n    if (error instanceof Error && error.stack) {\n      console.error(`${LOG_CONFIG.PREFIX} L${level}: :`, error.stack);\n    }\n\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}: :`, {\n        name: error instanceof Error ? error.name : 'Unknown',\n        message: error instanceof Error ? error.message : String(error),\n        duration: `${duration.toFixed(2)}ms`,\n      });\n    }\n  }\n\n  /**\n   * \n   */\n  logCriticalError(level: number, message: string, error?: unknown): void {\n    console.error(`${LOG_CONFIG.PREFIX} L${level}: [] ${message}`, error || '');\n\n    if (error instanceof Error && error.stack) {\n      console.error(`${LOG_CONFIG.PREFIX} L${level}: :`, error.stack);\n    }\n\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}: :`, {\n        message,\n        error: error instanceof Error ? error.message : String(error),\n      });\n    }\n  }\n\n  /**\n   * \n   */\n  logWarning(level: number, message: string, details?: unknown): void {\n    console.warn(`${LOG_CONFIG.PREFIX} L${level}: ${message}`, details || '');\n\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}: :`, details);\n    }\n  }\n\n  /**\n   * \n   */\n  logDebug(level: number, message: string, data?: unknown): void {\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] L${level}: ${message}`, data || '');\n    }\n  }\n\n  /**\n   * \n   */\n  logStackState(stack: WorldType[]): void {\n    if (LOG_CONFIG.DEBUG_MODE) {\n      console.debug(`${LOG_CONFIG.PREFIX} [DEBUG] :`, {\n        depth: stack.length,\n        stack: [...stack],\n      });\n    }\n  }\n}\n\n// \nconst logger = new ContextLogger();\n\n/**\n * \n *\n *  apiConfigService \n * \n *\n * @param world \n * @throws  apiConfigService \n *\n * @internal\n *\n * @example\n * switchToWorld('realWorld'); //  apiConfigService.switchToRealWorld()\n * switchToWorld('innerWorld'); //  apiConfigService.switchToInnerWorld()\n * switchToWorld('sanctuary'); //  apiConfigService.switchToSanctuary()\n */\nfunction switchToWorld(world: WorldType): void {\n  // 9.1: \n  try {\n    switch (world) {\n      case 'realWorld':\n        apiConfigService.switchToRealWorld();\n        break;\n      case 'innerWorld':\n        apiConfigService.switchToInnerWorld();\n        break;\n      case 'sanctuary':\n        apiConfigService.switchToSanctuary();\n        break;\n    }\n  } catch (error) {\n    // \n    console.error(`${LOG_CONFIG.PREFIX}  ${world} :`, error);\n    // 9.1: \n    toastr.error(` ${world} API API `);\n    throw error;\n  }\n}\n\n/**\n * \n *\n *  apiConfigService \n *\n * @returns  'realWorld'\n *\n * @internal\n */\nfunction safeGetCurrentWorld(): WorldType {\n  // 9.1:  getCurrentWorld \n  try {\n    return apiConfigService.getCurrentWorld();\n  } catch (error) {\n    // \n    console.warn(`${LOG_CONFIG.PREFIX}  realWorld:`, error);\n    // 9.1: \n    toastr.warning(' API ');\n    return 'realWorld';\n  }\n}\n\n/**\n * API \n *\n *  API \n * \n *\n * \n * - \n * - \n * - \n * - \n */\nclass APIContextManager {\n  /**\n   * \n   *\n   * \n   * \n   *\n   * @private\n   */\n  private contextStack: WorldType[] = [];\n\n  /**\n   *  API \n   *\n   * \n   * 1. \n   * 2.  API \n   * 3. \n   * 4.  finally \n   *\n   * \n   * - \n   * - \n   *\n   * \n   * - \n   * - realWorld\n   * - \n   *\n   * @template T \n   * @param targetWorld  'realWorld' | 'innerWorld' | 'sanctuary' \n   * @param callback  Promise \n   * @returns Promise<T> \n   *\n   * @throws \n   *\n   * @example\n   * // \n   * const result = await apiContextManager.withContext('realWorld', async () => {\n   *   return await generate({ user_input: 'test' });\n   * });\n   *\n   * @example\n   * // \n   * await apiContextManager.withContext('realWorld', async () => {\n   *   console.log('L1: realWorld');\n   *\n   *   await apiContextManager.withContext('innerWorld', async () => {\n   *     console.log('L2: innerWorld');\n   *   });\n   *\n   *   console.log('L1:  realWorld');\n   * });\n   *\n   * @example\n   * // \n   * await apiContextManager.withContext('realWorld', async () => {\n   *   await apiContextManager.withContext('innerWorld', async () => {\n   *     await apiContextManager.withContext('sanctuary', async () => {\n   *       console.log('L3: sanctuary');\n   *     });\n   *     console.log('L2:  innerWorld');\n   *   });\n   *   console.log('L1:  realWorld');\n   * });\n   */\n  async withContext<T>(targetWorld: WorldType, callback: () => Promise<T> | T): Promise<T> {\n    // 9.1: \n    const currentWorld = safeGetCurrentWorld();\n\n    // 7.2: \n    this.contextStack.push(currentWorld);\n    // 7.2: \n    const level = this.contextStack.length;\n\n    // \n    logger.logStackState(this.contextStack);\n\n    // \n    if (currentWorld === targetWorld && level === 1) {\n      // 11.1: \n      logger.logSkipSwitch(level, targetWorld);\n\n      const startTime = performance.now();\n\n      try {\n        const result = await callback();\n        // 11.2: \n        const duration = performance.now() - startTime;\n        logger.logCallbackSuccess(level, duration);\n\n        return result;\n      } catch (error) {\n        // 11.2: \n        const duration = performance.now() - startTime;\n        logger.logCallbackError(level, duration, error);\n        // 7.3: \n        throw error;\n      } finally {\n        // 7.2: \n        this.contextStack.pop();\n        logger.logStackState(this.contextStack);\n      }\n    }\n\n    // 11.1: \n    logger.logEnter(level, currentWorld, targetWorld);\n\n    const startTime = performance.now();\n\n    try {\n      // 11.1: \n      logger.logSwitchStart(level, currentWorld, targetWorld);\n      // \n      switchToWorld(targetWorld);\n      // 11.1: \n      logger.logSwitchComplete(level, targetWorld);\n\n      // 11.3: \n      logger.logDebug(level, '', { targetWorld, currentConfig: apiConfigService.getCurrentWorld() });\n\n      // \n      const result = await callback();\n\n      // 11.2: \n      const duration = performance.now() - startTime;\n      logger.logCallbackSuccess(level, duration);\n\n      return result;\n    } catch (error) {\n      // 11.2: \n      const duration = performance.now() - startTime;\n      logger.logCallbackError(level, duration, error);\n      // 7.3: \n      throw error;\n    } finally {\n      // 7.2: \n      const restoreWorld = this.contextStack.pop();\n\n      if (restoreWorld) {\n        // 11.1: \n        logger.logExit(level, targetWorld, restoreWorld);\n\n        // 9.2:  finally \n        try {\n          // 11.1: \n          logger.logRestoreStart(level, targetWorld, restoreWorld);\n          // 7.3: \n          switchToWorld(restoreWorld);\n          // 11.1: \n          logger.logRestoreComplete(level, restoreWorld);\n\n          // 11.3: \n          logger.logDebug(level, '', { restoreWorld, currentConfig: apiConfigService.getCurrentWorld() });\n        } catch (restoreError) {\n          // 9.2: \n          logger.logCriticalError(level, ` ${restoreWorld} `, restoreError);\n\n          // 9.2:  (realWorld)\n          try {\n            logger.logWarning(level, ' realWorld');\n            switchToWorld('realWorld');\n            logger.logRestoreComplete(level, 'realWorld');\n            toastr.warning('API ');\n          } catch (fallbackError) {\n            // 9.2: \n            logger.logCriticalError(level, '', fallbackError);\n            toastr.error('API ');\n          }\n        }\n      } else {\n        // \n        logger.logCriticalError(level, '');\n      }\n\n      // \n      logger.logStackState(this.contextStack);\n    }\n  }\n\n  /**\n   * \n   *\n   *  0 \n   *\n   * @returns 0 1 \n   *\n   * @example\n   * console.log(apiContextManager.getStackDepth()); // 0\n   *\n   * await apiContextManager.withContext('realWorld', async () => {\n   *   console.log(apiContextManager.getStackDepth()); // 1\n   *\n   *   await apiContextManager.withContext('innerWorld', async () => {\n   *     console.log(apiContextManager.getStackDepth()); // 2\n   *   });\n   * });\n   */\n  getStackDepth(): number {\n    return this.contextStack.length;\n  }\n}\n\n// 7.4:  apiContextManager \nconst apiContextManager = new APIContextManager();\n\n/**\n * \n *\n * \n * - \n * - \n * - \n * - \n *\n * @example\n * enableDebugMode();\n * await withAPIContext('realWorld', async () => {\n *   // \n * });\n */\nexport function enableDebugMode(): void {\n  LOG_CONFIG.DEBUG_MODE = true;\n  console.log(`${LOG_CONFIG.PREFIX} `);\n}\n\n/**\n * \n *\n * @example\n * disableDebugMode();\n */\nexport function disableDebugMode(): void {\n  LOG_CONFIG.DEBUG_MODE = false;\n  console.log(`${LOG_CONFIG.PREFIX} `);\n}\n\n/**\n * \n *\n * \n *\n * @param threshold  1000ms\n *\n * @example\n * setSlowThreshold(500); //  500ms\n */\nexport function setSlowThreshold(threshold: number): void {\n  LOG_CONFIG.SLOW_THRESHOLD = threshold;\n  console.log(`${LOG_CONFIG.PREFIX}  ${threshold}ms`);\n}\n\n/**\n * \n *\n * @returns \n *\n * @example\n * const config = getLogConfig();\n * console.log(':', config.DEBUG_MODE);\n * console.log(':', config.SLOW_THRESHOLD);\n */\nexport function getLogConfig(): Readonly<typeof LOG_CONFIG> {\n  return { ...LOG_CONFIG };\n}\n\n/**\n *  API \n *\n *  API \n * 1. \n * 2.  API \n * 3. \n * 4. \n *\n * \n *\n * @template T  Promise\n * @param targetWorld 'realWorld' | 'innerWorld' | 'sanctuary'\n * @param callback  Promise\n * @returns Promise\n *\n * @throws \n *\n * @example\n * //  API \n * const map = await withAPIContext('realWorld', async () => {\n *   const text = await generate({\n *     user_input: '',\n *     should_stream: false\n *   });\n *   return parseMapData(text);\n * });\n *\n * @example\n * // \n * await withAPIContext('realWorld', async () => {\n *   console.log(' realWorld API');\n *\n *   await withAPIContext('innerWorld', async () => {\n *     console.log(' innerWorld API');\n *   });\n *\n *   console.log(' realWorld API');\n * });\n *\n * @example\n * // \n * try {\n *   await withAPIContext('innerWorld', async () => {\n *     throw new Error('');\n *   });\n * } catch (error) {\n *   console.error('');\n * }\n *\n * @example\n * // \n * const result = await withAPIContext('sanctuary', () => {\n *   return '';\n * });\n */\nexport const withAPIContext = apiContextManager.withContext.bind(apiContextManager);\n\n/**\n * API \n *\n * \n *\n * @example\n * // \n * const depth = apiContextManager.getStackDepth();\n * console.log(`: ${depth}`);\n */\nexport { apiContextManager };\n\n/**\n * \n *\n *  API\n *\n * - `realWorld`:  AI GPT-4\n * - `innerWorld`:  AI Claude\n * - `sanctuary`:  AI\n *\n * @see {@link apiConfigService} \n */\nexport type { WorldType };\n\n// ============================================================================\n// \n// ============================================================================\n\n/**\n * # API \n *\n * ## \n *\n * `withAPIContext`  API \n *  AI \n *\n * ** AI **\n * -    AIrealWorld\n * -    AIinnerWorld\n * -  NPC   AIsanctuary\n *\n * ---\n *\n * ## \n *\n * ###  1 API \n *\n * ```typescript\n * // realWorldMapService.ts\n * import { withAPIContext } from '../utils/apiContext';\n * import { generate } from '../api/generate';\n *\n * class RealWorldMapService {\n *   async generateMap(character: PlayerCharacter): Promise<MapData> {\n *     //  realWorld API \n *     return await withAPIContext('realWorld', async () => {\n *       console.log('[RealWorldMapService] ...');\n *\n *       const prompt = this.buildPrompt(character);\n *\n *       //  generate()  realWorld API\n *       const text = await generate({\n *         user_input: prompt,\n *         should_stream: false,\n *       });\n *\n *       return this.parseMapData(text);\n *     });\n *   }\n *\n *   private buildPrompt(character: PlayerCharacter): string {\n *     return ` ${character.name} ...`;\n *   }\n *\n *   private parseMapData(text: string): MapData {\n *     //  AI \n *     return JSON.parse(text);\n *   }\n * }\n * ```\n *\n * ###  2 API \n *\n * ```typescript\n * // npcGenerationCoordinator.ts\n * import { withAPIContext, type WorldType } from '../utils/apiContext';\n * import { generate } from '../api/generate';\n *\n * class NPCGenerationCoordinator {\n *   async generateNPC(config: NPCGenerationConfig): Promise<NPC> {\n *     //  NPC  API\n *     const targetWorld = this.determineWorldType(config);\n *\n *     return await withAPIContext(targetWorld, async () => {\n *       console.log(`[NPCCoordinator]  ${targetWorld} NPC...`);\n *\n *       const prompt = this.buildPrompt(config);\n *\n *       const text = await generate({\n *         user_input: prompt,\n *         should_stream: false,\n *       });\n *\n *       return this.parseNPC(text);\n *     });\n *   }\n *\n *   private determineWorldType(config: NPCGenerationConfig): WorldType {\n *     //  NPC  API\n *     if (config.location?.is_sanctuary) {\n *       return 'sanctuary';\n *     } else if (config.location?.is_inner_world) {\n *       return 'innerWorld';\n *     } else {\n *       return 'realWorld';\n *     }\n *   }\n *\n *   private buildPrompt(config: NPCGenerationConfig): string {\n *     return ` NPC${config.name}${config.occupation}...`;\n *   }\n *\n *   private parseNPC(text: string): NPC {\n *     return JSON.parse(text);\n *   }\n * }\n * ```\n *\n * ---\n *\n * ## \n *\n * ###  3\n *\n * ```typescript\n * import { withAPIContext } from '../utils/apiContext';\n * import { generate } from '../api/generate';\n *\n * async function generateMapWithRetry(prompt: string): Promise<MapData> {\n *   const maxRetries = 3;\n *   let lastError: Error | null = null;\n *\n *   for (let i = 0; i < maxRetries; i++) {\n *     try {\n *       // withAPIContext \n *       return await withAPIContext('realWorld', async () => {\n *         const text = await generate({\n *           user_input: prompt,\n *           should_stream: false,\n *         });\n *\n *         if (!text || text.trim() === '') {\n *           throw new Error('AI ');\n *         }\n *\n *         return parseMapData(text);\n *       });\n *     } catch (error) {\n *       lastError = error as Error;\n *       console.warn(` ( ${i + 1}/${maxRetries}):`, error);\n *\n *       // \n *       if (i < maxRetries - 1) {\n *         await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));\n *       }\n *     }\n *   }\n *\n *   // \n *   toastr.error('');\n *   throw lastError || new Error('');\n * }\n * ```\n *\n * ###  4 API \n *\n * ```typescript\n * import { withAPIContext } from '../utils/apiContext';\n * import { generate } from '../api/generate';\n *\n * async function safeGenerate(prompt: string): Promise<string | null> {\n *   try {\n *     return await withAPIContext('realWorld', async () => {\n *       return await generate({\n *         user_input: prompt,\n *         should_stream: false,\n *       });\n *     });\n *   } catch (error) {\n *     // withAPIContext \n *     // \n *\n *     if (error instanceof Error) {\n *       if (error.message.includes('API ')) {\n *         toastr.error('API ');\n *         console.error('API :', error);\n *       } else if (error.message.includes('')) {\n *         toastr.error('');\n *         console.error(':', error);\n *       } else {\n *         toastr.error('');\n *         console.error(':', error);\n *       }\n *     }\n *\n *     return null;\n *   }\n * }\n * ```\n *\n * ---\n *\n * ## \n *\n * ###  5\n *\n * ```typescript\n * import { withAPIContext } from '../utils/apiContext';\n * import { generate } from '../api/generate';\n *\n * async function generateComplexScene(): Promise<Scene> {\n *   //  realWorld API \n *   return await withAPIContext('realWorld', async () => {\n *     console.log('L1: ');\n *\n *     const realWorldPrompt = '';\n *     const framework = await generate({\n *       user_input: realWorldPrompt,\n *       should_stream: false,\n *     });\n *\n *     //  innerWorld API \n *     const fantasyElements = await withAPIContext('innerWorld', async () => {\n *       console.log('L2: ');\n *\n *       const innerWorldPrompt = '';\n *       return await generate({\n *         user_input: innerWorldPrompt,\n *         should_stream: false,\n *       });\n *     });\n *\n *     console.log('L1:  realWorld');\n *\n *     //  realWorld API\n *     return {\n *       framework: parseFramework(framework),\n *       fantasyElements: parseElements(fantasyElements),\n *     };\n *   });\n * }\n * ```\n *\n * ###  6\n *\n * ```typescript\n * import { withAPIContext } from '../utils/apiContext';\n * import { generate } from '../api/generate';\n *\n * async function generateMultiLayerContent(): Promise<Content> {\n *   return await withAPIContext('realWorld', async () => {\n *     console.log('L1: realWorld - ');\n *     const base = await generate({ user_input: '' });\n *\n *     const enhanced = await withAPIContext('innerWorld', async () => {\n *       console.log('L2: innerWorld - ');\n *       const middle = await generate({ user_input: '' });\n *\n *       const special = await withAPIContext('sanctuary', async () => {\n *         console.log('L3: sanctuary - ');\n *         return await generate({ user_input: '' });\n *       });\n *\n *       console.log('L2:  innerWorld');\n *       return { middle, special };\n *     });\n *\n *     console.log('L1:  realWorld');\n *     return { base, enhanced };\n *   });\n * }\n * ```\n *\n * ---\n *\n * ## \n *\n * ###  7\n *\n * ```typescript\n * import { withAPIContext } from '../utils/apiContext';\n * import { generate } from '../api/generate';\n *\n * async function batchGenerateNPCs(configs: NPCConfig[]): Promise<NPC[]> {\n *   // \n *   const groupedConfigs = _.groupBy(configs, config => {\n *     if (config.is_sanctuary) return 'sanctuary';\n *     if (config.is_inner_world) return 'innerWorld';\n *     return 'realWorld';\n *   });\n *\n *   const results: NPC[] = [];\n *\n *   // \n *   for (const [worldType, worldConfigs] of Object.entries(groupedConfigs)) {\n *     const worldNPCs = await withAPIContext(worldType as WorldType, async () => {\n *       console.log(` ${worldConfigs.length}  ${worldType} NPC`);\n *\n *       //  NPC\n *       return await Promise.all(\n *         worldConfigs.map(async config => {\n *           const text = await generate({\n *             user_input: buildNPCPrompt(config),\n *             should_stream: false,\n *           });\n *           return parseNPC(text);\n *         })\n *       );\n *     });\n *\n *     results.push(...worldNPCs);\n *   }\n *\n *   return results;\n * }\n * ```\n *\n * ###  8\n *\n * ```typescript\n * import { withAPIContext, enableDebugMode, setSlowThreshold } from '../utils/apiContext';\n * import { generate } from '../api/generate';\n *\n * async function debugPerformance(): Promise<void> {\n *   // \n *   enableDebugMode();\n *\n *   //  500ms\n *   setSlowThreshold(500);\n *\n *   await withAPIContext('realWorld', async () => {\n *     console.log('...');\n *\n *     //  500ms\n *     const result = await generate({\n *       user_input: '',\n *       should_stream: false,\n *     });\n *\n *     console.log('');\n *     return result;\n *   });\n *\n *   // \n *   // disableDebugMode();\n * }\n * ```\n *\n * ---\n *\n * ## \n *\n * ###  withAPIContext\n *\n * ****\n * 1.   AI \n *    - realWorldMapServiceinstanceMapService\n *    - NPC npcGenerationCoordinator\n *    - \n *\n * 2.   AI \n *    -  AI \n *    - \n *\n * 3.   AI\n *    -  NPC  API\n *    -  API\n *\n * ****\n * 1.  \n *    -  API\n *    -  apiAutoSwitchService \n *\n * 2.   AI \n *    - \n *    -  AI \n *\n * 3.  \n *    - withAPIContext \n *    -  generate\n *\n * ### \n *\n * ****\n * - `realWorld`: \n *   - \n *   - \n *   -  NPC\n *\n * - `innerWorld`: \n *   - \n *   - \n *   -  NPC\n *\n * - `sanctuary`: \n *   - \n *   -  NPC\n *   - \n *\n * ****\n * ```typescript\n * function selectWorldForContent(content: Content): WorldType {\n *   // \n *   if (content.tags.includes('fantasy') || content.tags.includes('magic')) {\n *     return 'innerWorld';\n *   }\n *\n *   if (content.tags.includes('realistic') || content.tags.includes('modern')) {\n *     return 'realWorld';\n *   }\n *\n *   // \n *   if (content.location?.world_type) {\n *     return content.location.world_type;\n *   }\n *\n *   // \n *   return 'sanctuary';\n * }\n * ```\n *\n * ### \n *\n * **1.  withAPIContext **\n * ```typescript\n * //  \n * try {\n *   const result = await withAPIContext('realWorld', async () => {\n *     return await generate({ user_input: prompt });\n *   });\n *   return result;\n * } catch (error) {\n *   // withAPIContext \n *   // \n *   handleBusinessError(error);\n * }\n *\n * //  \n * try {\n *   const result = await withAPIContext('realWorld', async () => {\n *     return await generate({ user_input: prompt });\n *   });\n *   return result;\n * } catch (error) {\n *   // withAPIContext \n *   // apiConfigService.switchToSanctuary(); //  \n *   handleBusinessError(error);\n * }\n * ```\n *\n * **2. **\n * ```typescript\n * //  \n * try {\n *   return await withAPIContext('realWorld', async () => {\n *     return await generate({ user_input: prompt });\n *   });\n * } catch (error) {\n *   if (error instanceof NetworkError) {\n *     toastr.error('');\n *     throw new Error(' AI ');\n *   } else if (error instanceof APIError) {\n *     toastr.error('AI ');\n *     throw new Error('API ' + error.message);\n *   } else {\n *     toastr.error('');\n *     throw error;\n *   }\n * }\n * ```\n *\n * **3. **\n * ```typescript\n * //   withAPIContext \n * async function generateWithRetry(prompt: string, maxRetries = 3): Promise<string> {\n *   for (let i = 0; i < maxRetries; i++) {\n *     try {\n *       return await withAPIContext('realWorld', async () => {\n *         return await generate({ user_input: prompt });\n *       });\n *     } catch (error) {\n *       if (i === maxRetries - 1) throw error;\n *       await delay(1000 * (i + 1)); // \n *     }\n *   }\n *   throw new Error('');\n * }\n * ```\n *\n * ### \n *\n * **1. **\n * ```typescript\n * //  \n * async function batchGenerate(items: Item[]): Promise<Result[]> {\n *   const grouped = _.groupBy(items, item => item.worldType);\n *   const results: Result[] = [];\n *\n *   for (const [worldType, worldItems] of Object.entries(grouped)) {\n *     // \n *     const worldResults = await withAPIContext(worldType as WorldType, async () => {\n *       return await Promise.all(worldItems.map(item => generateItem(item)));\n *     });\n *     results.push(...worldResults);\n *   }\n *\n *   return results;\n * }\n *\n * //  \n * async function batchGenerate(items: Item[]): Promise<Result[]> {\n *   return await Promise.all(\n *     items.map(item =>\n *       // \n *       withAPIContext(item.worldType, async () => generateItem(item))\n *     )\n *   );\n * }\n * ```\n *\n * **2. **\n * ```typescript\n * //  \n * async function generateContent(): Promise<Content> {\n *   const part1 = await withAPIContext('realWorld', async () => generatePart1());\n *   const part2 = await withAPIContext('innerWorld', async () => generatePart2());\n *   return { part1, part2 };\n * }\n *\n * //  \n * async function generateContent(): Promise<Content> {\n *   return await withAPIContext('realWorld', async () => {\n *     const part1 = await generatePart1();\n *     //  part2  realWorld \n *     const part2 = await withAPIContext('innerWorld', async () => generatePart2());\n *     return { part1, part2 };\n *   });\n * }\n * ```\n *\n * **3. **\n * ```typescript\n * import { enableDebugMode, setSlowThreshold, getLogConfig } from '../utils/apiContext';\n *\n * // \n * if (process.env.NODE_ENV === 'development') {\n *   enableDebugMode();\n *   setSlowThreshold(500); // 500ms \n * }\n *\n * // \n * function enablePerformanceMonitoring(): void {\n *   enableDebugMode();\n *   console.log(':', getLogConfig());\n * }\n * ```\n *\n * ---\n *\n * ## \n *\n * ### Q1: withAPIContext \n * A: withAPIContext \n *    \n *\n * ### Q2:  withAPIContext  withAPIContext \n * A: \n *\n * ### Q3: \n * A: withAPIContext  try-finally \n *\n * ### Q4: withAPIContext \n * A: \n *     50ms \n *\n * ### Q5:  withAPIContext \n * A:  APIwithAPIContext\n *     AI\n *\n * ### Q6: \n * A:  `enableDebugMode()` \n *    \n *\n * ---\n *\n * ## \n *\n * - {@link withAPIContext} -  API \n * - {@link apiContextManager} - \n * - {@link enableDebugMode} - \n * - {@link disableDebugMode} - \n * - {@link setSlowThreshold} - \n * - {@link getLogConfig} - \n * - {@link WorldType} - \n *\n * @see {@link apiConfigService} - API \n * @see {@link apiAutoSwitchService} - API \n */\n","/**\n * \n *  NPC \n */\n\nimport { klona } from 'klona';\nimport type { Memento } from '../types/instance';\nimport { memoryFragmentService } from './memoryFragmentService';\n\n/**\n * \n */\nexport type FurnitureType = 'sofa' | 'table' | 'bookshelf' | 'plant' | 'other';\n\n/**\n * \n */\nexport interface FurnitureItem {\n  id: string;\n  name: string;\n  type: FurnitureType;\n  position: { x: number; y: number };\n  imageUrl?: string;\n}\n\n/**\n * \n */\nexport interface MementoDisplay {\n  mementoId: string;\n  position: { x: number; y: number };\n  scale: number;\n}\n\n/**\n * \n */\nexport interface DecorationItem {\n  id: string;\n  name: string;\n  type: string;\n  position: { x: number; y: number };\n  imageUrl?: string;\n}\n\n/**\n * \n */\nexport interface ConversationRecord {\n  id: string;\n  npcIds: string[]; //  NPC ID \n  messages: any[]; // \n  startedAt: number;\n  endedAt?: number;\n}\n\n/**\n * \n */\nexport interface SanctuaryData {\n  backgroundImage: string; // \n  furniture: FurnitureItem[]; // \n  mementos: MementoDisplay[]; // \n  decorations: DecorationItem[]; // \n  conversationHistory: ConversationRecord[]; // \n}\n\n/**\n * \n */\nclass SanctuaryService {\n  private initialized = false;\n\n  /**\n   * \n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      console.log('[SanctuaryService] ');\n      return;\n    }\n\n    console.log('[SanctuaryService] ...');\n\n    let sanctuary = await this.getSanctuary();\n\n    if (!sanctuary) {\n      // \n      sanctuary = {\n        backgroundImage: 'default_apartment.jpg',\n        furniture: [],\n        mementos: [],\n        decorations: [],\n        conversationHistory: [],\n      };\n      await this.saveSanctuary(sanctuary);\n      console.log('[SanctuaryService] ');\n    }\n\n    this.initialized = true;\n    console.log('[SanctuaryService] ');\n  }\n\n  /**\n   * \n   */\n  async getSanctuary(): Promise<SanctuaryData | null> {\n    try {\n      const allVars = getVariables({ type: 'global' });\n      return (allVars.sanctuary_data as SanctuaryData) || null;\n    } catch (error) {\n      console.error('[SanctuaryService] :', error);\n      return null;\n    }\n  }\n\n  /**\n   * \n   */\n  async saveSanctuary(sanctuary: SanctuaryData): Promise<void> {\n    try {\n      //  klona  Vue Proxy \n      const cleanSanctuary = klona(sanctuary);\n      insertOrAssignVariables({ sanctuary_data: cleanSanctuary }, { type: 'global' });\n      console.log('[SanctuaryService] ');\n    } catch (error) {\n      console.error('[SanctuaryService] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   *  NPC \n   */\n  async inviteNPC(npcIds: string[]): Promise<void> {\n    try {\n      console.log('[SanctuaryService]  NPC :', npcIds);\n\n      const sanctuary = await this.getSanctuary();\n      if (!sanctuary) {\n        throw new Error('');\n      }\n\n      // \n      const conversation: ConversationRecord = {\n        id: this.generateId(),\n        npcIds,\n        messages: [],\n        startedAt: Date.now(),\n      };\n\n      sanctuary.conversationHistory.push(conversation);\n      await this.saveSanctuary(sanctuary);\n\n      // \n      // API  apiAutoSwitchService  MVU \n      const { worldBookService } = await import('./worldBookService');\n      await worldBookService.activateInteractionRoomEntries();\n      console.log('[SanctuaryService] ');\n\n      //  NPC \n      await this.setupConversationContext(npcIds);\n\n      toastr.success(` ${npcIds.length}  NPC `);\n    } catch (error) {\n      console.error('[SanctuaryService]  NPC :', error);\n      toastr.error(' NPC ');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   *  NPC \n   */\n  private async setupConversationContext(npcIds: string[]): Promise<void> {\n    try {\n      const sanctuary = await this.getSanctuary();\n      if (!sanctuary) {\n        throw new Error('');\n      }\n\n      // \n      let environmentPrompt = `\\n`;\n      environmentPrompt += `${this.describeEnvironment(sanctuary)}\\n\\n`;\n\n      //  NPC \n      for (const npcId of npcIds) {\n        const memoryPrompt = await memoryFragmentService.injectMemoryPrompt(npcId);\n        if (memoryPrompt) {\n          environmentPrompt += `\\n--- ${npcId}  ---\\n`;\n          environmentPrompt += memoryPrompt + '\\n';\n        }\n      }\n\n      // \n      injectPrompts([\n        {\n          id: 'sanctuary_context',\n          content: environmentPrompt,\n          position: 'in_chat',\n          depth: 0,\n          role: 'system',\n        },\n      ]);\n\n      console.log('[SanctuaryService] ');\n    } catch (error) {\n      console.error('[SanctuaryService] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  async interactWithItem(itemId: string): Promise<string> {\n    try {\n      const sanctuary = await this.getSanctuary();\n      if (!sanctuary) {\n        throw new Error('');\n      }\n\n      const item = this.findItem(sanctuary, itemId);\n      if (!item) {\n        return '';\n      }\n\n      console.log('[SanctuaryService] :', item.name);\n\n      //  withAPIContext  sanctuary API\n      const response = await withAPIContext('sanctuary', async () => {\n        const prompt = `${item.name}`;\n\n        return await generateRaw({\n          ordered_prompts: [{ role: 'user', content: prompt }],\n        });\n      });\n\n      console.log('[SanctuaryService] ');\n      return response;\n    } catch (error) {\n      console.error('[SanctuaryService] :', error);\n      return '';\n    }\n  }\n\n  /**\n   * \n   */\n  async addMemento(memento: Memento, position: { x: number; y: number }): Promise<void> {\n    try {\n      const sanctuary = await this.getSanctuary();\n      if (!sanctuary) {\n        throw new Error('');\n      }\n\n      sanctuary.mementos.push({\n        mementoId: memento.id,\n        position,\n        scale: 1.0,\n      });\n\n      await this.saveSanctuary(sanctuary);\n      toastr.success(`${memento.name}`);\n      console.log('[SanctuaryService] :', memento.name);\n    } catch (error) {\n      console.error('[SanctuaryService] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  private describeEnvironment(sanctuary: SanctuaryData): string {\n    const items: string[] = [];\n\n    // \n    items.push(...sanctuary.furniture.map(f => f.name));\n\n    // \n    items.push(...sanctuary.mementos.map(m => `${m.mementoId}`));\n\n    if (items.length === 0) {\n      return '';\n    }\n\n    return `${items.slice(0, 3).join('')}${items.length > 3 ? '' : ''}`;\n  }\n\n  /**\n   * \n   */\n  private findItem(sanctuary: SanctuaryData, itemId: string): { name: string } | null {\n    // \n    const furniture = sanctuary.furniture.find(f => f.id === itemId);\n    if (furniture) {\n      return { name: furniture.name };\n    }\n\n    // \n    const memento = sanctuary.mementos.find(m => m.mementoId === itemId);\n    if (memento) {\n      return { name: memento.mementoId };\n    }\n\n    return null;\n  }\n\n  /**\n   * \n   * @param npcIds  NPC ID \n   * @param messages \n   */\n  async saveConversation(npcIds: string[], messages: any[]): Promise<void> {\n    try {\n      const sanctuary = await this.getSanctuary();\n      if (!sanctuary) {\n        throw new Error('');\n      }\n\n      //  NPC \n      const sortedNpcIds = [...npcIds].sort();\n      const existingConversation = sanctuary.conversationHistory.find(conv => {\n        const sortedConvNpcIds = [...conv.npcIds].sort();\n        return JSON.stringify(sortedConvNpcIds) === JSON.stringify(sortedNpcIds);\n      });\n\n      if (existingConversation) {\n        // \n        existingConversation.messages = messages;\n        existingConversation.endedAt = Date.now();\n        console.log('[SanctuaryService] :', existingConversation.id);\n      } else {\n        // \n        const newConversation: ConversationRecord = {\n          id: this.generateId(),\n          npcIds,\n          messages,\n          startedAt: Date.now(),\n          endedAt: Date.now(),\n        };\n        sanctuary.conversationHistory.push(newConversation);\n        console.log('[SanctuaryService] :', newConversation.id);\n      }\n\n      await this.saveSanctuary(sanctuary);\n      console.log('[SanctuaryService] ');\n    } catch (error) {\n      console.error('[SanctuaryService] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   *  NPC \n   * @param npcIds  NPC ID \n   * @returns  null\n   */\n  async getConversationHistory(npcIds: string[]): Promise<ConversationRecord | null> {\n    try {\n      const sanctuary = await this.getSanctuary();\n      if (!sanctuary) {\n        return null;\n      }\n\n      //  NPC ID \n      const sortedNpcIds = [...npcIds].sort();\n      const conversation = sanctuary.conversationHistory.find(conv => {\n        const sortedConvNpcIds = [...conv.npcIds].sort();\n        return JSON.stringify(sortedConvNpcIds) === JSON.stringify(sortedNpcIds);\n      });\n\n      if (conversation) {\n        console.log('[SanctuaryService] :', conversation.id, ':', conversation.messages.length);\n      } else {\n        console.log('[SanctuaryService] ');\n      }\n\n      return conversation || null;\n    } catch (error) {\n      console.error('[SanctuaryService] :', error);\n      return null;\n    }\n  }\n\n  /**\n   * \n   */\n  async exitSanctuary(): Promise<void> {\n    try {\n      console.log('[SanctuaryService] ...');\n\n      // \n      // API  apiAutoSwitchService  MVU \n      const { worldBookService } = await import('./worldBookService');\n      await worldBookService.activateRealWorldEntries();\n      console.log('[SanctuaryService] ');\n\n      toastr.success('');\n    } catch (error) {\n      console.error('[SanctuaryService] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   *  ID\n   */\n  private generateId(): string {\n    return `sanctuary_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;\n  }\n}\n\n// \nexport const sanctuaryService = new SanctuaryService();\n","// \n\nimport toastr from 'toastr';\nimport { z } from 'zod';\n\n/**\n * \n * @param schema Zod schema\n * @param data \n * @param errorMessage \n * @returns  null\n */\nexport function validateAndParse<T>(schema: z.ZodSchema<T>, data: unknown, errorMessage?: string): T | null {\n  try {\n    return schema.parse(data);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      const formatted = formatZodError(error);\n      console.error(':', formatted);\n\n      if (errorMessage) {\n        toastr.error(errorMessage);\n      } else {\n        toastr.error('');\n      }\n    } else {\n      console.error(':', error);\n      toastr.error('');\n    }\n    return null;\n  }\n}\n\n/**\n * \n * @param schema Zod schema\n * @param data \n * @param fallback \n * @returns \n */\nexport function safeParseWithFallback<T>(schema: z.ZodSchema<T>, data: unknown, fallback: T): T {\n  const result = schema.safeParse(data);\n  if (result.success) {\n    return result.data;\n  } else {\n    console.warn(':', formatZodError(result.error));\n    return fallback;\n  }\n}\n\n/**\n *  Zod \n * @param error Zod \n * @returns \n */\nexport function formatZodError(error: z.ZodError): string {\n  const issues = error.issues.map(issue => {\n    const path = issue.path.join('.');\n    return `  - ${path || ''}: ${issue.message}`;\n  });\n\n  return `:\\n${issues.join('\\n')}`;\n}\n\n/**\n *  COC7 \n * @param value \n * @returns \n */\nexport function isValidCOC7Attribute(value: number): boolean {\n  return value >= 0 && value <= 100;\n}\n\n/**\n * \n * @param value \n * @returns \n */\nexport function isValidPercentage(value: number): boolean {\n  return value >= 0 && value <= 100;\n}\n\n/**\n *  URL \n * @param url URL \n * @returns  URL\n */\nexport function isValidUrl(url: string): boolean {\n  try {\n    new URL(url);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * \n * @param str \n * @returns \n */\nexport function isNonEmptyString(str: string): boolean {\n  return typeof str === 'string' && str.trim().length > 0;\n}\n\n/**\n * \n * @param name \n * @returns \n */\nexport function sanitizeCharacterName(name: string): string {\n  return name.trim().replace(/\\s+/g, ' ');\n}\n\n/**\n *  HP/MP/SAN  0\n * @param current \n * @param max \n * @returns \n */\nexport function clampStat(current: number, max: number): number {\n  return Math.max(0, Math.min(current, max));\n}\n\n/**\n * \n * @param skillValue \n * @returns \n */\nexport function isValidSkillValue(skillValue: number): boolean {\n  return skillValue >= 0 && skillValue <= 100;\n}\n\n/**\n * \n * @param validations \n * @returns \n */\nexport function validateAll(\n  validations: Array<{\n    condition: boolean;\n    message: string;\n  }>,\n): boolean {\n  for (const validation of validations) {\n    if (!validation.condition) {\n      toastr.error(validation.message);\n      console.error(':', validation.message);\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * \n * @param obj \n * @param requiredFields \n * @returns \n */\nexport function hasRequiredFields(obj: Record<string, any>, requiredFields: string[]): boolean {\n  for (const field of requiredFields) {\n    if (!(field in obj) || obj[field] === undefined || obj[field] === null) {\n      console.error(`: ${field}`);\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * \n * @param obj \n * @param schema Zod schema\n * @param showToast  toast \n * @returns \n */\nexport function deepValidate<T>(\n  obj: unknown,\n  schema: z.ZodSchema<T>,\n  showToast: boolean = true,\n): { success: boolean; data?: T; error?: string } {\n  const result = schema.safeParse(obj);\n\n  if (result.success) {\n    return { success: true, data: result.data };\n  } else {\n    const errorMessage = formatZodError(result.error);\n    console.error(':', errorMessage);\n\n    if (showToast) {\n      toastr.error('');\n    }\n\n    return { success: false, error: errorMessage };\n  }\n}\n\n/**\n *  Map \n * @param obj  Map \n * @returns Map \n */\nexport function ensureMap<K, V>(obj: Map<K, V> | Record<string, V>): Map<K, V> {\n  if (obj instanceof Map) {\n    return obj;\n  }\n  return new Map(Object.entries(obj) as [K, V][]);\n}\n\n/**\n * \n * @param arr \n * @param min \n * @param max \n * @returns \n */\nexport function isValidArrayLength(arr: any[], min: number = 0, max: number = Infinity): boolean {\n  return arr.length >= min && arr.length <= max;\n}\n\n/**\n * \n * @param value \n * @param min \n * @param max \n * @returns \n */\nexport function isInRange(value: number, min: number, max: number): boolean {\n  return value >= min && value <= max;\n}\n\n/**\n *  JSON \n * @param jsonString JSON \n * @param fallback \n * @returns \n */\nexport function tryParseJSON<T>(jsonString: string, fallback: T): T {\n  try {\n    return JSON.parse(jsonString) as T;\n  } catch (error) {\n    console.warn('JSON :', error);\n    return fallback;\n  }\n}\n","//  - \n\nimport { useInventoryStore } from '../stores/inventoryStore';\n\n/**\n * \n *  MVU \n */\nclass GameResetService {\n  /**\n   *  MVU \n   */\n  async clearMVUVariables(): Promise<void> {\n    try {\n      console.log('[GameResetService]  MVU ...');\n\n      //  MVU \n      await waitGlobalInitialized('Mvu');\n\n      //  MVU \n      const emptyMvuData: Mvu.MvuData = {\n        initialized_lorebooks: [],\n        stat_data: {},\n        display_data: {},\n        delta_data: {},\n      };\n\n      let clearedCount = 0;\n\n      //  0 \n      try {\n        const mvuData0 = Mvu.getMvuData({ type: 'message', message_id: 0 });\n        if (mvuData0 && Object.keys(mvuData0.stat_data || {}).length > 0) {\n          await Mvu.replaceMvuData(emptyMvuData, { type: 'message', message_id: 0 });\n          clearedCount++;\n          console.log(`[GameResetService]  0  MVU `);\n        }\n      } catch (error) {\n        console.warn(`[GameResetService]  0  MVU :`, error);\n      }\n\n      // \n      try {\n        const messages = getChatMessages('0-{{lastMessageId}}');\n        console.log(`[GameResetService]  ${messages.length} `);\n\n        //  MVU \n        for (const message of messages) {\n          const messageId = message.message_id;\n          try {\n            //  MVU \n            const mvuData = Mvu.getMvuData({ type: 'message', message_id: messageId });\n\n            if (mvuData && Object.keys(mvuData.stat_data || {}).length > 0) {\n              //  MVU \n              await Mvu.replaceMvuData(emptyMvuData, { type: 'message', message_id: messageId });\n              clearedCount++;\n              console.log(`[GameResetService]  ${messageId}  MVU `);\n            }\n          } catch (error) {\n            console.warn(`[GameResetService]  ${messageId}  MVU :`, error);\n          }\n        }\n      } catch (error) {\n        console.log('[GameResetService]  0 :', error);\n      }\n\n      console.log(`[GameResetService]  MVU  ${clearedCount} `);\n    } catch (error) {\n      console.error('[GameResetService]   MVU :', error);\n      throw new Error(` MVU : ${(error as Error).message}`);\n    }\n  }\n\n  /**\n   * \n   */\n  async clearGlobalVariables(): Promise<void> {\n    try {\n      console.log('[GameResetService] ...');\n\n      // \n      const currentVariables = getVariables({ type: 'global' });\n      const variableNames = Object.keys(currentVariables);\n      console.log(`[GameResetService]  ${variableNames.length} :`, variableNames);\n\n      // \n      replaceVariables({}, { type: 'global' });\n\n      console.log(`[GameResetService]   ${variableNames.length} `);\n    } catch (error) {\n      console.error('[GameResetService]  :', error);\n      throw new Error(`: ${(error as Error).message}`);\n    }\n  }\n\n  /**\n   * \n   */\n  async clearChatVariables(): Promise<void> {\n    try {\n      console.log('[GameResetService] ...');\n\n      // \n      const currentVariables = getVariables({ type: 'chat' });\n      const variableNames = Object.keys(currentVariables);\n      console.log(`[GameResetService]  ${variableNames.length} :`, variableNames);\n\n      // \n      replaceVariables({}, { type: 'chat' });\n\n      console.log(`[GameResetService]   ${variableNames.length} `);\n    } catch (error) {\n      console.error('[GameResetService]  :', error);\n      throw new Error(`: ${(error as Error).message}`);\n    }\n  }\n\n  /**\n   * \n   */\n  async clearInventory(): Promise<void> {\n    try {\n      console.log('[GameResetService] ...');\n\n      const inventoryStore = useInventoryStore();\n\n      // \n      const realWorldCount = inventoryStore.realWorldInventory.items.length;\n      const instanceCount = inventoryStore.instanceInventory.items.length;\n      console.log(`[GameResetService] : ${realWorldCount}`);\n      console.log(`[GameResetService] : ${instanceCount}`);\n\n      //  store\n      inventoryStore.reset();\n\n      // \n      await inventoryStore.saveToGlobal();\n\n      console.log(`[GameResetService]   ${realWorldCount + instanceCount} `);\n    } catch (error) {\n      console.error('[GameResetService]  :', error);\n      throw new Error(`: ${(error as Error).message}`);\n    }\n  }\n\n  /**\n   * \n   *  player_name  player_description\n   */\n  async clearProtagonistInfo(): Promise<void> {\n    try {\n      console.log('[GameResetService] ...');\n\n      // \n      const currentVariables = getVariables({ type: 'global' });\n\n      //  player_name  player_description \n      const oldPlayerName = currentVariables.player_name;\n      const oldPlayerDescription = currentVariables.player_description;\n\n      console.log('[GameResetService] :', {\n        player_name: oldPlayerName,\n        player_description: oldPlayerDescription ? `${oldPlayerDescription.substring(0, 50)}...` : undefined,\n      });\n\n      //  player_name \n      if (currentVariables.player_name !== undefined) {\n        delete currentVariables.player_name;\n        console.log('[GameResetService]   player_name :', oldPlayerName);\n      } else {\n        console.log('[GameResetService] player_name ');\n      }\n\n      //  player_description \n      if (currentVariables.player_description !== undefined) {\n        delete currentVariables.player_description;\n        console.log('[GameResetService]   player_description :', oldPlayerDescription?.length || 0);\n      } else {\n        console.log('[GameResetService] player_description ');\n      }\n\n      // \n      replaceVariables(currentVariables, { type: 'global' });\n      console.log('[GameResetService]  ');\n\n      //  characterInitializer.resetInterceptor() \n      console.log('[GameResetService] ...');\n      // eslint-disable-next-line import-x/no-cycle -- Dynamic import breaks cycle at runtime\n      const { characterInitializer } = await import('./characterInitializer');\n      characterInitializer.resetInterceptor();\n      console.log('[GameResetService]  ');\n\n      console.log('[GameResetService]  ');\n    } catch (error) {\n      console.error('[GameResetService]  :', {\n        error: (error as Error).message,\n        stack: (error as Error).stack,\n      });\n      throw new Error(`: ${(error as Error).message}`);\n    }\n  }\n\n  /**\n   *  API  API\n   */\n  async resetAPIConfiguration(): Promise<void> {\n    try {\n      console.log('[GameResetService]  API ...');\n\n      //  api_config \n      const currentVariables = getVariables({ type: 'global' });\n\n      if (currentVariables.api_config) {\n        console.log('[GameResetService]  API ');\n\n        //  api_config \n        delete currentVariables.api_config;\n        replaceVariables(currentVariables, { type: 'global' });\n\n        console.log('[GameResetService]  API ');\n      } else {\n        console.log('[GameResetService]  API ');\n      }\n    } catch (error) {\n      console.error('[GameResetService]   API :', error);\n      throw new Error(` API : ${(error as Error).message}`);\n    }\n  }\n\n  /**\n   * \n   * \n   */\n  async clearAllGameData(): Promise<void> {\n    console.log('[GameResetService] ==========  ==========');\n\n    const errors: Array<{ operation: string; error: Error }> = [];\n    const results: Array<{ operation: string; success: boolean }> = [];\n\n    // \n    try {\n      await this.clearProtagonistInfo();\n      results.push({ operation: '', success: true });\n    } catch (error) {\n      errors.push({ operation: '', error: error as Error });\n      results.push({ operation: '', success: false });\n      console.error('[GameResetService] :', error);\n    }\n\n    //  MVU \n    try {\n      await this.clearMVUVariables();\n      results.push({ operation: 'MVU ', success: true });\n    } catch (error) {\n      errors.push({ operation: 'MVU ', error: error as Error });\n      results.push({ operation: 'MVU ', success: false });\n      console.error('[GameResetService]  MVU :', error);\n    }\n\n    // \n    try {\n      await this.clearGlobalVariables();\n      results.push({ operation: '', success: true });\n    } catch (error) {\n      errors.push({ operation: '', error: error as Error });\n      results.push({ operation: '', success: false });\n      console.error('[GameResetService] :', error);\n    }\n\n    // \n    try {\n      await this.clearChatVariables();\n      results.push({ operation: '', success: true });\n    } catch (error) {\n      errors.push({ operation: '', error: error as Error });\n      results.push({ operation: '', success: false });\n      console.error('[GameResetService] :', error);\n    }\n\n    // \n    try {\n      await this.clearInventory();\n      results.push({ operation: '', success: true });\n    } catch (error) {\n      errors.push({ operation: '', error: error as Error });\n      results.push({ operation: '', success: false });\n      console.error('[GameResetService] :', error);\n    }\n\n    // \n    console.log('[GameResetService] ==========  ==========');\n    console.log('[GameResetService] :');\n    results.forEach(result => {\n      const status = result.success ? ' ' : ' ';\n      console.log(`[GameResetService]   ${result.operation}: ${status}`);\n    });\n\n    // \n    if (errors.length > 0) {\n      const errorMessage = errors.map(e => `${e.operation}: ${e.error.message}`).join('\\n');\n      console.error('[GameResetService] :\\n', errorMessage);\n      toastr.warning(`:\\n${errorMessage}`);\n    } else {\n      console.log('[GameResetService]  ');\n      toastr.success('');\n    }\n\n    console.log('[GameResetService] ========================================');\n  }\n}\n\n// \nexport const gameResetService = new GameResetService();\n","module.exports = YAML;","/**\n * \n *  NPC \n */\n\nimport { klona } from 'klona';\n\n/**\n * \n */\nexport type MemoryEventType = 'positive' | 'negative' | 'neutral';\n\n/**\n * \n */\nexport interface MemoryEvent {\n  id: string;\n  description: string; // \n  type: MemoryEventType; // \n  timestamp: number; // \n  sourceInstance: string; //  ID\n  location?: string; // \n}\n\n/**\n * NPC \n */\nexport interface NPCMemoryArchive {\n  npcId: string;\n  npcName: string;\n  relationshipScore: number; // -100  100\n  memories: MemoryEvent[]; // \n  lastInteraction: number; // \n}\n\n/**\n * \n */\nclass MemoryFragmentService {\n  private initialized = false;\n  private listening = false;\n\n  /**\n   * \n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      console.log('[MemoryFragmentService] ');\n      return;\n    }\n\n    console.log('[MemoryFragmentService] ...');\n\n    // \n    const archives = await this.getAllArchives();\n    if (!archives) {\n      await this.saveArchives([]);\n    }\n\n    this.initialized = true;\n    console.log('[MemoryFragmentService] ');\n  }\n\n  /**\n   *  AI \n   */\n  startListening(): void {\n    if (this.listening) {\n      console.log('[MemoryFragmentService] ');\n      return;\n    }\n\n    console.log('[MemoryFragmentService]  AI ...');\n\n    eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY, async (fullText, _id) => {\n      try {\n        const aiOutput = fullText || '';\n        await this.captureMemoryEvents(aiOutput);\n      } catch (error) {\n        console.error('[MemoryFragmentService] :', error);\n      }\n    });\n\n    this.listening = true;\n    console.log('[MemoryFragmentService] ');\n  }\n\n  /**\n   *  AI \n   * [memory_event type=\"positive\" target=\"NPC_ID\"][/memory_event]\n   */\n  private async captureMemoryEvents(text: string): Promise<void> {\n    const regex = /\\[memory_event\\s+type=\"(positive|negative|neutral)\"\\s+target=\"([^\"]+)\"\\](.*?)\\[\\/memory_event\\]/g;\n    let match;\n    let capturedCount = 0;\n\n    while ((match = regex.exec(text)) !== null) {\n      const [, type, npcId, description] = match;\n\n      const event: MemoryEvent = {\n        id: this.generateId(),\n        description: description.trim(),\n        type: type as MemoryEventType,\n        timestamp: Date.now(),\n        sourceInstance: await this.getCurrentInstanceId(),\n      };\n\n      await this.addMemoryToNPC(npcId, event);\n      capturedCount++;\n    }\n\n    if (capturedCount > 0) {\n      console.log(`[MemoryFragmentService]  ${capturedCount} `);\n    }\n  }\n\n  /**\n   *  NPC \n   */\n  async addMemoryToNPC(npcId: string, event: MemoryEvent): Promise<void> {\n    const archives = await this.getAllArchives();\n    let archive = archives.find(a => a.npcId === npcId);\n\n    if (!archive) {\n      // \n      archive = {\n        npcId,\n        npcName: await this.getNPCName(npcId),\n        relationshipScore: 0,\n        memories: [],\n        lastInteraction: Date.now(),\n      };\n      archives.push(archive);\n    }\n\n    // \n    archive.memories.push(event);\n    archive.lastInteraction = Date.now();\n\n    // \n    if (event.type === 'positive') {\n      archive.relationshipScore = Math.min(100, archive.relationshipScore + 5);\n    } else if (event.type === 'negative') {\n      archive.relationshipScore = Math.max(-100, archive.relationshipScore - 5);\n    }\n\n    await this.saveArchives(archives);\n\n    console.log(\n      `[MemoryFragmentService]  NPC ${archive.npcName}  ${event.type} : ${archive.relationshipScore}`,\n    );\n  }\n\n  /**\n   * \n   */\n  async getAllArchives(): Promise<NPCMemoryArchive[]> {\n    try {\n      const allGlobalVars = getVariables({ type: 'global' });\n      const data = allGlobalVars.npc_memory_archives;\n      return Array.isArray(data) ? data : [];\n    } catch (error) {\n      console.error('[MemoryFragmentService] :', error);\n      return [];\n    }\n  }\n\n  /**\n   *  NPC \n   */\n  async getArchive(npcId: string): Promise<NPCMemoryArchive | null> {\n    const archives = await this.getAllArchives();\n    return archives.find(a => a.npcId === npcId) || null;\n  }\n\n  /**\n   * \n   */\n  private async saveArchives(archives: NPCMemoryArchive[]): Promise<void> {\n    try {\n      //  klona  Vue Proxy \n      const cleanArchives = klona(archives);\n      await insertOrAssignVariables({ npc_memory_archives: cleanArchives }, { type: 'global' });\n    } catch (error) {\n      console.error('[MemoryFragmentService] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   *  ID\n   */\n  private async getCurrentInstanceId(): Promise<string> {\n    try {\n      //  ID\n      const variables = getVariables({ type: 'global' });\n      return variables.current_instance_id || 'unknown';\n    } catch (error) {\n      console.error('[MemoryFragmentService]  ID :', error);\n      return 'unknown';\n    }\n  }\n\n  /**\n   *  NPC \n   */\n  private async getNPCName(npcId: string): Promise<string> {\n    try {\n      //  NPC \n      const allGlobalVars = getVariables({ type: 'global' });\n      const instances = allGlobalVars.instances || [];\n      for (const instance of Array.isArray(instances) ? instances : []) {\n        const npc = instance.characters?.find((c: any) => c.characterId === npcId);\n        if (npc) {\n          return npc.character?.name || npcId;\n        }\n      }\n      return npcId;\n    } catch (error) {\n      console.error('[MemoryFragmentService]  NPC :', error);\n      return npcId;\n    }\n  }\n\n  /**\n   *  NPC \n   */\n  async injectMemoryPrompt(npcId: string): Promise<string> {\n    const archive = await this.getArchive(npcId);\n    if (!archive || archive.memories.length === 0) {\n      return '';\n    }\n\n    //  5 \n    const recentMemories = [...archive.memories].sort((a, b) => b.timestamp - a.timestamp).slice(0, 5);\n\n    let prompt = `\\n`;\n    for (const memory of recentMemories) {\n      prompt += `- ${memory.description}\\n`;\n    }\n\n    prompt += `\\n${this.getRelationshipDescription(archive.relationshipScore)}`;\n    prompt += `\\n`;\n\n    return prompt;\n  }\n\n  /**\n   * \n   */\n  private getRelationshipDescription(score: number): string {\n    if (score > 70) return '';\n    if (score > 40) return '';\n    if (score > 10) return '';\n    if (score > -10) return '';\n    if (score > -40) return '';\n    if (score > -70) return '';\n    return '';\n  }\n\n  /**\n   *  ID\n   */\n  private generateId(): string {\n    return `memory_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;\n  }\n}\n\n// \nexport const memoryFragmentService = new MemoryFragmentService();\n","// NPC  -  AI  NPC \n\nimport type { NPCCharacter } from '../types/character';\nimport { calculateDerivedStats, generateRandomAttributes } from '../utils/coc7Rules';\n\n/**\n * NPC \n */\nclass NPCGenerationService {\n  /**\n   *  NPC\n   * @param instanceType  NPC\n   */\n  async generateRandom(instanceType?: string): Promise<NPCCharacter> {\n    try {\n      console.log('[NPC Generation Service]  NPC...');\n\n      //  AI \n      let prompt = ' NPC \\n\\n';\n\n      if (instanceType) {\n        prompt += `${instanceType}\\n`;\n        prompt += `${instanceType} NPC\\n\\n`;\n      }\n\n      prompt += ` JSON \n\\`\\`\\`json\n{\n  \"name\": \"\",\n  \"age\": ,\n  \"occupation\": \"\",\n  \"background\": \"100-200\",\n  \"personality\": \"50-100\",\n  \"relationship\": \"\"\n}\n\\`\\`\\`\n\n\n- \n- \n- \n- \n- `;\n\n      //  generate  NPC \n      let response: string;\n      try {\n        response = await generate({\n          user_input: prompt,\n          should_stream: false,\n        });\n      } catch (error) {\n        console.error('[NPC Generation Service] AI :', error);\n        throw new Error('AI ');\n      }\n\n      //  JSON  NPC \n      const jsonMatch = response.match(/```json\\n([\\s\\S]*?)\\n```/);\n      if (!jsonMatch) {\n        console.error('[NPC Generation Service] AI :', response);\n        throw new Error('AI ');\n      }\n\n      let npcData: any;\n      try {\n        npcData = JSON.parse(jsonMatch[1]);\n      } catch (error) {\n        console.error('[NPC Generation Service] JSON :', error);\n        throw new Error('AI  JSON ');\n      }\n\n      // \n      if (!npcData.name || !npcData.occupation) {\n        console.error('[NPC Generation Service] NPC :', npcData);\n        throw new Error('AI  NPC ');\n      }\n\n      // NPC\n      const npc = await this.enhanceWithCharacterSystem({\n        name: npcData.name,\n        age: npcData.age,\n        occupation: npcData.occupation,\n        background: npcData.background,\n        personality: npcData.personality,\n      });\n\n      // \n      if (npcData.relationship) {\n        npc.relationship = npcData.relationship;\n      }\n\n      console.log('[NPC Generation Service] NPC :', npc.name);\n      return npc;\n    } catch (error) {\n      console.error('[NPC Generation Service]  NPC :', error);\n      // \n      throw error;\n    }\n  }\n\n  /**\n   *  NPC\n   * @param customPrompt  NPC \n   * @param instanceType \n   */\n  async generateCustom(customPrompt: string, instanceType?: string): Promise<NPCCharacter> {\n    try {\n      console.log('[NPC Generation Service]  NPC...');\n\n      //  AI \n      let prompt = ` NPC \\n\\n${customPrompt}\\n\\n`;\n\n      if (instanceType) {\n        prompt += `${instanceType}\\n`;\n      }\n\n      prompt += ` JSON \n\\`\\`\\`json\n{\n  \"name\": \"\",\n  \"age\": ,\n  \"occupation\": \"\",\n  \"background\": \"100-200\",\n  \"personality\": \"50-100\",\n  \"relationship\": \"\"\n}\n\\`\\`\\`\n\n\n- \n- \n- \n- `;\n\n      //  generate  NPC \n      let response: string;\n      try {\n        response = await generate({\n          user_input: prompt,\n          should_stream: false,\n        });\n      } catch (error) {\n        console.error('[NPC Generation Service] AI :', error);\n        throw new Error('AI ');\n      }\n\n      //  JSON  NPC \n      const jsonMatch = response.match(/```json\\n([\\s\\S]*?)\\n```/);\n      if (!jsonMatch) {\n        console.error('[NPC Generation Service] AI :', response);\n        throw new Error('AI ');\n      }\n\n      let npcData: any;\n      try {\n        npcData = JSON.parse(jsonMatch[1]);\n      } catch (error) {\n        console.error('[NPC Generation Service] JSON :', error);\n        throw new Error('AI  JSON ');\n      }\n\n      // \n      if (!npcData.name || !npcData.occupation) {\n        console.error('[NPC Generation Service] NPC :', npcData);\n        throw new Error('AI  NPC ');\n      }\n\n      // NPC\n      const npc = await this.enhanceWithCharacterSystem({\n        name: npcData.name,\n        age: npcData.age,\n        occupation: npcData.occupation,\n        background: npcData.background,\n        personality: npcData.personality,\n      });\n\n      // \n      if (npcData.relationship) {\n        npc.relationship = npcData.relationship;\n      }\n\n      console.log('[NPC Generation Service]  NPC :', npc.name);\n      return npc;\n    } catch (error) {\n      console.error('[NPC Generation Service]  NPC :', error);\n      // \n      throw error;\n    }\n  }\n\n  /**\n   * NPC\n   * @param instanceType \n   * @param relatedNPCs NPC\n   * @returns NPC\n   */\n  async generateRelatedNPC(instanceType: string, relatedNPCs: NPCCharacter[]): Promise<NPCCharacter> {\n    try {\n      console.log('[NPC Generation Service] NPC...');\n\n      // \n      const relatedInfo = relatedNPCs\n        .map(\n          npc =>\n            `- ${npc.name}${npc.occupation || ''}${npc.background?.substring(0, 100) || ''}`,\n        )\n        .join('\\n');\n\n      //  AI \n      let prompt = ` NPC\\n\\n${relatedInfo}\\n\\n`;\n      prompt += `${instanceType}\\n\\n`;\n      prompt += ` NPC\\n\\n`;\n      prompt += ` JSON \n\\`\\`\\`json\n{\n  \"name\": \"\",\n  \"age\": ,\n  \"occupation\": \"\",\n  \"background\": \"100-200\",\n  \"personality\": \"50-100\",\n  \"relationship\": \"\"\n}\n\\`\\`\\`\n\n\n- \n- \n- \n- ${instanceType}`;\n\n      //  generate  NPC \n      let response: string;\n      try {\n        response = await generate({\n          user_input: prompt,\n          should_stream: false,\n        });\n      } catch (error) {\n        console.error('[NPC Generation Service] AI :', error);\n        throw new Error('AI ');\n      }\n\n      //  JSON  NPC \n      const jsonMatch = response.match(/```json\\n([\\s\\S]*?)\\n```/);\n      if (!jsonMatch) {\n        console.error('[NPC Generation Service] AI :', response);\n        throw new Error('AI ');\n      }\n\n      let npcData: any;\n      try {\n        npcData = JSON.parse(jsonMatch[1]);\n      } catch (error) {\n        console.error('[NPC Generation Service] JSON :', error);\n        throw new Error('AI  JSON ');\n      }\n\n      // \n      if (!npcData.name || !npcData.occupation) {\n        console.error('[NPC Generation Service] NPC :', npcData);\n        throw new Error('AI  NPC ');\n      }\n\n      // NPC\n      const npc = await this.enhanceWithCharacterSystem({\n        name: npcData.name,\n        age: npcData.age,\n        occupation: npcData.occupation,\n        background: npcData.background,\n        personality: npcData.personality,\n      });\n\n      // \n      npc.relationship = npcData.relationship;\n\n      console.log('[NPC Generation Service] NPC:', npc.name);\n      return npc;\n    } catch (error) {\n      console.error('[NPC Generation Service] NPC:', error);\n      // \n      throw error;\n    }\n  }\n\n  /**\n   * NPC\n   * @param basicInfo \n   * @returns NPC\n   */\n  async enhanceWithCharacterSystem(basicInfo: {\n    name: string;\n    age?: number;\n    occupation?: string;\n    background?: string;\n    personality?: string;\n  }): Promise<NPCCharacter> {\n    try {\n      console.log('[NPC Generation Service] NPC...');\n\n      // COC7\n      const attributes = generateRandomAttributes();\n      console.log('[NPC Generation Service] :', attributes);\n\n      // \n      const derivedStats = calculateDerivedStats(attributes);\n      console.log('[NPC Generation Service] :', derivedStats);\n\n      // \n      const skills = await this.generateSkillsForOccupation(basicInfo.occupation);\n      console.log('[NPC Generation Service] :', skills.size);\n\n      // NPC\n      const npc: NPCCharacter = {\n        id: `npc_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`,\n        type: 'npc',\n        name: basicInfo.name,\n        age: basicInfo.age,\n        occupation: basicInfo.occupation,\n        background: basicInfo.background,\n        attributes,\n        derivedStats,\n        skills,\n        bodyParts: this.generateDefaultBodyParts(),\n        inventory: [],\n        affection: 50, // \n        isImportant: false,\n        events: [],\n      };\n\n      console.log('[NPC Generation Service] NPC:', npc.name);\n      return npc;\n    } catch (error) {\n      console.error('[NPC Generation Service] NPC:', error);\n      throw new Error('NPC');\n    }\n  }\n\n  /**\n   * \n   * @param occupation \n   * @returns Map\n   */\n  private async generateSkillsForOccupation(occupation?: string): Promise<Map<string, number>> {\n    const skills = new Map<string, number>();\n\n    // \n    const baseSkills = [\n      { name: '', value: 25 },\n      { name: '', value: 25 },\n      { name: '', value: 25 },\n      { name: '', value: 80 },\n      { name: '', value: Math.floor(generateRandomAttributes().DEX / 2) },\n    ];\n\n    baseSkills.forEach(skill => {\n      skills.set(skill.name, skill.value);\n    });\n\n    // \n    if (occupation) {\n      try {\n        const prompt = `\"${occupation}\"5-8COC7\n\nJSON\n\\`\\`\\`json\n{\n  \"skills\": [\n    {\"name\": \"\", \"value\": 20-80}\n  ]\n}\n\\`\\`\\`\n\n\n- \n- 30-70\n- `;\n\n        const response = await generate({\n          user_input: prompt,\n          should_stream: false,\n        });\n\n        const jsonMatch = response.match(/```json\\n([\\s\\S]*?)\\n```/);\n        if (jsonMatch) {\n          const skillData = JSON.parse(jsonMatch[1]);\n          if (skillData.skills && Array.isArray(skillData.skills)) {\n            skillData.skills.forEach((skill: { name: string; value: number }) => {\n              if (!skills.has(skill.name)) {\n                skills.set(skill.name, skill.value);\n              }\n            });\n          }\n        }\n      } catch (error) {\n        console.warn('[NPC Generation Service] :', error);\n      }\n    }\n\n    return skills;\n  }\n\n  /**\n   * \n   */\n  private generateDefaultBodyParts(): import('../types/character').BodyPartStatus[] {\n    return [\n      {\n        id: 'head',\n        name: '',\n        damage: 0,\n        debuffs: [],\n      },\n      {\n        id: 'torso',\n        name: '',\n        damage: 0,\n        debuffs: [],\n      },\n      {\n        id: 'left_arm',\n        name: '',\n        damage: 0,\n        debuffs: [],\n      },\n      {\n        id: 'right_arm',\n        name: '',\n        damage: 0,\n        debuffs: [],\n      },\n      {\n        id: 'left_leg',\n        name: '',\n        damage: 0,\n        debuffs: [],\n      },\n      {\n        id: 'right_leg',\n        name: '',\n        damage: 0,\n        debuffs: [],\n      },\n    ];\n  }\n}\n\n// \nexport const npcGenerationService = new NPCGenerationService();\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// NPC  -  NPC \n\nimport type { NPCCharacter } from '../types/character';\nimport { withAPIContext, type WorldType } from '../utils/apiContext';\nimport { npcGenerationService } from './npcGenerationService';\n\n/**\n * NPC \n */\nexport type NPCGenerationProgressCallback = (current: number, total: number) => void;\n\n/**\n * NPC \n */\nexport enum NPCGenerationErrorType {\n  AI_SERVICE_UNAVAILABLE = 'AI_SERVICE_UNAVAILABLE',\n  PARSE_ERROR = 'PARSE_ERROR',\n  NETWORK_ERROR = 'NETWORK_ERROR',\n  UNKNOWN_ERROR = 'UNKNOWN_ERROR',\n}\n\n/**\n * NPC \n */\nexport interface NPCGenerationError {\n  type: NPCGenerationErrorType;\n  message: string;\n  originalError?: Error;\n  index?: number;\n}\n\n/**\n * NPC \n */\nexport interface NPCGenerationResult {\n  npcs: NPCCharacter[];\n  errors: NPCGenerationError[];\n  successCount: number;\n  failureCount: number;\n}\n\n/**\n * NPC \n *  NPC \n */\nclass NPCGenerationCoordinator {\n  /**\n   *  NPC \n   *\n   *  NPC  API\n   * -  NPC  innerWorld API AI\n   * -  NPC  sanctuary API AI\n   * -  NPC  realWorld API AI\n   *\n   * @param context \n   * @returns \n   */\n  private determineWorldType(context?: string): WorldType {\n    //  innerWorld\n    if (!context) {\n      console.log('[NPC Generation Coordinator]  innerWorld');\n      return 'innerWorld';\n    }\n\n    // \n    if (context === 'sanctuary' || context.includes('')) {\n      console.log('[NPC Generation Coordinator]  sanctuary API');\n      return 'sanctuary';\n    }\n\n    // \n    if (context === 'realWorld' || context.includes('') || context.includes('')) {\n      console.log('[NPC Generation Coordinator]  realWorld API');\n      return 'realWorld';\n    }\n\n    //  innerWorld\n    console.log(`[NPC Generation Coordinator]  \"${context}\" innerWorld API`);\n    return 'innerWorld';\n  }\n\n  /**\n   *  NPC \n   * difficulty + random(0, 1)\n   * @param difficulty  (1-5)\n   * @returns NPC \n   */\n  calculateNPCCount(difficulty: number): number {\n    if (difficulty < 1 || difficulty > 5) {\n      console.warn('[NPC Generation Coordinator]  (1-5) 3');\n      difficulty = 3;\n    }\n\n    //  = \n    //  = 0  1\n    const randomIncrement = Math.floor(Math.random() * 2);\n    const count = difficulty + randomIncrement;\n\n    console.log(`[NPC Generation Coordinator]  ${difficulty} -> NPC : ${count}`);\n    return count;\n  }\n\n  /**\n   * \n   * @param error \n   * @returns \n   */\n  private classifyError(error: Error): NPCGenerationErrorType {\n    const errorMessage = error.message.toLowerCase();\n\n    if (errorMessage.includes('ai') || errorMessage.includes('service') || errorMessage.includes('unavailable')) {\n      return NPCGenerationErrorType.AI_SERVICE_UNAVAILABLE;\n    }\n\n    if (errorMessage.includes('parse') || errorMessage.includes('json') || errorMessage.includes('format')) {\n      return NPCGenerationErrorType.PARSE_ERROR;\n    }\n\n    if (errorMessage.includes('network') || errorMessage.includes('timeout') || errorMessage.includes('fetch')) {\n      return NPCGenerationErrorType.NETWORK_ERROR;\n    }\n\n    return NPCGenerationErrorType.UNKNOWN_ERROR;\n  }\n\n  /**\n   * \n   * @param errorType \n   * @returns \n   */\n  private getUserFriendlyErrorMessage(errorType: NPCGenerationErrorType): string {\n    switch (errorType) {\n      case NPCGenerationErrorType.AI_SERVICE_UNAVAILABLE:\n        return 'AI ';\n      case NPCGenerationErrorType.PARSE_ERROR:\n        return 'AI ';\n      case NPCGenerationErrorType.NETWORK_ERROR:\n        return '';\n      case NPCGenerationErrorType.UNKNOWN_ERROR:\n        return '';\n      default:\n        return '';\n    }\n  }\n\n  /**\n   *  NPC\n   *  AI \n   * @param instanceType \n   * @returns  NPC\n   */\n  private async generateBasicFallbackNPC(instanceType: string): Promise<NPCCharacter> {\n    console.log('[NPC Generation Coordinator]  NPC...');\n\n    // \n    const { generateRandomAttributes, calculateDerivedStats } = await import('../utils/coc7Rules');\n\n    // \n    const attributes = generateRandomAttributes();\n    const derivedStats = calculateDerivedStats(attributes);\n\n    // \n    const occupations = ['', '', '', '', '', '', '', ''];\n    const occupation = occupations[Math.floor(Math.random() * occupations.length)];\n\n    // \n    const skills = new Map<string, number>();\n    skills.set('', 25);\n    skills.set('', 25);\n    skills.set('', 25);\n    skills.set('', 80);\n    skills.set('', Math.floor(attributes.DEX / 2));\n\n    // \n    const bodyParts = [\n      { id: 'head', name: '', damage: 0, debuffs: [] },\n      { id: 'torso', name: '', damage: 0, debuffs: [] },\n      { id: 'left_arm', name: '', damage: 0, debuffs: [] },\n      { id: 'right_arm', name: '', damage: 0, debuffs: [] },\n      { id: 'left_leg', name: '', damage: 0, debuffs: [] },\n      { id: 'right_leg', name: '', damage: 0, debuffs: [] },\n    ];\n\n    //  NPC\n    const npc: NPCCharacter = {\n      id: `npc_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`,\n      type: 'npc',\n      name: `${occupation}${Math.floor(Math.random() * 100)}`,\n      age: Math.floor(Math.random() * 40) + 20,\n      occupation,\n      background: `${occupation}${instanceType}`,\n      attributes,\n      derivedStats,\n      skills,\n      bodyParts,\n      inventory: [],\n      affection: 50,\n      isImportant: false,\n      events: [],\n    };\n\n    console.log('[NPC Generation Coordinator]  NPC :', npc.name);\n    return npc;\n  }\n\n  /**\n   *  NPC\n   * @param count NPC \n   * @param instanceType \n   * @param customNPCs  NPC\n   * @param onProgress \n   * @returns  NPC \n   */\n  async generateRandomNPCs(\n    count: number,\n    instanceType: string,\n    _customNPCs?: NPCCharacter[],\n    onProgress?: NPCGenerationProgressCallback,\n  ): Promise<NPCCharacter[]> {\n    console.log(`[NPC Generation Coordinator]  ${count}  NPC...`);\n    console.log(`[NPC Generation Coordinator] : ${instanceType}`);\n\n    // \n    const targetWorld = this.determineWorldType(instanceType);\n\n    const results: NPCCharacter[] = [];\n    const errors: NPCGenerationError[] = [];\n    let consecutiveFailures = 0;\n    const MAX_CONSECUTIVE_FAILURES = 3;\n\n    //  NPC\n    for (let i = 0; i < count; i++) {\n      try {\n        console.log(`[NPC Generation Coordinator]  ${i + 1}/${count}  NPC...`);\n\n        // \n        if (onProgress) {\n          onProgress(i + 1, count);\n        }\n\n        //  withAPIContext  sanctuary API\n        // NPC  AI  API\n        const npc = await withAPIContext('sanctuary', async () => {\n          return await npcGenerationService.generateRandom(instanceType);\n        });\n\n        results.push(npc);\n        consecutiveFailures = 0; // \n\n        console.log(`[NPC Generation Coordinator]   ${i + 1}  NPC : ${npc.name}`);\n      } catch (error) {\n        //  NPC \n        const err = error as Error;\n        const errorType = this.classifyError(err);\n        consecutiveFailures++;\n\n        console.error(`[NPC Generation Coordinator]   ${i + 1}  NPC :`, error);\n\n        errors.push({\n          type: errorType,\n          message: this.getUserFriendlyErrorMessage(errorType),\n          originalError: err,\n          index: i + 1,\n        });\n\n        // \n        if (consecutiveFailures >= MAX_CONSECUTIVE_FAILURES) {\n          console.warn(`[NPC Generation Coordinator]  ${consecutiveFailures} ...`);\n          toastr.warning('AI ...', 'NPC ', { timeOut: 3000 });\n\n          try {\n            const fallbackNPC = await this.generateBasicFallbackNPC(instanceType);\n            results.push(fallbackNPC);\n            consecutiveFailures = 0; // \n            console.log(`[NPC Generation Coordinator]  : ${fallbackNPC.name}`);\n          } catch (fallbackError) {\n            console.error('[NPC Generation Coordinator] :', fallbackError);\n            // \n          }\n        }\n      }\n    }\n\n    // \n    console.log(`[NPC Generation Coordinator] :  ${results.length}/${count}`);\n\n    //  NPC \n    if (results.length === 0 && errors.length > 0) {\n      const errorMessage = ' NPC ';\n      console.error(`[NPC Generation Coordinator] ${errorMessage}`);\n\n      // \n      const errorTypes = new Set(errors.map(e => e.type));\n      let suggestion = '';\n\n      if (errorTypes.has(NPCGenerationErrorType.AI_SERVICE_UNAVAILABLE)) {\n        suggestion = ' AI ';\n      } else if (errorTypes.has(NPCGenerationErrorType.NETWORK_ERROR)) {\n        suggestion = '';\n      } else {\n        suggestion = '';\n      }\n\n      toastr.error(`${errorMessage}${suggestion}`, 'NPC ', {\n        timeOut: 5000,\n        closeButton: true,\n      });\n\n      throw new Error(errorMessage);\n    }\n\n    //  NPC \n    if (errors.length > 0) {\n      const warningMessage = `${errors.length}  NPC  ${results.length} `;\n      console.warn(`[NPC Generation Coordinator] ${warningMessage}`);\n\n      // \n      const errorTypeCounts = new Map<NPCGenerationErrorType, number>();\n      errors.forEach(error => {\n        errorTypeCounts.set(error.type, (errorTypeCounts.get(error.type) || 0) + 1);\n      });\n\n      // \n      let detailedMessage = warningMessage;\n      if (errorTypeCounts.size > 0) {\n        const errorDetails = Array.from(errorTypeCounts.entries())\n          .map(([type, count]) => `${this.getUserFriendlyErrorMessage(type)} (${count})`)\n          .join('');\n        detailedMessage += `\\n${errorDetails}`;\n      }\n\n      toastr.warning(detailedMessage, 'NPC ', {\n        timeOut: 4000,\n        closeButton: true,\n      });\n    } else {\n      // \n      toastr.success(` ${results.length}  NPC`, 'NPC ', { timeOut: 2000 });\n    }\n\n    console.log(`[NPC Generation Coordinator]   ${results.length}  NPC`);\n    return results;\n  }\n\n  /**\n   *  NPC\n   * @param description \n   * @param instanceType \n   * @returns  NPC\n   */\n  async generateQuickNPC(description: string, instanceType: string): Promise<NPCCharacter> {\n    console.log('[NPC Generation Coordinator]  NPC...');\n    console.log('[NPC Generation Coordinator] :', description);\n\n    // \n    const targetWorld = this.determineWorldType(instanceType);\n\n    try {\n      //  withAPIContext  sanctuary API\n      // NPC  AI  API\n      const npc = await withAPIContext('sanctuary', async () => {\n        return await npcGenerationService.generateCustom(description, instanceType);\n      });\n\n      console.log('[NPC Generation Coordinator]  :', npc.name);\n      toastr.success(` NPC${npc.name}`, 'NPC ', { timeOut: 2000 });\n      return npc;\n    } catch (error) {\n      const err = error as Error;\n      const errorType = this.classifyError(err);\n\n      console.error('[NPC Generation Coordinator]  :', error);\n\n      // \n      const errorMessage = this.getUserFriendlyErrorMessage(errorType);\n      toastr.error(`${errorMessage}`, 'NPC ', {\n        timeOut: 4000,\n        closeButton: true,\n      });\n\n      //  AI \n      if (errorType === NPCGenerationErrorType.AI_SERVICE_UNAVAILABLE) {\n        console.log('[NPC Generation Coordinator] AI ...');\n        toastr.info('\"\" NPC', 'NPC ', {\n          timeOut: 4000,\n          closeButton: true,\n        });\n      }\n\n      throw new Error(errorMessage);\n    }\n  }\n\n  /**\n   * \n   *  UI \n   * @returns  NPC null\n   */\n  async openDetailedCreation(): Promise<NPCCharacter | null> {\n    console.log('[NPC Generation Coordinator] ...');\n\n    return new Promise<NPCCharacter | null>(resolve => {\n      // \n      const handleCreated = (character: NPCCharacter) => {\n        console.log('[NPC Generation Coordinator] :', character.name);\n        // \n        eventRemoveListener('npc_detailed_creation_completed', handleCreated);\n        eventRemoveListener('npc_detailed_creation_cancelled', handleCancelled);\n        resolve(character);\n      };\n\n      const handleCancelled = () => {\n        console.log('[NPC Generation Coordinator] ');\n        // \n        eventRemoveListener('npc_detailed_creation_completed', handleCreated);\n        eventRemoveListener('npc_detailed_creation_cancelled', handleCancelled);\n        resolve(null);\n      };\n\n      // \n      eventOn('npc_detailed_creation_completed', handleCreated);\n      eventOn('npc_detailed_creation_cancelled', handleCancelled);\n\n      // \n      console.log('[NPC Generation Coordinator]  npc_detailed_creation_requested ');\n      eventEmit('npc_detailed_creation_requested');\n    });\n  }\n\n  /**\n   *  NPC\n   * @param difficulty \n   * @param instanceType \n   * @param customNPCs  NPC\n   * @param onProgress \n   * @returns  NPC \n   */\n  async regenerateRandomNPCs(\n    difficulty: number,\n    instanceType: string,\n    customNPCs: NPCCharacter[],\n    onProgress?: NPCGenerationProgressCallback,\n  ): Promise<NPCCharacter[]> {\n    console.log('[NPC Generation Coordinator]  NPC...');\n    console.log('[NPC Generation Coordinator]  NPC :', customNPCs.length);\n\n    //  NPC \n    const totalCount = this.calculateNPCCount(difficulty);\n    const randomCount = totalCount - customNPCs.length;\n\n    console.log(\n      `[NPC Generation Coordinator] : ${totalCount}, : ${customNPCs.length}, : ${randomCount}`,\n    );\n\n    if (randomCount <= 0) {\n      console.log('[NPC Generation Coordinator]  NPC');\n      toastr.info(' NPC  NPC', 'NPC ', { timeOut: 2000 });\n      return [];\n    }\n\n    const results: NPCCharacter[] = [];\n    const errors: NPCGenerationError[] = [];\n    let consecutiveFailures = 0;\n    const MAX_CONSECUTIVE_FAILURES = 3;\n\n    //  NPC\n    const hasCustomNPCs = customNPCs.length > 0;\n\n    // \n    const targetWorld = this.determineWorldType(instanceType);\n\n    for (let i = 0; i < randomCount; i++) {\n      try {\n        console.log(`[NPC Generation Coordinator]  ${i + 1}/${randomCount}  NPC...`);\n\n        // \n        if (onProgress) {\n          onProgress(i + 1, randomCount);\n        }\n\n        //  withAPIContext  sanctuary API\n        // NPC  AI  API\n        const npc = await withAPIContext('sanctuary', async () => {\n          //  NPC\n          if (hasCustomNPCs) {\n            console.log('[NPC Generation Coordinator]  NPC ...');\n            return await npcGenerationService.generateRelatedNPC(instanceType, customNPCs);\n          } else {\n            //  NPC\n            return await npcGenerationService.generateRandom(instanceType);\n          }\n        });\n\n        results.push(npc);\n        consecutiveFailures = 0; // \n        console.log(`[NPC Generation Coordinator]   ${i + 1}  NPC : ${npc.name}`);\n      } catch (error) {\n        //  NPC \n        const err = error as Error;\n        const errorType = this.classifyError(err);\n        consecutiveFailures++;\n\n        console.error(`[NPC Generation Coordinator]   ${i + 1}  NPC :`, error);\n\n        errors.push({\n          type: errorType,\n          message: this.getUserFriendlyErrorMessage(errorType),\n          originalError: err,\n          index: i + 1,\n        });\n\n        // \n        if (consecutiveFailures >= MAX_CONSECUTIVE_FAILURES) {\n          console.warn(`[NPC Generation Coordinator]  ${consecutiveFailures} ...`);\n          toastr.warning('AI ...', 'NPC ', { timeOut: 3000 });\n\n          try {\n            const fallbackNPC = await this.generateBasicFallbackNPC(instanceType);\n            results.push(fallbackNPC);\n            consecutiveFailures = 0; // \n            console.log(`[NPC Generation Coordinator]  : ${fallbackNPC.name}`);\n          } catch (fallbackError) {\n            console.error('[NPC Generation Coordinator] :', fallbackError);\n            // \n          }\n        }\n      }\n    }\n\n    // \n    console.log(`[NPC Generation Coordinator] :  ${results.length}/${randomCount}`);\n\n    //  NPC \n    if (results.length === 0 && errors.length > 0) {\n      const errorMessage = ' NPC ';\n      console.error(`[NPC Generation Coordinator] ${errorMessage}`);\n\n      // \n      const errorTypes = new Set(errors.map(e => e.type));\n      let suggestion = '';\n\n      if (errorTypes.has(NPCGenerationErrorType.AI_SERVICE_UNAVAILABLE)) {\n        suggestion = ' AI ';\n      } else if (errorTypes.has(NPCGenerationErrorType.NETWORK_ERROR)) {\n        suggestion = '';\n      } else {\n        suggestion = '\" NPC\"';\n      }\n\n      toastr.error(`${errorMessage}${suggestion}`, 'NPC ', {\n        timeOut: 5000,\n        closeButton: true,\n      });\n\n      throw new Error(errorMessage);\n    }\n\n    //  NPC \n    if (errors.length > 0) {\n      const warningMessage = `${errors.length}  NPC  ${results.length} `;\n      console.warn(`[NPC Generation Coordinator] ${warningMessage}`);\n\n      // \n      const errorTypeCounts = new Map<NPCGenerationErrorType, number>();\n      errors.forEach(error => {\n        errorTypeCounts.set(error.type, (errorTypeCounts.get(error.type) || 0) + 1);\n      });\n\n      // \n      let detailedMessage = warningMessage;\n      if (errorTypeCounts.size > 0) {\n        const errorDetails = Array.from(errorTypeCounts.entries())\n          .map(([type, count]) => `${this.getUserFriendlyErrorMessage(type)} (${count})`)\n          .join('');\n        detailedMessage += `\\n${errorDetails}`;\n      }\n\n      toastr.warning(detailedMessage, 'NPC ', {\n        timeOut: 4000,\n        closeButton: true,\n      });\n    } else {\n      // \n      toastr.success(` ${results.length}  NPC`, 'NPC ', { timeOut: 2000 });\n    }\n\n    console.log(`[NPC Generation Coordinator]   ${results.length}  NPC`);\n    return results;\n  }\n}\n\n// \nexport const npcGenerationCoordinator = new NPCGenerationCoordinator();\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","//  -  API \n\nimport type { Character } from '../types/character';\n\n/**\n * \n */\ninterface TavernEventCallbacks {\n  onChatChanged?: (chatId: string) => void;\n  onMessageReceived?: (message: any) => void;\n  onCharacterChanged?: (characterId: string) => void;\n  onGenerationStarted?: () => void;\n  onGenerationStopped?: () => void;\n}\n\n/**\n * \n *  SillyTavern  API \n */\nclass TavernService {\n  private callbacks: TavernEventCallbacks = {};\n  private currentChatId: string = '';\n\n  /**\n   * \n   */\n  initialize(): void {\n    this.currentChatId = this.getCurrentChatId();\n    console.log('[Tavern Service]  ID:', this.currentChatId);\n  }\n\n  // ====================  ====================\n\n  /**\n   *  ID\n   */\n  getCurrentChatId(): string {\n    try {\n      const chatId = SillyTavern.getCurrentChatId();\n      if (!chatId) {\n        console.warn('[Tavern Service] ');\n        return '';\n      }\n      return chatId;\n    } catch (error) {\n      console.error('[Tavern Service]  ID :', error);\n      return '';\n    }\n  }\n\n  /**\n   *  ID\n   */\n  getCurrentCharacterId(): string {\n    try {\n      // SillyTavern \n      return SillyTavern.characterId || '';\n    } catch (error) {\n      console.error('[Tavern Service]  ID :', error);\n      return '';\n    }\n  }\n\n  /**\n   * \n   */\n  getChatMessages(): any[] {\n    try {\n      return getChatMessages('0-{{lastMessageId}}');\n    } catch (error) {\n      console.error('[Tavern Service] :', error);\n      return [];\n    }\n  }\n\n  // ====================  ====================\n\n  /**\n   * \n   * \n   * @param character \n   */\n  async updateUserCharacter(character: Character): Promise<void> {\n    try {\n      if (!character || !character.name) {\n        throw new Error('');\n      }\n\n      // \n      const description = this.buildCharacterDescription(character);\n\n      console.log('[Tavern Service] :', description.length);\n\n      //  SillyTavern API \n      const characterId = SillyTavern.characterId;\n      console.log('[Tavern Service]  ID:', characterId);\n\n      const currentChar = SillyTavern.characters[Number(characterId)];\n\n      if (!currentChar) {\n        console.error('[Tavern Service] characterId:', characterId);\n        throw new Error('');\n      }\n\n      console.log('[Tavern Service] :', currentChar.name);\n      console.log('[Tavern Service] :', currentChar.description?.length || 0);\n\n      // \n      currentChar.description = description;\n      console.log('[Tavern Service] ');\n\n      // \n      await SillyTavern.saveMetadata();\n      console.log('[Tavern Service] saveMetadata ');\n\n      console.log('[Tavern Service] :', character.name);\n      toastr.success(` ${character.name} `);\n    } catch (error) {\n      console.error('[Tavern Service] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * \n   */\n  private buildCharacterDescription(character: Character): string {\n    const { name, age, occupation, background, attributes, derivedStats } = character;\n\n    const description = `: ${name}\\n${age ? `: ${age}\\n` : ''}${occupation ? `: ${occupation}\\n` : ''}${background ? `: ${background}\\n\\n` : ''}:\\n (STR): ${attributes.STR}\\n (CON): ${attributes.CON}\\n (SIZ): ${attributes.SIZ}\\n (DEX): ${attributes.DEX}\\n (APP): ${attributes.APP}\\n (INT): ${attributes.INT}\\n (POW): ${attributes.POW}\\n (EDU): ${attributes.EDU}\\n (LUK): ${attributes.LUK}\\n\\n:\\n (HP): ${derivedStats.HP}/${derivedStats.maxHP}\\n (MP): ${derivedStats.MP}/${derivedStats.maxMP}\\n (SAN): ${derivedStats.SAN}/${derivedStats.maxSAN}\\n (MOV): ${derivedStats.MOV}\\n (DB): ${derivedStats.DB}\\n (BUILD): ${derivedStats.BUILD}\\n`;\n\n    return description;\n  }\n\n  /**\n   * \n   */\n  getCharacterList(): any[] {\n    try {\n      //  SillyTavern \n      return SillyTavern.characters || [];\n    } catch (error) {\n      console.error('[Tavern Service] :', error);\n      return [];\n    }\n  }\n\n  // ====================  ====================\n\n  /**\n   * \n   */\n  setupEventListeners(): void {\n    // \n    eventOn(tavern_events.CHAT_CHANGED, (chatId: string) => {\n      console.log('[Tavern Service] :', chatId);\n      this.currentChatId = chatId;\n\n      if (this.callbacks.onChatChanged) {\n        this.callbacks.onChatChanged(chatId);\n      }\n    });\n\n    // \n    eventOn(tavern_events.MESSAGE_RECEIVED, (message: any) => {\n      console.log('[Tavern Service] ');\n\n      if (this.callbacks.onMessageReceived) {\n        this.callbacks.onMessageReceived(message);\n      }\n    });\n\n    // \n    eventOn(tavern_events.CHARACTER_EDITED, (result: any) => {\n      console.log('[Tavern Service] :', result.detail?.id);\n\n      if (this.callbacks.onCharacterChanged && result.detail?.id) {\n        this.callbacks.onCharacterChanged(result.detail.id);\n      }\n    });\n\n    // \n    eventOn(tavern_events.GENERATION_STARTED, () => {\n      console.log('[Tavern Service] AI ');\n\n      if (this.callbacks.onGenerationStarted) {\n        this.callbacks.onGenerationStarted();\n      }\n    });\n\n    // \n    eventOn(tavern_events.GENERATION_STOPPED, () => {\n      console.log('[Tavern Service] AI ');\n\n      if (this.callbacks.onGenerationStopped) {\n        this.callbacks.onGenerationStopped();\n      }\n    });\n\n    console.log('[Tavern Service] ');\n  }\n\n  /**\n   * \n   */\n  setCallbacks(callbacks: TavernEventCallbacks): void {\n    this.callbacks = { ...this.callbacks, ...callbacks };\n  }\n\n  /**\n   * \n   */\n  clearCallbacks(): void {\n    this.callbacks = {};\n  }\n\n  // ====================  ====================\n\n  /**\n   *  AI \n   * @param options \n   */\n  async generate(options?: { user_input?: string }): Promise<void> {\n    try {\n      if (options?.user_input) {\n        await generate({ user_input: options.user_input });\n      } else {\n        await generate({});\n      }\n    } catch (error) {\n      console.error('[Tavern Service] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  stopGeneration(): void {\n    try {\n      //  SillyTavern \n      //  SillyTavern  API\n      console.log('[Tavern Service] ');\n    } catch (error) {\n      console.error('[Tavern Service] :', error);\n    }\n  }\n\n  // ====================  ====================\n\n  /**\n   * \n   * @param worldbookName \n   */\n  async getWorldbookEntries(worldbookName: string): Promise<any[]> {\n    try {\n      // \n      const entries = await getWorldbook(worldbookName);\n      return Array.from(entries);\n    } catch (error) {\n      console.error('[Tavern Service] :', error);\n      return [];\n    }\n  }\n\n  /**\n   * \n   * @param worldbookName \n   * @param entries \n   */\n  async updateWorldbook(worldbookName: string, entries: any[]): Promise<void> {\n    try {\n      await replaceWorldbook(worldbookName, entries);\n      console.log('[Tavern Service] ');\n    } catch (error) {\n      console.error('[Tavern Service] :', error);\n      throw error;\n    }\n  }\n\n  // ====================  ====================\n\n  /**\n   * \n   */\n  getGlobalVariables(): any {\n    try {\n      return getVariables({ type: 'global' });\n    } catch (error) {\n      console.error('[Tavern Service] :', error);\n      return {};\n    }\n  }\n\n  /**\n   * \n   */\n  async setGlobalVariables(variables: any): Promise<void> {\n    try {\n      await replaceVariables(variables, { type: 'global' });\n      console.log('[Tavern Service] ');\n    } catch (error) {\n      console.error('[Tavern Service] :', error);\n      throw error;\n    }\n  }\n\n  // ====================  ====================\n\n  /**\n   * \n   */\n  getContext(): typeof SillyTavern {\n    return SillyTavern;\n  }\n\n  /**\n   * \n   * @param message \n   * @param type \n   */\n  showNotification(message: string, type: 'success' | 'error' | 'info' | 'warning' = 'info'): void {\n    toastr[type](message);\n  }\n\n  /**\n   *  STScript \n   * @param command \n   */\n  async executeCommand(command: string): Promise<any> {\n    try {\n      return await triggerSlash(command);\n    } catch (error) {\n      console.error('[Tavern Service] :', command, error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  reloadInterface(): void {\n    window.location.reload();\n  }\n}\n\n// \nexport const tavernService = new TavernService();\n","// API  -  API \n\nimport type { APIConfig } from '../types/api';\nimport type { WorldType } from './apiConfigService';\nimport { apiConfigService } from './apiConfigService';\n\n/**\n * \n */\nexport interface InterceptorState {\n  /**  */\n  enabled: boolean;\n  /**  */\n  currentWorld: WorldType;\n  /**  */\n  lastWorldChange: number;\n  /**  */\n  requestCount: number;\n  /**  */\n  errorCount: number;\n}\n\n/**\n * \n */\nexport interface LogEntry {\n  /**  */\n  timestamp: number;\n  /**  */\n  level: 'info' | 'warn' | 'error';\n  /**  */\n  message: string;\n  /**  */\n  world?: WorldType;\n  /** API  */\n  apiConfig?: Partial<APIConfig>;\n  /**  */\n  error?: Error;\n}\n\n/**\n * \n */\nexport interface WorldDetectionResult {\n  /**  */\n  world: WorldType;\n  /**  */\n  confidence: 'high' | 'medium' | 'low';\n  /**  */\n  source: 'mvu' | 'service' | 'default';\n}\n\n/**\n * \n * \n */\nclass WorldDetector {\n  /**\n   *  MVU \n   *  Mvu.getMvuData({ type: 'chat' })  current_area\n   * sanctuary/innerWorld/realWorld\n   * 7.4 \n   * -  MVU \n   * - \n   * - \n   */\n  async detectFromMVU(): Promise<WorldDetectionResult> {\n    try {\n      //  Mvu \n      if (typeof Mvu === 'undefined') {\n        console.warn('[World Detector] MVU ');\n        return {\n          world: 'realWorld',\n          confidence: 'low',\n          source: 'default',\n        };\n      }\n\n      //  MVU \n      try {\n        await waitGlobalInitialized('Mvu');\n      } catch (error) {\n        console.warn('[World Detector]  MVU :', error);\n        return {\n          world: 'realWorld',\n          confidence: 'low',\n          source: 'default',\n        };\n      }\n\n      //  MVU \n      let mvuData: any;\n      try {\n        mvuData = Mvu.getMvuData({ type: 'chat' });\n      } catch (error) {\n        //  MVU \n        console.warn('[World Detector] MVU :', error);\n        return {\n          world: 'realWorld',\n          confidence: 'low',\n          source: 'default',\n        };\n      }\n\n      if (!mvuData || !mvuData.stat_data) {\n        console.warn('[World Detector] MVU ');\n        return {\n          world: 'realWorld',\n          confidence: 'low',\n          source: 'default',\n        };\n      }\n\n      //  stat_data  current_area\n      const currentArea = mvuData.stat_data.current_area;\n\n      if (!currentArea) {\n        console.warn('[World Detector] MVU  current_area');\n        return {\n          world: 'realWorld',\n          confidence: 'low',\n          source: 'default',\n        };\n      }\n\n      const area = currentArea as { type?: string; is_inner_world?: boolean; [key: string]: any };\n\n      // \n      // 1.  sanctuary\n      if (area.type === 'sanctuary') {\n        console.log('[World Detector]  MVU : sanctuary');\n        return {\n          world: 'sanctuary',\n          confidence: 'high',\n          source: 'mvu',\n        };\n      }\n\n      // 2. \n      if (area.is_inner_world === true) {\n        console.log('[World Detector]  MVU : innerWorld');\n        return {\n          world: 'innerWorld',\n          confidence: 'high',\n          source: 'mvu',\n        };\n      }\n\n      // 3. \n      console.log('[World Detector]  MVU : realWorld');\n      return {\n        world: 'realWorld',\n        confidence: 'high',\n        source: 'mvu',\n      };\n    } catch (error) {\n      // \n      console.error('[World Detector]  MVU :', error);\n\n      // \n      return {\n        world: 'realWorld',\n        confidence: 'low',\n        source: 'default',\n      };\n    }\n  }\n\n  /**\n   *  apiConfigService \n   *  MVU \n   */\n  detectFromService(): WorldDetectionResult {\n    try {\n      //  apiConfigService.getCurrentWorld() \n      const currentWorld = apiConfigService.getCurrentWorld();\n\n      if (currentWorld) {\n        console.log(`[World Detector]  Service : ${currentWorld}`);\n        return {\n          world: currentWorld,\n          confidence: 'medium',\n          source: 'service',\n        };\n      }\n\n      // \n      console.warn('[World Detector] Service ');\n      return {\n        world: 'realWorld',\n        confidence: 'low',\n        source: 'default',\n      };\n    } catch (error) {\n      console.error('[World Detector]  Service :', error);\n      return {\n        world: 'realWorld',\n        confidence: 'low',\n        source: 'default',\n      };\n    }\n  }\n\n  /**\n   * MVU > Service > Default\n   * \n   */\n  async detect(): Promise<WorldDetectionResult> {\n    console.log('[World Detector] ...');\n\n    // 1.  MVU \n    try {\n      const mvuResult = await this.detectFromMVU();\n\n      //  MVU \n      if (mvuResult.source === 'mvu' && mvuResult.confidence === 'high') {\n        console.log(`[World Detector] MVU : ${mvuResult.world} (: ${mvuResult.confidence})`);\n        return mvuResult;\n      }\n\n      //  MVU \n      if (mvuResult.source === 'default') {\n        console.warn('[World Detector] MVU ');\n      }\n    } catch (error) {\n      console.error('[World Detector] MVU :', error);\n    }\n\n    // 2.  apiConfigService \n    try {\n      const serviceResult = this.detectFromService();\n\n      //  Service \n      if (serviceResult.source === 'service' && serviceResult.confidence === 'medium') {\n        console.log(`[World Detector] Service : ${serviceResult.world} (: ${serviceResult.confidence})`);\n        return serviceResult;\n      }\n\n      //  Service \n      if (serviceResult.source === 'default') {\n        console.warn('[World Detector] Service ');\n      }\n    } catch (error) {\n      console.error('[World Detector] Service :', error);\n    }\n\n    // 3. \n    console.warn('[World Detector] : realWorld');\n    return {\n      world: 'realWorld',\n      confidence: 'low',\n      source: 'default',\n    };\n  }\n}\n\n/**\n * \n *  API \n */\nclass ConfigResolver {\n  /**  Map API  null */\n  private cache = new Map<WorldType, APIConfig | null>();\n\n  /**  Map */\n  private cacheTimestamp = new Map<WorldType, number>();\n\n  /**  5  */\n  private cacheTTL = 5 * 60 * 1000;\n\n  /**\n   * \n   *  apiConfigService \n   * 7.2 \n   * - \n   * - \n   * -  API\n   */\n  getConfig(world: WorldType): APIConfig | null {\n    try {\n      // \n      const timestamp = this.cacheTimestamp.get(world);\n      const now = Date.now();\n\n      if (timestamp && now - timestamp < this.cacheTTL) {\n        // \n        const cached = this.cache.get(world);\n        console.log(`[Config Resolver] : ${world}`);\n        return cached ?? null;\n      }\n\n      //  apiConfigService \n      let config: APIConfig | null = null;\n\n      try {\n        config = apiConfigService.getWorldAPI(world);\n      } catch (error) {\n        // \n        console.error(`[Config Resolver]  ${world} :`, error);\n        toastr.warning(` ${world} API  API`);\n\n        //  API null\n        config = null;\n      }\n\n      // \n      if (config) {\n        try {\n          const validation = apiConfigService.validateConfig(config);\n\n          if (!validation.valid) {\n            // \n            console.error(`[Config Resolver] ${world} :`, validation.errors);\n            toastr.error(`${world} API : ${validation.errors.join('; ')} API`);\n\n            //  API null\n            config = null;\n          }\n        } catch (error) {\n          console.error(`[Config Resolver]  ${world} :`, error);\n          toastr.warning(` ${world} API  API`);\n\n          //  API null\n          config = null;\n        }\n      }\n\n      // \n      this.cache.set(world, config);\n      this.cacheTimestamp.set(world, now);\n\n      console.log(`[Config Resolver] : ${world}`, config ? '' : ' API');\n      return config;\n    } catch (error) {\n      // \n      console.error(`[Config Resolver]  ${world} :`, error);\n      toastr.error(` ${world} API  API`);\n\n      //  API null\n      return null;\n    }\n  }\n\n  /**\n   * \n   * @param world \n   */\n  clearCache(world?: WorldType): void {\n    if (world) {\n      // \n      this.cache.delete(world);\n      this.cacheTimestamp.delete(world);\n      console.log(`[Config Resolver] : ${world}`);\n    } else {\n      // \n      this.cache.clear();\n      this.cacheTimestamp.clear();\n      console.log('[Config Resolver] ');\n    }\n  }\n\n  /**\n   * \n   * \n   */\n  async preloadConfigs(): Promise<void> {\n    console.log('[Config Resolver] ...');\n\n    const worlds: WorldType[] = ['realWorld', 'innerWorld', 'sanctuary'];\n\n    for (const world of worlds) {\n      try {\n        //  getConfig \n        const config = this.getConfig(world);\n        console.log(`[Config Resolver]  ${world} :`, config ? '' : ' API');\n      } catch (error) {\n        console.error(`[Config Resolver]  ${world} :`, error);\n        // \n      }\n    }\n\n    console.log('[Config Resolver] ');\n  }\n}\n\n/**\n * \n *  API \n */\nclass RequestModifier {\n  /**\n   *  generate \n   *  custom_api \n   */\n  applyToGenerate(config: GenerateConfig, apiConfig: APIConfig | null): GenerateConfig {\n    //  custom_api testConnection\n    if (config.custom_api) {\n      console.log('[Request Modifier]  custom_api');\n      return config;\n    }\n\n    // \n    if (!apiConfig) {\n      console.log('[Request Modifier]  API');\n      return config;\n    }\n\n    // \n    const validation = apiConfigService.validateConfig(apiConfig);\n    if (!validation.valid) {\n      console.error('[Request Modifier] :', validation.errors);\n      toastr.error(`API : ${validation.errors.join('; ')}`);\n      //  API\n      return config;\n    }\n\n    //  custom_api \n    const modifiedConfig: GenerateConfig = {\n      ...config, // \n      custom_api: {\n        apiurl: apiConfig.apiurl,\n        key: apiConfig.key,\n        model: apiConfig.model,\n        temperature: apiConfig.temperature,\n        max_tokens: apiConfig.max_tokens,\n        source: 'openai', //  OpenAI \n      },\n    };\n\n    console.log('[Request Modifier]  API  generate :', {\n      model: apiConfig.model,\n      apiurl: apiConfig.apiurl.substring(0, 30) + '...',\n      temperature: apiConfig.temperature,\n      max_tokens: apiConfig.max_tokens,\n    });\n\n    return modifiedConfig;\n  }\n\n  /**\n   *  generateRaw \n   *  generate  ordered_prompts \n   */\n  applyToGenerateRaw(config: GenerateRawConfig, apiConfig: APIConfig | null): GenerateRawConfig {\n    //  custom_api testConnection\n    if (config.custom_api) {\n      console.log('[Request Modifier]  custom_api');\n      return config;\n    }\n\n    // \n    if (!apiConfig) {\n      console.log('[Request Modifier]  API');\n      return config;\n    }\n\n    // \n    const validation = apiConfigService.validateConfig(apiConfig);\n    if (!validation.valid) {\n      console.error('[Request Modifier] :', validation.errors);\n      toastr.error(`API : ${validation.errors.join('; ')}`);\n      //  API\n      return config;\n    }\n\n    //  custom_api \n    //  ordered_prompts \n    const modifiedConfig: GenerateRawConfig = {\n      ...config, //  ordered_prompts\n      custom_api: {\n        apiurl: apiConfig.apiurl,\n        key: apiConfig.key,\n        model: apiConfig.model,\n        temperature: apiConfig.temperature,\n        max_tokens: apiConfig.max_tokens,\n        source: 'openai', //  OpenAI \n      },\n    };\n\n    console.log('[Request Modifier]  API  generateRaw :', {\n      model: apiConfig.model,\n      apiurl: apiConfig.apiurl.substring(0, 30) + '...',\n      temperature: apiConfig.temperature,\n      max_tokens: apiConfig.max_tokens,\n      has_ordered_prompts: !!config.ordered_prompts,\n    });\n\n    return modifiedConfig;\n  }\n\n  /**\n   * \n   *  apiConfigService.validateConfig() \n   */\n  validate(config: GenerateConfig | GenerateRawConfig): boolean {\n    //  custom_api API\n    if (!config.custom_api) {\n      console.log('[Request Modifier]  API');\n      return true;\n    }\n\n    //  APIConfig \n    const apiConfig: APIConfig = {\n      apiurl: config.custom_api.apiurl,\n      key: config.custom_api.key || '',\n      model: config.custom_api.model,\n      temperature: config.custom_api.temperature || 1.0,\n      max_tokens: config.custom_api.max_tokens || 2000,\n    };\n\n    //  apiConfigService.validateConfig() \n    const validation = apiConfigService.validateConfig(apiConfig);\n\n    if (!validation.valid) {\n      console.error('[Request Modifier] :', validation.errors);\n      toastr.error(`API : ${validation.errors.join('; ')}`);\n      return false;\n    }\n\n    console.log('[Request Modifier] ');\n    return true;\n  }\n}\n\n/**\n * API \n *  AI  API \n */\nclass APIAutoSwitchService {\n  /**  */\n  private initialized = false;\n\n  /**  */\n  private currentWorld: WorldType = 'realWorld';\n\n  /**  */\n  private state: InterceptorState = {\n    enabled: false,\n    currentWorld: 'realWorld',\n    lastWorldChange: Date.now(),\n    requestCount: 0,\n    errorCount: 0,\n  };\n\n  /**  generate  */\n  private originalGenerate: typeof generate | null = null;\n\n  /**  generateRaw  */\n  private originalGenerateRaw: typeof generateRaw | null = null;\n\n  /**  */\n  private worldDetector = new WorldDetector();\n\n  /**  */\n  private configResolver = new ConfigResolver();\n\n  /**  */\n  private requestModifier = new RequestModifier();\n\n  /** MVU  */\n  private mvuEventCleanup: (() => void) | null = null;\n\n  /** 12.3  */\n  private debugMode = false;\n\n  /**\n   * \n   * 7.1 \n   * -  apiConfigService \n   * -  MVU \n   * - \n   * - \n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      console.log('[API Auto Switch] ');\n      return;\n    }\n\n    try {\n      console.log('[API Auto Switch] ...');\n\n      //  apiConfigService\n      try {\n        await apiConfigService.initialize();\n        console.log('[API Auto Switch] apiConfigService ');\n      } catch (error) {\n        //  apiConfigService \n        console.error('[API Auto Switch] apiConfigService :', error);\n        toastr.warning('API  API');\n\n        this.log({\n          level: 'error',\n          message: 'apiConfigService ',\n          error: error instanceof Error ? error : new Error(String(error)),\n        });\n\n        // \n      }\n\n      // 10.3 \n      try {\n        this.currentWorld = await this.detectCurrentWorld();\n        this.state.currentWorld = this.currentWorld;\n        console.log(`[API Auto Switch] : ${this.currentWorld}`);\n      } catch (error) {\n        console.error('[API Auto Switch] :', error);\n        // \n        this.currentWorld = 'realWorld';\n        this.state.currentWorld = 'realWorld';\n      }\n\n      // \n      try {\n        await this.configResolver.preloadConfigs();\n        console.log('[API Auto Switch] ');\n      } catch (error) {\n        console.error('[API Auto Switch] :', error);\n        toastr.warning('API ');\n\n        this.log({\n          level: 'warn',\n          message: '',\n          error: error instanceof Error ? error : new Error(String(error)),\n        });\n\n        // \n      }\n\n      // \n      try {\n        this.setupInterceptors();\n        console.log('[API Auto Switch] ');\n      } catch (error) {\n        console.error('[API Auto Switch] :', error);\n        toastr.error('API ');\n\n        this.log({\n          level: 'error',\n          message: '',\n          error: error instanceof Error ? error : new Error(String(error)),\n        });\n\n        // \n        // \n        this.state.enabled = false;\n      }\n\n      // \n      try {\n        this.watchWorldChanges();\n        console.log('[API Auto Switch] ');\n      } catch (error) {\n        //  MVU \n        console.error('[API Auto Switch] :', error);\n\n        //  MVU \n        if (typeof Mvu === 'undefined') {\n          console.warn('[API Auto Switch] MVU ');\n          toastr.info('MVU API ');\n        } else {\n          toastr.warning('');\n        }\n\n        this.log({\n          level: 'warn',\n          message: '',\n          error: error instanceof Error ? error : new Error(String(error)),\n        });\n\n        // \n      }\n\n      this.initialized = true;\n      this.state.enabled = true;\n      console.log('[API Auto Switch] ');\n      toastr.success('API ');\n    } catch (error) {\n      // \n      console.error('[API Auto Switch] :', error);\n      toastr.error('API ');\n\n      this.log({\n        level: 'error',\n        message: '',\n        error: error instanceof Error ? error : new Error(String(error)),\n      });\n\n      // \n      this.state.enabled = false;\n    }\n  }\n\n  /**\n   * \n   * \n   */\n  setupInterceptors(): void {\n    console.log('[API Auto Switch] ...');\n\n    // 5.1 \n    //  window.generate  window.generateRaw\n    // \n    if (typeof window.generate === 'function') {\n      this.originalGenerate = window.generate;\n      console.log('[API Auto Switch]  generate ');\n    } else {\n      console.warn('[API Auto Switch] window.generate ');\n    }\n\n    if (typeof window.generateRaw === 'function') {\n      this.originalGenerateRaw = window.generateRaw;\n      console.log('[API Auto Switch]  generateRaw ');\n    } else {\n      console.warn('[API Auto Switch] window.generateRaw ');\n    }\n\n    // 5.4 \n    //  window.generate  window.generateRaw\n    if (this.originalGenerate) {\n      window.generate = this.interceptGenerate.bind(this);\n      console.log('[API Auto Switch]  window.generate');\n    }\n\n    if (this.originalGenerateRaw) {\n      window.generateRaw = this.interceptGenerateRaw.bind(this);\n      console.log('[API Auto Switch]  window.generateRaw');\n    }\n\n    console.log('[API Auto Switch] ');\n  }\n\n  /**\n   * \n   */\n  restoreOriginalFunctions(): void {\n    console.log('[API Auto Switch] ...');\n\n    //  generate \n    if (this.originalGenerate) {\n      window.generate = this.originalGenerate;\n      console.log('[API Auto Switch]  generate ');\n      this.originalGenerate = null;\n    }\n\n    //  generateRaw \n    if (this.originalGenerateRaw) {\n      window.generateRaw = this.originalGenerateRaw;\n      console.log('[API Auto Switch]  generateRaw ');\n      this.originalGenerateRaw = null;\n    }\n\n    console.log('[API Auto Switch] ');\n  }\n\n  /**\n   * \n   *  WorldDetector MVU > Service > Default\n   * 7.4 \n   * -  MVU \n   * - \n   * - \n   */\n  async detectCurrentWorld(): Promise<WorldType> {\n    try {\n      const result = await this.worldDetector.detect();\n\n      // \n      const logLevel = result.confidence === 'low' ? 'warn' : 'info';\n\n      // \n      if (result.source === 'default') {\n        console.warn('[API Auto Switch] : realWorld');\n\n        this.log({\n          level: 'warn',\n          message: `: ${result.world} (: ${result.source}, : ${result.confidence})`,\n          world: result.world,\n        });\n      } else {\n        this.log({\n          level: logLevel,\n          message: `: ${result.world} (: ${result.source}, : ${result.confidence})`,\n          world: result.world,\n        });\n      }\n\n      return result.world;\n    } catch (error) {\n      // \n      console.error('[API Auto Switch] :', error);\n\n      this.log({\n        level: 'error',\n        message: ': realWorld',\n        error: error instanceof Error ? error : new Error(String(error)),\n      });\n\n      // \n      return 'realWorld';\n    }\n  }\n\n  /**\n   * \n   * 6.1  MVU \n   * 6.2 \n   * 6.3 \n   */\n  watchWorldChanges(): void {\n    console.log('[API Auto Switch] ...');\n\n    // 6.1  MVU \n    //  eventOn(Mvu.events.VARIABLE_UPDATE_ENDED) \n    //  current_area \n    try {\n      //  MVU \n      if (typeof Mvu === 'undefined') {\n        console.warn('[API Auto Switch] MVU ');\n        return;\n      }\n\n      //  MVU \n      // \n      const eventHandler = async (variables: Mvu.MvuData) => {\n        //  stat_data  current_area\n        if (variables.stat_data && variables.stat_data.current_area) {\n          console.log('[API Auto Switch]  MVU ');\n\n          // 6.2 \n          await this.handleWorldChange();\n        }\n      };\n\n      // \n      eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, eventHandler);\n      console.log('[API Auto Switch]  MVU ');\n\n      // \n      this.mvuEventCleanup = () => {\n        eventRemoveListener(Mvu.events.VARIABLE_UPDATE_ENDED, eventHandler);\n        console.log('[API Auto Switch]  MVU ');\n      };\n    } catch (error) {\n      console.error('[API Auto Switch]  MVU :', error);\n    }\n\n    // 6.3 \n    //  apiConfigService \n    //  apiAutoSwitchService \n    try {\n      // \n      const originalSwitchToRealWorld = apiConfigService.switchToRealWorld.bind(apiConfigService);\n      const originalSwitchToInnerWorld = apiConfigService.switchToInnerWorld.bind(apiConfigService);\n      const originalSwitchToSanctuary = apiConfigService.switchToSanctuary.bind(apiConfigService);\n\n      // \n      apiConfigService.switchToRealWorld = async () => {\n        console.log('[API Auto Switch] ');\n        originalSwitchToRealWorld();\n        await this.handleWorldChange();\n      };\n\n      apiConfigService.switchToInnerWorld = async () => {\n        console.log('[API Auto Switch] ');\n        originalSwitchToInnerWorld();\n        await this.handleWorldChange();\n      };\n\n      apiConfigService.switchToSanctuary = async () => {\n        console.log('[API Auto Switch] ');\n        originalSwitchToSanctuary();\n        await this.handleWorldChange();\n      };\n\n      console.log('[API Auto Switch] ');\n    } catch (error) {\n      console.error('[API Auto Switch] :', error);\n    }\n\n    console.log('[API Auto Switch] ');\n  }\n\n  /**\n   * \n   * 6.2 \n   * - \n   * -  currentWorld \n   * - \n   * - \n   * 12.2  API \n   * -  toastr \n   * -  API\n   */\n  private async handleWorldChange(): Promise<void> {\n    try {\n      console.log('[API Auto Switch] ...');\n\n      // \n      const oldWorld = this.currentWorld;\n\n      // \n      const newWorld = await this.detectCurrentWorld();\n\n      // \n      if (oldWorld === newWorld) {\n        console.log(`[API Auto Switch] : ${newWorld}`);\n        return;\n      }\n\n      console.log(`[API Auto Switch] : ${oldWorld}  ${newWorld}`);\n\n      //  currentWorld \n      this.currentWorld = newWorld;\n      this.state.currentWorld = newWorld;\n      this.state.lastWorldChange = Date.now();\n\n      // \n      // \n      this.configResolver.clearCache();\n      console.log('[API Auto Switch] ');\n\n      //  API \n      const newConfig = this.configResolver.getConfig(newWorld);\n\n      //  - \n      this.log({\n        level: 'info',\n        message: `: ${oldWorld}  ${newWorld}`,\n        world: newWorld,\n        apiConfig: newConfig\n          ? {\n              model: newConfig.model,\n              apiurl: newConfig.apiurl,\n            }\n          : undefined,\n      });\n\n      // 12.2  -  API \n      const worldName = this.getWorldDisplayName(newWorld);\n      const apiInfo = newConfig ? ` API (${newConfig.model})` : ' API';\n\n      toastr.success(`: ${worldName}<br> API: ${apiInfo}`, '', {\n        timeOut: 5000,\n        extendedTimeOut: 2000,\n        closeButton: true,\n        progressBar: true,\n      });\n\n      console.log('[API Auto Switch] ');\n    } catch (error) {\n      console.error('[API Auto Switch] :', error);\n\n      this.log({\n        level: 'error',\n        message: '',\n        error: error instanceof Error ? error : new Error(String(error)),\n      });\n    }\n  }\n\n  /**\n   * \n   */\n  private getWorldDisplayName(world: WorldType): string {\n    const displayNames: Record<WorldType, string> = {\n      realWorld: '',\n      innerWorld: '',\n      sanctuary: '',\n    };\n    return displayNames[world] || world;\n  }\n\n  /**\n   *  API \n   *  ConfigResolver \n   * 10.3 \n   */\n  getCurrentAPIConfig(): APIConfig | null {\n    try {\n      //  ConfigResolver \n      const config = this.configResolver.getConfig(this.currentWorld);\n\n      // 10.3 \n      // ConfigResolver /\n      // \n      if (config) {\n        console.log(`[API Auto Switch]  ${this.currentWorld}  API `);\n      } else {\n        console.log(`[API Auto Switch] ${this.currentWorld}  API`);\n      }\n\n      return config;\n    } catch (error) {\n      this.log({\n        level: 'error',\n        message: ` ${this.currentWorld}  API `,\n        world: this.currentWorld,\n        error: error instanceof Error ? error : new Error(String(error)),\n      });\n\n      //  null API\n      return null;\n    }\n  }\n\n  /**\n   * 5.2  generate \n   *  API \n   * 7.3 \n   * -  API \n   * - \n   * - \n   * 10.3 \n   * -  currentWorld\n   * -  ConfigResolver \n   * 12.3 \n   * - \n   * - \n   */\n  private async interceptGenerate(config: GenerateConfig): Promise<string> {\n    try {\n      // \n      this.state.requestCount++;\n\n      // 10.3 \n      console.log(`[API Auto Switch]  generate  #${this.state.requestCount}`);\n\n      // 12.3 \n      if (this.debugMode) {\n        console.group(`[API Auto Switch Debug] generate  #${this.state.requestCount}`);\n        console.log(':', {\n          user_input:\n            config.user_input?.substring(0, 100) + (config.user_input && config.user_input.length > 100 ? '...' : ''),\n          should_stream: config.should_stream,\n          has_custom_api: !!config.custom_api,\n        });\n      }\n\n      // 1. \n      // \n      //  this.currentWorld handleWorldChange() \n      this.state.currentWorld = this.currentWorld;\n\n      // 12.3 \n      if (this.debugMode) {\n        console.log(':', this.currentWorld);\n      }\n\n      // 2.  API ConfigResolver \n      const apiConfig = this.getCurrentAPIConfig();\n\n      // 12.3  API \n      if (this.debugMode) {\n        if (apiConfig) {\n          console.log(' API :', {\n            model: apiConfig.model,\n            apiurl: apiConfig.apiurl.substring(0, 50) + '...',\n            temperature: apiConfig.temperature,\n            max_tokens: apiConfig.max_tokens,\n          });\n        } else {\n          console.log(' API');\n        }\n      }\n\n      // 3. \n      let modifiedConfig = config;\n      if (apiConfig) {\n        modifiedConfig = this.applyAPIConfigToGenerate(config, apiConfig);\n\n        // \n        if (!this.validateRequestConfig(modifiedConfig)) {\n          console.warn('[API Auto Switch] ');\n          modifiedConfig = config;\n\n          // 12.3 \n          if (this.debugMode) {\n            console.warn('');\n          }\n        } else if (this.debugMode) {\n          // 12.3 \n          console.log(' custom_api:', {\n            model: modifiedConfig.custom_api?.model,\n            apiurl: modifiedConfig.custom_api?.apiurl?.substring(0, 50) + '...',\n            temperature: modifiedConfig.custom_api?.temperature,\n            max_tokens: modifiedConfig.custom_api?.max_tokens,\n          });\n        }\n      }\n\n      // 4. \n      let result: string;\n      try {\n        // 12.3 \n        const startTime = this.debugMode ? Date.now() : 0;\n\n        result = await this.originalGenerate!(modifiedConfig);\n\n        // 10.3 \n        console.log(`[API Auto Switch] generate  #${this.state.requestCount}`);\n\n        // 12.3 \n        if (this.debugMode) {\n          const duration = Date.now() - startTime;\n          console.log(':', {\n            duration: `${duration}ms`,\n            response_length: result.length,\n            response_preview: result.substring(0, 100) + (result.length > 100 ? '...' : ''),\n          });\n          console.groupEnd();\n        }\n      } catch (error) {\n        //  API \n        this.state.errorCount++;\n\n        // \n        const errorMessage = error instanceof Error ? error.message : String(error);\n\n        console.error(`[API Auto Switch] generate  #${this.state.errorCount}:`, errorMessage);\n\n        // 12.3 \n        if (this.debugMode) {\n          console.error(':', {\n            error: error,\n            world: this.currentWorld,\n            apiConfig: apiConfig\n              ? {\n                  model: apiConfig.model,\n                  apiurl: apiConfig.apiurl.substring(0, 50) + '...',\n                }\n              : ' API',\n          });\n          console.groupEnd();\n        }\n\n        this.log({\n          level: 'error',\n          message: `generate  ( #${this.state.errorCount}): ${errorMessage}`,\n          world: this.currentWorld,\n          error: error instanceof Error ? error : new Error(String(error)),\n          apiConfig: apiConfig\n            ? {\n                model: apiConfig.model,\n                apiurl: apiConfig.apiurl.substring(0, 30) + '...',\n              }\n            : undefined,\n        });\n\n        // \n        toastr.error(`AI : ${errorMessage}`);\n\n        // \n        throw error;\n      }\n\n      return result;\n    } catch (error) {\n      // 5. \n      this.state.errorCount++;\n\n      // \n      const errorMessage = error instanceof Error ? error.message : String(error);\n\n      console.error(`[API Auto Switch] generate  #${this.state.errorCount}:`, errorMessage);\n\n      // 12.3 \n      if (this.debugMode) {\n        console.error(':', error);\n        console.groupEnd();\n      }\n\n      this.log({\n        level: 'error',\n        message: `generate  ( #${this.state.errorCount}): ${errorMessage}`,\n        world: this.currentWorld,\n        error: error instanceof Error ? error : new Error(String(error)),\n      });\n\n      // \n      throw error;\n    }\n  }\n\n  /**\n   * 5.3  generateRaw \n   *  generate  ordered_prompts \n   * 7.3 \n   * -  API \n   * - \n   * - \n   * 10.3 \n   * -  currentWorld\n   * -  ConfigResolver \n   * 12.3 \n   * - \n   * - \n   */\n  private async interceptGenerateRaw(config: GenerateRawConfig): Promise<string> {\n    try {\n      // \n      this.state.requestCount++;\n\n      // 10.3 \n      console.log(`[API Auto Switch]  generateRaw  #${this.state.requestCount}`);\n\n      // 12.3 \n      if (this.debugMode) {\n        console.group(`[API Auto Switch Debug] generateRaw  #${this.state.requestCount}`);\n        console.log(':', {\n          ordered_prompts_count: config.ordered_prompts?.length || 0,\n          has_custom_api: !!config.custom_api,\n        });\n        if (config.ordered_prompts && config.ordered_prompts.length > 0) {\n          const firstPrompt = config.ordered_prompts[0];\n          //  RolePrompt role  content \n          if (typeof firstPrompt === 'object' && 'role' in firstPrompt && 'content' in firstPrompt) {\n            console.log(' prompt:', {\n              role: firstPrompt.role,\n              content: firstPrompt.content.substring(0, 100) + (firstPrompt.content.length > 100 ? '...' : ''),\n            });\n          } else {\n            // BuiltinPrompt\n            console.log(' prompt:', firstPrompt);\n          }\n        }\n      }\n\n      // 1. \n      // \n      //  this.currentWorld handleWorldChange() \n      this.state.currentWorld = this.currentWorld;\n\n      // 12.3 \n      if (this.debugMode) {\n        console.log(':', this.currentWorld);\n      }\n\n      // 2.  API ConfigResolver \n      const apiConfig = this.getCurrentAPIConfig();\n\n      // 12.3  API \n      if (this.debugMode) {\n        if (apiConfig) {\n          console.log(' API :', {\n            model: apiConfig.model,\n            apiurl: apiConfig.apiurl.substring(0, 50) + '...',\n            temperature: apiConfig.temperature,\n            max_tokens: apiConfig.max_tokens,\n          });\n        } else {\n          console.log(' API');\n        }\n      }\n\n      // 3.  ordered_prompts \n      let modifiedConfig = config;\n      if (apiConfig) {\n        modifiedConfig = this.applyAPIConfigToGenerateRaw(config, apiConfig);\n\n        // \n        if (!this.validateRequestConfig(modifiedConfig)) {\n          console.warn('[API Auto Switch] ');\n          modifiedConfig = config;\n\n          // 12.3 \n          if (this.debugMode) {\n            console.warn('');\n          }\n        } else if (this.debugMode) {\n          // 12.3 \n          console.log(' custom_api:', {\n            model: modifiedConfig.custom_api?.model,\n            apiurl: modifiedConfig.custom_api?.apiurl?.substring(0, 50) + '...',\n            temperature: modifiedConfig.custom_api?.temperature,\n            max_tokens: modifiedConfig.custom_api?.max_tokens,\n          });\n        }\n      }\n\n      // 4. \n      let result: string;\n      try {\n        // 12.3 \n        const startTime = this.debugMode ? Date.now() : 0;\n\n        result = await this.originalGenerateRaw!(modifiedConfig);\n\n        // 10.3 \n        console.log(`[API Auto Switch] generateRaw  #${this.state.requestCount}`);\n\n        // 12.3 \n        if (this.debugMode) {\n          const duration = Date.now() - startTime;\n          console.log(':', {\n            duration: `${duration}ms`,\n            response_length: result.length,\n            response_preview: result.substring(0, 100) + (result.length > 100 ? '...' : ''),\n          });\n          console.groupEnd();\n        }\n      } catch (error) {\n        //  API \n        this.state.errorCount++;\n\n        // \n        const errorMessage = error instanceof Error ? error.message : String(error);\n\n        console.error(`[API Auto Switch] generateRaw  #${this.state.errorCount}:`, errorMessage);\n\n        // 12.3 \n        if (this.debugMode) {\n          console.error(':', {\n            error: error,\n            world: this.currentWorld,\n            apiConfig: apiConfig\n              ? {\n                  model: apiConfig.model,\n                  apiurl: apiConfig.apiurl.substring(0, 50) + '...',\n                }\n              : ' API',\n          });\n          console.groupEnd();\n        }\n\n        this.log({\n          level: 'error',\n          message: `generateRaw  ( #${this.state.errorCount}): ${errorMessage}`,\n          world: this.currentWorld,\n          error: error instanceof Error ? error : new Error(String(error)),\n          apiConfig: apiConfig\n            ? {\n                model: apiConfig.model,\n                apiurl: apiConfig.apiurl.substring(0, 30) + '...',\n              }\n            : undefined,\n        });\n\n        // \n        toastr.error(`AI : ${errorMessage}`);\n\n        // \n        throw error;\n      }\n\n      return result;\n    } catch (error) {\n      // 5. \n      this.state.errorCount++;\n\n      // \n      const errorMessage = error instanceof Error ? error.message : String(error);\n\n      console.error(`[API Auto Switch] generateRaw  #${this.state.errorCount}:`, errorMessage);\n\n      // 12.3 \n      if (this.debugMode) {\n        console.error(':', error);\n        console.groupEnd();\n      }\n\n      this.log({\n        level: 'error',\n        message: `generateRaw  ( #${this.state.errorCount}): ${errorMessage}`,\n        world: this.currentWorld,\n        error: error instanceof Error ? error : new Error(String(error)),\n      });\n\n      // \n      throw error;\n    }\n  }\n\n  /**\n   *  API  generate \n   */\n  private applyAPIConfigToGenerate(config: GenerateConfig, apiConfig: APIConfig | null): GenerateConfig {\n    return this.requestModifier.applyToGenerate(config, apiConfig);\n  }\n\n  /**\n   *  API  generateRaw \n   */\n  private applyAPIConfigToGenerateRaw(config: GenerateRawConfig, apiConfig: APIConfig | null): GenerateRawConfig {\n    return this.requestModifier.applyToGenerateRaw(config, apiConfig);\n  }\n\n  /**\n   * \n   */\n  private validateRequestConfig(config: GenerateConfig | GenerateRawConfig): boolean {\n    return this.requestModifier.validate(config);\n  }\n\n  /**\n   * \n   */\n  async cleanup(): Promise<void> {\n    try {\n      console.log('[API Auto Switch] ...');\n\n      // \n      this.restoreOriginalFunctions();\n\n      // \n      if (this.mvuEventCleanup) {\n        this.mvuEventCleanup();\n        this.mvuEventCleanup = null;\n        console.log('[API Auto Switch] ');\n      }\n\n      // \n      this.configResolver.clearCache();\n      console.log('[API Auto Switch] ');\n\n      // \n      this.state = {\n        enabled: false,\n        currentWorld: 'realWorld',\n        lastWorldChange: Date.now(),\n        requestCount: 0,\n        errorCount: 0,\n      };\n\n      this.initialized = false;\n      this.state.enabled = false;\n      console.log('[API Auto Switch] ');\n    } catch (error) {\n      console.error('[API Auto Switch] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  getState(): InterceptorState {\n    return { ...this.state };\n  }\n\n  /**\n   * 12.3 \n   * \n   */\n  enableDebugMode(): void {\n    this.debugMode = true;\n    console.log('[API Auto Switch] ');\n    toastr.info('API ');\n  }\n\n  /**\n   * 12.3 \n   */\n  disableDebugMode(): void {\n    this.debugMode = false;\n    console.log('[API Auto Switch] ');\n    toastr.info('API ');\n  }\n\n  /**\n   * 12.3 \n   */\n  toggleDebugMode(): void {\n    if (this.debugMode) {\n      this.disableDebugMode();\n    } else {\n      this.enableDebugMode();\n    }\n  }\n\n  /**\n   * 12.3 \n   */\n  isDebugMode(): boolean {\n    return this.debugMode;\n  }\n\n  /**\n   * 8.1 \n   * -  `[API Auto Switch]` \n   * - \n   * -  info/warn/error \n   *\n   * 8.3 \n   * - API \n   * - API \n   * - \n   */\n  private log(entry: Omit<LogEntry, 'timestamp'>): void {\n    const logEntry: LogEntry = {\n      ...entry,\n      timestamp: Date.now(),\n    };\n\n    // 8.1 \n    const prefix = '[API Auto Switch]';\n    const timestamp = new Date(logEntry.timestamp).toISOString();\n    const worldInfo = logEntry.world ? ` [${logEntry.world}]` : '';\n\n    // 8.3  -  API \n    let apiConfigInfo = '';\n    if (logEntry.apiConfig) {\n      const safeConfig: any = {};\n\n      // API \n      if (logEntry.apiConfig.key) {\n        const key = logEntry.apiConfig.key;\n        if (key.length > 8) {\n          safeConfig.key = `${key.substring(0, 4)}...${key.substring(key.length - 4)}`;\n        } else {\n          safeConfig.key = '***';\n        }\n      }\n\n      // API \n      if (logEntry.apiConfig.apiurl) {\n        const url = logEntry.apiConfig.apiurl;\n        if (url.length > 50) {\n          safeConfig.apiurl = url.substring(0, 47) + '...';\n        } else {\n          safeConfig.apiurl = url;\n        }\n      }\n\n      // modeltemperaturemax_tokens\n      if (logEntry.apiConfig.model) {\n        safeConfig.model = logEntry.apiConfig.model;\n      }\n      if (logEntry.apiConfig.temperature !== undefined) {\n        safeConfig.temperature = logEntry.apiConfig.temperature;\n      }\n      if (logEntry.apiConfig.max_tokens !== undefined) {\n        safeConfig.max_tokens = logEntry.apiConfig.max_tokens;\n      }\n\n      apiConfigInfo = ` [API: ${JSON.stringify(safeConfig)}]`;\n    }\n\n    // \n    const fullMessage = `${prefix} [${timestamp}]${worldInfo} ${logEntry.message}${apiConfigInfo}`;\n\n    // \n    switch (logEntry.level) {\n      case 'info':\n        console.log(fullMessage);\n        if (logEntry.error) {\n          console.log('  Error details:', logEntry.error);\n        }\n        break;\n      case 'warn':\n        console.warn(fullMessage);\n        if (logEntry.error) {\n          console.warn('  Error details:', logEntry.error);\n        }\n        break;\n      case 'error':\n        console.error(fullMessage);\n        if (logEntry.error) {\n          console.error('  Error details:', logEntry.error);\n          if (logEntry.error.stack) {\n            console.error('  Stack trace:', logEntry.error.stack);\n          }\n        }\n        break;\n    }\n  }\n}\n\n// \nexport const apiAutoSwitchService = new APIAutoSwitchService();\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, openBlock as _openBlock, createElementBlock as _createElementBlock, renderList as _renderList, Fragment as _Fragment, createTextVNode as _createTextVNode, vModelText as _vModelText, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = { class: \"api-config-panel\" };\nconst _hoisted_2 = { class: \"current-api-info\" };\nconst _hoisted_3 = { class: \"info-row\" };\nconst _hoisted_4 = { class: \"info-value\" };\nconst _hoisted_5 = { class: \"info-row\" };\nconst _hoisted_6 = {\n    key: 0,\n    class: \"info-row model-info\"\n};\nconst _hoisted_7 = { class: \"info-value\" };\nconst _hoisted_8 = { class: \"config-tabs\" };\nconst _hoisted_9 = [\"onClick\"];\nconst _hoisted_10 = { class: \"config-form\" };\nconst _hoisted_11 = { class: \"form-group\" };\nconst _hoisted_12 = { class: \"form-label\" };\nconst _hoisted_13 = [\"checked\"];\nconst _hoisted_14 = { class: \"form-group\" };\nconst _hoisted_15 = { class: \"form-group\" };\nconst _hoisted_16 = { class: \"form-group\" };\nconst _hoisted_17 = { class: \"model-input-group\" };\nconst _hoisted_18 = { class: \"model-presets\" };\nconst _hoisted_19 = [\"title\", \"onClick\"];\nconst _hoisted_20 = { class: \"form-group\" };\nconst _hoisted_21 = { class: \"form-label\" };\nconst _hoisted_22 = { class: \"form-group\" };\nconst _hoisted_23 = { class: \"form-actions\" };\nconst _hoisted_24 = [\"disabled\"];\nconst _hoisted_25 = { class: \"debug-mode-section\" };\nconst _hoisted_26 = { class: \"debug-mode-label\" };\nconst _hoisted_27 = [\"checked\"];\nimport { computed, onMounted, ref } from 'vue';\nimport { apiAutoSwitchService } from '../services/apiAutoSwitchService';\nimport { apiConfigService } from '../services/apiConfigService';\n// \nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'APIConfigPanel',\n    emits: [\"close\"],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        // \n        const worlds = [\n            { key: 'realWorld', name: '' },\n            { key: 'innerWorld', name: '' },\n            { key: 'sanctuary', name: '' },\n        ];\n        //  API \n        const modelPresets = [\n            // Gemini  -  SillyTavern \n            {\n                label: 'Gemini Pro 2.5',\n                value: 'gemini-2.5-pro-latest',\n                apiurl: 'http://localhost:8000/api/backends/google_gemini/chat-completions/generate',\n                description: 'Google  Pro  SillyTavern ',\n            },\n            {\n                label: 'Gemini 2.0 Flash',\n                value: 'gemini-2.0-flash-exp',\n                apiurl: 'http://localhost:8000/api/backends/google_gemini/chat-completions/generate',\n                description: 'Google 2.0  SillyTavern ',\n            },\n            {\n                label: 'Gemini 1.5 Pro',\n                value: 'gemini-1.5-pro-latest',\n                apiurl: 'http://localhost:8000/api/backends/google_gemini/chat-completions/generate',\n                description: 'Google 1.5  SillyTavern ',\n            },\n            {\n                label: 'Gemini 1.5 Flash',\n                value: 'gemini-1.5-flash-latest',\n                apiurl: 'http://localhost:8000/api/backends/google_gemini/chat-completions/generate',\n                description: 'Google 1.5  SillyTavern ',\n            },\n            {\n                label: 'Gemini Pro',\n                value: 'gemini-pro',\n                apiurl: 'http://localhost:8000/api/backends/google_gemini/chat-completions/generate',\n                description: 'Google  SillyTavern ',\n            },\n            // GPT  -  SillyTavern \n            {\n                label: 'GPT-4',\n                value: 'gpt-4',\n                apiurl: 'http://localhost:8000/api/backends/openai/chat-completions/generate',\n                description: 'OpenAI  SillyTavern ',\n            },\n            {\n                label: 'GPT-4 Turbo',\n                value: 'gpt-4-turbo-preview',\n                apiurl: 'http://localhost:8000/api/backends/openai/chat-completions/generate',\n                description: 'OpenAI  SillyTavern ',\n            },\n            {\n                label: 'GPT-3.5',\n                value: 'gpt-3.5-turbo',\n                apiurl: 'http://localhost:8000/api/backends/openai/chat-completions/generate',\n                description: 'OpenAI  SillyTavern ',\n            },\n            // Claude  -  SillyTavern \n            {\n                label: 'Claude 3 Opus',\n                value: 'claude-3-opus-20240229',\n                apiurl: 'http://localhost:8000/api/backends/anthropic/chat-completions/generate',\n                description: 'Anthropic  SillyTavern ',\n            },\n            {\n                label: 'Claude 3 Sonnet',\n                value: 'claude-3-sonnet-20240229',\n                apiurl: 'http://localhost:8000/api/backends/anthropic/chat-completions/generate',\n                description: 'Anthropic  SillyTavern ',\n            },\n            {\n                label: 'Claude 3 Haiku',\n                value: 'claude-3-haiku-20240307',\n                apiurl: 'http://localhost:8000/api/backends/anthropic/chat-completions/generate',\n                description: 'Anthropic  SillyTavern ',\n            },\n        ];\n        // \n        const activeTab = ref('realWorld');\n        const configs = ref({\n            realWorld: null,\n            innerWorld: null,\n            sanctuary: null,\n        });\n        const testing = ref(false);\n        const testResult = ref(null);\n        const debugMode = ref(false);\n        // \n        const currentWorldName = computed(() => {\n            const currentWorld = apiConfigService.getCurrentWorld();\n            const world = worlds.find(w => w.key === currentWorld);\n            return world ? world.name : '';\n        });\n        const currentAPIStatus = computed(() => {\n            const currentWorld = apiConfigService.getCurrentWorld();\n            const currentConfig = configs.value[currentWorld];\n            if (currentConfig) {\n                //  API\n                return {\n                    isCustom: true,\n                    displayText: ' API',\n                    model: currentConfig.model || '',\n                };\n            }\n            else {\n                //  API\n                return {\n                    isCustom: false,\n                    displayText: ' API',\n                    model: null,\n                };\n            }\n        });\n        // \n        onMounted(async () => {\n            try {\n                await apiConfigService.initialize();\n                configs.value = apiConfigService.getAllConfigs();\n                debugMode.value = apiAutoSwitchService.isDebugMode();\n                console.log('[API Config Panel] :', configs.value);\n            }\n            catch (error) {\n                console.error('[API Config Panel] :', error);\n                toastr.error(' API ');\n            }\n        });\n        // \n        function toggleConfig(world, event) {\n            const checkbox = event.target;\n            if (checkbox.checked) {\n                //  API\n                configs.value = {\n                    ...configs.value,\n                    [world]: {\n                        apiurl: '',\n                        key: '',\n                        model: '',\n                        temperature: 1.0,\n                        max_tokens: 2000,\n                    },\n                };\n            }\n            else {\n                //  API\n                configs.value = {\n                    ...configs.value,\n                    [world]: null,\n                };\n            }\n            testResult.value = null;\n        }\n        // \n        async function testConnection() {\n            const config = configs.value[activeTab.value];\n            if (!config) {\n                toastr.warning(' API');\n                return;\n            }\n            // \n            const validation = apiConfigService.validateConfig(config);\n            if (!validation.valid) {\n                testResult.value = {\n                    success: false,\n                    message: validation.errors.join('; '),\n                };\n                return;\n            }\n            testing.value = true;\n            testResult.value = null;\n            try {\n                const result = await apiConfigService.testConnection(activeTab.value);\n                testResult.value = result;\n                if (result.success) {\n                    toastr.success('API ');\n                }\n                else {\n                    toastr.error('API ');\n                }\n            }\n            catch (error) {\n                console.error('[API Config Panel] :', error);\n                testResult.value = {\n                    success: false,\n                    message: `: ${error instanceof Error ? error.message : ''}`,\n                };\n                toastr.error('');\n            }\n            finally {\n                testing.value = false;\n            }\n        }\n        // \n        async function saveConfigs() {\n            try {\n                // \n                for (const world of worlds) {\n                    const config = configs.value[world.key];\n                    if (config) {\n                        const validation = apiConfigService.validateConfig(config);\n                        if (!validation.valid) {\n                            toastr.error(`${world.name} : ${validation.errors.join('; ')}`);\n                            return;\n                        }\n                    }\n                }\n                await apiConfigService.saveConfigs(configs.value);\n                toastr.success('API ');\n            }\n            catch (error) {\n                console.error('[API Config Panel] :', error);\n                toastr.error('');\n            }\n        }\n        // \n        async function resetConfigs() {\n            if (!confirm(' API  API')) {\n                return;\n            }\n            try {\n                await apiConfigService.resetConfigs();\n                configs.value = {\n                    realWorld: null,\n                    innerWorld: null,\n                    sanctuary: null,\n                };\n                testResult.value = null;\n                toastr.success('');\n            }\n            catch (error) {\n                console.error('[API Config Panel] :', error);\n                toastr.error('');\n            }\n        }\n        // \n        function closePanel() {\n            emit('close');\n        }\n        // \n        function selectModel(modelValue) {\n            const currentConfig = configs.value[activeTab.value];\n            if (currentConfig) {\n                // \n                const preset = modelPresets.find(p => p.value === modelValue);\n                // \n                configs.value = {\n                    ...configs.value,\n                    [activeTab.value]: {\n                        ...currentConfig,\n                        model: modelValue,\n                        apiurl: preset?.apiurl || currentConfig.apiurl,\n                    },\n                };\n                testResult.value = null;\n            }\n        }\n        // \n        function toggleDebugMode() {\n            apiAutoSwitchService.toggleDebugMode();\n            debugMode.value = apiAutoSwitchService.isDebugMode();\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _cache[18] || (_cache[18] = _createElementVNode(\"h2\", { class: \"panel-title\" }, \"API \", -1 /* CACHED */)),\n                _cache[19] || (_cache[19] = _createElementVNode(\"p\", { class: \"panel-description\" }, \" API API\", -1 /* CACHED */)),\n                _createCommentVNode(\"  API \"),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _cache[6] || (_cache[6] = _createElementVNode(\"span\", { class: \"info-label\" }, \"\", -1 /* CACHED */)),\n                        _createElementVNode(\"span\", _hoisted_4, _toDisplayString(currentWorldName.value), 1 /* TEXT */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_5, [\n                        _cache[7] || (_cache[7] = _createElementVNode(\"span\", { class: \"info-label\" }, \" API\", -1 /* CACHED */)),\n                        _createElementVNode(\"span\", {\n                            class: _normalizeClass(['info-value', currentAPIStatus.value.isCustom ? 'custom-api' : 'default-api'])\n                        }, _toDisplayString(currentAPIStatus.value.displayText), 3 /* TEXT, CLASS */)\n                    ]),\n                    (currentAPIStatus.value.isCustom && currentAPIStatus.value.model)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [\n                            _cache[8] || (_cache[8] = _createElementVNode(\"span\", { class: \"info-label\" }, \"\", -1 /* CACHED */)),\n                            _createElementVNode(\"span\", _hoisted_7, _toDisplayString(currentAPIStatus.value.model), 1 /* TEXT */)\n                        ]))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_8, [\n                    (_openBlock(), _createElementBlock(_Fragment, null, _renderList(worlds, (world) => {\n                        return _createElementVNode(\"button\", {\n                            key: world.key,\n                            class: _normalizeClass(['tab-button', { active: activeTab.value === world.key }]),\n                            onClick: ($event) => (activeTab.value = world.key)\n                        }, _toDisplayString(world.name), 11 /* TEXT, CLASS, PROPS */, _hoisted_9);\n                    }), 64 /* STABLE_FRAGMENT */))\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_10, [\n                    _createElementVNode(\"div\", _hoisted_11, [\n                        _createElementVNode(\"label\", _hoisted_12, [\n                            _createElementVNode(\"input\", {\n                                type: \"checkbox\",\n                                checked: configs.value[activeTab.value] !== null,\n                                onChange: _cache[0] || (_cache[0] = ($event) => (toggleConfig(activeTab.value, $event)))\n                            }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_13),\n                            _cache[9] || (_cache[9] = _createTextVNode(\"  API API \", -1 /* CACHED */))\n                        ])\n                    ]),\n                    (configs.value[activeTab.value] !== null)\n                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                            _createElementVNode(\"div\", _hoisted_14, [\n                                _cache[10] || (_cache[10] = _createElementVNode(\"label\", { class: \"form-label\" }, \"API \", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((configs.value[activeTab.value].apiurl) = $event)),\n                                    type: \"text\",\n                                    class: \"form-input\",\n                                    placeholder: \"https://api.example.com/v1/chat/completions\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, configs.value[activeTab.value].apiurl]\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_15, [\n                                _cache[11] || (_cache[11] = _createElementVNode(\"label\", { class: \"form-label\" }, \"API \", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => ((configs.value[activeTab.value].key) = $event)),\n                                    type: \"password\",\n                                    class: \"form-input\",\n                                    placeholder: \" SillyTavern \"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, configs.value[activeTab.value].key]\n                                ]),\n                                _cache[12] || (_cache[12] = _createElementVNode(\"span\", { class: \"api-key-hint\" }, \"  SillyTavern  config.yaml \", -1 /* CACHED */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_16, [\n                                _cache[13] || (_cache[13] = _createElementVNode(\"label\", { class: \"form-label\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_17, [\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => ((configs.value[activeTab.value].model) = $event)),\n                                        type: \"text\",\n                                        class: \"form-input\",\n                                        placeholder: \"\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, configs.value[activeTab.value].model]\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_18, [\n                                        (_openBlock(), _createElementBlock(_Fragment, null, _renderList(modelPresets, (preset) => {\n                                            return _createElementVNode(\"button\", {\n                                                key: preset.value,\n                                                type: \"button\",\n                                                class: \"preset-chip\",\n                                                title: preset.description,\n                                                onClick: ($event) => (selectModel(preset.value))\n                                            }, _toDisplayString(preset.label), 9 /* TEXT, PROPS */, _hoisted_19);\n                                        }), 64 /* STABLE_FRAGMENT */))\n                                    ])\n                                ]),\n                                _cache[14] || (_cache[14] = _createElementVNode(\"span\", { class: \"model-hint\" }, \" GeminiGPTClaude \", -1 /* CACHED */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_20, [\n                                _createElementVNode(\"label\", _hoisted_21, \" (\" + _toDisplayString(configs.value[activeTab.value].temperature) + \")\", 1 /* TEXT */),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => ((configs.value[activeTab.value].temperature) = $event)),\n                                    type: \"range\",\n                                    min: \"0\",\n                                    max: \"2\",\n                                    step: \"0.1\",\n                                    class: \"form-range\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [\n                                        _vModelText,\n                                        configs.value[activeTab.value].temperature,\n                                        void 0,\n                                        { number: true }\n                                    ]\n                                ]),\n                                _cache[15] || (_cache[15] = _createElementVNode(\"span\", { class: \"range-hint\" }, \"0=2=\", -1 /* CACHED */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_22, [\n                                _cache[16] || (_cache[16] = _createElementVNode(\"label\", { class: \"form-label\" }, \" Token \", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[5] || (_cache[5] = ($event) => ((configs.value[activeTab.value].max_tokens) = $event)),\n                                    type: \"number\",\n                                    min: \"1\",\n                                    max: \"32000\",\n                                    class: \"form-input\",\n                                    placeholder: \"2000\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [\n                                        _vModelText,\n                                        configs.value[activeTab.value].max_tokens,\n                                        void 0,\n                                        { number: true }\n                                    ]\n                                ])\n                            ]),\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", _hoisted_23, [\n                                _createElementVNode(\"button\", {\n                                    class: \"btn btn-test\",\n                                    disabled: testing.value,\n                                    onClick: testConnection\n                                }, _toDisplayString(testing.value ? '...' : ''), 9 /* TEXT, PROPS */, _hoisted_24)\n                            ]),\n                            _createCommentVNode(\"  \"),\n                            (testResult.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", {\n                                    key: 0,\n                                    class: _normalizeClass(['test-result', testResult.value.success ? 'success' : 'error'])\n                                }, _toDisplayString(testResult.value.message), 3 /* TEXT, CLASS */))\n                                : _createCommentVNode(\"v-if\", true)\n                        ], 64 /* STABLE_FRAGMENT */))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_25, [\n                    _createElementVNode(\"label\", _hoisted_26, [\n                        _createElementVNode(\"input\", {\n                            type: \"checkbox\",\n                            checked: debugMode.value,\n                            onChange: toggleDebugMode\n                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_27),\n                        _cache[17] || (_cache[17] = _createTextVNode(\"  \", -1 /* CACHED */))\n                    ])\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", { class: \"panel-actions\" }, [\n                    _createElementVNode(\"button\", {\n                        class: \"btn btn-primary\",\n                        onClick: saveConfigs\n                    }, \"\"),\n                    _createElementVNode(\"button\", {\n                        class: \"btn btn-secondary\",\n                        onClick: resetConfigs\n                    }, \"\"),\n                    _createElementVNode(\"button\", {\n                        class: \"btn btn-secondary\",\n                        onClick: closePanel\n                    }, \"\")\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./APIConfigPanel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./APIConfigPanel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./APIConfigPanel.vue?vue&type=style&index=0&id=5f7754f2&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-5f7754f2\"]])\n\nexport default __exports__","// GSAP \n\nimport gsap from 'gsap';\n\n/**\n * \n * @param element \n * @param duration \n * @param onComplete \n */\nexport function fadeIn(\n  element: HTMLElement | string,\n  duration: number = 0.5,\n  onComplete?: () => void,\n): gsap.core.Tween {\n  return gsap.fromTo(\n    element,\n    { opacity: 0 },\n    {\n      opacity: 1,\n      duration,\n      ease: 'power2.out',\n      onComplete,\n    },\n  );\n}\n\n/**\n * \n * @param element \n * @param duration \n * @param onComplete \n */\nexport function fadeOut(\n  element: HTMLElement | string,\n  duration: number = 0.5,\n  onComplete?: () => void,\n): gsap.core.Tween {\n  return gsap.to(element, {\n    opacity: 0,\n    duration,\n    ease: 'power2.in',\n    onComplete,\n  });\n}\n\n/**\n * \n * @param element \n * @param onSwitch \n * @param duration /\n */\nexport function crossFade(\n  element: HTMLElement | string,\n  onSwitch: () => void,\n  duration: number = 0.5,\n): gsap.core.Timeline {\n  const tl = gsap.timeline();\n\n  tl.to(element, {\n    opacity: 0,\n    duration,\n    ease: 'power2.in',\n  })\n    .call(onSwitch)\n    .to(element, {\n      opacity: 1,\n      duration,\n      ease: 'power2.out',\n    });\n\n  return tl;\n}\n\n/**\n * \n * @param element \n * @param from \n * @param to \n * @param duration \n * @param decimals \n */\nexport function animateNumber(\n  element: HTMLElement | string,\n  from: number,\n  to: number,\n  duration: number = 1,\n  decimals: number = 0,\n): gsap.core.Tween {\n  const obj = { value: from };\n\n  return gsap.to(obj, {\n    value: to,\n    duration,\n    ease: 'power2.out',\n    onUpdate: () => {\n      const el = typeof element === 'string' ? document.querySelector(element) : element;\n      if (el) {\n        el.textContent = obj.value.toFixed(decimals);\n      }\n    },\n  });\n}\n\n/**\n * \n * @param element \n */\nexport function buttonClickFeedback(element: HTMLElement | string): gsap.core.Timeline {\n  const tl = gsap.timeline();\n\n  tl.to(element, {\n    scale: 0.95,\n    duration: 0.1,\n    ease: 'power2.in',\n  }).to(element, {\n    scale: 1,\n    duration: 0.1,\n    ease: 'power2.out',\n  });\n\n  return tl;\n}\n\n/**\n * \n * @param element \n * @param intensity \n * @param duration \n */\nexport function shake(\n  element: HTMLElement | string,\n  intensity: number = 10,\n  duration: number = 0.5,\n): gsap.core.Timeline {\n  const tl = gsap.timeline();\n\n  const shakeCount = 8;\n  const shakeDuration = duration / shakeCount;\n\n  for (let i = 0; i < shakeCount; i++) {\n    const x = (Math.random() - 0.5) * intensity * 2;\n    const y = (Math.random() - 0.5) * intensity * 2;\n\n    tl.to(element, {\n      x,\n      y,\n      duration: shakeDuration,\n      ease: 'power2.inOut',\n    });\n  }\n\n  tl.to(element, {\n    x: 0,\n    y: 0,\n    duration: shakeDuration,\n    ease: 'power2.out',\n  });\n\n  return tl;\n}\n\n/**\n * \n * @param element \n * @param duration \n */\nexport function popIn(element: HTMLElement | string, duration: number = 0.3): gsap.core.Timeline {\n  const tl = gsap.timeline();\n\n  tl.fromTo(\n    element,\n    {\n      scale: 0,\n      opacity: 0,\n    },\n    {\n      scale: 1,\n      opacity: 1,\n      duration,\n      ease: 'back.out(1.7)',\n    },\n  );\n\n  return tl;\n}\n\n/**\n * \n * @param element \n * @param direction \n * @param distance \n * @param duration \n */\nexport function slideIn(\n  element: HTMLElement | string,\n  direction: 'left' | 'right' | 'top' | 'bottom' = 'bottom',\n  distance: number = 100,\n  duration: number = 0.5,\n): gsap.core.Tween {\n  const fromVars: gsap.TweenVars = { opacity: 0 };\n  const toVars: gsap.TweenVars = { opacity: 1, duration, ease: 'power2.out' };\n\n  switch (direction) {\n    case 'left':\n      fromVars.x = -distance;\n      toVars.x = 0;\n      break;\n    case 'right':\n      fromVars.x = distance;\n      toVars.x = 0;\n      break;\n    case 'top':\n      fromVars.y = -distance;\n      toVars.y = 0;\n      break;\n    case 'bottom':\n      fromVars.y = distance;\n      toVars.y = 0;\n      break;\n  }\n\n  return gsap.fromTo(element, fromVars, toVars);\n}\n\n/**\n * \n * @param element \n * @param color \n * @param duration \n */\nexport function highlightFlash(\n  element: HTMLElement | string,\n  color: string = '#d4af37',\n  duration: number = 0.5,\n): gsap.core.Timeline {\n  const tl = gsap.timeline();\n\n  tl.to(element, {\n    backgroundColor: color,\n    duration: duration / 2,\n    ease: 'power2.out',\n  }).to(element, {\n    backgroundColor: 'transparent',\n    duration: duration / 2,\n    ease: 'power2.in',\n  });\n\n  return tl;\n}\n\n/**\n * \n * @param element \n * @param duration \n */\nexport function damageNumberFloat(element: HTMLElement | string, duration: number = 1.5): gsap.core.Timeline {\n  const tl = gsap.timeline();\n\n  tl.fromTo(\n    element,\n    {\n      y: 0,\n      opacity: 1,\n      scale: 1,\n    },\n    {\n      y: -50,\n      opacity: 0,\n      scale: 1.5,\n      duration,\n      ease: 'power2.out',\n    },\n  );\n\n  return tl;\n}\n\n/**\n * \n * @param element \n * @param text \n * @param speed /\n * @param onComplete \n */\nexport function typewriter(\n  element: HTMLElement | string,\n  text: string,\n  speed: number = 30,\n  onComplete?: () => void,\n): gsap.core.Tween {\n  const el = typeof element === 'string' ? document.querySelector(element) : element;\n  if (!el) {\n    throw new Error('Element not found');\n  }\n\n  const duration = text.length / speed;\n  const obj = { progress: 0 };\n\n  return gsap.to(obj, {\n    progress: text.length,\n    duration,\n    ease: 'none',\n    onUpdate: () => {\n      const currentLength = Math.floor(obj.progress);\n      el.textContent = text.substring(0, currentLength);\n    },\n    onComplete,\n  });\n}\n\n/**\n * \n * @param element \n * @param scale \n * @param duration \n */\nexport function pulse(element: HTMLElement | string, scale: number = 1.1, duration: number = 0.8): gsap.core.Timeline {\n  const tl = gsap.timeline({ repeat: -1, yoyo: true });\n\n  tl.to(element, {\n    scale,\n    duration,\n    ease: 'power2.inOut',\n  });\n\n  return tl;\n}\n\n/**\n *  will-change \n * @param element \n * @param properties CSS \n */\nexport function optimizeForAnimation(\n  element: HTMLElement | string,\n  properties: string[] = ['transform', 'opacity'],\n): void {\n  const el = typeof element === 'string' ? document.querySelector(element) : element;\n  if (el instanceof HTMLElement) {\n    el.style.willChange = properties.join(', ');\n  }\n}\n\n/**\n *  will-change \n * @param element \n */\nexport function clearAnimationOptimization(element: HTMLElement | string): void {\n  const el = typeof element === 'string' ? document.querySelector(element) : element;\n  if (el instanceof HTMLElement) {\n    el.style.willChange = 'auto';\n  }\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = [\"src\"];\nimport gsap from 'gsap';\nimport { onBeforeUnmount, onMounted, ref, watch } from 'vue';\nimport { useGameStore } from '../stores/gameStore';\nimport { clearAnimationOptimization, optimizeForAnimation } from '../utils/animation';\n// ==================== Store ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Background',\n    setup(__props) {\n        const gameStore = useGameStore();\n        // ====================  ====================\n        const backgroundRef = ref(null);\n        const currentBackground = ref('');\n        const preloadedImages = new Map();\n        // ====================  ====================\n        /**\n         * \n         * @param url  URL\n         * @returns Promise<HTMLImageElement>\n         */\n        function preloadImage(url) {\n            // \n            if (preloadedImages.has(url)) {\n                return Promise.resolve(preloadedImages.get(url));\n            }\n            return new Promise((resolve, reject) => {\n                const img = new Image();\n                img.onload = () => {\n                    preloadedImages.set(url, img);\n                    console.log('[Background] :', url);\n                    resolve(img);\n                };\n                img.onerror = () => {\n                    console.error('[Background] :', url);\n                    reject(new Error(`Failed to preload image: ${url}`));\n                };\n                img.src = url;\n            });\n        }\n        // ====================  ====================\n        onMounted(() => {\n            // \n            if (gameStore.currentScene.background) {\n                currentBackground.value = gameStore.currentScene.background;\n            }\n            // \n            if (backgroundRef.value) {\n                optimizeForAnimation(backgroundRef.value, ['opacity']);\n            }\n        });\n        // ====================  ====================\n        watch(() => gameStore.currentScene.background, async (newBackground, oldBackground) => {\n            if (newBackground === oldBackground)\n                return;\n            // \n            if (!newBackground) {\n                currentBackground.value = '';\n                return;\n            }\n            // \n            try {\n                await preloadImage(newBackground);\n            }\n            catch (error) {\n                console.error('[Background] :', error);\n            }\n            // \n            if (!oldBackground || !currentBackground.value) {\n                currentBackground.value = newBackground;\n                return;\n            }\n            //  GSAP \n            if (backgroundRef.value) {\n                gsap.to(backgroundRef.value, {\n                    opacity: 0,\n                    duration: 0.5,\n                    ease: 'power2.in',\n                    onComplete: () => {\n                        // \n                        currentBackground.value = newBackground;\n                        // \n                        gsap.to(backgroundRef.value, {\n                            opacity: 1,\n                            duration: 0.5,\n                            ease: 'power2.out',\n                        });\n                    },\n                });\n            }\n        });\n        // ====================  ====================\n        onBeforeUnmount(() => {\n            if (backgroundRef.value) {\n                clearAnimationOptimization(backgroundRef.value);\n            }\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                ref_key: \"backgroundRef\",\n                ref: backgroundRef,\n                class: \"background-layer\"\n            }, [\n                (currentBackground.value)\n                    ? (_openBlock(), _createElementBlock(\"img\", {\n                        key: 0,\n                        src: currentBackground.value,\n                        alt: \"\",\n                        class: \"background-image\"\n                    }, null, 8 /* PROPS */, _hoisted_1))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 512 /* NEED_PATCH */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Background.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Background.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./Background.vue?vue&type=style&index=0&id=8e8ada04&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-8e8ada04\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, vModelSelect as _vModelSelect, createTextVNode as _createTextVNode, normalizeClass as _normalizeClass, withKeys as _withKeys } from \"vue\";\nconst _hoisted_1 = { class: \"character-creator\" };\nconst _hoisted_2 = { class: \"creator-header\" };\nconst _hoisted_3 = { class: \"creator-title\" };\nconst _hoisted_4 = { class: \"creator-subtitle\" };\nconst _hoisted_5 = { class: \"creator-content\" };\nconst _hoisted_6 = { class: \"section\" };\nconst _hoisted_7 = { class: \"form-grid\" };\nconst _hoisted_8 = { class: \"form-group\" };\nconst _hoisted_9 = { class: \"form-group\" };\nconst _hoisted_10 = { class: \"form-group\" };\nconst _hoisted_11 = [\"value\"];\nconst _hoisted_12 = {\n    key: 0,\n    class: \"form-group\"\n};\nconst _hoisted_13 = { class: \"form-group\" };\nconst _hoisted_14 = { class: \"section\" };\nconst _hoisted_15 = { class: \"attributes-grid\" };\nconst _hoisted_16 = { class: \"attribute-label\" };\nconst _hoisted_17 = [\"onUpdate:modelValue\"];\nconst _hoisted_18 = { class: \"section\" };\nconst _hoisted_19 = { class: \"derived-stats\" };\nconst _hoisted_20 = { class: \"stat-item\" };\nconst _hoisted_21 = { class: \"stat-value\" };\nconst _hoisted_22 = { class: \"stat-item\" };\nconst _hoisted_23 = { class: \"stat-value\" };\nconst _hoisted_24 = { class: \"stat-item\" };\nconst _hoisted_25 = { class: \"stat-value\" };\nconst _hoisted_26 = { class: \"stat-item\" };\nconst _hoisted_27 = { class: \"stat-value\" };\nconst _hoisted_28 = { class: \"stat-item\" };\nconst _hoisted_29 = { class: \"stat-value\" };\nconst _hoisted_30 = { class: \"stat-item\" };\nconst _hoisted_31 = { class: \"stat-value\" };\nconst _hoisted_32 = {\n    key: 0,\n    class: \"section\"\n};\nconst _hoisted_33 = { class: \"skills-info\" };\nconst _hoisted_34 = { class: \"info-text\" };\nconst _hoisted_35 = { class: \"info-text\" };\nconst _hoisted_36 = { class: \"skills-grid\" };\nconst _hoisted_37 = { class: \"skill-label\" };\nconst _hoisted_38 = [\"onUpdate:modelValue\"];\nconst _hoisted_39 = [\"onUpdate:modelValue\"];\nconst _hoisted_40 = [\"onClick\"];\nconst _hoisted_41 = { class: \"add-skill\" };\nconst _hoisted_42 = { class: \"creator-actions\" };\nconst _hoisted_43 = [\"disabled\"];\nimport { computed, reactive, ref } from 'vue';\nimport { mvuService } from '../services/mvuService';\nimport { tavernService } from '../services/tavernService';\nimport { useCharacterStore } from '../stores/characterStore';\nimport { calculateDerivedStats, generateRandomAttributes } from '../utils/coc7Rules';\n\nimport { onMounted } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'CharacterCreator',\n    props: {\n        syncToTavern: { type: Boolean, default: true },\n        characterType: { default: 'player' },\n        showSkills: { type: Boolean, default: true },\n        editingCharacter: { default: undefined }\n    },\n    emits: [\"created\"],\n    setup(__props, { emit: __emit }) {\n        const props = __props;\n        // ==================== Emits ====================\n        const emit = __emit;\n        // ==================== Store ====================\n        const characterStore = useCharacterStore();\n        // ====================  ====================\n        const formData = reactive({\n            name: '',\n            age: undefined,\n            occupation: '',\n            background: '',\n            attributes: {\n                STR: 50,\n                CON: 50,\n                SIZ: 50,\n                DEX: 50,\n                APP: 50,\n                INT: 50,\n                POW: 50,\n                EDU: 50,\n                LUK: 50,\n            },\n        });\n        const selectedSkills = ref([]);\n        const newSkillName = ref('');\n        const selectedOccupation = ref('');\n        const customOccupation = ref('');\n        // \n        const occupations = [\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n        ];\n        // ====================  ====================\n        const derivedStats = computed(() => {\n            return calculateDerivedStats(formData.attributes);\n        });\n        const isValid = computed(() => {\n            const hasName = formData.name.trim().length > 0;\n            const hasValidOccupation = selectedOccupation.value !== '' || customOccupation.value.trim().length > 0;\n            return hasName && hasValidOccupation && skillPointsValid.value;\n        });\n        //  = EDU  4\n        const occupationalPoints = computed(() => {\n            return formData.attributes.EDU * 4;\n        });\n        //  = INT  2\n        const interestPoints = computed(() => {\n            return formData.attributes.INT * 2;\n        });\n        // \n        const usedOccupationalPoints = computed(() => {\n            return selectedSkills.value\n                .filter(skill => skill.pointType === 'occupational')\n                .reduce((sum, skill) => sum + skill.value, 0);\n        });\n        // \n        const usedInterestPoints = computed(() => {\n            return selectedSkills.value\n                .filter(skill => skill.pointType === 'interest')\n                .reduce((sum, skill) => sum + skill.value, 0);\n        });\n        // \n        const remainingOccupationalPoints = computed(() => {\n            return occupationalPoints.value - usedOccupationalPoints.value;\n        });\n        // \n        const remainingInterestPoints = computed(() => {\n            return interestPoints.value - usedInterestPoints.value;\n        });\n        // \n        const skillPointsValid = computed(() => {\n            return remainingOccupationalPoints.value >= 0 && remainingInterestPoints.value >= 0;\n        });\n        // ====================  ====================\n        /**\n         * \n         */\n        function getAttributeName(key) {\n            const names = {\n                STR: '',\n                CON: '',\n                SIZ: '',\n                DEX: '',\n                APP: '',\n                INT: '',\n                POW: '',\n                EDU: '',\n                LUK: '',\n            };\n            return names[key] || key;\n        }\n        /**\n         * \n         */\n        function randomizeAttributes() {\n            const randomAttrs = generateRandomAttributes('3d6x5');\n            Object.assign(formData.attributes, randomAttrs);\n            calculateDerived();\n            toastr.success('');\n        }\n        /**\n         * \n         */\n        function calculateDerived() {\n            //  computed \n        }\n        /**\n         * \n         */\n        function handleOccupationChange() {\n            if (selectedOccupation.value === '') {\n                formData.occupation = '';\n            }\n            else {\n                formData.occupation = selectedOccupation.value;\n                customOccupation.value = '';\n            }\n        }\n        /**\n         * \n         */\n        function addSkill() {\n            const skillName = newSkillName.value.trim();\n            if (!skillName) {\n                toastr.warning('');\n                return;\n            }\n            if (selectedSkills.value.some(s => s.name === skillName)) {\n                toastr.warning('');\n                return;\n            }\n            selectedSkills.value.push({ name: skillName, value: 20, pointType: 'occupational' });\n            newSkillName.value = '';\n        }\n        /**\n         * \n         */\n        function removeSkill(skillName) {\n            selectedSkills.value = selectedSkills.value.filter(s => s.name !== skillName);\n        }\n        /**\n         * \n         */\n        async function create() {\n            if (!isValid.value) {\n                if (!skillPointsValid.value) {\n                    toastr.error('');\n                }\n                else if (selectedOccupation.value === '' && !customOccupation.value.trim()) {\n                    toastr.error('');\n                }\n                else {\n                    toastr.error('');\n                }\n                return;\n            }\n            try {\n                // \"\"\n                if (selectedOccupation.value === '') {\n                    formData.occupation = customOccupation.value.trim();\n                }\n                // IDID\n                const characterId = props.editingCharacter?.id || `char_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n                //  Map\n                const skillsMap = new Map();\n                selectedSkills.value.forEach(skill => {\n                    skillsMap.set(skill.name, skill.value);\n                });\n                // \n                const bodyParts = initializeBodyParts();\n                // \n                const baseCharacter = {\n                    id: characterId,\n                    name: formData.name,\n                    age: formData.age,\n                    occupation: formData.occupation || undefined,\n                    background: formData.background || undefined,\n                    attributes: { ...formData.attributes },\n                    derivedStats: { ...derivedStats.value },\n                    skills: skillsMap,\n                    bodyParts,\n                    inventory: [],\n                };\n                let character;\n                if (props.characterType === 'player') {\n                    character = {\n                        ...baseCharacter,\n                        type: 'player',\n                    };\n                }\n                else {\n                    character = {\n                        ...baseCharacter,\n                        type: 'npc',\n                        affection: 50,\n                        isImportant: false,\n                        events: [],\n                    };\n                }\n                //  MVU\n                await mvuService.saveCharacter(character);\n                // \n                if (props.syncToTavern && props.characterType === 'player') {\n                    await tavernService.updateUserCharacter(character);\n                }\n                //  store\n                if (props.characterType === 'player') {\n                    await characterStore.setPlayer(character);\n                    // \n                    if (!props.editingCharacter) {\n                        try {\n                            const { realWorldMapService } = await import('../services/realWorldMapService');\n                            const hasMap = await realWorldMapService.hasMap();\n                            if (!hasMap) {\n                                console.log('[CharacterCreator] ...');\n                                await realWorldMapService.generateMap(character);\n                            }\n                        }\n                        catch (error) {\n                            console.error('[CharacterCreator] :', error);\n                            // \n                            toastr.warning('');\n                        }\n                    }\n                }\n                else {\n                    await characterStore.addNPC(character);\n                }\n                toastr.success(` ${character.name} `);\n                // \n                emit('created', character);\n                // \n                if (props.characterType === 'player') {\n                    console.log('[CharacterCreator]  character_created ');\n                    eventEmit('character_created');\n                }\n            }\n            catch (error) {\n                console.error('[CharacterCreator] :', error);\n                toastr.error('');\n            }\n        }\n        // ====================  ====================\n        onMounted(() => {\n            // \n            if (props.editingCharacter) {\n                formData.name = props.editingCharacter.name;\n                formData.age = props.editingCharacter.age;\n                formData.occupation = props.editingCharacter.occupation || '';\n                formData.background = props.editingCharacter.background || '';\n                Object.assign(formData.attributes, props.editingCharacter.attributes);\n                // \n                const occupation = props.editingCharacter.occupation || '';\n                if (occupations.includes(occupation)) {\n                    selectedOccupation.value = occupation;\n                }\n                else if (occupation) {\n                    selectedOccupation.value = '';\n                    customOccupation.value = occupation;\n                }\n                // \n                const skillsArray = Array.from(props.editingCharacter.skills.entries());\n                selectedSkills.value = skillsArray.map((entry) => ({\n                    name: entry[0],\n                    value: entry[1],\n                    pointType: 'occupational', // \n                }));\n            }\n        });\n        /**\n         * \n         */\n        function initializeBodyParts() {\n            return [\n                {\n                    id: 'head',\n                    name: '',\n                    damage: 0,\n                    debuffs: [],\n                    children: [\n                        { id: 'eyes', name: '', parent: 'head', damage: 0, debuffs: [] },\n                        { id: 'mouth', name: '', parent: 'head', damage: 0, debuffs: [] },\n                        { id: 'nose', name: '', parent: 'head', damage: 0, debuffs: [] },\n                        { id: 'ears', name: '', parent: 'head', damage: 0, debuffs: [] },\n                    ],\n                },\n                {\n                    id: 'torso',\n                    name: '',\n                    damage: 0,\n                    debuffs: [],\n                    children: [\n                        { id: 'chest', name: '', parent: 'torso', damage: 0, debuffs: [] },\n                        { id: 'abdomen', name: '', parent: 'torso', damage: 0, debuffs: [] },\n                        { id: 'back', name: '', parent: 'torso', damage: 0, debuffs: [] },\n                    ],\n                },\n                {\n                    id: 'limbs',\n                    name: '',\n                    damage: 0,\n                    debuffs: [],\n                    children: [\n                        { id: 'left_arm', name: '', parent: 'limbs', damage: 0, debuffs: [] },\n                        { id: 'right_arm', name: '', parent: 'limbs', damage: 0, debuffs: [] },\n                        { id: 'left_leg', name: '', parent: 'limbs', damage: 0, debuffs: [] },\n                        { id: 'right_leg', name: '', parent: 'limbs', damage: 0, debuffs: [] },\n                    ],\n                },\n            ];\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"h2\", _hoisted_3, _toDisplayString(__props.editingCharacter ? '' : ''), 1 /* TEXT */),\n                    _createElementVNode(\"p\", _hoisted_4, \" COC7 \" + _toDisplayString(__props.editingCharacter ? '' : '') + \"\", 1 /* TEXT */)\n                ]),\n                _createElementVNode(\"div\", _hoisted_5, [\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"section\", _hoisted_6, [\n                        _cache[12] || (_cache[12] = _createElementVNode(\"h3\", { class: \"section-title\" }, \"\", -1 /* CACHED */)),\n                        _createElementVNode(\"div\", _hoisted_7, [\n                            _createElementVNode(\"div\", _hoisted_8, [\n                                _cache[6] || (_cache[6] = _createElementVNode(\"label\", { class: \"form-label\" }, \" *\", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((formData.name) = $event)),\n                                    type: \"text\",\n                                    class: \"form-input\",\n                                    placeholder: \"\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, formData.name]\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_9, [\n                                _cache[7] || (_cache[7] = _createElementVNode(\"label\", { class: \"form-label\" }, \"\", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((formData.age) = $event)),\n                                    type: \"number\",\n                                    class: \"form-input\",\n                                    placeholder: \"\",\n                                    min: \"15\",\n                                    max: \"90\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [\n                                        _vModelText,\n                                        formData.age,\n                                        void 0,\n                                        { number: true }\n                                    ]\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_10, [\n                                _cache[9] || (_cache[9] = _createElementVNode(\"label\", { class: \"form-label\" }, \"\", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"select\", {\n                                    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => ((selectedOccupation).value = $event)),\n                                    class: \"form-select\",\n                                    onChange: handleOccupationChange\n                                }, [\n                                    _cache[8] || (_cache[8] = _createElementVNode(\"option\", { value: \"\" }, \"\", -1 /* CACHED */)),\n                                    (_openBlock(), _createElementBlock(_Fragment, null, _renderList(occupations, (occupation) => {\n                                        return _createElementVNode(\"option\", {\n                                            key: occupation,\n                                            value: occupation\n                                        }, _toDisplayString(occupation), 9 /* TEXT, PROPS */, _hoisted_11);\n                                    }), 64 /* STABLE_FRAGMENT */))\n                                ], 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                    [_vModelSelect, selectedOccupation.value]\n                                ])\n                            ]),\n                            (selectedOccupation.value === '')\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_12, [\n                                    _cache[10] || (_cache[10] = _createElementVNode(\"label\", { class: \"form-label\" }, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => ((customOccupation).value = $event)),\n                                        type: \"text\",\n                                        class: \"form-input\",\n                                        placeholder: \"\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, customOccupation.value]\n                                    ])\n                                ]))\n                                : _createCommentVNode(\"v-if\", true)\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_13, [\n                            _cache[11] || (_cache[11] = _createElementVNode(\"label\", { class: \"form-label\" }, \"\", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"textarea\", {\n                                \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => ((formData.background) = $event)),\n                                class: \"form-textarea\",\n                                placeholder: \"...\",\n                                rows: \"3\"\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vModelText, formData.background]\n                            ])\n                        ])\n                    ]),\n                    _createCommentVNode(\" COC7  \"),\n                    _createElementVNode(\"section\", _hoisted_14, [\n                        _createElementVNode(\"div\", { class: \"section-header\" }, [\n                            _cache[14] || (_cache[14] = _createElementVNode(\"h3\", { class: \"section-title\" }, \"COC7 \", -1 /* CACHED */)),\n                            _createElementVNode(\"button\", {\n                                class: \"btn-secondary\",\n                                onClick: randomizeAttributes\n                            }, [...(_cache[13] || (_cache[13] = [\n                                    _createElementVNode(\"span\", { class: \"btn-icon\" }, \"\", -1 /* CACHED */),\n                                    _createTextVNode(\"  \", -1 /* CACHED */)\n                                ]))])\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_15, [\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(formData.attributes, (_, key) => {\n                                return (_openBlock(), _createElementBlock(\"div\", {\n                                    key: key,\n                                    class: \"attribute-item\"\n                                }, [\n                                    _createElementVNode(\"label\", _hoisted_16, _toDisplayString(getAttributeName(key)), 1 /* TEXT */),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": ($event) => ((formData.attributes[key]) = $event),\n                                        type: \"number\",\n                                        class: \"attribute-input\",\n                                        min: \"0\",\n                                        max: \"100\",\n                                        onInput: calculateDerived\n                                    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_17), [\n                                        [\n                                            _vModelText,\n                                            formData.attributes[key],\n                                            void 0,\n                                            { number: true }\n                                        ]\n                                    ])\n                                ]));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ])\n                    ]),\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"section\", _hoisted_18, [\n                        _cache[21] || (_cache[21] = _createElementVNode(\"h3\", { class: \"section-title\" }, \"\", -1 /* CACHED */)),\n                        _createElementVNode(\"div\", _hoisted_19, [\n                            _createElementVNode(\"div\", _hoisted_20, [\n                                _cache[15] || (_cache[15] = _createElementVNode(\"span\", { class: \"stat-label\" }, \" (HP)\", -1 /* CACHED */)),\n                                _createElementVNode(\"span\", _hoisted_21, _toDisplayString(derivedStats.value.HP) + \" / \" + _toDisplayString(derivedStats.value.maxHP), 1 /* TEXT */)\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_22, [\n                                _cache[16] || (_cache[16] = _createElementVNode(\"span\", { class: \"stat-label\" }, \" (MP)\", -1 /* CACHED */)),\n                                _createElementVNode(\"span\", _hoisted_23, _toDisplayString(derivedStats.value.MP) + \" / \" + _toDisplayString(derivedStats.value.maxMP), 1 /* TEXT */)\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_24, [\n                                _cache[17] || (_cache[17] = _createElementVNode(\"span\", { class: \"stat-label\" }, \" (SAN)\", -1 /* CACHED */)),\n                                _createElementVNode(\"span\", _hoisted_25, _toDisplayString(derivedStats.value.SAN) + \" / \" + _toDisplayString(derivedStats.value.maxSAN), 1 /* TEXT */)\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_26, [\n                                _cache[18] || (_cache[18] = _createElementVNode(\"span\", { class: \"stat-label\" }, \" (MOV)\", -1 /* CACHED */)),\n                                _createElementVNode(\"span\", _hoisted_27, _toDisplayString(derivedStats.value.MOV), 1 /* TEXT */)\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_28, [\n                                _cache[19] || (_cache[19] = _createElementVNode(\"span\", { class: \"stat-label\" }, \" (DB)\", -1 /* CACHED */)),\n                                _createElementVNode(\"span\", _hoisted_29, _toDisplayString(derivedStats.value.DB), 1 /* TEXT */)\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_30, [\n                                _cache[20] || (_cache[20] = _createElementVNode(\"span\", { class: \"stat-label\" }, \" (BUILD)\", -1 /* CACHED */)),\n                                _createElementVNode(\"span\", _hoisted_31, _toDisplayString(derivedStats.value.BUILD), 1 /* TEXT */)\n                            ])\n                        ])\n                    ]),\n                    _createCommentVNode(\"  \"),\n                    (__props.showSkills)\n                        ? (_openBlock(), _createElementBlock(\"section\", _hoisted_32, [\n                            _cache[25] || (_cache[25] = _createElementVNode(\"h3\", { class: \"section-title\" }, \"\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_33, [\n                                _createElementVNode(\"p\", _hoisted_34, [\n                                    _cache[22] || (_cache[22] = _createTextVNode(\" : \", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", {\n                                        class: _normalizeClass([\"points-value\", { 'points-negative': remainingOccupationalPoints.value < 0 }])\n                                    }, _toDisplayString(remainingOccupationalPoints.value) + \" / \" + _toDisplayString(occupationalPoints.value), 3 /* TEXT, CLASS */)\n                                ]),\n                                _createElementVNode(\"p\", _hoisted_35, [\n                                    _cache[23] || (_cache[23] = _createTextVNode(\" : \", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", {\n                                        class: _normalizeClass([\"points-value\", { 'points-negative': remainingInterestPoints.value < 0 }])\n                                    }, _toDisplayString(remainingInterestPoints.value) + \" / \" + _toDisplayString(interestPoints.value), 3 /* TEXT, CLASS */)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_36, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(selectedSkills.value, (skill) => {\n                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                        key: skill.name,\n                                        class: \"skill-item\"\n                                    }, [\n                                        _createElementVNode(\"label\", _hoisted_37, _toDisplayString(skill.name), 1 /* TEXT */),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": ($event) => ((skill.value) = $event),\n                                            type: \"number\",\n                                            class: \"skill-input\",\n                                            min: \"0\",\n                                            max: \"100\"\n                                        }, null, 8 /* PROPS */, _hoisted_38), [\n                                            [\n                                                _vModelText,\n                                                skill.value,\n                                                void 0,\n                                                { number: true }\n                                            ]\n                                        ]),\n                                        _withDirectives(_createElementVNode(\"select\", {\n                                            \"onUpdate:modelValue\": ($event) => ((skill.pointType) = $event),\n                                            class: \"skill-type-select\"\n                                        }, [...(_cache[24] || (_cache[24] = [\n                                                _createElementVNode(\"option\", { value: \"occupational\" }, \"\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: \"interest\" }, \"\", -1 /* CACHED */)\n                                            ]))], 8 /* PROPS */, _hoisted_39), [\n                                            [_vModelSelect, skill.pointType]\n                                        ]),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn-remove\",\n                                            onClick: ($event) => (removeSkill(skill.name))\n                                        }, \"\", 8 /* PROPS */, _hoisted_40)\n                                    ]));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_41, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[5] || (_cache[5] = ($event) => ((newSkillName).value = $event)),\n                                    type: \"text\",\n                                    class: \"form-input\",\n                                    placeholder: \"\",\n                                    onKeyup: _withKeys(addSkill, [\"enter\"])\n                                }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                    [_vModelText, newSkillName.value]\n                                ]),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn-secondary\",\n                                    onClick: addSkill\n                                }, \"\")\n                            ])\n                        ]))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_42, [\n                    _createElementVNode(\"button\", {\n                        class: \"btn-primary\",\n                        disabled: !isValid.value,\n                        onClick: create\n                    }, _toDisplayString(__props.editingCharacter ? '' : __props.syncToTavern ? '' : ''), 9 /* TEXT, PROPS */, _hoisted_43)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./CharacterCreator.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./CharacterCreator.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./CharacterCreator.vue?vue&type=style&index=0&id=6ec1bc54&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6ec1bc54\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, unref as _unref, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = { class: \"character-panel\" };\nconst _hoisted_2 = { class: \"panel-content\" };\nconst _hoisted_3 = { class: \"character-detail\" };\nconst _hoisted_4 = {\n    key: 0,\n    class: \"detail-content\"\n};\nconst _hoisted_5 = { class: \"detail-section\" };\nconst _hoisted_6 = { class: \"detail-header\" };\nconst _hoisted_7 = { class: \"detail-title\" };\nconst _hoisted_8 = { class: \"basic-info\" };\nconst _hoisted_9 = { class: \"info-item\" };\nconst _hoisted_10 = { class: \"info-value\" };\nconst _hoisted_11 = { class: \"info-item\" };\nconst _hoisted_12 = { class: \"info-value\" };\nconst _hoisted_13 = { class: \"background-text\" };\nconst _hoisted_14 = { class: \"background-content\" };\nconst _hoisted_15 = { class: \"detail-section\" };\nconst _hoisted_16 = { class: \"attributes-grid\" };\nconst _hoisted_17 = { class: \"attribute-label\" };\nconst _hoisted_18 = { class: \"attribute-value\" };\nconst _hoisted_19 = { class: \"detail-section\" };\nconst _hoisted_20 = { class: \"derived-grid\" };\nconst _hoisted_21 = { class: \"derived-item\" };\nconst _hoisted_22 = { class: \"derived-value\" };\nconst _hoisted_23 = { class: \"derived-item\" };\nconst _hoisted_24 = { class: \"derived-value\" };\nconst _hoisted_25 = { class: \"derived-item\" };\nconst _hoisted_26 = { class: \"derived-value\" };\nconst _hoisted_27 = { class: \"derived-item\" };\nconst _hoisted_28 = { class: \"derived-value\" };\nconst _hoisted_29 = { class: \"derived-item\" };\nconst _hoisted_30 = { class: \"derived-value\" };\nconst _hoisted_31 = { class: \"derived-item\" };\nconst _hoisted_32 = { class: \"derived-value\" };\nconst _hoisted_33 = { class: \"detail-section\" };\nconst _hoisted_34 = { class: \"body-parts\" };\nconst _hoisted_35 = [\"onClick\"];\nconst _hoisted_36 = { class: \"expand-icon\" };\nconst _hoisted_37 = { class: \"part-name\" };\nconst _hoisted_38 = {\n    key: 0,\n    class: \"body-part-children\"\n};\nconst _hoisted_39 = { class: \"child-name\" };\nconst _hoisted_40 = {\n    key: 0,\n    class: \"debuffs\"\n};\nconst _hoisted_41 = {\n    key: 1,\n    class: \"part-debuffs\"\n};\nconst _hoisted_42 = {\n    key: 1,\n    class: \"empty-detail\"\n};\nimport { ref } from 'vue';\nimport { useCharacterStore } from '../stores/characterStore';\n// ==================== Emits ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'CharacterPanel',\n    emits: [\"close\", \"edit\"],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        // ==================== Store ====================\n        const characterStore = useCharacterStore();\n        // ====================  ====================\n        const expandedParts = ref(new Set());\n        // ====================  ====================\n        /**\n         * \n         */\n        function editCharacter() {\n            if (!characterStore.player)\n                return;\n            emit('edit', characterStore.player);\n        }\n        /**\n         * \n         */\n        function close() {\n            emit('close');\n        }\n        /**\n         * \n         */\n        function getAttributeName(key) {\n            const names = {\n                STR: '',\n                CON: '',\n                SIZ: '',\n                DEX: '',\n                APP: '',\n                INT: '',\n                POW: '',\n                EDU: '',\n                LUK: '',\n            };\n            return names[key] || key;\n        }\n        /**\n         * \n         */\n        function toggleBodyPart(partId) {\n            if (expandedParts.value.has(partId)) {\n                expandedParts.value.delete(partId);\n            }\n            else {\n                expandedParts.value.add(partId);\n            }\n        }\n        /**\n         * \n         */\n        function getDamageClass(damage) {\n            if (damage === 0)\n                return 'damage-none';\n            if (damage < 25)\n                return 'damage-light';\n            if (damage < 50)\n                return 'damage-moderate';\n            if (damage < 75)\n                return 'damage-heavy';\n            return 'damage-critical';\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", { class: \"panel-header\" }, [\n                    _cache[0] || (_cache[0] = _createElementVNode(\"h2\", { class: \"panel-title\" }, \"\", -1 /* CACHED */)),\n                    _createElementVNode(\"button\", {\n                        class: \"btn-close\",\n                        onClick: close\n                    }, \"\")\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        (_unref(characterStore).player)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"section\", _hoisted_5, [\n                                    _createElementVNode(\"div\", _hoisted_6, [\n                                        _createElementVNode(\"h3\", _hoisted_7, _toDisplayString(_unref(characterStore).player.name), 1 /* TEXT */),\n                                        _createElementVNode(\"div\", { class: \"detail-actions\" }, [\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn-edit\",\n                                                onClick: editCharacter\n                                            }, \" \")\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_8, [\n                                        _createElementVNode(\"div\", _hoisted_9, [\n                                            _cache[1] || (_cache[1] = _createElementVNode(\"span\", { class: \"info-label\" }, \":\", -1 /* CACHED */)),\n                                            _createElementVNode(\"span\", _hoisted_10, _toDisplayString(_unref(characterStore).player.age || '-'), 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_11, [\n                                            _cache[2] || (_cache[2] = _createElementVNode(\"span\", { class: \"info-label\" }, \":\", -1 /* CACHED */)),\n                                            _createElementVNode(\"span\", _hoisted_12, _toDisplayString(_unref(characterStore).player.occupation || '-'), 1 /* TEXT */)\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_13, [\n                                        _cache[3] || (_cache[3] = _createElementVNode(\"p\", { class: \"info-label\" }, \":\", -1 /* CACHED */)),\n                                        _createElementVNode(\"p\", _hoisted_14, _toDisplayString(_unref(characterStore).player.background || ''), 1 /* TEXT */)\n                                    ])\n                                ]),\n                                _createCommentVNode(\" COC7  \"),\n                                _createElementVNode(\"section\", _hoisted_15, [\n                                    _cache[4] || (_cache[4] = _createElementVNode(\"h4\", { class: \"subsection-title\" }, \"COC7 \", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_16, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(characterStore).player.attributes, (value, key) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: key,\n                                                class: \"attribute-item\"\n                                            }, [\n                                                _createElementVNode(\"span\", _hoisted_17, _toDisplayString(getAttributeName(key)), 1 /* TEXT */),\n                                                _createElementVNode(\"span\", _hoisted_18, _toDisplayString(value), 1 /* TEXT */)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]),\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"section\", _hoisted_19, [\n                                    _cache[11] || (_cache[11] = _createElementVNode(\"h4\", { class: \"subsection-title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_20, [\n                                        _createElementVNode(\"div\", _hoisted_21, [\n                                            _cache[5] || (_cache[5] = _createElementVNode(\"span\", { class: \"derived-label\" }, \" (HP)\", -1 /* CACHED */)),\n                                            _createElementVNode(\"span\", _hoisted_22, _toDisplayString(_unref(characterStore).player.derivedStats.HP) + \" / \" + _toDisplayString(_unref(characterStore).player.derivedStats.maxHP), 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_23, [\n                                            _cache[6] || (_cache[6] = _createElementVNode(\"span\", { class: \"derived-label\" }, \" (MP)\", -1 /* CACHED */)),\n                                            _createElementVNode(\"span\", _hoisted_24, _toDisplayString(_unref(characterStore).player.derivedStats.MP) + \" / \" + _toDisplayString(_unref(characterStore).player.derivedStats.maxMP), 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_25, [\n                                            _cache[7] || (_cache[7] = _createElementVNode(\"span\", { class: \"derived-label\" }, \" (SAN)\", -1 /* CACHED */)),\n                                            _createElementVNode(\"span\", _hoisted_26, _toDisplayString(_unref(characterStore).player.derivedStats.SAN) + \" / \" + _toDisplayString(_unref(characterStore).player.derivedStats.maxSAN), 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_27, [\n                                            _cache[8] || (_cache[8] = _createElementVNode(\"span\", { class: \"derived-label\" }, \" (MOV)\", -1 /* CACHED */)),\n                                            _createElementVNode(\"span\", _hoisted_28, _toDisplayString(_unref(characterStore).player.derivedStats.MOV), 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_29, [\n                                            _cache[9] || (_cache[9] = _createElementVNode(\"span\", { class: \"derived-label\" }, \" (DB)\", -1 /* CACHED */)),\n                                            _createElementVNode(\"span\", _hoisted_30, _toDisplayString(_unref(characterStore).player.derivedStats.DB), 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_31, [\n                                            _cache[10] || (_cache[10] = _createElementVNode(\"span\", { class: \"derived-label\" }, \" (BUILD)\", -1 /* CACHED */)),\n                                            _createElementVNode(\"span\", _hoisted_32, _toDisplayString(_unref(characterStore).player.derivedStats.BUILD), 1 /* TEXT */)\n                                        ])\n                                    ])\n                                ]),\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"section\", _hoisted_33, [\n                                    _cache[12] || (_cache[12] = _createElementVNode(\"h4\", { class: \"subsection-title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_34, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(characterStore).player.bodyParts, (part) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: part.id,\n                                                class: \"body-part-group\"\n                                            }, [\n                                                _createElementVNode(\"div\", {\n                                                    class: \"body-part-header\",\n                                                    onClick: ($event) => (toggleBodyPart(part.id))\n                                                }, [\n                                                    _createElementVNode(\"span\", _hoisted_36, _toDisplayString(expandedParts.value.has(part.id) ? '' : ''), 1 /* TEXT */),\n                                                    _createElementVNode(\"span\", _hoisted_37, _toDisplayString(part.name), 1 /* TEXT */),\n                                                    _createElementVNode(\"span\", {\n                                                        class: _normalizeClass([\"part-damage\", getDamageClass(part.damage)])\n                                                    }, \" : \" + _toDisplayString(part.damage) + \"% \", 3 /* TEXT, CLASS */)\n                                                ], 8 /* PROPS */, _hoisted_35),\n                                                _createCommentVNode(\"  \"),\n                                                (expandedParts.value.has(part.id) && part.children)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_38, [\n                                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(part.children, (child) => {\n                                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                                key: child.id,\n                                                                class: \"body-part-child\"\n                                                            }, [\n                                                                _createElementVNode(\"span\", _hoisted_39, _toDisplayString(child.name), 1 /* TEXT */),\n                                                                _createElementVNode(\"span\", {\n                                                                    class: _normalizeClass([\"child-damage\", getDamageClass(child.damage)])\n                                                                }, _toDisplayString(child.damage) + \"% \", 3 /* TEXT, CLASS */),\n                                                                (child.debuffs && child.debuffs.length > 0)\n                                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_40, [\n                                                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(child.debuffs, (debuff, index) => {\n                                                                            return (_openBlock(), _createElementBlock(\"span\", {\n                                                                                key: index,\n                                                                                class: \"debuff-tag\"\n                                                                            }, _toDisplayString(debuff.type), 1 /* TEXT */));\n                                                                        }), 128 /* KEYED_FRAGMENT */))\n                                                                    ]))\n                                                                    : _createCommentVNode(\"v-if\", true)\n                                                            ]));\n                                                        }), 128 /* KEYED_FRAGMENT */))\n                                                    ]))\n                                                    : _createCommentVNode(\"v-if\", true),\n                                                _createCommentVNode(\"  debuff \"),\n                                                (part.debuffs && part.debuffs.length > 0)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_41, [\n                                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(part.debuffs, (debuff, index) => {\n                                                            return (_openBlock(), _createElementBlock(\"span\", {\n                                                                key: index,\n                                                                class: \"debuff-tag\"\n                                                            }, _toDisplayString(debuff.type), 1 /* TEXT */));\n                                                        }), 128 /* KEYED_FRAGMENT */))\n                                                    ]))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ])\n                            ]))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_42, [...(_cache[13] || (_cache[13] = [\n                                    _createElementVNode(\"p\", null, \"\", -1 /* CACHED */)\n                                ]))]))\n                    ])\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./CharacterPanel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./CharacterPanel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./CharacterPanel.vue?vue&type=style&index=0&id=50159846&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-50159846\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createElementVNode as _createElementVNode, normalizeClass as _normalizeClass, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = { class: \"sprite-layer\" };\nconst _hoisted_2 = [\"src\", \"alt\"];\nimport gsap from 'gsap';\nimport { onBeforeUnmount, onMounted, ref, watch } from 'vue';\nimport { useGameStore } from '../stores/gameStore';\nimport { clearAnimationOptimization, optimizeForAnimation } from '../utils/animation';\n// ==================== Store ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'CharacterSprite',\n    setup(__props) {\n        const gameStore = useGameStore();\n        // ====================  ====================\n        const spriteRefs = ref(new Map());\n        const visibleSprites = ref([]);\n        const preloadedImages = new Map();\n        // ====================  ====================\n        /**\n         * \n         * @param url  URL\n         * @returns Promise<HTMLImageElement>\n         */\n        function preloadImage(url) {\n            // \n            if (preloadedImages.has(url)) {\n                return Promise.resolve(preloadedImages.get(url));\n            }\n            return new Promise((resolve, reject) => {\n                const img = new Image();\n                img.onload = () => {\n                    preloadedImages.set(url, img);\n                    console.log('[CharacterSprite] :', url);\n                    resolve(img);\n                };\n                img.onerror = () => {\n                    console.error('[CharacterSprite] :', url);\n                    reject(new Error(`Failed to preload sprite: ${url}`));\n                };\n                img.src = url;\n            });\n        }\n        // ====================  ====================\n        /**\n         * \n         */\n        function setSpriteRef(characterId, el) {\n            if (el) {\n                spriteRefs.value.set(characterId, el);\n                // \n                optimizeForAnimation(el, ['opacity', 'transform']);\n            }\n        }\n        /**\n         * \n         */\n        function getSpritePositionClass(sprite) {\n            if (sprite.position === 'custom') {\n                return 'position-custom';\n            }\n            return `position-${sprite.position}`;\n        }\n        /**\n         * \n         */\n        function getSpriteStyle(sprite) {\n            const style = {\n                opacity: (sprite.opacity ?? 1).toString(),\n                transform: `scale(${sprite.scale ?? 1})`,\n            };\n            // \n            if (sprite.position === 'custom' && sprite.x !== undefined && sprite.y !== undefined) {\n                style.left = `${sprite.x}px`;\n                style.top = `${sprite.y}px`;\n            }\n            return style;\n        }\n        /**\n         * \n         */\n        async function addSprite(sprite) {\n            // \n            try {\n                await preloadImage(sprite.url);\n            }\n            catch (error) {\n                console.error('[CharacterSprite] :', error);\n            }\n            visibleSprites.value.push(sprite);\n            //  DOM \n            setTimeout(() => {\n                const el = spriteRefs.value.get(sprite.characterId);\n                if (el) {\n                    gsap.fromTo(el, { opacity: 0 }, {\n                        opacity: sprite.opacity ?? 1,\n                        duration: 0.5,\n                        ease: 'power2.out',\n                    });\n                }\n            }, 50);\n        }\n        /**\n         * \n         */\n        function removeSprite(characterId) {\n            const el = spriteRefs.value.get(characterId);\n            if (el) {\n                gsap.to(el, {\n                    opacity: 0,\n                    duration: 0.5,\n                    ease: 'power2.in',\n                    onComplete: () => {\n                        visibleSprites.value = visibleSprites.value.filter(s => s.characterId !== characterId);\n                        spriteRefs.value.delete(characterId);\n                    },\n                });\n            }\n            else {\n                visibleSprites.value = visibleSprites.value.filter(s => s.characterId !== characterId);\n            }\n        }\n        /**\n         * \n         */\n        async function updateSprite(sprite) {\n            const index = visibleSprites.value.findIndex(s => s.characterId === sprite.characterId);\n            if (index === -1)\n                return;\n            // \n            try {\n                await preloadImage(sprite.url);\n            }\n            catch (error) {\n                console.error('[CharacterSprite] :', error);\n            }\n            const el = spriteRefs.value.get(sprite.characterId);\n            if (el) {\n                // \n                gsap.to(el, {\n                    opacity: 0,\n                    duration: 0.3,\n                    ease: 'power2.in',\n                    onComplete: () => {\n                        // \n                        visibleSprites.value[index] = sprite;\n                        // \n                        setTimeout(() => {\n                            gsap.to(el, {\n                                opacity: sprite.opacity ?? 1,\n                                duration: 0.3,\n                                ease: 'power2.out',\n                            });\n                        }, 50);\n                    },\n                });\n            }\n            else {\n                visibleSprites.value[index] = sprite;\n            }\n        }\n        // ====================  ====================\n        watch(() => gameStore.currentScene.sprites, (newSprites, oldSprites) => {\n            if (!oldSprites) {\n                // \n                visibleSprites.value = [...newSprites];\n                return;\n            }\n            // \n            const oldIds = new Set(oldSprites.map(s => s.characterId));\n            const newIds = new Set(newSprites.map(s => s.characterId));\n            // \n            oldSprites.forEach(sprite => {\n                if (!newIds.has(sprite.characterId)) {\n                    removeSprite(sprite.characterId);\n                }\n            });\n            // \n            newSprites.forEach(sprite => {\n                if (!oldIds.has(sprite.characterId)) {\n                    // \n                    addSprite(sprite);\n                }\n                else {\n                    // \n                    const oldSprite = oldSprites.find(s => s.characterId === sprite.characterId);\n                    if (oldSprite && oldSprite.url !== sprite.url) {\n                        updateSprite(sprite);\n                    }\n                }\n            });\n        }, { deep: true });\n        // ====================  ====================\n        onMounted(() => {\n            // \n            if (gameStore.currentScene.sprites.length > 0) {\n                visibleSprites.value = [...gameStore.currentScene.sprites];\n            }\n        });\n        onBeforeUnmount(() => {\n            // \n            spriteRefs.value.forEach(el => {\n                clearAnimationOptimization(el);\n            });\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(visibleSprites.value, (sprite) => {\n                    return (_openBlock(), _createElementBlock(\"div\", {\n                        key: sprite.characterId,\n                        ref_for: true,\n                        ref: el => setSpriteRef(sprite.characterId, el),\n                        class: _normalizeClass([\"character-sprite\", getSpritePositionClass(sprite)]),\n                        style: _normalizeStyle(getSpriteStyle(sprite))\n                    }, [\n                        _createElementVNode(\"img\", {\n                            src: sprite.url,\n                            alt: `${sprite.characterId} `,\n                            class: \"sprite-image\"\n                        }, null, 8 /* PROPS */, _hoisted_2)\n                    ], 6 /* CLASS, STYLE */));\n                }), 128 /* KEYED_FRAGMENT */))\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./CharacterSprite.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./CharacterSprite.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./CharacterSprite.vue?vue&type=style&index=0&id=650574d0&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-650574d0\"]])\n\nexport default __exports__","// COC7  -  COC7 \n\nimport type { Character, COC7Attributes, DerivedStats } from '../types/character';\nimport type {\n  CombatAction,\n  CombatParticipant,\n  CombatResult,\n  CombatRound,\n  DiceRoll,\n  Enemy,\n  EscapeAttempt,\n  RollResult,\n} from '../types/combat';\nimport * as coc7Rules from '../utils/coc7Rules';\n\n/**\n * COC7 \n *  COC7 \n */\nclass COC7Service {\n  // ====================  ====================\n\n  /**\n   *  1d100\n   */\n  rollDice(): number {\n    return coc7Rules.rollDice();\n  }\n\n  /**\n   * \n   * @param roll  (1-100)\n   * @param skill  (0-100)\n   */\n  evaluateRoll(roll: number, skill: number): RollResult {\n    return coc7Rules.evaluateRoll(roll, skill);\n  }\n\n  /**\n   * \n   * @param skillName \n   * @param skillValue \n   */\n  performSkillCheck(skillName: string, skillValue: number): DiceRoll {\n    return coc7Rules.performSkillCheck(skillName, skillValue);\n  }\n\n  /**\n   * \n   */\n  getRollResultText(result: RollResult): string {\n    return coc7Rules.getRollResultText(result);\n  }\n\n  /**\n   * \n   * @param attacker \n   * @param defender \n   */\n  resolveOpposedRoll(attacker: number, defender: number) {\n    return coc7Rules.resolveOpposedRoll(attacker, defender);\n  }\n\n  // ====================  ====================\n\n  /**\n   * \n   * @param attributes COC7 \n   */\n  calculateDerivedStats(attributes: COC7Attributes): DerivedStats {\n    return coc7Rules.calculateDerivedStats(attributes);\n  }\n\n  /**\n   * \n   */\n  calculateMovement(attributes: COC7Attributes): number {\n    return coc7Rules.calculateMovement(attributes);\n  }\n\n  /**\n   * \n   */\n  calculateDamageBonus(attributes: COC7Attributes): { DB: string; BUILD: number } {\n    return coc7Rules.calculateDamageBonus(attributes);\n  }\n\n  /**\n   *  COC7 \n   * @param method \n   */\n  generateRandomAttributes(method: '3d6x5' | '2d6+6x5' = '3d6x5'): COC7Attributes {\n    return coc7Rules.generateRandomAttributes(method);\n  }\n\n  // ====================  ====================\n\n  /**\n   * \n   * @param baseDamage \n   * @param armor \n   */\n  calculateDamage(baseDamage: number, armor: number = 0): number {\n    return coc7Rules.calculateDamage(baseDamage, armor);\n  }\n\n  /**\n   *  \"+1d4\"\n   * @param db \n   */\n  private rollDamageBonus(db: string): number {\n    if (db === '0' || db === '-1' || db === '-2') {\n      return parseInt(db);\n    }\n\n    //  \"+XdY\" \n    const match = db.match(/\\+?(\\d+)d(\\d+)/);\n    if (match) {\n      const count = parseInt(match[1]);\n      const sides = parseInt(match[2]);\n      let total = 0;\n      for (let i = 0; i < count; i++) {\n        total += Math.floor(Math.random() * sides) + 1;\n      }\n      return total;\n    }\n\n    return 0;\n  }\n\n  /**\n   * \n   * @param attacker \n   * @param weaponDamage \n   * @param armor \n   */\n  calculateAttackDamage(attacker: Character | Enemy, weaponDamage: number, armor: number = 0): number {\n    const dbBonus = this.rollDamageBonus(attacker.derivedStats.DB);\n    const totalDamage = weaponDamage + dbBonus;\n    return this.calculateDamage(totalDamage, armor);\n  }\n\n  /**\n   * \n   * @param participant \n   */\n  calculateInitiative(participant: Character | Enemy): number {\n    //  = DEX + 1d10\n    const dexBonus = participant.attributes.DEX;\n    const roll = Math.floor(Math.random() * 10) + 1;\n    return dexBonus + roll;\n  }\n\n  /**\n   * \n   * @param attacker \n   * @param defender \n   * @param attackSkill \n   * @param dodgeSkill \n   * @param weaponDamage \n   */\n  executeAttack(\n    attacker: CombatParticipant,\n    defender: CombatParticipant,\n    attackSkill: number,\n    dodgeSkill: number,\n    weaponDamage: number,\n  ): CombatAction {\n    // \n    const opposed = this.resolveOpposedRoll(attackSkill, dodgeSkill);\n\n    const action: CombatAction = {\n      type: 'attack',\n      actorId: attacker.id,\n      targetId: defender.id,\n      attackType: 'melee',\n      skillUsed: '',\n      roll: opposed.attackerRoll,\n    };\n\n    // \n    if (opposed.result === 'attacker_wins') {\n      // \n      const entity = attacker.character || attacker.enemy;\n      if (entity) {\n        const damage = this.calculateAttackDamage(entity, weaponDamage);\n        action.damage = damage;\n        action.description = `${attacker.id}  ${damage} `;\n\n        //  HP\n        defender.currentHP = Math.max(0, defender.currentHP - damage);\n      }\n    } else if (opposed.result === 'defender_wins') {\n      action.description = `${defender.id} `;\n    } else {\n      action.description = ``;\n    }\n\n    return action;\n  }\n\n  /**\n   * \n   * @param escaper \n   * @param chaser \n   */\n  attemptEscape(escaper: CombatParticipant, chaser: CombatParticipant): EscapeAttempt {\n    //  DEX \n    const escaperDEX = escaper.character?.attributes.DEX || escaper.enemy?.attributes.DEX || 50;\n    const chaserDEX = chaser.character?.attributes.DEX || chaser.enemy?.attributes.DEX || 50;\n\n    const opposed = this.resolveOpposedRoll(escaperDEX, chaserDEX);\n\n    const success = opposed.result === 'attacker_wins';\n\n    return {\n      success,\n      roll: opposed.attackerRoll,\n      consequence: success ? undefined : '',\n    };\n  }\n\n  /**\n   * \n   * @param player \n   * @param enemy \n   * @param maxRounds \n   */\n  resolveCombat(player: Character, enemy: Enemy, maxRounds: number = 10): CombatResult {\n    try {\n      console.log('[COC7 Service] :', player.name, 'vs', enemy.name);\n\n      // \n      if (!player || !enemy) {\n        throw new Error('');\n      }\n\n      if (maxRounds <= 0) {\n        throw new Error(' 0');\n      }\n\n      // \n      const playerParticipant: CombatParticipant = {\n        id: player.id,\n        character: player,\n        isPlayer: true,\n        currentHP: player.derivedStats.HP,\n        currentMP: player.derivedStats.MP,\n        currentSAN: player.derivedStats.SAN,\n        statusEffects: [],\n        initiative: this.calculateInitiative(player),\n      };\n\n      const enemyParticipant: CombatParticipant = {\n        id: enemy.id,\n        enemy,\n        isPlayer: false,\n        currentHP: enemy.derivedStats.HP,\n        currentMP: enemy.derivedStats.MP,\n        currentSAN: enemy.derivedStats.SAN,\n        statusEffects: [],\n        initiative: this.calculateInitiative(enemy),\n      };\n\n      const rounds: CombatRound[] = [];\n      let currentRound = 1;\n      let status: 'active' | 'victory' | 'defeat' | 'escaped' = 'active';\n\n      // \n      while (currentRound <= maxRounds && status === 'active') {\n        const actions: CombatAction[] = [];\n\n        // \n        const order =\n          playerParticipant.initiative >= enemyParticipant.initiative\n            ? [playerParticipant, enemyParticipant]\n            : [enemyParticipant, playerParticipant];\n\n        // \n        for (const actor of order) {\n          const target = actor === playerParticipant ? enemyParticipant : playerParticipant;\n\n          // \n          if (actor.currentHP <= 0 || target.currentHP <= 0) {\n            break;\n          }\n\n          // \n          const attackSkill = actor.character?.skills.get('') || actor.enemy?.skills.get('') || 50;\n          const dodgeSkill = target.character?.skills.get('') || target.enemy?.skills.get('') || 50;\n\n          // \n          const action = this.executeAttack(actor, target, attackSkill, dodgeSkill, 6); //  1d6\n          actions.push(action);\n        }\n\n        // \n        rounds.push({\n          roundNumber: currentRound,\n          actions,\n          timestamp: Date.now(),\n        });\n\n        // \n        if (playerParticipant.currentHP <= 0) {\n          status = 'defeat';\n        } else if (enemyParticipant.currentHP <= 0) {\n          status = 'victory';\n        }\n\n        currentRound++;\n      }\n\n      // \n      if (status === 'active') {\n        status = 'defeat';\n        console.log('[COC7 Service] ');\n      }\n\n      const result: CombatResult = {\n        status,\n        rounds,\n        winner: status === 'victory' ? player.id : status === 'defeat' ? enemy.id : undefined,\n        loser: status === 'victory' ? enemy.id : status === 'defeat' ? player.id : undefined,\n        endTime: Date.now(),\n      };\n\n      // \n      if (status === 'victory' && enemy.loot) {\n        result.rewards = {\n          items: enemy.loot,\n          experience: enemy.derivedStats.HP * 10, // \n        };\n      }\n\n      console.log('[COC7 Service] :', status);\n      return result;\n    } catch (error) {\n      console.error('[COC7 Service] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  // ====================  ====================\n\n  /**\n   * \n   * @param currentSAN \n   * @param sanLoss \n   */\n  checkInsanity(currentSAN: number, sanLoss: number) {\n    return coc7Rules.checkInsanity(currentSAN, sanLoss);\n  }\n\n  /**\n   * \n   * @param character \n   * @param sanLoss /\n   */\n  performSanityCheck(\n    character: Character,\n    sanLoss: { success: number; failure: number },\n  ): {\n    roll: DiceRoll;\n    actualLoss: number;\n    insanity: ReturnType<typeof coc7Rules.checkInsanity>;\n  } {\n    const roll = this.performSkillCheck('', character.derivedStats.SAN);\n    const actualLoss = roll.result === 'failure' ? sanLoss.failure : sanLoss.success;\n    const insanity = this.checkInsanity(character.derivedStats.SAN, actualLoss);\n\n    return { roll, actualLoss, insanity };\n  }\n\n  // ====================  ====================\n\n  /**\n   * \n   * @param character \n   * @param skillName \n   * @param defaultValue \n   */\n  getSkillValue(character: Character | Enemy, skillName: string, defaultValue: number = 50): number {\n    return character.skills.get(skillName) || defaultValue;\n  }\n\n  /**\n   * \n   * @param character \n   * @param skillName \n   * @param value \n   */\n  setSkillValue(character: Character | Enemy, skillName: string, value: number): void {\n    character.skills.set(skillName, Math.max(0, Math.min(100, value)));\n  }\n\n  /**\n   * \n   * @param currentValue \n   */\n  skillImprovement(currentValue: number): { improved: boolean; newValue: number } {\n    //  1d100 1d10\n    const roll = this.rollDice();\n\n    if (roll > currentValue) {\n      const improvement = Math.floor(Math.random() * 10) + 1;\n      const newValue = Math.min(100, currentValue + improvement);\n      return { improved: true, newValue };\n    }\n\n    return { improved: false, newValue: currentValue };\n  }\n}\n\n// \nexport const coc7Service = new COC7Service();\n","//  Store - \n\nimport { defineStore } from 'pinia';\nimport { computed, ref } from 'vue';\nimport type { Character } from '../types/character';\nimport type { CombatAction, CombatParticipant, CombatState, CombatStatus, Enemy, StatusEffect } from '../types/combat';\n\n/**\n *  Store\n */\nexport const useCombatStore = defineStore('combat', () => {\n  // ====================  ====================\n  const currentCombat = ref<CombatState | undefined>(undefined);\n  const isInCombat = ref(false);\n  const combatHistory = ref<CombatState[]>([]);\n\n  // ====================  ====================\n  const combatId = computed(() => currentCombat.value?.id);\n\n  const currentRound = computed(() => currentCombat.value?.currentRound || 0);\n\n  const currentTurn = computed(() => currentCombat.value?.currentTurn || 0);\n\n  const status = computed(() => currentCombat.value?.status || 'active');\n\n  const participants = computed(() => currentCombat.value?.participants || []);\n\n  const playerParticipants = computed(() => participants.value.filter(p => p.isPlayer));\n\n  const enemyParticipants = computed(() => participants.value.filter(p => !p.isPlayer));\n\n  const currentParticipant = computed(() => {\n    if (!currentCombat.value) return undefined;\n    return participants.value[currentCombat.value.currentTurn];\n  });\n\n  const isPlayerTurn = computed(() => currentParticipant.value?.isPlayer || false);\n\n  const rounds = computed(() => currentCombat.value?.rounds || []);\n\n  const latestRound = computed(() => {\n    if (rounds.value.length === 0) return undefined;\n    return rounds.value[rounds.value.length - 1];\n  });\n\n  const isActive = computed(() => status.value === 'active');\n\n  const isVictory = computed(() => status.value === 'victory');\n\n  const isDefeat = computed(() => status.value === 'defeat');\n\n  const isEscaped = computed(() => status.value === 'escaped');\n\n  // ====================  ====================\n\n  /**\n   * \n   */\n  function startCombat(player: Character, enemies: Enemy[], environment?: string): void {\n    try {\n      // \n      const participants: CombatParticipant[] = [];\n\n      // \n      participants.push({\n        id: player.id,\n        character: player,\n        isPlayer: true,\n        currentHP: player.derivedStats.HP,\n        currentMP: player.derivedStats.MP,\n        currentSAN: player.derivedStats.SAN,\n        statusEffects: [],\n        initiative: calculateInitiative(player.attributes.DEX),\n      });\n\n      // \n      enemies.forEach(enemy => {\n        participants.push({\n          id: enemy.id,\n          enemy,\n          isPlayer: false,\n          currentHP: enemy.derivedStats.HP,\n          currentMP: enemy.derivedStats.MP,\n          currentSAN: enemy.derivedStats.SAN,\n          statusEffects: [],\n          initiative: calculateInitiative(enemy.attributes.DEX),\n        });\n      });\n\n      // \n      participants.sort((a, b) => b.initiative - a.initiative);\n\n      // \n      currentCombat.value = {\n        id: `combat_${Date.now()}`,\n        participants,\n        currentRound: 1,\n        currentTurn: 0,\n        status: 'active',\n        rounds: [],\n        startTime: Date.now(),\n        environment,\n      };\n\n      isInCombat.value = true;\n\n      console.log('[Combat Store] :', currentCombat.value.id);\n      toastr.warning('');\n    } catch (error) {\n      console.error('[Combat Store] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  function calculateInitiative(dex: number): number {\n    //  =  + 1d10\n    return dex + Math.floor(Math.random() * 10) + 1;\n  }\n\n  /**\n   * \n   */\n  function executeAction(action: CombatAction): void {\n    if (!currentCombat.value) {\n      throw new Error('');\n    }\n\n    try {\n      // \n      let currentRoundData = rounds.value.find(r => r.roundNumber === currentRound.value);\n\n      if (!currentRoundData) {\n        // \n        currentRoundData = {\n          roundNumber: currentRound.value,\n          actions: [],\n          timestamp: Date.now(),\n        };\n        currentCombat.value.rounds.push(currentRoundData);\n      }\n\n      // \n      currentRoundData.actions.push(action);\n\n      console.log('[Combat Store] :', action.type);\n\n      // \n      processActionEffects(action);\n\n      // \n      nextTurn();\n    } catch (error) {\n      console.error('[Combat Store] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  function processActionEffects(action: CombatAction): void {\n    if (!currentCombat.value) return;\n\n    // \n    if (action.damage && action.targetId) {\n      const target = participants.value.find(p => p.id === action.targetId);\n      if (target) {\n        target.currentHP = Math.max(0, target.currentHP - action.damage);\n        console.log(`[Combat Store] ${action.targetId}  ${action.damage} `);\n\n        // \n        if (target.currentHP === 0) {\n          console.log(`[Combat Store] ${action.targetId} `);\n        }\n      }\n    }\n\n    // \n    checkCombatEnd();\n  }\n\n  /**\n   * \n   */\n  function checkCombatEnd(): void {\n    if (!currentCombat.value) return;\n\n    const playersAlive = playerParticipants.value.some(p => p.currentHP > 0);\n    const enemiesAlive = enemyParticipants.value.some(p => p.currentHP > 0);\n\n    if (!playersAlive) {\n      endCombat('defeat');\n    } else if (!enemiesAlive) {\n      endCombat('victory');\n    }\n  }\n\n  /**\n   * \n   */\n  function nextTurn(): void {\n    if (!currentCombat.value) return;\n\n    currentCombat.value.currentTurn++;\n\n    // \n    if (currentCombat.value.currentTurn >= participants.value.length) {\n      nextRound();\n    }\n  }\n\n  /**\n   * \n   */\n  function nextRound(): void {\n    if (!currentCombat.value) return;\n\n    currentCombat.value.currentRound++;\n    currentCombat.value.currentTurn = 0;\n\n    // \n    processStatusEffects();\n\n    console.log(`[Combat Store]  ${currentCombat.value.currentRound} `);\n    toastr.info(` ${currentCombat.value.currentRound} `);\n  }\n\n  /**\n   * \n   */\n  function processStatusEffects(): void {\n    if (!currentCombat.value) return;\n\n    participants.value.forEach(participant => {\n      // \n      participant.statusEffects.forEach(effect => {\n        if (effect.effect.damagePerRound) {\n          participant.currentHP = Math.max(0, participant.currentHP - effect.effect.damagePerRound);\n          console.log(`[Combat Store] ${participant.id}  ${effect.name}  ${effect.effect.damagePerRound} `);\n        }\n\n        // \n        if (effect.duration > 0) {\n          effect.duration--;\n        }\n      });\n\n      // \n      participant.statusEffects = participant.statusEffects.filter(effect => effect.duration !== 0);\n    });\n\n    // \n    checkCombatEnd();\n  }\n\n  /**\n   * \n   */\n  function addStatusEffect(participantId: string, effect: StatusEffect): void {\n    const participant = participants.value.find(p => p.id === participantId);\n    if (!participant) {\n      throw new Error(` ${participantId} `);\n    }\n\n    participant.statusEffects.push(effect);\n    console.log(`[Combat Store] ${participantId} : ${effect.name}`);\n\n    const effectType = effect.type === 'buff' ? '' : '';\n    toastr.info(`${effectType}${effect.name}`);\n  }\n\n  /**\n   * \n   */\n  function removeStatusEffect(participantId: string, effectId: string): void {\n    const participant = participants.value.find(p => p.id === participantId);\n    if (!participant) {\n      throw new Error(` ${participantId} `);\n    }\n\n    const effect = participant.statusEffects.find(e => e.id === effectId);\n    if (effect) {\n      participant.statusEffects = participant.statusEffects.filter(e => e.id !== effectId);\n      console.log(`[Combat Store] ${participantId} : ${effect.name}`);\n    }\n  }\n\n  /**\n   * \n   */\n  function attemptEscape(): boolean {\n    if (!currentCombat.value) {\n      throw new Error('');\n    }\n\n    // 50% \n    const success = Math.random() < 0.5;\n\n    if (success) {\n      endCombat('escaped');\n      toastr.success('');\n    } else {\n      toastr.warning('');\n    }\n\n    return success;\n  }\n\n  /**\n   * \n   */\n  function endCombat(finalStatus: CombatStatus): void {\n    if (!currentCombat.value) return;\n\n    try {\n      currentCombat.value.status = finalStatus;\n      isInCombat.value = false;\n\n      // \n      combatHistory.value.push(currentCombat.value);\n\n      console.log('[Combat Store] :', finalStatus);\n\n      // \n      switch (finalStatus) {\n        case 'victory':\n          toastr.success('');\n          break;\n        case 'defeat':\n          toastr.error('...');\n          break;\n        case 'escaped':\n          toastr.info('');\n          break;\n      }\n    } catch (error) {\n      console.error('[Combat Store] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  function getParticipant(participantId: string): CombatParticipant | undefined {\n    return participants.value.find(p => p.id === participantId);\n  }\n\n  /**\n   * \n   */\n  function updateParticipant(participantId: string, updates: Partial<CombatParticipant>): void {\n    const participant = participants.value.find(p => p.id === participantId);\n    if (!participant) {\n      throw new Error(` ${participantId} `);\n    }\n\n    Object.assign(participant, updates);\n    console.log(`[Combat Store]  ${participantId} `);\n  }\n\n  /**\n   * \n   */\n  function getCombatStats() {\n    if (!currentCombat.value) return null;\n\n    return {\n      roundCount: currentRound.value,\n      actionCount: rounds.value.reduce((sum, round) => sum + round.actions.length, 0),\n      duration: Date.now() - currentCombat.value.startTime,\n      playerHP: playerParticipants.value.map(p => ({\n        id: p.id,\n        current: p.currentHP,\n        max: p.character?.derivedStats.maxHP || 0,\n      })),\n      enemyHP: enemyParticipants.value.map(p => ({\n        id: p.id,\n        current: p.currentHP,\n        max: p.enemy?.derivedStats.maxHP || 0,\n      })),\n    };\n  }\n\n  /**\n   * \n   */\n  function reset(): void {\n    currentCombat.value = undefined;\n    isInCombat.value = false;\n    console.log('[Combat Store] ');\n  }\n\n  /**\n   * \n   */\n  function clearHistory(): void {\n    combatHistory.value = [];\n    console.log('[Combat Store] ');\n  }\n\n  // ====================  ====================\n  return {\n    // \n    currentCombat,\n    isInCombat,\n    combatHistory,\n\n    // \n    combatId,\n    currentRound,\n    currentTurn,\n    status,\n    participants,\n    playerParticipants,\n    enemyParticipants,\n    currentParticipant,\n    isPlayerTurn,\n    rounds,\n    latestRound,\n    isActive,\n    isVictory,\n    isDefeat,\n    isEscaped,\n\n    // \n    startCombat,\n    executeAction,\n    nextTurn,\n    nextRound,\n    addStatusEffect,\n    removeStatusEffect,\n    attemptEscape,\n    endCombat,\n    getParticipant,\n    updateParticipant,\n    getCombatStats,\n    reset,\n    clearHistory,\n  };\n});\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createCommentVNode as _createCommentVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, normalizeStyle as _normalizeStyle, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = { class: \"combat-status-bar\" };\nconst _hoisted_2 = { class: \"combat-status\" };\nconst _hoisted_3 = {\n    key: 0,\n    class: \"status-active\"\n};\nconst _hoisted_4 = {\n    key: 1,\n    class: \"status-victory\"\n};\nconst _hoisted_5 = {\n    key: 2,\n    class: \"status-defeat\"\n};\nconst _hoisted_6 = {\n    key: 3,\n    class: \"status-escaped\"\n};\nconst _hoisted_7 = { class: \"combat-header\" };\nconst _hoisted_8 = { class: \"enemies-area\" };\nconst _hoisted_9 = { class: \"participants-list\" };\nconst _hoisted_10 = { class: \"participant-name\" };\nconst _hoisted_11 = { class: \"participant-stats\" };\nconst _hoisted_12 = { class: \"stat-bar hp-bar\" };\nconst _hoisted_13 = { class: \"bar-container\" };\nconst _hoisted_14 = { class: \"bar-text\" };\nconst _hoisted_15 = { class: \"players-area\" };\nconst _hoisted_16 = { class: \"participants-list\" };\nconst _hoisted_17 = { class: \"participant-name\" };\nconst _hoisted_18 = {\n    key: 0,\n    class: \"combat-actions\"\n};\nconst _hoisted_19 = [\"disabled\"];\nconst _hoisted_20 = [\"disabled\"];\nconst _hoisted_21 = {\n    key: 1,\n    class: \"combat-end-actions\"\n};\nimport { ref } from 'vue';\nimport { coc7Service } from '../services/coc7Service';\nimport { mvuService } from '../services/mvuService';\nimport { useCombatStore } from '../stores/combatStore';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'CombatPanel',\n    emits: [\"close\"],\n    setup(__props, { emit: __emit }) {\n        const combatStore = useCombatStore();\n        const isProcessing = ref(false);\n        function getHPPercentage(participant) {\n            const maxHP = participant.character?.derivedStats.maxHP || participant.enemy?.derivedStats.maxHP || 1;\n            return Math.max(0, Math.min(100, (participant.currentHP / maxHP) * 100));\n        }\n        function isCurrentParticipant(participant) {\n            return combatStore.currentParticipant?.id === participant.id;\n        }\n        async function performAttack() {\n            if (!combatStore.currentCombat || isProcessing.value)\n                return;\n            try {\n                isProcessing.value = true;\n                const player = combatStore.playerParticipants[0];\n                const enemy = combatStore.enemyParticipants.find(e => e.currentHP > 0);\n                if (!player || !enemy || !player.character || !enemy.enemy) {\n                    toastr.error('');\n                    return;\n                }\n                const attackSkill = coc7Service.getSkillValue(player.character, '', 50);\n                const dodgeSkill = coc7Service.getSkillValue(enemy.enemy, '', 50);\n                const action = coc7Service.executeAttack(player, enemy, attackSkill, dodgeSkill, 6);\n                combatStore.executeAction(action);\n                if (!combatStore.isActive) {\n                    await updateMVUAfterCombat();\n                }\n            }\n            catch (error) {\n                console.error('[Combat Panel] :', error);\n                toastr.error('');\n            }\n            finally {\n                isProcessing.value = false;\n            }\n        }\n        async function updateMVUAfterCombat() {\n            try {\n                const player = combatStore.playerParticipants[0];\n                if (!player || !player.character)\n                    return;\n                await mvuService.updateCharacterStatus('player', {\n                    derivedStats: {\n                        HP: player.currentHP,\n                        MP: player.currentMP,\n                        SAN: player.currentSAN,\n                        maxHP: player.character.derivedStats.maxHP,\n                        maxMP: player.character.derivedStats.maxMP,\n                        maxSAN: player.character.derivedStats.maxSAN,\n                        MOV: player.character.derivedStats.MOV,\n                        DB: player.character.derivedStats.DB,\n                        BUILD: player.character.derivedStats.BUILD,\n                    },\n                });\n            }\n            catch (error) {\n                console.error('[Combat Panel]  MVU :', error);\n            }\n        }\n        const emit = __emit;\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"combat-panel\", { 'combat-ended': !_unref(combatStore).isActive }])\n            }, [\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_1, [\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        (_unref(combatStore).isActive)\n                            ? (_openBlock(), _createElementBlock(\"span\", _hoisted_3, \"\"))\n                            : (_unref(combatStore).isVictory)\n                                ? (_openBlock(), _createElementBlock(\"span\", _hoisted_4, \"\"))\n                                : (_unref(combatStore).isDefeat)\n                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_5, \"\"))\n                                    : (_unref(combatStore).isEscaped)\n                                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_6, \"\"))\n                                        : _createCommentVNode(\"v-if\", true)\n                    ])\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"button\", {\n                    class: \"floating-exit-btn-top\",\n                    title: \"\",\n                    onClick: _cache[0] || (_cache[0] = ($event) => (emit('close')))\n                }, \"\"),\n                _createElementVNode(\"div\", _hoisted_7, [\n                    _createElementVNode(\"h2\", null, \" -  \" + _toDisplayString(_unref(combatStore).currentRound) + \" \", 1 /* TEXT */)\n                ]),\n                _createElementVNode(\"div\", _hoisted_8, [\n                    _cache[4] || (_cache[4] = _createElementVNode(\"h3\", null, \"\", -1 /* CACHED */)),\n                    _createElementVNode(\"div\", _hoisted_9, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(combatStore).enemyParticipants, (enemy) => {\n                            return (_openBlock(), _createElementBlock(\"div\", {\n                                key: enemy.id,\n                                class: _normalizeClass([\"participant enemy\", { dead: enemy.currentHP <= 0, active: isCurrentParticipant(enemy) }])\n                            }, [\n                                _createElementVNode(\"div\", _hoisted_10, _toDisplayString(enemy.enemy?.name || enemy.id), 1 /* TEXT */),\n                                _createElementVNode(\"div\", _hoisted_11, [\n                                    _createElementVNode(\"div\", _hoisted_12, [\n                                        _cache[3] || (_cache[3] = _createElementVNode(\"label\", null, \"HP\", -1 /* CACHED */)),\n                                        _createElementVNode(\"div\", _hoisted_13, [\n                                            _createElementVNode(\"div\", {\n                                                class: \"bar-fill hp\",\n                                                style: _normalizeStyle({ width: getHPPercentage(enemy) + '%' })\n                                            }, null, 4 /* STYLE */),\n                                            _createElementVNode(\"span\", _hoisted_14, _toDisplayString(enemy.currentHP) + \" / \" + _toDisplayString(enemy.enemy?.derivedStats.maxHP), 1 /* TEXT */)\n                                        ])\n                                    ])\n                                ])\n                            ], 2 /* CLASS */));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_15, [\n                    _cache[5] || (_cache[5] = _createElementVNode(\"h3\", null, \"\", -1 /* CACHED */)),\n                    _createElementVNode(\"div\", _hoisted_16, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(combatStore).playerParticipants, (player) => {\n                            return (_openBlock(), _createElementBlock(\"div\", {\n                                key: player.id,\n                                class: _normalizeClass([\"participant player\", { dead: player.currentHP <= 0, active: isCurrentParticipant(player) }])\n                            }, [\n                                _createElementVNode(\"div\", _hoisted_17, _toDisplayString(player.character?.name || player.id), 1 /* TEXT */)\n                            ], 2 /* CLASS */));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ])\n                ]),\n                (_unref(combatStore).isActive)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_18, [\n                        _createElementVNode(\"button\", {\n                            class: \"btn-attack\",\n                            disabled: isProcessing.value || !_unref(combatStore).isPlayerTurn,\n                            onClick: performAttack\n                        }, _toDisplayString(isProcessing.value ? '...' : ''), 9 /* TEXT, PROPS */, _hoisted_19),\n                        _createElementVNode(\"button\", {\n                            class: \"btn-escape\",\n                            disabled: isProcessing.value,\n                            onClick: _cache[1] || (_cache[1] = ($event) => (emit('close')))\n                        }, \"\", 8 /* PROPS */, _hoisted_20)\n                    ]))\n                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_21, [\n                        _createElementVNode(\"button\", {\n                            class: \"btn-close\",\n                            onClick: _cache[2] || (_cache[2] = ($event) => (emit('close')))\n                        }, \"\")\n                    ]))\n            ], 2 /* CLASS */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./CombatPanel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./CombatPanel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./CombatPanel.vue?vue&type=style&index=0&id=08965543&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-08965543\"]])\n\nexport default __exports__","// NPC  -  NPC  COC7 \n\nimport type { COC7Attributes, DerivedStats } from '../types/character';\n\n/**\n * NPC \n */\nexport interface NPCGenerationResult {\n  attributes: COC7Attributes; // \n  derivedStats: DerivedStats; // \n  occupation: string; // \n  age: number; // \n  background: string; // \n  skills: Map<string, number>; // \n  relationship?: string; // \n}\n\n/**\n * NPC \n */\nclass NPCAnalysisService {\n  /**\n   * \n   */\n  private inferAge(text: string, characterName: string): number | undefined {\n    // \n    const agePattern = new RegExp(`${characterName}.*?(\\\\d+)`);\n    const ageMatch = text.match(agePattern);\n    if (ageMatch) {\n      return parseInt(ageMatch[1]);\n    }\n\n    // \n    const ageKeywords: Record<string, number> = {\n      : 5,\n      : 10,\n      : 15,\n      : 16,\n      : 25,\n      : 45,\n      : 65,\n      : 70,\n      : 10,\n      : 12,\n    };\n\n    for (const [keyword, age] of Object.entries(ageKeywords)) {\n      const pattern = new RegExp(`${keyword}.*?${characterName}|${characterName}.*?${keyword}`);\n      if (pattern.test(text)) {\n        return age;\n      }\n    }\n\n    return undefined;\n  }\n\n  /**\n   * \n   */\n  private inferOccupation(text: string, characterName: string): string | undefined {\n    const occupations = [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ];\n\n    for (const occupation of occupations) {\n      const pattern = new RegExp(`${characterName}.*?${occupation}|${occupation}.*?${characterName}`);\n      if (pattern.test(text)) {\n        return occupation;\n      }\n    }\n\n    return undefined;\n  }\n\n  /**\n   * \n   * COC715-9050\n   */\n  private inferAttributes(text: string, characterName: string, age?: number): COC7Attributes {\n    const attributes: COC7Attributes = {\n      STR: 50, // \n      CON: 50, // \n      SIZ: 50, // \n      DEX: 50, // \n      APP: 50, // \n      INT: 50, // \n      POW: 50, // \n      EDU: 50, // \n      LUK: 50, // \n    };\n\n    // \n    const strKeywords = {\n      high: ['', '', '', '', '', '', ''],\n      low: ['', '', '', '', ''],\n    };\n\n    // \n    const conKeywords = {\n      high: ['', '', '', '', ''],\n      low: ['', '', '', '', ''],\n    };\n\n    // \n    const sizKeywords = {\n      high: ['', '', '', '', ''],\n      low: ['', '', '', '', ''],\n    };\n\n    // \n    const dexKeywords = {\n      high: ['', '', '', '', '', ''],\n      low: ['', '', '', ''],\n    };\n\n    // \n    const appKeywords = {\n      high: ['', '', '', '', '', '', '', ''],\n      low: ['', '', '', ''],\n    };\n\n    // \n    const intKeywords = {\n      high: ['', '', '', '', '', ''],\n      low: ['', '', '', ''],\n    };\n\n    // \n    const powKeywords = {\n      high: ['', '', '', '', '', ''],\n      low: ['', '', '', '', ''],\n    };\n\n    // \n    const eduKeywords = {\n      high: ['', '', '', '', '', ''],\n      low: ['', '', ''],\n    };\n\n    // \n    const checkAndAdjust = (attr: keyof COC7Attributes, keywords: { high: string[]; low: string[] }) => {\n      const pattern = new RegExp(`${characterName}.*?|.*?${characterName}`);\n      const relevantText = text.match(pattern)?.[0] || text;\n\n      for (const keyword of keywords.high) {\n        if (relevantText.includes(keyword)) {\n          attributes[attr] = Math.min(90, attributes[attr] + 20);\n          break;\n        }\n      }\n\n      for (const keyword of keywords.low) {\n        if (relevantText.includes(keyword)) {\n          attributes[attr] = Math.max(15, attributes[attr] - 20);\n          break;\n        }\n      }\n    };\n\n    checkAndAdjust('STR', strKeywords);\n    checkAndAdjust('CON', conKeywords);\n    checkAndAdjust('SIZ', sizKeywords);\n    checkAndAdjust('DEX', dexKeywords);\n    checkAndAdjust('APP', appKeywords);\n    checkAndAdjust('INT', intKeywords);\n    checkAndAdjust('POW', powKeywords);\n    checkAndAdjust('EDU', eduKeywords);\n\n    // \n    if (age !== undefined) {\n      if (age < 15) {\n        // \n        attributes.STR = Math.max(15, attributes.STR - 20);\n        attributes.SIZ = Math.max(15, attributes.SIZ - 20);\n        attributes.EDU = Math.max(15, attributes.EDU - 30);\n      } else if (age >= 60) {\n        // \n        attributes.STR = Math.max(15, attributes.STR - 15);\n        attributes.DEX = Math.max(15, attributes.DEX - 15);\n        attributes.CON = Math.max(15, attributes.CON - 10);\n        attributes.EDU = Math.min(90, attributes.EDU + 10);\n      }\n    }\n\n    // 40-60\n    attributes.LUK = 40 + Math.floor(Math.random() * 21);\n\n    return attributes;\n  }\n\n  /**\n   * \n   */\n  private calculateDerivedStats(attributes: COC7Attributes): DerivedStats {\n    // HP = (CON + SIZ) / 10\n    const maxHP = Math.floor((attributes.CON + attributes.SIZ) / 10);\n\n    // MP = POW / 5\n    const maxMP = Math.floor(attributes.POW / 5);\n\n    // SAN = POW\n    const maxSAN = 99;\n    const SAN = attributes.POW;\n\n    // MOV ()\n    let MOV = 8;\n    if (attributes.DEX < attributes.SIZ && attributes.STR < attributes.SIZ) {\n      MOV = 7;\n    } else if (attributes.DEX >= attributes.SIZ && attributes.STR >= attributes.SIZ) {\n      MOV = 9;\n    }\n\n    // DB ()  BUILD ()\n    const sum = attributes.STR + attributes.SIZ;\n    let DB = '0';\n    let BUILD = 0;\n\n    if (sum <= 64) {\n      DB = '-2';\n      BUILD = -2;\n    } else if (sum <= 84) {\n      DB = '-1';\n      BUILD = -1;\n    } else if (sum <= 124) {\n      DB = '0';\n      BUILD = 0;\n    } else if (sum <= 164) {\n      DB = '+1d4';\n      BUILD = 1;\n    } else if (sum <= 204) {\n      DB = '+1d6';\n      BUILD = 2;\n    } else {\n      DB = '+2d6';\n      BUILD = 3;\n    }\n\n    return {\n      HP: maxHP,\n      maxHP,\n      MP: maxMP,\n      maxMP,\n      SAN,\n      maxSAN,\n      MOV,\n      DB,\n      BUILD,\n    };\n  }\n\n  /**\n   * \n   */\n  private generateSkillsByOccupation(occupation?: string, attributes?: COC7Attributes): Map<string, number> {\n    const skills = new Map<string, number>();\n\n    // \n    const baseSkills = ['', '', '', '', '', '', '', ''];\n\n    // \n    baseSkills.forEach(skill => {\n      let value = 20; // \n\n      // \n      if (attributes) {\n        if (skill === '' && attributes.DEX) {\n          value = Math.floor(attributes.DEX / 2);\n        } else if (skill === '' && attributes.EDU) {\n          value = attributes.EDU;\n        } else if (skill === '' && attributes.INT) {\n          value = 20 + Math.floor((attributes.INT - 50) / 5);\n        } else if (skill === '' && attributes.INT) {\n          value = 25 + Math.floor((attributes.INT - 50) / 5);\n        }\n      }\n\n      skills.set(skill, Math.max(1, Math.min(99, value)));\n    });\n\n    // \n    if (occupation) {\n      const occupationSkills = this.getOccupationSkills(occupation);\n      occupationSkills.forEach(skill => {\n        // 40-70\n        const value = 40 + Math.floor(Math.random() * 31);\n        skills.set(skill, value);\n      });\n    }\n\n    return skills;\n  }\n\n  /**\n   * \n   */\n  private getOccupationSkills(occupation: string): string[] {\n    const occupationSkillsMap: Record<string, string[]> = {\n      : ['', '', '', '', '', ''],\n      : ['', '', '', '', ''],\n      : ['', '', '', '', ''],\n      : ['', '', '', ''],\n      : ['', '', '', '', '', ''],\n      : ['', '', '', '', ''],\n      : ['', '', '', '', ''],\n      : ['', '', '', '', ''],\n      : ['', '', '', '', '', ''],\n      : ['', '', '', ''],\n      : ['', '', '', ''],\n      : ['', '', '', '', ''],\n      : ['', '', '', ''],\n      : ['', '', '', ''],\n      : ['', '', ''],\n      : ['', '', ''],\n      : ['', '', '', '', '', ''],\n    };\n\n    return occupationSkillsMap[occupation] || ['', '', ''];\n  }\n\n  /**\n   * \n   */\n  private inferRelationship(text: string, characterName: string): string | undefined {\n    const relationshipKeywords: Record<string, string> = {\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n    };\n\n    for (const [keyword, relationship] of Object.entries(relationshipKeywords)) {\n      const pattern = new RegExp(`${characterName}.*?${keyword}|${keyword}.*?${characterName}`);\n      if (pattern.test(text)) {\n        return relationship;\n      }\n    }\n\n    return undefined;\n  }\n\n  /**\n   * NPC\n   * @param text NPC\n   * @param characterName NPC\n   * @returns NPC\n   */\n  generateNPC(text: string, characterName: string): NPCGenerationResult {\n    // 1. \n    const age = this.inferAge(text, characterName) || 25 + Math.floor(Math.random() * 30); // 25-55\n    const occupation = this.inferOccupation(text, characterName) || '';\n\n    // 2. \n    const attributes = this.inferAttributes(text, characterName, age);\n\n    // 3. \n    const derivedStats = this.calculateDerivedStats(attributes);\n\n    // 4. \n    const skills = this.generateSkillsByOccupation(occupation, attributes);\n\n    // 5. \n    const relationship = this.inferRelationship(text, characterName);\n\n    // 6. \n    let background = `${characterName}${age}${occupation}`;\n    if (relationship) background += `${relationship}`;\n    background += '';\n\n    return {\n      attributes,\n      derivedStats,\n      occupation,\n      age,\n      background,\n      skills,\n      relationship,\n    };\n  }\n}\n\n// \nexport const npcAnalysisService = new NPCAnalysisService();\n","// NPC  -  NPC \n\nimport type { CharacterInInstance } from '../types/instance';\n\n/**\n * NPC \n *  NPC \n */\nclass NPCAppearanceService {\n  /**\n   *  NPC \n   * @param npcs  NPC \n   * @returns \n   */\n  generateAppearancePrompt(npcs: CharacterInInstance[]): string {\n    if (!npcs || npcs.length === 0) {\n      return '';\n    }\n\n    // \n    const sortedNPCs = [...npcs].sort((a, b) => {\n      const importanceA = a.importance || (a.isImportant ? 3 : 2);\n      const importanceB = b.importance || (b.isImportant ? 3 : 2);\n      return importanceB - importanceA;\n    });\n\n    let prompt = '\\n';\n\n    for (const npcData of sortedNPCs) {\n      const importance = npcData.importance || (npcData.isImportant ? 3 : 2);\n      const frequency = this.getFrequencyDescription(importance);\n      const character = npcData.character;\n\n      prompt += `- ${character.name}${character.occupation || ''}${frequency}\\n`;\n      prompt += `  ${character.background || ''}\\n`;\n    }\n\n    prompt += '\\n';\n\n    return prompt;\n  }\n\n  /**\n   * \n   * @param importance 1-5\n   * @returns \n   */\n  private getFrequencyDescription(importance: number): string {\n    const descriptions: Record<number, string> = {\n      1: '',\n      2: '',\n      3: '',\n      4: '',\n      5: '',\n    };\n\n    return descriptions[importance] || descriptions[2];\n  }\n\n  /**\n   *  NPC \n   * @param npcData NPC \n   * @param sceneContext  NPC\n   * @returns \n   */\n  shouldNPCAppear(npcData: CharacterInInstance, sceneContext: string): boolean {\n    const importance = npcData.importance || (npcData.isImportant ? 3 : 2);\n    const character = npcData.character;\n\n    // \n    // 1=15%, 2=30%, 3=45%, 4=60%, 5=75%\n    const baseProbability = importance * 0.15;\n\n    //  NPC 30% \n    const mentionBonus = sceneContext.includes(character.name) ? 0.3 : 0;\n\n    //  NPC \n    const absenceBonus = this.calculateAbsenceBonus(npcData);\n\n    //  100%\n    const totalProbability = Math.min(1, baseProbability + mentionBonus + absenceBonus);\n\n    // \n    return Math.random() < totalProbability;\n  }\n\n  /**\n   * \n   *  NPC \n   * @param npcData NPC \n   * @returns 0-0.2\n   */\n  calculateAbsenceBonus(npcData: CharacterInInstance): number {\n    const importance = npcData.importance || (npcData.isImportant ? 3 : 2);\n    const appearanceCount = npcData.appearanceCount || 0;\n\n    // \n    //  1:  5 2:  10 3:  15 4:  20 5:  25 \n    const expectedAppearances = importance * 5;\n\n    //  50% 20% \n    if (appearanceCount < expectedAppearances * 0.5) {\n      return 0.2;\n    }\n\n    //  75% 10% \n    if (appearanceCount < expectedAppearances * 0.75) {\n      return 0.1;\n    }\n\n    return 0;\n  }\n\n  /**\n   *  NPC \n   * @param npcs NPC \n   * @returns \n   */\n  generateSimpleAppearancePrompt(npcs: CharacterInInstance[]): string {\n    if (!npcs || npcs.length === 0) {\n      return '';\n    }\n\n    const sortedNPCs = [...npcs].sort((a, b) => {\n      const importanceA = a.importance || (a.isImportant ? 3 : 2);\n      const importanceB = b.importance || (b.isImportant ? 3 : 2);\n      return importanceB - importanceA;\n    });\n\n    const npcList = sortedNPCs\n      .map(npcData => {\n        const importance = npcData.importance || (npcData.isImportant ? 3 : 2);\n        const stars = ''.repeat(importance);\n        return `${npcData.character.name}(${stars})`;\n      })\n      .join('');\n\n    return `${npcList}`;\n  }\n}\n\n// \nexport const npcAppearanceService = new NPCAppearanceService();\n","//  -  AI \n//  - \n\nimport { useInstanceStore } from '../stores/instanceStore';\nimport { eventRecordService } from './eventRecordService';\nimport { mvuService } from './mvuService';\nimport { npcAppearanceService } from './npcAppearanceService';\n\n/**\n * \n */\ninterface StreamCallbacks {\n  onIncremental?: (text: string) => void;\n  onComplete?: (text: string) => void;\n  onError?: (error: Error) => void;\n}\n\n/**\n * \n *  AI \n */\nclass StreamService {\n  private callbacks: StreamCallbacks = {};\n  private isStreaming = false;\n  private currentStreamText = '';\n\n  /**\n   * \n   * \n   */\n  setupStreamListeners(): void {\n    // \n    eventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY, (text: string) => {\n      this.handleIncrementalText(text);\n    });\n\n    // \n    eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY, (text: string) => {\n      this.handleFullText(text);\n    });\n\n    console.log('[Stream Service] ');\n  }\n\n  /**\n   * \n   */\n  private handleIncrementalText(text: string): void {\n    this.isStreaming = true;\n    this.currentStreamText = text;\n\n    // \n    if (this.callbacks.onIncremental) {\n      this.callbacks.onIncremental(text);\n    }\n  }\n\n  /**\n   * \n   */\n  private async handleFullText(text: string): Promise<void> {\n    try {\n      this.isStreaming = false;\n      this.currentStreamText = text;\n\n      //  NPC \n      await this.updateNPCAppearanceCounts(text);\n\n      // \n      await this.recordEvents(text);\n\n      // \n      if (this.callbacks.onComplete) {\n        this.callbacks.onComplete(text);\n      }\n    } catch (error) {\n      console.error('[Stream Service] :', error);\n      if (this.callbacks.onError) {\n        this.callbacks.onError(error as Error);\n      }\n    }\n  }\n\n  /**\n   *  NPC \n   *  AI  NPC \n   */\n  private async updateNPCAppearanceCounts(text: string): Promise<void> {\n    try {\n      const instanceStore = useInstanceStore();\n      const currentInstance = instanceStore.currentInstance;\n\n      if (!currentInstance || currentInstance.status !== 'active') {\n        return;\n      }\n\n      //  NPC\n      for (const npcData of currentInstance.characters) {\n        const character = npcData.character;\n\n        //  NPC \n        if (text.includes(character.name)) {\n          const currentCount = npcData.appearanceCount || 0;\n          npcData.appearanceCount = currentCount + 1;\n\n          console.log(`[Stream Service] NPC ${character.name} : ${npcData.appearanceCount}`);\n        }\n      }\n\n      //  instanceStore\n      await instanceStore.updateInstance(currentInstance.id, {\n        characters: currentInstance.characters,\n      });\n\n      //  MVU MVU \n      try {\n        if (mvuService) {\n          const gameData = await mvuService.loadGameData();\n          if (gameData.instances[currentInstance.id]) {\n            gameData.instances[currentInstance.id].characters = currentInstance.characters;\n            await mvuService.saveGameData(gameData);\n          }\n        }\n      } catch (mvuError) {\n        console.warn('[Stream Service]  MVU :', mvuError);\n      }\n    } catch (error) {\n      console.error('[Stream Service]  NPC :', error);\n      // \n    }\n  }\n\n  /**\n   * \n   *  AI \n   */\n  private async recordEvents(text: string): Promise<void> {\n    try {\n      const instanceStore = useInstanceStore();\n      const currentInstance = instanceStore.currentInstance;\n\n      if (!currentInstance || currentInstance.status !== 'active') {\n        return;\n      }\n\n      //  NPC ID \n      const currentNPCs = currentInstance.characters\n        .filter(npcData => text.includes(npcData.character.name))\n        .map(npcData => npcData.characterId);\n\n      // \n      await eventRecordService.recordEventFromAIOutput(currentInstance.id, text, currentNPCs);\n\n      //  MVU MVU \n      try {\n        if (mvuService) {\n          const gameData = await mvuService.loadGameData();\n          if (gameData.instances[currentInstance.id]) {\n            gameData.instances[currentInstance.id].events = currentInstance.events;\n            await mvuService.saveGameData(gameData);\n          }\n        }\n      } catch (mvuError) {\n        console.warn('[Stream Service]  MVU :', mvuError);\n      }\n    } catch (error) {\n      console.error('[Stream Service] :', error);\n      // \n    }\n  }\n\n  /**\n   * \n   * @param message \n   */\n  async sendMessage(message: string): Promise<void> {\n    try {\n      console.log('[Stream Service] :', message);\n\n      //  AI  NPC \n      await this.injectNPCAppearancePrompt();\n\n      //  generate  AI \n      await generate({\n        user_input: message,\n        should_stream: true,\n      });\n\n      console.log('[Stream Service]  AI ');\n    } catch (error) {\n      console.error('[Stream Service] :', error);\n      toastr.error('');\n      if (this.callbacks.onError) {\n        this.callbacks.onError(error as Error);\n      }\n    }\n  }\n\n  /**\n   *  NPC \n   *  AI  NPC \n   */\n  private async injectNPCAppearancePrompt(): Promise<void> {\n    try {\n      const instanceStore = useInstanceStore();\n      const currentInstance = instanceStore.currentInstance;\n\n      // \n      if (!currentInstance || currentInstance.status !== 'active') {\n        return;\n      }\n\n      //  NPC\n      if (!currentInstance.characters || currentInstance.characters.length === 0) {\n        return;\n      }\n\n      //  NPC \n      const appearancePrompt = npcAppearanceService.generateAppearancePrompt(currentInstance.characters);\n\n      if (!appearancePrompt) {\n        return;\n      }\n\n      console.log('[Stream Service]  NPC ');\n\n      //  injectPrompts \n      injectPrompts(\n        [\n          {\n            id: 'npc_appearance_control',\n            content: appearancePrompt,\n            position: 'in_chat',\n            depth: 4,\n            role: 'system',\n          },\n        ],\n        { once: true },\n      );\n    } catch (error) {\n      console.error('[Stream Service]  NPC :', error);\n      // \n    }\n  }\n\n  /**\n   * \n   */\n  setCallbacks(callbacks: StreamCallbacks): void {\n    this.callbacks = callbacks;\n    console.log('[Stream Service] ');\n  }\n\n  /**\n   * \n   */\n  clearCallbacks(): void {\n    this.callbacks = {};\n    console.log('[Stream Service] ');\n  }\n\n  /**\n   * \n   */\n  getIsStreaming(): boolean {\n    return this.isStreaming;\n  }\n\n  /**\n   * \n   */\n  getCurrentText(): string {\n    return this.currentStreamText;\n  }\n\n  /**\n   * \n   */\n  async generatePlotBasedOnRoll(rollResult: string, skillName: string, action: string): Promise<void> {\n    try {\n      const prompt = `${action}${skillName}${rollResult}`;\n\n      await this.sendMessage(prompt);\n    } catch (error) {\n      console.error('[Stream Service] :', error);\n      toastr.error('');\n    }\n  }\n\n  /**\n   * \n   */\n  async generateAreaEvent(areaName: string): Promise<void> {\n    try {\n      const prompt = `${areaName}`;\n\n      await this.sendMessage(prompt);\n    } catch (error) {\n      console.error('[Stream Service] :', error);\n      toastr.error('');\n    }\n  }\n}\n\n// \nexport const streamService = new StreamService();\n","//  - \n\n/**\n * \n */\nexport interface Paragraph {\n  content: string; // \n}\n\n/**\n * \n * \n */\nfunction isDialogueQuote(content: string): boolean {\n  //    \n  return /[]$|\\.{2,}$|+$/.test(content);\n}\n\n/**\n *  MVU \n *\n * \n * \n * \n * 1. \n * 2.  MVU NPC \n */\nexport function cleanTextContent(text: string): string {\n  let cleaned = text;\n\n  // \n  //  YAML  (```yaml ... ```)\n  cleaned = cleaned.replace(/```yaml[\\s\\S]*?```/gi, '');\n\n  //  JSON  (```json ... ```)\n  cleaned = cleaned.replace(/```json[\\s\\S]*?```/gi, '');\n\n  //  (``` ... ```)\n  cleaned = cleaned.replace(/```[\\s\\S]*?```/g, '');\n\n  //  (`...`)\n  cleaned = cleaned.replace(/`[^`]+`/g, '');\n\n  //  {{...}}  MVU \n  cleaned = cleaned.replace(/\\{\\{[\\s\\S]*?\\}\\}/g, '');\n\n  //  HTML \n  cleaned = cleaned.replace(/<[^>]+>/g, '');\n\n  // \n  //  - \n  cleaned = cleaned.replace(/([^\\n])\"([^\"]+)\"(?!\\n)/g, (match, before, content) => {\n    console.log('[textParser] :', match.substring(0, 50));\n    console.log('[textParser] :', before);\n    console.log('[textParser] :', content);\n    console.log('[textParser] :', isDialogueQuote(content));\n    if (isDialogueQuote(content)) {\n      const result = `${before}\\n\"${content}\"\\n`;\n      console.log('[textParser] :', result.substring(0, 50));\n      return result;\n    }\n    return match;\n  });\n\n  // \n  cleaned = cleaned.replace(/([^\\n])([^]+)(?!\\n)/g, (match, before, content) => {\n    if (isDialogueQuote(content)) {\n      return `${before}\\n${content}\\n`;\n    }\n    return match;\n  });\n\n  // \n  cleaned = cleaned.replace(/([^\\n])([^]+)(?!\\n)/g, (match, before, content) => {\n    if (isDialogueQuote(content)) {\n      return `${before}\\n${content}\\n`;\n    }\n    return match;\n  });\n\n  // \n  cleaned = cleaned.trim();\n\n  return cleaned;\n}\n\n/**\n * \n * @param paragraph \n * @param maxLength \n * @returns \n */\nfunction splitParagraphByLength(paragraph: string, maxLength: number): string[] {\n  const result: string[] = [];\n\n  // \n  if (paragraph.length <= maxLength) {\n    result.push(paragraph);\n    return result;\n  }\n\n  // \n  let start = 0;\n  while (start < paragraph.length) {\n    let end = start + maxLength;\n\n    // \n    if (end < paragraph.length) {\n      //  > / > / > \n      const strongPunctuation = /[.!?]/;\n      const weakPunctuation = /[,;]/;\n      const space = /\\s/;\n\n      let bestBreak = -1;\n      let breakType = 0; // 0: , 1: , 2: , 3: \n\n      // \n      // 60% - 130% \n      const searchStart = Math.max(start + Math.floor(maxLength * 0.6), start + 50);\n      const searchEnd = Math.min(end + Math.floor(maxLength * 0.3), paragraph.length);\n\n      for (let i = searchStart; i < searchEnd; i++) {\n        if (strongPunctuation.test(paragraph[i]) && breakType < 3) {\n          bestBreak = i + 1;\n          breakType = 3;\n        } else if (weakPunctuation.test(paragraph[i]) && breakType < 2) {\n          bestBreak = i + 1;\n          breakType = 2;\n        } else if (space.test(paragraph[i]) && breakType < 1) {\n          bestBreak = i + 1;\n          breakType = 1;\n        }\n      }\n\n      // \n      if (bestBreak > start) {\n        end = bestBreak;\n      }\n    }\n\n    const segment = paragraph.slice(start, end).trim();\n    if (segment) {\n      result.push(segment);\n    }\n    start = end;\n  }\n\n  return result;\n}\n\n/**\n * \n * 33vh\n *\n * \n * 1. \n * 2. \n *\n * @param text \n * @returns \n */\nexport function splitIntoParagraphs(text: string): string[] {\n  // \n  const cleaned = cleanTextContent(text);\n\n  // \n  // 33vh 1/3padding150-300\n  const baseLength = 250; // \n  const mobileLength = 180; // \n\n  // \n  const isMobile = typeof window !== 'undefined' && window.innerWidth < 768;\n  const maxLength = isMobile ? mobileLength : baseLength;\n\n  // \n  const naturalParagraphs = cleaned\n    .split('\\n')\n    .map(p => p.trim())\n    .filter(p => p.length > 0);\n\n  // \n  const result: string[] = [];\n  for (const paragraph of naturalParagraphs) {\n    const subParagraphs = splitParagraphByLength(paragraph, maxLength);\n    result.push(...subParagraphs);\n  }\n\n  return result;\n}\n\n/**\n * \n * \n */\nexport function parseTextIntoParagraphs(text: string): Paragraph[] {\n  const paragraphTexts = splitIntoParagraphs(text);\n  return paragraphTexts.map(content => ({ content }));\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, vModelText as _vModelText, withModifiers as _withModifiers, withKeys as _withKeys, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n    key: 0,\n    class: \"dialogue-content\"\n};\nconst _hoisted_2 = {\n    key: 0,\n    class: \"continue-hint\"\n};\nconst _hoisted_3 = {\n    key: 1,\n    class: \"dialogue-placeholder\"\n};\nconst _hoisted_4 = {\n    key: 0,\n    class: \"custom-input-container\"\n};\nconst _hoisted_5 = [\"onKeydown\"];\nconst _hoisted_6 = [\"disabled\"];\nconst _hoisted_7 = { key: 0 };\nconst _hoisted_8 = { key: 1 };\nimport { nextTick, onBeforeUnmount, onMounted, ref, watch } from 'vue';\nimport { npcAnalysisService } from '../services/npcAnalysisService';\nimport { streamService } from '../services/streamService';\nimport { useCharacterStore } from '../stores/characterStore';\nimport { useGameStore } from '../stores/gameStore';\nimport { useInstanceStore } from '../stores/instanceStore';\nimport { parseTextIntoParagraphs } from '../utils/textParser';\n// ==================== Store ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'DialogueBox',\n    emits: [\"newMessage\"],\n    setup(__props, { expose: __expose, emit: __emit }) {\n        const gameStore = useGameStore();\n        const characterStore = useCharacterStore();\n        const instanceStore = useInstanceStore();\n        // ==================== Emits ====================\n        const emit = __emit;\n        // ====================  ====================\n        const isClosed = ref(false);\n        const currentText = ref('');\n        const displayText = ref('');\n        const dialogueTextRef = ref(null);\n        const dialogueDisplayRef = ref(null);\n        const customUserInput = ref('');\n        const isCustomSending = ref(false);\n        const customInputRef = ref(null);\n        //  AI \n        const showInputBox = ref(false);\n        // \n        const paragraphs = ref([]);\n        const currentParagraphIndex = ref(0);\n        // \n        const savedState = ref(null);\n        // ====================  ====================\n        // const hasDialogue = computed(() => currentDialogue.value !== null);\n        // ====================  ====================\n        //  closeDialogue /\n        /**\n         * \n         * \n         */\n        function openDialogue() {\n            isClosed.value = false;\n            // \n            if (savedState.value) {\n                currentText.value = savedState.value.currentText;\n                displayText.value = savedState.value.displayText;\n                paragraphs.value = savedState.value.paragraphs;\n                currentParagraphIndex.value = savedState.value.currentParagraphIndex;\n                console.log('[DialogueBox] ');\n            }\n        }\n        /**\n         * \n         * \n         * \n         */\n        function handleBoxClick() {\n            if (gameStore.isStreaming) {\n                return;\n            }\n            // \n            if (currentParagraphIndex.value < paragraphs.value.length - 1) {\n                currentParagraphIndex.value++;\n                showCurrentParagraph();\n            }\n            else {\n                // \n                showInputBox.value = true;\n                // \n                nextTick(() => {\n                    customInputRef.value?.focus();\n                });\n            }\n        }\n        // \n        __expose({\n            openDialogue,\n        });\n        /**\n         * \n         */\n        function scrollToBottom() {\n            //  nextTick  DOM \n            nextTick(() => {\n                //  nextTick \n                nextTick(() => {\n                    if (dialogueDisplayRef.value) {\n                        dialogueDisplayRef.value.scrollTop = dialogueDisplayRef.value.scrollHeight;\n                        console.log('[DialogueBox] scrollHeight:', dialogueDisplayRef.value.scrollHeight);\n                    }\n                });\n            });\n        }\n        /**\n         * \n         */\n        function showCurrentParagraph() {\n            if (currentParagraphIndex.value >= paragraphs.value.length) {\n                return;\n            }\n            const paragraph = paragraphs.value[currentParagraphIndex.value];\n            // \n            if (paragraph.content) {\n                displayText.value = paragraph.content;\n                // \n                scrollToBottom();\n            }\n        }\n        /**\n         * AINPC\n         * AI{{NPC_CREATE:}}NPC\n         */\n        async function processNPCCreation(text) {\n            if (!text)\n                return;\n            // NPC\n            const npcCreatePattern = /\\{\\{NPC_CREATE:([^}]+)\\}\\}/g;\n            const npcNames = [];\n            let match;\n            while ((match = npcCreatePattern.exec(text)) !== null) {\n                npcNames.push(match[1].trim());\n            }\n            if (npcNames.length === 0)\n                return;\n            const isInInstance = gameStore.currentInstanceId !== undefined;\n            for (const name of npcNames) {\n                try {\n                    const existingNPC = characterStore.npcList.find(npc => npc.name === name);\n                    if (existingNPC) {\n                        // NPC\n                        if (isInInstance && gameStore.currentInstanceId) {\n                            const instance = instanceStore.getInstance(gameStore.currentInstanceId);\n                            const inInstance = instance?.characters.some(c => c.characterId === existingNPC.id);\n                            if (!inInstance) {\n                                await instanceStore.addCharacterToInstance(gameStore.currentInstanceId, existingNPC, false);\n                                toastr.info(`${name} `);\n                            }\n                        }\n                    }\n                    else {\n                        // NPC\n                        const npcData = npcAnalysisService.generateNPC(text, name);\n                        const newNPC = {\n                            id: `npc_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`,\n                            type: 'npc',\n                            name,\n                            age: npcData.age,\n                            occupation: npcData.occupation,\n                            background: npcData.background,\n                            relationship: npcData.relationship,\n                            attributes: npcData.attributes,\n                            derivedStats: npcData.derivedStats,\n                            skills: npcData.skills,\n                            bodyParts: [],\n                            inventory: [],\n                            affection: 50,\n                            isImportant: false,\n                            events: [],\n                        };\n                        await characterStore.addNPC(newNPC);\n                        if (isInInstance && gameStore.currentInstanceId) {\n                            await instanceStore.addCharacterToInstance(gameStore.currentInstanceId, newNPC, false);\n                        }\n                        const info = [npcData.occupation, `${npcData.age}`];\n                        if (npcData.relationship)\n                            info.push(npcData.relationship);\n                        toastr.success(` ${name}${info.join('')}`);\n                    }\n                }\n                catch (error) {\n                    console.error(`[DialogueBox]  ${name} :`, error);\n                    toastr.error(` ${name} `);\n                }\n            }\n        }\n        /**\n         * \n         * \n         */\n        async function showText(text) {\n            // \n            showInputBox.value = false;\n            // \n            currentText.value = text;\n            // NPC- \n            await processNPCCreation(text);\n            // \n            paragraphs.value = parseTextIntoParagraphs(text);\n            currentParagraphIndex.value = 0;\n            // \n            console.log('[DialogueBox] :', text.substring(0, 100) + '...');\n            console.log('[DialogueBox] :', paragraphs.value.length);\n            paragraphs.value.forEach((p, i) => {\n                console.log(`[DialogueBox]  ${i + 1}:`, p.content.substring(0, 50) + (p.content.length > 50 ? '...' : ''));\n            });\n            // \n            if (paragraphs.value.length > 0) {\n                showCurrentParagraph();\n                // \n                scrollToBottom();\n            }\n            else {\n                console.warn('[DialogueBox] ');\n            }\n        }\n        /**\n         * \n         * \n         */\n        async function showTextInstantly(text) {\n            // \n            showInputBox.value = false;\n            // \n            currentText.value = text;\n            // NPC- \n            await processNPCCreation(text);\n            // \n            paragraphs.value = parseTextIntoParagraphs(text);\n            currentParagraphIndex.value = 0;\n            // \n            console.log('[DialogueBox] :', text.substring(0, 100) + '...');\n            console.log('[DialogueBox] :', paragraphs.value.length);\n            paragraphs.value.forEach((p, i) => {\n                console.log(`[DialogueBox]  ${i + 1}:`, p.content.substring(0, 50) + (p.content.length > 50 ? '...' : ''));\n            });\n            // \n            if (paragraphs.value.length > 0) {\n                const paragraph = paragraphs.value[0];\n                displayText.value = paragraph.content;\n                // \n                scrollToBottom();\n                // \n                if (paragraphs.value.length === 1) {\n                    showInputBox.value = true;\n                    nextTick(() => {\n                        customInputRef.value?.focus();\n                    });\n                }\n            }\n            else {\n                console.warn('[DialogueBox] ');\n                displayText.value = '';\n            }\n        }\n        /**\n         *  AI \n         */\n        async function loadLatestMessage() {\n            try {\n                console.log('[DialogueBox] ...');\n                // \n                const lastMessages = getChatMessages(-1);\n                if (lastMessages && lastMessages.length > 0) {\n                    const lastMessage = lastMessages[0];\n                    console.log('[DialogueBox] :', {\n                        role: lastMessage.role,\n                        message_id: lastMessage.message_id,\n                        content: lastMessage.message.substring(0, 50) + '...',\n                    });\n                    //  AI assistant  system\n                    if ((lastMessage.role === 'assistant' || lastMessage.role === 'system') && lastMessage.message) {\n                        console.log('[DialogueBox]  AI ');\n                        //  -  NPC \n                        await showTextInstantly(lastMessage.message);\n                    }\n                    else if (lastMessage.role === 'user') {\n                        // \n                        console.log('[DialogueBox]  AI ');\n                        currentText.value = ' AI ...';\n                        displayText.value = ' AI ...';\n                    }\n                }\n                else {\n                    console.log('[DialogueBox] ');\n                    currentText.value = '';\n                    displayText.value = '';\n                }\n                // \n                scrollToBottom();\n            }\n            catch (error) {\n                console.error('[DialogueBox] :', error);\n            }\n        }\n        /**\n         * \n         * \n         */\n        function setupStreamCallbacks() {\n            console.log('[DialogueBox] ');\n            streamService.setCallbacks({\n                onIncremental: async (text) => {\n                    console.log('[DialogueBox] :', text.length);\n                    // \n                    if (text && text.trim()) {\n                        await showText(text);\n                        // \n                        emit('newMessage');\n                        // \n                        if (isClosed.value) {\n                            console.log('[DialogueBox] ');\n                            isClosed.value = false;\n                        }\n                    }\n                },\n                onComplete: async (text) => {\n                    console.log('[DialogueBox] :', text.length);\n                    // \n                    if (text && text.trim()) {\n                        await showTextInstantly(text);\n                        // \n                        emit('newMessage');\n                        // \n                        if (isClosed.value) {\n                            console.log('[DialogueBox] ');\n                            isClosed.value = false;\n                        }\n                    }\n                },\n                onError: (error) => {\n                    console.error('[DialogueBox] :', error);\n                    toastr.error('');\n                },\n            });\n        }\n        /**\n         * \n         * \n         */\n        async function handleCustomSend() {\n            if (!customUserInput.value.trim() || isCustomSending.value)\n                return;\n            const message = customUserInput.value.trim();\n            try {\n                isCustomSending.value = true;\n                console.log('[DialogueBox] :', message);\n                // \n                const $tavernTextarea = $('#send_textarea', window.parent.document);\n                const $sendButton = $('#send_but', window.parent.document);\n                if ($tavernTextarea.length > 0 && $sendButton.length > 0) {\n                    // 1. \n                    $tavernTextarea.val(message);\n                    //  input \n                    $tavernTextarea.trigger('input');\n                    console.log('[DialogueBox] ');\n                    // 2. \n                    customUserInput.value = '';\n                    showInputBox.value = false;\n                    // 3. \n                    currentText.value = ' AI ...';\n                    displayText.value = ' AI ...';\n                    // 4. \n                    $sendButton.trigger('click');\n                    console.log('[DialogueBox] ');\n                }\n                else {\n                    console.error('[DialogueBox] ');\n                    toastr.error('');\n                    // \n                    customUserInput.value = message;\n                }\n            }\n            catch (error) {\n                console.error('[DialogueBox] :', error);\n                toastr.error('');\n                // \n                customUserInput.value = message;\n            }\n            finally {\n                isCustomSending.value = false;\n            }\n        }\n        // ====================  ====================\n        onMounted(async () => {\n            console.log('[DialogueBox] ');\n            // \n            setupStreamCallbacks();\n            // \n            await loadLatestMessage();\n            console.log('[DialogueBox] ');\n        });\n        // \n        watch(() => gameStore.mode, (newMode, oldMode) => {\n            console.log('[DialogueBox] :', oldMode, '->', newMode);\n            if (newMode === 'main' && oldMode !== 'main') {\n                console.log('[DialogueBox] ');\n                setupStreamCallbacks();\n            }\n        });\n        // ====================  ====================\n        onBeforeUnmount(() => {\n            console.log('[DialogueBox] ');\n            //  streamService \n            // 1. DialogueBox \n            // 2.  SanctuaryView\n            // 3. \n            console.log('[DialogueBox] ');\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", null, [\n                (!isClosed.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"dialogue-box\",\n                        onClick: handleBoxClick\n                    }, [\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", {\n                            ref_key: \"dialogueDisplayRef\",\n                            ref: dialogueDisplayRef,\n                            class: \"dialogue-display\"\n                        }, [\n                            (currentText.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                                    _createElementVNode(\"div\", {\n                                        ref_key: \"dialogueTextRef\",\n                                        ref: dialogueTextRef,\n                                        class: \"dialogue-text\"\n                                    }, _toDisplayString(displayText.value), 513 /* TEXT, NEED_PATCH */),\n                                    (currentParagraphIndex.value < paragraphs.value.length - 1)\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"\"))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ]))\n                                : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [...(_cache[1] || (_cache[1] = [\n                                        _createElementVNode(\"p\", null, \"\", -1 /* CACHED */),\n                                        _createElementVNode(\"p\", { class: \"hint\" }, \"...\", -1 /* CACHED */)\n                                    ]))]))\n                        ], 512 /* NEED_PATCH */),\n                        _createCommentVNode(\"  -  AI  \"),\n                        (showInputBox.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [\n                                _withDirectives(_createElementVNode(\"textarea\", {\n                                    ref_key: \"customInputRef\",\n                                    ref: customInputRef,\n                                    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((customUserInput).value = $event)),\n                                    class: \"custom-input-field\",\n                                    placeholder: \"...\",\n                                    onKeydown: _withKeys(_withModifiers(handleCustomSend, [\"ctrl\"]), [\"enter\"])\n                                }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_5), [\n                                    [_vModelText, customUserInput.value]\n                                ]),\n                                _createElementVNode(\"button\", {\n                                    class: \"custom-send-button\",\n                                    disabled: !customUserInput.value.trim() || isCustomSending.value,\n                                    onClick: handleCustomSend\n                                }, [\n                                    (!isCustomSending.value)\n                                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_7, \"\"))\n                                        : (_openBlock(), _createElementBlock(\"span\", _hoisted_8, \"...\"))\n                                ], 8 /* PROPS */, _hoisted_6)\n                            ]))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./DialogueBox.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./DialogueBox.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./DialogueBox.vue?vue&type=style&index=0&id=528d5549&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-528d5549\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, vModelSelect as _vModelSelect, withDirectives as _withDirectives, unref as _unref, normalizeClass as _normalizeClass, Transition as _Transition, withCtx as _withCtx, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = { class: \"skill-selection\" };\nconst _hoisted_2 = [\"disabled\"];\nconst _hoisted_3 = [\"value\"];\nconst _hoisted_4 = { class: \"roll-actions\" };\nconst _hoisted_5 = [\"disabled\"];\nconst _hoisted_6 = [\"disabled\"];\nconst _hoisted_7 = {\n    key: 0,\n    class: \"roll-result\"\n};\nconst _hoisted_8 = { class: \"dice-value\" };\nconst _hoisted_9 = { class: \"result-info\" };\nconst _hoisted_10 = { class: \"result-details\" };\nconst _hoisted_11 = [\"disabled\"];\nimport { computed, ref } from 'vue';\nimport { coc7Service } from '../services/coc7Service';\nimport { streamService } from '../services/streamService';\nimport { useCharacterStore } from '../stores/characterStore';\nimport * as animation from '../utils/animation';\nimport { getRollResultText } from '../utils/coc7Rules';\n// ==================== Stores ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'DiceRoller',\n    emits: [\"close\"],\n    setup(__props, { emit: __emit }) {\n        const characterStore = useCharacterStore();\n        // ====================  ====================\n        const selectedSkill = ref('');\n        const lastRoll = ref(null);\n        const isRolling = ref(false);\n        const isGenerating = ref(false);\n        const userAction = ref(''); // \n        // ==================== Refs ====================\n        const rollButtonRef = ref();\n        const rerollButtonRef = ref();\n        const generateButtonRef = ref();\n        const diceDisplayRef = ref();\n        // ====================  ====================\n        /**\n         * \n         * \n         */\n        const availableSkills = computed(() => {\n            if (!characterStore.player) {\n                return [];\n            }\n            const skills = [];\n            //  Map \n            if (characterStore.player.skills instanceof Map) {\n                characterStore.player.skills.forEach((value, name) => {\n                    skills.push({ name, value });\n                });\n            }\n            else if (characterStore.player.skills && typeof characterStore.player.skills === 'object') {\n                // \n                Object.entries(characterStore.player.skills).forEach(([name, value]) => {\n                    skills.push({ name, value: value });\n                });\n            }\n            // \n            if (skills.length === 0) {\n                skills.push({ name: '', value: 50 }, { name: '', value: 50 }, { name: '', value: 50 }, { name: '', value: 50 }, { name: '', value: 50 }, { name: '', value: 50 });\n            }\n            // \n            return skills.sort((a, b) => a.name.localeCompare(b.name));\n        });\n        // ====================  ====================\n        /**\n         * \n         */\n        async function performRoll() {\n            if (!selectedSkill.value || isRolling.value) {\n                return;\n            }\n            try {\n                isRolling.value = true;\n                // \n                const skillValue = availableSkills.value.find(s => s.name === selectedSkill.value)?.value || 50;\n                // \n                if (rollButtonRef.value) {\n                    animation.buttonClickFeedback(rollButtonRef.value);\n                }\n                //  - \n                if (diceDisplayRef.value) {\n                    // \n                    const animationDuration = 1;\n                    const frameCount = 20;\n                    const frameDuration = animationDuration / frameCount;\n                    for (let i = 0; i < frameCount; i++) {\n                        await new Promise(resolve => setTimeout(resolve, frameDuration * 1000));\n                        if (diceDisplayRef.value) {\n                            const randomValue = Math.floor(Math.random() * 100) + 1;\n                            diceDisplayRef.value.querySelector('.dice-value').textContent = randomValue.toString();\n                        }\n                    }\n                }\n                // \n                const roll = coc7Service.performSkillCheck(selectedSkill.value, skillValue);\n                lastRoll.value = roll;\n                // \n                if (diceDisplayRef.value) {\n                    const diceValue = diceDisplayRef.value.querySelector('.dice-value');\n                    if (diceValue) {\n                        diceValue.textContent = roll.roll.toString();\n                        // \n                        if (roll.result === 'critical_success') {\n                            animation.shake(diceDisplayRef.value, 15, 0.5);\n                        }\n                        else if (roll.result === 'critical_failure') {\n                            animation.shake(diceDisplayRef.value, 20, 0.8);\n                        }\n                    }\n                }\n                console.log('[Dice Roller] :', roll);\n                toastr.info(`${selectedSkill.value} : ${getRollResultText(roll.result)}`);\n            }\n            catch (error) {\n                console.error('[Dice Roller] :', error);\n                toastr.error('');\n            }\n            finally {\n                isRolling.value = false;\n            }\n        }\n        /**\n         * \n         */\n        async function reroll() {\n            if (rerollButtonRef.value) {\n                animation.buttonClickFeedback(rerollButtonRef.value);\n            }\n            // \n            lastRoll.value = null;\n            // \n            await new Promise(resolve => setTimeout(resolve, 200));\n            await performRoll();\n        }\n        /**\n         * \n         */\n        async function generatePlot() {\n            if (!lastRoll.value || isGenerating.value) {\n                return;\n            }\n            try {\n                isGenerating.value = true;\n                if (generateButtonRef.value) {\n                    animation.buttonClickFeedback(generateButtonRef.value);\n                }\n                // \n                const resultText = getRollResultText(lastRoll.value.result);\n                const skillName = lastRoll.value.skillName || selectedSkill.value;\n                // \n                await streamService.generatePlotBasedOnRoll(resultText, skillName, userAction.value || '');\n                console.log('[Dice Roller] ');\n                toastr.success('');\n                // \n                await new Promise(resolve => setTimeout(resolve, 500));\n                // \n                emit('close');\n            }\n            catch (error) {\n                console.error('[Dice Roller] :', error);\n                toastr.error('');\n            }\n            finally {\n                isGenerating.value = false;\n            }\n        }\n        // ==================== Emits ====================\n        const emit = __emit;\n        // ====================  ====================\n        // \n        if (availableSkills.value.length > 0) {\n            selectedSkill.value = availableSkills.value[0].name;\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"dice-roller\", { 'is-rolling': isRolling.value }])\n            }, [\n                _createCommentVNode(\"  \"),\n                _cache[2] || (_cache[2] = _createElementVNode(\"div\", { class: \"roller-header\" }, [\n                    _createElementVNode(\"h3\", null, \"\")\n                ], -1 /* CACHED */)),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_1, [\n                    _cache[1] || (_cache[1] = _createElementVNode(\"label\", { for: \"skill-select\" }, \"\", -1 /* CACHED */)),\n                    _withDirectives(_createElementVNode(\"select\", {\n                        id: \"skill-select\",\n                        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((selectedSkill).value = $event)),\n                        disabled: isRolling.value\n                    }, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(availableSkills.value, (skill) => {\n                            return (_openBlock(), _createElementBlock(\"option\", {\n                                key: skill.name,\n                                value: skill.name\n                            }, _toDisplayString(skill.name) + \" (\" + _toDisplayString(skill.value) + \") \", 9 /* TEXT, PROPS */, _hoisted_3));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ], 8 /* PROPS */, _hoisted_2), [\n                        [_vModelSelect, selectedSkill.value]\n                    ])\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_4, [\n                    _createElementVNode(\"button\", {\n                        ref_key: \"rollButtonRef\",\n                        ref: rollButtonRef,\n                        class: \"btn-roll\",\n                        disabled: !selectedSkill.value || isRolling.value,\n                        onClick: performRoll\n                    }, _toDisplayString(isRolling.value ? '...' : ''), 9 /* TEXT, PROPS */, _hoisted_5),\n                    (lastRoll.value)\n                        ? (_openBlock(), _createElementBlock(\"button\", {\n                            key: 0,\n                            ref_key: \"rerollButtonRef\",\n                            ref: rerollButtonRef,\n                            class: \"btn-reroll\",\n                            disabled: isRolling.value,\n                            onClick: reroll\n                        }, \"  \", 8 /* PROPS */, _hoisted_6))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _createCommentVNode(\"  \"),\n                _createVNode(_Transition, { name: \"fade\" }, {\n                    default: _withCtx(() => [\n                        (lastRoll.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [\n                                _createElementVNode(\"div\", {\n                                    ref_key: \"diceDisplayRef\",\n                                    ref: diceDisplayRef,\n                                    class: \"dice-display\"\n                                }, [\n                                    _createElementVNode(\"div\", _hoisted_8, _toDisplayString(lastRoll.value.roll), 1 /* TEXT */)\n                                ], 512 /* NEED_PATCH */),\n                                _createElementVNode(\"div\", _hoisted_9, [\n                                    _createElementVNode(\"div\", {\n                                        class: _normalizeClass([\"result-level\", `result-${lastRoll.value.result}`])\n                                    }, _toDisplayString(_unref(getRollResultText)(lastRoll.value.result)), 3 /* TEXT, CLASS */),\n                                    _createElementVNode(\"div\", _hoisted_10, [\n                                        _createElementVNode(\"span\", null, \": \" + _toDisplayString(lastRoll.value.skill), 1 /* TEXT */),\n                                        _createElementVNode(\"span\", null, \": \" + _toDisplayString(lastRoll.value.roll), 1 /* TEXT */)\n                                    ])\n                                ]),\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"button\", {\n                                    ref_key: \"generateButtonRef\",\n                                    ref: generateButtonRef,\n                                    class: \"btn-generate\",\n                                    disabled: isGenerating.value,\n                                    onClick: generatePlot\n                                }, _toDisplayString(isGenerating.value ? '...' : ''), 9 /* TEXT, PROPS */, _hoisted_11)\n                            ]))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _: 1 /* STABLE */\n                })\n            ], 2 /* CLASS */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./DiceRoller.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./DiceRoller.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./DiceRoller.vue?vue&type=style&index=0&id=6a8485b2&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6a8485b2\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, vModelSelect as _vModelSelect, withDirectives as _withDirectives, vModelText as _vModelText, createStaticVNode as _createStaticVNode } from \"vue\";\nconst _hoisted_1 = { class: \"instance-generator\" };\nconst _hoisted_2 = { class: \"generator-container\" };\nconst _hoisted_3 = { class: \"generator-content\" };\nconst _hoisted_4 = { class: \"form-group\" };\nconst _hoisted_5 = { class: \"difficulty-selector\" };\nconst _hoisted_6 = [\"onClick\"];\nconst _hoisted_7 = { class: \"form-group\" };\nconst _hoisted_8 = { class: \"form-group\" };\nconst _hoisted_9 = { class: \"form-group npc-management\" };\nconst _hoisted_10 = { class: \"npc-list\" };\nconst _hoisted_11 = {\n    key: 0,\n    class: \"npc-empty\"\n};\nconst _hoisted_12 = { class: \"npc-info\" };\nconst _hoisted_13 = { class: \"npc-name\" };\nconst _hoisted_14 = { class: \"npc-occupation\" };\nconst _hoisted_15 = { class: \"npc-controls\" };\nconst _hoisted_16 = [\"onUpdate:modelValue\"];\nconst _hoisted_17 = [\"onClick\"];\nconst _hoisted_18 = { class: \"npc-actions\" };\nconst _hoisted_19 = [\"disabled\"];\nconst _hoisted_20 = { key: 0 };\nconst _hoisted_21 = { key: 1 };\nconst _hoisted_22 = [\"disabled\"];\nconst _hoisted_23 = { class: \"button-group\" };\nconst _hoisted_24 = [\"disabled\"];\nconst _hoisted_25 = { key: 0 };\nconst _hoisted_26 = { key: 1 };\nconst _hoisted_27 = [\"disabled\"];\nconst _hoisted_28 = { key: 0 };\nconst _hoisted_29 = { key: 1 };\nconst _hoisted_30 = {\n    key: 0,\n    class: \"generation-progress\"\n};\nconst _hoisted_31 = { class: \"progress-text\" };\nconst _hoisted_32 = {\n    key: 1,\n    class: \"generation-result\"\n};\nconst _hoisted_33 = { class: \"result-success\" };\nconst _hoisted_34 = {\n    key: 0,\n    class: \"custom-npc-dialog\"\n};\nconst _hoisted_35 = { class: \"dialog-content\" };\nconst _hoisted_36 = { class: \"dialog-actions\" };\nconst _hoisted_37 = [\"disabled\"];\nconst _hoisted_38 = { key: 0 };\nconst _hoisted_39 = { key: 1 };\nimport { onMounted, ref } from 'vue';\nimport { npcGenerationService } from '../services/npcGenerationService';\nimport { useGameStore } from '../stores/gameStore';\nimport * as animation from '../utils/animation';\n// ==================== Props & Emits ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'InstanceGenerator',\n    emits: [\"close\"],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        // ====================  ====================\n        const gameStore = useGameStore();\n        const difficulty = ref(3);\n        const instanceType = ref('');\n        const customPrompt = ref('');\n        const isGenerating = ref(false);\n        const progressText = ref('');\n        const generatedInstanceId = ref('');\n        // NPC \n        const npcs = ref([]);\n        const isGeneratingNPC = ref(false);\n        const showCustomDialog = ref(false);\n        const customNPCPrompt = ref('');\n        // Button refs\n        const closeButtonRef = ref(null);\n        const randomButtonRef = ref(null);\n        const customButtonRef = ref(null);\n        const enterButtonRef = ref(null);\n        const randomNPCButtonRef = ref(null);\n        const customNPCButtonRef = ref(null);\n        // ====================  ====================\n        /**\n         *  NPC\n         */\n        async function addRandomNPC() {\n            if (randomNPCButtonRef.value) {\n                animation.buttonClickFeedback(randomNPCButtonRef.value);\n            }\n            try {\n                isGeneratingNPC.value = true;\n                //  NPC\n                const npc = await npcGenerationService.generateRandom(instanceType.value || undefined);\n                //  NPC \n                npcs.value.push({\n                    id: npc.id,\n                    characterId: npc.id,\n                    character: npc,\n                    importance: 2, // \n                    appearanceCount: 0,\n                    isImportant: false, // \n                });\n                toastr.success(`NPC ${npc.name} `);\n            }\n            catch (error) {\n                console.error('[Instance Generator]  NPC :', error);\n                toastr.error(' NPC ');\n            }\n            finally {\n                isGeneratingNPC.value = false;\n            }\n        }\n        /**\n         *  NPC \n         */\n        function showCustomNPCDialog() {\n            if (customNPCButtonRef.value) {\n                animation.buttonClickFeedback(customNPCButtonRef.value);\n            }\n            showCustomDialog.value = true;\n            customNPCPrompt.value = '';\n        }\n        /**\n         *  NPC \n         */\n        function closeCustomNPCDialog() {\n            showCustomDialog.value = false;\n            customNPCPrompt.value = '';\n        }\n        /**\n         *  NPC\n         */\n        async function addCustomNPC() {\n            if (!customNPCPrompt.value.trim()) {\n                toastr.warning(' NPC ');\n                return;\n            }\n            try {\n                isGeneratingNPC.value = true;\n                //  NPC\n                const npc = await npcGenerationService.generateCustom(customNPCPrompt.value, instanceType.value || undefined);\n                //  NPC \n                npcs.value.push({\n                    id: npc.id,\n                    characterId: npc.id,\n                    character: npc,\n                    importance: 2, // \n                    appearanceCount: 0,\n                    isImportant: false, // \n                });\n                toastr.success(`NPC ${npc.name} `);\n                closeCustomNPCDialog();\n            }\n            catch (error) {\n                console.error('[Instance Generator]  NPC :', error);\n                toastr.error(' NPC ');\n            }\n            finally {\n                isGeneratingNPC.value = false;\n            }\n        }\n        /**\n         *  NPC\n         */\n        function removeNPC(index) {\n            const npc = npcs.value[index];\n            if (npc) {\n                npcs.value.splice(index, 1);\n                toastr.info(` NPC ${npc.character.name}`);\n            }\n        }\n        /**\n         * \n         */\n        async function generateRandomInstance() {\n            if (randomButtonRef.value) {\n                animation.buttonClickFeedback(randomButtonRef.value);\n            }\n            try {\n                isGenerating.value = true;\n                progressText.value = '...';\n                generatedInstanceId.value = '';\n                const config = {\n                    difficulty: difficulty.value,\n                    npcs: npcs.value, //  NPC \n                };\n                // \n                if (instanceType.value) {\n                    config.type = instanceType.value;\n                }\n                //  gameStore \n                const instanceId = await gameStore.generateInstance(config);\n                generatedInstanceId.value = instanceId;\n                progressText.value = '';\n            }\n            catch (error) {\n                console.error('[Instance Generator] :', error);\n                toastr.error('');\n            }\n            finally {\n                isGenerating.value = false;\n            }\n        }\n        /**\n         * \n         */\n        async function generateCustomInstance() {\n            if (!customPrompt.value.trim()) {\n                toastr.warning('');\n                return;\n            }\n            if (customButtonRef.value) {\n                animation.buttonClickFeedback(customButtonRef.value);\n            }\n            try {\n                isGenerating.value = true;\n                progressText.value = '...';\n                generatedInstanceId.value = '';\n                const config = {\n                    difficulty: difficulty.value,\n                    customPrompt: customPrompt.value,\n                    npcs: npcs.value, //  NPC \n                };\n                // \n                if (instanceType.value) {\n                    config.type = instanceType.value;\n                }\n                //  gameStore \n                const instanceId = await gameStore.generateInstance(config);\n                generatedInstanceId.value = instanceId;\n                progressText.value = '';\n            }\n            catch (error) {\n                console.error('[Instance Generator] :', error);\n                toastr.error('');\n            }\n            finally {\n                isGenerating.value = false;\n            }\n        }\n        /**\n         * \n         */\n        async function enterInstance() {\n            if (!generatedInstanceId.value) {\n                return;\n            }\n            if (enterButtonRef.value) {\n                animation.buttonClickFeedback(enterButtonRef.value);\n            }\n            try {\n                // \n                await gameStore.setMode('main');\n                toastr.success('');\n                // \n                resetForm();\n                // \n                emit('close');\n            }\n            catch (error) {\n                console.error('[Instance Generator] :', error);\n                toastr.error('');\n            }\n        }\n        function handleClose() {\n            if (closeButtonRef.value) {\n                animation.buttonClickFeedback(closeButtonRef.value);\n            }\n            emit('close');\n        }\n        // \n        onMounted(() => {\n            const buttons = document.querySelectorAll('.btn, .difficulty-btn');\n            buttons.forEach(btn => {\n                animation.optimizeForAnimation(btn, ['transform', 'box-shadow']);\n            });\n        });\n        /**\n         * \n         */\n        function resetForm() {\n            difficulty.value = 3;\n            instanceType.value = '';\n            customPrompt.value = '';\n            generatedInstanceId.value = '';\n            progressText.value = '';\n            npcs.value = [];\n            showCustomDialog.value = false;\n            customNPCPrompt.value = '';\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"button\", {\n                        ref_key: \"closeButtonRef\",\n                        ref: closeButtonRef,\n                        class: \"close-btn\",\n                        title: \"\",\n                        onClick: handleClose\n                    }, \"\", 512 /* NEED_PATCH */),\n                    _cache[14] || (_cache[14] = _createElementVNode(\"h2\", { class: \"generator-title\" }, \"\", -1 /* CACHED */)),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _cache[3] || (_cache[3] = _createElementVNode(\"label\", { for: \"difficulty\" }, \"\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_5, [\n                                (_openBlock(), _createElementBlock(_Fragment, null, _renderList(5, (level) => {\n                                    return _createElementVNode(\"button\", {\n                                        key: level,\n                                        class: _normalizeClass(['difficulty-btn', { active: difficulty.value === level }]),\n                                        onClick: ($event) => (difficulty.value = level)\n                                    }, _toDisplayString(level), 11 /* TEXT, CLASS, PROPS */, _hoisted_6);\n                                }), 64 /* STABLE_FRAGMENT */))\n                            ])\n                        ]),\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", _hoisted_7, [\n                            _cache[5] || (_cache[5] = _createElementVNode(\"label\", { for: \"type\" }, \"\", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"select\", {\n                                id: \"type\",\n                                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((instanceType).value = $event)),\n                                class: \"form-control\"\n                            }, [...(_cache[4] || (_cache[4] = [\n                                    _createStaticVNode(\"<option value=\\\"\\\" data-v-09d22cd3></option><option value=\\\"\\\" data-v-09d22cd3></option><option value=\\\"\\\" data-v-09d22cd3></option><option value=\\\"\\\" data-v-09d22cd3></option><option value=\\\"\\\" data-v-09d22cd3></option><option value=\\\"\\\" data-v-09d22cd3></option><option value=\\\"\\\" data-v-09d22cd3></option><option value=\\\"\\\" data-v-09d22cd3></option><option value=\\\"\\\" data-v-09d22cd3></option>\", 9)\n                                ]))], 512 /* NEED_PATCH */), [\n                                [_vModelSelect, instanceType.value]\n                            ])\n                        ]),\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", _hoisted_8, [\n                            _cache[6] || (_cache[6] = _createElementVNode(\"label\", { for: \"customPrompt\" }, \"\", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"textarea\", {\n                                id: \"customPrompt\",\n                                \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((customPrompt).value = $event)),\n                                class: \"form-control\",\n                                rows: \"4\",\n                                placeholder: \"...\"\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vModelText, customPrompt.value]\n                            ])\n                        ]),\n                        _createCommentVNode(\" NPC  \"),\n                        _createElementVNode(\"div\", _hoisted_9, [\n                            _cache[10] || (_cache[10] = _createElementVNode(\"label\", null, \" NPC\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_10, [\n                                (npcs.value.length === 0)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [...(_cache[7] || (_cache[7] = [\n                                            _createElementVNode(\"p\", null, \" NPC\", -1 /* CACHED */)\n                                        ]))]))\n                                    : _createCommentVNode(\"v-if\", true),\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(npcs.value, (npc, index) => {\n                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                        key: npc.id,\n                                        class: \"npc-item\"\n                                    }, [\n                                        _createElementVNode(\"div\", _hoisted_12, [\n                                            _createElementVNode(\"span\", _hoisted_13, _toDisplayString(npc.character.name), 1 /* TEXT */),\n                                            _createElementVNode(\"span\", _hoisted_14, _toDisplayString(npc.character.occupation || ''), 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_15, [\n                                            _cache[9] || (_cache[9] = _createElementVNode(\"label\", { class: \"importance-label\" }, \"\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"select\", {\n                                                \"onUpdate:modelValue\": ($event) => ((npc.importance) = $event),\n                                                class: \"importance-selector\"\n                                            }, [...(_cache[8] || (_cache[8] = [\n                                                    _createElementVNode(\"option\", { value: 1 }, \"1 - \", -1 /* CACHED */),\n                                                    _createElementVNode(\"option\", { value: 2 }, \"2 - \", -1 /* CACHED */),\n                                                    _createElementVNode(\"option\", { value: 3 }, \"3 - \", -1 /* CACHED */),\n                                                    _createElementVNode(\"option\", { value: 4 }, \"4 - \", -1 /* CACHED */),\n                                                    _createElementVNode(\"option\", { value: 5 }, \"5 - \", -1 /* CACHED */)\n                                                ]))], 8 /* PROPS */, _hoisted_16), [\n                                                [_vModelSelect, npc.importance]\n                                            ]),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn-delete\",\n                                                title: \"\",\n                                                onClick: ($event) => (removeNPC(index))\n                                            }, \"\", 8 /* PROPS */, _hoisted_17)\n                                        ])\n                                    ]));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_18, [\n                                _createElementVNode(\"button\", {\n                                    ref_key: \"randomNPCButtonRef\",\n                                    ref: randomNPCButtonRef,\n                                    class: \"btn btn-secondary\",\n                                    disabled: isGenerating.value || isGeneratingNPC.value,\n                                    onClick: addRandomNPC\n                                }, [\n                                    (!isGeneratingNPC.value)\n                                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_20, \" NPC\"))\n                                        : (_openBlock(), _createElementBlock(\"span\", _hoisted_21, \"...\"))\n                                ], 8 /* PROPS */, _hoisted_19),\n                                _createElementVNode(\"button\", {\n                                    ref_key: \"customNPCButtonRef\",\n                                    ref: customNPCButtonRef,\n                                    class: \"btn btn-secondary\",\n                                    disabled: isGenerating.value || isGeneratingNPC.value,\n                                    onClick: showCustomNPCDialog\n                                }, \"  NPC \", 8 /* PROPS */, _hoisted_22)\n                            ])\n                        ]),\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", _hoisted_23, [\n                            _createElementVNode(\"button\", {\n                                ref_key: \"randomButtonRef\",\n                                ref: randomButtonRef,\n                                class: \"btn btn-primary\",\n                                disabled: isGenerating.value,\n                                onClick: generateRandomInstance\n                            }, [\n                                (!isGenerating.value)\n                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_25, \"\"))\n                                    : (_openBlock(), _createElementBlock(\"span\", _hoisted_26, \"...\"))\n                            ], 8 /* PROPS */, _hoisted_24),\n                            (customPrompt.value)\n                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                    key: 0,\n                                    ref_key: \"customButtonRef\",\n                                    ref: customButtonRef,\n                                    class: \"btn btn-secondary\",\n                                    disabled: isGenerating.value,\n                                    onClick: generateCustomInstance\n                                }, [\n                                    (!isGenerating.value)\n                                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_28, \"\"))\n                                        : (_openBlock(), _createElementBlock(\"span\", _hoisted_29, \"...\"))\n                                ], 8 /* PROPS */, _hoisted_27))\n                                : _createCommentVNode(\"v-if\", true)\n                        ]),\n                        _createCommentVNode(\"  \"),\n                        (isGenerating.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_30, [\n                                _cache[11] || (_cache[11] = _createElementVNode(\"div\", { class: \"progress-bar\" }, [\n                                    _createElementVNode(\"div\", { class: \"progress-fill\" })\n                                ], -1 /* CACHED */)),\n                                _createElementVNode(\"p\", _hoisted_31, _toDisplayString(progressText.value), 1 /* TEXT */)\n                            ]))\n                            : _createCommentVNode(\"v-if\", true),\n                        _createCommentVNode(\"  \"),\n                        (generatedInstanceId.value && !isGenerating.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_32, [\n                                _createElementVNode(\"div\", _hoisted_33, [\n                                    _cache[12] || (_cache[12] = _createElementVNode(\"i\", { class: \"icon-check\" }, null, -1 /* CACHED */)),\n                                    _cache[13] || (_cache[13] = _createElementVNode(\"p\", null, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"button\", {\n                                        ref_key: \"enterButtonRef\",\n                                        ref: enterButtonRef,\n                                        class: \"btn btn-success\",\n                                        onClick: enterInstance\n                                    }, \"\", 512 /* NEED_PATCH */)\n                                ])\n                            ]))\n                            : _createCommentVNode(\"v-if\", true)\n                    ])\n                ]),\n                _createCommentVNode(\"  NPC  \"),\n                (showCustomDialog.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_34, [\n                        _createElementVNode(\"div\", _hoisted_35, [\n                            _cache[15] || (_cache[15] = _createElementVNode(\"h3\", null, \" NPC\", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"textarea\", {\n                                \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => ((customNPCPrompt).value = $event)),\n                                class: \"form-control\",\n                                rows: \"4\",\n                                placeholder: \" NPC...\"\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vModelText, customNPCPrompt.value]\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_36, [\n                                _createElementVNode(\"button\", {\n                                    class: \"btn btn-primary\",\n                                    disabled: !customNPCPrompt.value.trim() || isGeneratingNPC.value,\n                                    onClick: addCustomNPC\n                                }, [\n                                    (!isGeneratingNPC.value)\n                                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_38, \"\"))\n                                        : (_openBlock(), _createElementBlock(\"span\", _hoisted_39, \"...\"))\n                                ], 8 /* PROPS */, _hoisted_37),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn btn-secondary\",\n                                    onClick: closeCustomNPCDialog\n                                }, \"\")\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./InstanceGenerator.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./InstanceGenerator.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./InstanceGenerator.vue?vue&type=style&index=0&id=09d22cd3&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-09d22cd3\"]])\n\nexport default __exports__","//  - \n\nimport type { APIConfig } from '../types/api';\nimport { apiConfigService } from './apiConfigService';\n\n/**\n * \n * \n */\nclass StoryReviewService {\n  private initialized = false;\n\n  /**\n   * \n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      console.log('[Story Review Service] ');\n      return;\n    }\n\n    try {\n      console.log('[Story Review Service] ...');\n      //  API \n      await apiConfigService.initialize();\n      this.initialized = true;\n      console.log('[Story Review Service] ');\n    } catch (error) {\n      console.error('[Story Review Service] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   *  API \n   */\n  async reviewRealWorldStory(): Promise<string> {\n    try {\n      console.log('[Story Review Service] ...');\n\n      // \n      const messages = this.getChatHistory();\n      if (messages.length === 0) {\n        return '';\n      }\n\n      // \n      const cleanedMessages = messages.map(msg => ({\n        role: msg.role,\n        content: this.cleanMessages(msg.message),\n      }));\n\n      // \n      const prompt = this.buildReviewPrompt(cleanedMessages, '');\n\n      // \n      //  API \n      //  API custom_api\n      const allConfigs = apiConfigService.getAllConfigs();\n      const realWorldConfig = allConfigs.realWorld;\n      const review = await this.generateReview(prompt, realWorldConfig);\n\n      console.log('[Story Review Service] ');\n      return review;\n    } catch (error) {\n      console.error('[Story Review Service] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   *  API \n   * @param instanceId  ID\n   */\n  async reviewInstanceStory(instanceId?: string): Promise<string> {\n    try {\n      console.log('[Story Review Service] ...', instanceId);\n\n      // \n      const messages = this.getChatHistory();\n      if (messages.length === 0) {\n        return '';\n      }\n\n      // \n      const cleanedMessages = messages.map(msg => ({\n        role: msg.role,\n        content: this.cleanMessages(msg.message),\n      }));\n\n      // \n      const worldName = instanceId ? ` ${instanceId}` : '';\n      const prompt = this.buildReviewPrompt(cleanedMessages, worldName);\n\n      // \n      //  API \n      //  API custom_api\n      const allConfigs = apiConfigService.getAllConfigs();\n      const innerWorldConfig = allConfigs.innerWorld;\n      const review = await this.generateReview(prompt, innerWorldConfig);\n\n      console.log('[Story Review Service] ');\n      return review;\n    } catch (error) {\n      console.error('[Story Review Service] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @param keyword \n   * @returns \n   */\n  searchInStory(keyword: string): Array<{ index: number; role: string; content: string }> {\n    try {\n      console.log('[Story Review Service] :', keyword);\n\n      if (!keyword || keyword.trim() === '') {\n        return [];\n      }\n\n      const messages = this.getChatHistory();\n      const results: Array<{ index: number; role: string; content: string }> = [];\n\n      messages.forEach((msg, index) => {\n        const cleanedContent = this.cleanMessages(msg.message);\n        if (cleanedContent.toLowerCase().includes(keyword.toLowerCase())) {\n          results.push({\n            index,\n            role: msg.role,\n            content: cleanedContent,\n          });\n        }\n      });\n\n      console.log(`[Story Review Service]  ${results.length} `);\n      return results;\n    } catch (error) {\n      console.error('[Story Review Service] :', error);\n      return [];\n    }\n  }\n\n  /**\n   * \n   *  getChatMessages() \n   */\n  private getChatHistory(): Array<{ role: string; message: string }> {\n    try {\n      // \n      const allMessages = getChatMessages('0-{{lastMessageId}}');\n\n      return allMessages.map(msg => ({\n        role: msg.role,\n        message: msg.message,\n      }));\n    } catch (error) {\n      console.error('[Story Review Service] :', error);\n      return [];\n    }\n  }\n\n  /**\n   * \n   * HTML MVU \n   */\n  cleanMessages(content: string): string {\n    if (!content) return '';\n\n    let cleaned = content;\n\n    //  HTML/XML  <StatusPlaceHolderImpl/><div>...</div>\n    cleaned = cleaned.replace(/<[^>]+>/g, '');\n\n    //  MVU {{...}}\n    cleaned = cleaned.replace(/\\{\\{[^}]+\\}\\}/g, '');\n\n    // ```...```\n    cleaned = cleaned.replace(/```[\\s\\S]*?```/g, '');\n\n    // `...`\n    cleaned = cleaned.replace(/`[^`]+`/g, '');\n\n    //  Markdown \n    cleaned = cleaned.replace(/^#{1,6}\\s+/gm, '');\n\n    //  Markdown \n    cleaned = cleaned.replace(/\\*\\*([^*]+)\\*\\*/g, '$1');\n    cleaned = cleaned.replace(/\\*([^*]+)\\*/g, '$1');\n    cleaned = cleaned.replace(/__([^_]+)__/g, '$1');\n    cleaned = cleaned.replace(/_([^_]+)_/g, '$1');\n\n    //  [][...]\n    cleaned = cleaned.replace(/\\[([^\\]]+)\\]/g, '');\n\n    // \n    cleaned = cleaned.replace(/\\[memory_event[^\\]]*\\][\\s\\S]*?\\[\\/memory_event\\]/g, '');\n\n    // \n    cleaned = cleaned.replace(/\\n{3,}/g, '\\n\\n');\n\n    // \n    cleaned = cleaned.trim();\n\n    return cleaned;\n  }\n\n  /**\n   * \n   */\n  private buildReviewPrompt(messages: Array<{ role: string; content: string }>, worldName: string): string {\n    let prompt = `${worldName}\\n\\n`;\n    prompt += `\\n`;\n    prompt += `1. \\n`;\n    prompt += `2. \\n`;\n    prompt += `3. \\n`;\n    prompt += `4. \\n\\n`;\n    prompt += `\\n\\n`;\n\n    //  token \n    const maxMessages = 50; //  50 \n    const recentMessages = messages.slice(-maxMessages);\n\n    recentMessages.forEach((msg, index) => {\n      const speaker = msg.role === 'user' ? '' : 'AI';\n      prompt += `[${index + 1}] ${speaker}${msg.content}\\n\\n`;\n    });\n\n    prompt += `\\n`;\n\n    return prompt;\n  }\n\n  /**\n   *  AI \n   * @param prompt \n   * @param config API \n   */\n  private async generateReview(prompt: string, config?: APIConfig | null): Promise<string> {\n    //  withAPIContext  sanctuary API\n    //  AI  API\n    return await withAPIContext('sanctuary', async () => {\n      try {\n        console.log('[Story Review Service] ...');\n\n        const requestParams: any = {\n          ordered_prompts: [{ role: 'user', content: prompt }],\n        };\n\n        //  custom_api withAPIContext  API \n        console.log('[Story Review Service]  API ');\n\n        const response = await generateRaw(requestParams);\n\n        return response;\n      } catch (error) {\n        console.error('[Story Review Service] :', error);\n        throw error;\n      }\n    });\n  }\n}\n\n// \nexport const storyReviewService = new StoryReviewService();\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, vModelSelect as _vModelSelect, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, vModelText as _vModelText, withKeys as _withKeys, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = { class: \"plot-review\" };\nconst _hoisted_2 = { class: \"plot-review-header\" };\nconst _hoisted_3 = { class: \"plot-review-controls\" };\nconst _hoisted_4 = { class: \"control-group\" };\nconst _hoisted_5 = {\n    key: 0,\n    class: \"control-group\"\n};\nconst _hoisted_6 = [\"value\"];\nconst _hoisted_7 = { class: \"control-group search-group\" };\nconst _hoisted_8 = { class: \"control-group\" };\nconst _hoisted_9 = [\"disabled\"];\nconst _hoisted_10 = { key: 0 };\nconst _hoisted_11 = { key: 1 };\nconst _hoisted_12 = { class: \"plot-review-content\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"ai-review-section\"\n};\nconst _hoisted_14 = { class: \"ai-review-header\" };\nconst _hoisted_15 = { class: \"ai-review-content\" };\nconst _hoisted_16 = {\n    key: 1,\n    class: \"loading-state\"\n};\nconst _hoisted_17 = { class: \"empty-state\" };\nconst _hoisted_18 = { key: 0 };\nconst _hoisted_19 = { key: 1 };\nconst _hoisted_20 = { class: \"messages-list\" };\nconst _hoisted_21 = { class: \"message-header\" };\nconst _hoisted_22 = { class: \"message-name\" };\nconst _hoisted_23 = { class: \"message-index\" };\nconst _hoisted_24 = [\"onClick\"];\nimport { computed, onMounted, ref } from 'vue';\nimport { storyReviewService } from '../services/storyReviewService';\nimport { useInstanceStore } from '../stores/instanceStore';\n// ====================  ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'PlotReview',\n    props: {\n        instanceId: {}\n    },\n    emits: [\"close\"],\n    setup(__props) {\n        const props = __props;\n        // ==================== Store ====================\n        const instanceStore = useInstanceStore();\n        // ====================  ====================\n        const messages = ref([]);\n        const loading = ref(false);\n        const expandedMessages = ref(new Set());\n        const selectedWorld = ref('realWorld');\n        const selectedInstanceId = ref('');\n        const searchKeyword = ref('');\n        const searchResults = ref([]);\n        const aiReviewContent = ref('');\n        const generatingReview = ref(false);\n        // ====================  ====================\n        const instances = computed(() => instanceStore.getAllInstances());\n        const displayMessages = computed(() => {\n            if (searchKeyword.value && searchResults.value.length > 0) {\n                // \n                return searchResults.value.map(result => {\n                    const originalMsg = messages.value[result.index];\n                    return {\n                        ...originalMsg,\n                        originalIndex: result.index,\n                        isHighlighted: true,\n                    };\n                });\n            }\n            // \n            return messages.value.map((msg, index) => ({\n                ...msg,\n                originalIndex: index,\n            }));\n        });\n        // ====================  ====================\n        /**\n         * \n         */\n        async function loadMessages() {\n            loading.value = true;\n            try {\n                console.log('[PlotReview] ...');\n                // 1\n                let chatMessages = getChatMessages('0-{{lastMessageId}}');\n                console.log('[PlotReview] 1 ', chatMessages.length, '');\n                // 12\n                if (chatMessages.length === 0) {\n                    console.log('[PlotReview] 1 2...');\n                    //  ID\n                    const lastMsg = getChatMessages(-1);\n                    if (lastMsg && lastMsg.length > 0) {\n                        const lastId = lastMsg[0].message_id;\n                        console.log('[PlotReview]  ID:', lastId);\n                        // \n                        chatMessages = getChatMessages(`0-${lastId}`);\n                        console.log('[PlotReview] 2 ', chatMessages.length, '');\n                    }\n                }\n                // \n                messages.value = chatMessages.map((msg, index) => ({\n                    name: msg.name,\n                    is_user: msg.role === 'user',\n                    is_system: msg.role === 'system',\n                    mes: msg.message,\n                    send_date: undefined,\n                    originalIndex: index,\n                }));\n                console.log('[PlotReview] ', messages.value.length, '');\n                // \n                messages.value.slice(0, 3).forEach((msg, i) => {\n                    console.log(`[PlotReview]  ${i}:`, msg.name, msg.is_user ? '()' : '(AI)', msg.mes.substring(0, 50) + '...');\n                });\n            }\n            catch (error) {\n                console.error('[PlotReview] :', error);\n                toastr.error('');\n                messages.value = [];\n            }\n            finally {\n                loading.value = false;\n            }\n        }\n        /**\n         * \n         */\n        function onWorldChange() {\n            console.log('[PlotReview] :', selectedWorld.value);\n            //  AI \n            searchKeyword.value = '';\n            searchResults.value = [];\n            aiReviewContent.value = '';\n            // \n            loadMessages();\n        }\n        /**\n         * \n         */\n        function onInstanceChange() {\n            console.log('[PlotReview] :', selectedInstanceId.value);\n            //  AI \n            searchKeyword.value = '';\n            searchResults.value = [];\n            aiReviewContent.value = '';\n            // \n            loadMessages();\n        }\n        /**\n         * \n         */\n        function performSearch() {\n            if (!searchKeyword.value || searchKeyword.value.trim() === '') {\n                searchResults.value = [];\n                toastr.info('');\n                return;\n            }\n            console.log('[PlotReview] :', searchKeyword.value);\n            try {\n                const results = storyReviewService.searchInStory(searchKeyword.value);\n                searchResults.value = results;\n                if (results.length === 0) {\n                    toastr.info('');\n                }\n                else {\n                    toastr.success(` ${results.length} `);\n                }\n            }\n            catch (error) {\n                console.error('[PlotReview] :', error);\n                toastr.error('');\n            }\n        }\n        /**\n         *  AI \n         */\n        async function generateAIReview() {\n            if (generatingReview.value)\n                return;\n            generatingReview.value = true;\n            aiReviewContent.value = '';\n            try {\n                console.log('[PlotReview]  AI ...');\n                // \n                await storyReviewService.initialize();\n                let review;\n                if (selectedWorld.value === 'realWorld') {\n                    review = await storyReviewService.reviewRealWorldStory();\n                }\n                else {\n                    review = await storyReviewService.reviewInstanceStory(selectedInstanceId.value || undefined);\n                }\n                aiReviewContent.value = review;\n                toastr.success('AI ');\n                //  AI \n                setTimeout(() => scrollToTop(), 100);\n            }\n            catch (error) {\n                console.error('[PlotReview]  AI :', error);\n                toastr.error(' AI ');\n            }\n            finally {\n                generatingReview.value = false;\n            }\n        }\n        /**\n         * \n         */\n        function cleanMessageContent(content) {\n            if (!content)\n                return '';\n            let cleaned = content;\n            //  HTML/XML  <StatusPlaceHolderImpl/><div>...</div>\n            cleaned = cleaned.replace(/<[^>]+>/g, '');\n            //  MVU {{...}}\n            cleaned = cleaned.replace(/\\{\\{[^}]+\\}\\}/g, '');\n            //  NPC \n            cleaned = cleaned.replace(/\\{\\{NPC_CREATE:[^}]+\\}\\}/g, '');\n            // ```...```\n            cleaned = cleaned.replace(/```[\\s\\S]*?```/g, '');\n            // `...`\n            cleaned = cleaned.replace(/`[^`]+`/g, '');\n            //  Markdown \n            cleaned = cleaned.replace(/^#{1,6}\\s+/gm, '');\n            //  Markdown \n            cleaned = cleaned.replace(/\\*\\*([^*]+)\\*\\*/g, '$1');\n            cleaned = cleaned.replace(/\\*([^*]+)\\*/g, '$1');\n            cleaned = cleaned.replace(/__([^_]+)__/g, '$1');\n            cleaned = cleaned.replace(/_([^_]+)_/g, '$1');\n            //  [][...]\n            cleaned = cleaned.replace(/\\[([^\\]]+)\\]/g, '');\n            // \n            cleaned = cleaned.replace(/\\n{3,}/g, '\\n\\n');\n            // \n            cleaned = cleaned.trim();\n            return cleaned;\n        }\n        /**\n         * \n         */\n        async function refreshMessages() {\n            await loadMessages();\n            toastr.success('');\n        }\n        /**\n         * \n         */\n        function scrollToTop() {\n            const content = document.querySelector('.messages-list');\n            if (content) {\n                content.scrollTo({ top: 0, behavior: 'smooth' });\n            }\n        }\n        /**\n         * \n         */\n        function scrollToBottom() {\n            const content = document.querySelector('.messages-list');\n            if (content) {\n                content.scrollTo({ top: content.scrollHeight, behavior: 'smooth' });\n            }\n        }\n        /**\n         * /\n         */\n        function toggleExpand(index) {\n            if (expandedMessages.value.has(index)) {\n                expandedMessages.value.delete(index);\n            }\n            else {\n                expandedMessages.value.add(index);\n            }\n        }\n        // ====================  ====================\n        onMounted(() => {\n            //  ID\n            if (props.instanceId) {\n                selectedWorld.value = 'innerWorld';\n                selectedInstanceId.value = props.instanceId;\n            }\n            loadMessages();\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _cache[5] || (_cache[5] = _createElementVNode(\"h2\", { class: \"plot-review-title\" }, \" \", -1 /* CACHED */)),\n                    _createElementVNode(\"button\", {\n                        class: \"close-btn\",\n                        onClick: _cache[0] || (_cache[0] = ($event) => (_ctx.$emit('close')))\n                    }, \"\")\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_3, [\n                    _createElementVNode(\"div\", _hoisted_4, [\n                        _cache[7] || (_cache[7] = _createElementVNode(\"label\", { class: \"control-label\" }, \"\", -1 /* CACHED */)),\n                        _withDirectives(_createElementVNode(\"select\", {\n                            \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((selectedWorld).value = $event)),\n                            class: \"world-selector\",\n                            onChange: onWorldChange\n                        }, [...(_cache[6] || (_cache[6] = [\n                                _createElementVNode(\"option\", { value: \"realWorld\" }, \"\", -1 /* CACHED */),\n                                _createElementVNode(\"option\", { value: \"innerWorld\" }, \"\", -1 /* CACHED */)\n                            ]))], 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                            [_vModelSelect, selectedWorld.value]\n                        ])\n                    ]),\n                    _createCommentVNode(\"  \"),\n                    (selectedWorld.value === 'innerWorld')\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [\n                            _cache[9] || (_cache[9] = _createElementVNode(\"label\", { class: \"control-label\" }, \"\", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"select\", {\n                                \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => ((selectedInstanceId).value = $event)),\n                                class: \"instance-selector\",\n                                onChange: onInstanceChange\n                            }, [\n                                _cache[8] || (_cache[8] = _createElementVNode(\"option\", { value: \"\" }, \"\", -1 /* CACHED */)),\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(instances.value, (instance) => {\n                                    return (_openBlock(), _createElementBlock(\"option\", {\n                                        key: instance.id,\n                                        value: instance.id\n                                    }, _toDisplayString(instance.name), 9 /* TEXT, PROPS */, _hoisted_6));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ], 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                [_vModelSelect, selectedInstanceId.value]\n                            ])\n                        ]))\n                        : _createCommentVNode(\"v-if\", true),\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_7, [\n                        _withDirectives(_createElementVNode(\"input\", {\n                            \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => ((searchKeyword).value = $event)),\n                            type: \"text\",\n                            class: \"search-input\",\n                            placeholder: \"...\",\n                            onKeyup: _withKeys(performSearch, [\"enter\"])\n                        }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                            [_vModelText, searchKeyword.value]\n                        ]),\n                        _createElementVNode(\"button\", {\n                            class: \"search-btn\",\n                            onClick: performSearch\n                        }, \"\")\n                    ]),\n                    _createCommentVNode(\" AI  \"),\n                    _createElementVNode(\"div\", _hoisted_8, [\n                        _createElementVNode(\"button\", {\n                            class: \"ai-review-btn\",\n                            disabled: generatingReview.value,\n                            onClick: generateAIReview\n                        }, [\n                            (!generatingReview.value)\n                                ? (_openBlock(), _createElementBlock(\"span\", _hoisted_10, \" AI \"))\n                                : (_openBlock(), _createElementBlock(\"span\", _hoisted_11, \"...\"))\n                        ], 8 /* PROPS */, _hoisted_9)\n                    ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_12, [\n                    _createCommentVNode(\" AI  \"),\n                    (aiReviewContent.value)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [\n                            _createElementVNode(\"div\", _hoisted_14, [\n                                _cache[10] || (_cache[10] = _createElementVNode(\"h3\", null, \"AI \", -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"close-review-btn\",\n                                    onClick: _cache[4] || (_cache[4] = ($event) => (aiReviewContent.value = ''))\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_15, _toDisplayString(aiReviewContent.value), 1 /* TEXT */)\n                        ]))\n                        : _createCommentVNode(\"v-if\", true),\n                    _createCommentVNode(\"  \"),\n                    (loading.value)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_16, [...(_cache[11] || (_cache[11] = [\n                                _createElementVNode(\"div\", { class: \"loading-spinner\" }, null, -1 /* CACHED */),\n                                _createElementVNode(\"p\", null, \"...\", -1 /* CACHED */)\n                            ]))]))\n                        : (displayMessages.value.length === 0)\n                            ? (_openBlock(), _createElementBlock(_Fragment, { key: 2 }, [\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"div\", _hoisted_17, [\n                                    _cache[12] || (_cache[12] = _createElementVNode(\"p\", null, \"\", -1 /* CACHED */)),\n                                    (searchKeyword.value)\n                                        ? (_openBlock(), _createElementBlock(\"p\", _hoisted_18, \"\"))\n                                        : (_openBlock(), _createElementBlock(\"p\", _hoisted_19, \"\"))\n                                ])\n                            ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                            : (_openBlock(), _createElementBlock(_Fragment, { key: 3 }, [\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"div\", _hoisted_20, [\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayMessages.value, (message, index) => {\n                                        return (_openBlock(), _createElementBlock(\"div\", {\n                                            key: index,\n                                            class: _normalizeClass([\"message-item\", {\n                                                    'is-user': message.is_user,\n                                                    'is-system': message.is_system,\n                                                    'is-highlighted': message.isHighlighted,\n                                                }])\n                                        }, [\n                                            _createElementVNode(\"div\", _hoisted_21, [\n                                                _createElementVNode(\"span\", _hoisted_22, _toDisplayString(message.name), 1 /* TEXT */),\n                                                _createElementVNode(\"span\", _hoisted_23, \"#\" + _toDisplayString(message.originalIndex + 1), 1 /* TEXT */)\n                                            ]),\n                                            _createElementVNode(\"div\", {\n                                                class: _normalizeClass([\"message-content\", { 'is-collapsed': !expandedMessages.value.has(index) }]),\n                                                onClick: ($event) => (toggleExpand(index))\n                                            }, _toDisplayString(cleanMessageContent(message.mes)), 11 /* TEXT, CLASS, PROPS */, _hoisted_24)\n                                        ], 2 /* CLASS */));\n                                    }), 128 /* KEYED_FRAGMENT */))\n                                ])\n                            ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                ]),\n                _createElementVNode(\"div\", { class: \"plot-review-footer\" }, [\n                    _createElementVNode(\"button\", {\n                        class: \"action-btn\",\n                        onClick: refreshMessages\n                    }, [...(_cache[13] || (_cache[13] = [\n                            _createElementVNode(\"span\", null, \"\", -1 /* CACHED */),\n                            _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)\n                        ]))]),\n                    _createElementVNode(\"button\", {\n                        class: \"action-btn\",\n                        onClick: scrollToTop\n                    }, [...(_cache[14] || (_cache[14] = [\n                            _createElementVNode(\"span\", null, \"\", -1 /* CACHED */),\n                            _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)\n                        ]))]),\n                    _createElementVNode(\"button\", {\n                        class: \"action-btn\",\n                        onClick: scrollToBottom\n                    }, [...(_cache[15] || (_cache[15] = [\n                            _createElementVNode(\"span\", null, \"\", -1 /* CACHED */),\n                            _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)\n                        ]))])\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./PlotReview.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./PlotReview.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./PlotReview.vue?vue&type=style&index=0&id=3ee520ab&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3ee520ab\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, unref as _unref, openBlock as _openBlock, createElementBlock as _createElementBlock, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, createTextVNode as _createTextVNode, createVNode as _createVNode, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = { class: \"instance-record\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"instance-list-view\"\n};\nconst _hoisted_3 = {\n    key: 0,\n    class: \"empty-state\"\n};\nconst _hoisted_4 = {\n    key: 1,\n    class: \"instance-list\"\n};\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = { class: \"instance-card-header\" };\nconst _hoisted_7 = { class: \"instance-name\" };\nconst _hoisted_8 = {\n    key: 0,\n    class: \"draft-badge\"\n};\nconst _hoisted_9 = {\n    key: 1,\n    class: \"active-badge\"\n};\nconst _hoisted_10 = {\n    key: 2,\n    class: \"completed-badge\"\n};\nconst _hoisted_11 = { class: \"instance-info\" };\nconst _hoisted_12 = { class: \"info-item\" };\nconst _hoisted_13 = { class: \"info-value\" };\nconst _hoisted_14 = { class: \"info-item\" };\nconst _hoisted_15 = { class: \"info-value\" };\nconst _hoisted_16 = { class: \"instance-stats\" };\nconst _hoisted_17 = { class: \"stat-item\" };\nconst _hoisted_18 = { class: \"stat-item\" };\nconst _hoisted_19 = {\n    key: 0,\n    class: \"stat-item\"\n};\nconst _hoisted_20 = { class: \"instance-detail-view\" };\nconst _hoisted_21 = { class: \"detail-header\" };\nconst _hoisted_22 = { class: \"detail-title\" };\nconst _hoisted_23 = { class: \"detail-content\" };\nconst _hoisted_24 = { class: \"detail-section\" };\nconst _hoisted_25 = { class: \"info-grid\" };\nconst _hoisted_26 = { class: \"info-row\" };\nconst _hoisted_27 = { class: \"info-value\" };\nconst _hoisted_28 = { class: \"info-row\" };\nconst _hoisted_29 = { class: \"info-value\" };\nconst _hoisted_30 = { class: \"info-row\" };\nconst _hoisted_31 = { class: \"detail-section\" };\nconst _hoisted_32 = { class: \"world-setting\" };\nconst _hoisted_33 = { class: \"detail-section\" };\nconst _hoisted_34 = { class: \"section-header\" };\nconst _hoisted_35 = { class: \"section-title\" };\nconst _hoisted_36 = {\n    key: 0,\n    class: \"empty-characters\"\n};\nconst _hoisted_37 = {\n    key: 1,\n    class: \"characters-list\"\n};\nconst _hoisted_38 = [\"onClick\"];\nconst _hoisted_39 = { class: \"character-basic\" };\nconst _hoisted_40 = { class: \"character-name\" };\nconst _hoisted_41 = {\n    key: 0,\n    class: \"importance-badge\"\n};\nconst _hoisted_42 = {\n    key: 1,\n    class: \"important-badge\"\n};\nconst _hoisted_43 = { class: \"expand-icon\" };\nconst _hoisted_44 = {\n    key: 0,\n    class: \"character-details\"\n};\nconst _hoisted_45 = { class: \"character-info\" };\nconst _hoisted_46 = {\n    key: 0,\n    class: \"char-occupation\"\n};\nconst _hoisted_47 = {\n    key: 1,\n    class: \"char-background\"\n};\nconst _hoisted_48 = {\n    key: 2,\n    class: \"char-appearance\"\n};\nconst _hoisted_49 = { class: \"character-actions\" };\nconst _hoisted_50 = [\"onClick\"];\nconst _hoisted_51 = { class: \"detail-section\" };\nconst _hoisted_52 = { class: \"section-title\" };\nconst _hoisted_53 = {\n    key: 0,\n    class: \"empty-events\"\n};\nconst _hoisted_54 = {\n    key: 1,\n    class: \"events-list\"\n};\nconst _hoisted_55 = { class: \"event-header\" };\nconst _hoisted_56 = { class: \"event-time\" };\nconst _hoisted_57 = {\n    key: 0,\n    class: \"event-location\"\n};\nconst _hoisted_58 = { class: \"event-summary\" };\nconst _hoisted_59 = {\n    key: 0,\n    class: \"event-characters\"\n};\nconst _hoisted_60 = {\n    key: 0,\n    class: \"detail-section\"\n};\nconst _hoisted_61 = { class: \"section-title\" };\nconst _hoisted_62 = { class: \"mementos-list\" };\nconst _hoisted_63 = { class: \"memento-header\" };\nconst _hoisted_64 = { class: \"memento-name\" };\nconst _hoisted_65 = { class: \"memento-time\" };\nconst _hoisted_66 = { class: \"memento-description\" };\nconst _hoisted_67 = {\n    key: 1,\n    class: \"detail-section\"\n};\nconst _hoisted_68 = { class: \"ending-text\" };\nconst _hoisted_69 = { class: \"detail-section action-section\" };\nconst _hoisted_70 = { class: \"action-buttons\" };\nconst _hoisted_71 = { class: \"plot-review-modal\" };\nconst _hoisted_72 = { class: \"modal-content\" };\nimport { computed, ref } from 'vue';\nimport { apiConfigService } from '../services/apiConfigService';\nimport { useInstanceStore } from '../stores/instanceStore';\nimport CharacterCreator from './CharacterCreator.vue';\nimport PlotReview from './PlotReview.vue';\n// ==================== Emits ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'InstanceRecord',\n    emits: [\"close\"],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        // ==================== Store ====================\n        const instanceStore = useInstanceStore();\n        // ====================  ====================\n        const selectedInstance = ref(null);\n        const expandedCharacters = ref(new Set());\n        const showCharacterCreator = ref(false);\n        const showPlotReview = ref(false);\n        // ====================  ====================\n        const currentInstanceData = computed(() => {\n            if (!selectedInstance.value)\n                return null;\n            return instanceStore.instances.get(selectedInstance.value);\n        });\n        const sortedEvents = computed(() => {\n            if (!currentInstanceData.value)\n                return [];\n            return [...currentInstanceData.value.events].sort((a, b) => a.timestamp - b.timestamp);\n        });\n        // ====================  ====================\n        /**\n         * \n         */\n        function selectInstance(instanceId) {\n            selectedInstance.value = instanceId;\n            expandedCharacters.value.clear();\n        }\n        /**\n         * \n         */\n        function toggleCharacterExpand(characterId) {\n            if (expandedCharacters.value.has(characterId)) {\n                expandedCharacters.value.delete(characterId);\n            }\n            else {\n                expandedCharacters.value.add(characterId);\n            }\n        }\n        /**\n         * \n         */\n        async function toggleImportant(characterId) {\n            if (!selectedInstance.value)\n                return;\n            try {\n                await instanceStore.toggleImportantNPC(selectedInstance.value, characterId);\n            }\n            catch (error) {\n                console.error('[InstanceRecord] :', error);\n            }\n        }\n        /**\n         * \n         */\n        async function handleCharacterCreated(character) {\n            if (!selectedInstance.value)\n                return;\n            //  NPC \n            if (character.type !== 'npc') {\n                console.warn('[InstanceRecord]  NPC ');\n                return;\n            }\n            try {\n                // \n                const instance = currentInstanceData.value;\n                if (instance) {\n                    const previousInstances = instanceStore.getInstancesByWorldSetting(instance.worldSetting);\n                    const inheritedCharacter = findInheritedCharacter(character.name, previousInstances);\n                    if (inheritedCharacter) {\n                        // \n                        console.log(`[InstanceRecord]  ${character.name} `);\n                        toastr.info(` ${character.name} `);\n                        // \n                    }\n                }\n                // \n                await instanceStore.addCharacterToInstance(selectedInstance.value, character, false);\n                showCharacterCreator.value = false;\n            }\n            catch (error) {\n                console.error('[InstanceRecord] :', error);\n            }\n        }\n        /**\n         * \n         */\n        function findInheritedCharacter(characterName, instances) {\n            for (const instance of instances) {\n                const found = instance.characters.find(c => c.character.name === characterName);\n                if (found) {\n                    return found.character;\n                }\n            }\n            return null;\n        }\n        /**\n         * \n         */\n        function getCharacterName(characterId) {\n            if (!currentInstanceData.value)\n                return '';\n            const charInInstance = currentInstanceData.value.characters.find((c) => c.characterId === characterId);\n            return charInInstance?.character.name || '';\n        }\n        /**\n         * \n         */\n        function formatTime(timestamp) {\n            const date = new Date(timestamp);\n            const now = new Date();\n            const diff = now.getTime() - date.getTime();\n            // \n            if (diff < 24 * 60 * 60 * 1000 && date.getDate() === now.getDate()) {\n                return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });\n            }\n            // \n            if (date.getFullYear() === now.getFullYear()) {\n                return date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });\n            }\n            // \n            return date.toLocaleDateString('zh-CN', {\n                year: 'numeric',\n                month: '2-digit',\n                day: '2-digit',\n                hour: '2-digit',\n                minute: '2-digit',\n            });\n        }\n        /**\n         * \n         */\n        function getStatusText(status) {\n            const statusMap = {\n                draft: '',\n                active: '',\n                completed: '',\n            };\n            return statusMap[status] || status;\n        }\n        /**\n         * \n         */\n        function openPlotReview() {\n            showPlotReview.value = true;\n        }\n        /**\n         * \n         * \n         */\n        async function confirmEndInstance() {\n            if (!selectedInstance.value)\n                return;\n            //  confirm\n            const confirmed = confirm('\\n\\n\\n-  NPC \\n- \\n- \\n- \\n\\n');\n            if (!confirmed)\n                return;\n            try {\n                //  completeInstance() \n                await instanceStore.completeInstance(selectedInstance.value);\n                //  API\n                apiConfigService.switchToRealWorld();\n                // \n                const { worldBookService } = await import('../services/worldBookService');\n                await worldBookService.activateRealWorldEntries();\n                // \n                toastr.success('');\n                // \n                selectedInstance.value = null;\n            }\n            catch (error) {\n                console.error('[InstanceRecord] :', error);\n                toastr.error('');\n            }\n        }\n        /**\n         * \n         * \n         */\n        async function closeInstancePage() {\n            if (!selectedInstance.value)\n                return;\n            try {\n                //  API\n                apiConfigService.switchToRealWorld();\n                // \n                const { worldBookService } = await import('../services/worldBookService');\n                await worldBookService.activateRealWorldEntries();\n                // \n                const { useGameStore } = await import('../stores/gameStore');\n                const gameStore = useGameStore();\n                await gameStore.setCurrentInstance(null);\n                toastr.info('');\n                // \n                selectedInstance.value = null;\n            }\n            catch (error) {\n                console.error('[InstanceRecord] :', error);\n                toastr.error('');\n            }\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"button\", {\n                    class: \"floating-exit-btn\",\n                    title: \"\",\n                    onClick: _cache[0] || (_cache[0] = ($event) => (emit('close')))\n                }, \"\"),\n                _createCommentVNode(\"  \"),\n                (!selectedInstance.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n                        _cache[10] || (_cache[10] = _createElementVNode(\"div\", { class: \"record-header\" }, [\n                            _createElementVNode(\"h2\", { class: \"record-title\" }, \"\"),\n                            _createElementVNode(\"p\", { class: \"record-subtitle\" }, \"\")\n                        ], -1 /* CACHED */)),\n                        (_unref(instanceStore).instanceCount === 0)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [...(_cache[7] || (_cache[7] = [\n                                    _createElementVNode(\"p\", { class: \"empty-text\" }, \"\", -1 /* CACHED */),\n                                    _createElementVNode(\"p\", { class: \"empty-hint\" }, \"\", -1 /* CACHED */)\n                                ]))]))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(instanceStore).instanceList, (instance) => {\n                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                        key: instance.id,\n                                        class: _normalizeClass([\"instance-card\", { active: instance.isActive }]),\n                                        onClick: ($event) => (selectInstance(instance.id))\n                                    }, [\n                                        _createElementVNode(\"div\", _hoisted_6, [\n                                            _createElementVNode(\"h3\", _hoisted_7, _toDisplayString(instance.name), 1 /* TEXT */),\n                                            (instance.status === 'draft')\n                                                ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, \"\"))\n                                                : (instance.status === 'active')\n                                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_9, \"\"))\n                                                    : (instance.status === 'completed')\n                                                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_10, \"\"))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_11, [\n                                            _createElementVNode(\"span\", _hoisted_12, [\n                                                _cache[8] || (_cache[8] = _createElementVNode(\"span\", { class: \"info-label\" }, \":\", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", _hoisted_13, _toDisplayString(instance.type), 1 /* TEXT */)\n                                            ]),\n                                            _createElementVNode(\"span\", _hoisted_14, [\n                                                _cache[9] || (_cache[9] = _createElementVNode(\"span\", { class: \"info-label\" }, \":\", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", _hoisted_15, _toDisplayString(''.repeat(instance.difficulty)), 1 /* TEXT */)\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_16, [\n                                            _createElementVNode(\"span\", _hoisted_17, _toDisplayString(instance.characters.length) + \" \", 1 /* TEXT */),\n                                            _createElementVNode(\"span\", _hoisted_18, _toDisplayString(instance.events.length) + \" \", 1 /* TEXT */),\n                                            (instance.mementos && instance.mementos.length > 0)\n                                                ? (_openBlock(), _createElementBlock(\"span\", _hoisted_19, _toDisplayString(instance.mementos.length) + \"  \", 1 /* TEXT */))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ])\n                                    ], 10 /* CLASS, PROPS */, _hoisted_5));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]))\n                    ]))\n                    : (currentInstanceData.value)\n                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", _hoisted_20, [\n                                _createElementVNode(\"div\", _hoisted_21, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn-back\",\n                                        onClick: _cache[1] || (_cache[1] = ($event) => (selectedInstance.value = null))\n                                    }, [...(_cache[11] || (_cache[11] = [\n                                            _createElementVNode(\"span\", { class: \"back-icon\" }, \"\", -1 /* CACHED */),\n                                            _createTextVNode(\"  \", -1 /* CACHED */)\n                                        ]))]),\n                                    _createElementVNode(\"h2\", _hoisted_22, _toDisplayString(currentInstanceData.value.name), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_23, [\n                                    _createCommentVNode(\"  \"),\n                                    _createElementVNode(\"section\", _hoisted_24, [\n                                        _cache[15] || (_cache[15] = _createElementVNode(\"h3\", { class: \"section-title\" }, \"\", -1 /* CACHED */)),\n                                        _createElementVNode(\"div\", _hoisted_25, [\n                                            _createElementVNode(\"div\", _hoisted_26, [\n                                                _cache[12] || (_cache[12] = _createElementVNode(\"span\", { class: \"info-label\" }, \":\", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", _hoisted_27, _toDisplayString(currentInstanceData.value.type), 1 /* TEXT */)\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_28, [\n                                                _cache[13] || (_cache[13] = _createElementVNode(\"span\", { class: \"info-label\" }, \":\", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", _hoisted_29, _toDisplayString(''.repeat(currentInstanceData.value.difficulty)), 1 /* TEXT */)\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_30, [\n                                                _cache[14] || (_cache[14] = _createElementVNode(\"span\", { class: \"info-label\" }, \":\", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", {\n                                                    class: _normalizeClass([\"info-value status-badge\", `status-${currentInstanceData.value.status}`])\n                                                }, _toDisplayString(getStatusText(currentInstanceData.value.status)), 3 /* TEXT, CLASS */)\n                                            ])\n                                        ])\n                                    ]),\n                                    _createCommentVNode(\"  \"),\n                                    _createElementVNode(\"section\", _hoisted_31, [\n                                        _cache[16] || (_cache[16] = _createElementVNode(\"h3\", { class: \"section-title\" }, \"\", -1 /* CACHED */)),\n                                        _createElementVNode(\"p\", _hoisted_32, _toDisplayString(currentInstanceData.value.worldSetting), 1 /* TEXT */)\n                                    ]),\n                                    _createCommentVNode(\"  \"),\n                                    _createElementVNode(\"section\", _hoisted_33, [\n                                        _createElementVNode(\"div\", _hoisted_34, [\n                                            _createElementVNode(\"h3\", _hoisted_35, \" (\" + _toDisplayString(currentInstanceData.value.characters.length) + \")\", 1 /* TEXT */),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn-add\",\n                                                onClick: _cache[2] || (_cache[2] = ($event) => (showCharacterCreator.value = true))\n                                            }, [...(_cache[17] || (_cache[17] = [\n                                                    _createElementVNode(\"span\", { class: \"add-icon\" }, \"+\", -1 /* CACHED */),\n                                                    _createTextVNode(\"  \", -1 /* CACHED */)\n                                                ]))])\n                                        ]),\n                                        (currentInstanceData.value.characters.length === 0)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_36, [...(_cache[18] || (_cache[18] = [\n                                                    _createElementVNode(\"p\", { class: \"empty-text\" }, \"\", -1 /* CACHED */)\n                                                ]))]))\n                                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_37, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(currentInstanceData.value.characters, (charInInstance) => {\n                                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                                        key: charInInstance.characterId,\n                                                        class: _normalizeClass([\"character-item\", { important: charInInstance.isImportant }])\n                                                    }, [\n                                                        _createElementVNode(\"div\", {\n                                                            class: \"character-header\",\n                                                            onClick: ($event) => (toggleCharacterExpand(charInInstance.characterId))\n                                                        }, [\n                                                            _createElementVNode(\"div\", _hoisted_39, [\n                                                                _createElementVNode(\"span\", _hoisted_40, _toDisplayString(charInInstance.character.name), 1 /* TEXT */),\n                                                                (charInInstance.importance)\n                                                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_41, _toDisplayString(''.repeat(charInInstance.importance)), 1 /* TEXT */))\n                                                                    : (charInInstance.isImportant)\n                                                                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_42, \"\"))\n                                                                        : _createCommentVNode(\"v-if\", true)\n                                                            ]),\n                                                            _createElementVNode(\"span\", _hoisted_43, _toDisplayString(expandedCharacters.value.has(charInInstance.characterId) ? '' : ''), 1 /* TEXT */)\n                                                        ], 8 /* PROPS */, _hoisted_38),\n                                                        (expandedCharacters.value.has(charInInstance.characterId))\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_44, [\n                                                                _createElementVNode(\"div\", _hoisted_45, [\n                                                                    (charInInstance.character.occupation)\n                                                                        ? (_openBlock(), _createElementBlock(\"p\", _hoisted_46, \" : \" + _toDisplayString(charInInstance.character.occupation), 1 /* TEXT */))\n                                                                        : _createCommentVNode(\"v-if\", true),\n                                                                    (charInInstance.character.background)\n                                                                        ? (_openBlock(), _createElementBlock(\"p\", _hoisted_47, _toDisplayString(charInInstance.character.background), 1 /* TEXT */))\n                                                                        : _createCommentVNode(\"v-if\", true),\n                                                                    (charInInstance.firstAppearance)\n                                                                        ? (_openBlock(), _createElementBlock(\"p\", _hoisted_48, \" : \" + _toDisplayString(charInInstance.firstAppearance), 1 /* TEXT */))\n                                                                        : _createCommentVNode(\"v-if\", true)\n                                                                ]),\n                                                                _createElementVNode(\"div\", _hoisted_49, [\n                                                                    _createElementVNode(\"button\", {\n                                                                        class: \"btn-toggle-important\",\n                                                                        onClick: ($event) => (toggleImportant(charInInstance.characterId))\n                                                                    }, _toDisplayString(charInInstance.isImportant ? '' : ''), 9 /* TEXT, PROPS */, _hoisted_50)\n                                                                ])\n                                                            ]))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ], 2 /* CLASS */));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ]))\n                                    ]),\n                                    _createCommentVNode(\"  \"),\n                                    _createElementVNode(\"section\", _hoisted_51, [\n                                        _createElementVNode(\"h3\", _hoisted_52, \" (\" + _toDisplayString(currentInstanceData.value.events.length) + \")\", 1 /* TEXT */),\n                                        (currentInstanceData.value.events.length === 0)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_53, [...(_cache[19] || (_cache[19] = [\n                                                    _createElementVNode(\"p\", { class: \"empty-text\" }, \"\", -1 /* CACHED */)\n                                                ]))]))\n                                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_54, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(sortedEvents.value, (event) => {\n                                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                                        key: event.id,\n                                                        class: \"event-item\"\n                                                    }, [\n                                                        _createElementVNode(\"div\", _hoisted_55, [\n                                                            _createElementVNode(\"span\", _hoisted_56, _toDisplayString(formatTime(event.timestamp)), 1 /* TEXT */),\n                                                            (event.location)\n                                                                ? (_openBlock(), _createElementBlock(\"span\", _hoisted_57, _toDisplayString(event.location), 1 /* TEXT */))\n                                                                : _createCommentVNode(\"v-if\", true)\n                                                        ]),\n                                                        _createElementVNode(\"p\", _hoisted_58, _toDisplayString(event.summary), 1 /* TEXT */),\n                                                        (event.involvedCharacters.length > 0)\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_59, [\n                                                                _cache[20] || (_cache[20] = _createElementVNode(\"span\", { class: \"involved-label\" }, \":\", -1 /* CACHED */)),\n                                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(event.involvedCharacters, (charId) => {\n                                                                    return (_openBlock(), _createElementBlock(\"span\", {\n                                                                        key: charId,\n                                                                        class: \"involved-character\"\n                                                                    }, _toDisplayString(getCharacterName(charId)), 1 /* TEXT */));\n                                                                }), 128 /* KEYED_FRAGMENT */))\n                                                            ]))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ]));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ]))\n                                    ]),\n                                    _createCommentVNode(\"  \"),\n                                    (currentInstanceData.value.mementos && currentInstanceData.value.mementos.length > 0)\n                                        ? (_openBlock(), _createElementBlock(\"section\", _hoisted_60, [\n                                            _createElementVNode(\"h3\", _hoisted_61, \" (\" + _toDisplayString(currentInstanceData.value.mementos.length) + \")\", 1 /* TEXT */),\n                                            _createElementVNode(\"div\", _hoisted_62, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(currentInstanceData.value.mementos, (memento) => {\n                                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                                        key: memento.id,\n                                                        class: \"memento-item\"\n                                                    }, [\n                                                        _createElementVNode(\"div\", _hoisted_63, [\n                                                            _createElementVNode(\"span\", _hoisted_64, _toDisplayString(memento.name), 1 /* TEXT */),\n                                                            _createElementVNode(\"span\", _hoisted_65, _toDisplayString(formatTime(memento.obtainedAt)), 1 /* TEXT */)\n                                                        ]),\n                                                        _createElementVNode(\"p\", _hoisted_66, _toDisplayString(memento.description), 1 /* TEXT */)\n                                                    ]));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ])\n                                        ]))\n                                        : _createCommentVNode(\"v-if\", true),\n                                    _createCommentVNode(\"  \"),\n                                    (currentInstanceData.value.ending)\n                                        ? (_openBlock(), _createElementBlock(\"section\", _hoisted_67, [\n                                            _cache[21] || (_cache[21] = _createElementVNode(\"h3\", { class: \"section-title\" }, \"\", -1 /* CACHED */)),\n                                            _createElementVNode(\"p\", _hoisted_68, _toDisplayString(currentInstanceData.value.ending), 1 /* TEXT */)\n                                        ]))\n                                        : _createCommentVNode(\"v-if\", true),\n                                    _createCommentVNode(\"  \"),\n                                    _createElementVNode(\"section\", _hoisted_69, [\n                                        _createElementVNode(\"div\", _hoisted_70, [\n                                            _createElementVNode(\"button\", {\n                                                class: \"action-button plot-review-button\",\n                                                onClick: openPlotReview\n                                            }, [...(_cache[22] || (_cache[22] = [\n                                                    _createElementVNode(\"span\", { class: \"button-icon\" }, \"\", -1 /* CACHED */),\n                                                    _createElementVNode(\"span\", { class: \"button-text\" }, \"\", -1 /* CACHED */)\n                                                ]))]),\n                                            (currentInstanceData.value.status === 'active')\n                                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                                    key: 0,\n                                                    class: \"action-button end-instance-button\",\n                                                    onClick: confirmEndInstance\n                                                }, [...(_cache[23] || (_cache[23] = [\n                                                        _createElementVNode(\"span\", { class: \"button-icon\" }, \"\", -1 /* CACHED */),\n                                                        _createElementVNode(\"span\", { class: \"button-text\" }, \"\", -1 /* CACHED */)\n                                                    ]))]))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            _createElementVNode(\"button\", {\n                                                class: \"action-button close-instance-button\",\n                                                onClick: closeInstancePage\n                                            }, [...(_cache[24] || (_cache[24] = [\n                                                    _createElementVNode(\"span\", { class: \"button-icon\" }, \"\", -1 /* CACHED */),\n                                                    _createElementVNode(\"span\", { class: \"button-text\" }, \"\", -1 /* CACHED */)\n                                                ]))])\n                                        ])\n                                    ])\n                                ])\n                            ])\n                        ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                        : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showPlotReview.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 2,\n                        class: \"modal-overlay\",\n                        onClick: _cache[4] || (_cache[4] = _withModifiers(($event) => (showPlotReview.value = false), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_71, [\n                            _createVNode(PlotReview, {\n                                \"instance-id\": selectedInstance.value || undefined,\n                                onClose: _cache[3] || (_cache[3] = ($event) => (showPlotReview.value = false))\n                            }, null, 8 /* PROPS */, [\"instance-id\"])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showCharacterCreator.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 3,\n                        class: \"modal-overlay\",\n                        onClick: _cache[6] || (_cache[6] = _withModifiers(($event) => (showCharacterCreator.value = false), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_72, [\n                            _createVNode(CharacterCreator, {\n                                \"sync-to-tavern\": false,\n                                \"character-type\": \"npc\",\n                                onCreated: handleCharacterCreated,\n                                onCancelled: _cache[5] || (_cache[5] = ($event) => (showCharacterCreator.value = false))\n                            })\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./InstanceRecord.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./InstanceRecord.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./InstanceRecord.vue?vue&type=style&index=0&id=6a85f072&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6a85f072\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, unref as _unref, openBlock as _openBlock, createElementBlock as _createElementBlock, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = { class: \"inventory-panel\" };\nconst _hoisted_2 = { class: \"inventory-tabs\" };\nconst _hoisted_3 = {\n    key: 0,\n    class: \"inventory-content\"\n};\nconst _hoisted_4 = {\n    key: 0,\n    class: \"empty-inventory\"\n};\nconst _hoisted_5 = {\n    key: 1,\n    class: \"items-grid\"\n};\nconst _hoisted_6 = [\"onClick\"];\nconst _hoisted_7 = { class: \"item-header\" };\nconst _hoisted_8 = { class: \"item-name\" };\nconst _hoisted_9 = {\n    key: 0,\n    class: \"item-type\"\n};\nconst _hoisted_10 = { class: \"item-description\" };\nconst _hoisted_11 = {\n    key: 0,\n    class: \"item-meta\"\n};\nconst _hoisted_12 = { class: \"item-source\" };\nconst _hoisted_13 = {\n    key: 1,\n    class: \"inventory-content\"\n};\nconst _hoisted_14 = {\n    key: 0,\n    class: \"empty-inventory\"\n};\nconst _hoisted_15 = {\n    key: 1,\n    class: \"items-grid\"\n};\nconst _hoisted_16 = [\"onClick\"];\nconst _hoisted_17 = { class: \"item-header\" };\nconst _hoisted_18 = { class: \"item-name\" };\nconst _hoisted_19 = {\n    key: 0,\n    class: \"item-type\"\n};\nconst _hoisted_20 = { class: \"item-description\" };\nconst _hoisted_21 = {\n    key: 0,\n    class: \"item-meta\"\n};\nconst _hoisted_22 = { class: \"item-source\" };\nconst _hoisted_23 = {\n    key: 0,\n    class: \"detail-type\"\n};\nconst _hoisted_24 = { class: \"detail-description\" };\nconst _hoisted_25 = {\n    key: 1,\n    class: \"detail-meta\"\n};\nconst _hoisted_26 = { key: 0 };\nconst _hoisted_27 = { class: \"detail-actions\" };\nimport { ref } from 'vue';\nimport { useInventoryStore } from '../stores/inventoryStore';\n// ==================== Emits ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'InventoryPanel',\n    emits: [\"close\"],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        // ====================  ====================\n        const inventoryStore = useInventoryStore();\n        const currentTab = ref('realworld');\n        const selectedItem = ref(null);\n        // ====================  ====================\n        /**\n         * \n         */\n        function selectItem(item) {\n            selectedItem.value = item;\n        }\n        /**\n         * \n         */\n        function useItem() {\n            if (!selectedItem.value)\n                return;\n            toastr.info(` ${selectedItem.value.name}`);\n            // TODO: \n            selectedItem.value = null;\n        }\n        /**\n         * \n         */\n        async function discardItem() {\n            if (!selectedItem.value)\n                return;\n            const item = selectedItem.value;\n            const itemName = item.name;\n            try {\n                // \n                if (currentTab.value === 'realworld') {\n                    inventoryStore.removeFromRealWorld(item.id);\n                }\n                else {\n                    inventoryStore.removeFromInstance(item.id);\n                }\n                // \n                await inventoryStore.saveToGlobal();\n                toastr.success(`: ${itemName}`);\n                selectedItem.value = null;\n            }\n            catch (error) {\n                console.error('[InventoryPanel] :', error);\n                toastr.error('');\n            }\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"button\", {\n                    class: \"close-btn\",\n                    onClick: _cache[0] || (_cache[0] = ($event) => (_ctx.$emit('close')))\n                }, \"\"),\n                _cache[8] || (_cache[8] = _createElementVNode(\"h2\", { class: \"panel-title\" }, \"\", -1 /* CACHED */)),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"button\", {\n                        class: _normalizeClass([\"tab-btn\", { active: currentTab.value === 'realworld' }]),\n                        onClick: _cache[1] || (_cache[1] = ($event) => (currentTab.value = 'realworld'))\n                    }, \"  \", 2 /* CLASS */),\n                    _createElementVNode(\"button\", {\n                        class: _normalizeClass([\"tab-btn\", { active: currentTab.value === 'instance' }]),\n                        onClick: _cache[2] || (_cache[2] = ($event) => (currentTab.value = 'instance'))\n                    }, \"  \", 2 /* CLASS */)\n                ]),\n                _createCommentVNode(\"  \"),\n                (currentTab.value === 'realworld')\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [\n                        (_unref(inventoryStore).realWorldInventory.items.length === 0)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [...(_cache[6] || (_cache[6] = [\n                                    _createElementVNode(\"p\", null, \"\", -1 /* CACHED */)\n                                ]))]))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(inventoryStore).realWorldInventory.items, (item) => {\n                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                        key: item.id,\n                                        class: \"item-card\",\n                                        onClick: ($event) => (selectItem(item))\n                                    }, [\n                                        _createElementVNode(\"div\", _hoisted_7, [\n                                            _createElementVNode(\"span\", _hoisted_8, _toDisplayString(item.name), 1 /* TEXT */),\n                                            (item.type)\n                                                ? (_openBlock(), _createElementBlock(\"span\", _hoisted_9, _toDisplayString(item.type), 1 /* TEXT */))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ]),\n                                        _createElementVNode(\"p\", _hoisted_10, _toDisplayString(item.description), 1 /* TEXT */),\n                                        (item.fromArea)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [\n                                                _createElementVNode(\"span\", _hoisted_12, \": \" + _toDisplayString(item.fromArea), 1 /* TEXT */)\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ], 8 /* PROPS */, _hoisted_6));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]))\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (currentTab.value === 'instance')\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [\n                        (_unref(inventoryStore).instanceInventory.items.length === 0)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_14, [...(_cache[7] || (_cache[7] = [\n                                    _createElementVNode(\"p\", null, \"\", -1 /* CACHED */)\n                                ]))]))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_15, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(inventoryStore).instanceInventory.items, (item) => {\n                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                        key: item.id,\n                                        class: \"item-card\",\n                                        onClick: ($event) => (selectItem(item))\n                                    }, [\n                                        _createElementVNode(\"div\", _hoisted_17, [\n                                            _createElementVNode(\"span\", _hoisted_18, _toDisplayString(item.name), 1 /* TEXT */),\n                                            (item.type)\n                                                ? (_openBlock(), _createElementBlock(\"span\", _hoisted_19, _toDisplayString(item.type), 1 /* TEXT */))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ]),\n                                        _createElementVNode(\"p\", _hoisted_20, _toDisplayString(item.description), 1 /* TEXT */),\n                                        (item.fromArea)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_21, [\n                                                _createElementVNode(\"span\", _hoisted_22, \": \" + _toDisplayString(item.fromArea), 1 /* TEXT */)\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ], 8 /* PROPS */, _hoisted_16));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]))\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (selectedItem.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 2,\n                        class: \"item-detail-overlay\",\n                        onClick: _cache[5] || (_cache[5] = ($event) => (selectedItem.value = null))\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"item-detail-modal\",\n                            onClick: _cache[4] || (_cache[4] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createElementVNode(\"h3\", null, _toDisplayString(selectedItem.value.name), 1 /* TEXT */),\n                            (selectedItem.value.type)\n                                ? (_openBlock(), _createElementBlock(\"p\", _hoisted_23, \": \" + _toDisplayString(selectedItem.value.type), 1 /* TEXT */))\n                                : _createCommentVNode(\"v-if\", true),\n                            _createElementVNode(\"p\", _hoisted_24, _toDisplayString(selectedItem.value.description), 1 /* TEXT */),\n                            (selectedItem.value.fromArea)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_25, [\n                                    _createElementVNode(\"p\", null, \": \" + _toDisplayString(selectedItem.value.fromArea), 1 /* TEXT */),\n                                    (selectedItem.value.obtainedAt)\n                                        ? (_openBlock(), _createElementBlock(\"p\", _hoisted_26, \": \" + _toDisplayString(new Date(selectedItem.value.obtainedAt).toLocaleString()), 1 /* TEXT */))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ]))\n                                : _createCommentVNode(\"v-if\", true),\n                            _createElementVNode(\"div\", _hoisted_27, [\n                                _createElementVNode(\"button\", {\n                                    class: \"btn-action btn-use\",\n                                    onClick: useItem\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn-action btn-discard\",\n                                    onClick: discardItem\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn-action btn-close-detail\",\n                                    onClick: _cache[3] || (_cache[3] = ($event) => (selectedItem.value = null))\n                                }, \"\")\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./InventoryPanel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./InventoryPanel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./InventoryPanel.vue?vue&type=style&index=0&id=6284e47b&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6284e47b\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = { class: \"modal-title\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"loading\"\n};\nconst _hoisted_3 = {\n    key: 1,\n    class: \"details-content\"\n};\nconst _hoisted_4 = { class: \"detail-section\" };\nconst _hoisted_5 = { class: \"detail-section\" };\nconst _hoisted_6 = {\n    key: 0,\n    class: \"detail-section\"\n};\nconst _hoisted_7 = { class: \"items-list\" };\nconst _hoisted_8 = [\"onClick\"];\nconst _hoisted_9 = { class: \"item-header\" };\nconst _hoisted_10 = { class: \"item-name\" };\nconst _hoisted_11 = {\n    key: 0,\n    class: \"item-type\"\n};\nconst _hoisted_12 = { class: \"item-description\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"item-actions\"\n};\nconst _hoisted_14 = {\n    key: 1,\n    class: \"no-items\"\n};\nimport { onMounted, ref } from 'vue';\nimport { useInventoryStore } from '../stores/inventoryStore';\n// ==================== Props ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'AreaDetailsModal',\n    props: {\n        area: {},\n        isRealWorld: { type: Boolean }\n    },\n    emits: [\"close\", \"itemPickedUp\", \"detailsGenerated\"],\n    setup(__props, { emit: __emit }) {\n        const props = __props;\n        // ==================== Emits ====================\n        const emit = __emit;\n        // ====================  ====================\n        const inventoryStore = useInventoryStore();\n        const loading = ref(false);\n        const details = ref(null);\n        const selectedItem = ref(null);\n        // ====================  ====================\n        /**\n         * \n         */\n        async function loadDetails() {\n            // \n            if (props.area.details) {\n                details.value = props.area.details;\n                return;\n            }\n            // \n            loading.value = true;\n            try {\n                const { areaDetailsService } = await import('../services/areaDetailsService');\n                const generated = await areaDetailsService.generateDetails(props.area, props.isRealWorld);\n                details.value = generated;\n                // \n                emit('detailsGenerated', generated);\n            }\n            catch (error) {\n                console.error('[AreaDetailsModal] :', error);\n                toastr.error('');\n            }\n            finally {\n                loading.value = false;\n            }\n        }\n        /**\n         * \n         */\n        function selectItem(item) {\n            selectedItem.value = item;\n            console.log(`[AreaDetailsModal] : ${item.name}`);\n        }\n        /**\n         * \n         */\n        async function pickupItem() {\n            if (!selectedItem.value || !details.value)\n                return;\n            const item = selectedItem.value;\n            try {\n                // \n                item.obtainedAt = Date.now();\n                item.fromArea = props.area.name;\n                // \n                if (props.isRealWorld) {\n                    inventoryStore.addToRealWorld(item);\n                }\n                else {\n                    inventoryStore.addToInstance(item);\n                }\n                // \n                const index = details.value.items.findIndex(i => i.id === item.id);\n                if (index !== -1) {\n                    details.value.items.splice(index, 1);\n                }\n                // \n                await inventoryStore.saveToGlobal();\n                // \n                emit('itemPickedUp', item.id);\n                toastr.success(`: ${item.name}`);\n                selectedItem.value = null;\n            }\n            catch (error) {\n                console.error('[AreaDetailsModal] :', error);\n                toastr.error('');\n            }\n        }\n        // ====================  ====================\n        onMounted(() => {\n            loadDetails();\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: \"area-details-modal-overlay\",\n                onClick: _cache[3] || (_cache[3] = ($event) => (_ctx.$emit('close')))\n            }, [\n                _createElementVNode(\"div\", {\n                    class: \"area-details-modal\",\n                    onClick: _cache[2] || (_cache[2] = _withModifiers(() => { }, [\"stop\"]))\n                }, [\n                    _createElementVNode(\"button\", {\n                        class: \"close-btn\",\n                        onClick: _cache[0] || (_cache[0] = ($event) => (_ctx.$emit('close')))\n                    }, \"\"),\n                    _createElementVNode(\"h2\", _hoisted_1, _toDisplayString(__props.area.name), 1 /* TEXT */),\n                    (loading.value)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [...(_cache[4] || (_cache[4] = [\n                                _createElementVNode(\"p\", null, \"...\", -1 /* CACHED */)\n                            ]))]))\n                        : (details.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"div\", _hoisted_4, [\n                                    _cache[5] || (_cache[5] = _createElementVNode(\"h3\", null, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"p\", null, _toDisplayString(details.value.environment), 1 /* TEXT */)\n                                ]),\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"div\", _hoisted_5, [\n                                    _cache[6] || (_cache[6] = _createElementVNode(\"h3\", null, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"p\", null, _toDisplayString(details.value.atmosphere), 1 /* TEXT */)\n                                ]),\n                                _createCommentVNode(\"  \"),\n                                (details.value.items && details.value.items.length > 0)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [\n                                        _cache[7] || (_cache[7] = _createElementVNode(\"h3\", null, \"\", -1 /* CACHED */)),\n                                        _createElementVNode(\"div\", _hoisted_7, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(details.value.items, (item) => {\n                                                return (_openBlock(), _createElementBlock(\"div\", {\n                                                    key: item.id,\n                                                    class: _normalizeClass([\"item-card\", { selected: selectedItem.value?.id === item.id }]),\n                                                    onClick: ($event) => (selectItem(item))\n                                                }, [\n                                                    _createElementVNode(\"div\", _hoisted_9, [\n                                                        _createElementVNode(\"span\", _hoisted_10, _toDisplayString(item.name), 1 /* TEXT */),\n                                                        (item.type)\n                                                            ? (_openBlock(), _createElementBlock(\"span\", _hoisted_11, _toDisplayString(item.type), 1 /* TEXT */))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ]),\n                                                    _createElementVNode(\"p\", _hoisted_12, _toDisplayString(item.description), 1 /* TEXT */)\n                                                ], 10 /* CLASS, PROPS */, _hoisted_8));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ]),\n                                        _createCommentVNode(\"  \"),\n                                        (selectedItem.value)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn-action btn-pickup\",\n                                                    onClick: pickupItem\n                                                }, \"\"),\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn-action btn-cancel-item\",\n                                                    onClick: _cache[1] || (_cache[1] = ($event) => (selectedItem.value = null))\n                                                }, \"\")\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ]))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_14, [...(_cache[8] || (_cache[8] = [\n                                            _createElementVNode(\"p\", null, \"\", -1 /* CACHED */)\n                                        ]))]))\n                            ]))\n                            : _createCommentVNode(\"v-if\", true)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./AreaDetailsModal.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./AreaDetailsModal.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./AreaDetailsModal.vue?vue&type=style&index=0&id=3cc40fe2&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3cc40fe2\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, normalizeClass as _normalizeClass, unref as _unref, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = { class: \"map-panel\" };\nconst _hoisted_2 = { class: \"map-header\" };\nconst _hoisted_3 = { class: \"map-tabs\" };\nconst _hoisted_4 = {\n    key: 0,\n    class: \"instance-name\"\n};\nconst _hoisted_5 = { key: 0 };\nconst _hoisted_6 = {\n    key: 0,\n    class: \"no-map\"\n};\nconst _hoisted_7 = { key: 1 };\nconst _hoisted_8 = {\n    key: 0,\n    class: \"current-area\"\n};\nconst _hoisted_9 = { class: \"area-card current\" };\nconst _hoisted_10 = { class: \"area-name\" };\nconst _hoisted_11 = {\n    key: 0,\n    class: \"area-description\"\n};\nconst _hoisted_12 = {\n    key: 1,\n    class: \"connected-areas\"\n};\nconst _hoisted_13 = { class: \"areas-list\" };\nconst _hoisted_14 = [\"onClick\"];\nconst _hoisted_15 = { class: \"area-name\" };\nconst _hoisted_16 = {\n    key: 0,\n    class: \"area-description\"\n};\nconst _hoisted_17 = {\n    key: 0,\n    class: \"action-buttons\"\n};\nconst _hoisted_18 = { key: 1 };\nconst _hoisted_19 = {\n    key: 0,\n    class: \"no-map\"\n};\nconst _hoisted_20 = { key: 1 };\nconst _hoisted_21 = {\n    key: 0,\n    class: \"current-area\"\n};\nconst _hoisted_22 = { class: \"area-card current\" };\nconst _hoisted_23 = { class: \"area-name\" };\nconst _hoisted_24 = {\n    key: 0,\n    class: \"area-description\"\n};\nconst _hoisted_25 = {\n    key: 1,\n    class: \"connected-areas\"\n};\nconst _hoisted_26 = { class: \"areas-list\" };\nconst _hoisted_27 = [\"onClick\"];\nconst _hoisted_28 = { class: \"area-name\" };\nconst _hoisted_29 = {\n    key: 0,\n    class: \"area-description\"\n};\nconst _hoisted_30 = {\n    key: 0,\n    class: \"action-buttons\"\n};\nimport { computed, onMounted, ref } from 'vue';\nimport { useCharacterStore } from '../stores/characterStore';\nimport { useInstanceStore } from '../stores/instanceStore';\nimport { useInventoryStore } from '../stores/inventoryStore';\nimport AreaDetailsModal from './AreaDetailsModal.vue';\n// ==================== Emits ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'MapPanel',\n    emits: [\"close\"],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        const instanceStore = useInstanceStore();\n        const characterStore = useCharacterStore();\n        const inventoryStore = useInventoryStore();\n        const isMoving = ref(false);\n        const currentTab = ref('realworld');\n        const realWorldMap = ref(null);\n        const selectedRealWorldArea = ref(null);\n        const selectedInstanceArea = ref(null);\n        const showAreaDetails = ref(false);\n        const areaToView = ref(null);\n        const isViewingRealWorld = ref(false);\n        // \n        const currentRealWorldArea = computed(() => {\n            if (!realWorldMap.value)\n                return null;\n            const playerLocation = realWorldMap.value.playerLocation;\n            return realWorldMap.value.areas.get(playerLocation) || null;\n        });\n        // \n        const connectedRealWorldAreas = computed(() => {\n            if (!currentRealWorldArea.value)\n                return [];\n            return currentRealWorldArea.value.connectedAreas\n                .map(areaId => realWorldMap.value?.areas.get(areaId))\n                .filter((area) => area !== undefined);\n        });\n        // \n        async function loadRealWorldMap() {\n            try {\n                const { realWorldMapService } = await import('../services/realWorldMapService');\n                realWorldMap.value = await realWorldMapService.loadMap();\n                console.log('[MapPanel] :', realWorldMap.value ? '' : '');\n            }\n            catch (error) {\n                console.error('[MapPanel] :', error);\n            }\n        }\n        // \n        async function generateRealWorldMap() {\n            if (!characterStore.player) {\n                toastr.error('');\n                return;\n            }\n            try {\n                toastr.info('...');\n                const { realWorldMapService } = await import('../services/realWorldMapService');\n                realWorldMap.value = await realWorldMapService.generateMap(characterStore.player);\n                toastr.success('');\n            }\n            catch (error) {\n                console.error('[MapPanel] :', error);\n                toastr.error('');\n            }\n        }\n        // \n        function selectRealWorldArea(area) {\n            if (area.id === currentRealWorldArea.value?.id) {\n                toastr.info('');\n                return;\n            }\n            selectedRealWorldArea.value = area;\n            selectedInstanceArea.value = null; // \n            console.log(`[Map Panel] : ${area.name}`);\n        }\n        // \n        function selectInstanceArea(area) {\n            if (area.id === instanceStore.currentArea?.id) {\n                toastr.info('');\n                return;\n            }\n            selectedInstanceArea.value = area;\n            selectedRealWorldArea.value = null; // \n            console.log(`[Map Panel] : ${area.name}`);\n        }\n        // \n        async function moveToRealWorldArea() {\n            if (!selectedRealWorldArea.value || isMoving.value)\n                return;\n            const targetArea = selectedRealWorldArea.value;\n            try {\n                isMoving.value = true;\n                // \n                const { realWorldMapService } = await import('../services/realWorldMapService');\n                await realWorldMapService.updatePlayerLocation(targetArea.id);\n                // \n                await loadRealWorldMap();\n                // \n                selectedRealWorldArea.value = null;\n                toastr.success(`: ${targetArea.name}`);\n                console.log(`[Map Panel] : ${targetArea.name}`);\n            }\n            catch (error) {\n                console.error('[Map Panel] :', error);\n                toastr.error('');\n            }\n            finally {\n                isMoving.value = false;\n            }\n        }\n        // \n        async function confirmMoveToRealWorld() {\n            if (isMoving.value)\n                return;\n            const playerName = characterStore.player?.name || '';\n            const currentLocation = currentRealWorldArea.value?.name || '';\n            try {\n                isMoving.value = true;\n                // \n                const message = `${playerName}${currentLocation}`;\n                console.log(`[Map Panel] : ${message}`);\n                //  generate  AI \n                await generate({ user_input: message });\n                toastr.success('');\n                // \n                emit('close');\n            }\n            catch (error) {\n                console.error('[Map Panel] :', error);\n                toastr.error('');\n            }\n            finally {\n                isMoving.value = false;\n            }\n        }\n        // \n        async function moveToInstanceArea() {\n            if (!selectedInstanceArea.value || isMoving.value)\n                return;\n            const targetArea = selectedInstanceArea.value;\n            try {\n                isMoving.value = true;\n                // \n                await instanceStore.updatePlayerLocation(targetArea.id);\n                if (!targetArea.isDiscovered) {\n                    await instanceStore.discoverArea(targetArea.id);\n                }\n                // \n                selectedInstanceArea.value = null;\n                toastr.success(`: ${targetArea.name}`);\n                console.log(`[Map Panel] : ${targetArea.name}`);\n            }\n            catch (error) {\n                console.error('[Map Panel] :', error);\n                toastr.error('');\n            }\n            finally {\n                isMoving.value = false;\n            }\n        }\n        // \n        async function confirmMoveToInstance() {\n            if (isMoving.value)\n                return;\n            const playerName = characterStore.player?.name || '';\n            const currentLocation = instanceStore.currentArea?.name || '';\n            try {\n                isMoving.value = true;\n                // \n                const message = `${playerName}${currentLocation}`;\n                console.log(`[Map Panel] : ${message}`);\n                //  generate  AI \n                await generate({ user_input: message });\n                toastr.success('');\n                // \n                emit('close');\n            }\n            catch (error) {\n                console.error('[Map Panel] :', error);\n                toastr.error('');\n            }\n            finally {\n                isMoving.value = false;\n            }\n        }\n        // \n        function viewRealWorldAreaDetails() {\n            if (!currentRealWorldArea.value)\n                return;\n            viewAreaDetails(currentRealWorldArea.value, true);\n        }\n        // \n        function viewInstanceAreaDetails() {\n            if (!instanceStore.currentArea)\n                return;\n            viewAreaDetails(instanceStore.currentArea, false);\n        }\n        // \n        function viewAreaDetails(area, isRealWorld) {\n            areaToView.value = area;\n            isViewingRealWorld.value = isRealWorld;\n            showAreaDetails.value = true;\n        }\n        // \n        function closeAreaDetails() {\n            showAreaDetails.value = false;\n            areaToView.value = null;\n        }\n        // \n        async function handleDetailsGenerated(details) {\n            if (!areaToView.value)\n                return;\n            try {\n                // \n                areaToView.value.details = details;\n                // \n                if (isViewingRealWorld.value) {\n                    const { realWorldMapService } = await import('../services/realWorldMapService');\n                    if (realWorldMap.value) {\n                        await realWorldMapService.saveMap(realWorldMap.value);\n                    }\n                }\n                else {\n                    await instanceStore.saveToMVU();\n                }\n                console.log('[MapPanel] ');\n            }\n            catch (error) {\n                console.error('[MapPanel] :', error);\n            }\n        }\n        // \n        async function handleItemPickedUp() {\n            try {\n                // \n                if (isViewingRealWorld.value) {\n                    const { realWorldMapService } = await import('../services/realWorldMapService');\n                    if (realWorldMap.value) {\n                        await realWorldMapService.saveMap(realWorldMap.value);\n                    }\n                }\n                else {\n                    await instanceStore.saveToMVU();\n                }\n                console.log('[MapPanel] ');\n            }\n            catch (error) {\n                console.error('[MapPanel] :', error);\n            }\n        }\n        onMounted(async () => {\n            try {\n                await loadRealWorldMap();\n                await inventoryStore.loadFromGlobal();\n            }\n            catch (error) {\n                console.error('[MapPanel] :', error);\n                // \n            }\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _cache[2] || (_cache[2] = _createElementVNode(\"h2\", null, \"\", -1 /* CACHED */)),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"tab-btn\", { active: currentTab.value === 'realworld' }]),\n                            onClick: _cache[0] || (_cache[0] = ($event) => (currentTab.value = 'realworld'))\n                        }, \"  \", 2 /* CLASS */),\n                        (_unref(instanceStore).currentInstance)\n                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                key: 0,\n                                class: _normalizeClass([\"tab-btn\", { active: currentTab.value === 'instance' }]),\n                                onClick: _cache[1] || (_cache[1] = ($event) => (currentTab.value = 'instance'))\n                            }, \"  \", 2 /* CLASS */))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    (currentTab.value === 'instance' && _unref(instanceStore).currentInstance)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, _toDisplayString(_unref(instanceStore).currentInstance.name), 1 /* TEXT */))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _createCommentVNode(\"  \"),\n                (currentTab.value === 'realworld')\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [\n                        (!realWorldMap.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [\n                                _cache[3] || (_cache[3] = _createElementVNode(\"p\", null, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn-generate\",\n                                    onClick: generateRealWorldMap\n                                }, \"\")\n                            ]))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [\n                                (currentRealWorldArea.value)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, [\n                                        _cache[4] || (_cache[4] = _createElementVNode(\"h3\", null, \"\", -1 /* CACHED */)),\n                                        _createElementVNode(\"div\", _hoisted_9, [\n                                            _createElementVNode(\"div\", _hoisted_10, _toDisplayString(currentRealWorldArea.value.name), 1 /* TEXT */),\n                                            (currentRealWorldArea.value.description)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, _toDisplayString(currentRealWorldArea.value.description), 1 /* TEXT */))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn-view-details\",\n                                                onClick: viewRealWorldAreaDetails\n                                            }, \"\")\n                                        ])\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true),\n                                (connectedRealWorldAreas.value.length > 0)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_12, [\n                                        _cache[5] || (_cache[5] = _createElementVNode(\"h3\", null, \"\", -1 /* CACHED */)),\n                                        _createElementVNode(\"div\", _hoisted_13, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(connectedRealWorldAreas.value, (area) => {\n                                                return (_openBlock(), _createElementBlock(\"div\", {\n                                                    key: area.id,\n                                                    class: _normalizeClass([\"area-card\", { discovered: area.isDiscovered, selected: selectedRealWorldArea.value?.id === area.id }]),\n                                                    onClick: ($event) => (selectRealWorldArea(area))\n                                                }, [\n                                                    _createElementVNode(\"div\", _hoisted_15, _toDisplayString(area.isDiscovered ? area.name : '???'), 1 /* TEXT */),\n                                                    (area.isDiscovered && area.description)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_16, _toDisplayString(area.description), 1 /* TEXT */))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ], 10 /* CLASS, PROPS */, _hoisted_14));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ]),\n                                        _createCommentVNode(\"  \"),\n                                        (selectedRealWorldArea.value)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn-action btn-move\",\n                                                    onClick: moveToRealWorldArea\n                                                }, \"\"),\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn-action btn-confirm\",\n                                                    onClick: confirmMoveToRealWorld\n                                                }, \"\")\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]))\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (currentTab.value === 'instance')\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_18, [\n                        (!_unref(instanceStore).currentInstance)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_19, [...(_cache[6] || (_cache[6] = [\n                                    _createElementVNode(\"p\", null, \"\", -1 /* CACHED */)\n                                ]))]))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_20, [\n                                (_unref(instanceStore).currentArea)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_21, [\n                                        _cache[7] || (_cache[7] = _createElementVNode(\"h3\", null, \"\", -1 /* CACHED */)),\n                                        _createElementVNode(\"div\", _hoisted_22, [\n                                            _createElementVNode(\"div\", _hoisted_23, _toDisplayString(_unref(instanceStore).currentArea.name), 1 /* TEXT */),\n                                            (_unref(instanceStore).currentArea.description)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_24, _toDisplayString(_unref(instanceStore).currentArea.description), 1 /* TEXT */))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn-view-details\",\n                                                onClick: viewInstanceAreaDetails\n                                            }, \"\")\n                                        ])\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true),\n                                (_unref(instanceStore).connectedAreas.length > 0)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_25, [\n                                        _cache[8] || (_cache[8] = _createElementVNode(\"h3\", null, \"\", -1 /* CACHED */)),\n                                        _createElementVNode(\"div\", _hoisted_26, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(instanceStore).connectedAreas, (area) => {\n                                                return (_openBlock(), _createElementBlock(\"div\", {\n                                                    key: area.id,\n                                                    class: _normalizeClass([\"area-card\", { discovered: area.isDiscovered, selected: selectedInstanceArea.value?.id === area.id }]),\n                                                    onClick: ($event) => (selectInstanceArea(area))\n                                                }, [\n                                                    _createElementVNode(\"div\", _hoisted_28, _toDisplayString(area.isDiscovered ? area.name : '???'), 1 /* TEXT */),\n                                                    (area.isDiscovered && area.description)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_29, _toDisplayString(area.description), 1 /* TEXT */))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ], 10 /* CLASS, PROPS */, _hoisted_27));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ]),\n                                        _createCommentVNode(\"  \"),\n                                        (selectedInstanceArea.value)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_30, [\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn-action btn-move\",\n                                                    onClick: moveToInstanceArea\n                                                }, \"\"),\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn-action btn-confirm\",\n                                                    onClick: confirmMoveToInstance\n                                                }, \"\")\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]))\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showAreaDetails.value && areaToView.value)\n                    ? (_openBlock(), _createBlock(AreaDetailsModal, {\n                        key: 2,\n                        area: areaToView.value,\n                        \"is-real-world\": isViewingRealWorld.value,\n                        onClose: closeAreaDetails,\n                        onItemPickedUp: handleItemPickedUp,\n                        onDetailsGenerated: handleDetailsGenerated\n                    }, null, 8 /* PROPS */, [\"area\", \"is-real-world\"]))\n                    : _createCommentVNode(\"v-if\", true)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./MapPanel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./MapPanel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./MapPanel.vue?vue&type=style&index=0&id=4ba1ef10&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4ba1ef10\"]])\n\nexport default __exports__","/**\n * \n * \n */\n\nimport { klona } from 'klona';\nimport { useInstanceStore } from '../stores/instanceStore';\nimport type { ImportantEvent } from '../types/instance';\nimport type { MemoryEvent } from './memoryFragmentService';\nimport { memoryFragmentService } from './memoryFragmentService';\n\n/**\n * \n */\nexport interface JournalEntry {\n  id: string;\n  authorId: string; //  ID  NPC ID\n  authorName: string;\n  content: string; // \n  relatedEvents: string[]; //  ID\n  relatedMemories: string[]; //  ID\n  createdAt: number;\n  editedAt?: number;\n}\n\n/**\n * \n */\nclass JournalService {\n  private initialized = false;\n\n  /**\n   * \n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      console.log('[Journal Service] ');\n      return;\n    }\n\n    console.log('[Journal Service] ...');\n\n    // \n    const entries = await this.getAllJournals();\n    if (!entries) {\n      await this.saveAllJournals([]);\n    }\n\n    this.initialized = true;\n    console.log('[Journal Service] ');\n  }\n\n  /**\n   * \n   * @param authorId  ID NPC\n   * @param authorName \n   * @param isPlayerCharacter \n   * @returns \n   */\n  async generateJournalDraft(authorId: string, authorName: string, isPlayerCharacter: boolean): Promise<string> {\n    //  withAPIContext  sanctuary API\n    //  AI  API\n    return await withAPIContext('sanctuary', async () => {\n      try {\n        console.log(`[Journal Service]  ${authorName} ...`);\n\n        // \n        const events = await this.getRelevantEvents(authorId, isPlayerCharacter);\n\n        // \n        const memories = await this.getRelevantMemories(authorId, isPlayerCharacter);\n\n        // \n        const prompt = this.buildJournalPrompt(authorName, events, memories, isPlayerCharacter);\n\n        const requestParams: any = {\n          ordered_prompts: [{ role: 'user', content: prompt }],\n        };\n\n        //  custom_api withAPIContext  API \n        console.log('[Journal Service]  API ');\n\n        //  generateRaw \n        const journalContent = await generateRaw(requestParams);\n\n        console.log(`[Journal Service] : ${journalContent.length}`);\n        return journalContent;\n      } catch (error) {\n        console.error('[Journal Service] :', error);\n        throw error;\n      }\n    });\n  }\n\n  /**\n   * \n   */\n  private buildJournalPrompt(\n    authorName: string,\n    events: ImportantEvent[],\n    memories: MemoryEvent[],\n    _isPlayerCharacter: boolean,\n  ): string {\n    let prompt = ` ${authorName}\\n\\n`;\n\n    prompt += `****\\n`;\n    prompt += `1. \"\"\\n`;\n    prompt += `2. \"...\"\"...\"\\n`;\n    prompt += `3. \\n`;\n    prompt += `4.  200-500 \\n`;\n    prompt += `5. \\n\\n`;\n\n    // \n    if (events.length > 0) {\n      prompt += `****\\n`;\n      events.slice(0, 5).forEach((event, index) => {\n        prompt += `${index + 1}. ${event.summary}\\n`;\n      });\n      prompt += `\\n`;\n    }\n\n    // \n    if (memories.length > 0) {\n      prompt += `****\\n`;\n      memories.slice(0, 5).forEach((memory, index) => {\n        prompt += `${index + 1}. ${memory.description}\\n`;\n      });\n      prompt += `\\n`;\n    }\n\n    if (events.length === 0 && memories.length === 0) {\n      prompt += `\\n\\n`;\n    }\n\n    prompt += ` ${authorName} `;\n\n    return prompt;\n  }\n\n  /**\n   * \n   * @param authorId  ID\n   * @param isPlayerCharacter \n   * @returns \n   */\n  async getRelevantEvents(authorId: string, isPlayerCharacter: boolean): Promise<ImportantEvent[]> {\n    try {\n      const instanceStore = useInstanceStore();\n      const allInstances = instanceStore.getAllInstances();\n\n      if (isPlayerCharacter) {\n        // \n        const allEvents: ImportantEvent[] = [];\n        for (const instance of allInstances) {\n          if (instance.events && instance.events.length > 0) {\n            allEvents.push(...instance.events);\n          }\n        }\n        // \n        return allEvents.sort((a, b) => b.timestamp - a.timestamp);\n      } else {\n        // NPC NPC \n        const npcInstances = allInstances.filter(instance =>\n          instance.characters.some(char => char.characterId === authorId),\n        );\n\n        const npcEvents: ImportantEvent[] = [];\n        for (const instance of npcInstances) {\n          if (instance.events && instance.events.length > 0) {\n            //  NPC \n            const relevantEvents = instance.events.filter(\n              event => event.involvedCharacters && event.involvedCharacters.includes(authorId),\n            );\n            npcEvents.push(...relevantEvents);\n          }\n        }\n\n        // \n        return npcEvents.sort((a, b) => b.timestamp - a.timestamp);\n      }\n    } catch (error) {\n      console.error('[Journal Service] :', error);\n      return [];\n    }\n  }\n\n  /**\n   * \n   * @param authorId  ID\n   * @param isPlayerCharacter \n   * @returns \n   */\n  async getRelevantMemories(authorId: string, isPlayerCharacter: boolean): Promise<MemoryEvent[]> {\n    try {\n      if (isPlayerCharacter) {\n        //  NPC \n        const allArchives = await memoryFragmentService.getAllArchives();\n        const allMemories: MemoryEvent[] = [];\n\n        for (const archive of allArchives) {\n          if (archive.memories && archive.memories.length > 0) {\n            allMemories.push(...archive.memories);\n          }\n        }\n\n        // \n        return allMemories.sort((a, b) => b.timestamp - a.timestamp);\n      } else {\n        // NPC NPC \n        const archive = await memoryFragmentService.getArchive(authorId);\n        if (archive && archive.memories) {\n          // \n          return [...archive.memories].sort((a, b) => b.timestamp - a.timestamp);\n        }\n        return [];\n      }\n    } catch (error) {\n      console.error('[Journal Service] :', error);\n      return [];\n    }\n  }\n\n  /**\n   * \n   * @param entry \n   */\n  async saveJournal(entry: JournalEntry): Promise<void> {\n    try {\n      const entries = await this.getAllJournals();\n      entries.push(entry);\n      await this.saveAllJournals(entries);\n      console.log(`[Journal Service] : ${entry.authorName} - ${entry.id}`);\n      toastr.success('');\n    } catch (error) {\n      console.error('[Journal Service] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @param journalId  ID\n   * @param content \n   */\n  async updateJournal(journalId: string, content: string): Promise<void> {\n    try {\n      const entries = await this.getAllJournals();\n      const entry = entries.find(e => e.id === journalId);\n\n      if (!entry) {\n        throw new Error(`: ${journalId}`);\n      }\n\n      entry.content = content;\n      entry.editedAt = Date.now();\n\n      await this.saveAllJournals(entries);\n      console.log(`[Journal Service] : ${journalId}`);\n      toastr.success('');\n    } catch (error) {\n      console.error('[Journal Service] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @param journalId  ID\n   */\n  async deleteJournal(journalId: string): Promise<void> {\n    try {\n      const entries = await this.getAllJournals();\n      const filteredEntries = entries.filter(e => e.id !== journalId);\n\n      if (filteredEntries.length === entries.length) {\n        throw new Error(`: ${journalId}`);\n      }\n\n      await this.saveAllJournals(filteredEntries);\n      console.log(`[Journal Service] : ${journalId}`);\n      toastr.success('');\n    } catch (error) {\n      console.error('[Journal Service] :', error);\n      toastr.error('');\n      throw error;\n    }\n  }\n\n  /**\n   * \n   * @param authorId  ID\n   * @returns \n   */\n  async getJournalsByAuthor(authorId: string): Promise<JournalEntry[]> {\n    try {\n      const entries = await this.getAllJournals();\n      return entries.filter(e => e.authorId === authorId).sort((a, b) => b.createdAt - a.createdAt); // \n    } catch (error) {\n      console.error('[Journal Service] :', error);\n      return [];\n    }\n  }\n\n  /**\n   * \n   * @returns \n   */\n  async getAllJournals(): Promise<JournalEntry[]> {\n    try {\n      const allVars = getVariables({ type: 'global' });\n      const data = allVars.journal_entries;\n      return data || [];\n    } catch (error) {\n      console.error('[Journal Service] :', error);\n      return [];\n    }\n  }\n\n  /**\n   * \n   * @param entries \n   */\n  private async saveAllJournals(entries: JournalEntry[]): Promise<void> {\n    try {\n      //  klona  Vue Proxy \n      const cleanEntries = klona(entries);\n      await insertOrAssignVariables({ journal_entries: cleanEntries }, { type: 'global' });\n    } catch (error) {\n      console.error('[Journal Service] :', error);\n      throw error;\n    }\n  }\n\n  /**\n   *  ID\n   */\n  generateId(): string {\n    return `journal_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n}\n\n// \nexport const journalService = new JournalService();\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, renderList as _renderList, Fragment as _Fragment, vModelSelect as _vModelSelect, withDirectives as _withDirectives, normalizeClass as _normalizeClass, vModelText as _vModelText } from \"vue\";\nconst _hoisted_1 = { class: \"journal-view\" };\nconst _hoisted_2 = { class: \"panel-content\" };\nconst _hoisted_3 = { class: \"journal-list\" };\nconst _hoisted_4 = { class: \"author-selector\" };\nconst _hoisted_5 = { label: \"\" };\nconst _hoisted_6 = [\"value\"];\nconst _hoisted_7 = {\n    key: 0,\n    label: \"NPC\"\n};\nconst _hoisted_8 = [\"value\"];\nconst _hoisted_9 = { class: \"history-section\" };\nconst _hoisted_10 = { class: \"section-title\" };\nconst _hoisted_11 = {\n    key: 0,\n    class: \"journal-items\"\n};\nconst _hoisted_12 = [\"onClick\"];\nconst _hoisted_13 = { class: \"journal-header\" };\nconst _hoisted_14 = { class: \"journal-date\" };\nconst _hoisted_15 = {\n    key: 0,\n    class: \"journal-edited\"\n};\nconst _hoisted_16 = { class: \"journal-preview\" };\nconst _hoisted_17 = {\n    key: 1,\n    class: \"empty-state\"\n};\nconst _hoisted_18 = { class: \"journal-editor\" };\nconst _hoisted_19 = {\n    key: 0,\n    class: \"editor-content\"\n};\nconst _hoisted_20 = { class: \"editor-header\" };\nconst _hoisted_21 = { class: \"editor-title\" };\nconst _hoisted_22 = { class: \"editor-actions\" };\nconst _hoisted_23 = [\"disabled\"];\nconst _hoisted_24 = [\"disabled\"];\nconst _hoisted_25 = { class: \"editor-body\" };\nconst _hoisted_26 = [\"placeholder\", \"disabled\"];\nconst _hoisted_27 = {\n    key: 1,\n    class: \"empty-editor\"\n};\nimport { computed, onMounted, ref, watch } from 'vue';\nimport { journalService } from '../services/journalService';\nimport { useCharacterStore } from '../stores/characterStore';\nimport { useInstanceStore } from '../stores/instanceStore';\n// ==================== Props & Emits ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'JournalView',\n    emits: [\"close\"],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        // ==================== Stores ====================\n        const characterStore = useCharacterStore();\n        const instanceStore = useInstanceStore();\n        // ====================  ====================\n        const selectedAuthorId = ref('');\n        const selectedJournalId = ref('');\n        const journalContent = ref('');\n        const authorJournals = ref([]);\n        const isGenerating = ref(false);\n        const isSaving = ref(false);\n        // ====================  ====================\n        const playerCharacter = computed(() => characterStore.player);\n        const placeholderText = computed(() => {\n            return '...\\n\\n\"\" AI ';\n        });\n        const availableNPCs = computed(() => {\n            //  NPC\n            const allInstances = instanceStore.getAllInstances();\n            const npcMap = new Map();\n            for (const instance of allInstances) {\n                for (const charInInstance of instance.characters) {\n                    if (charInInstance.character && !npcMap.has(charInInstance.characterId)) {\n                        npcMap.set(charInInstance.characterId, {\n                            id: charInInstance.characterId,\n                            name: charInInstance.character.name,\n                        });\n                    }\n                }\n            }\n            return Array.from(npcMap.values());\n        });\n        // ====================  ====================\n        /**\n         * \n         */\n        onMounted(async () => {\n            await journalService.initialize();\n            // \n            if (playerCharacter.value) {\n                selectedAuthorId.value = playerCharacter.value.id;\n                await loadAuthorJournals();\n            }\n        });\n        /**\n         * \n         */\n        watch(selectedAuthorId, async () => {\n            await loadAuthorJournals();\n            // \n            selectedJournalId.value = '';\n            journalContent.value = '';\n        });\n        /**\n         * \n         */\n        async function onAuthorChange() {\n            await loadAuthorJournals();\n        }\n        /**\n         * \n         */\n        async function loadAuthorJournals() {\n            if (!selectedAuthorId.value) {\n                authorJournals.value = [];\n                return;\n            }\n            try {\n                authorJournals.value = await journalService.getJournalsByAuthor(selectedAuthorId.value);\n            }\n            catch (error) {\n                console.error('[JournalView] :', error);\n                toastr.error('');\n            }\n        }\n        /**\n         * \n         */\n        function selectJournal(journalId) {\n            const journal = authorJournals.value.find(j => j.id === journalId);\n            if (journal) {\n                selectedJournalId.value = journal.id;\n                journalContent.value = journal.content;\n            }\n        }\n        /**\n         * \n         */\n        async function generateDraft() {\n            if (!selectedAuthorId.value) {\n                toastr.warning('');\n                return;\n            }\n            try {\n                isGenerating.value = true;\n                // \n                const authorName = getAuthorName();\n                const isPlayerCharacter = selectedAuthorId.value === playerCharacter.value?.id;\n                // \n                const draft = await journalService.generateJournalDraft(selectedAuthorId.value, authorName, isPlayerCharacter);\n                journalContent.value = draft;\n                toastr.success('');\n            }\n            catch (error) {\n                console.error('[JournalView] :', error);\n                toastr.error('');\n            }\n            finally {\n                isGenerating.value = false;\n            }\n        }\n        /**\n         * \n         */\n        async function saveJournal() {\n            if (!selectedAuthorId.value) {\n                toastr.warning('');\n                return;\n            }\n            if (!journalContent.value.trim()) {\n                toastr.warning('');\n                return;\n            }\n            try {\n                isSaving.value = true;\n                if (selectedJournalId.value) {\n                    // \n                    await journalService.updateJournal(selectedJournalId.value, journalContent.value);\n                }\n                else {\n                    // \n                    const newJournal = {\n                        id: journalService.generateId(),\n                        authorId: selectedAuthorId.value,\n                        authorName: getAuthorName(),\n                        content: journalContent.value,\n                        relatedEvents: [],\n                        relatedMemories: [],\n                        createdAt: Date.now(),\n                    };\n                    await journalService.saveJournal(newJournal);\n                    selectedJournalId.value = newJournal.id;\n                }\n                // \n                await loadAuthorJournals();\n            }\n            catch (error) {\n                console.error('[JournalView] :', error);\n            }\n            finally {\n                isSaving.value = false;\n            }\n        }\n        /**\n         * \n         */\n        function confirmDelete() {\n            if (!selectedJournalId.value) {\n                return;\n            }\n            if (confirm('')) {\n                deleteJournal();\n            }\n        }\n        /**\n         * \n         */\n        async function deleteJournal() {\n            if (!selectedJournalId.value) {\n                return;\n            }\n            try {\n                await journalService.deleteJournal(selectedJournalId.value);\n                // \n                selectedJournalId.value = '';\n                journalContent.value = '';\n                // \n                await loadAuthorJournals();\n            }\n            catch (error) {\n                console.error('[JournalView] :', error);\n            }\n        }\n        /**\n         * \n         */\n        function createNew() {\n            selectedJournalId.value = '';\n            journalContent.value = '';\n        }\n        /**\n         * \n         */\n        function getAuthorName() {\n            if (selectedAuthorId.value === playerCharacter.value?.id) {\n                return playerCharacter.value.name;\n            }\n            const npc = availableNPCs.value.find(n => n.id === selectedAuthorId.value);\n            return npc?.name || '';\n        }\n        /**\n         * \n         */\n        function formatDate(timestamp) {\n            const date = new Date(timestamp);\n            const year = date.getFullYear();\n            const month = String(date.getMonth() + 1).padStart(2, '0');\n            const day = String(date.getDate()).padStart(2, '0');\n            const hours = String(date.getHours()).padStart(2, '0');\n            const minutes = String(date.getMinutes()).padStart(2, '0');\n            return `${year}-${month}-${day} ${hours}:${minutes}`;\n        }\n        /**\n         * \n         */\n        function getPreview(content) {\n            const maxLength = 60;\n            if (content.length <= maxLength) {\n                return content;\n            }\n            return content.substring(0, maxLength) + '...';\n        }\n        /**\n         * \n         */\n        function close() {\n            emit('close');\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", { class: \"panel-header\" }, [\n                    _cache[2] || (_cache[2] = _createElementVNode(\"h2\", { class: \"panel-title\" }, \"\", -1 /* CACHED */)),\n                    _createElementVNode(\"button\", {\n                        class: \"btn-close\",\n                        onClick: close\n                    }, \"\")\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _cache[4] || (_cache[4] = _createElementVNode(\"label\", { for: \"author-select\" }, \"\", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"select\", {\n                                id: \"author-select\",\n                                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((selectedAuthorId).value = $event)),\n                                onChange: onAuthorChange\n                            }, [\n                                _cache[3] || (_cache[3] = _createElementVNode(\"option\", { value: \"\" }, \"--  --\", -1 /* CACHED */)),\n                                _createElementVNode(\"optgroup\", _hoisted_5, [\n                                    (playerCharacter.value)\n                                        ? (_openBlock(), _createElementBlock(\"option\", {\n                                            key: 0,\n                                            value: playerCharacter.value.id\n                                        }, _toDisplayString(playerCharacter.value.name), 9 /* TEXT, PROPS */, _hoisted_6))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ]),\n                                (availableNPCs.value.length > 0)\n                                    ? (_openBlock(), _createElementBlock(\"optgroup\", _hoisted_7, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(availableNPCs.value, (npc) => {\n                                            return (_openBlock(), _createElementBlock(\"option\", {\n                                                key: npc.id,\n                                                value: npc.id\n                                            }, _toDisplayString(npc.name), 9 /* TEXT, PROPS */, _hoisted_8));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ], 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                [_vModelSelect, selectedAuthorId.value]\n                            ])\n                        ]),\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", _hoisted_9, [\n                            _createElementVNode(\"h3\", _hoisted_10, \" (\" + _toDisplayString(authorJournals.value.length) + \")\", 1 /* TEXT */),\n                            (authorJournals.value.length > 0)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(authorJournals.value, (journal) => {\n                                        return (_openBlock(), _createElementBlock(\"div\", {\n                                            key: journal.id,\n                                            class: _normalizeClass([\"journal-item\", { active: selectedJournalId.value === journal.id }]),\n                                            onClick: ($event) => (selectJournal(journal.id))\n                                        }, [\n                                            _createElementVNode(\"div\", _hoisted_13, [\n                                                _createElementVNode(\"span\", _hoisted_14, _toDisplayString(formatDate(journal.createdAt)), 1 /* TEXT */),\n                                                (journal.editedAt)\n                                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_15, \"()\"))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_16, _toDisplayString(getPreview(journal.content)), 1 /* TEXT */)\n                                        ], 10 /* CLASS, PROPS */, _hoisted_12));\n                                    }), 128 /* KEYED_FRAGMENT */))\n                                ]))\n                                : (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [...(_cache[5] || (_cache[5] = [\n                                        _createElementVNode(\"p\", null, \"\", -1 /* CACHED */)\n                                    ]))]))\n                        ])\n                    ]),\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_18, [\n                        (selectedAuthorId.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_19, [\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"div\", _hoisted_20, [\n                                    _createElementVNode(\"h3\", _hoisted_21, _toDisplayString(selectedJournalId.value ? '' : ''), 1 /* TEXT */),\n                                    _createElementVNode(\"div\", _hoisted_22, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn-generate\",\n                                            disabled: isGenerating.value,\n                                            onClick: generateDraft\n                                        }, _toDisplayString(isGenerating.value ? '...' : ' '), 9 /* TEXT, PROPS */, _hoisted_23),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn-save\",\n                                            disabled: !journalContent.value.trim() || isSaving.value,\n                                            onClick: saveJournal\n                                        }, _toDisplayString(isSaving.value ? '...' : ' '), 9 /* TEXT, PROPS */, _hoisted_24),\n                                        (selectedJournalId.value)\n                                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                                key: 0,\n                                                class: \"btn-delete\",\n                                                onClick: confirmDelete\n                                            }, \" \"))\n                                            : _createCommentVNode(\"v-if\", true),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn-new\",\n                                            onClick: createNew\n                                        }, \" \")\n                                    ])\n                                ]),\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"div\", _hoisted_25, [\n                                    _withDirectives(_createElementVNode(\"textarea\", {\n                                        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((journalContent).value = $event)),\n                                        class: \"journal-textarea\",\n                                        placeholder: placeholderText.value,\n                                        disabled: isGenerating.value\n                                    }, null, 8 /* PROPS */, _hoisted_26), [\n                                        [_vModelText, journalContent.value]\n                                    ])\n                                ]),\n                                _createCommentVNode(\"  \"),\n                                _cache[6] || (_cache[6] = _createElementVNode(\"div\", { class: \"editor-footer\" }, [\n                                    _createElementVNode(\"p\", { class: \"editor-hint\" }, \"  \\\"\\\" \")\n                                ], -1 /* CACHED */))\n                            ]))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_27, [...(_cache[7] || (_cache[7] = [\n                                    _createElementVNode(\"p\", null, \"\", -1 /* CACHED */)\n                                ]))]))\n                    ])\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./JournalView.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./JournalView.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./JournalView.vue?vue&type=style&index=0&id=30f8d2fa&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-30f8d2fa\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeStyle as _normalizeStyle, createElementVNode as _createElementVNode, normalizeClass as _normalizeClass, vModelText as _vModelText, withModifiers as _withModifiers, withKeys as _withKeys, withDirectives as _withDirectives, vModelCheckbox as _vModelCheckbox, createVNode as _createVNode, Teleport as _Teleport, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = { class: \"sanctuary-view\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"sanctuary-container\"\n};\nconst _hoisted_3 = [\"onClick\"];\nconst _hoisted_4 = [\"src\", \"alt\"];\nconst _hoisted_5 = {\n    key: 1,\n    class: \"placeholder-item\"\n};\nconst _hoisted_6 = [\"onClick\"];\nconst _hoisted_7 = { class: \"sanctuary-actions\" };\nconst _hoisted_8 = { class: \"chat-container\" };\nconst _hoisted_9 = { class: \"chat-header\" };\nconst _hoisted_10 = { class: \"chat-title\" };\nconst _hoisted_11 = {\n    key: 0,\n    class: \"no-messages\"\n};\nconst _hoisted_12 = { class: \"message-content\" };\nconst _hoisted_13 = { class: \"message-author\" };\nconst _hoisted_14 = { class: \"message-text\" };\nconst _hoisted_15 = { class: \"chat-input-container\" };\nconst _hoisted_16 = [\"onKeydown\"];\nconst _hoisted_17 = [\"disabled\"];\nconst _hoisted_18 = { key: 0 };\nconst _hoisted_19 = { key: 1 };\nconst _hoisted_20 = { class: \"invite-dialog\" };\nconst _hoisted_21 = { class: \"npc-list\" };\nconst _hoisted_22 = [\"value\"];\nconst _hoisted_23 = { class: \"npc-name\" };\nconst _hoisted_24 = { class: \"npc-info\" };\nconst _hoisted_25 = { class: \"dialog-actions\" };\nconst _hoisted_26 = [\"disabled\"];\nconst _hoisted_27 = { class: \"journal-modal-container\" };\nimport { computed, nextTick, onMounted, ref } from 'vue';\nimport { apiConfigService } from '../services/apiConfigService';\nimport { sanctuaryService } from '../services/sanctuaryService';\nimport { useInstanceStore } from '../stores/instanceStore';\nimport JournalView from './JournalView.vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'SanctuaryView',\n    emits: [\"close\"],\n    setup(__props, { emit: __emit }) {\n        const instanceStore = useInstanceStore();\n        // Emits\n        const emit = __emit;\n        // \n        const currentView = ref('sanctuary');\n        // \n        const sanctuary = ref(null);\n        const showInviteDialog = ref(false);\n        const showJournalDialog = ref(false);\n        const selectedNPCs = ref([]);\n        const arrangeMode = ref(false);\n        const isLoading = ref(false);\n        // \n        const chatInput = ref('');\n        const isSending = ref(false);\n        const chatMessages = ref([]);\n        const chatMessagesRef = ref(null);\n        const currentInvitedNPCs = ref([]);\n        // \n        const backgroundStyle = computed(() => {\n            if (!sanctuary.value)\n                return {};\n            return {\n                backgroundImage: `url(${sanctuary.value.backgroundImage})`,\n            };\n        });\n        const availableNPCs = computed(() => {\n            const allInstances = instanceStore.getAllInstances();\n            const npcs = [];\n            for (const instance of allInstances) {\n                for (const charInInstance of instance.characters) {\n                    if (charInInstance.character) {\n                        npcs.push({\n                            id: charInInstance.characterId,\n                            name: charInInstance.character.name,\n                            occupation: charInInstance.character.occupation || '',\n                        });\n                    }\n                }\n            }\n            return npcs;\n        });\n        const invitedNPCNames = computed(() => {\n            if (currentInvitedNPCs.value.length === 0)\n                return '';\n            const names = currentInvitedNPCs.value.map(npcId => {\n                const npc = availableNPCs.value.find(n => n.id === npcId);\n                return npc ? npc.name : npcId;\n            });\n            return names.join('');\n        });\n        // \n        function getItemStyle(position) {\n            return {\n                left: `${position.x}px`,\n                top: `${position.y}px`,\n            };\n        }\n        function getMementoStyle(memento) {\n            return {\n                left: `${memento.position.x}px`,\n                top: `${memento.position.y}px`,\n                transform: `scale(${memento.scale})`,\n            };\n        }\n        function toggleArrangeMode() {\n            arrangeMode.value = !arrangeMode.value;\n            if (arrangeMode.value) {\n                toastr.info('');\n            }\n            else {\n                toastr.success('');\n            }\n        }\n        async function handleItemClick(itemId, itemName) {\n            if (!arrangeMode.value)\n                return;\n            try {\n                const description = await sanctuaryService.interactWithItem(itemId);\n                toastr.info(`${itemName}: ${description}`);\n            }\n            catch (error) {\n                console.error('[SanctuaryView] :', error);\n            }\n        }\n        async function handleMementoClick(mementoId) {\n            if (!arrangeMode.value)\n                return;\n            try {\n                const description = await sanctuaryService.interactWithItem(mementoId);\n                toastr.info(`: ${description}`);\n            }\n            catch (error) {\n                console.error('[SanctuaryView] :', error);\n            }\n        }\n        async function inviteSelectedNPCs() {\n            if (selectedNPCs.value.length === 0) {\n                toastr.warning(' NPC');\n                return;\n            }\n            try {\n                isLoading.value = true;\n                await sanctuaryService.inviteNPC(selectedNPCs.value);\n                //  NPC\n                currentInvitedNPCs.value = [...selectedNPCs.value];\n                // \n                showInviteDialog.value = false;\n                selectedNPCs.value = [];\n                //  8.3\n                await loadConversationHistory();\n                // \n                currentView.value = 'chat';\n                toastr.success('NPC ');\n            }\n            catch (error) {\n                console.error('[SanctuaryView]  NPC :', error);\n                toastr.error('');\n            }\n            finally {\n                isLoading.value = false;\n            }\n        }\n        /**\n         * \n         *  API 8.2\n         */\n        async function returnToSanctuary() {\n            //  8.3\n            if (currentInvitedNPCs.value.length > 0 && chatMessages.value.length > 0) {\n                try {\n                    await sanctuaryService.saveConversation(currentInvitedNPCs.value, chatMessages.value);\n                    console.log('[SanctuaryView] ');\n                }\n                catch (error) {\n                    console.error('[SanctuaryView] :', error);\n                }\n            }\n            //  API\n            apiConfigService.switchToRealWorld();\n            console.log('[SanctuaryView]  API');\n            // \n            currentView.value = 'sanctuary';\n            //  NPC\n            currentInvitedNPCs.value = [];\n            toastr.info('');\n        }\n        /**\n         * \n         */\n        async function sendChatMessage() {\n            if (!chatInput.value.trim() || isSending.value)\n                return;\n            const message = chatInput.value.trim();\n            try {\n                isSending.value = true;\n                // \n                chatMessages.value.push({\n                    role: 'user',\n                    author: '',\n                    content: message,\n                });\n                // \n                chatInput.value = '';\n                // \n                await nextTick();\n                scrollChatToBottom();\n                console.log('[SanctuaryView] :', message);\n                //  API \n                const apiConfig = apiConfigService.getCurrentAPI();\n                let response;\n                if (apiConfig) {\n                    //  API\n                    response = await generateRaw({\n                        ordered_prompts: [{ role: 'user', content: message }],\n                        custom_api: {\n                            apiurl: apiConfig.apiurl,\n                            key: apiConfig.key,\n                            model: apiConfig.model,\n                            temperature: apiConfig.temperature,\n                            max_tokens: apiConfig.max_tokens,\n                        },\n                    });\n                }\n                else {\n                    //  API\n                    response = await generate({ user_input: message });\n                }\n                //  AI \n                chatMessages.value.push({\n                    role: 'assistant',\n                    author: invitedNPCNames.value || 'NPC',\n                    content: response,\n                });\n                // \n                await nextTick();\n                scrollChatToBottom();\n                console.log('[SanctuaryView]  AI ');\n            }\n            catch (error) {\n                console.error('[SanctuaryView] :', error);\n                toastr.error('');\n            }\n            finally {\n                isSending.value = false;\n            }\n        }\n        /**\n         * \n         */\n        function scrollChatToBottom() {\n            if (chatMessagesRef.value) {\n                chatMessagesRef.value.scrollTop = chatMessagesRef.value.scrollHeight;\n            }\n        }\n        /**\n         * \n         *  8.3\n         */\n        async function loadConversationHistory() {\n            try {\n                if (currentInvitedNPCs.value.length === 0) {\n                    chatMessages.value = [];\n                    return;\n                }\n                const history = await sanctuaryService.getConversationHistory(currentInvitedNPCs.value);\n                if (history && history.messages && history.messages.length > 0) {\n                    chatMessages.value = history.messages;\n                    console.log('[SanctuaryView] :', history.messages.length);\n                    // \n                    await nextTick();\n                    scrollChatToBottom();\n                    toastr.info(` ${history.messages.length} `);\n                }\n                else {\n                    chatMessages.value = [];\n                    console.log('[SanctuaryView] ');\n                }\n            }\n            catch (error) {\n                console.error('[SanctuaryView] :', error);\n                chatMessages.value = [];\n            }\n        }\n        /**\n         * \n         */\n        function closeSanctuary() {\n            emit('close');\n            toastr.info('');\n        }\n        // \n        onMounted(async () => {\n            try {\n                await sanctuaryService.initialize();\n                sanctuary.value = await sanctuaryService.getSanctuary();\n                console.log('[SanctuaryView] ');\n            }\n            catch (error) {\n                console.error('[SanctuaryView] :', error);\n                toastr.error('');\n            }\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createCommentVNode(\"  \"),\n                (currentView.value === 'sanctuary')\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", {\n                            class: \"sanctuary-background\",\n                            style: _normalizeStyle(backgroundStyle.value)\n                        }, [\n                            _createCommentVNode(\"  \"),\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(sanctuary.value?.furniture || [], (furniture) => {\n                                return (_openBlock(), _createElementBlock(\"div\", {\n                                    key: furniture.id,\n                                    class: \"furniture-item\",\n                                    style: _normalizeStyle(getItemStyle(furniture.position)),\n                                    onClick: ($event) => (handleItemClick(furniture.id, furniture.name))\n                                }, [\n                                    (furniture.imageUrl)\n                                        ? (_openBlock(), _createElementBlock(\"img\", {\n                                            key: 0,\n                                            src: furniture.imageUrl,\n                                            alt: furniture.name\n                                        }, null, 8 /* PROPS */, _hoisted_4))\n                                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_5, _toDisplayString(furniture.name), 1 /* TEXT */))\n                                ], 12 /* STYLE, PROPS */, _hoisted_3));\n                            }), 128 /* KEYED_FRAGMENT */)),\n                            _createCommentVNode(\"  \"),\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(sanctuary.value?.mementos || [], (memento) => {\n                                return (_openBlock(), _createElementBlock(\"div\", {\n                                    key: memento.mementoId,\n                                    class: \"memento-item\",\n                                    style: _normalizeStyle(getMementoStyle(memento)),\n                                    onClick: ($event) => (handleMementoClick(memento.mementoId))\n                                }, [...(_cache[8] || (_cache[8] = [\n                                        _createElementVNode(\"div\", { class: \"memento-placeholder\" }, \"\", -1 /* CACHED */)\n                                    ]))], 12 /* STYLE, PROPS */, _hoisted_6));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ], 4 /* STYLE */),\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", _hoisted_7, [\n                            _createElementVNode(\"button\", {\n                                class: \"action-btn\",\n                                onClick: toggleArrangeMode\n                            }, [\n                                _createElementVNode(\"span\", null, _toDisplayString(arrangeMode.value ? '' : ''), 1 /* TEXT */)\n                            ]),\n                            _createElementVNode(\"button\", {\n                                class: \"action-btn\",\n                                onClick: _cache[0] || (_cache[0] = ($event) => (showInviteDialog.value = true))\n                            }, [...(_cache[9] || (_cache[9] = [\n                                    _createElementVNode(\"span\", null, \" NPC\", -1 /* CACHED */)\n                                ]))]),\n                            _createElementVNode(\"button\", {\n                                class: \"action-btn\",\n                                onClick: _cache[1] || (_cache[1] = ($event) => (showJournalDialog.value = true))\n                            }, [...(_cache[10] || (_cache[10] = [\n                                    _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)\n                                ]))]),\n                            _createElementVNode(\"button\", {\n                                class: \"action-btn close-btn\",\n                                onClick: closeSanctuary\n                            }, [...(_cache[11] || (_cache[11] = [\n                                    _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)\n                                ]))])\n                        ])\n                    ]))\n                    : (currentView.value === 'chat')\n                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", _hoisted_8, [\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"div\", _hoisted_9, [\n                                    _createElementVNode(\"div\", _hoisted_10, [\n                                        _createElementVNode(\"span\", null, \" \" + _toDisplayString(invitedNPCNames.value) + \" \", 1 /* TEXT */)\n                                    ]),\n                                    _createElementVNode(\"button\", {\n                                        class: \"back-btn\",\n                                        onClick: returnToSanctuary\n                                    }, [...(_cache[12] || (_cache[12] = [\n                                            _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)\n                                        ]))])\n                                ]),\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"div\", {\n                                    ref_key: \"chatMessagesRef\",\n                                    ref: chatMessagesRef,\n                                    class: \"chat-messages\"\n                                }, [\n                                    (chatMessages.value.length === 0)\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [...(_cache[13] || (_cache[13] = [\n                                                _createElementVNode(\"p\", null, \" NPC ...\", -1 /* CACHED */)\n                                            ]))]))\n                                        : _createCommentVNode(\"v-if\", true),\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(chatMessages.value, (message, index) => {\n                                        return (_openBlock(), _createElementBlock(\"div\", {\n                                            key: index,\n                                            class: _normalizeClass([\"message-item\", message.role])\n                                        }, [\n                                            _createElementVNode(\"div\", _hoisted_12, [\n                                                _createElementVNode(\"div\", _hoisted_13, _toDisplayString(message.author), 1 /* TEXT */),\n                                                _createElementVNode(\"div\", _hoisted_14, _toDisplayString(message.content), 1 /* TEXT */)\n                                            ])\n                                        ], 2 /* CLASS */));\n                                    }), 128 /* KEYED_FRAGMENT */))\n                                ], 512 /* NEED_PATCH */),\n                                _createCommentVNode(\"  \"),\n                                _createElementVNode(\"div\", _hoisted_15, [\n                                    _withDirectives(_createElementVNode(\"textarea\", {\n                                        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => ((chatInput).value = $event)),\n                                        class: \"chat-input\",\n                                        placeholder: \"... (Ctrl+Enter )\",\n                                        onKeydown: _withKeys(_withModifiers(sendChatMessage, [\"ctrl\"]), [\"enter\"])\n                                    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_16), [\n                                        [_vModelText, chatInput.value]\n                                    ]),\n                                    _createElementVNode(\"button\", {\n                                        class: \"send-btn\",\n                                        disabled: !chatInput.value.trim() || isSending.value,\n                                        onClick: sendChatMessage\n                                    }, [\n                                        (!isSending.value)\n                                            ? (_openBlock(), _createElementBlock(\"span\", _hoisted_18, \"\"))\n                                            : (_openBlock(), _createElementBlock(\"span\", _hoisted_19, \"...\"))\n                                    ], 8 /* PROPS */, _hoisted_17)\n                                ])\n                            ])\n                        ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                        : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\" NPC  \"),\n                (showInviteDialog.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 2,\n                        class: \"modal-overlay\",\n                        onClick: _cache[5] || (_cache[5] = _withModifiers(($event) => (showInviteDialog.value = false), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_20, [\n                            _cache[14] || (_cache[14] = _createElementVNode(\"h3\", null, \" NPC\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_21, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(availableNPCs.value, (npc) => {\n                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                        key: npc.id,\n                                        class: \"npc-option\"\n                                    }, [\n                                        _createElementVNode(\"label\", null, [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => ((selectedNPCs).value = $event)),\n                                                type: \"checkbox\",\n                                                value: npc.id\n                                            }, null, 8 /* PROPS */, _hoisted_22), [\n                                                [_vModelCheckbox, selectedNPCs.value]\n                                            ]),\n                                            _createElementVNode(\"span\", _hoisted_23, _toDisplayString(npc.name), 1 /* TEXT */),\n                                            _createElementVNode(\"span\", _hoisted_24, _toDisplayString(npc.occupation), 1 /* TEXT */)\n                                        ])\n                                    ]));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_25, [\n                                _createElementVNode(\"button\", {\n                                    class: \"btn-primary\",\n                                    disabled: selectedNPCs.value.length === 0,\n                                    onClick: inviteSelectedNPCs\n                                }, \"  (\" + _toDisplayString(selectedNPCs.value.length) + \") \", 9 /* TEXT, PROPS */, _hoisted_26),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn-secondary\",\n                                    onClick: _cache[4] || (_cache[4] = ($event) => (showInviteDialog.value = false))\n                                }, \"\")\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (_openBlock(), _createBlock(_Teleport, { to: \"body\" }, [\n                    (showJournalDialog.value)\n                        ? (_openBlock(), _createElementBlock(\"div\", {\n                            key: 0,\n                            class: \"modal-overlay\",\n                            onClick: _cache[7] || (_cache[7] = _withModifiers(($event) => (showJournalDialog.value = false), [\"self\"]))\n                        }, [\n                            _createElementVNode(\"div\", _hoisted_27, [\n                                _createVNode(JournalView, {\n                                    onClose: _cache[6] || (_cache[6] = ($event) => (showJournalDialog.value = false))\n                                })\n                            ])\n                        ]))\n                        : _createCommentVNode(\"v-if\", true)\n                ]))\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./SanctuaryView.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./SanctuaryView.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./SanctuaryView.vue?vue&type=style&index=0&id=efcbae3e&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-efcbae3e\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, normalizeStyle as _normalizeStyle, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n    key: 0,\n    class: \"status-bar\"\n};\nconst _hoisted_2 = { class: \"character-name\" };\nconst _hoisted_3 = { class: \"status-bars\" };\nconst _hoisted_4 = { class: \"stat-row\" };\nconst _hoisted_5 = { class: \"progress-bar hp-bar\" };\nconst _hoisted_6 = { class: \"stat-row\" };\nconst _hoisted_7 = { class: \"progress-bar mp-bar\" };\nconst _hoisted_8 = { class: \"stat-row\" };\nconst _hoisted_9 = { class: \"progress-bar san-bar\" };\nimport gsap from 'gsap';\nimport { computed, onMounted, ref, watch } from 'vue';\nimport { useCharacterStore } from '../stores/characterStore';\nimport { highlightFlash } from '../utils/animation';\n// ==================== Store ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'StatusBar',\n    setup(__props) {\n        const characterStore = useCharacterStore();\n        // ====================  ====================\n        const hpFillRef = ref(null);\n        const mpFillRef = ref(null);\n        const sanFillRef = ref(null);\n        const hpValueRef = ref(null);\n        const mpValueRef = ref(null);\n        const sanValueRef = ref(null);\n        // \n        const previousHP = ref(0);\n        const previousMP = ref(0);\n        const previousSAN = ref(0);\n        // ====================  ====================\n        const player = computed(() => characterStore.player);\n        const hpPercentage = computed(() => {\n            if (!player.value)\n                return 0;\n            return (player.value.derivedStats.HP / player.value.derivedStats.maxHP) * 100;\n        });\n        const mpPercentage = computed(() => {\n            if (!player.value)\n                return 0;\n            return (player.value.derivedStats.MP / player.value.derivedStats.maxMP) * 100;\n        });\n        const sanPercentage = computed(() => {\n            if (!player.value)\n                return 0;\n            return (player.value.derivedStats.SAN / player.value.derivedStats.maxSAN) * 100;\n        });\n        // ====================  ====================\n        /**\n         * \n         */\n        function highlightStatChange(element, isIncrease) {\n            if (!element)\n                return;\n            const color = isIncrease ? '#4caf50' : '#f44336'; // \n            highlightFlash(element, color, 0.5);\n        }\n        /**\n         * \n         */\n        function animateStatValue(element, from, to, max) {\n            if (!element)\n                return;\n            const obj = { value: from };\n            gsap.to(obj, {\n                value: to,\n                duration: 0.8,\n                ease: 'power2.out',\n                onUpdate: () => {\n                    element.textContent = `${Math.round(obj.value)} / ${max}`;\n                },\n            });\n        }\n        // ====================  ====================\n        watch(() => player.value?.derivedStats.HP, (newHP, oldHP) => {\n            if (newHP === undefined || oldHP === undefined)\n                return;\n            if (newHP === oldHP)\n                return;\n            // \n            highlightStatChange(hpFillRef.value, newHP > oldHP);\n            // \n            if (hpValueRef.value && player.value) {\n                animateStatValue(hpValueRef.value, oldHP, newHP, player.value.derivedStats.maxHP);\n            }\n            previousHP.value = newHP;\n        });\n        watch(() => player.value?.derivedStats.MP, (newMP, oldMP) => {\n            if (newMP === undefined || oldMP === undefined)\n                return;\n            if (newMP === oldMP)\n                return;\n            // \n            highlightStatChange(mpFillRef.value, newMP > oldMP);\n            // \n            if (mpValueRef.value && player.value) {\n                animateStatValue(mpValueRef.value, oldMP, newMP, player.value.derivedStats.maxMP);\n            }\n            previousMP.value = newMP;\n        });\n        watch(() => player.value?.derivedStats.SAN, (newSAN, oldSAN) => {\n            if (newSAN === undefined || oldSAN === undefined)\n                return;\n            if (newSAN === oldSAN)\n                return;\n            // \n            highlightStatChange(sanFillRef.value, newSAN > oldSAN);\n            // \n            if (sanValueRef.value && player.value) {\n                animateStatValue(sanValueRef.value, oldSAN, newSAN, player.value.derivedStats.maxSAN);\n            }\n            previousSAN.value = newSAN;\n        });\n        // ====================  ====================\n        onMounted(() => {\n            if (player.value) {\n                previousHP.value = player.value.derivedStats.HP;\n                previousMP.value = player.value.derivedStats.MP;\n                previousSAN.value = player.value.derivedStats.SAN;\n            }\n        });\n        return (_ctx, _cache) => {\n            return (player.value)\n                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_2, _toDisplayString(player.value.name), 1 /* TEXT */),\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createCommentVNode(\" HP  \"),\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _cache[0] || (_cache[0] = _createElementVNode(\"span\", { class: \"stat-label\" }, \"HP\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_5, [\n                                _createElementVNode(\"div\", {\n                                    ref_key: \"hpFillRef\",\n                                    ref: hpFillRef,\n                                    class: \"progress-fill\",\n                                    style: _normalizeStyle({ width: hpPercentage.value + '%' })\n                                }, null, 4 /* STYLE */),\n                                _createElementVNode(\"span\", {\n                                    ref_key: \"hpValueRef\",\n                                    ref: hpValueRef,\n                                    class: \"stat-value\"\n                                }, _toDisplayString(player.value.derivedStats.HP) + \" / \" + _toDisplayString(player.value.derivedStats.maxHP), 513 /* TEXT, NEED_PATCH */)\n                            ])\n                        ]),\n                        _createCommentVNode(\" MP  \"),\n                        _createElementVNode(\"div\", _hoisted_6, [\n                            _cache[1] || (_cache[1] = _createElementVNode(\"span\", { class: \"stat-label\" }, \"MP\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_7, [\n                                _createElementVNode(\"div\", {\n                                    ref_key: \"mpFillRef\",\n                                    ref: mpFillRef,\n                                    class: \"progress-fill\",\n                                    style: _normalizeStyle({ width: mpPercentage.value + '%' })\n                                }, null, 4 /* STYLE */),\n                                _createElementVNode(\"span\", {\n                                    ref_key: \"mpValueRef\",\n                                    ref: mpValueRef,\n                                    class: \"stat-value\"\n                                }, _toDisplayString(player.value.derivedStats.MP) + \" / \" + _toDisplayString(player.value.derivedStats.maxMP), 513 /* TEXT, NEED_PATCH */)\n                            ])\n                        ]),\n                        _createCommentVNode(\" SAN  \"),\n                        _createElementVNode(\"div\", _hoisted_8, [\n                            _cache[2] || (_cache[2] = _createElementVNode(\"span\", { class: \"stat-label\" }, \"SAN\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_9, [\n                                _createElementVNode(\"div\", {\n                                    ref_key: \"sanFillRef\",\n                                    ref: sanFillRef,\n                                    class: \"progress-fill\",\n                                    style: _normalizeStyle({ width: sanPercentage.value + '%' })\n                                }, null, 4 /* STYLE */),\n                                _createElementVNode(\"span\", {\n                                    ref_key: \"sanValueRef\",\n                                    ref: sanValueRef,\n                                    class: \"stat-value\"\n                                }, _toDisplayString(player.value.derivedStats.SAN) + \" / \" + _toDisplayString(player.value.derivedStats.maxSAN), 513 /* TEXT, NEED_PATCH */)\n                            ])\n                        ])\n                    ])\n                ]))\n                : _createCommentVNode(\"v-if\", true);\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./StatusBar.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./StatusBar.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./StatusBar.vue?vue&type=style&index=0&id=0bbeca14&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-0bbeca14\"]])\n\nexport default __exports__","/**\n * \n *  NPC \n */\n\nimport { useInstanceStore } from '../stores/instanceStore';\nimport { apiConfigService } from './apiConfigService';\nimport { memoryFragmentService } from './memoryFragmentService';\nimport { realWorldMapService } from './realWorldMapService';\nimport { sanctuaryService } from './sanctuaryService';\n\ninterface TestResult {\n  testName: string;\n  passed: boolean;\n  message: string;\n  details?: any;\n}\n\nclass IntegrationTestService {\n  private testResults: TestResult[] = [];\n\n  /**\n   * \n   */\n  async runAllTests(): Promise<TestResult[]> {\n    this.testResults = [];\n\n    toastr.info('...');\n\n    // 18.1  API \n    await this.testAPISwitch();\n\n    // 18.2 \n    await this.testMemorySystem();\n\n    // 18.3 \n    await this.testSanctuarySystem();\n\n    // 18.4 \n    await this.testInstanceCompletion();\n\n    // 18.5 \n    await this.testCharacterInitialization();\n\n    this.displayResults();\n    return this.testResults;\n  }\n\n  /**\n   * 18.1  API \n   */\n  async testAPISwitch(): Promise<void> {\n    console.log('===  18.1: API  ===');\n\n    try {\n      //  1:  API \n      const currentAPI = apiConfigService.getCurrentAPI();\n      this.addResult({\n        testName: '18.1.1 -  API ',\n        passed: true,\n        message: currentAPI ? ' API ' : ' API',\n        details: currentAPI,\n      });\n\n      //  2:  API\n      await apiConfigService.switchToRealWorld();\n      const realWorldAPI = apiConfigService.getCurrentAPI();\n      this.addResult({\n        testName: '18.1.2 -  API',\n        passed: true,\n        message: ' API',\n        details: realWorldAPI,\n      });\n\n      //  3:  API\n      await apiConfigService.switchToInnerWorld();\n      const innerWorldAPI = apiConfigService.getCurrentAPI();\n      this.addResult({\n        testName: '18.1.3 -  API',\n        passed: true,\n        message: ' API',\n        details: innerWorldAPI,\n      });\n\n      //  4:  API\n      await apiConfigService.switchToSanctuary();\n      const sanctuaryAPI = apiConfigService.getCurrentAPI();\n      this.addResult({\n        testName: '18.1.4 -  API',\n        passed: true,\n        message: ' API',\n        details: sanctuaryAPI,\n      });\n\n      //  5:  API\n      const allConfigs = await apiConfigService.getAllConfigs();\n      const hasRealWorldConfig = allConfigs.realWorld !== null;\n      this.addResult({\n        testName: '18.1.5 - API ',\n        passed: true,\n        message: hasRealWorldConfig ? ' API' : ' API API',\n        details: { hasRealWorldConfig, allConfigs },\n      });\n\n      //  6:  API \n      const testConfig = {\n        apiurl: 'https://test.api.com',\n        key: 'test_key',\n        model: 'test_model',\n        temperature: 0.7,\n        max_tokens: 2000,\n      };\n\n      await apiConfigService.saveConfigs({\n        realWorld: testConfig,\n        innerWorld: testConfig,\n        sanctuary: testConfig,\n      });\n\n      const loadedConfigs = await apiConfigService.getAllConfigs();\n      const configMatches =\n        loadedConfigs.realWorld?.apiurl === testConfig.apiurl && loadedConfigs.realWorld?.key === testConfig.key;\n\n      this.addResult({\n        testName: '18.1.6 - API ',\n        passed: configMatches,\n        message: configMatches ? 'API ' : 'API ',\n        details: { saved: testConfig, loaded: loadedConfigs.realWorld },\n      });\n    } catch (error) {\n      this.addResult({\n        testName: '18.1 - API ',\n        passed: false,\n        message: `: ${error}`,\n        details: error,\n      });\n    }\n  }\n\n  /**\n   * 18.2 \n   */\n  async testMemorySystem(): Promise<void> {\n    console.log('===  18.2:  ===');\n\n    try {\n      //  1: \n      const testNPCId = 'test_npc_001';\n      const archive = await memoryFragmentService.getArchive(testNPCId);\n\n      this.addResult({\n        testName: '18.2.1 - ',\n        passed: true,\n        message: archive ? ` NPC ${testNPCId} ` : `NPC ${testNPCId} `,\n        details: archive,\n      });\n\n      //  2: \n      if (archive && archive.memories.length > 0) {\n        const memoryPrompt = await memoryFragmentService.injectMemoryPrompt(testNPCId);\n        const hasPromptContent = memoryPrompt.length > 0;\n\n        this.addResult({\n          testName: '18.2.2 - ',\n          passed: hasPromptContent,\n          message: hasPromptContent ? '' : '',\n          details: { prompt: memoryPrompt },\n        });\n      } else {\n        this.addResult({\n          testName: '18.2.2 - ',\n          passed: true,\n          message: '',\n          details: null,\n        });\n      }\n\n      //  3: \n      const initialScore = archive?.relationshipScore || 0;\n\n      this.addResult({\n        testName: '18.2.3 - ',\n        passed: true,\n        message: `: ${initialScore}`,\n        details: { initialScore },\n      });\n\n      //  4: \n      const allArchives = await memoryFragmentService.getAllArchives();\n\n      this.addResult({\n        testName: '18.2.4 - ',\n        passed: true,\n        message: ` ( ${allArchives.length} )`,\n        details: { totalArchives: allArchives.length },\n      });\n    } catch (error) {\n      this.addResult({\n        testName: '18.2 - ',\n        passed: false,\n        message: `: ${error}`,\n        details: error,\n      });\n    }\n  }\n\n  /**\n   * 18.3 \n   */\n  async testSanctuarySystem(): Promise<void> {\n    console.log('===  18.3:  ===');\n\n    try {\n      //  1: \n      await sanctuaryService.initialize();\n      const sanctuary = await sanctuaryService.getSanctuary();\n\n      this.addResult({\n        testName: '18.3.1 - ',\n        passed: sanctuary !== null,\n        message: sanctuary ? '' : '',\n        details: sanctuary,\n      });\n\n      //  2:  NPC \n      const testNPCIds = ['test_npc_001'];\n\n      try {\n        await sanctuaryService.inviteNPC(testNPCIds);\n        const updatedSanctuary = await sanctuaryService.getSanctuary();\n        const hasConversation = updatedSanctuary !== null && updatedSanctuary.conversationHistory.length > 0;\n\n        this.addResult({\n          testName: '18.3.2 -  NPC ',\n          passed: hasConversation,\n          message: hasConversation ? 'NPC ' : 'NPC ',\n          details: updatedSanctuary?.conversationHistory,\n        });\n      } catch (error) {\n        this.addResult({\n          testName: '18.3.2 -  NPC ',\n          passed: false,\n          message: ` NPC : ${error}`,\n          details: error,\n        });\n      }\n\n      //  3: \n      const testMemento = {\n        id: 'test_memento_001',\n        name: '',\n        description: '',\n        sourceInstance: 'test_instance',\n        obtainedAt: Date.now(),\n      };\n\n      await sanctuaryService.addMemento(testMemento, { x: 100, y: 100 });\n      const sanctuaryWithMemento = await sanctuaryService.getSanctuary();\n      const hasMementos = sanctuaryWithMemento !== null && sanctuaryWithMemento.mementos.length > 0;\n\n      this.addResult({\n        testName: '18.3.3 - ',\n        passed: hasMementos,\n        message: hasMementos ? '' : '',\n        details: sanctuaryWithMemento?.mementos,\n      });\n\n      //  4: \n      const conversationHistory = sanctuaryWithMemento?.conversationHistory || [];\n      const hasHistory = conversationHistory.length > 0;\n\n      this.addResult({\n        testName: '18.3.4 - ',\n        passed: hasHistory,\n        message: hasHistory ? '' : '',\n        details: { historyCount: conversationHistory.length },\n      });\n\n      //  5: API \n      const currentAPI = apiConfigService.getCurrentAPI();\n\n      this.addResult({\n        testName: '18.3.5 - API ',\n        passed: currentAPI !== null || currentAPI === null,\n        message: currentAPI ? ' API ' : ' API',\n        details: currentAPI,\n      });\n    } catch (error) {\n      this.addResult({\n        testName: '18.3 - ',\n        passed: false,\n        message: `: ${error}`,\n        details: error,\n      });\n    }\n  }\n\n  /**\n   * 18.4 \n   */\n  async testInstanceCompletion(): Promise<void> {\n    console.log('===  18.4:  ===');\n\n    try {\n      const instanceStore = useInstanceStore();\n\n      //  1: \n      const allInstances = instanceStore.getAllInstances();\n\n      this.addResult({\n        testName: '18.4.1 - ',\n        passed: true,\n        message: ` ( ${allInstances.length} )`,\n        details: { instanceCount: allInstances.length },\n      });\n\n      //  2: \n      const activeInstances = allInstances.filter(i => i.status === 'active');\n      const completedInstances = allInstances.filter(i => i.status === 'completed');\n\n      this.addResult({\n        testName: '18.4.2 - ',\n        passed: true,\n        message: `: ${activeInstances.length}, : ${completedInstances.length}`,\n        details: { activeCount: activeInstances.length, completedCount: completedInstances.length },\n      });\n\n      //  3: \n      const instancesWithEvents = allInstances.filter(i => i.events && i.events.length > 0);\n\n      this.addResult({\n        testName: '18.4.3 - ',\n        passed: true,\n        message: `${instancesWithEvents.length} `,\n        details: { instancesWithEvents: instancesWithEvents.length },\n      });\n\n      //  4: \n      const instancesWithMementos = allInstances.filter(i => i.mementos && i.mementos.length > 0);\n\n      this.addResult({\n        testName: '18.4.4 - ',\n        passed: true,\n        message: `${instancesWithMementos.length} `,\n        details: { instancesWithMementos: instancesWithMementos.length },\n      });\n    } catch (error) {\n      this.addResult({\n        testName: '18.4 - ',\n        passed: false,\n        message: `: ${error}`,\n        details: error,\n      });\n    }\n  }\n\n  /**\n   * 18.5 \n   */\n  async testCharacterInitialization(): Promise<void> {\n    console.log('===  18.5:  ===');\n\n    try {\n      //  1: \n      const lastMessageId = SillyTavern.getCurrentChatId() ? (SillyTavern.chat?.length ?? 0) - 1 : -1;\n      const messages = lastMessageId >= 0 ? getChatMessages(`0-${lastMessageId}`) : [];\n      const isFloorZero = messages.length === 0;\n\n      this.addResult({\n        testName: '18.5.1 - ',\n        passed: true,\n        message: isFloorZero ? ' 0 ' : ` ${messages.length} `,\n        details: { messageCount: messages.length },\n      });\n\n      //  2: \n      const allGlobalVars = getVariables({ type: 'global' });\n      const playerCharacter = allGlobalVars.player_character;\n      const hasCharacter = playerCharacter !== null && playerCharacter !== undefined;\n\n      this.addResult({\n        testName: '18.5.2 - ',\n        passed: true,\n        message: hasCharacter ? '' : '',\n        details: playerCharacter,\n      });\n\n      //  3: \n      if (hasCharacter) {\n        try {\n          const context = SillyTavern;\n          const charId = context.characterId;\n          const currentChar = context.characters[charId as any];\n          const hasDescription = currentChar && currentChar.description && currentChar.description.length > 0;\n\n          this.addResult({\n            testName: '18.5.3 - ',\n            passed: hasDescription || false,\n            message: hasDescription ? '' : '',\n            details: { descriptionLength: currentChar?.description?.length || 0 },\n          });\n        } catch (error) {\n          this.addResult({\n            testName: '18.5.3 - ',\n            passed: false,\n            message: `: ${error}`,\n            details: error,\n          });\n        }\n      } else {\n        this.addResult({\n          testName: '18.5.3 - ',\n          passed: true,\n          message: '',\n          details: null,\n        });\n      }\n\n      //  4: \n      const realWorldMap = await realWorldMapService.loadMap();\n      const hasMap = realWorldMap !== null && realWorldMap.areas && realWorldMap.areas.size > 0;\n\n      this.addResult({\n        testName: '18.5.4 - ',\n        passed: hasMap,\n        message: hasMap ? ` (${realWorldMap.areas.size} )` : '',\n        details: realWorldMap,\n      });\n    } catch (error) {\n      this.addResult({\n        testName: '18.5 - ',\n        passed: false,\n        message: `: ${error}`,\n        details: error,\n      });\n    }\n  }\n\n  /**\n   * \n   */\n  private addResult(result: TestResult): void {\n    this.testResults.push(result);\n\n    const icon = result.passed ? '' : '';\n    const color = result.passed ? 'green' : 'red';\n\n    console.log(`%c${icon} ${result.testName}: ${result.message}`, `color: ${color}`);\n\n    if (result.details) {\n      console.log(':', result.details);\n    }\n  }\n\n  /**\n   * \n   */\n  private displayResults(): void {\n    const totalTests = this.testResults.length;\n    const passedTests = this.testResults.filter(r => r.passed).length;\n    const failedTests = totalTests - passedTests;\n\n    console.log('\\n===  ===');\n    console.log(`: ${totalTests}`);\n    console.log(`%c: ${passedTests}`, 'color: green');\n    console.log(`%c: ${failedTests}`, 'color: red');\n    console.log(`: ${((passedTests / totalTests) * 100).toFixed(2)}%`);\n\n    if (failedTests > 0) {\n      console.log('\\n:');\n      this.testResults\n        .filter(r => !r.passed)\n        .forEach(r => {\n          console.log(`%c ${r.testName}: ${r.message}`, 'color: red');\n        });\n\n      toastr.warning(`: ${passedTests}/${totalTests} `);\n    } else {\n      toastr.success(`! (${totalTests}/${totalTests})`);\n    }\n  }\n\n  /**\n   * \n   */\n  getResults(): TestResult[] {\n    return this.testResults;\n  }\n\n  /**\n   * \n   */\n  generateReport(): string {\n    const totalTests = this.testResults.length;\n    const passedTests = this.testResults.filter(r => r.passed).length;\n\n    let report = '#  NPC  - \\n\\n';\n    report += `****: ${new Date().toLocaleString()}\\n\\n`;\n    report += `****: ${passedTests}/${totalTests}  (${((passedTests / totalTests) * 100).toFixed(2)}%)\\n\\n`;\n\n    report += '## \\n\\n';\n\n    this.testResults.forEach(result => {\n      const status = result.passed ? ' ' : ' ';\n      report += `### ${result.testName}\\n`;\n      report += `****: ${status}\\n`;\n      report += `****: ${result.message}\\n`;\n\n      if (result.details) {\n        report += `****:\\n\\`\\`\\`json\\n${JSON.stringify(result.details, null, 2)}\\n\\`\\`\\`\\n`;\n      }\n\n      report += '\\n';\n    });\n\n    return report;\n  }\n}\n\nexport const integrationTestService = new IntegrationTestService();\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"test-panel\" };\nconst _hoisted_2 = { class: \"test-header\" };\nconst _hoisted_3 = { class: \"test-content\" };\nconst _hoisted_4 = { class: \"test-section\" };\nconst _hoisted_5 = {\n    key: 0,\n    class: \"test-result\"\n};\nconst _hoisted_6 = { class: \"test-section\" };\nconst _hoisted_7 = {\n    key: 0,\n    class: \"test-result\"\n};\nconst _hoisted_8 = { class: \"test-section\" };\nconst _hoisted_9 = {\n    key: 0,\n    class: \"test-result\"\n};\nconst _hoisted_10 = { class: \"test-section\" };\nconst _hoisted_11 = {\n    key: 0,\n    class: \"test-result\"\n};\nconst _hoisted_12 = { class: \"test-section\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"test-result\"\n};\nconst _hoisted_14 = { class: \"test-section\" };\nconst _hoisted_15 = {\n    key: 0,\n    class: \"test-result\"\n};\nimport { ref } from 'vue';\nimport { eventRecordService } from '../services/eventRecordService';\nimport { integrationTestService } from '../services/integrationTestService';\nimport { memoryFragmentService } from '../services/memoryFragmentService';\nimport { npcGenerationCoordinator } from '../services/npcGenerationCoordinator';\nimport { realWorldMapService } from '../services/realWorldMapService';\nimport { useInstanceStore } from '../stores/instanceStore';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'TestPanel',\n    emits: ['close'],\n    setup(__props) {\n        const memoryTestResult = ref('');\n        const npcTestResult = ref('');\n        const eventTestResult = ref('');\n        const mapTestResult = ref('');\n        const aiTestResult = ref('');\n        const integrationTestResult = ref('');\n        const instanceStore = useInstanceStore();\n        // \n        async function testMemoryCapture() {\n            try {\n                memoryTestResult.value = '...';\n                // \n                const testEvent = {\n                    id: `test_${Date.now()}`,\n                    description: ' NPC',\n                    type: 'positive',\n                    timestamp: Date.now(),\n                    sourceInstance: 'test_instance',\n                };\n                await memoryFragmentService.addMemoryToNPC('test_npc_001', testEvent);\n                memoryTestResult.value = ' ';\n            }\n            catch (error) {\n                memoryTestResult.value = ` : ${error}`;\n            }\n        }\n        async function viewMemoryArchives() {\n            try {\n                const archives = await memoryFragmentService.getAllArchives();\n                memoryTestResult.value = ` : ${archives.length}\\n${JSON.stringify(archives, null, 2)}`;\n            }\n            catch (error) {\n                memoryTestResult.value = ` : ${error}`;\n            }\n        }\n        async function testMemoryInjection() {\n            try {\n                const prompt = await memoryFragmentService.injectMemoryPrompt('test_npc_001');\n                memoryTestResult.value = prompt ? ` :\\n${prompt}` : '  NPC ';\n            }\n            catch (error) {\n                memoryTestResult.value = ` : ${error}`;\n            }\n        }\n        // NPC \n        async function testNPCGeneration() {\n            try {\n                npcTestResult.value = ' NPC...';\n                const currentInstance = instanceStore.currentInstance;\n                if (!currentInstance) {\n                    npcTestResult.value = ' ';\n                    return;\n                }\n                const npcs = await npcGenerationCoordinator.generateRandomNPCs(2, currentInstance.type || '', []);\n                npcTestResult.value = ` \\n ${npcs.length}  NPC`;\n            }\n            catch (error) {\n                npcTestResult.value = ` : ${error}`;\n            }\n        }\n        async function testNPCAppearance() {\n            try {\n                const currentInstance = instanceStore.currentInstance;\n                if (!currentInstance || !currentInstance.characters.length) {\n                    npcTestResult.value = '  NPC';\n                    return;\n                }\n                const npcData = currentInstance.characters[0];\n                npcTestResult.value = ` NPC: ${npcData.character.name}\\n: ${npcData.appearanceCount || 0}`;\n            }\n            catch (error) {\n                npcTestResult.value = ` : ${error}`;\n            }\n        }\n        // \n        async function testEventRecord() {\n            try {\n                eventTestResult.value = '...';\n                const currentInstance = instanceStore.currentInstance;\n                if (!currentInstance) {\n                    eventTestResult.value = ' ';\n                    return;\n                }\n                await eventRecordService.recordEventFromAIOutput(currentInstance.id, '', []);\n                eventTestResult.value = ' ';\n            }\n            catch (error) {\n                eventTestResult.value = ` : ${error}`;\n            }\n        }\n        async function viewEventHistory() {\n            try {\n                const currentInstance = instanceStore.currentInstance;\n                if (!currentInstance) {\n                    eventTestResult.value = ' ';\n                    return;\n                }\n                const events = currentInstance.events || [];\n                eventTestResult.value = `  (${events.length} ):\\n${JSON.stringify(events.slice(-5), null, 2)}`;\n            }\n            catch (error) {\n                eventTestResult.value = ` : ${error}`;\n            }\n        }\n        // \n        async function testMapGeneration() {\n            try {\n                mapTestResult.value = '...';\n                const testCharacter = {\n                    id: 'test_player',\n                    type: 'player',\n                    name: '',\n                    age: 25,\n                    occupation: '',\n                    background: '',\n                    attributes: { STR: 50, CON: 50, SIZ: 50, DEX: 50, APP: 50, INT: 50, POW: 50, EDU: 50, LUK: 50 },\n                    derivedStats: {\n                        HP: 10,\n                        MP: 10,\n                        SAN: 50,\n                        luck: 50,\n                        MOV: 8,\n                        DB: '0',\n                        build: 0,\n                        BUILD: 0,\n                        maxHP: 10,\n                        maxMP: 10,\n                        maxSAN: 50,\n                    },\n                    skills: new Map(),\n                    bodyParts: [],\n                    inventory: [],\n                };\n                const map = await realWorldMapService.generateMap(testCharacter);\n                mapTestResult.value = ` \\n: ${map.areas.size}\\n: ${map.startArea}`;\n            }\n            catch (error) {\n                mapTestResult.value = ` : ${error}`;\n            }\n        }\n        async function testAreaDetails() {\n            try {\n                mapTestResult.value = '...';\n            }\n            catch (error) {\n                mapTestResult.value = ` : ${error}`;\n            }\n        }\n        // AI \n        async function testAIConnection() {\n            try {\n                aiTestResult.value = ' AI ...';\n                const { testAIService } = await import('../utils/aiServiceDiagnostics');\n                const result = await testAIService();\n                if (result.success) {\n                    aiTestResult.value = ` ${result.message}\\n\\n:\\n${JSON.stringify(result.details, null, 2)}`;\n                }\n                else {\n                    aiTestResult.value = ` ${result.message}\\n\\n${result.details?.diagnosis || ''}`;\n                }\n            }\n            catch (error) {\n                aiTestResult.value = ` : ${error}`;\n            }\n        }\n        async function runAIDiagnostics() {\n            try {\n                aiTestResult.value = '...';\n                const { runFullDiagnostics } = await import('../utils/aiServiceDiagnostics');\n                const report = await runFullDiagnostics();\n                aiTestResult.value = report;\n            }\n            catch (error) {\n                aiTestResult.value = ` : ${error}`;\n            }\n        }\n        // \n        async function runIntegrationTest() {\n            try {\n                integrationTestResult.value = '...\\n';\n                await integrationTestService.runAllTests();\n                const results = integrationTestService.getResults();\n                integrationTestResult.value = `\\n: ${results.filter(r => r.passed).length}/${results.length}\\n\\n${results.map(r => `${r.passed ? '' : ''} ${r.testName}: ${r.message}`).join('\\n')}`;\n            }\n            catch (error) {\n                integrationTestResult.value = ` : ${error}`;\n            }\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _cache[1] || (_cache[1] = _createElementVNode(\"h2\", null, \" \", -1 /* CACHED */)),\n                    _createElementVNode(\"button\", {\n                        class: \"close-btn\",\n                        onClick: _cache[0] || (_cache[0] = ($event) => (_ctx.$emit('close')))\n                    }, \"\")\n                ]),\n                _createElementVNode(\"div\", _hoisted_3, [\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_4, [\n                        _cache[2] || (_cache[2] = _createElementVNode(\"h3\", null, \" \", -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"test-actions\" }, [\n                            _createElementVNode(\"button\", { onClick: testMemoryCapture }, \"\"),\n                            _createElementVNode(\"button\", { onClick: viewMemoryArchives }, \"\"),\n                            _createElementVNode(\"button\", { onClick: testMemoryInjection }, \"\")\n                        ]),\n                        (memoryTestResult.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, _toDisplayString(memoryTestResult.value), 1 /* TEXT */))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _createCommentVNode(\" NPC  \"),\n                    _createElementVNode(\"div\", _hoisted_6, [\n                        _cache[3] || (_cache[3] = _createElementVNode(\"h3\", null, \" NPC \", -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"test-actions\" }, [\n                            _createElementVNode(\"button\", { onClick: testNPCGeneration }, \" NPC\"),\n                            _createElementVNode(\"button\", { onClick: testNPCAppearance }, \" NPC \")\n                        ]),\n                        (npcTestResult.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, _toDisplayString(npcTestResult.value), 1 /* TEXT */))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_8, [\n                        _cache[4] || (_cache[4] = _createElementVNode(\"h3\", null, \" \", -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"test-actions\" }, [\n                            _createElementVNode(\"button\", { onClick: testEventRecord }, \"\"),\n                            _createElementVNode(\"button\", { onClick: viewEventHistory }, \"\")\n                        ]),\n                        (eventTestResult.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, _toDisplayString(eventTestResult.value), 1 /* TEXT */))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_10, [\n                        _cache[5] || (_cache[5] = _createElementVNode(\"h3\", null, \" \", -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"test-actions\" }, [\n                            _createElementVNode(\"button\", { onClick: testMapGeneration }, \"\"),\n                            _createElementVNode(\"button\", { onClick: testAreaDetails }, \"\")\n                        ]),\n                        (mapTestResult.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, _toDisplayString(mapTestResult.value), 1 /* TEXT */))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _createCommentVNode(\" AI  \"),\n                    _createElementVNode(\"div\", _hoisted_12, [\n                        _cache[6] || (_cache[6] = _createElementVNode(\"h3\", null, \" AI \", -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"test-actions\" }, [\n                            _createElementVNode(\"button\", { onClick: testAIConnection }, \" AI \"),\n                            _createElementVNode(\"button\", { onClick: runAIDiagnostics }, \"\")\n                        ]),\n                        (aiTestResult.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [\n                                _createElementVNode(\"pre\", null, _toDisplayString(aiTestResult.value), 1 /* TEXT */)\n                            ]))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_14, [\n                        _cache[7] || (_cache[7] = _createElementVNode(\"h3\", null, \" \", -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"test-actions\" }, [\n                            _createElementVNode(\"button\", {\n                                class: \"primary-btn\",\n                                onClick: runIntegrationTest\n                            }, \"\")\n                        ]),\n                        (integrationTestResult.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_15, [\n                                _createElementVNode(\"pre\", null, _toDisplayString(integrationTestResult.value), 1 /* TEXT */)\n                            ]))\n                            : _createCommentVNode(\"v-if\", true)\n                    ])\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./TestPanel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./TestPanel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./TestPanel.vue?vue&type=style&index=0&id=12099c54&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-12099c54\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, normalizeClass as _normalizeClass, withModifiers as _withModifiers, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, Transition as _Transition, withCtx as _withCtx, createVNode as _createVNode, Teleport as _Teleport, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = { class: \"dialog-title\" };\nconst _hoisted_2 = { class: \"dialog-message\" };\nconst _hoisted_3 = { class: \"dialog-buttons\" };\nimport { onMounted, onUnmounted } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ConfirmDialog',\n    props: {\n        show: { type: Boolean },\n        title: {},\n        message: {},\n        confirmText: { default: '' },\n        cancelText: { default: '' },\n        dangerMode: { type: Boolean, default: false }\n    },\n    emits: [\"confirm\", \"cancel\"],\n    setup(__props, { emit: __emit }) {\n        const props = __props;\n        // ==================== Emits ====================\n        const emit = __emit;\n        // ==================== Methods ====================\n        /**\n         * \n         */\n        function handleConfirm() {\n            emit('confirm');\n        }\n        /**\n         * \n         */\n        function handleCancel() {\n            emit('cancel');\n        }\n        /**\n         * \n         */\n        function handleOverlayClick() {\n            emit('cancel');\n        }\n        /**\n         *  ESC \n         */\n        function handleEscKey(event) {\n            if (event.key === 'Escape' && props.show) {\n                emit('cancel');\n            }\n        }\n        // ==================== Lifecycle ====================\n        onMounted(() => {\n            window.addEventListener('keydown', handleEscKey);\n        });\n        onUnmounted(() => {\n            window.removeEventListener('keydown', handleEscKey);\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createBlock(_Teleport, { to: \"body\" }, [\n                _createVNode(_Transition, { name: \"fade\" }, {\n                    default: _withCtx(() => [\n                        (__props.show)\n                            ? (_openBlock(), _createElementBlock(\"div\", {\n                                key: 0,\n                                class: \"confirm-dialog-overlay\",\n                                onClick: handleOverlayClick\n                            }, [\n                                _createVNode(_Transition, { name: \"scale\" }, {\n                                    default: _withCtx(() => [\n                                        (__props.show)\n                                            ? (_openBlock(), _createElementBlock(\"div\", {\n                                                key: 0,\n                                                class: \"confirm-dialog\",\n                                                onClick: _cache[0] || (_cache[0] = _withModifiers(() => { }, [\"stop\"]))\n                                            }, [\n                                                _createElementVNode(\"h2\", _hoisted_1, _toDisplayString(__props.title), 1 /* TEXT */),\n                                                _createElementVNode(\"p\", _hoisted_2, _toDisplayString(__props.message), 1 /* TEXT */),\n                                                _createElementVNode(\"div\", _hoisted_3, [\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"btn-dialog btn-cancel\",\n                                                        onClick: handleCancel\n                                                    }, _toDisplayString(__props.cancelText), 1 /* TEXT */),\n                                                    _createElementVNode(\"button\", {\n                                                        class: _normalizeClass([\"btn-dialog btn-confirm\", { 'btn-danger': __props.dangerMode }]),\n                                                        onClick: handleConfirm\n                                                    }, _toDisplayString(__props.confirmText), 3 /* TEXT, CLASS */)\n                                                ])\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ]),\n                                    _: 1 /* STABLE */\n                                })\n                            ]))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _: 1 /* STABLE */\n                })\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ConfirmDialog.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ConfirmDialog.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./ConfirmDialog.vue?vue&type=style&index=0&id=1cd92598&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-1cd92598\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"welcome-modal-overlay\" };\nimport { ref } from 'vue';\nimport { gameResetService } from '../services/gameResetService';\nimport ConfirmDialog from './ConfirmDialog.vue';\n// ==================== State ====================\nconst confirmMessage = `\n\n  MVU \n \n \n \n\n`;\n// ==================== Emits ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'WelcomeModal',\n    emits: [\"updateCharacter\", \"continue\"],\n    setup(__props, { emit: __emit }) {\n        const showConfirmDialog = ref(false);\n        // \n        const emit = __emit;\n        /**\n         * \n         * \n         */\n        function handleUpdateCharacter() {\n            showConfirmDialog.value = true;\n        }\n        /**\n         * \n         *  gameResetService \n         */\n        async function handleConfirmReset() {\n            showConfirmDialog.value = false;\n            try {\n                // \n                await gameResetService.clearAllGameData();\n                // \n                emit('updateCharacter');\n            }\n            catch (error) {\n                console.error('[WelcomeModal] :', error);\n                toastr.error('');\n            }\n        }\n        /**\n         * \n         * \n         */\n        function handleCancelReset() {\n            showConfirmDialog.value = false;\n        }\n        /**\n         * \n         */\n        function handleContinue() {\n            emit('continue');\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", { class: \"welcome-modal\" }, [\n                    _createElementVNode(\"div\", { class: \"welcome-content\" }, [\n                        _cache[0] || (_cache[0] = _createElementVNode(\"h1\", { class: \"welcome-title\" }, \"\", -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"button-group\" }, [\n                            _createElementVNode(\"button\", {\n                                class: \"btn-action btn-update\",\n                                onClick: handleUpdateCharacter\n                            }, \"\"),\n                            _createElementVNode(\"button\", {\n                                class: \"btn-action btn-continue\",\n                                onClick: handleContinue\n                            }, \"\")\n                        ])\n                    ])\n                ]),\n                _createCommentVNode(\"  \"),\n                _createVNode(ConfirmDialog, {\n                    show: showConfirmDialog.value,\n                    title: \"\",\n                    message: confirmMessage,\n                    \"confirm-text\": \"\",\n                    \"cancel-text\": \"\",\n                    \"danger-mode\": true,\n                    onConfirm: handleConfirmReset,\n                    onCancel: handleCancelReset\n                }, null, 8 /* PROPS */, [\"show\"])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./WelcomeModal.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./WelcomeModal.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./WelcomeModal.vue?vue&type=style&index=0&id=e852e086&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-e852e086\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createVNode as _createVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, unref as _unref, vShow as _vShow, withDirectives as _withDirectives, withModifiers as _withModifiers, normalizeClass as _normalizeClass, toDisplayString as _toDisplayString } from \"vue\";\nconst _hoisted_1 = { class: \"main-interface\" };\nconst _hoisted_2 = { class: \"layer layer-background\" };\nconst _hoisted_3 = { class: \"layer layer-sprite\" };\nconst _hoisted_4 = { class: \"layer layer-ui\" };\nconst _hoisted_5 = {\n    key: 1,\n    class: \"modal-overlay sanctuary-modal\"\n};\nconst _hoisted_6 = {\n    key: 2,\n    class: \"modal-overlay character-creation-overlay\"\n};\nconst _hoisted_7 = {\n    key: 4,\n    class: \"control-panel\"\n};\nconst _hoisted_8 = [\"title\"];\nconst _hoisted_9 = [\"title\"];\nconst _hoisted_10 = [\"title\"];\nconst _hoisted_11 = {\n    key: 8,\n    class: \"modal-overlay\"\n};\nimport { computed, onBeforeUnmount, onMounted, ref } from 'vue';\nimport { memoryFragmentService } from '../services/memoryFragmentService';\nimport { mvuService } from '../services/mvuService';\nimport { tavernService } from '../services/tavernService';\nimport { useCharacterStore } from '../stores/characterStore';\nimport { useGameStore } from '../stores/gameStore';\nimport APIConfigPanel from './APIConfigPanel.vue';\nimport Background from './Background.vue';\nimport CharacterCreator from './CharacterCreator.vue';\nimport CharacterPanel from './CharacterPanel.vue';\nimport CharacterSprite from './CharacterSprite.vue';\nimport CombatPanel from './CombatPanel.vue';\nimport DialogueBox from './DialogueBox.vue';\nimport DiceRoller from './DiceRoller.vue';\nimport InstanceGenerator from './InstanceGenerator.vue';\nimport InstanceRecord from './InstanceRecord.vue';\nimport InventoryPanel from './InventoryPanel.vue';\nimport MapPanel from './MapPanel.vue';\nimport PlotReview from './PlotReview.vue';\nimport SanctuaryView from './SanctuaryView.vue';\nimport StatusBar from './StatusBar.vue';\nimport TestPanel from './TestPanel.vue';\nimport WelcomeModal from './WelcomeModal.vue';\n\nimport { watch } from 'vue';\n// ==================== Store ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'MainInterface',\n    setup(__props) {\n        const characterStore = useCharacterStore();\n        const gameStore = useGameStore();\n        // ====================  ====================\n        const showWelcome = ref(true); // \n        const showCharacterPanel = ref(false);\n        const showCharacterCreator = ref(false);\n        const showDiceRoller = ref(false);\n        const showMapPanel = ref(false);\n        const showInventory = ref(false);\n        const showInstanceGenerator = ref(false);\n        const showInstanceRecord = ref(false);\n        const showPlotReview = ref(false);\n        const showAPIConfig = ref(false);\n        const showTestPanel = ref(false);\n        const dialogueClosed = ref(false);\n        const uiHidden = ref(false);\n        const isFullscreen = ref(false);\n        const dialogueBoxRef = ref(null);\n        const editingCharacter = ref(undefined);\n        // ====================  ====================\n        const currentBackground = computed(() => {\n            return gameStore.currentScene?.background || '';\n        });\n        const activeSprites = computed(() => {\n            return gameStore.currentScene?.sprites || [];\n        });\n        // ====================  ====================\n        // \n        watch(() => gameStore.mode, newMode => {\n            if (newMode !== 'main' && showPlotReview.value) {\n                showPlotReview.value = false;\n            }\n        });\n        // ====================  ====================\n        /**\n         * \n         */\n        function toggleCharacterPanel() {\n            showCharacterPanel.value = !showCharacterPanel.value;\n        }\n        /**\n         * \n         */\n        function toggleDiceRoller() {\n            showDiceRoller.value = !showDiceRoller.value;\n        }\n        /**\n         * \n         */\n        function toggleCombatPanel() {\n            if (gameStore.mode === 'combat') {\n                exitCombatMode();\n            }\n            else {\n                gameStore.setMode('combat');\n            }\n        }\n        /**\n         * \n         */\n        function exitCombatMode() {\n            gameStore.setMode('main');\n        }\n        /**\n         * \n         */\n        function toggleMapPanel() {\n            showMapPanel.value = !showMapPanel.value;\n        }\n        /**\n         * \n         */\n        function toggleInventory() {\n            showInventory.value = !showInventory.value;\n        }\n        /**\n         * \n         */\n        function toggleInstanceGenerator() {\n            showInstanceGenerator.value = !showInstanceGenerator.value;\n        }\n        /**\n         * \n         */\n        function togglePlotReview() {\n            showPlotReview.value = !showPlotReview.value;\n        }\n        /**\n         * \n         */\n        function toggleInstanceRecord() {\n            showInstanceRecord.value = !showInstanceRecord.value;\n        }\n        /**\n         *  API \n         */\n        function toggleAPIConfig() {\n            showAPIConfig.value = !showAPIConfig.value;\n        }\n        /**\n         * \n         */\n        function toggleTestPanel() {\n            showTestPanel.value = !showTestPanel.value;\n        }\n        /**\n         * \n         */\n        function toggleSanctuary() {\n            if (gameStore.mode === 'sanctuary') {\n                exitSanctuaryMode();\n            }\n            else {\n                gameStore.setMode('sanctuary');\n            }\n        }\n        /**\n         * \n         */\n        function exitSanctuaryMode() {\n            gameStore.setMode('main');\n        }\n        /**\n         * \n         */\n        function exitCreationMode() {\n            gameStore.setMode('main');\n        }\n        /**\n         * \n         */\n        function handleUpdateCharacter() {\n            console.log('[MainInterface] ');\n            showWelcome.value = false;\n            // \n            gameStore.setMode('creation');\n        }\n        /**\n         * \n         */\n        function handleContinue() {\n            console.log('[MainInterface] ');\n            showWelcome.value = false;\n            // \n        }\n        /**\n         * \n         */\n        async function handleCharacterCreated(character) {\n            console.log('[MainInterface] :', character.name);\n            showCharacterCreator.value = false;\n            editingCharacter.value = undefined;\n            // \n            if (gameStore.mode === 'creation') {\n                exitCreationMode();\n            }\n            toastr.success(` ${character.name} `);\n            //  characterInitializer \n            if (character.type === 'player') {\n                console.log('[MainInterface]  characterInitializer.onCharacterCreated()');\n                try {\n                    const { characterInitializer } = await import('../services/characterInitializer');\n                    await characterInitializer.onCharacterCreated(character);\n                    console.log('[MainInterface]  ');\n                }\n                catch (error) {\n                    console.error('[MainInterface]  :', error);\n                    toastr.error('');\n                }\n            }\n        }\n        /**\n         * \n         */\n        function handleEditCharacter(character) {\n            editingCharacter.value = character;\n            showCharacterPanel.value = false;\n            showCharacterCreator.value = true;\n        }\n        /**\n         * \n         * \n         */\n        function handleNewMessage() {\n            console.log('[MainInterface] ');\n            if (dialogueClosed.value) {\n                dialogueClosed.value = false;\n                dialogueBoxRef.value?.openDialogue();\n            }\n        }\n        /**\n         * /\n         */\n        function toggleDialogue() {\n            if (dialogueClosed.value) {\n                // \n                dialogueClosed.value = false;\n                dialogueBoxRef.value?.openDialogue();\n            }\n            else {\n                // \n                dialogueClosed.value = true;\n            }\n        }\n        /**\n         * UI/\n         */\n        function toggleUI() {\n            uiHidden.value = !uiHidden.value;\n        }\n        /**\n         * \n         */\n        function toggleFullscreen() {\n            const element = document.documentElement;\n            if (!isFullscreen.value) {\n                // \n                if (element.requestFullscreen) {\n                    element.requestFullscreen();\n                }\n                else if (element.webkitRequestFullscreen) {\n                    element.webkitRequestFullscreen();\n                }\n                else if (element.msRequestFullscreen) {\n                    element.msRequestFullscreen();\n                }\n            }\n            else if (document.exitFullscreen) {\n                // \n                document.exitFullscreen();\n            }\n            else if (document.webkitExitFullscreen) {\n                document.webkitExitFullscreen();\n            }\n            else if (document.msExitFullscreen) {\n                document.msExitFullscreen();\n            }\n        }\n        /**\n         * \n         */\n        function handleFullscreenChange() {\n            isFullscreen.value = !!(document.fullscreenElement ||\n                document.webkitFullscreenElement ||\n                document.msFullscreenElement);\n        }\n        /**\n         * \n         */\n        async function initialize() {\n            try {\n                console.log('[MainInterface] ...');\n                //  MVU \n                console.log('[MainInterface] 1/9  MVU ...');\n                await mvuService.initialize();\n                // \n                console.log('[MainInterface] 2/9 ...');\n                tavernService.initialize();\n                tavernService.setupEventListeners();\n                // \n                console.log('[MainInterface] 3/9 ...');\n                await characterStore.loadFromMVU();\n                console.log('[MainInterface] hasPlayer:', characterStore.hasPlayer);\n                // \n                console.log('[MainInterface] 4/9 ...');\n                await gameStore.initialize();\n                // \n                console.log('[MainInterface] 5/9 ...');\n                await memoryFragmentService.initialize();\n                memoryFragmentService.startListening();\n                // \n                console.log('[MainInterface] 6/9 ...');\n                const { eventRecordService } = await import('../services/eventRecordService');\n                eventRecordService.initialize();\n                //  API \n                console.log('[MainInterface] 7/9  API ...');\n                const { apiConfigService } = await import('../services/apiConfigService');\n                await apiConfigService.initialize();\n                // \n                console.log('[MainInterface] 8/10 ...');\n                const { sanctuaryService } = await import('../services/sanctuaryService');\n                await sanctuaryService.initialize();\n                // \n                console.log('[MainInterface] 9/10 ...');\n                try {\n                    const { useInventoryStore } = await import('../stores/inventoryStore');\n                    const inventoryStore = useInventoryStore();\n                    await inventoryStore.loadFromGlobal();\n                    console.log('[MainInterface] ');\n                }\n                catch (error) {\n                    console.error('[MainInterface] :', error);\n                    // \n                }\n                //  0 \n                console.log('[MainInterface] 10/10 ...');\n                const { characterInitializer } = await import('../services/characterInitializer');\n                const needsInit = await characterInitializer.checkAndInitialize();\n                if (needsInit) {\n                    console.log('[MainInterface]  ');\n                }\n                else {\n                    console.log('[MainInterface]  ');\n                }\n                console.log('[MainInterface]  ');\n                toastr.success('');\n            }\n            catch (error) {\n                console.error('[MainInterface]  :', error);\n                toastr.error('');\n            }\n        }\n        // ====================  ====================\n        onMounted(() => {\n            // \n            console.log('[MainInterface] ...');\n            // \n            document.addEventListener('fullscreenchange', handleFullscreenChange);\n            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\n            document.addEventListener('msfullscreenchange', handleFullscreenChange);\n            // \n            // \n            eventOn('character_created', async () => {\n                console.log('[MainInterface] ');\n                try {\n                    // \n                    const { characterInitializer } = await import('../services/characterInitializer');\n                    await characterInitializer.syncToSillyTavern();\n                    // \n                    const { realWorldMapService } = await import('../services/realWorldMapService');\n                    const characterStore = useCharacterStore();\n                    if (characterStore.player) {\n                        // \n                        const hasMap = await realWorldMapService.hasMap();\n                        if (!hasMap) {\n                            console.log('[MainInterface] ...');\n                            await realWorldMapService.generateMap(characterStore.player);\n                            console.log('[MainInterface] ');\n                        }\n                        else {\n                            console.log('[MainInterface] ');\n                        }\n                    }\n                }\n                catch (error) {\n                    console.error('[MainInterface] :', error);\n                    toastr.error('');\n                }\n                finally {\n                    // \n                    if (gameStore.mode === 'creation') {\n                        gameStore.setMode('main');\n                    }\n                }\n            });\n            console.log('[MainInterface] ...');\n            // \n            setTimeout(() => {\n                initialize();\n            }, 0);\n        });\n        onBeforeUnmount(() => {\n            document.removeEventListener('fullscreenchange', handleFullscreenChange);\n            document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);\n            document.removeEventListener('msfullscreenchange', handleFullscreenChange);\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createCommentVNode(\" ====================  ==================== \"),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createVNode(Background, { \"background-url\": currentBackground.value }, null, 8 /* PROPS */, [\"background-url\"])\n                ]),\n                _createCommentVNode(\" ====================  ==================== \"),\n                _createElementVNode(\"div\", _hoisted_3, [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(activeSprites.value, (sprite) => {\n                        return (_openBlock(), _createBlock(CharacterSprite, {\n                            key: sprite.characterId,\n                            \"sprite-data\": sprite\n                        }, null, 8 /* PROPS */, [\"sprite-data\"]));\n                    }), 128 /* KEYED_FRAGMENT */))\n                ]),\n                _createCommentVNode(\" ==================== UI  ==================== \"),\n                _withDirectives(_createElementVNode(\"div\", _hoisted_4, [\n                    _createCommentVNode(\"  UI \"),\n                    (_unref(gameStore).mode === 'main')\n                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                            _createCommentVNode(\"  \"),\n                            _withDirectives(_createVNode(StatusBar, null, null, 512 /* NEED_PATCH */), [\n                                [_vShow, _unref(characterStore).hasPlayer]\n                            ]),\n                            _createCommentVNode(\"  \"),\n                            _withDirectives(_createVNode(DialogueBox, {\n                                ref_key: \"dialogueBoxRef\",\n                                ref: dialogueBoxRef,\n                                onNewMessage: handleNewMessage\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vShow, !dialogueClosed.value]\n                            ])\n                        ], 64 /* STABLE_FRAGMENT */))\n                        : _createCommentVNode(\"v-if\", true)\n                ], 512 /* NEED_PATCH */), [\n                    [_vShow, !uiHidden.value]\n                ]),\n                _createCommentVNode(\" ====================  ==================== \"),\n                (_unref(gameStore).mode === 'combat' && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"modal-overlay\",\n                        onClick: exitCombatMode\n                    }, [\n                        _createElementVNode(\"div\", {\n                            onClick: _cache[0] || (_cache[0] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(CombatPanel, { onClose: exitCombatMode })\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\" ====================  ==================== \"),\n                (_unref(gameStore).mode === 'sanctuary' && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [\n                        _createElementVNode(\"div\", {\n                            class: \"sanctuary-container\",\n                            onClick: _cache[1] || (_cache[1] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(SanctuaryView, { onClose: exitSanctuaryMode })\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\" ====================  ==================== \"),\n                (_unref(gameStore).mode === 'creation' && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [\n                        _createElementVNode(\"div\", {\n                            onClick: _cache[2] || (_cache[2] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(CharacterCreator, {\n                                \"sync-to-tavern\": true,\n                                \"character-type\": \"player\",\n                                onCreated: handleCharacterCreated\n                            })\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\" ====================  ==================== \"),\n                (showWelcome.value)\n                    ? (_openBlock(), _createBlock(WelcomeModal, {\n                        key: 3,\n                        onUpdateCharacter: handleUpdateCharacter,\n                        onContinue: handleContinue\n                    }))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\" ====================  ==================== \"),\n                (!uiHidden.value && _unref(gameStore).mode === 'main')\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"control-btn\", { active: showCharacterPanel.value }]),\n                            title: \"\",\n                            onClick: toggleCharacterPanel\n                        }, \"  \", 2 /* CLASS */),\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"control-btn\", { active: showInstanceGenerator.value }]),\n                            title: \"\",\n                            onClick: toggleInstanceGenerator\n                        }, \"  \", 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"control-btn\", { active: showInstanceRecord.value }]),\n                            title: \"\",\n                            onClick: toggleInstanceRecord\n                        }, \"  \", 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"control-btn\", { active: _unref(gameStore).mode === 'sanctuary' }]),\n                            title: \"\",\n                            onClick: toggleSanctuary\n                        }, \"  \", 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"control-btn\", { active: showDiceRoller.value }]),\n                            title: \"\",\n                            onClick: toggleDiceRoller\n                        }, \"  \", 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"control-btn\", { active: _unref(gameStore).mode === 'combat' }]),\n                            title: \"\",\n                            onClick: toggleCombatPanel\n                        }, \"  \", 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"control-btn\", { active: showMapPanel.value }]),\n                            title: \"\",\n                            onClick: toggleMapPanel\n                        }, \"\", 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"control-btn\", { active: showInventory.value }]),\n                            title: \"\",\n                            onClick: toggleInventory\n                        }, \"\", 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"control-btn\", { active: showAPIConfig.value }]),\n                            title: \"API \",\n                            onClick: toggleAPIConfig\n                        }, \"  \", 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"control-btn\", { active: showTestPanel.value }]),\n                            title: \"\",\n                            onClick: toggleTestPanel\n                        }, \"  \", 2 /* CLASS */)\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\" UI \"),\n                _createElementVNode(\"button\", {\n                    class: _normalizeClass([\"ui-toggle-btn\", { 'ui-hidden': uiHidden.value }]),\n                    title: uiHidden.value ? 'UI' : 'UI',\n                    onClick: toggleUI\n                }, _toDisplayString(uiHidden.value ? '' : ''), 11 /* TEXT, CLASS, PROPS */, _hoisted_8),\n                _createCommentVNode(\"  \"),\n                (!uiHidden.value && _unref(gameStore).mode === 'main')\n                    ? (_openBlock(), _createElementBlock(\"button\", {\n                        key: 5,\n                        class: _normalizeClass([\"toggle-dialogue-btn\", { active: !dialogueClosed.value }]),\n                        title: dialogueClosed.value ? '' : '',\n                        onClick: toggleDialogue\n                    }, \"  \", 10 /* CLASS, PROPS */, _hoisted_9))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (!uiHidden.value && _unref(gameStore).mode !== 'sanctuary')\n                    ? (_openBlock(), _createElementBlock(\"button\", {\n                        key: 6,\n                        class: \"fullscreen-btn\",\n                        title: isFullscreen.value ? '' : '',\n                        onClick: toggleFullscreen\n                    }, _toDisplayString(isFullscreen.value ? '' : ''), 9 /* TEXT, PROPS */, _hoisted_10))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showCharacterPanel.value && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 7,\n                        class: \"modal-overlay\",\n                        onClick: toggleCharacterPanel\n                    }, [\n                        _createElementVNode(\"div\", {\n                            onClick: _cache[3] || (_cache[3] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(CharacterPanel, {\n                                onClose: toggleCharacterPanel,\n                                onEdit: handleEditCharacter\n                            })\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showCharacterCreator.value && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [\n                        _createElementVNode(\"div\", {\n                            onClick: _cache[4] || (_cache[4] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(CharacterCreator, {\n                                \"sync-to-tavern\": true,\n                                \"character-type\": editingCharacter.value?.type || 'player',\n                                \"editing-character\": editingCharacter.value,\n                                onCreated: handleCharacterCreated\n                            }, null, 8 /* PROPS */, [\"character-type\", \"editing-character\"])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showDiceRoller.value && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 9,\n                        class: \"modal-overlay\",\n                        onClick: toggleDiceRoller\n                    }, [\n                        _createElementVNode(\"div\", {\n                            onClick: _cache[5] || (_cache[5] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(DiceRoller, { onClose: toggleDiceRoller })\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showMapPanel.value && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 10,\n                        class: \"modal-overlay\",\n                        onClick: toggleMapPanel\n                    }, [\n                        _createElementVNode(\"div\", {\n                            onClick: _cache[6] || (_cache[6] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(MapPanel)\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showInventory.value && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 11,\n                        class: \"modal-overlay\",\n                        onClick: toggleInventory\n                    }, [\n                        _createElementVNode(\"div\", {\n                            onClick: _cache[7] || (_cache[7] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(InventoryPanel, { onClose: toggleInventory })\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showInstanceGenerator.value && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 12,\n                        class: \"modal-overlay\",\n                        onClick: toggleInstanceGenerator\n                    }, [\n                        _createElementVNode(\"div\", {\n                            onClick: _cache[8] || (_cache[8] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(InstanceGenerator, { onClose: toggleInstanceGenerator })\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showInstanceRecord.value && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 13,\n                        class: \"modal-overlay\",\n                        onClick: toggleInstanceRecord\n                    }, [\n                        _createElementVNode(\"div\", {\n                            onClick: _cache[9] || (_cache[9] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(InstanceRecord, { onClose: toggleInstanceRecord })\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\" API  \"),\n                (showAPIConfig.value && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 14,\n                        class: \"modal-overlay\",\n                        onClick: toggleAPIConfig\n                    }, [\n                        _createElementVNode(\"div\", {\n                            onClick: _cache[10] || (_cache[10] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(APIConfigPanel, { onClose: toggleAPIConfig })\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showTestPanel.value && !uiHidden.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 15,\n                        class: \"modal-overlay\",\n                        onClick: toggleTestPanel\n                    }, [\n                        _createElementVNode(\"div\", {\n                            onClick: _cache[11] || (_cache[11] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createVNode(TestPanel, { onClose: toggleTestPanel })\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showPlotReview.value && !uiHidden.value && _unref(gameStore).mode === 'main')\n                    ? (_openBlock(), _createBlock(PlotReview, {\n                        key: 16,\n                        onClose: togglePlotReview\n                    }))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (!uiHidden.value && _unref(gameStore).mode === 'main')\n                    ? (_openBlock(), _createElementBlock(\"button\", {\n                        key: 17,\n                        class: _normalizeClass([\"plot-review-btn\", { active: showPlotReview.value }]),\n                        title: \"\",\n                        onClick: togglePlotReview\n                    }, \"  \", 2 /* CLASS */))\n                    : _createCommentVNode(\"v-if\", true)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./MainInterface.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./MainInterface.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./MainInterface.vue?vue&type=style&index=0&id=470a9889&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-470a9889\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, Fragment as _Fragment, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = { class: \"infinite-flow-game\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"loading-overlay\"\n};\nconst _hoisted_3 = { class: \"loading-content\" };\nconst _hoisted_4 = { class: \"error-overlay\" };\nconst _hoisted_5 = { class: \"error-content\" };\nimport { onMounted, ref } from 'vue';\nimport MainInterface from './components/MainInterface.vue';\n// ====================  ====================\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'app',\n    setup(__props) {\n        const isLoading = ref(true);\n        const hasError = ref(false);\n        const errorMessage = ref('');\n        const loadingMessage = ref('...');\n        // ====================  ====================\n        async function initialize() {\n            isLoading.value = true;\n            hasError.value = false;\n            errorMessage.value = '';\n            try {\n                loadingMessage.value = ' MVU ...';\n                console.log('[App] ');\n                // MVU  MainInterface \n                console.log('[App] ');\n                isLoading.value = false;\n            }\n            catch (error) {\n                console.error('[App] :', error);\n                hasError.value = true;\n                errorMessage.value = error instanceof Error ? error.message : '';\n                toastr.error('');\n                isLoading.value = false;\n            }\n        }\n        function retry() {\n            initialize();\n        }\n        // ====================  ====================\n        onMounted(() => {\n            initialize();\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createCommentVNode(\"  \"),\n                (isLoading.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n                        _createElementVNode(\"div\", _hoisted_3, [\n                            _cache[0] || (_cache[0] = _createElementVNode(\"div\", { class: \"loading-spinner\" }, null, -1 /* CACHED */)),\n                            _createElementVNode(\"p\", null, _toDisplayString(loadingMessage.value), 1 /* TEXT */)\n                        ])\n                    ]))\n                    : (hasError.value)\n                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", _hoisted_4, [\n                                _createElementVNode(\"div\", _hoisted_5, [\n                                    _cache[1] || (_cache[1] = _createElementVNode(\"h2\", null, \" \", -1 /* CACHED */)),\n                                    _createElementVNode(\"p\", null, _toDisplayString(errorMessage.value), 1 /* TEXT */),\n                                    _createElementVNode(\"button\", {\n                                        class: \"retry-button\",\n                                        onClick: retry\n                                    }, \"\")\n                                ])\n                            ])\n                        ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                        : (_openBlock(), _createElementBlock(_Fragment, { key: 2 }, [\n                            _createCommentVNode(\"  \"),\n                            _createVNode(MainInterface)\n                        ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./app.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./app.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./app.vue?vue&type=style&index=0&id=dd7cafd0&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-dd7cafd0\"]])\n\nexport default __exports__","import { createPinia } from 'pinia';\nimport toastr from 'toastr';\nimport { createApp } from 'vue';\nimport app from './app.vue';\nimport { apiAutoSwitchService } from './services/apiAutoSwitchService';\nimport { memoryFragmentService } from './services/memoryFragmentService';\nimport { sanctuaryService } from './services/sanctuaryService';\nimport { streamService } from './services/streamService';\nimport './styles/global.scss';\n\n// \nwindow.addEventListener('error', event => {\n  console.error(':', event.error);\n  toastr.error('');\n});\n\n/**\n *  0 \n */\nfunction hideNonZeroMessages(): void {\n  try {\n    console.log('[]  0 ...');\n\n    // \n    const $messages = $('.mes', window.parent.document);\n\n    console.log('[] ', $messages.length, '');\n\n    let hiddenCount = 0;\n\n    //  0 \n    $messages.each((index, element) => {\n      const $element = $(element);\n\n      //  mesid \n      const mesId = $element.attr('mesid');\n\n      console.log(`[]  ${index}: mesid=${mesId}`);\n\n      //  0 mesid=\"0\"\n      if (mesId !== '0' && mesId !== undefined) {\n        $element.addClass('hidden-by-infinite-flow').hide();\n        hiddenCount++;\n        console.log(`[] : mesid=${mesId}`);\n      } else {\n        console.log(`[] : mesid=${mesId} ( 0 )`);\n      }\n    });\n\n    console.log('[] ', hiddenCount, ' 0  0 ');\n  } catch (error) {\n    console.error('[] :', error);\n  }\n}\n\n/**\n * \n */\nfunction restoreHiddenMessages(): void {\n  try {\n    console.log('[] ...');\n\n    // \n    const $hiddenMessages = $('.hidden-by-infinite-flow', window.parent.document);\n\n    console.log('[] ', $hiddenMessages.length, '');\n\n    // \n    $hiddenMessages.removeClass('hidden-by-infinite-flow').show();\n\n    console.log('[] ');\n  } catch (error) {\n    console.error('[] :', error);\n  }\n}\n\n$(() => {\n  console.log('[] ...');\n  console.log('[] :', new Date().toLocaleString());\n\n  //  0 \n  hideNonZeroMessages();\n\n  //  MVU \n  console.log('[]  MVU ...');\n  waitGlobalInitialized('Mvu')\n    .then(async () => {\n      console.log('[] MVU ');\n\n      // \n      console.log('[] ...');\n      streamService.setupStreamListeners();\n      console.log('[] ');\n\n      // \n      console.log('[] ...');\n      await memoryFragmentService.initialize();\n      memoryFragmentService.startListening();\n      console.log('[] ');\n\n      // \n      console.log('[] ...');\n      await sanctuaryService.initialize();\n      console.log('[] ');\n\n      //  API \n      console.log('[]  API ...');\n      try {\n        await apiAutoSwitchService.initialize();\n        console.log('[] API ');\n      } catch (error) {\n        console.error('[] API :', error);\n        console.error('[] :', error);\n        toastr.warning('API  API');\n        // \n      }\n\n      //  Vue \n      console.log('[]  Vue ...');\n      const vueApp = createApp(app);\n\n      //  Pinia\n      console.log('[]  Pinia ...');\n      const pinia = createPinia();\n      vueApp.use(pinia);\n\n      // \n      console.log('[]  Vue  #app...');\n      vueApp.mount('#app');\n\n      console.log('[] ');\n      toastr.success('');\n\n      // \n      const chat_id = SillyTavern.getCurrentChatId();\n      console.log('[]  ID:', chat_id);\n      console.log('[] ...');\n\n      eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n        console.log('[] ');\n        console.log('[]  ID:', chat_id);\n        console.log('[]  ID:', new_chat_id);\n\n        if (chat_id !== new_chat_id) {\n          console.log('[] ...');\n          toastr.info('...');\n          window.location.reload();\n        }\n      });\n\n      console.log('[] ');\n    })\n    .catch(error => {\n      console.error('[] MVU :', error);\n      console.error('[] :', {\n        message: error.message,\n        stack: error.stack,\n        name: error.name,\n      });\n      toastr.error('MVU  MVU ');\n    });\n});\n\n// \n$(window).on('pagehide', async () => {\n  console.log('[] ');\n  console.log('[] :', new Date().toLocaleString());\n\n  //  API \n  try {\n    console.log('[]  API ...');\n    await apiAutoSwitchService.cleanup();\n    console.log('[] API ');\n  } catch (error) {\n    console.error('[] API :', error);\n    // \n  }\n\n  // \n  restoreHiddenMessages();\n\n  console.log('[] ');\n  toastr.info('');\n});\n"],"names":["leafPrototypes","getProto","module","exports","y","x","__webpack_require__","d","__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_klona_esm_74666e88__","__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_pinia_esm_b723a504__","worldBookService","initialized","currentWorld","worldbookName","initialize","this","console","log","charWorldbooks","getCharWorldbookNames","primary","warn","error","activateRealWorldEntries","updatedWorldbook","getWorldbook","map","entry","worldType","extra","strategy","type","keys","length","replaceWorldbook","activateInnerWorldEntries","activateInteractionRoomEntries","getCurrentWorld","getWorldbookName","reload","Vue","useCharacterStore","defineStore","player","ref","undefined","npcs","Map","activeCharacters","hasPlayer","computed","value","npcList","Array","from","values","npcCount","size","activeNPCs","id","get","filter","npc","importantNPCs","isImportant","loadFromMVU","async","globalVars","getVariables","player_character","name","globalError","gameData","mvuService","loadGameData","characters","insertOrAssignVariables","syncError","clear","Object","entries","forEach","set","toastr","setPlayer","character","saveCharacter","success","updatePlayer","updates","Error","attributes","assign","derivedStats","bodyParts","updateCharacterStatus","addNPC","updateNPC","npcId","affection","deleteNPC","npcName","delete","info","getCharacter","characterId","setActiveCharacters","characterIds","addActiveCharacter","includes","push","removeActiveCharacter","updateAffection","clampedAffection","Math","max","min","setNPCImportant","status","addNPCEvent","event","events","reset","realWorldMapService","generateMap","prompt","age","occupation","background","text","should_stream","prompt_length","character_name","character_occupation","generate","user_input","apiError","message","String","stack","result","parseMapFromText","generateAreaDetails","saveMap","generateDefaultMap","areas_count","areas","startArea","playerLocation","warning","fallbackError","serializedMap","area","connections","real_world_map","loadMap","data","mapData","updatePlayerLocation","areaId","has","isDiscovered","hasMap","YAML","default","patterns","regex","i","match","parse","has_home","some","a","validateMapData","buildMapData","e","isArray","description","connectedAreas","isDangerous","relatedNPCs","generateConnections","connectedId","c","to","areaDetailsService","join","successCount","failCount","details","generateDetails","area_id","total","failed","useInventoryStore","realWorldInventory","items","instanceInventory","addToRealWorld","item","removeFromInstance","itemId","index","findIndex","splice","saveToGlobal","inventory","addToInstance","removeFromRealWorld","clearInstanceInventory","itemCount","clearRealWorldInventory","clearAllInventories","realWorldCount","instanceCount","totalCount","transferToRealWorld","itemIds","find","loadFromGlobal","testAIService","testPrompt","response","substring","errorMessage","diagnosis","runFullDiagnostics","report","config","chatSettings","SillyTavern","chatCompletionSettings","mainApi","model","openai_model","endpoint","api_url_scale","hasApiKey","Boolean","api_key_openai","api_key_claude","getAIConfigInfo","testResult","useInstanceStore","currentInstanceId","instances","currentInstance","hasActiveInstance","instanceList","currentArea","saveToMVU","instancesObj","instance","klona","cleanInstance","areasObj","saveGameData","setCurrentInstance","instanceId","addInstance","updateInstance","getInstance","getAllInstances","removeInstance","toggleImportantNPC","charInInstance","getInstancesByWorldSetting","worldSetting","addCharacterToInstance","importance","appearanceCount","discoverArea","addMemento","memento","mementos","m","updateNPCImportance","updateNPCAppearanceCount","count","updateInstanceStatus","startTime","endTime","Date","now","addEvent","summary","endInstance","completeInstance","ProtagonistValidator","validateGlobalVariables","expectedName","expectedDescription","actualName","player_name","expected","actual","actualDescription","player_description","expectedLength","actualLength","validateInterceptor","st","getUserName","getPersonaDescription","powerUserSettings","persona_description","validate","errors","globalVariablesValid","interceptorValid","nameMatch","descriptionMatch","globalVarsValid","characterInitializer","interceptorState","isSetup","currentName","currentDescription","originalMethods","checkAndInitialize","chatLength","chat","messages","getChatMessages","isFloorZero","characterStore","eventEmit","syncToSillyTavern","formatCharacterDescription","setupInterceptor","resetInterceptor","currentState","playerName","playerDescription","powerUser","defineProperty","configurable","descriptionLength","verifyProtagonistInfo","timeOut","lines","STR","CON","SIZ","DEX","APP","INT","POW","EDU","LUK","derived","HP","maxHP","MP","maxMP","SAN","maxSAN","MOV","DB","BUILD","skills","onCharacterCreated","gameResetService","resetAPIConfiguration","isRealWorld","withAPIContext","generateRaw","ordered_prompts","role","content","generateDefaultDetails","parseDetailsFromText","validateDetails","buildDetails","environment","atmosphere","random","toString","substr","defaultItems","COC7AttributesSchema","z","object","number","DerivedStatsSchema","string","BodyPartDebuffSchema","optional","BodyPartStatusSchema","lazy","parent","damage","debuffs","array","children","ItemSchema","isOccupational","boolean","quantity","BaseCharacterSchema","record","transform","val","portrait","PlayerCharacterSchema","extend","literal","NPCCharacterSchema","relationship","CharacterSchema","union","SpriteDataSchema","url","position","enum","scale","opacity","AreaSchema","ConnectionSchema","isLocked","requirement","MapDataSchema","CharacterInInstanceSchema","firstAppearance","lastSeen","ImportantEventSchema","timestamp","location","involvedCharacters","consequences","InstanceRecordSchema","difficulty","ending","isActive","customPrompt","RollResultSchema","DiceRollSchema","roll","skill","skillName","StatusEffectSchema","duration","effect","attribute","modifier","damagePerRound","EnemySchema","attackPattern","loot","CombatActionSchema","actorId","targetId","attackType","skillUsed","bodyPartHit","CombatRoundSchema","roundNumber","actions","CombatParticipantSchema","enemy","isPlayer","currentHP","currentMP","currentSAN","statusEffects","initiative","DialogueDataSchema","participants","currentRound","currentTurn","rounds","speaker","MVUGameDataSchema","sprites","game","mode","interaction","dialogues","waitGlobalInitialized","ensureInitialized","messageId","rawData","Mvu","getMvuData","message_id","defaultData","validatedData","formatZodError","formatted","saveError","cleanData","updatedMvuData","stat_data","replaceMvuData","updateGameMode","newMode","parseAndUpdateFromMessage","containsMVUCommands","currentMvuData","newMvuData","parseMessage","eventRecordService","eventKeywords","recordEventFromAIOutput","aiOutput","currentNPCs","containsImportantEvent","generateEventSummary","detectImportance","generateEventId","instanceStore","keyword","sentences","split","sentence","trimmed","trim","getInstanceEvents","getImportantEvents","import","apiConfigService","configs","loadConfigs","savedConfigs","api_configs","realWorld","innerWorld","sanctuary","saveConfigs","getCurrentAPI","getWorldAPI","world","getAllConfigs","updateWorldAPI","switchToRealWorld","switchToInnerWorld","switchToSanctuary","testConnection","worldToTest","originalWorld","validateConfig","apiurl","startsWith","key","temperature","max_tokens","valid","resetConfigs","defaultConfigs","_","useGameStore","currentScene","isStreaming","streamingText","streamingDialogue","finalDialogue","isInCombat","isInSanctuary","isInCreation","isInMainGame","updateScene","scene","setCurrentArea","clearStreaming","debouncedSave","watchEffect","setupAutoSync","setMode","updateStreamingDialogue","dialogue","setFinalDialogue","updateStreamingText","generateInstance","areaCount","hasCustomPrompt","instanceTypes","finalType","floor","finalDifficulty","source","npcGenerationCoordinator","calculateNPCCount","generateRandomNPCs","current","extendedTimeOut","npcInfo","yamlMatch","generatedData","instanceRecord","rollDice","evaluateRoll","performSkillCheck","skillValue","calculateMovement","calculateDamageBonus","sum","calculateDerivedStats","generateRandomAttributes","method","rollAttribute","resolveOpposedRoll","attacker","defender","attackerRoll","defenderRoll","successLevels","critical_success","extreme_success","hard_success","failure","critical_failure","attackerLevel","defenderLevel","calculateDamage","baseDamage","armor","checkInsanity","sanLoss","newSAN","isInsane","getRollResultText","LOG_CONFIG","PREFIX","SLOW_THRESHOLD","DEBUG_MODE","OperationType","logger","logSwitchStart","level","SWITCH","debug","logSwitchComplete","COMPLETE","logSkipSwitch","SKIP","logRestoreStart","RESTORE","logRestoreComplete","logEnter","ENTER","logExit","EXIT","logCallbackSuccess","isSlow","slowMarker","toFixed","logCallbackError","FAILED","logCriticalError","logWarning","logDebug","logStackState","depth","switchToWorld","apiContextManager","contextStack","withContext","targetWorld","callback","safeGetCurrentWorld","performance","pop","currentConfig","restoreWorld","restoreError","getStackDepth","bind","sanctuaryService","getSanctuary","backgroundImage","furniture","decorations","conversationHistory","saveSanctuary","sanctuary_data","cleanSanctuary","inviteNPC","npcIds","conversation","generateId","startedAt","setupConversationContext","environmentPrompt","describeEnvironment","memoryPrompt","injectMemoryPrompt","injectPrompts","interactWithItem","findItem","mementoId","f","slice","saveConversation","sortedNpcIds","sort","existingConversation","conv","sortedConvNpcIds","JSON","stringify","endedAt","newConversation","getConversationHistory","exitSanctuary","issues","issue","path","clearMVUVariables","emptyMvuData","initialized_lorebooks","display_data","delta_data","clearedCount","mvuData0","mvuData","clearGlobalVariables","currentVariables","variableNames","replaceVariables","clearChatVariables","clearInventory","inventoryStore","clearProtagonistInfo","oldPlayerName","oldPlayerDescription","api_config","clearAllGameData","results","operation","memoryFragmentService","listening","getAllArchives","saveArchives","startListening","eventOn","iframe_events","STREAM_TOKEN_RECEIVED_FULLY","fullText","_id","captureMemoryEvents","capturedCount","exec","sourceInstance","getCurrentInstanceId","addMemoryToNPC","archives","archive","getNPCName","relationshipScore","memories","lastInteraction","npc_memory_archives","getArchive","cleanArchives","current_instance_id","recentMemories","b","memory","getRelationshipDescription","score","npcGenerationService","generateRandom","instanceType","jsonMatch","npcData","enhanceWithCharacterSystem","personality","generateCustom","generateRelatedNPC","relatedInfo","basicInfo","generateSkillsForOccupation","generateDefaultBodyParts","skillData","sfc","props","target","__vccOpts","NPCGenerationErrorType","determineWorldType","context","classifyError","toLowerCase","AI_SERVICE_UNAVAILABLE","PARSE_ERROR","NETWORK_ERROR","UNKNOWN_ERROR","getUserFriendlyErrorMessage","errorType","generateBasicFallbackNPC","occupations","_customNPCs","onProgress","consecutiveFailures","n","err","originalError","fallbackNPC","errorTypes","Set","suggestion","closeButton","warningMessage","errorTypeCounts","detailedMessage","errorDetails","generateQuickNPC","openDetailedCreation","Promise","resolve","handleCreated","eventRemoveListener","handleCancelled","regenerateRandomNPCs","customNPCs","randomCount","hasCustomNPCs","__webpack_module_cache__","moduleId","cachedModule","__webpack_modules__","getter","__esModule","getPrototypeOf","obj","t","then","ns","create","r","def","indexOf","getOwnPropertyNames","definition","o","enumerable","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","tavernService","callbacks","currentChatId","getCurrentChatId","chatId","getCurrentCharacterId","updateUserCharacter","buildCharacterDescription","currentChar","Number","saveMetadata","getCharacterList","setupEventListeners","tavern_events","CHAT_CHANGED","onChatChanged","MESSAGE_RECEIVED","onMessageReceived","CHARACTER_EDITED","detail","onCharacterChanged","GENERATION_STARTED","onGenerationStarted","GENERATION_STOPPED","onGenerationStopped","setCallbacks","clearCallbacks","options","stopGeneration","getWorldbookEntries","updateWorldbook","getGlobalVariables","setGlobalVariables","variables","getContext","showNotification","executeCommand","command","triggerSlash","reloadInterface","window","WorldDetector","detectFromMVU","confidence","current_area","is_inner_world","detectFromService","detect","mvuResult","serviceResult","ConfigResolver","cache","cacheTimestamp","cacheTTL","getConfig","cached","validation","clearCache","preloadConfigs","worlds","RequestModifier","applyToGenerate","apiConfig","custom_api","modifiedConfig","applyToGenerateRaw","has_ordered_prompts","apiAutoSwitchService","state","enabled","lastWorldChange","requestCount","errorCount","originalGenerate","originalGenerateRaw","worldDetector","configResolver","requestModifier","mvuEventCleanup","debugMode","detectCurrentWorld","setupInterceptors","watchWorldChanges","interceptGenerate","interceptGenerateRaw","restoreOriginalFunctions","logLevel","eventHandler","handleWorldChange","VARIABLE_UPDATE_ENDED","originalSwitchToRealWorld","originalSwitchToInnerWorld","originalSwitchToSanctuary","oldWorld","newWorld","newConfig","worldName","getWorldDisplayName","apiInfo","progressBar","getCurrentAPIConfig","group","has_custom_api","applyAPIConfigToGenerate","validateRequestConfig","response_length","response_preview","groupEnd","ordered_prompts_count","firstPrompt","applyAPIConfigToGenerateRaw","cleanup","getState","enableDebugMode","disableDebugMode","toggleDebugMode","isDebugMode","logEntry","toISOString","worldInfo","apiConfigInfo","safeConfig","fullMessage","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","__name","emits","setup","__props","emit","__emit","modelPresets","label","activeTab","testing","currentWorldName","w","currentAPIStatus","isCustom","displayText","confirm","closePanel","onMounted","_ctx","_cache","active","onClick","$event","checked","onChange","placeholder","preset","title","modelValue","p","step","disabled","buttonClickFeedback","element","tl","ease","shake","intensity","shakeDuration","optimizeForAnimation","properties","el","document","querySelector","HTMLElement","style","willChange","clearAnimationOptimization","gameStore","backgroundRef","currentBackground","preloadedImages","watch","newBackground","oldBackground","reject","img","Image","onload","onerror","src","onComplete","onBeforeUnmount","ref_key","alt","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","syncToTavern","characterType","showSkills","editingCharacter","formData","reactive","selectedSkills","newSkillName","selectedOccupation","customOccupation","isValid","hasName","hasValidOccupation","skillPointsValid","occupationalPoints","interestPoints","usedOccupationalPoints","pointType","reduce","usedInterestPoints","remainingOccupationalPoints","remainingInterestPoints","getAttributeName","randomizeAttributes","randomAttrs","calculateDerived","handleOccupationChange","addSkill","s","skillsMap","baseCharacter","skillsArray","rows","onInput","onKeyup","expandedParts","editCharacter","close","getDamageClass","part","partId","add","child","debuff","spriteRefs","visibleSprites","preloadImage","getSpritePositionClass","sprite","getSpriteStyle","left","top","newSprites","oldSprites","oldIds","newIds","removeSprite","oldSprite","setTimeout","updateSprite","addSprite","deep","ref_for","setSpriteRef","coc7Service","coc7Rules","rollDamageBonus","db","parseInt","sides","calculateAttackDamage","weaponDamage","totalDamage","calculateInitiative","participant","executeAttack","attackSkill","dodgeSkill","opposed","action","entity","attemptEscape","escaper","chaser","escaperDEX","chaserDEX","consequence","resolveCombat","maxRounds","playerParticipant","enemyParticipant","order","actor","winner","loser","rewards","experience","performSanityCheck","actualLoss","insanity","getSkillValue","defaultValue","setSkillValue","skillImprovement","currentValue","improvement","improved","newValue","useCombatStore","currentCombat","combatHistory","combatId","playerParticipants","enemyParticipants","currentParticipant","isPlayerTurn","latestRound","isVictory","isDefeat","isEscaped","dex","checkCombatEnd","playersAlive","enemiesAlive","endCombat","nextTurn","nextRound","processStatusEffects","finalStatus","startCombat","enemies","executeAction","currentRoundData","processActionEffects","addStatusEffect","participantId","effectType","removeStatusEffect","effectId","getParticipant","updateParticipant","getCombatStats","roundCount","actionCount","round","playerHP","enemyHP","clearHistory","combatStore","isProcessing","getHPPercentage","isCurrentParticipant","performAttack","updateMVUAfterCombat","dead","width","npcAnalysisService","inferAge","characterName","agePattern","RegExp","ageMatch","ageKeywords","test","inferOccupation","inferAttributes","checkAndAdjust","attr","keywords","pattern","relevantText","high","low","generateSkillsByOccupation","getOccupationSkills","inferRelationship","relationshipKeywords","generateNPC","npcAppearanceService","generateAppearancePrompt","sortedNPCs","importanceA","frequency","getFrequencyDescription","descriptions","shouldNPCAppear","sceneContext","baseProbability","mentionBonus","absenceBonus","calculateAbsenceBonus","totalProbability","expectedAppearances","generateSimpleAppearancePrompt","stars","repeat","streamService","currentStreamText","setupStreamListeners","STREAM_TOKEN_RECEIVED_INCREMENTALLY","handleIncrementalText","handleFullText","onIncremental","updateNPCAppearanceCounts","recordEvents","onError","currentCount","mvuError","sendMessage","injectNPCAppearancePrompt","appearancePrompt","once","getIsStreaming","getCurrentText","generatePlotBasedOnRoll","rollResult","generateAreaEvent","areaName","isDialogueQuote","splitParagraphByLength","paragraph","maxLength","start","end","strongPunctuation","weakPunctuation","space","bestBreak","breakType","searchStart","searchEnd","segment","splitIntoParagraphs","cleaned","replace","before","cleanTextContent","innerWidth","naturalParagraphs","subParagraphs","parseTextIntoParagraphs","expose","__expose","isClosed","currentText","dialogueTextRef","dialogueDisplayRef","customUserInput","isCustomSending","customInputRef","showInputBox","paragraphs","currentParagraphIndex","savedState","handleBoxClick","showCurrentParagraph","nextTick","focus","scrollToBottom","scrollTop","scrollHeight","processNPCCreation","npcCreatePattern","npcNames","isInInstance","existingNPC","inInstance","newNPC","showTextInstantly","setupStreamCallbacks","showText","handleCustomSend","$tavernTextarea","$","$sendButton","trigger","openDialogue","lastMessages","lastMessage","loadLatestMessage","oldMode","onKeydown","selectedSkill","lastRoll","isRolling","isGenerating","userAction","rollButtonRef","rerollButtonRef","generateButtonRef","diceDisplayRef","availableSkills","localeCompare","performRoll","frameCount","frameDuration","randomValue","textContent","diceValue","reroll","generatePlot","resultText","for","progressText","generatedInstanceId","isGeneratingNPC","showCustomDialog","customNPCPrompt","closeButtonRef","randomButtonRef","customButtonRef","enterButtonRef","randomNPCButtonRef","customNPCButtonRef","addRandomNPC","showCustomNPCDialog","closeCustomNPCDialog","addCustomNPC","generateRandomInstance","generateCustomInstance","enterInstance","handleClose","querySelectorAll","btn","storyReviewService","reviewRealWorldStory","getChatHistory","cleanedMessages","msg","cleanMessages","buildReviewPrompt","realWorldConfig","review","generateReview","reviewInstanceStory","innerWorldConfig","searchInStory","cleanedContent","requestParams","loading","expandedMessages","selectedWorld","selectedInstanceId","searchKeyword","searchResults","aiReviewContent","generatingReview","displayMessages","originalIndex","isHighlighted","loadMessages","chatMessages","lastMsg","lastId","is_user","is_system","mes","send_date","onWorldChange","onInstanceChange","performSearch","generateAIReview","scrollToTop","cleanMessageContent","refreshMessages","scrollTo","behavior","$emit","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_69","_hoisted_70","_hoisted_71","_hoisted_72","selectedInstance","expandedCharacters","showCharacterCreator","showPlotReview","currentInstanceData","sortedEvents","handleCharacterCreated","previousInstances","inheritedCharacter","found","findInheritedCharacter","formatTime","date","getTime","getDate","toLocaleTimeString","hour","minute","getFullYear","toLocaleDateString","month","day","year","openPlotReview","confirmEndInstance","closeInstancePage","draft","completed","important","charId","getCharacterName","obtainedAt","PlotReview","onClose","CharacterCreator","onCreated","onCancelled","currentTab","selectedItem","selectItem","useItem","discardItem","itemName","fromArea","toLocaleString","pickupItem","generated","loadDetails","selected","isMoving","realWorldMap","selectedRealWorldArea","selectedInstanceArea","showAreaDetails","areaToView","isViewingRealWorld","currentRealWorldArea","connectedRealWorldAreas","loadRealWorldMap","generateRealWorldMap","moveToRealWorldArea","targetArea","confirmMoveToRealWorld","currentLocation","moveToInstanceArea","confirmMoveToInstance","viewRealWorldAreaDetails","viewAreaDetails","viewInstanceAreaDetails","closeAreaDetails","handleDetailsGenerated","handleItemPickedUp","discovered","AreaDetailsModal","onItemPickedUp","onDetailsGenerated","journalService","getAllJournals","saveAllJournals","generateJournalDraft","authorId","authorName","isPlayerCharacter","getRelevantEvents","getRelevantMemories","buildJournalPrompt","journalContent","_isPlayerCharacter","allInstances","allEvents","npcInstances","char","npcEvents","relevantEvents","allArchives","allMemories","saveJournal","updateJournal","journalId","editedAt","deleteJournal","filteredEntries","getJournalsByAuthor","createdAt","allVars","journal_entries","cleanEntries","selectedAuthorId","selectedJournalId","authorJournals","isSaving","playerCharacter","placeholderText","availableNPCs","npcMap","onAuthorChange","loadAuthorJournals","generateDraft","getAuthorName","newJournal","relatedEvents","relatedMemories","confirmDelete","createNew","formatDate","getMonth","padStart","getHours","getMinutes","journal","j","currentView","showInviteDialog","showJournalDialog","selectedNPCs","arrangeMode","isLoading","chatInput","isSending","chatMessagesRef","currentInvitedNPCs","backgroundStyle","invitedNPCNames","getMementoStyle","toggleArrangeMode","inviteSelectedNPCs","history","scrollChatToBottom","loadConversationHistory","returnToSanctuary","sendChatMessage","author","closeSanctuary","imageUrl","JournalView","hpFillRef","mpFillRef","sanFillRef","hpValueRef","mpValueRef","sanValueRef","previousHP","previousMP","previousSAN","hpPercentage","mpPercentage","sanPercentage","highlightStatChange","isIncrease","color","backgroundColor","highlightFlash","animateStatValue","onUpdate","newHP","oldHP","newMP","oldMP","oldSAN","integrationTestService","testResults","runAllTests","testAPISwitch","testMemorySystem","testSanctuarySystem","testInstanceCompletion","testCharacterInitialization","displayResults","currentAPI","addResult","testName","passed","realWorldAPI","innerWorldAPI","sanctuaryAPI","allConfigs","hasRealWorldConfig","testConfig","loadedConfigs","configMatches","saved","loaded","testNPCId","hasPromptContent","initialScore","totalArchives","testNPCIds","updatedSanctuary","hasConversation","testMemento","sanctuaryWithMemento","hasMementos","hasHistory","historyCount","activeInstances","completedInstances","activeCount","completedCount","instancesWithEvents","instancesWithMementos","lastMessageId","messageCount","hasCharacter","hasDescription","icon","totalTests","passedTests","failedTests","getResults","generateReport","memoryTestResult","npcTestResult","eventTestResult","mapTestResult","aiTestResult","integrationTestResult","testMemoryCapture","testEvent","viewMemoryArchives","testMemoryInjection","testNPCGeneration","testNPCAppearance","testEventRecord","viewEventHistory","testMapGeneration","testCharacter","luck","build","testAreaDetails","testAIConnection","runAIDiagnostics","runIntegrationTest","show","confirmText","cancelText","dangerMode","handleConfirm","handleCancel","handleOverlayClick","handleEscKey","addEventListener","onUnmounted","removeEventListener","showConfirmDialog","handleUpdateCharacter","handleConfirmReset","handleCancelReset","handleContinue","ConfirmDialog","onConfirm","onCancel","showWelcome","showCharacterPanel","showDiceRoller","showMapPanel","showInventory","showInstanceGenerator","showInstanceRecord","showAPIConfig","showTestPanel","dialogueClosed","uiHidden","isFullscreen","dialogueBoxRef","activeSprites","toggleCharacterPanel","toggleDiceRoller","toggleCombatPanel","exitCombatMode","toggleMapPanel","toggleInventory","toggleInstanceGenerator","togglePlotReview","toggleInstanceRecord","toggleAPIConfig","toggleTestPanel","toggleSanctuary","exitSanctuaryMode","handleEditCharacter","handleNewMessage","toggleDialogue","toggleUI","toggleFullscreen","documentElement","exitFullscreen","webkitExitFullscreen","msExitFullscreen","requestFullscreen","webkitRequestFullscreen","msRequestFullscreen","handleFullscreenChange","fullscreenElement","webkitFullscreenElement","msFullscreenElement","Background","CharacterSprite","StatusBar","DialogueBox","onNewMessage","CombatPanel","SanctuaryView","WelcomeModal","onUpdateCharacter","onContinue","CharacterPanel","onEdit","DiceRoller","MapPanel","InventoryPanel","InstanceGenerator","InstanceRecord","APIConfigPanel","TestPanel","hasError","loadingMessage","retry","MainInterface","$messages","hiddenCount","each","$element","mesId","addClass","hide","hideNonZeroMessages","vueApp","createApp","app","pinia","createPinia","use","mount","chat_id","new_chat_id","catch","on","$hiddenMessages","removeClass","restoreHiddenMessages"],"sourceRoot":""}