<head><script type="module">import*as e from'https://testingcf.jsdelivr.net/npm/klona/+esm';import*as t from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import{default as a}from'https://testingcf.jsdelivr.net/npm/gsap/+esm';var o,n,r={15:(t,a,o)=>{t.exports=(e=>{var t={};return o.d(t,e),t})({klona:()=>e.klona})},35:(e,a,o)=>{e.exports=(e=>{var t={};return o.d(t,e),t})({createPinia:()=>t.createPinia,defineStore:()=>t.defineStore})},57:(e,t,a)=>{a.d(t,{worldBookService:()=>o});const o=new class{initialized=!1;currentWorld='realWorld';worldbookName=null;async initialize(){if(this.initialized)console.log('[WorldBookService] 服务已初始化');else try{console.log('[WorldBookService] 初始化服务...');const e=getCharWorldbookNames('current');e.primary?(this.worldbookName=e.primary,console.log('[WorldBookService] 找到角色卡绑定的世界书:',this.worldbookName)):(console.warn('[WorldBookService] 当前角色卡未绑定世界书'),this.worldbookName=null),this.initialized=!0,console.log('[WorldBookService] 服务初始化完成')}catch(e){throw console.error('[WorldBookService] 初始化失败:',e),e}}async activateRealWorldEntries(){try{if(!this.worldbookName)return void console.warn('[WorldBookService] 未找到世界书，跳过激活');console.log('[WorldBookService] 激活现实世界条目...');const e=(await getWorldbook(this.worldbookName)).map(e=>{const t=e.extra?.worldType;return'realWorld'===t?{...e,strategy:{...e.strategy,type:'constant'}}:'innerWorld'===t||'sanctuary'===t?{...e,strategy:{...e.strategy,type:'selective',keys:e.strategy.keys.length>0?e.strategy.keys:['__never_match__']}}:e});await replaceWorldbook(this.worldbookName,e),this.currentWorld='realWorld',console.log('[WorldBookService] 现实世界条目已激活')}catch(e){throw console.error('[WorldBookService] 激活现实世界条目失败:',e),e}}async activateInnerWorldEntries(){try{if(!this.worldbookName)return void console.warn('[WorldBookService] 未找到世界书，跳过激活');console.log('[WorldBookService] 激活里世界条目...');const e=(await getWorldbook(this.worldbookName)).map(e=>{const t=e.extra?.worldType;return'innerWorld'===t?{...e,strategy:{...e.strategy,type:'constant'}}:'realWorld'===t||'sanctuary'===t?{...e,strategy:{...e.strategy,type:'selective',keys:e.strategy.keys.length>0?e.strategy.keys:['__never_match__']}}:e});await replaceWorldbook(this.worldbookName,e),this.currentWorld='innerWorld',console.log('[WorldBookService] 里世界条目已激活')}catch(e){throw console.error('[WorldBookService] 激活里世界条目失败:',e),e}}async activateInteractionRoomEntries(){try{if(!this.worldbookName)return void console.warn('[WorldBookService] 未找到世界书，跳过激活');console.log('[WorldBookService] 激活归所条目...');const e=(await getWorldbook(this.worldbookName)).map(e=>{const t=e.extra?.worldType;return'sanctuary'===t?{...e,strategy:{...e.strategy,type:'constant'}}:'realWorld'===t||'innerWorld'===t?{...e,strategy:{...e.strategy,type:'selective',keys:e.strategy.keys.length>0?e.strategy.keys:['__never_match__']}}:e});await replaceWorldbook(this.worldbookName,e),this.currentWorld='sanctuary',console.log('[WorldBookService] 归所条目已激活')}catch(e){throw console.error('[WorldBookService] 激活归所条目失败:',e),e}}getCurrentWorld(){return this.currentWorld}getWorldbookName(){return this.worldbookName}async reload(){this.initialized=!1,await this.initialize()}}},61:e=>{e.exports=Vue},67:(e,t,a)=>{a.d(t,{m:()=>l});var o=a(35),n=a(61),r=a(428);const l=(0,o.defineStore)('character',()=>{const e=(0,n.ref)(void 0),t=(0,n.ref)(new Map),a=(0,n.ref)([]),o=(0,n.computed)(()=>void 0!==e.value),l=(0,n.computed)(()=>Array.from(t.value.values())),s=(0,n.computed)(()=>t.value.size),c=(0,n.computed)(()=>a.value.map(e=>t.value.get(e)).filter(e=>void 0!==e)),i=(0,n.computed)(()=>l.value.filter(e=>e.isImportant));return{player:e,npcs:t,activeCharacters:a,hasPlayer:o,npcList:l,npcCount:s,activeNPCs:c,importantNPCs:i,loadFromMVU:async function(){try{console.log('[Character Store] 从 MVU 加载角色数据...');try{const t=getVariables({type:'global'});t.player_character&&(e.value=t.player_character,console.log('[Character Store] 从全局变量加载主控角色成功:',e.value.name))}catch(e){console.warn('[Character Store] 从全局变量加载失败，尝试从 MVU 加载:',e)}if(!e.value){const t=await r.mvuService.loadGameData();if(t.characters.player){e.value=t.characters.player,console.log('[Character Store] 从 MVU 加载主控角色成功:',e.value.name);try{insertOrAssignVariables({player_character:e.value},{type:'global'}),console.log('[Character Store] 主控角色已同步到全局变量')}catch(e){console.warn('[Character Store] 同步到全局变量失败:',e)}}}const a=await r.mvuService.loadGameData();t.value.clear(),Object.entries(a.characters.npcs).forEach(([e,a])=>{t.value.set(e,a)}),console.log(`[Character Store] 加载了 ${t.value.size} 个 NPC`)}catch(e){throw console.error('[Character Store] 加载角色数据失败:',e),toastr.error('加载角色数据失败'),e}},setPlayer:async function(t){try{e.value=t,await r.mvuService.saveCharacter(t);try{insertOrAssignVariables({player_character:t},{type:'global'}),console.log('[Character Store] 主控角色已保存到全局变量')}catch(e){console.warn('[Character Store] 保存到全局变量失败:',e)}console.log('[Character Store] 主控角色设置成功:',t.name),toastr.success(`主控角色 ${t.name} 创建成功`)}catch(e){throw console.error('[Character Store] 设置主控角色失败:',e),toastr.error('设置主控角色失败'),e}},updatePlayer:async function(t){if(!e.value)throw new Error('主控角色不存在');try{t.attributes&&Object.assign(e.value.attributes,t.attributes),t.derivedStats&&Object.assign(e.value.derivedStats,t.derivedStats),t.bodyParts&&(e.value.bodyParts=t.bodyParts),await r.mvuService.updateCharacterStatus('player',t);try{insertOrAssignVariables({player_character:e.value},{type:'global'}),console.log('[Character Store] 主控角色状态已同步到全局变量')}catch(e){console.warn('[Character Store] 同步到全局变量失败:',e)}console.log('[Character Store] 主控角色状态更新成功')}catch(e){throw console.error('[Character Store] 更新主控角色状态失败:',e),toastr.error('更新角色状态失败'),e}},addNPC:async function(e){try{t.value.set(e.id,e),await r.mvuService.saveCharacter(e),console.log('[Character Store] NPC 添加成功:',e.name),toastr.success(`NPC ${e.name} 添加成功`)}catch(e){throw console.error('[Character Store] 添加 NPC 失败:',e),toastr.error('添加 NPC 失败'),e}},updateNPC:async function(e,a){const o=t.value.get(e);if(!o)throw new Error(`NPC ${e} 不存在`);try{a.attributes&&Object.assign(o.attributes,a.attributes),a.derivedStats&&Object.assign(o.derivedStats,a.derivedStats),a.bodyParts&&(o.bodyParts=a.bodyParts),void 0!==a.affection&&(o.affection=a.affection),await r.mvuService.updateCharacterStatus(e,a),console.log(`[Character Store] NPC ${o.name} 状态更新成功`)}catch(t){throw console.error(`[Character Store] 更新 NPC ${e} 状态失败:`,t),toastr.error('更新 NPC 状态失败'),t}},deleteNPC:async function(e){const o=t.value.get(e);if(!o)throw new Error(`NPC ${e} 不存在`);try{const n=o.name;t.value.delete(e),a.value=a.value.filter(t=>t!==e),await r.mvuService.deleteNPC(e),console.log(`[Character Store] NPC ${n} 删除成功`),toastr.info(`NPC ${n} 已删除（剧情记录已保留）`)}catch(t){throw console.error(`[Character Store] 删除 NPC ${e} 失败:`,t),toastr.error('删除 NPC 失败'),t}},getCharacter:function(a){return'player'===a||e.value&&e.value.id===a?e.value:t.value.get(a)},setActiveCharacters:function(e){a.value=e,console.log('[Character Store] 活跃角色列表已更新:',e)},addActiveCharacter:function(e){a.value.includes(e)||(a.value.push(e),console.log(`[Character Store] 角色 ${e} 加入场景`))},removeActiveCharacter:function(e){a.value=a.value.filter(t=>t!==e),console.log(`[Character Store] 角色 ${e} 离开场景`)},updateAffection:async function(e,a){const o=t.value.get(e);if(!o)throw new Error(`NPC ${e} 不存在`);try{const t=Math.max(0,Math.min(100,a));o.affection=t,await r.mvuService.updateCharacterStatus(e,{affection:t}),console.log(`[Character Store] NPC ${o.name} 好感度更新为: ${t}`)}catch(t){throw console.error(`[Character Store] 更新 NPC ${e} 好感度失败:`,t),toastr.error('更新好感度失败'),t}},setNPCImportant:async function(e,a){const o=t.value.get(e);if(!o)throw new Error(`NPC ${e} 不存在`);try{o.isImportant=a,await r.mvuService.saveCharacter(o);const e=a?'重要':'普通';console.log(`[Character Store] NPC ${o.name} 设置为${e}角色`),toastr.info(`${o.name} 已设置为${e}角色`)}catch(t){throw console.error(`[Character Store] 设置 NPC ${e} 重要性失败:`,t),toastr.error('设置角色重要性失败'),t}},addNPCEvent:async function(e,a){const o=t.value.get(e);if(!o)throw new Error(`NPC ${e} 不存在`);try{o.events.push(a),await r.mvuService.saveCharacter(o),console.log(`[Character Store] NPC ${o.name} 事件记录已添加`)}catch(t){throw console.error(`[Character Store] 添加 NPC ${e} 事件记录失败:`,t),t}},reset:function(){e.value=void 0,t.value.clear(),a.value=[],console.log('[Character Store] 角色数据已重置')}}})},76:(e,t,a)=>{a.d(t,{realWorldMapService:()=>n});var o=a(747);const n=new class{async generateMap(e){return await(0,o.SZ)('sanctuary',async()=>{try{console.log('[RealWorldMapService] 开始生成现实世界地图...',e.name),toastr.info('正在生成现实世界地图...');const t=`你是一个地图数据生成器。请严格按照以下要求生成地图数据：\n\n【重要】只返回 YAML 格式的数据，不要添加任何解释或叙述性文本。\n\n角色信息：\n- 姓名：${e.name}\n- 年龄：${e.age||'未知'}\n- 职业：${e.occupation||'无业'}\n- 背景：${e.background||'无背景描述'}\n\n要求：\n1. 必须使用 \`\`\`yaml 代码块包裹\n2. 包含角色的家（id: home）\n3. 根据职业生成工作地点（如有职业）\n4. 生成 3-5 个公共地点\n5. 所有地点 isDangerous 设为 false\n\n示例格式：\n\`\`\`yaml\nstartArea: home\nareas:\n  - id: home\n    name: ${e.name}的家\n    description: 温馨的住所\n    connectedAreas: [street]\n    isDangerous: false\n  - id: street\n    name: 主街道\n    description: 城市的主要街道\n    connectedAreas: [home, shop]\n    isDangerous: false\n  - id: shop\n    name: 便利店\n    description: 24小时营业的便利店\n    connectedAreas: [street]\n    isDangerous: false\nconnections:\n  - from: home\n    to: street\n  - from: street\n    to: shop\n\`\`\`\n\n现在请生成地图数据：`;let a;console.log('[RealWorldMapService] 调用 AI 生成地图...'),console.log('[RealWorldMapService] AI 调用参数:',{should_stream:!1,prompt_length:t.length,character_name:e.name,character_occupation:e.occupation||'无业'});try{a=await generate({user_input:t,should_stream:!1}),console.log('[RealWorldMapService] AI 生成完成，开始解析地图数据...'),console.log('[RealWorldMapService] AI 返回文本长度:',a.length,'字符'),console.log('[RealWorldMapService] AI 返回的完整原始文本:',a)}catch(e){throw console.error('[RealWorldMapService] API 调用失败:',{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),new Error(`API 调用失败: ${e instanceof Error?e.message:String(e)}`)}const o=await this.parseMapFromText(a,e);return console.log('[RealWorldMapService] 开始为所有区域生成详细信息...'),await this.generateAreaDetails(o),await this.saveMap(o),console.log('[RealWorldMapService] 现实世界地图生成成功'),toastr.success('现实世界地图生成成功！'),o}catch(t){console.error('[RealWorldMapService] 地图生成失败:',t),console.error('[RealWorldMapService] 错误详情:',{message:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0,character:e.name}),console.warn('[RealWorldMapService] AI 调用失败，使用默认地图生成器（降级方案）');try{console.log('[RealWorldMapService] 启动降级方案: 默认地图生成器');const t=this.generateDefaultMap(e);return console.log('[RealWorldMapService] 降级方案生成结果:',{areas_count:t.areas.size,startArea:t.startArea,playerLocation:t.playerLocation}),console.log('[RealWorldMapService] 开始为所有区域生成详细信息...'),await this.generateAreaDetails(t),await this.saveMap(t),console.log('[RealWorldMapService] 现实世界地图生成成功（使用默认地图）'),toastr.warning('AI 调用失败，已生成默认地图'),t}catch(e){throw console.error('[RealWorldMapService] 默认地图生成也失败:',e),console.error('[RealWorldMapService] 降级方案失败详情:',{message:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),toastr.error('地图生成失败，请重试'),e}}})}async saveMap(e){try{console.log('[RealWorldMapService] 开始保存地图到全局变量...');const t={areas:Array.from(e.areas.entries()).map(([,e])=>e),connections:e.connections,playerLocation:e.playerLocation,startArea:e.startArea};console.log('[RealWorldMapService] 序列化数据:',{区域数量:t.areas.length,连接数量:t.connections.length,玩家位置:t.playerLocation,起始区域:t.startArea}),insertOrAssignVariables({real_world_map:t},{type:'global'}),console.log('[RealWorldMapService] ✓ 现实世界地图已成功保存到全局变量')}catch(e){throw console.error('[RealWorldMapService] ✗ 保存地图失败:',e),console.error('[RealWorldMapService] 错误详情:',e instanceof Error?e.message:String(e)),toastr.error('保存地图失败'),e}}async loadMap(){try{const e=getVariables({type:'global'}).real_world_map;if(!e||!e.areas)return console.log('[RealWorldMapService] 未找到现实世界地图数据'),null;const t={areas:new Map,connections:e.connections||[],playerLocation:e.playerLocation||e.startArea||'home',startArea:e.startArea||'home'};return console.log('[RealWorldMapService] 现实世界地图加载成功'),t}catch(e){return console.error('[RealWorldMapService] 加载地图失败:',e),null}}async updatePlayerLocation(e){try{const t=await this.loadMap();if(!t)throw new Error('现实世界地图不存在');if(!t.areas.has(e))throw new Error(`区域 ${e} 不存在`);t.playerLocation=e;const a=t.areas.get(e);a&&(a.isDiscovered=!0),await this.saveMap(t),console.log(`[RealWorldMapService] 玩家位置更新为: ${e}`)}catch(e){throw console.error('[RealWorldMapService] 更新玩家位置失败:',e),e}}async hasMap(){return null!==await this.loadMap()}async parseMapFromText(e,t){const YAML=(await Promise.resolve().then(a.t.bind(a,856,23))).default;console.log('[RealWorldMapService] ========== 开始解析地图文本 =========='),console.log('[RealWorldMapService] 文本长度:',e.length,'字符'),console.log('[RealWorldMapService] ========== 策略 1: 提取 YAML 代码块 ==========');const o=[{regex:/```yaml\n([\s\S]*?)\n```/,name:'```yaml'},{regex:/```yml\n([\s\S]*?)\n```/,name:'```yml'},{regex:/```\n([\s\S]*?)\n```/,name:'```'}];for(let t=0;t<o.length;t++){const{regex:a,name:n}=o[t];console.log(`[RealWorldMapService] 尝试模式 ${t+1}: ${n}`);const r=e.match(a);if(r){console.log(`[RealWorldMapService] ✓ 找到代码块 (模式: ${n})`),console.log(`[RealWorldMapService] 代码块内容长度: ${r[1].length} 字符`);try{const e=YAML.parse(r[1]);if(console.log('[RealWorldMapService] ✓ YAML 解析成功'),console.log('[RealWorldMapService] 解析结果:',{areas_count:e.areas?.length||0,startArea:e.startArea,has_home:e.areas?.some(e=>'home'===e.id)}),this.validateMapData(e))return console.log('[RealWorldMapService] ✓ 数据验证通过'),console.log('[RealWorldMapService] 最终使用: AI 生成的地图数据'),toastr.success('现实世界地图生成成功！'),this.buildMapData(e);console.warn('[RealWorldMapService] ✗ 数据验证失败')}catch(e){console.warn('[RealWorldMapService] ✗ YAML 解析失败:',e instanceof Error?e.message:String(e));continue}}else console.log('[RealWorldMapService] ✗ 未找到匹配的代码块')}console.log('[RealWorldMapService] 策略 1 失败: 未能从代码块中提取有效数据'),console.log('[RealWorldMapService] ========== 策略 2: 直接解析整个文本 ==========');try{const t=YAML.parse(e);if(console.log('[RealWorldMapService] ✓ YAML 解析成功'),console.log('[RealWorldMapService] 解析结果:',{areas_count:t.areas?.length||0,startArea:t.startArea,has_home:t.areas?.some(e=>'home'===e.id)}),this.validateMapData(t))return console.log('[RealWorldMapService] ✓ 数据验证通过'),console.log('[RealWorldMapService] ========== 策略 2 成功 =========='),console.log('[RealWorldMapService] 最终使用: AI 生成的地图数据'),toastr.success('现实世界地图生成成功！'),this.buildMapData(t);console.warn('[RealWorldMapService] ✗ 数据验证失败')}catch(e){console.warn('[RealWorldMapService] ✗ YAML 解析失败:',e instanceof Error?e.message:String(e))}return console.log('[RealWorldMapService] 策略 2 失败: 无法直接解析文本'),console.warn('[RealWorldMapService] ========== 策略 3: 使用默认地图生成器（降级方案）=========='),console.warn('[RealWorldMapService] 所有 AI 解析策略均失败，将生成默认地图'),console.log('[RealWorldMapService] 降级原因: AI 返回的数据无法解析或验证失败'),console.log('[RealWorldMapService] 角色信息:',{name:t.name,occupation:t.occupation,age:t.age}),console.log('[RealWorldMapService] 最终使用: 默认地图生成器（降级方案）'),toastr.warning('AI 解析失败，已使用默认地图'),this.generateDefaultMap(t)}buildMapData(e){console.log('[RealWorldMapService] 构建 MapData 结构...');const t=new Map,a=e.startArea||'home';e.areas&&Array.isArray(e.areas)&&e.areas.forEach(e=>{t.set(e.id,{id:e.id,name:e.name,description:e.description,background:e.background,connectedAreas:e.connectedAreas||[],isDiscovered:e.id===a,isDangerous:e.isDangerous||!1,relatedNPCs:e.relatedNPCs||[]})});const o={areas:t,connections:e.connections||[],playerLocation:a,startArea:a};return console.log('[RealWorldMapService] MapData 构建完成，包含',t.size,'个区域'),o}validateMapData(e){if(!e||'object'!=typeof e)return console.warn('[RealWorldMapService] 地图数据不是对象'),!1;if(!e.areas||!Array.isArray(e.areas))return console.warn('[RealWorldMapService] 缺少 areas 数组'),!1;if(0===e.areas.length)return console.warn('[RealWorldMapService] areas 数组为空'),!1;if(!e.areas.some(e=>'home'===e.id))return console.warn('[RealWorldMapService] 缺少 home 区域'),!1;for(const t of e.areas)if(!t.id||!t.name||!t.description)return console.warn('[RealWorldMapService] 区域缺少必需字段:',t),!1;return!0}generateDefaultMap(e){console.log('[RealWorldMapService] 开始生成默认地图...');const t=new Map;if(t.set('home',{id:'home',name:`${e.name}的家`,description:`这是${e.name}温馨的住所`,connectedAreas:['street'],isDiscovered:!0,isDangerous:!1,relatedNPCs:[]}),t.set('street',{id:'street',name:'主街道',description:'城市的主要街道，连接着各个地点',connectedAreas:['home','shop','park'],isDiscovered:!1,isDangerous:!1,relatedNPCs:[]}),t.set('shop',{id:'shop',name:'便利店',description:'24小时营业的便利店',connectedAreas:['street'],isDiscovered:!1,isDangerous:!1,relatedNPCs:[]}),t.set('park',{id:'park',name:'城市公园',description:'适合散步和休息的公园',connectedAreas:['street'],isDiscovered:!1,isDangerous:!1,relatedNPCs:[]}),e.occupation&&'无业'!==e.occupation){console.log(`[RealWorldMapService] 角色有职业 (${e.occupation})，添加工作地点`),t.set('work',{id:'work',name:`${e.occupation}工作地点`,description:`${e.name}的工作场所`,connectedAreas:['street'],isDiscovered:!1,isDangerous:!1,relatedNPCs:[]});t.get('street').connectedAreas.push('work')}else console.log('[RealWorldMapService] 角色无职业，不添加工作地点');const a={areas:t,connections:this.generateConnections(t),playerLocation:'home',startArea:'home'};return console.log('[RealWorldMapService] ✓ 默认地图生成完成，包含',t.size,'个区域'),a}generateConnections(e){const t=[];return e.forEach(e=>{e.connectedAreas.forEach(a=>{t.some(t=>t.from===a&&t.to===e.id)||t.push({from:e.id,to:a})})}),t}async generateAreaDetails(e){try{const{areaDetailsService:t}=await Promise.resolve().then(a.bind(a,425)),o=Array.from(e.areas.values());console.log(`[RealWorldMapService] 需要为 ${o.length} 个区域生成详细信息`),console.log('[RealWorldMapService] 区域列表:',o.map(e=>e.name).join(', '));let n=0,r=0;for(let e=0;e<o.length;e++){const a=o[e];console.log(`[RealWorldMapService] 生成区域详情 (${e+1}/${o.length}): ${a.name}`);try{const e=await t.generateDetails(a,!0);a.details=e,n++,console.log(`[RealWorldMapService] ✓ ${a.name} 详情生成完成`)}catch(e){r++,console.error(`[RealWorldMapService] ✗ ${a.name} 详情生成失败:`,{error:e instanceof Error?e.message:String(e),area_id:a.id})}}console.log('[RealWorldMapService] 所有区域详情生成完成:',{total:o.length,success:n,failed:r})}catch(e){console.error('[RealWorldMapService] 生成区域详情失败:',{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0})}}}},202:(e,t,a)=>{a.d(t,{useInventoryStore:()=>r});var o=a(35),n=a(61);const r=(0,o.defineStore)('inventory',()=>{const e=(0,n.ref)({items:[]}),t=(0,n.ref)({items:[]});function a(t){e.value.items.push(t),console.log(`[Inventory Store] 道具已添加到现实世界背包: ${t.name}`)}function o(e){const a=t.value.items.findIndex(t=>t.id===e);if(-1!==a){const e=t.value.items[a];t.value.items.splice(a,1),console.log(`[Inventory Store] 道具已从副本背包移除: ${e.name}`)}}async function r(){try{const a={realWorldInventory:e.value,instanceInventory:t.value};insertOrAssignVariables({inventory:a},{type:'global'}),console.log('[Inventory Store] 背包数据已保存')}catch(e){console.error('[Inventory Store] 保存背包数据失败:',e),toastr.error('保存背包数据失败')}}return{realWorldInventory:e,instanceInventory:t,addToRealWorld:a,addToInstance:function(e){t.value.items.push(e),console.log(`[Inventory Store] 道具已添加到副本背包: ${e.name}`)},removeFromRealWorld:function(t){const a=e.value.items.findIndex(e=>e.id===t);if(-1!==a){const t=e.value.items[a];e.value.items.splice(a,1),console.log(`[Inventory Store] 道具已从现实世界背包移除: ${t.name}`)}},removeFromInstance:o,clearInstanceInventory:function(){const e=t.value.items.length;t.value.items=[],console.log(`[Inventory Store] 副本背包已清空 (清空了 ${e} 个道具)`)},clearRealWorldInventory:function(){const t=e.value.items.length;e.value.items=[],console.log(`[Inventory Store] 现实世界背包已清空 (清空了 ${t} 个道具)`),r()},clearAllInventories:function(){const a=e.value.items.length,o=t.value.items.length,n=a+o;e.value.items=[],t.value.items=[],console.log(`[Inventory Store] 所有背包已清空 (现实世界: ${a} 个道具, 副本: ${o} 个道具, 总计: ${n} 个道具)`),r()},transferToRealWorld:function(e){e.forEach(e=>{const n=t.value.items.find(t=>t.id===e);n&&(a(n),o(e))}),console.log(`[Inventory Store] ${e.length} 个道具已转移到现实世界背包`)},saveToGlobal:r,loadFromGlobal:async function(){try{const a=getVariables({type:'global'}).inventory;a&&(a.realWorldInventory&&(e.value=a.realWorldInventory),a.instanceInventory&&(t.value=a.instanceInventory),console.log('[Inventory Store] 背包数据已加载'))}catch(e){console.error('[Inventory Store] 加载背包数据失败:',e)}},reset:function(){e.value={items:[]},t.value={items:[]},console.log('[Inventory Store] Store 已重置')}}})},335:(e,t,a)=>{async function o(){try{console.log('[AI Diagnostics] 开始测试 AI 服务...');const e='请回复"测试成功"',t=await generate({user_input:e,should_stream:!1});return console.log('[AI Diagnostics] AI 服务响应:',t),t&&t.length>0?{success:!0,message:'AI 服务连接正常',details:{response:t.substring(0,100),length:t.length}}:{success:!1,message:'AI 服务返回空响应'}}catch(e){console.error('[AI Diagnostics] AI 服务测试失败:',e);const t=e instanceof Error?e.message:String(e);let a='';return a=t.includes('500')?'服务器内部错误 (500)。可能原因：\n- AI 模型配置错误\n- API 密钥无效\n- 后端服务异常':t.includes('404')?'API 端点不存在 (404)。请检查 API 配置。':t.includes('401')||t.includes('403')?'认证失败。请检查 API 密钥是否正确。':t.includes('timeout')?'请求超时。请检查网络连接。':'未知错误。请查看控制台日志获取详细信息。',{success:!1,message:`AI 服务测试失败: ${t}`,details:{error:t,diagnosis:a}}}}async function n(){console.log('[AI Diagnostics] 开始完整诊断...');let e='=== AI 服务诊断报告 ===\n\n';e+='1. 配置信息\n';const t=function(){try{const e=SillyTavern.chatCompletionSettings,t=SillyTavern.mainApi;return{model:e?.openai_model||t||'unknown',endpoint:e?.api_url_scale||'unknown',hasApiKey:Boolean(e?.api_key_openai||e?.api_key_claude)}}catch(e){return console.error('[AI Diagnostics] 获取配置信息失败:',e),{model:'unknown',endpoint:'unknown',hasApiKey:!1}}}();e+=`   - 模型: ${t.model}\n`,e+=`   - 端点: ${t.endpoint}\n`,e+=`   - API 密钥: ${t.hasApiKey?'已配置':'未配置'}\n\n`,e+='2. 连接测试\n';const a=await o();return e+=`   - 状态: ${a.success?'✅ 成功':'❌ 失败'}\n`,e+=`   - 消息: ${a.message}\n`,a.details&&(a.details.diagnosis&&(e+=`   - 诊断: ${a.details.diagnosis}\n`),a.details.response&&(e+=`   - 响应预览: ${a.details.response}\n`)),e+='\n=== 诊断完成 ===',console.log('[AI Diagnostics] 诊断完成'),console.log(e),e}a.d(t,{runFullDiagnostics:()=>n,testAIService:()=>o})},371:(e,t,a)=>{a.d(t,{useInstanceStore:()=>r});var o=a(35),n=a(61);const r=(0,o.defineStore)('instance',()=>{const e=(0,n.ref)(null),t=(0,n.ref)(new Map),o=(0,n.computed)(()=>e.value&&t.value.get(e.value)||null),r=(0,n.computed)(()=>'active'===o.value?.status),l=(0,n.computed)(()=>t.value.size),s=(0,n.computed)(()=>Array.from(t.value.values())),c=(0,n.computed)(()=>{if(!o.value)return null;const e=o.value.map.playerLocation;return o.value.map.areas.get(e)||null}),i=(0,n.computed)(()=>c.value?c.value.connectedAreas.map(e=>o.value?.map.areas.get(e)).filter(e=>void 0!==e):[]);async function u(){try{const{mvuService:e}=await Promise.resolve().then(a.bind(a,428)),o=await e.loadGameData(),n={};for(const[e,o]of t.value.entries()){const{klona:t}=await Promise.resolve().then(a.bind(a,536)),r=t(o),l={};for(const[e,a]of o.map.areas.entries())l[e]=t(a);r.map.areas=l,n[e]=r}o.instances=n,await e.saveGameData(o),console.log('[Instance Store] 数据已保存到 MVU')}catch(e){console.error('[Instance Store] 保存到 MVU 失败:',e),toastr.error('保存副本数据失败')}}return{currentInstanceId:e,instances:t,currentInstance:o,hasActiveInstance:r,instanceCount:l,instanceList:s,currentArea:c,connectedAreas:i,setCurrentInstance:function(t){e.value=t,console.log('[Instance Store] 当前副本已设置:',t)},addInstance:function(e){t.value.set(e.id,e),console.log(`[Instance Store] 副本已添加: ${e.name} (${e.id})`)},updateInstance:async function(e,a){const o=t.value.get(e);o?(Object.assign(o,a),t.value.set(e,o),console.log(`[Instance Store] 副本已更新: ${e}`)):console.error(`[Instance Store] 副本不存在: ${e}`)},getInstance:function(e){return t.value.get(e)||null},getAllInstances:function(){return Array.from(t.value.values())},removeInstance:function(a){t.value.delete(a),e.value===a&&(e.value=null),console.log(`[Instance Store] 副本已删除: ${a}`)},toggleImportantNPC:async function(e,a){const o=t.value.get(e);if(!o)return void console.error(`[Instance Store] 副本不存在: ${e}`);const n=o.characters.find(e=>e.characterId===a);n?(n.isImportant=!n.isImportant,console.log(`[Instance Store] 角色重要性已切换: ${a} -> ${n.isImportant}`)):console.error(`[Instance Store] 角色不存在于副本中: ${a}`)},getInstancesByWorldSetting:function(e){return Array.from(t.value.values()).filter(t=>t.worldSetting===e)},addCharacterToInstance:async function(e,a,o=!1){const n=t.value.get(e);if(!n)return void console.error(`[Instance Store] 副本不存在: ${e}`);n.characters.some(e=>e.characterId===a.id)?console.warn(`[Instance Store] 角色已存在于副本中: ${a.id}`):(n.characters.push({characterId:a.id,character:a,isImportant:o,importance:o?3:2,appearanceCount:0}),console.log(`[Instance Store] 角色已添加到副本: ${a.name} (${a.id})`))},updatePlayerLocation:async function(e){if(!o.value)return void console.error('[Instance Store] 没有当前副本');const t=o.value.map.areas.get(e);t?(o.value.map.playerLocation=e,console.log(`[Instance Store] 玩家位置已更新: ${t.name}`)):console.error(`[Instance Store] 区域不存在: ${e}`)},discoverArea:async function(e){if(!o.value)return void console.error('[Instance Store] 没有当前副本');const t=o.value.map.areas.get(e);t?(t.isDiscovered=!0,console.log(`[Instance Store] 区域已发现: ${t.name}`)):console.error(`[Instance Store] 区域不存在: ${e}`)},reset:function(){e.value=null,t.value.clear(),console.log('[Instance Store] Store 已重置')},addMemento:async function(e,a){const o=t.value.get(e);if(!o)return void console.error(`[Instance Store] 副本不存在: ${e}`);o.mementos.some(e=>e.id===a.id)?console.warn(`[Instance Store] 纪念品已存在: ${a.id}`):(o.mementos.push(a),console.log(`[Instance Store] 纪念品已添加: ${a.name} (${a.id})`),await u())},updateNPCImportance:async function(e,a,o){const n=t.value.get(e);if(!n)return void console.error(`[Instance Store] 副本不存在: ${e}`);const r=n.characters.find(e=>e.characterId===a);r?(r.importance=o,console.log(`[Instance Store] NPC 重要程度已更新: ${a} -> ${o}`),await u()):console.error(`[Instance Store] 角色不存在于副本中: ${a}`)},updateNPCAppearanceCount:async function(e,a,o){const n=t.value.get(e);if(!n)return void console.error(`[Instance Store] 副本不存在: ${e}`);const r=n.characters.find(e=>e.characterId===a);r?(r.appearanceCount=void 0!==o?o:(r.appearanceCount||0)+1,console.log(`[Instance Store] NPC 出场次数已更新: ${a} -> ${r.appearanceCount}`),await u()):console.error(`[Instance Store] 角色不存在于副本中: ${a}`)},updateInstanceStatus:async function(e,a){const o=t.value.get(e);o?(o.status=a,'active'!==a||o.startTime?'completed'!==a||o.endTime||(o.endTime=Date.now()):o.startTime=Date.now(),console.log(`[Instance Store] 副本状态已更新: ${e} -> ${a}`),await u()):console.error(`[Instance Store] 副本不存在: ${e}`)},addEvent:async function(e,a){const o=t.value.get(e);if(!o)return void console.error(`[Instance Store] 副本不存在: ${e}`);o.events.some(e=>e.id===a.id)?console.warn(`[Instance Store] 事件已存在: ${a.id}`):(o.events.push(a),console.log(`[Instance Store] 事件已添加: ${a.summary} (${a.id})`),await u())},endInstance:async function(e){const a=t.value.get(e);a?(a.status='completed',a.endTime=Date.now(),a.characters=[],a.map.areas.clear(),a.map.connections=[],a.map.playerLocation='',a.map.startArea='',console.log(`[Instance Store] 副本已结束: ${e}`),console.log(`[Instance Store] 保留 ${a.events.length} 条事件记录`),console.log(`[Instance Store] 保留 ${a.mementos.length} 个纪念品`),await u()):console.error(`[Instance Store] 副本不存在: ${e}`)},completeInstance:async function(e){const a=t.value.get(e);a?(a.status='completed',a.endTime=Date.now(),a.characters=[],a.map.areas.clear(),a.map.connections=[],a.map.playerLocation='',a.map.startArea='',console.log(`[Instance Store] 副本已完成: ${e}`),console.log(`[Instance Store] 保留 ${a.events.length} 条事件记录`),console.log(`[Instance Store] 保留 ${a.mementos.length} 个纪念品`),await u()):console.error(`[Instance Store] 副本不存在: ${e}`)},saveToMVU:u}})},391:(e,t,a)=>{a.d(t,{characterInitializer:()=>r});var o=a(67);class n{static validateGlobalVariables(e,t){try{console.log('[ProtagonistValidator] 开始验证全局变量...');const a=getVariables({type:'global'});console.log('[ProtagonistValidator] 全局变量获取成功');const o=a.player_name;if(!(o===e))return console.error('[ProtagonistValidator] ❌ player_name 不匹配:',{expected:e,actual:o}),!1;console.log('[ProtagonistValidator] ✅ player_name 匹配:',o);const n=a.player_description;return n===t?(console.log('[ProtagonistValidator] ✅ player_description 匹配，长度:',n.length),console.log('[ProtagonistValidator] ✅ 全局变量验证通过'),!0):(console.error('[ProtagonistValidator] ❌ player_description 不匹配:',{expected:`${t.substring(0,50)}...`,actual:n?`${n.substring(0,50)}...`:void 0,expectedLength:t.length,actualLength:n?.length}),!1)}catch(e){return console.error('[ProtagonistValidator] ❌ 全局变量验证失败:',{error:e.message,stack:e.stack}),!1}}static validateInterceptor(e,t){try{console.log('[ProtagonistValidator] 开始验证拦截器...');const a=SillyTavern;if('function'==typeof a.getUserName){const t=a.getUserName();if(!(t===e))return console.error('[ProtagonistValidator] ❌ getUserName() 返回值不匹配:',{expected:e,actual:t}),!1;console.log('[ProtagonistValidator] ✅ getUserName() 返回正确:',t)}else console.warn('[ProtagonistValidator] ⚠️ getUserName 不是函数，拦截器可能未设置');if('function'==typeof a.getPersonaDescription){const e=a.getPersonaDescription();if(!(e===t))return console.error('[ProtagonistValidator] ❌ getPersonaDescription() 返回值不匹配:',{expected:`${t.substring(0,50)}...`,actual:e?`${e.substring(0,50)}...`:void 0,expectedLength:t.length,actualLength:e?.length}),!1;console.log('[ProtagonistValidator] ✅ getPersonaDescription() 返回正确，长度:',e.length)}else console.warn('[ProtagonistValidator] ⚠️ getPersonaDescription 不是函数，拦截器可能未设置');if(a.powerUserSettings){const o=a.powerUserSettings.name;if(!(o===e))return console.error('[ProtagonistValidator] ❌ powerUserSettings.name 不匹配:',{expected:e,actual:o}),!1;console.log('[ProtagonistValidator] ✅ powerUserSettings.name 正确:',o);const n=a.powerUserSettings.persona_description;if(!(n===t))return console.error('[ProtagonistValidator] ❌ powerUserSettings.persona_description 不匹配:',{expected:`${t.substring(0,50)}...`,actual:n?`${n.substring(0,50)}...`:void 0,expectedLength:t.length,actualLength:n?.length}),!1;console.log('[ProtagonistValidator] ✅ powerUserSettings.persona_description 正确，长度:',n.length)}else console.warn('[ProtagonistValidator] ⚠️ powerUserSettings 不存在');return'function'==typeof a.getUserName&&a.getUserName()===e||'function'==typeof a.getPersonaDescription&&a.getPersonaDescription()===t||a.powerUserSettings&&a.powerUserSettings.name===e?(console.log('[ProtagonistValidator] ✅ 拦截器验证通过'),!0):(console.error('[ProtagonistValidator] ❌ 所有拦截器方法都未正确设置'),!1)}catch(e){return console.error('[ProtagonistValidator] ❌ 拦截器验证失败:',{error:e.message,stack:e.stack}),!1}}static validate(e,t){console.log('[ProtagonistValidator] ========== 开始完整验证 =========='),console.log('[ProtagonistValidator] 期望的主控名称:',e),console.log('[ProtagonistValidator] 期望的描述长度:',t.length);const a=[],o={globalVariablesValid:!1,interceptorValid:!1,nameMatch:!1,descriptionMatch:!1},n=this.validateGlobalVariables(e,t);if(o.globalVariablesValid=n,n)o.nameMatch=!0,o.descriptionMatch=!0;else{a.push('全局变量中的主控信息不正确');try{const n=getVariables({type:'global'}),r=n.player_name,l=n.player_description;o.nameMatch=r===e,o.descriptionMatch=l===t,o.nameMatch||a.push(`player_name 不匹配: 期望 "${e}", 实际 "${r}"`),o.descriptionMatch||a.push(`player_description 不匹配: 期望长度 ${t.length}, 实际长度 ${l?.length||0}`)}catch(e){a.push(`无法读取全局变量: ${e.message}`)}}const r=this.validateInterceptor(e,t);o.interceptorValid=r,r||a.push('SillyTavern 拦截器未正确设置');const l=n&&r;return l?console.log('[ProtagonistValidator] ✅✅✅ 完整验证通过'):console.error('[ProtagonistValidator] ❌❌❌ 完整验证失败:',{errors:a,details:o}),console.log('[ProtagonistValidator] ========== 验证完成 =========='),{success:l,errors:a,details:o}}}const r=new class{initialized=!1;interceptorState={isSetup:!1,currentName:null,currentDescription:null};originalMethods={};async checkAndInitialize(){try{console.log('[CharacterInitializer] ========== 开始检查 ==========');const e=SillyTavern.chat.length;console.log('[CharacterInitializer] SillyTavern.chat.length:',e);let t=[];try{t=getChatMessages('0-{{lastMessageId}}'),console.log('[CharacterInitializer] getChatMessages 返回消息数:',t.length)}catch(e){console.log('[CharacterInitializer] getChatMessages 失败（可能是第 0 楼）:',e)}const a=0===e&&0===t.length;if(console.log('[CharacterInitializer] 是否在第 0 楼:',a),!a)return console.log('[CharacterInitializer] ❌ 不在第 0 楼，无需初始化'),!1;const n=(0,o.m)();return console.log('[CharacterInitializer] characterStore.hasPlayer:',n.hasPlayer),console.log('[CharacterInitializer] characterStore.player:',n.player),n.hasPlayer?(console.log('[CharacterInitializer] ❌ 主控角色已存在，无需初始化'),!1):(console.log('[CharacterInitializer] this.initialized:',this.initialized),this.initialized?(console.log('[CharacterInitializer] ❌ 已经触发过初始化流程'),!1):(console.log('[CharacterInitializer] ✅✅✅ 需要初始化主控角色，触发欢迎页面事件'),this.initialized=!0,console.log('[CharacterInitializer] 发送事件: character_initialization_required'),eventEmit('character_initialization_required'),console.log('[CharacterInitializer] 事件已发送'),!0))}catch(e){return console.error('[CharacterInitializer] ❌ 检查初始化失败:',e),!1}}async syncToSillyTavern(){try{console.log('[CharacterInitializer] 开始设置主控角色信息拦截...');const e=(0,o.m)().player;if(!e)return void console.warn('[CharacterInitializer] 没有主控角色，无法设置');console.log('[CharacterInitializer] 主控角色:',e.name);const t=this.formatCharacterDescription(e);console.log('[CharacterInitializer] 格式化后的描述长度:',t.length),insertOrAssignVariables({player_name:e.name,player_description:t},{type:'global'}),this.setupInterceptor(e.name,t),console.log('[CharacterInitializer] 当前拦截器状态:',this.interceptorState),console.log('[CharacterInitializer] ✅ 主控角色信息已保存并启用拦截'),toastr.success('主控角色信息已设置')}catch(e){console.error('[CharacterInitializer] ❌ 设置主控角色信息失败:',e),toastr.error('设置角色信息失败: '+e.message)}}resetInterceptor(){try{console.log('[CharacterInitializer] ========== 开始重置拦截器 =========='),console.log('[CharacterInitializer] 当前拦截器状态:',this.interceptorState);const e=SillyTavern;if(this.originalMethods.getUserName?(e.getUserName=this.originalMethods.getUserName,console.log('[CharacterInitializer] ✅ getUserName 已恢复为原始方法')):console.log('[CharacterInitializer] ⚠️ getUserName 原始方法未保存，跳过恢复'),this.originalMethods.getPersonaDescription?(e.getPersonaDescription=this.originalMethods.getPersonaDescription,console.log('[CharacterInitializer] ✅ getPersonaDescription 已恢复为原始方法')):console.log('[CharacterInitializer] ⚠️ getPersonaDescription 原始方法未保存，跳过恢复'),e.powerUserSettings){try{delete e.powerUserSettings.name,console.log('[CharacterInitializer] ✅ powerUserSettings.name 属性拦截已移除')}catch(e){console.warn('[CharacterInitializer] ⚠️ 移除 powerUserSettings.name 拦截失败:',e)}try{delete e.powerUserSettings.persona_description,console.log('[CharacterInitializer] ✅ powerUserSettings.persona_description 属性拦截已移除')}catch(e){console.warn('[CharacterInitializer] ⚠️ 移除 powerUserSettings.persona_description 拦截失败:',e)}}this.interceptorState={isSetup:!1,currentName:null,currentDescription:null},console.log('[CharacterInitializer] ✅✅✅ 拦截器已完全重置'),console.log('[CharacterInitializer] 新的拦截器状态:',this.interceptorState),console.log('[CharacterInitializer] ========== 拦截器重置完成 ==========')}catch(e){throw console.error('[CharacterInitializer] ❌ 拦截器重置失败:',{error:e.message,stack:e.stack,currentState:this.interceptorState}),e}}setupInterceptor(e,t){try{console.log('[CharacterInitializer] ========== 开始设置拦截器 =========='),console.log('[CharacterInitializer] 主控名称:',e),console.log('[CharacterInitializer] 描述长度:',t.length);const a=SillyTavern;if(this.originalMethods.getUserName||'function'!=typeof a.getUserName||(this.originalMethods.getUserName=a.getUserName,console.log('[CharacterInitializer] ✅ 已保存 getUserName 原始方法')),this.originalMethods.getPersonaDescription||'function'!=typeof a.getPersonaDescription||(this.originalMethods.getPersonaDescription=a.getPersonaDescription,console.log('[CharacterInitializer] ✅ 已保存 getPersonaDescription 原始方法')),'function'==typeof a.getUserName&&(a.getUserName=function(){return console.log('[CharacterInitializer] 拦截 getUserName，返回主控角色名称:',e),e},console.log('[CharacterInitializer] ✅ getUserName 已拦截')),'function'==typeof a.getPersonaDescription&&(a.getPersonaDescription=function(){return console.log('[CharacterInitializer] 拦截 getPersonaDescription，返回主控角色描述，长度:',t.length),t},console.log('[CharacterInitializer] ✅ getPersonaDescription 已拦截')),a.powerUserSettings){const o=a.powerUserSettings;Object.defineProperty(o,'name',{get:function(){return console.log('[CharacterInitializer] 拦截 powerUserSettings.name，返回主控角色名称:',e),e},set:function(){console.log('[CharacterInitializer] 拦截 powerUserSettings.name 设置，忽略')},configurable:!0}),Object.defineProperty(o,'persona_description',{get:function(){return console.log('[CharacterInitializer] 拦截 powerUserSettings.persona_description，返回主控角色描述，长度:',t.length),t},set:function(){console.log('[CharacterInitializer] 拦截 powerUserSettings.persona_description 设置，忽略')},configurable:!0}),console.log('[CharacterInitializer] ✅ powerUserSettings 属性已拦截')}this.interceptorState={isSetup:!0,currentName:e,currentDescription:t},console.log('[CharacterInitializer] ✅✅✅ 用户信息拦截已全部启用'),console.log('[CharacterInitializer] 拦截器状态:',this.interceptorState),console.log('[CharacterInitializer] ========== 拦截器设置完成 ==========')}catch(a){throw console.error('[CharacterInitializer] ❌ 拦截器设置失败:',{error:a.message,stack:a.stack,playerName:e,descriptionLength:t.length}),a}}async verifyProtagonistInfo(e,t){try{console.log('[CharacterInitializer] ========== 开始验证主控信息 ==========');const a=n.validate(e,t);return a.success?(console.log('[CharacterInitializer] ✅✅✅ 主控信息验证成功'),console.log('[CharacterInitializer] 验证详情:',a.details),console.log('[CharacterInitializer] ========== 验证完成（成功）=========='),!0):(console.error('[CharacterInitializer] ❌ 主控信息验证失败:',{errors:a.errors,details:a.details}),toastr.warning(`主控信息验证失败：${a.errors.join('；')}`,'验证警告',{timeOut:5e3}),console.log('[CharacterInitializer] ========== 验证完成（失败）=========='),!1)}catch(e){return console.error('[CharacterInitializer] ❌ 验证过程发生异常:',{error:e.message,stack:e.stack}),toastr.error('主控信息验证过程发生错误','验证错误'),!1}}formatCharacterDescription(e){const t=[];t.push(`姓名：${e.name}`),e.age&&t.push(`年龄：${e.age}`),e.occupation&&t.push(`职业：${e.occupation}`),e.background&&t.push(`背景：${e.background}`),t.push(''),t.push('属性：');const a=e.attributes;t.push(`- 力量 (STR): ${a.STR}`),t.push(`- 体质 (CON): ${a.CON}`),t.push(`- 体型 (SIZ): ${a.SIZ}`),t.push(`- 敏捷 (DEX): ${a.DEX}`),t.push(`- 外貌 (APP): ${a.APP}`),t.push(`- 智力 (INT): ${a.INT}`),t.push(`- 意志 (POW): ${a.POW}`),t.push(`- 教育 (EDU): ${a.EDU}`),t.push(`- 幸运 (LUK): ${a.LUK}`),t.push(''),t.push('衍生属性：');const o=e.derivedStats;return t.push(`- 生命值 (HP): ${o.HP}/${o.maxHP}`),t.push(`- 魔法值 (MP): ${o.MP}/${o.maxMP}`),t.push(`- 理智值 (SAN): ${o.SAN}/${o.maxSAN}`),t.push(`- 移动力 (MOV): ${o.MOV}`),t.push(`- 伤害加值 (DB): ${o.DB}`),t.push(`- 体格 (BUILD): ${o.BUILD}`),e.skills&&e.skills.size>0&&(t.push(''),t.push('技能：'),e.skills.forEach((e,a)=>{t.push(`- ${a}: ${e}`)})),t.join('\n')}async onCharacterCreated(e){try{console.log('[CharacterInitializer] ========== 处理角色创建完成事件 =========='),console.log('[CharacterInitializer] 步骤 1/4: 同步角色信息到酒馆...'),await this.syncToSillyTavern(),console.log('[CharacterInitializer] ✅ 角色信息同步完成'),console.log('[CharacterInitializer] 步骤 2/4: 重置 API 配置...');try{const{gameResetService:e}=await Promise.resolve().then(a.bind(a,853));await e.resetAPIConfiguration(),console.log('[CharacterInitializer] ✅ API 配置已重置为酒馆默认')}catch(e){console.error('[CharacterInitializer] ⚠️ API 配置重置失败:',e),toastr.warning('API 配置重置失败，将使用当前配置')}console.log('[CharacterInitializer] 步骤 3/4: 生成现实世界地图...');const{realWorldMapService:t}=await Promise.resolve().then(a.bind(a,76));if(await t.hasMap())console.log('[CharacterInitializer] 现实世界地图已存在，跳过生成');else{console.log('[CharacterInitializer] 开始生成现实世界地图...');try{await t.generateMap(e),console.log('[CharacterInitializer] ✅ 现实世界地图生成成功'),toastr.success('现实世界地图已生成')}catch(e){console.error('[CharacterInitializer] ❌ 现实世界地图生成失败:',e),toastr.error('现实世界地图生成失败，可稍后在地图面板手动生成')}}console.log('[CharacterInitializer] 步骤 4/4: 验证主控信息...');const o=this.formatCharacterDescription(e);await this.verifyProtagonistInfo(e.name,o)?console.log('[CharacterInitializer] ✅ 主控信息验证通过'):console.warn('[CharacterInitializer] ⚠️ 主控信息验证失败，但继续流程'),console.log('[CharacterInitializer] ========== 角色创建后处理完成 ==========')}catch(e){throw console.error('[CharacterInitializer] ❌ 角色创建后处理失败:',e),toastr.error('角色创建后处理失败'),e}}reset(){this.initialized=!1,console.log('[CharacterInitializer] 初始化状态已重置')}}},425:(e,t,a)=>{a.d(t,{areaDetailsService:()=>o});const o=new class{async generateDetails(e,t=!1){return await withAPIContext('sanctuary',async()=>{try{console.log(`[AreaDetailsService] 开始生成区域详细信息: ${e.name}`),toastr.info('正在生成区域详细信息...');const a=t?'现实世界':'副本世界',o=`你是一个游戏场景描述生成器。请为以下地点生成详细信息，严格按照 YAML 格式返回。\n\n地点信息：\n- 名称：${e.name}\n- 基础描述：${e.description}\n- 世界类型：${a}\n- 是否危险：${e.isDangerous?'是':'否'}\n\n要求：\n1. 必须使用 \`\`\`yaml 代码块包裹\n2. environment: 环境描述（50-100字，描述地点的外观、布局、光线等）\n3. atmosphere: 氛围描述（30-50字，描述地点给人的感觉）\n4. items: 可获取的道具列表（2-4个道具）\n   - 每个道具包含 id、name、description（一句话）、type\n   - 道具必须符合地点特征\n   - ${t?'现实世界道具应该是日常物品':'副本道具可以是特殊物品'}\n\n示例格式：\n\`\`\`yaml\nenvironment: 这是一个宽敞明亮的便利店，货架整齐地排列着各种商品。白色的日光灯照亮整个空间，收银台旁边摆放着热饮机和微波炉。\natmosphere: 安静祥和，偶尔传来冰柜的嗡嗡声，空气中弥漫着咖啡的香气。\nitems:\n  - id: item_${Date.now()}_1\n    name: 矿泉水\n    description: 一瓶普通的矿泉水，可以补充水分\n    type: 消耗品\n  - id: item_${Date.now()}_2\n    name: 便当\n    description: 新鲜的便当，可以恢复体力\n    type: 食物\n\`\`\`\n\n现在请生成 ${e.name} 的详细信息：`;let n;try{n=await generateRaw({ordered_prompts:[{role:'user',content:o}]}),console.log('[AreaDetailsService] AI 生成完成，开始解析...')}catch(a){return console.error('[AreaDetailsService] API 调用失败:',{error:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0}),console.log('[AreaDetailsService] API 调用失败，使用默认详细信息'),toastr.warning(`${e.name} 使用默认详细信息（API 不可用）`),this.generateDefaultDetails(e,t)}const r=await this.parseDetailsFromText(n);return toastr.success('区域详细信息生成成功！'),r}catch(a){return console.error('[AreaDetailsService] 生成区域详细信息失败:',a),toastr.warning('使用默认详细信息'),this.generateDefaultDetails(e,t)}})}async parseDetailsFromText(e){const YAML=(await Promise.resolve().then(a.t.bind(a,856,23))).default;console.log('[AreaDetailsService] 开始解析文本...');const t=[{regex:/```yaml\n([\s\S]*?)\n```/,name:'```yaml'},{regex:/```yml\n([\s\S]*?)\n```/,name:'```yml'},{regex:/```\n([\s\S]*?)\n```/,name:'```'}];for(const{regex:a,name:o}of t){const t=e.match(a);if(t){console.log(`[AreaDetailsService] 找到代码块 (${o})`);try{const e=YAML.parse(t[1]);if(this.validateDetails(e))return console.log('[AreaDetailsService] 解析成功'),this.buildDetails(e)}catch(e){console.warn('[AreaDetailsService] YAML 解析失败:',e)}}}try{const t=YAML.parse(e);if(this.validateDetails(t))return console.log('[AreaDetailsService] 直接解析成功'),this.buildDetails(t)}catch(e){console.warn('[AreaDetailsService] 直接解析失败:',e)}throw new Error('无法解析详细信息')}validateDetails(e){return e&&'object'==typeof e&&'string'==typeof e.environment&&'string'==typeof e.atmosphere&&Array.isArray(e.items)}buildDetails(e){return{environment:e.environment,atmosphere:e.atmosphere,items:e.items.map(e=>({id:e.id||`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:e.name,description:e.description,type:e.type}))}}generateDefaultDetails(e,t){console.log('[AreaDetailsService] 生成默认详细信息');const a=t?[{id:`item_${Date.now()}_1`,name:'矿泉水',description:'一瓶普通的矿泉水，可以补充水分',type:'消耗品'},{id:`item_${Date.now()}_2`,name:'便当',description:'新鲜的便当，可以恢复体力',type:'食物'}]:[{id:`item_${Date.now()}_1`,name:'神秘药水',description:'散发着奇异光芒的药水，效果未知',type:'消耗品'},{id:`item_${Date.now()}_2`,name:'古老卷轴',description:'记载着某种知识的卷轴',type:'材料'}];return{environment:`${e.description}。这里的环境${e.isDangerous?'充满危险气息':'相对安全'}。`,atmosphere:e.isDangerous?'紧张压抑，让人不安':'平静祥和，令人放松',items:a}}}},428:(e,t,a)=>{a.d(t,{mvuService:()=>M});var o=a(15),n=a(707);const r=n.z.object({STR:n.z.number().min(0).max(100).default(50),CON:n.z.number().min(0).max(100).default(50),SIZ:n.z.number().min(0).max(100).default(50),DEX:n.z.number().min(0).max(100).default(50),APP:n.z.number().min(0).max(100).default(50),INT:n.z.number().min(0).max(100).default(50),POW:n.z.number().min(0).max(100).default(50),EDU:n.z.number().min(0).max(100).default(50),LUK:n.z.number().min(0).max(100).default(50)}),l=n.z.object({HP:n.z.number().min(0),maxHP:n.z.number().min(0),MP:n.z.number().min(0),maxMP:n.z.number().min(0),SAN:n.z.number().min(0).max(99),maxSAN:n.z.number().min(0).max(99),MOV:n.z.number().min(0),DB:n.z.string(),BUILD:n.z.number()}),s=n.z.object({type:n.z.string(),value:n.z.number(),description:n.z.string().optional()}),c=n.z.lazy(()=>n.z.object({id:n.z.string(),name:n.z.string(),parent:n.z.string().optional(),damage:n.z.number().min(0).max(100).default(0),debuffs:n.z.array(s).default([]),children:n.z.array(c).optional()})),i=(n.z.object({name:n.z.string(),value:n.z.number().min(0).max(100),isOccupational:n.z.boolean().optional()}),n.z.object({id:n.z.string(),name:n.z.string(),description:n.z.string(),quantity:n.z.number().min(0).default(1),type:n.z.string().optional()})),u=n.z.object({id:n.z.string(),name:n.z.string(),age:n.z.number().optional(),occupation:n.z.string().optional(),background:n.z.string().optional(),attributes:r,derivedStats:l,skills:n.z.record(n.z.string(),n.z.number()).transform(e=>new Map(Object.entries(e))),bodyParts:n.z.array(c).default([]),inventory:n.z.array(i).default([]),portrait:n.z.string().optional()}),d=u.extend({type:n.z.literal('player')}),m=u.extend({type:n.z.literal('npc'),affection:n.z.number().min(0).max(100).default(50),isImportant:n.z.boolean().default(!1),events:n.z.array(n.z.string()).default([]),relationship:n.z.string().optional()}),v=n.z.union([d,m]),p=n.z.object({characterId:n.z.string(),url:n.z.string(),position:n.z.enum(['left','center','right','custom']),x:n.z.number().optional(),y:n.z.number().optional(),scale:n.z.number().default(1),opacity:n.z.number().min(0).max(1).default(1)}),g=n.z.object({id:n.z.string(),name:n.z.string(),description:n.z.string(),background:n.z.string().optional(),connectedAreas:n.z.array(n.z.string()).default([]),events:n.z.array(n.z.string()).optional(),isDiscovered:n.z.boolean().default(!1),isDangerous:n.z.boolean().optional()}),h=n.z.object({from:n.z.string(),to:n.z.string(),isLocked:n.z.boolean().optional(),requirement:n.z.string().optional()}),f=n.z.object({areas:n.z.record(n.z.string(),g).transform(e=>new Map(Object.entries(e))),connections:n.z.array(h).default([]),playerLocation:n.z.string(),startArea:n.z.string()}),y=n.z.object({characterId:n.z.string(),character:v,isImportant:n.z.boolean().default(!1),firstAppearance:n.z.string().optional(),lastSeen:n.z.string().optional()}),S=n.z.object({id:n.z.string(),summary:n.z.string(),timestamp:n.z.number(),location:n.z.string().optional(),involvedCharacters:n.z.array(n.z.string()).default([]),consequences:n.z.string().optional()}),C=n.z.object({id:n.z.string(),name:n.z.string(),type:n.z.string(),difficulty:n.z.number().min(1).max(5),worldSetting:n.z.string(),map:f,characters:n.z.array(y).default([]),events:n.z.array(S).default([]),startTime:n.z.number(),endTime:n.z.number().optional(),ending:n.z.string().optional(),isActive:n.z.boolean().default(!1),customPrompt:n.z.string().optional()}),N=n.z.enum(['critical_success','extreme_success','hard_success','success','failure','critical_failure']),w=n.z.object({roll:n.z.number().min(1).max(100),skill:n.z.number().min(0).max(100),result:N,skillName:n.z.string().optional(),timestamp:n.z.number()}),E=n.z.object({id:n.z.string(),name:n.z.string(),type:n.z.enum(['buff','debuff']),description:n.z.string(),duration:n.z.number(),effect:n.z.object({attribute:n.z.string().optional(),modifier:n.z.number().optional(),damagePerRound:n.z.number().optional()})}),k=n.z.object({id:n.z.string(),name:n.z.string(),description:n.z.string().optional(),attributes:r,derivedStats:l,skills:n.z.record(n.z.string(),n.z.number()).transform(e=>new Map(Object.entries(e))),bodyParts:n.z.array(c).default([]),portrait:n.z.string().optional(),attackPattern:n.z.string().optional(),loot:n.z.array(i).optional()}),b=n.z.object({type:n.z.enum(['attack','dodge','escape','special']),actorId:n.z.string(),targetId:n.z.string().optional(),attackType:n.z.enum(['melee','ranged','magic','special']).optional(),skillUsed:n.z.string().optional(),roll:w.optional(),damage:n.z.number().optional(),bodyPartHit:n.z.string().optional(),description:n.z.string().optional()}),V=n.z.object({roundNumber:n.z.number(),actions:n.z.array(b).default([]),timestamp:n.z.number()}),I=n.z.object({id:n.z.string(),character:v.optional(),enemy:k.optional(),isPlayer:n.z.boolean(),currentHP:n.z.number(),currentMP:n.z.number(),currentSAN:n.z.number(),statusEffects:n.z.array(E).default([]),initiative:n.z.number()}),P=(n.z.object({id:n.z.string(),participants:n.z.array(I),currentRound:n.z.number().default(1),currentTurn:n.z.number().default(0),status:n.z.enum(['active','victory','defeat','escaped']),rounds:n.z.array(V).default([]),startTime:n.z.number(),environment:n.z.string().optional()}),n.z.object({speaker:n.z.string(),content:n.z.string(),timestamp:n.z.number(),characterId:n.z.string().optional()})),A=(n.z.object({background:n.z.string(),sprites:n.z.array(p).default([]),areaId:n.z.string().optional(),description:n.z.string().optional()}),n.z.object({game:n.z.object({currentInstanceId:n.z.string().optional(),currentArea:n.z.string().optional(),mode:n.z.enum(['main','combat','sanctuary','creation']).default('main')}).default(()=>({mode:'main'})),characters:n.z.object({player:d.optional(),npcs:n.z.record(n.z.string(),m).default({})}).default(()=>({npcs:{}})),instances:n.z.record(n.z.string(),C).default({}),interaction:n.z.object({dialogues:n.z.array(P).default([])}).default(()=>({dialogues:[]}))}).default(()=>({game:{mode:'main'},characters:{npcs:{}},instances:{},interaction:{dialogues:[]}})));const M=new class{initialized=!1;async initialize(){if(this.initialized)return void console.log('[MVU Service] 已经初始化，跳过重复初始化');console.log('[MVU Service] 开始初始化 MVU 服务...');const e=Date.now();try{console.log('[MVU Service] 等待 MVU 变量框架全局初始化...'),await waitGlobalInitialized('Mvu'),this.initialized=!0;const t=Date.now()-e;console.log('[MVU Service] MVU 变量框架初始化完成'),console.log('[MVU Service] 初始化耗时:',t,'ms')}catch(t){throw console.error('[MVU Service] MVU 初始化失败:',t),console.error('[MVU Service] 初始化失败时间:',Date.now()-e,'ms'),toastr.error('MVU 变量框架初始化失败，请确保已安装 MVU 插件'),t}}ensureInitialized(){if(!this.initialized)throw new Error('MVU Service 未初始化，请先调用 initialize()')}async loadGameData(e=0){this.ensureInitialized();try{const t=Mvu.getMvuData({type:'message',message_id:e});if(console.log('[MVU Service] 原始数据:',t),!t||0===Object.keys(t).length){console.log('[MVU Service] 未找到游戏数据，使用默认值初始化');const t=A.parse({});return await this.saveGameData(t,e),t}const a=A.parse(t);return console.log('[MVU Service] 游戏数据加载成功'),a}catch(t){if(console.error('[MVU Service] 加载游戏数据失败:',t),t instanceof Error&&'issues'in t){const{formatZodError:e}=await Promise.resolve().then(a.bind(a,827)),o=e(t);console.error('[MVU Service] 数据验证错误:\n',o),toastr.warning('游戏数据格式错误，已使用默认值初始化')}else toastr.error('加载游戏数据失败');const o=A.parse({});try{await this.saveGameData(o,e)}catch(e){console.error('[MVU Service] 保存默认数据失败:',e)}return o}}async saveGameData(e,t=0){this.ensureInitialized(),console.log('[MVU Service] 开始保存游戏数据到消息楼层',t);const a=Date.now();try{console.log('[MVU Service] 使用 klona 去除 Proxy 层...');const n=(0,o.klona)(e);console.log('[MVU Service] 获取当前 MVU 数据结构...');const r={...Mvu.getMvuData({type:'message',message_id:t}),stat_data:n};console.log('[MVU Service] 写入 MVU 变量...'),await Mvu.replaceMvuData(r,{type:'message',message_id:t});const l=Date.now()-a;console.log('[MVU Service] 游戏数据保存成功，耗时:',l,'ms')}catch(e){throw console.error('[MVU Service] 保存游戏数据失败:',e),console.error('[MVU Service] 保存失败时间:',Date.now()-a,'ms'),toastr.error('保存游戏数据失败'),e}}async updateCharacterStatus(e,t,a=0){this.ensureInitialized();try{const o=await this.loadGameData(a);if('player'===e){if(!o.characters.player)throw new Error('主控角色不存在');t.attributes&&Object.assign(o.characters.player.attributes,t.attributes),t.derivedStats&&Object.assign(o.characters.player.derivedStats,t.derivedStats),t.bodyParts&&(o.characters.player.bodyParts=t.bodyParts)}else{const a=o.characters.npcs[e];if(!a)throw new Error(`NPC ${e} 不存在`);t.attributes&&Object.assign(a.attributes,t.attributes),t.derivedStats&&Object.assign(a.derivedStats,t.derivedStats),t.bodyParts&&(a.bodyParts=t.bodyParts),void 0!==t.affection&&(a.affection=t.affection)}await this.saveGameData(o,a),console.log(`[MVU Service] 角色 ${e} 状态更新成功`)}catch(t){throw console.error(`[MVU Service] 更新角色 ${e} 状态失败:`,t),toastr.error('更新角色状态失败'),t}}async saveCharacter(e,t=0){this.ensureInitialized();try{const a=await this.loadGameData(t);'player'===e.type?a.characters.player=e:a.characters.npcs[e.id]=e,await this.saveGameData(a,t),console.log(`[MVU Service] 角色 ${e.name} 保存成功`)}catch(t){throw console.error(`[MVU Service] 保存角色 ${e.name} 失败:`,t),toastr.error('保存角色数据失败'),t}}async deleteNPC(e,t=0){this.ensureInitialized();try{const a=await this.loadGameData(t);if(!a.characters.npcs[e])throw new Error(`NPC ${e} 不存在`);delete a.characters.npcs[e],await this.saveGameData(a,t),console.log(`[MVU Service] NPC ${e} 删除成功`)}catch(t){throw console.error(`[MVU Service] 删除 NPC ${e} 失败:`,t),toastr.error('删除 NPC 失败'),t}}async updatePlayerLocation(e,t=0){this.ensureInitialized();try{const a=await this.loadGameData(t);if(!a.game.currentInstanceId)throw new Error('当前没有活跃的副本');const o=a.instances[a.game.currentInstanceId];if(!o)throw new Error('副本数据不存在');o.map.playerLocation=e,a.game.currentArea=e,await this.saveGameData(a,t),console.log(`[MVU Service] 玩家位置更新为: ${e}`)}catch(e){throw console.error('[MVU Service] 更新玩家位置失败:',e),toastr.error('更新玩家位置失败'),e}}async updateGameMode(e,t=0){this.ensureInitialized();try{const a=await this.loadGameData(t);a.game.mode=e,await this.saveGameData(a,t),console.log(`[MVU Service] 游戏模式更新为: ${e}`)}catch(e){throw console.error('[MVU Service] 更新游戏模式失败:',e),toastr.error('更新游戏模式失败'),e}}async setCurrentInstance(e,t=0){this.ensureInitialized();try{const a=await this.loadGameData(t);a.game.currentInstanceId=e,await this.saveGameData(a,t),console.log(`[MVU Service] 当前副本设置为: ${e}`)}catch(e){throw console.error('[MVU Service] 设置当前副本失败:',e),toastr.error('设置当前副本失败'),e}}async parseAndUpdateFromMessage(e,t=0){this.ensureInitialized();try{if(!this.containsMVUCommands(e))return console.log('[MVU Service] 消息中不包含 MVU 命令，跳过解析'),await this.loadGameData(t);const a=Mvu.getMvuData({type:'message',message_id:t}),o=await Mvu.parseMessage(e,a),n=A.parse(o?.stat_data||{});return await this.saveGameData(n,t),console.log('[MVU Service] MVU 命令解析并更新成功'),n}catch(e){throw console.error('[MVU Service] 解析 MVU 命令失败:',e),toastr.error('解析 AI 输出中的数据更新失败'),e}}containsMVUCommands(e){return e.includes('{{')&&e.includes('}}')}}},493:(e,t,a)=>{a.d(t,{eventRecordService:()=>n});var o=a(371);const n=new class{initialized=!1;eventKeywords=['发现','战斗','死亡','获得','失去','决定','揭示','遇见'];initialize(){this.initialized?console.log('[Event Record Service] 服务已初始化，跳过'):(console.log('[Event Record Service] 初始化事件记录服务'),this.initialized=!0)}async recordEventFromAIOutput(e,t,a){try{if(!this.containsImportantEvent(t))return;const n=this.generateEventSummary(t),r=this.detectImportance(t),l={id:this.generateEventId(),summary:n,timestamp:Date.now(),involvedCharacters:a},s=(0,o.useInstanceStore)(),c=s.getInstance(e);if(!c)return void console.error(`[Event Record Service] 副本不存在: ${e}`);c.events.push(l),await s.updateInstance(e,{events:c.events}),console.log(`[Event Record Service] 事件已记录: ${n} (重要性: ${r})`)}catch(e){console.error('[Event Record Service] 记录事件失败:',e)}}containsImportantEvent(e){return this.eventKeywords.some(t=>e.includes(t))}generateEventSummary(e){const t=e.split(/[。！？\n]/);for(const e of t){const t=e.trim();if(!(t.length<10||t.length>100)&&this.eventKeywords.some(e=>t.includes(e)))return t}for(const e of t){const t=e.trim();if(t.length>=10&&t.length<=100)return t}return e.substring(0,50).trim()+'...'}detectImportance(e){return['死亡','揭示','决定'].some(t=>e.includes(t))?'high':['战斗','发现','获得'].some(t=>e.includes(t))?'medium':(['遇见','失去'].some(t=>e.includes(t)),'low')}generateEventId(){return`event_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}getInstanceEvents(e){const t=(0,o.useInstanceStore)().getInstance(e);return t?t.events||[]:(console.error(`[Event Record Service] 副本不存在: ${e}`),[])}getImportantEvents(e){return this.getInstanceEvents(e).filter(e=>['死亡','揭示','决定'].some(t=>e.summary.includes(t)))}}},536:e=>{e.exports=import('https://testingcf.jsdelivr.net/npm/klona/+esm')},588:(e,t,a)=>{a.d(t,{apiConfigService:()=>o});const o=new class{configs=null;currentWorld='realWorld';initialized=!1;async initialize(){if(this.initialized)console.log('[API Config Service] 已经初始化，跳过');else try{console.log('[API Config Service] 开始初始化...'),await this.loadConfigs(),this.initialized=!0,console.log('[API Config Service] 初始化完成')}catch(e){throw console.error('[API Config Service] 初始化失败:',e),e}}async loadConfigs(){try{const e=getVariables({type:'global'}).api_configs;return e?(this.configs=e,console.log('[API Config Service] 已加载配置:',this.configs)):(this.configs={realWorld:null,innerWorld:null,sanctuary:null},console.log('[API Config Service] 使用默认配置（酒馆默认 API）')),this.configs}catch(e){return console.error('[API Config Service] 加载配置失败:',e),this.configs={realWorld:null,innerWorld:null,sanctuary:null},this.configs}}async saveConfigs(e){try{this.configs=e,await insertOrAssignVariables({api_configs:e},{type:'global'}),console.log('[API Config Service] 配置已保存:',e),toastr.success('API 配置已保存')}catch(e){throw console.error('[API Config Service] 保存配置失败:',e),toastr.error('保存 API 配置失败'),e}}getCurrentAPI(){if(!this.configs)return console.warn('[API Config Service] 配置未加载，返回 null'),null;const e=this.configs[this.currentWorld];return console.log(`[API Config Service] 获取当前世界 (${this.currentWorld}) 的 API 配置:`,e),e}getWorldAPI(e){return this.configs?this.configs[e]:(console.warn('[API Config Service] 配置未加载，返回 null'),null)}getAllConfigs(){return this.configs?{realWorld:this.configs.realWorld?{...this.configs.realWorld}:null,innerWorld:this.configs.innerWorld?{...this.configs.innerWorld}:null,sanctuary:this.configs.sanctuary?{...this.configs.sanctuary}:null}:{realWorld:null,innerWorld:null,sanctuary:null}}async updateWorldAPI(e,t){try{this.configs||await this.loadConfigs(),this.configs&&(this.configs[e]=t,await this.saveConfigs(this.configs),console.log(`[API Config Service] 已更新 ${e} 的 API 配置`))}catch(t){throw console.error(`[API Config Service] 更新 ${e} 的 API 配置失败:`,t),t}}switchToRealWorld(){this.currentWorld='realWorld',console.log('[API Config Service] 已切换到现实世界 API')}switchToInnerWorld(){this.currentWorld='innerWorld',console.log('[API Config Service] 已切换到里世界 API')}switchToSanctuary(){this.currentWorld='sanctuary',console.log('[API Config Service] 已切换到归所 API')}getCurrentWorld(){return this.currentWorld}async testConnection(e){const t=this.currentWorld;try{console.log(`[API Config Service] 开始测试 ${e} 的 API 配置...`),'realWorld'===e?this.switchToRealWorld():'innerWorld'===e?this.switchToInnerWorld():'sanctuary'===e&&this.switchToSanctuary();const t=await generateRaw({ordered_prompts:[{role:'user',content:'你好，这是一个测试消息。请简单回复"测试成功"。'}]});return t&&t.length>0?(console.log('[API Config Service] API 连接测试成功'),{success:!0,message:'API 连接成功！'}):(console.warn('[API Config Service] API 返回空响应'),{success:!1,message:'API 返回空响应'})}catch(e){return console.error('[API Config Service] API 连接测试失败:',e),{success:!1,message:`连接失败: ${e instanceof Error?e.message:'未知错误'}`}}finally{console.log(`[API Config Service] 恢复 API 上下文到: ${t}`),'realWorld'===t?this.switchToRealWorld():'innerWorld'===t?this.switchToInnerWorld():'sanctuary'===t&&this.switchToSanctuary()}}validateConfig(e){const t=[];e.apiurl&&''!==e.apiurl.trim()?e.apiurl.startsWith('http://')||e.apiurl.startsWith('https://')||t.push('API 地址必须以 http:// 或 https:// 开头'):t.push('API 地址不能为空');return e.apiurl.includes('localhost')||e.apiurl.includes('127.0.0.1')||e.key&&''!==e.key.trim()||t.push('API 密钥不能为空（使用本地后端时可留空）'),e.model&&''!==e.model.trim()||t.push('模型名称不能为空'),(e.temperature<0||e.temperature>2)&&t.push('温度参数必须在 0-2 之间'),e.max_tokens<=0&&t.push('最大 token 数必须大于 0'),{valid:0===t.length,errors:t}}async resetConfigs(){try{const e={realWorld:null,innerWorld:null,sanctuary:null};await this.saveConfigs(e),console.log('[API Config Service] 配置已重置为默认值'),toastr.success('API 配置已重置')}catch(e){throw console.error('[API Config Service] 重置配置失败:',e),toastr.error('重置配置失败'),e}}}},605:(e,t,a)=>{a.d(t,{useGameStore:()=>i});var o=a(15);const n=_;var r=a.n(n),l=a(35),s=a(61),c=a(428);const i=(0,l.defineStore)('game',()=>{const e=(0,s.ref)(!1),t=(0,s.ref)('main'),n=(0,s.ref)(void 0),l=(0,s.ref)(void 0),i=(0,s.ref)({background:'',sprites:[],areaId:void 0,description:void 0}),u=(0,s.ref)(!1),d=(0,s.ref)(''),m=(0,s.ref)(null),v=(0,s.ref)(null),p=(0,s.computed)(()=>'combat'===t.value),g=(0,s.computed)(()=>'sanctuary'===t.value),h=(0,s.computed)(()=>'creation'===t.value),f=(0,s.computed)(()=>'main'===t.value);function y(e){i.value={...i.value,...e},console.log('[Game Store] 场景数据已更新:',i.value)}async function S(e){try{if(n.value=e||void 0,e){await c.mvuService.setCurrentInstance(e);const{worldBookService:t}=await Promise.resolve().then(a.bind(a,57));await t.activateInnerWorldEntries(),console.log(`[Game Store] 当前副本设置为: ${e}`)}else{const{worldBookService:e}=await Promise.resolve().then(a.bind(a,57));await e.activateRealWorldEntries(),console.log('[Game Store] 已退出副本，返回现实世界')}}catch(e){console.error('[Game Store] 设置当前副本失败:',e),toastr.error('切换副本失败')}}async function C(e){try{l.value=e,await c.mvuService.updatePlayerLocation(e),console.log(`[Game Store] 当前区域设置为: ${e}`)}catch(e){console.error('[Game Store] 设置当前区域失败:',e),toastr.error('切换区域失败')}}function N(){u.value=!1,d.value='',m.value=null}return{initialized:e,mode:t,currentInstanceId:n,currentArea:l,currentScene:i,isStreaming:u,streamingText:d,streamingDialogue:m,finalDialogue:v,isInCombat:p,isInSanctuary:g,isInCreation:h,isInMainGame:f,initialize:async function(){if(e.value)console.log('[Game Store] 已经初始化，跳过');else try{console.log('[Game Store] 开始初始化...'),await c.mvuService.initialize();const a=await c.mvuService.loadGameData();if(t.value=a.game.mode,n.value=a.game.currentInstanceId,l.value=a.game.currentArea,n.value&&a.instances[n.value]){const e=a.instances[n.value],t=e.map.areas.get(l.value||e.map.startArea);t&&(i.value={background:t.background||'',sprites:[],areaId:t.id,description:t.description})}e.value=!0,console.log('[Game Store] 初始化完成'),function(){const a=r().debounce(async()=>{try{const e=await c.mvuService.loadGameData();e.game.mode=t.value,e.game.currentInstanceId=n.value,e.game.currentArea=l.value,await c.mvuService.saveGameData((0,o.klona)(e)),console.log('[Game Store] 自动同步到 MVU 成功')}catch(e){console.error('[Game Store] 自动同步失败:',e)}},1e3);(0,s.watchEffect)(()=>{e.value&&a()})}()}catch(e){throw console.error('[Game Store] 初始化失败:',e),toastr.error('游戏状态初始化失败'),e}},setMode:async function(e){try{t.value=e,await c.mvuService.updateGameMode(e),console.log(`[Game Store] 游戏模式切换为: ${e}`)}catch(e){console.error('[Game Store] 切换游戏模式失败:',e),toastr.error('切换游戏模式失败')}},updateScene:y,setCurrentInstance:S,setCurrentArea:C,updateStreamingDialogue:function(e){m.value=e,u.value=null!==e},setFinalDialogue:function(e){v.value=e,m.value=null,u.value=!1,console.log('[Game Store] 对话接收完成:',e)},updateStreamingText:function(e){d.value=e,u.value=e.length>0},clearStreaming:N,generateInstance:async function(e={}){try{console.log('[Game Store] 开始生成副本...',{type:e.type,difficulty:e.difficulty,areaCount:e.areaCount,npcCount:e.npcs?.length,hasCustomPrompt:!!e.customPrompt}),toastr.info('正在生成副本...');const{useInstanceStore:t}=await Promise.resolve().then(a.bind(a,371)),o=t(),n=`instance_${Date.now()}`,r=['恐怖','修仙','现代','科幻','奇幻','武侠','末日','推理'],l=e.type||r[Math.floor(Math.random()*r.length)],s=e.difficulty||Math.floor(5*Math.random())+1,c=e.areaCount||Math.floor(6*Math.random())+5;console.log('[Game Store] 副本参数:',{instanceId:n,type:l,difficulty:s,areaCount:c});let i=[];if(e.npcs)i=e.npcs.map(e=>({characterId:e.id,character:e.character,isImportant:(e.importance||0)>=3,importance:e.importance,source:e.source,appearanceCount:0})),console.log(`[Game Store] 使用提供的 ${i.length} 个 NPC`);else try{const{npcGenerationCoordinator:e}=await Promise.resolve().then(a.bind(a,976)),t=e.calculateNPCCount(s);console.log(`[Game Store] 将生成 ${t} 个 NPC`),toastr.info(`正在生成 ${t} 个 NPC...`);i=(await e.generateRandomNPCs(t,l,void 0,(e,t)=>{console.log(`[Game Store] NPC 生成进度: ${e}/${t}`),toastr.info(`正在生成第 ${e}/${t} 个 NPC...`,'副本生成',{timeOut:800,extendedTimeOut:0})})).map(e=>{const t=Math.floor(3*Math.random())+1;return{characterId:e.id,character:e,isImportant:t>=3,importance:t,appearanceCount:0}}),console.log(`[Game Store] ✅ 成功生成 ${i.length} 个 NPC`),toastr.success(`成功生成 ${i.length} 个 NPC`,'副本生成',{timeOut:2e3})}catch(e){console.error('[Game Store] NPC 生成失败:',e),toastr.warning('NPC 生成失败，将创建不含 NPC 的副本'),i=[]}let u='';const d=i.filter(e=>(e.importance||0)>=3);d.length>0&&(u='\n\n重要 NPC 信息（请为这些 NPC 生成相关地点）：\n',d.forEach(e=>{u+=`- ${e.character.name}（重要程度：${e.importance}/5）：${e.character.occupation||'未知职业'}，${e.character.background||'无背景描述'}\n`}),console.log(`[Game Store] 包含 ${d.length} 个重要 NPC`));let m='';m=e.customPrompt?`请生成一个无限流副本，要求如下：\n${e.customPrompt}\n\n副本难度：${s}/5\n地图区域数量：${c}${u}\n\n请按照以下 YAML 格式输出副本信息：\n\`\`\`yaml\nname: 副本名称\ntype: ${l}\ndifficulty: ${s}\nworldSetting: 世界观与背景描述（详细描述这个副本的世界设定、规则、氛围等）\nmap:\n  startArea: 起始区域ID\n  areas:\n    - id: area_1\n      name: 区域名称\n      description: 区域描述\n      background: 背景图片URL（可选，使用 GitHub 链接）\n      connectedAreas: [area_2, area_3]\n      isDangerous: false\n      relatedNPCs: [npc_id_1, npc_id_2]  # 可选，与该区域相关的重要 NPC ID\n  connections:\n    - from: area_1\n      to: area_2\n\`\`\``:`请生成一个${l}类型的无限流副本，难度为 ${s}/5。\n\n副本要求：\n- 地图包含 ${c} 个区域\n- 每个区域都有独特的名称和描述\n- 区域之间有合理的连接关系\n- 起始区域应该相对安全\n- 难度越高，危险区域越多${u?'\n- 为重要 NPC 生成相关地点（如住所、工作地点等）':''}${u}\n\n请按照以下 YAML 格式输出副本信息：\n\`\`\`yaml\nname: 副本名称\ntype: ${l}\ndifficulty: ${s}\nworldSetting: 世界观与背景描述（详细描述这个副本的世界设定、规则、氛围等）\nmap:\n  startArea: 起始区域ID\n  areas:\n    - id: area_1\n      name: 区域名称\n      description: 区域描述\n      background: 背景图片URL（可选，使用 GitHub 链接）\n      connectedAreas: [area_2, area_3]\n      isDangerous: false\n      relatedNPCs: [npc_id_1, npc_id_2]  # 可选，与该区域相关的重要 NPC ID\n  connections:\n    - from: area_1\n      to: area_2\n\`\`\``,console.log('[Game Store] 调用 AI 生成副本地图 (静默模式)'),toastr.info('正在生成副本地图...','副本生成');const v=await generate({user_input:m,should_stream:!1});console.log('[Game Store] AI 生成完成，开始解析副本数据');const p=v.match(/```yaml\n([\s\S]*?)\n```/);if(!p)throw console.error('[Game Store] 未找到有效的 YAML 格式副本数据'),new Error('未找到有效的 YAML 格式副本数据');const g=(await Promise.resolve().then(a.t.bind(a,856,23))).default.parse(p[1]);console.log('[Game Store] 副本数据解析成功:',{name:g.name,areaCount:g.map?.areas?.length});const h=new Map;g.map?.areas&&g.map.areas.forEach(e=>{h.set(e.id,{...e,isDiscovered:e.id===g.map.startArea,relatedNPCs:e.relatedNPCs||[]})});const f={id:n,name:g.name||`${l}副本`,type:l,difficulty:s,worldSetting:g.worldSetting||'',map:{areas:h,connections:g.map?.connections||[],playerLocation:g.map?.startArea||'area_1',startArea:g.map?.startArea||'area_1'},characters:i,events:[],mementos:[],status:'draft',startTime:Date.now(),isActive:!0,customPrompt:e.customPrompt};console.log('[Game Store] 保存副本到 instanceStore 和全局变量'),await o.addInstance(f),console.log('[Game Store] 副本已保存到全局变量:',{instanceId:n,name:f.name,areaCount:h.size}),await S(n),await C(f.map.startArea);const N=h.get(f.map.startArea);return N&&y({background:N.background||'',sprites:[],areaId:N.id,description:N.description}),console.log('[Game Store] ✅ 副本生成成功:',{instanceId:n,name:f.name,type:l,difficulty:s,areaCount:h.size,npcCount:i.length}),toastr.success(`副本「${f.name}」生成成功！`,'副本生成'),n}catch(e){throw console.error('[Game Store] 生成副本失败:',{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),toastr.error('生成副本失败，请重试','副本生成'),e}},reset:function(){e.value=!1,t.value='main',n.value=void 0,l.value=void 0,i.value={background:'',sprites:[],areaId:void 0,description:void 0},N(),console.log('[Game Store] 游戏状态已重置')}}})},632:e=>{e.exports=toastr},665:(e,t,a)=>{function o(){return Math.floor(100*Math.random())+1}function n(e,t){return 1===e?'critical_success':100===e||e>=96&&t<50?'critical_failure':e<=t/5?'extreme_success':e<=t/2?'hard_success':e<=t?'success':'failure'}function r(e,t){const a=o();return{roll:a,skill:t,result:n(a,t),skillName:e,timestamp:Date.now()}}function l(e){const{STR:t,DEX:a,SIZ:o}=e;return t<o&&a<o?7:(t>=o||a>=o)&&t<2*o&&a<2*o?8:t>=2*o&&a>=2*o?9:8}function s(e){const t=e.STR+e.SIZ;return t<=64?{DB:'-2',BUILD:-2}:t<=84?{DB:'-1',BUILD:-1}:t<=124?{DB:'0',BUILD:0}:t<=164?{DB:'+1d4',BUILD:1}:t<=204?{DB:'+1d6',BUILD:2}:t<=284?{DB:'+2d6',BUILD:3}:t<=364?{DB:'+3d6',BUILD:4}:t<=444?{DB:'+4d6',BUILD:5}:{DB:'+5d6',BUILD:6}}function c(e){const{CON:t,SIZ:a,POW:o}=e,n=Math.floor((t+a)/10),r=Math.floor(o/5),c=o,i=l(e),{DB:u,BUILD:d}=s(e);return{HP:n,maxHP:n,MP:r,maxMP:r,SAN:c,maxSAN:c,MOV:i,DB:u,BUILD:d}}function i(e='3d6x5'){const t=()=>{if('3d6x5'===e){return 5*(Math.floor(6*Math.random())+1+(Math.floor(6*Math.random())+1)+(Math.floor(6*Math.random())+1))}return 5*(Math.floor(6*Math.random())+1+(Math.floor(6*Math.random())+1)+6)};return{STR:t(),CON:t(),SIZ:t(),DEX:t(),APP:t(),INT:t(),POW:t(),EDU:t(),LUK:t()}}function u(e,t){const a=r('攻击',e),o=r('防御',t),n={critical_success:5,extreme_success:4,hard_success:3,success:2,failure:1,critical_failure:0},l=n[a.result],s=n[o.result];let c;return c=l>s?'attacker_wins':s>l?'defender_wins':'tie',{result:c,attackerRoll:a,defenderRoll:o}}function d(e,t=0){return Math.max(0,e-t)}function m(e,t){const a=e-t;return t>=5?{isInsane:!0,type:'temporary'}:a<=0?{isInsane:!0,type:'permanent'}:a<20?{isInsane:!0,type:'indefinite'}:{isInsane:!1}}function v(e){return{critical_success:'大成功',extreme_success:'极难成功',hard_success:'困难成功',success:'成功',failure:'失败',critical_failure:'大失败'}[e]}a.d(t,{ST:()=>d,VW:()=>r,calculateDerivedStats:()=>c,generateRandomAttributes:()=>i,iy:()=>u,jj:()=>n,jp:()=>s,oA:()=>m,q7:()=>l,yD:()=>v,zP:()=>o})},707:e=>{e.exports=z},747:(e,t,a)=>{a.d(t,{SZ:()=>i});var o=a(588);const n={PREFIX:'[API Context]',SLOW_THRESHOLD:1e3,DEBUG_MODE:!1};var r;!function(e){e.SWITCH='切换',e.RESTORE='恢复',e.COMPLETE='完成',e.FAILED='失败',e.SKIP='跳过',e.ENTER='进入',e.EXIT='退出'}(r||(r={}));const l=new class{logSwitchStart(e,t,a){console.log(`${n.PREFIX} L${e}: ${r.SWITCH} ${t} → ${a}`),n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: 开始切换到 ${a}`)}logSwitchComplete(e,t){console.log(`${n.PREFIX} L${e}: ${r.COMPLETE} 切换，当前世界: ${t}`),n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: 切换完成，配置已应用`)}logSkipSwitch(e,t){console.log(`${n.PREFIX} L${e}: ${r.SKIP} 切换，已在目标世界 ${t}`),n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: 优化：跳过不必要的切换`)}logRestoreStart(e,t,a){console.log(`${n.PREFIX} L${e}: ${r.RESTORE} ${t} → ${a}`),n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: 开始恢复到 ${a}`)}logRestoreComplete(e,t){console.log(`${n.PREFIX} L${e}: ${r.COMPLETE} 恢复，当前世界: ${t}`),n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: 恢复完成，配置已应用`)}logEnter(e,t,a){console.log(`${n.PREFIX} L${e}: ${r.ENTER} 上下文 ${t} → ${a}`),n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: 上下文栈深度: ${e}`)}logExit(e,t,a){console.log(`${n.PREFIX} L${e}: ${r.EXIT} 上下文 ${t} → ${a}`),n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: 上下文栈深度: ${e-1}`)}logCallbackSuccess(e,t){const a=t>n.SLOW_THRESHOLD,o=a?' ⚠️ 慢操作':'';console.log(`${n.PREFIX} L${e}: ${r.COMPLETE} 回调执行 (耗时: ${t.toFixed(2)}ms)${o}`),n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: 性能统计 - 执行时长: ${t.toFixed(2)}ms`),a&&console.warn(`${n.PREFIX} L${e}: 检测到慢操作，耗时 ${t.toFixed(2)}ms 超过阈值 ${n.SLOW_THRESHOLD}ms`)}logCallbackError(e,t,a){console.error(`${n.PREFIX} L${e}: ${r.FAILED} 回调执行 (耗时: ${t.toFixed(2)}ms):`,a),a instanceof Error&&a.stack&&console.error(`${n.PREFIX} L${e}: 错误堆栈:`,a.stack),n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: 错误详情:`,{name:a instanceof Error?a.name:'Unknown',message:a instanceof Error?a.message:String(a),duration:`${t.toFixed(2)}ms`})}logCriticalError(e,t,a){console.error(`${n.PREFIX} L${e}: [严重错误] ${t}`,a||''),a instanceof Error&&a.stack&&console.error(`${n.PREFIX} L${e}: 错误堆栈:`,a.stack),n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: 严重错误详情:`,{message:t,error:a instanceof Error?a.message:String(a)})}logWarning(e,t,a){console.warn(`${n.PREFIX} L${e}: ${t}`,a||''),n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: 警告详情:`,a)}logDebug(e,t,a){n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] L${e}: ${t}`,a||'')}logStackState(e){n.DEBUG_MODE&&console.debug(`${n.PREFIX} [DEBUG] 上下文栈状态:`,{depth:e.length,stack:[...e]})}};function s(e){try{switch(e){case'realWorld':o.apiConfigService.switchToRealWorld();break;case'innerWorld':o.apiConfigService.switchToInnerWorld();break;case'sanctuary':o.apiConfigService.switchToSanctuary()}}catch(t){throw console.error(`${n.PREFIX} 切换到 ${e} 失败:`,t),toastr.error(`无法切换到 ${e} API，请检查 API 配置`),t}}const c=new class{contextStack=[];async withContext(e,t){const a=function(){try{return o.apiConfigService.getCurrentWorld()}catch(e){return console.warn(`${n.PREFIX} 获取当前世界失败，使用默认值 realWorld:`,e),toastr.warning('无法获取当前 API 配置，使用默认配置'),'realWorld'}}();this.contextStack.push(a);const r=this.contextStack.length;if(l.logStackState(this.contextStack),a===e&&1===r){l.logSkipSwitch(r,e);const a=performance.now();try{const e=await t(),o=performance.now()-a;return l.logCallbackSuccess(r,o),e}catch(e){const t=performance.now()-a;throw l.logCallbackError(r,t,e),e}finally{this.contextStack.pop(),l.logStackState(this.contextStack)}}l.logEnter(r,a,e);const c=performance.now();try{l.logSwitchStart(r,a,e),s(e),l.logSwitchComplete(r,e),l.logDebug(r,'配置已应用',{targetWorld:e,currentConfig:o.apiConfigService.getCurrentWorld()});const n=await t(),i=performance.now()-c;return l.logCallbackSuccess(r,i),n}catch(e){const t=performance.now()-c;throw l.logCallbackError(r,t,e),e}finally{const t=this.contextStack.pop();if(t){l.logExit(r,e,t);try{l.logRestoreStart(r,e,t),s(t),l.logRestoreComplete(r,t),l.logDebug(r,'恢复配置已应用',{restoreWorld:t,currentConfig:o.apiConfigService.getCurrentWorld()})}catch(e){l.logCriticalError(r,`恢复到 ${t} 失败`,e);try{l.logWarning(r,'尝试恢复到默认世界 realWorld'),s('realWorld'),l.logRestoreComplete(r,'realWorld'),toastr.warning('API 上下文恢复失败，已切换到默认配置')}catch(e){l.logCriticalError(r,'无法恢复到默认世界',e),toastr.error('API 上下文恢复失败，请刷新页面')}}}else l.logCriticalError(r,'上下文栈为空，无法恢复！');l.logStackState(this.contextStack)}}getStackDepth(){return this.contextStack.length}};const i=c.withContext.bind(c)},820:(e,t,a)=>{a.d(t,{sanctuaryService:()=>r});var o=a(15),n=a(863);const r=new class{initialized=!1;async initialize(){if(this.initialized)return void console.log('[SanctuaryService] 服务已初始化');console.log('[SanctuaryService] 初始化服务...');let e=await this.getSanctuary();e||(e={backgroundImage:'default_apartment.jpg',furniture:[],mementos:[],decorations:[],conversationHistory:[]},await this.saveSanctuary(e),console.log('[SanctuaryService] 已创建默认归所')),this.initialized=!0,console.log('[SanctuaryService] 服务初始化完成')}async getSanctuary(){try{return getVariables({type:'global'}).sanctuary_data||null}catch(e){return console.error('[SanctuaryService] 获取归所数据失败:',e),null}}async saveSanctuary(e){try{const t=(0,o.klona)(e);insertOrAssignVariables({sanctuary_data:t},{type:'global'}),console.log('[SanctuaryService] 归所数据已保存')}catch(e){throw console.error('[SanctuaryService] 保存归所数据失败:',e),e}}async inviteNPC(e){try{console.log('[SanctuaryService] 邀请 NPC 到归所:',e);const t=await this.getSanctuary();if(!t)throw new Error('归所数据不存在');const o={id:this.generateId(),npcIds:e,messages:[],startedAt:Date.now()};t.conversationHistory.push(o),await this.saveSanctuary(t);const{worldBookService:n}=await Promise.resolve().then(a.bind(a,57));await n.activateInteractionRoomEntries(),console.log('[SanctuaryService] 已切换到归所世界书'),await this.setupConversationContext(e),toastr.success(`已邀请 ${e.length} 位 NPC 到归所`)}catch(e){throw console.error('[SanctuaryService] 邀请 NPC 失败:',e),toastr.error('邀请 NPC 失败'),e}}async setupConversationContext(e){try{const t=await this.getSanctuary();if(!t)throw new Error('归所数据不存在');let a='当前场景：归所\n';a+=`环境描述：这是一个温馨的个人空间，${this.describeEnvironment(t)}\n\n`;for(const t of e){const e=await n.z.injectMemoryPrompt(t);e&&(a+=`\n--- ${t} 的记忆 ---\n`,a+=e+'\n')}injectPrompts([{id:'sanctuary_context',content:a,position:'in_chat',depth:0,role:'system'}]),console.log('[SanctuaryService] 对话上下文已设置')}catch(e){throw console.error('[SanctuaryService] 设置对话上下文失败:',e),e}}async interactWithItem(e){try{const t=await this.getSanctuary();if(!t)throw new Error('归所数据不存在');const a=this.findItem(t,e);if(!a)return'找不到该物品';console.log('[SanctuaryService] 与物品互动:',a.name);const o=await withAPIContext('sanctuary',async()=>{const e=`玩家正在与归所中的「${a.name}」互动。请生成一段简短的互动描述。`;return await generateRaw({ordered_prompts:[{role:'user',content:e}]})});return console.log('[SanctuaryService] 物品互动描述已生成'),o}catch(e){return console.error('[SanctuaryService] 与物品互动失败:',e),'互动失败，请稍后再试'}}async addMemento(e,t){try{const a=await this.getSanctuary();if(!a)throw new Error('归所数据不存在');a.mementos.push({mementoId:e.id,position:t,scale:1}),await this.saveSanctuary(a),toastr.success(`「${e.name}」已添加到归所`),console.log('[SanctuaryService] 纪念品已添加:',e.name)}catch(e){throw console.error('[SanctuaryService] 添加纪念品失败:',e),toastr.error('添加纪念品失败'),e}}describeEnvironment(e){const t=[];return t.push(...e.furniture.map(e=>e.name)),t.push(...e.mementos.map(e=>`纪念品「${e.mementoId}」`)),0===t.length?'空间还很空旷，等待着被装饰':`摆放着${t.slice(0,3).join('、')}${t.length>3?'等物品':''}`}findItem(e,t){const a=e.furniture.find(e=>e.id===t);if(a)return{name:a.name};const o=e.mementos.find(e=>e.mementoId===t);return o?{name:o.mementoId}:null}async saveConversation(e,t){try{const a=await this.getSanctuary();if(!a)throw new Error('归所数据不存在');const o=[...e].sort(),n=a.conversationHistory.find(e=>{const t=[...e.npcIds].sort();return JSON.stringify(t)===JSON.stringify(o)});if(n)n.messages=t,n.endedAt=Date.now(),console.log('[SanctuaryService] 已更新对话记录:',n.id);else{const o={id:this.generateId(),npcIds:e,messages:t,startedAt:Date.now(),endedAt:Date.now()};a.conversationHistory.push(o),console.log('[SanctuaryService] 已创建新对话记录:',o.id)}await this.saveSanctuary(a),console.log('[SanctuaryService] 对话历史已保存')}catch(e){throw console.error('[SanctuaryService] 保存对话失败:',e),e}}async getConversationHistory(e){try{const t=await this.getSanctuary();if(!t)return null;const a=[...e].sort(),o=t.conversationHistory.find(e=>{const t=[...e.npcIds].sort();return JSON.stringify(t)===JSON.stringify(a)});return o?console.log('[SanctuaryService] 找到对话历史:',o.id,'消息数:',o.messages.length):console.log('[SanctuaryService] 未找到对话历史'),o||null}catch(e){return console.error('[SanctuaryService] 获取对话历史失败:',e),null}}async exitSanctuary(){try{console.log('[SanctuaryService] 退出归所...');const{worldBookService:e}=await Promise.resolve().then(a.bind(a,57));await e.activateRealWorldEntries(),console.log('[SanctuaryService] 已切换回现实世界世界书'),toastr.success('已返回现实世界')}catch(e){throw console.error('[SanctuaryService] 退出归所失败:',e),toastr.error('退出归所失败'),e}}generateId(){return`sanctuary_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}}},827:(e,t,a)=>{a.d(t,{formatZodError:()=>o});a(632),a(707);function o(e){return`数据验证错误:\n${e.issues.map(e=>`  - ${e.path.join('.')||'根对象'}: ${e.message}`).join('\n')}`}},853:(e,t,a)=>{a.d(t,{gameResetService:()=>n});var o=a(202);const n=new class{async clearMVUVariables(){try{console.log('[GameResetService] 开始清空 MVU 变量...'),await waitGlobalInitialized('Mvu');const e={initialized_lorebooks:[],stat_data:{},display_data:{},delta_data:{}};let t=0;try{const a=Mvu.getMvuData({type:'message',message_id:0});a&&Object.keys(a.stat_data||{}).length>0&&(await Mvu.replaceMvuData(e,{type:'message',message_id:0}),t++,console.log('[GameResetService] 已清空第 0 楼的 MVU 变量'))}catch(e){console.warn('[GameResetService] 清空第 0 楼的 MVU 变量失败:',e)}try{const a=getChatMessages('0-{{lastMessageId}}');console.log(`[GameResetService] 找到 ${a.length} 条其他消息`);for(const o of a){const a=o.message_id;try{const o=Mvu.getMvuData({type:'message',message_id:a});o&&Object.keys(o.stat_data||{}).length>0&&(await Mvu.replaceMvuData(e,{type:'message',message_id:a}),t++,console.log(`[GameResetService] 已清空第 ${a} 楼的 MVU 变量`))}catch(e){console.warn(`[GameResetService] 清空第 ${a} 楼的 MVU 变量失败:`,e)}}}catch(e){console.log('[GameResetService] 获取消息列表失败（可能在第 0 楼）:',e)}console.log(`[GameResetService] ✅ MVU 变量清空完成，共清空 ${t} 个楼层`)}catch(e){throw console.error('[GameResetService] ❌ 清空 MVU 变量失败:',e),new Error(`清空 MVU 变量失败: ${e.message}`)}}async clearGlobalVariables(){try{console.log('[GameResetService] 开始清空全局变量...');const e=getVariables({type:'global'}),t=Object.keys(e);console.log(`[GameResetService] 找到 ${t.length} 个全局变量:`,t),replaceVariables({},{type:'global'}),console.log(`[GameResetService] ✅ 全局变量清空完成，共清空 ${t.length} 个变量`)}catch(e){throw console.error('[GameResetService] ❌ 清空全局变量失败:',e),new Error(`清空全局变量失败: ${e.message}`)}}async clearChatVariables(){try{console.log('[GameResetService] 开始清空聊天变量...');const e=getVariables({type:'chat'}),t=Object.keys(e);console.log(`[GameResetService] 找到 ${t.length} 个聊天变量:`,t),replaceVariables({},{type:'chat'}),console.log(`[GameResetService] ✅ 聊天变量清空完成，共清空 ${t.length} 个变量`)}catch(e){throw console.error('[GameResetService] ❌ 清空聊天变量失败:',e),new Error(`清空聊天变量失败: ${e.message}`)}}async clearInventory(){try{console.log('[GameResetService] 开始清空背包...');const e=(0,o.useInventoryStore)(),t=e.realWorldInventory.items.length,a=e.instanceInventory.items.length;console.log(`[GameResetService] 现实世界背包物品数: ${t}`),console.log(`[GameResetService] 副本背包物品数: ${a}`),e.reset(),await e.saveToGlobal(),console.log(`[GameResetService] ✅ 背包清空完成，共清空 ${t+a} 个物品`)}catch(e){throw console.error('[GameResetService] ❌ 清空背包失败:',e),new Error(`清空背包失败: ${e.message}`)}}async clearProtagonistInfo(){try{console.log('[GameResetService] 开始清除主控角色信息...');const e=getVariables({type:'global'}),t=e.player_name,o=e.player_description;console.log('[GameResetService] 当前主控信息:',{player_name:t,player_description:o?`${o.substring(0,50)}...`:void 0}),void 0!==e.player_name?(delete e.player_name,console.log('[GameResetService] ✅ 已删除 player_name 字段:',t)):console.log('[GameResetService] player_name 字段不存在，跳过'),void 0!==e.player_description?(delete e.player_description,console.log('[GameResetService] ✅ 已删除 player_description 字段，长度:',o?.length||0)):console.log('[GameResetService] player_description 字段不存在，跳过'),replaceVariables(e,{type:'global'}),console.log('[GameResetService] ✅ 全局变量已更新'),console.log('[GameResetService] 开始重置角色信息拦截器...');const{characterInitializer:n}=await Promise.resolve().then(a.bind(a,391));n.resetInterceptor(),console.log('[GameResetService] ✅ 角色信息拦截器已重置'),console.log('[GameResetService] ✅✅✅ 主控角色信息清除完成')}catch(e){throw console.error('[GameResetService] ❌ 清除主控角色信息失败:',{error:e.message,stack:e.stack}),new Error(`清除主控角色信息失败: ${e.message}`)}}async resetAPIConfiguration(){try{console.log('[GameResetService] 开始重置 API 配置...');const e=getVariables({type:'global'});e.api_config?(console.log('[GameResetService] 发现自定义 API 配置，准备清空'),delete e.api_config,replaceVariables(e,{type:'global'}),console.log('[GameResetService] ✅ API 配置已重置为酒馆默认')):console.log('[GameResetService] 未发现自定义 API 配置，无需重置')}catch(e){throw console.error('[GameResetService] ❌ 重置 API 配置失败:',e),new Error(`重置 API 配置失败: ${e.message}`)}}async clearAllGameData(){console.log('[GameResetService] ========== 开始清空所有游戏数据 ==========');const e=[],t=[];try{await this.clearProtagonistInfo(),t.push({operation:'主控信息',success:!0})}catch(a){e.push({operation:'主控信息',error:a}),t.push({operation:'主控信息',success:!1}),console.error('[GameResetService] 清除主控信息失败:',a)}try{await this.clearMVUVariables(),t.push({operation:'MVU 变量',success:!0})}catch(a){e.push({operation:'MVU 变量',error:a}),t.push({operation:'MVU 变量',success:!1}),console.error('[GameResetService] 清空 MVU 变量失败:',a)}try{await this.clearGlobalVariables(),t.push({operation:'全局变量',success:!0})}catch(a){e.push({operation:'全局变量',error:a}),t.push({operation:'全局变量',success:!1}),console.error('[GameResetService] 清空全局变量失败:',a)}try{await this.clearChatVariables(),t.push({operation:'聊天变量',success:!0})}catch(a){e.push({operation:'聊天变量',error:a}),t.push({operation:'聊天变量',success:!1}),console.error('[GameResetService] 清空聊天变量失败:',a)}try{await this.clearInventory(),t.push({operation:'背包',success:!0})}catch(a){e.push({operation:'背包',error:a}),t.push({operation:'背包',success:!1}),console.error('[GameResetService] 清空背包失败:',a)}if(console.log('[GameResetService] ========== 清空操作完成 =========='),console.log('[GameResetService] 操作结果:'),t.forEach(e=>{const t=e.success?'✅ 成功':'❌ 失败';console.log(`[GameResetService]   ${e.operation}: ${t}`)}),e.length>0){const t=e.map(e=>`${e.operation}: ${e.error.message}`).join('\n');console.error('[GameResetService] 部分数据清空失败:\n',t),toastr.warning(`部分数据清空失败:\n${t}`)}else console.log('[GameResetService] ✅✅✅ 所有游戏数据已成功清空'),toastr.success('所有游戏数据已清空');console.log('[GameResetService] ========================================')}}},856:e=>{e.exports=YAML},863:(e,t,a)=>{a.d(t,{z:()=>n});var o=a(15);const n=new class{initialized=!1;listening=!1;async initialize(){if(this.initialized)return void console.log('[MemoryFragmentService] 服务已初始化');console.log('[MemoryFragmentService] 初始化服务...');await this.getAllArchives()||await this.saveArchives([]),this.initialized=!0,console.log('[MemoryFragmentService] 服务初始化完成')}startListening(){this.listening?console.log('[MemoryFragmentService] 已在监听中'):(console.log('[MemoryFragmentService] 开始监听 AI 输出...'),eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY,async(e,t)=>{try{const t=e||'';await this.captureMemoryEvents(t)}catch(e){console.error('[MemoryFragmentService] 捕获记忆事件失败:',e)}}),this.listening=!0,console.log('[MemoryFragmentService] 监听已启动'))}async captureMemoryEvents(e){const t=/\[memory_event\s+type="(positive|negative|neutral)"\s+target="([^"]+)"\](.*?)\[\/memory_event\]/g;let a,o=0;for(;null!==(a=t.exec(e));){const[,e,t,n]=a,r={id:this.generateId(),description:n.trim(),type:e,timestamp:Date.now(),sourceInstance:await this.getCurrentInstanceId()};await this.addMemoryToNPC(t,r),o++}o>0&&console.log(`[MemoryFragmentService] 捕获了 ${o} 个记忆事件`)}async addMemoryToNPC(e,t){const a=await this.getAllArchives();let o=a.find(t=>t.npcId===e);o||(o={npcId:e,npcName:await this.getNPCName(e),relationshipScore:0,memories:[],lastInteraction:Date.now()},a.push(o)),o.memories.push(t),o.lastInteraction=Date.now(),'positive'===t.type?o.relationshipScore=Math.min(100,o.relationshipScore+5):'negative'===t.type&&(o.relationshipScore=Math.max(-100,o.relationshipScore-5)),await this.saveArchives(a),console.log(`[MemoryFragmentService] 为 NPC ${o.npcName} 添加了 ${t.type} 记忆，关系分数: ${o.relationshipScore}`)}async getAllArchives(){try{const e=getVariables({type:'global'}).npc_memory_archives;return Array.isArray(e)?e:[]}catch(e){return console.error('[MemoryFragmentService] 获取记忆档案失败:',e),[]}}async getArchive(e){return(await this.getAllArchives()).find(t=>t.npcId===e)||null}async saveArchives(e){try{const t=(0,o.klona)(e);await insertOrAssignVariables({npc_memory_archives:t},{type:'global'})}catch(e){throw console.error('[MemoryFragmentService] 保存记忆档案失败:',e),e}}async getCurrentInstanceId(){try{return getVariables({type:'global'}).current_instance_id||'unknown'}catch(e){return console.error('[MemoryFragmentService] 获取当前副本 ID 失败:',e),'unknown'}}async getNPCName(e){try{const t=getVariables({type:'global'}).instances||[];for(const a of Array.isArray(t)?t:[]){const t=a.characters?.find(t=>t.characterId===e);if(t)return t.character?.name||e}return e}catch(t){return console.error('[MemoryFragmentService] 获取 NPC 名称失败:',t),e}}async injectMemoryPrompt(e){const t=await this.getArchive(e);if(!t||0===t.memories.length)return'';const a=[...t.memories].sort((e,t)=>t.timestamp-e.timestamp).slice(0,5);let o='你记得你们之间的这些经历：\n';for(const e of a)o+=`- ${e.description}\n`;return o+=`\n当前关系状态：${this.getRelationshipDescription(t.relationshipScore)}`,o+='\n请基于这些具体记忆做出真实、微妙的反应，而不是机械地提及好感度数字。',o}getRelationshipDescription(e){return e>70?'非常亲密':e>40?'友好':e>10?'熟悉':e>-10?'普通':e>-40?'疏远':e>-70?'冷淡':'敌对'}generateId(){return`memory_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}}},877:(e,t,a)=>{a.d(t,{n:()=>n});var o=a(665);const n=new class{async generateRandom(e){try{console.log('[NPC Generation Service] 开始随机生成 NPC...');let t,a='请生成一个 NPC 角色，包含以下信息：\n\n';e&&(a+=`副本类型：${e}\n`,a+=`请生成一个符合${e}主题的 NPC。\n\n`),a+='请按照以下 JSON 格式输出：\n```json\n{\n  "name": "角色姓名",\n  "age": 年龄（数字）,\n  "occupation": "职业",\n  "background": "背景故事（100-200字）",\n  "personality": "性格特点（50-100字）",\n  "relationship": "与主控角色的关系（可选）"\n}\n```\n\n要求：\n- 姓名要符合主题设定\n- 年龄要合理\n- 职业要有特色\n- 背景故事要有深度\n- 性格要鲜明';try{t=await generate({user_input:a,should_stream:!1})}catch(e){throw console.error('[NPC Generation Service] AI 服务调用失败:',e),new Error('AI 服务不可用，请检查网络连接或稍后重试')}const o=t.match(/```json\n([\s\S]*?)\n```/);if(!o)throw console.error('[NPC Generation Service] AI 返回的数据格式错误:',t),new Error('AI 返回的数据格式错误，请重试');let n;try{n=JSON.parse(o[1])}catch(e){throw console.error('[NPC Generation Service] JSON 解析失败:',e),new Error('AI 返回的 JSON 格式无效，请重试')}if(!n.name||!n.occupation)throw console.error('[NPC Generation Service] NPC 数据缺少必需字段:',n),new Error('AI 返回的 NPC 数据不完整，请重试');const r=await this.enhanceWithCharacterSystem({name:n.name,age:n.age,occupation:n.occupation,background:n.background,personality:n.personality});return n.relationship&&(r.relationship=n.relationship),console.log('[NPC Generation Service] NPC 生成成功:',r.name),r}catch(e){throw console.error('[NPC Generation Service] 随机生成 NPC 失败:',e),e}}async generateCustom(e,t){try{console.log('[NPC Generation Service] 开始生成自定义 NPC...');let a,o=`请根据以下描述生成一个 NPC 角色：\n\n${e}\n\n`;t&&(o+=`副本类型：${t}\n`),o+='请按照以下 JSON 格式输出：\n```json\n{\n  "name": "角色姓名",\n  "age": 年龄（数字）,\n  "occupation": "职业",\n  "background": "背景故事（100-200字）",\n  "personality": "性格特点（50-100字）",\n  "relationship": "与主控角色的关系（可选）"\n}\n```\n\n要求：\n- 严格按照用户描述生成\n- 补充合理的细节\n- 背景故事要有深度\n- 性格要鲜明';try{a=await generate({user_input:o,should_stream:!1})}catch(e){throw console.error('[NPC Generation Service] AI 服务调用失败:',e),new Error('AI 服务不可用，请检查网络连接或稍后重试')}const n=a.match(/```json\n([\s\S]*?)\n```/);if(!n)throw console.error('[NPC Generation Service] AI 返回的数据格式错误:',a),new Error('AI 返回的数据格式错误，请重试');let r;try{r=JSON.parse(n[1])}catch(e){throw console.error('[NPC Generation Service] JSON 解析失败:',e),new Error('AI 返回的 JSON 格式无效，请重试')}if(!r.name||!r.occupation)throw console.error('[NPC Generation Service] NPC 数据缺少必需字段:',r),new Error('AI 返回的 NPC 数据不完整，请重试');const l=await this.enhanceWithCharacterSystem({name:r.name,age:r.age,occupation:r.occupation,background:r.background,personality:r.personality});return r.relationship&&(l.relationship=r.relationship),console.log('[NPC Generation Service] 自定义 NPC 生成成功:',l.name),l}catch(e){throw console.error('[NPC Generation Service] 生成自定义 NPC 失败:',e),e}}async generateRelatedNPC(e,t){try{console.log('[NPC Generation Service] 开始生成关联NPC...');const a=t.map(e=>`- ${e.name}（${e.occupation||'未知职业'}）：${e.background?.substring(0,100)||'无背景信息'}`).join('\n');let o,n=`请生成一个与以下角色有关联的 NPC：\n\n${a}\n\n`;n+=`副本类型：${e}\n\n`,n+='请生成一个与上述角色有关联的新 NPC（如同事、家人、朋友、敌人等），确保新角色与已有角色有合理的关系。\n\n',n+=`请按照以下 JSON 格式输出：\n\`\`\`json\n{\n  "name": "角色姓名",\n  "age": 年龄（数字）,\n  "occupation": "职业",\n  "background": "背景故事（100-200字，需要说明与已有角色的关系）",\n  "personality": "性格特点（50-100字）",\n  "relationship": "与已有角色的关系描述"\n}\n\`\`\`\n\n要求：\n- 新角色必须与已有角色有明确的关系\n- 背景故事要体现这种关系\n- 性格要与关系相符\n- 符合${e}主题`;try{o=await generate({user_input:n,should_stream:!1})}catch(e){throw console.error('[NPC Generation Service] AI 服务调用失败:',e),new Error('AI 服务不可用，请检查网络连接或稍后重试')}const r=o.match(/```json\n([\s\S]*?)\n```/);if(!r)throw console.error('[NPC Generation Service] AI 返回的数据格式错误:',o),new Error('AI 返回的数据格式错误，请重试');let l;try{l=JSON.parse(r[1])}catch(e){throw console.error('[NPC Generation Service] JSON 解析失败:',e),new Error('AI 返回的 JSON 格式无效，请重试')}if(!l.name||!l.occupation)throw console.error('[NPC Generation Service] NPC 数据缺少必需字段:',l),new Error('AI 返回的 NPC 数据不完整，请重试');const s=await this.enhanceWithCharacterSystem({name:l.name,age:l.age,occupation:l.occupation,background:l.background,personality:l.personality});return s.relationship=l.relationship,console.log('[NPC Generation Service] 关联NPC生成成功:',s.name),s}catch(e){throw console.error('[NPC Generation Service] 生成关联NPC失败:',e),e}}async enhanceWithCharacterSystem(e){try{console.log('[NPC Generation Service] 使用角色创建系统完善NPC数据...');const t=(0,o.generateRandomAttributes)();console.log('[NPC Generation Service] 生成的属性:',t);const a=(0,o.calculateDerivedStats)(t);console.log('[NPC Generation Service] 计算的衍生属性:',a);const n=await this.generateSkillsForOccupation(e.occupation);console.log('[NPC Generation Service] 生成的技能数量:',n.size);const r={id:`npc_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,type:'npc',name:e.name,age:e.age,occupation:e.occupation,background:e.background,attributes:t,derivedStats:a,skills:n,bodyParts:this.generateDefaultBodyParts(),inventory:[],affection:50,isImportant:!1,events:[]};return console.log('[NPC Generation Service] NPC数据完善成功:',r.name),r}catch(e){throw console.error('[NPC Generation Service] 完善NPC数据失败:',e),new Error('完善NPC数据失败')}}async generateSkillsForOccupation(e){const t=new Map;if([{name:'侦察',value:25},{name:'聆听',value:25},{name:'图书馆使用',value:25},{name:'母语',value:80},{name:'闪避',value:Math.floor((0,o.generateRandomAttributes)().DEX/2)}].forEach(e=>{t.set(e.name,e.value)}),e)try{const a=`请为职业"${e}"生成5-8个相关的COC7技能。\n\n请按照以下JSON格式输出：\n\`\`\`json\n{\n  "skills": [\n    {"name": "技能名称", "value": 技能值（20-80之间的数字）}\n  ]\n}\n\`\`\`\n\n要求：\n- 技能要符合职业特点\n- 技能值要合理（一般在30-70之间）\n- 不要重复基础技能（侦察、聆听、图书馆使用、母语、闪避）`,o=(await generate({user_input:a,should_stream:!1})).match(/```json\n([\s\S]*?)\n```/);if(o){const e=JSON.parse(o[1]);e.skills&&Array.isArray(e.skills)&&e.skills.forEach(e=>{t.has(e.name)||t.set(e.name,e.value)})}}catch(e){console.warn('[NPC Generation Service] 生成职业技能失败，使用默认技能:',e)}return t}generateDefaultBodyParts(){return[{id:'head',name:'头部',damage:0,debuffs:[]},{id:'torso',name:'躯干',damage:0,debuffs:[]},{id:'left_arm',name:'左臂',damage:0,debuffs:[]},{id:'right_arm',name:'右臂',damage:0,debuffs:[]},{id:'left_leg',name:'左腿',damage:0,debuffs:[]},{id:'right_leg',name:'右腿',damage:0,debuffs:[]}]}}},895:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,o]of t)a[e]=o;return a}},976:(e,t,a)=>{a.d(t,{npcGenerationCoordinator:()=>l});var o,n=a(747),r=a(877);!function(e){e.AI_SERVICE_UNAVAILABLE='AI_SERVICE_UNAVAILABLE',e.PARSE_ERROR='PARSE_ERROR',e.NETWORK_ERROR='NETWORK_ERROR',e.UNKNOWN_ERROR='UNKNOWN_ERROR'}(o||(o={}));const l=new class{determineWorldType(e){return e?'sanctuary'===e||e.includes('归所')?(console.log('[NPC Generation Coordinator] 检测到归所上下文，使用 sanctuary API'),'sanctuary'):'realWorld'===e||e.includes('现实世界')||e.includes('现代')?(console.log('[NPC Generation Coordinator] 检测到现实世界上下文，使用 realWorld API'),'realWorld'):(console.log(`[NPC Generation Coordinator] 副本类型 "${e}"，使用 innerWorld API`),'innerWorld'):(console.log('[NPC Generation Coordinator] 无上下文信息，默认使用 innerWorld'),'innerWorld')}calculateNPCCount(e){(e<1||e>5)&&(console.warn('[NPC Generation Coordinator] 难度值超出范围 (1-5)，使用默认值 3'),e=3);const t=e+Math.floor(2*Math.random());return console.log(`[NPC Generation Coordinator] 难度 ${e} -> NPC 数量: ${t}`),t}classifyError(e){const t=e.message.toLowerCase();return t.includes('ai')||t.includes('service')||t.includes('unavailable')?o.AI_SERVICE_UNAVAILABLE:t.includes('parse')||t.includes('json')||t.includes('format')?o.PARSE_ERROR:t.includes('network')||t.includes('timeout')||t.includes('fetch')?o.NETWORK_ERROR:o.UNKNOWN_ERROR}getUserFriendlyErrorMessage(e){switch(e){case o.AI_SERVICE_UNAVAILABLE:return'AI 服务暂时不可用，请检查网络连接或稍后重试';case o.PARSE_ERROR:return'AI 返回的数据格式错误，请重试';case o.NETWORK_ERROR:return'网络连接失败，请检查网络设置';case o.UNKNOWN_ERROR:return'生成失败，请重试';default:return'未知错误'}}async generateBasicFallbackNPC(e){console.log('[NPC Generation Coordinator] 使用降级方案生成基础 NPC...');const{generateRandomAttributes:t,calculateDerivedStats:o}=await Promise.resolve().then(a.bind(a,665)),n=t(),r=o(n),l=['调查员','记者','医生','警察','学者','商人','艺术家','工程师'],s=l[Math.floor(Math.random()*l.length)],c=new Map;c.set('侦察',25),c.set('聆听',25),c.set('图书馆使用',25),c.set('母语',80),c.set('闪避',Math.floor(n.DEX/2));const i={id:`npc_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,type:'npc',name:`${s}${Math.floor(100*Math.random())}`,age:Math.floor(40*Math.random())+20,occupation:s,background:`一位普通的${s}，在${e}副本中遇到了不寻常的事件。`,attributes:n,derivedStats:r,skills:c,bodyParts:[{id:'head',name:'头部',damage:0,debuffs:[]},{id:'torso',name:'躯干',damage:0,debuffs:[]},{id:'left_arm',name:'左臂',damage:0,debuffs:[]},{id:'right_arm',name:'右臂',damage:0,debuffs:[]},{id:'left_leg',name:'左腿',damage:0,debuffs:[]},{id:'right_leg',name:'右腿',damage:0,debuffs:[]}],inventory:[],affection:50,isImportant:!1,events:[]};return console.log('[NPC Generation Coordinator] 基础 NPC 生成成功:',i.name),i}async generateRandomNPCs(e,t,a,l){console.log(`[NPC Generation Coordinator] 开始批量生成 ${e} 个随机 NPC...`),console.log(`[NPC Generation Coordinator] 副本类型: ${t}`);this.determineWorldType(t);const s=[],c=[];let i=0;for(let a=0;a<e;a++)try{console.log(`[NPC Generation Coordinator] 正在生成第 ${a+1}/${e} 个 NPC...`),l&&l(a+1,e);const o=await(0,n.SZ)('sanctuary',async()=>await r.n.generateRandom(t));s.push(o),i=0,console.log(`[NPC Generation Coordinator] ✅ 第 ${a+1} 个 NPC 生成成功: ${o.name}`)}catch(e){const o=e,n=this.classifyError(o);if(i++,console.error(`[NPC Generation Coordinator] ❌ 第 ${a+1} 个 NPC 生成失败:`,e),c.push({type:n,message:this.getUserFriendlyErrorMessage(n),originalError:o,index:a+1}),i>=3){console.warn(`[NPC Generation Coordinator] 连续失败 ${i} 次，尝试使用降级方案...`),toastr.warning('AI 服务可能不稳定，尝试使用基础生成方案...','NPC 生成',{timeOut:3e3});try{const e=await this.generateBasicFallbackNPC(t);s.push(e),i=0,console.log(`[NPC Generation Coordinator] ✅ 使用降级方案生成成功: ${e.name}`)}catch(e){console.error('[NPC Generation Coordinator] 降级方案也失败了:',e)}}}if(console.log(`[NPC Generation Coordinator] 生成完成: 成功 ${s.length}/${e}`),0===s.length&&c.length>0){const e='所有 NPC 生成失败';console.error(`[NPC Generation Coordinator] ${e}`);const t=new Set(c.map(e=>e.type));let a='';throw a=t.has(o.AI_SERVICE_UNAVAILABLE)?'请检查 AI 服务配置或稍后重试':t.has(o.NETWORK_ERROR)?'请检查网络连接':'请重试或联系管理员',toastr.error(`${e}。${a}`,'NPC 生成失败',{timeOut:5e3,closeButton:!0}),new Error(e)}if(c.length>0){const e=`${c.length} 个 NPC 生成失败，已成功生成 ${s.length} 个`;console.warn(`[NPC Generation Coordinator] ${e}`);const t=new Map;c.forEach(e=>{t.set(e.type,(t.get(e.type)||0)+1)});let a=e;if(t.size>0){const e=Array.from(t.entries()).map(([e,t])=>`${this.getUserFriendlyErrorMessage(e)} (${t}次)`).join('；');a+=`\n原因：${e}`}toastr.warning(a,'NPC 生成',{timeOut:4e3,closeButton:!0})}else toastr.success(`成功生成 ${s.length} 个 NPC`,'NPC 生成',{timeOut:2e3});return console.log(`[NPC Generation Coordinator] ✅ 批量生成完成，返回 ${s.length} 个 NPC`),s}async generateQuickNPC(e,t){console.log('[NPC Generation Coordinator] 开始一句话创建 NPC...'),console.log('[NPC Generation Coordinator] 描述:',e);this.determineWorldType(t);try{const a=await(0,n.SZ)('sanctuary',async()=>await r.n.generateCustom(e,t));return console.log('[NPC Generation Coordinator] ✅ 一句话创建成功:',a.name),toastr.success(`成功创建 NPC：${a.name}`,'NPC 创建',{timeOut:2e3}),a}catch(e){const t=e,a=this.classifyError(t);console.error('[NPC Generation Coordinator] ❌ 一句话创建失败:',e);const n=this.getUserFriendlyErrorMessage(a);throw toastr.error(`创建失败：${n}`,'NPC 创建',{timeOut:4e3,closeButton:!0}),a===o.AI_SERVICE_UNAVAILABLE&&(console.log('[NPC Generation Coordinator] AI 服务不可用，提供降级方案...'),toastr.info('您可以尝试使用"详细创建"手动配置 NPC','NPC 创建',{timeOut:4e3,closeButton:!0})),new Error(n)}}async openDetailedCreation(){return console.log('[NPC Generation Coordinator] 打开详细创建界面...'),new Promise(e=>{const t=o=>{console.log('[NPC Generation Coordinator] 详细创建完成:',o.name),eventRemoveListener('npc_detailed_creation_completed',t),eventRemoveListener('npc_detailed_creation_cancelled',a),e(o)},a=()=>{console.log('[NPC Generation Coordinator] 详细创建已取消'),eventRemoveListener('npc_detailed_creation_completed',t),eventRemoveListener('npc_detailed_creation_cancelled',a),e(null)};eventOn('npc_detailed_creation_completed',t),eventOn('npc_detailed_creation_cancelled',a),console.log('[NPC Generation Coordinator] 发送 npc_detailed_creation_requested 事件'),eventEmit('npc_detailed_creation_requested')})}async regenerateRandomNPCs(e,t,a,l){console.log('[NPC Generation Coordinator] 开始重新生成随机 NPC...'),console.log('[NPC Generation Coordinator] 保留的自定义 NPC 数量:',a.length);const s=this.calculateNPCCount(e),c=s-a.length;if(console.log(`[NPC Generation Coordinator] 总数: ${s}, 自定义: ${a.length}, 需生成: ${c}`),c<=0)return console.log('[NPC Generation Coordinator] 无需生成新的随机 NPC'),toastr.info('自定义 NPC 数量已达上限，无需生成随机 NPC','NPC 重新生成',{timeOut:2e3}),[];const i=[],u=[];let d=0;const m=a.length>0;this.determineWorldType(t);for(let e=0;e<c;e++)try{console.log(`[NPC Generation Coordinator] 正在生成第 ${e+1}/${c} 个随机 NPC...`),l&&l(e+1,c);const o=await(0,n.SZ)('sanctuary',async()=>m?(console.log('[NPC Generation Coordinator] 基于自定义 NPC 生成关联角色...'),await r.n.generateRelatedNPC(t,a)):await r.n.generateRandom(t));i.push(o),d=0,console.log(`[NPC Generation Coordinator] ✅ 第 ${e+1} 个 NPC 生成成功: ${o.name}`)}catch(a){const o=a,n=this.classifyError(o);if(d++,console.error(`[NPC Generation Coordinator] ❌ 第 ${e+1} 个 NPC 生成失败:`,a),u.push({type:n,message:this.getUserFriendlyErrorMessage(n),originalError:o,index:e+1}),d>=3){console.warn(`[NPC Generation Coordinator] 连续失败 ${d} 次，尝试使用降级方案...`),toastr.warning('AI 服务可能不稳定，尝试使用基础生成方案...','NPC 重新生成',{timeOut:3e3});try{const e=await this.generateBasicFallbackNPC(t);i.push(e),d=0,console.log(`[NPC Generation Coordinator] ✅ 使用降级方案生成成功: ${e.name}`)}catch(e){console.error('[NPC Generation Coordinator] 降级方案也失败了:',e)}}}if(console.log(`[NPC Generation Coordinator] 重新生成完成: 成功 ${i.length}/${c}`),0===i.length&&u.length>0){const e='所有随机 NPC 重新生成失败';console.error(`[NPC Generation Coordinator] ${e}`);const t=new Set(u.map(e=>e.type));let a='';throw a=t.has(o.AI_SERVICE_UNAVAILABLE)?'请检查 AI 服务配置或稍后重试':t.has(o.NETWORK_ERROR)?'请检查网络连接':'请重试或使用"添加自定义 NPC"手动创建',toastr.error(`${e}。${a}`,'NPC 重新生成失败',{timeOut:5e3,closeButton:!0}),new Error(e)}if(u.length>0){const e=`${u.length} 个随机 NPC 生成失败，已成功生成 ${i.length} 个`;console.warn(`[NPC Generation Coordinator] ${e}`);const t=new Map;u.forEach(e=>{t.set(e.type,(t.get(e.type)||0)+1)});let a=e;if(t.size>0){a+=`\n原因：${Array.from(t.entries()).map(([e,t])=>`${this.getUserFriendlyErrorMessage(e)} (${t}次)`).join('；')}`}toastr.warning(a,'NPC 重新生成',{timeOut:4e3,closeButton:!0})}else toastr.success(`成功重新生成 ${i.length} 个随机 NPC`,'NPC 重新生成',{timeOut:2e3});return console.log(`[NPC Generation Coordinator] ✅ 重新生成完成，生成了 ${i.length} 个随机 NPC`),i}}}},l={};function s(e){var t=l[e];if(void 0!==t)return t.exports;var a=l[e]={exports:{}};return r[e](a,a.exports,s),a.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if('object'==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&'function'==typeof e.then)return e}var a=Object.create(null);s.r(a);var r={};o=o||[null,n({}),n([]),n(n)];for(var l=2&t&&e;('object'==typeof l||'function'==typeof l)&&!~o.indexOf(l);l=n(l))Object.getOwnPropertyNames(l).forEach(t=>r[t]=()=>e[t]);return r.default=()=>e,s.d(a,r),a},s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};var c=s(35),i=s(632),u=s.n(i),d=s(61),m=s(863),v=s(428);const p=new class{callbacks={};currentChatId='';initialize(){this.currentChatId=this.getCurrentChatId(),console.log('[Tavern Service] 初始化完成，当前聊天 ID:',this.currentChatId)}getCurrentChatId(){try{const e=SillyTavern.getCurrentChatId();return e||(console.warn('[Tavern Service] 当前没有活跃的聊天'),'')}catch(e){return console.error('[Tavern Service] 获取当前聊天 ID 失败:',e),''}}getCurrentCharacterId(){try{return SillyTavern.characterId||''}catch(e){return console.error('[Tavern Service] 获取当前角色 ID 失败:',e),''}}getChatMessages(){try{return getChatMessages('0-{{lastMessageId}}')}catch(e){return console.error('[Tavern Service] 获取聊天消息失败:',e),[]}}async updateUserCharacter(e){try{if(!e||!e.name)throw new Error('角色数据无效');const t=this.buildCharacterDescription(e);console.log('[Tavern Service] 角色描述已生成，长度:',t.length);const a=SillyTavern.characterId;console.log('[Tavern Service] 当前角色卡 ID:',a);const o=SillyTavern.characters[Number(a)];if(!o)throw console.error('[Tavern Service] 无法获取当前角色卡，characterId:',a),new Error('无法获取当前角色卡');console.log('[Tavern Service] 当前角色卡名称:',o.name),console.log('[Tavern Service] 原描述长度:',o.description?.length||0),o.description=t,console.log('[Tavern Service] 描述已更新'),await SillyTavern.saveMetadata(),console.log('[Tavern Service] saveMetadata 完成'),console.log('[Tavern Service] 用户角色更新成功:',e.name),toastr.success(`角色 ${e.name} 已同步到酒馆`)}catch(e){throw console.error('[Tavern Service] 更新用户角色失败:',e),toastr.error('同步角色到酒馆失败'),e}}buildCharacterDescription(e){const{name:t,age:a,occupation:o,background:n,attributes:r,derivedStats:l}=e;return`姓名: ${t}\n${a?`年龄: ${a}\n`:''}${o?`职业: ${o}\n`:''}${n?`背景: ${n}\n\n`:''}属性:\n力量 (STR): ${r.STR}\n体质 (CON): ${r.CON}\n体型 (SIZ): ${r.SIZ}\n敏捷 (DEX): ${r.DEX}\n外貌 (APP): ${r.APP}\n智力 (INT): ${r.INT}\n意志 (POW): ${r.POW}\n教育 (EDU): ${r.EDU}\n幸运 (LUK): ${r.LUK}\n\n衍生属性:\n生命值 (HP): ${l.HP}/${l.maxHP}\n魔法值 (MP): ${l.MP}/${l.maxMP}\n理智值 (SAN): ${l.SAN}/${l.maxSAN}\n移动力 (MOV): ${l.MOV}\n伤害加值 (DB): ${l.DB}\n体格 (BUILD): ${l.BUILD}\n`}getCharacterList(){try{return SillyTavern.characters||[]}catch(e){return console.error('[Tavern Service] 获取角色列表失败:',e),[]}}setupEventListeners(){eventOn(tavern_events.CHAT_CHANGED,e=>{console.log('[Tavern Service] 聊天已变更:',e),this.currentChatId=e,this.callbacks.onChatChanged&&this.callbacks.onChatChanged(e)}),eventOn(tavern_events.MESSAGE_RECEIVED,e=>{console.log('[Tavern Service] 接收到新消息'),this.callbacks.onMessageReceived&&this.callbacks.onMessageReceived(e)}),eventOn(tavern_events.CHARACTER_EDITED,e=>{console.log('[Tavern Service] 角色已变更:',e.detail?.id),this.callbacks.onCharacterChanged&&e.detail?.id&&this.callbacks.onCharacterChanged(e.detail.id)}),eventOn(tavern_events.GENERATION_STARTED,()=>{console.log('[Tavern Service] AI 生成开始'),this.callbacks.onGenerationStarted&&this.callbacks.onGenerationStarted()}),eventOn(tavern_events.GENERATION_STOPPED,()=>{console.log('[Tavern Service] AI 生成停止'),this.callbacks.onGenerationStopped&&this.callbacks.onGenerationStopped()}),console.log('[Tavern Service] 事件监听器已设置')}setCallbacks(e){this.callbacks={...this.callbacks,...e}}clearCallbacks(){this.callbacks={}}async generate(e){try{e?.user_input?await generate({user_input:e.user_input}):await generate({})}catch(e){throw console.error('[Tavern Service] 触发生成失败:',e),e}}stopGeneration(){try{console.log('[Tavern Service] 请求停止生成')}catch(e){console.error('[Tavern Service] 停止生成失败:',e)}}async getWorldbookEntries(e){try{const t=await getWorldbook(e);return Array.from(t)}catch(e){return console.error('[Tavern Service] 获取世界书失败:',e),[]}}async updateWorldbook(e,t){try{await replaceWorldbook(e,t),console.log('[Tavern Service] 世界书更新成功')}catch(e){throw console.error('[Tavern Service] 更新世界书失败:',e),e}}getGlobalVariables(){try{return getVariables({type:'global'})}catch(e){return console.error('[Tavern Service] 获取全局变量失败:',e),{}}}async setGlobalVariables(e){try{await replaceVariables(e,{type:'global'}),console.log('[Tavern Service] 全局变量设置成功')}catch(e){throw console.error('[Tavern Service] 设置全局变量失败:',e),e}}getContext(){return SillyTavern}showNotification(e,t='info'){toastr[t](e)}async executeCommand(e){try{return await triggerSlash(e)}catch(t){throw console.error('[Tavern Service] 执行命令失败:',e,t),t}}reloadInterface(){window.location.reload()}};var g=s(67),h=s(605),f=s(588);class y{async detectFromMVU(){try{if('undefined'==typeof Mvu)return console.warn('[World Detector] MVU 变量框架不可用，回退到默认世界'),{world:'realWorld',confidence:'low',source:'default'};try{await waitGlobalInitialized('Mvu')}catch(e){return console.warn('[World Detector] 等待 MVU 初始化失败:',e),{world:'realWorld',confidence:'low',source:'default'}}let e;try{e=Mvu.getMvuData({type:'chat'})}catch(e){return console.warn('[World Detector] MVU 读取失败:',e),{world:'realWorld',confidence:'low',source:'default'}}if(!e||!e.stat_data)return console.warn('[World Detector] MVU 数据不可用，回退到默认世界'),{world:'realWorld',confidence:'low',source:'default'};const t=e.stat_data.current_area;if(!t)return console.warn('[World Detector] MVU 数据中未找到 current_area，回退到默认世界'),{world:'realWorld',confidence:'low',source:'default'};const a=t;return'sanctuary'===a.type?(console.log('[World Detector] 从 MVU 检测到世界: sanctuary'),{world:'sanctuary',confidence:'high',source:'mvu'}):!0===a.is_inner_world?(console.log('[World Detector] 从 MVU 检测到世界: innerWorld'),{world:'innerWorld',confidence:'high',source:'mvu'}):(console.log('[World Detector] 从 MVU 检测到世界: realWorld'),{world:'realWorld',confidence:'high',source:'mvu'})}catch(e){return console.error('[World Detector] 从 MVU 检测世界时发生未预期的错误:',e),{world:'realWorld',confidence:'low',source:'default'}}}detectFromService(){try{const e=f.apiConfigService.getCurrentWorld();return e?(console.log(`[World Detector] 从 Service 检测到世界: ${e}`),{world:e,confidence:'medium',source:'service'}):(console.warn('[World Detector] Service 未返回世界类型，使用默认值'),{world:'realWorld',confidence:'low',source:'default'})}catch(e){return console.error('[World Detector] 从 Service 检测世界失败:',e),{world:'realWorld',confidence:'low',source:'default'}}}async detect(){console.log('[World Detector] 开始综合检测世界...');try{const e=await this.detectFromMVU();if('mvu'===e.source&&'high'===e.confidence)return console.log(`[World Detector] MVU 检测成功: ${e.world} (置信度: ${e.confidence})`),e;'default'===e.source&&console.warn('[World Detector] MVU 检测失败，尝试备用方案')}catch(e){console.error('[World Detector] MVU 检测过程中发生异常:',e)}try{const e=this.detectFromService();if('service'===e.source&&'medium'===e.confidence)return console.log(`[World Detector] Service 检测成功: ${e.world} (置信度: ${e.confidence})`),e;'default'===e.source&&console.warn('[World Detector] Service 检测失败，使用默认世界')}catch(e){console.error('[World Detector] Service 检测过程中发生异常:',e)}return console.warn('[World Detector] 所有检测方法都失败，回退到默认世界: realWorld'),{world:'realWorld',confidence:'low',source:'default'}}}class S{cache=new Map;cacheTimestamp=new Map;cacheTTL=3e5;getConfig(e){try{const t=this.cacheTimestamp.get(e),a=Date.now();if(t&&a-t<this.cacheTTL){const t=this.cache.get(e);return console.log(`[Config Resolver] 使用缓存配置: ${e}`),t??null}let o=null;try{o=f.apiConfigService.getWorldAPI(e)}catch(t){console.error(`[Config Resolver] 加载 ${e} 配置失败:`,t),toastr.warning(`加载 ${e} API 配置失败，将使用默认 API`),o=null}if(o)try{const t=f.apiConfigService.validateConfig(o);t.valid||(console.error(`[Config Resolver] ${e} 配置验证失败:`,t.errors),toastr.error(`${e} API 配置无效: ${t.errors.join('; ')}，将使用默认 API`),o=null)}catch(t){console.error(`[Config Resolver] 验证 ${e} 配置时发生错误:`,t),toastr.warning(`验证 ${e} API 配置时发生错误，将使用默认 API`),o=null}return this.cache.set(e,o),this.cacheTimestamp.set(e,a),console.log(`[Config Resolver] 加载并缓存配置: ${e}`,o?'有自定义配置':'使用默认 API'),o}catch(t){return console.error(`[Config Resolver] 获取 ${e} 配置时发生未预期的错误:`,t),toastr.error(`获取 ${e} API 配置失败，将使用默认 API`),null}}clearCache(e){e?(this.cache.delete(e),this.cacheTimestamp.delete(e),console.log(`[Config Resolver] 清除缓存: ${e}`)):(this.cache.clear(),this.cacheTimestamp.clear(),console.log('[Config Resolver] 清除所有缓存'))}async preloadConfigs(){console.log('[Config Resolver] 开始预加载所有世界的配置...');const e=['realWorld','innerWorld','sanctuary'];for(const t of e)try{const e=this.getConfig(t);console.log(`[Config Resolver] 预加载 ${t} 配置:`,e?'有自定义配置':'使用默认 API')}catch(e){console.error(`[Config Resolver] 预加载 ${t} 配置失败:`,e)}console.log('[Config Resolver] 配置预加载完成')}}class C{applyToGenerate(e,t){if(e.custom_api)return console.log('[Request Modifier] 请求已有 custom_api，保留原始配置'),e;if(!t)return console.log('[Request Modifier] 无自定义配置，使用默认 API'),e;const a=f.apiConfigService.validateConfig(t);if(!a.valid)return console.error('[Request Modifier] 配置无效:',a.errors),toastr.error(`API 配置无效: ${a.errors.join('; ')}`),e;const o={...e,custom_api:{apiurl:t.apiurl,key:t.key,model:t.model,temperature:t.temperature,max_tokens:t.max_tokens,source:'openai'}};return console.log('[Request Modifier] 已应用自定义 API 配置到 generate 请求:',{model:t.model,apiurl:t.apiurl.substring(0,30)+'...',temperature:t.temperature,max_tokens:t.max_tokens}),o}applyToGenerateRaw(e,t){if(e.custom_api)return console.log('[Request Modifier] 请求已有 custom_api，保留原始配置'),e;if(!t)return console.log('[Request Modifier] 无自定义配置，使用默认 API'),e;const a=f.apiConfigService.validateConfig(t);if(!a.valid)return console.error('[Request Modifier] 配置无效:',a.errors),toastr.error(`API 配置无效: ${a.errors.join('; ')}`),e;const o={...e,custom_api:{apiurl:t.apiurl,key:t.key,model:t.model,temperature:t.temperature,max_tokens:t.max_tokens,source:'openai'}};return console.log('[Request Modifier] 已应用自定义 API 配置到 generateRaw 请求:',{model:t.model,apiurl:t.apiurl.substring(0,30)+'...',temperature:t.temperature,max_tokens:t.max_tokens,has_ordered_prompts:!!e.ordered_prompts}),o}validate(e){if(!e.custom_api)return console.log('[Request Modifier] 使用默认 API，无需验证'),!0;const t={apiurl:e.custom_api.apiurl,key:e.custom_api.key||'',model:e.custom_api.model,temperature:e.custom_api.temperature||1,max_tokens:e.custom_api.max_tokens||2e3},a=f.apiConfigService.validateConfig(t);return a.valid?(console.log('[Request Modifier] 配置验证通过'),!0):(console.error('[Request Modifier] 配置验证失败:',a.errors),toastr.error(`API 配置验证失败: ${a.errors.join('; ')}`),!1)}}const N=new class{initialized=!1;currentWorld='realWorld';state={enabled:!1,currentWorld:'realWorld',lastWorldChange:Date.now(),requestCount:0,errorCount:0};originalGenerate=null;originalGenerateRaw=null;worldDetector=new y;configResolver=new S;requestModifier=new C;mvuEventCleanup=null;debugMode=!1;async initialize(){if(this.initialized)console.log('[API Auto Switch] 已经初始化，跳过');else try{console.log('[API Auto Switch] 开始初始化...');try{await f.apiConfigService.initialize(),console.log('[API Auto Switch] apiConfigService 初始化完成')}catch(e){console.error('[API Auto Switch] apiConfigService 初始化失败:',e),toastr.warning('API 配置服务初始化失败，将使用默认 API'),this.log({level:'error',message:'apiConfigService 初始化失败',error:e instanceof Error?e:new Error(String(e))})}try{this.currentWorld=await this.detectCurrentWorld(),this.state.currentWorld=this.currentWorld,console.log(`[API Auto Switch] 初始世界检测完成: ${this.currentWorld}`)}catch(e){console.error('[API Auto Switch] 初始世界检测失败:',e),this.currentWorld='realWorld',this.state.currentWorld='realWorld'}try{await this.configResolver.preloadConfigs(),console.log('[API Auto Switch] 配置预加载完成')}catch(e){console.error('[API Auto Switch] 配置预加载失败:',e),toastr.warning('API 配置预加载失败，将在首次使用时加载'),this.log({level:'warn',message:'配置预加载失败',error:e instanceof Error?e:new Error(String(e))})}try{this.setupInterceptors(),console.log('[API Auto Switch] 拦截器设置完成')}catch(e){console.error('[API Auto Switch] 拦截器设置失败:',e),toastr.error('API 自动切换拦截器设置失败'),this.log({level:'error',message:'拦截器设置失败',error:e instanceof Error?e:new Error(String(e))}),this.state.enabled=!1}try{this.watchWorldChanges(),console.log('[API Auto Switch] 世界变更监听设置完成')}catch(e){console.error('[API Auto Switch] 世界变更监听设置失败:',e),'undefined'==typeof Mvu?(console.warn('[API Auto Switch] MVU 变量框架不可用，自动切换功能将受限'),toastr.info('MVU 变量框架不可用，API 自动切换功能将受限')):toastr.warning('世界变更监听设置失败，需要手动切换世界'),this.log({level:'warn',message:'世界变更监听设置失败',error:e instanceof Error?e:new Error(String(e))})}this.initialized=!0,this.state.enabled=!0,console.log('[API Auto Switch] 初始化完成'),toastr.success('API 自动切换服务已启动')}catch(e){console.error('[API Auto Switch] 初始化过程中发生未预期的错误:',e),toastr.error('API 自动切换服务初始化失败，请检查控制台'),this.log({level:'error',message:'初始化过程中发生未预期的错误',error:e instanceof Error?e:new Error(String(e))}),this.state.enabled=!1}}setupInterceptors(){console.log('[API Auto Switch] 开始设置请求拦截器...'),'function'==typeof window.generate?(this.originalGenerate=window.generate,console.log('[API Auto Switch] 已保存原始 generate 函数引用')):console.warn('[API Auto Switch] window.generate 不可用'),'function'==typeof window.generateRaw?(this.originalGenerateRaw=window.generateRaw,console.log('[API Auto Switch] 已保存原始 generateRaw 函数引用')):console.warn('[API Auto Switch] window.generateRaw 不可用'),this.originalGenerate&&(window.generate=this.interceptGenerate.bind(this),console.log('[API Auto Switch] 已覆盖 window.generate')),this.originalGenerateRaw&&(window.generateRaw=this.interceptGenerateRaw.bind(this),console.log('[API Auto Switch] 已覆盖 window.generateRaw')),console.log('[API Auto Switch] 请求拦截器设置完成')}restoreOriginalFunctions(){console.log('[API Auto Switch] 开始恢复原始函数...'),this.originalGenerate&&(window.generate=this.originalGenerate,console.log('[API Auto Switch] 已恢复原始 generate 函数'),this.originalGenerate=null),this.originalGenerateRaw&&(window.generateRaw=this.originalGenerateRaw,console.log('[API Auto Switch] 已恢复原始 generateRaw 函数'),this.originalGenerateRaw=null),console.log('[API Auto Switch] 原始函数恢复完成')}async detectCurrentWorld(){try{const e=await this.worldDetector.detect(),t='low'===e.confidence?'warn':'info';return'default'===e.source?(console.warn('[API Auto Switch] 世界检测失败，回退到默认世界: realWorld'),this.log({level:'warn',message:`世界检测失败，回退到默认世界: ${e.world} (来源: ${e.source}, 置信度: ${e.confidence})`,world:e.world})):this.log({level:t,message:`检测到世界: ${e.world} (来源: ${e.source}, 置信度: ${e.confidence})`,world:e.world}),e.world}catch(e){return console.error('[API Auto Switch] 世界检测过程中发生未预期的错误:',e),this.log({level:'error',message:'世界检测过程中发生未预期的错误，回退到默认世界: realWorld',error:e instanceof Error?e:new Error(String(e))}),'realWorld'}}watchWorldChanges(){console.log('[API Auto Switch] 开始设置世界变更监听...');try{if('undefined'==typeof Mvu)return void console.warn('[API Auto Switch] MVU 变量框架不可用，无法监听世界变更');const e=async e=>{e.stat_data&&e.stat_data.current_area&&(console.log('[API Auto Switch] 检测到 MVU 变量更新，检查世界变更'),await this.handleWorldChange())};eventOn(Mvu.events.VARIABLE_UPDATE_ENDED,e),console.log('[API Auto Switch] 已注册 MVU 变量变更监听器'),this.mvuEventCleanup=()=>{eventRemoveListener(Mvu.events.VARIABLE_UPDATE_ENDED,e),console.log('[API Auto Switch] 已移除 MVU 变量变更监听器')}}catch(e){console.error('[API Auto Switch] 设置 MVU 变量变更监听失败:',e)}try{const e=f.apiConfigService.switchToRealWorld.bind(f.apiConfigService),t=f.apiConfigService.switchToInnerWorld.bind(f.apiConfigService),a=f.apiConfigService.switchToSanctuary.bind(f.apiConfigService);f.apiConfigService.switchToRealWorld=async()=>{console.log('[API Auto Switch] 检测到手动切换到现实世界'),e(),await this.handleWorldChange()},f.apiConfigService.switchToInnerWorld=async()=>{console.log('[API Auto Switch] 检测到手动切换到里世界'),t(),await this.handleWorldChange()},f.apiConfigService.switchToSanctuary=async()=>{console.log('[API Auto Switch] 检测到手动切换到归所'),a(),await this.handleWorldChange()},console.log('[API Auto Switch] 已设置手动世界切换监听')}catch(e){console.error('[API Auto Switch] 设置手动世界切换监听失败:',e)}console.log('[API Auto Switch] 世界变更监听设置完成')}async handleWorldChange(){try{console.log('[API Auto Switch] 开始处理世界切换...');const e=this.currentWorld,t=await this.detectCurrentWorld();if(e===t)return void console.log(`[API Auto Switch] 世界未变更，仍为: ${t}`);console.log(`[API Auto Switch] 世界切换: ${e} → ${t}`),this.currentWorld=t,this.state.currentWorld=t,this.state.lastWorldChange=Date.now(),this.configResolver.clearCache(),console.log('[API Auto Switch] 已清除配置缓存');const a=this.configResolver.getConfig(t);this.log({level:'info',message:`世界切换完成: ${e} → ${t}`,world:t,apiConfig:a?{model:a.model,apiurl:a.apiurl}:void 0});const o=this.getWorldDisplayName(t),n=a?`自定义 API (${a.model})`:'酒馆默认 API';toastr.success(`世界已切换到: ${o}<br>使用 API: ${n}`,'世界切换成功',{timeOut:5e3,extendedTimeOut:2e3,closeButton:!0,progressBar:!0}),console.log('[API Auto Switch] 世界切换处理完成')}catch(e){console.error('[API Auto Switch] 处理世界切换失败:',e),this.log({level:'error',message:'处理世界切换失败',error:e instanceof Error?e:new Error(String(e))})}}getWorldDisplayName(e){return{realWorld:'现实世界',innerWorld:'里世界副本',sanctuary:'归所'}[e]||e}getCurrentAPIConfig(){try{const e=this.configResolver.getConfig(this.currentWorld);return e?console.log(`[API Auto Switch] 使用 ${this.currentWorld} 的自定义 API 配置`):console.log(`[API Auto Switch] ${this.currentWorld} 使用默认 API`),e}catch(e){return this.log({level:'error',message:`获取 ${this.currentWorld} 的 API 配置失败`,world:this.currentWorld,error:e instanceof Error?e:new Error(String(e))}),null}}async interceptGenerate(e){try{this.state.requestCount++,console.log(`[API Auto Switch] 拦截 generate 请求 #${this.state.requestCount}`),this.debugMode&&(console.group(`[API Auto Switch Debug] generate 请求 #${this.state.requestCount}`),console.log('原始请求配置:',{user_input:e.user_input?.substring(0,100)+(e.user_input&&e.user_input.length>100?'...':''),should_stream:e.should_stream,has_custom_api:!!e.custom_api})),this.state.currentWorld=this.currentWorld,this.debugMode&&console.log('当前世界:',this.currentWorld);const t=this.getCurrentAPIConfig();this.debugMode&&(t?console.log('应用自定义 API 配置:',{model:t.model,apiurl:t.apiurl.substring(0,50)+'...',temperature:t.temperature,max_tokens:t.max_tokens}):console.log('使用酒馆默认 API'));let a,o=e;t&&(o=this.applyAPIConfigToGenerate(e,t),this.validateRequestConfig(o)?this.debugMode&&console.log('配置应用成功，修改后的 custom_api:',{model:o.custom_api?.model,apiurl:o.custom_api?.apiurl?.substring(0,50)+'...',temperature:o.custom_api?.temperature,max_tokens:o.custom_api?.max_tokens}):(console.warn('[API Auto Switch] 配置验证失败，使用原始配置'),o=e,this.debugMode&&console.warn('配置验证失败，回退到原始配置')));try{const e=this.debugMode?Date.now():0;if(a=await this.originalGenerate(o),console.log(`[API Auto Switch] generate 请求成功 #${this.state.requestCount}`),this.debugMode){const t=Date.now()-e;console.log('请求成功:',{duration:`${t}ms`,response_length:a.length,response_preview:a.substring(0,100)+(a.length>100?'...':'')}),console.groupEnd()}}catch(e){this.state.errorCount++;const a=e instanceof Error?e.message:String(e);throw console.error(`[API Auto Switch] generate 请求失败 #${this.state.errorCount}:`,a),this.debugMode&&(console.error('请求失败详情:',{error:e,world:this.currentWorld,apiConfig:t?{model:t.model,apiurl:t.apiurl.substring(0,50)+'...'}:'默认 API'}),console.groupEnd()),this.log({level:'error',message:`generate 请求失败 (错误 #${this.state.errorCount}): ${a}`,world:this.currentWorld,error:e instanceof Error?e:new Error(String(e)),apiConfig:t?{model:t.model,apiurl:t.apiurl.substring(0,30)+'...'}:void 0}),toastr.error(`AI 生成请求失败: ${a}`),e}return a}catch(e){this.state.errorCount++;const t=e instanceof Error?e.message:String(e);throw console.error(`[API Auto Switch] generate 拦截过程中发生错误 #${this.state.errorCount}:`,t),this.debugMode&&(console.error('拦截过程错误:',e),console.groupEnd()),this.log({level:'error',message:`generate 拦截过程中发生错误 (错误 #${this.state.errorCount}): ${t}`,world:this.currentWorld,error:e instanceof Error?e:new Error(String(e))}),e}}async interceptGenerateRaw(e){try{if(this.state.requestCount++,console.log(`[API Auto Switch] 拦截 generateRaw 请求 #${this.state.requestCount}`),this.debugMode&&(console.group(`[API Auto Switch Debug] generateRaw 请求 #${this.state.requestCount}`),console.log('原始请求配置:',{ordered_prompts_count:e.ordered_prompts?.length||0,has_custom_api:!!e.custom_api}),e.ordered_prompts&&e.ordered_prompts.length>0)){const t=e.ordered_prompts[0];'object'==typeof t&&'role'in t&&'content'in t?console.log('第一条 prompt:',{role:t.role,content:t.content.substring(0,100)+(t.content.length>100?'...':'')}):console.log('第一条 prompt:',t)}this.state.currentWorld=this.currentWorld,this.debugMode&&console.log('当前世界:',this.currentWorld);const t=this.getCurrentAPIConfig();this.debugMode&&(t?console.log('应用自定义 API 配置:',{model:t.model,apiurl:t.apiurl.substring(0,50)+'...',temperature:t.temperature,max_tokens:t.max_tokens}):console.log('使用酒馆默认 API'));let a,o=e;t&&(o=this.applyAPIConfigToGenerateRaw(e,t),this.validateRequestConfig(o)?this.debugMode&&console.log('配置应用成功，修改后的 custom_api:',{model:o.custom_api?.model,apiurl:o.custom_api?.apiurl?.substring(0,50)+'...',temperature:o.custom_api?.temperature,max_tokens:o.custom_api?.max_tokens}):(console.warn('[API Auto Switch] 配置验证失败，使用原始配置'),o=e,this.debugMode&&console.warn('配置验证失败，回退到原始配置')));try{const e=this.debugMode?Date.now():0;if(a=await this.originalGenerateRaw(o),console.log(`[API Auto Switch] generateRaw 请求成功 #${this.state.requestCount}`),this.debugMode){const t=Date.now()-e;console.log('请求成功:',{duration:`${t}ms`,response_length:a.length,response_preview:a.substring(0,100)+(a.length>100?'...':'')}),console.groupEnd()}}catch(e){this.state.errorCount++;const a=e instanceof Error?e.message:String(e);throw console.error(`[API Auto Switch] generateRaw 请求失败 #${this.state.errorCount}:`,a),this.debugMode&&(console.error('请求失败详情:',{error:e,world:this.currentWorld,apiConfig:t?{model:t.model,apiurl:t.apiurl.substring(0,50)+'...'}:'默认 API'}),console.groupEnd()),this.log({level:'error',message:`generateRaw 请求失败 (错误 #${this.state.errorCount}): ${a}`,world:this.currentWorld,error:e instanceof Error?e:new Error(String(e)),apiConfig:t?{model:t.model,apiurl:t.apiurl.substring(0,30)+'...'}:void 0}),toastr.error(`AI 生成请求失败: ${a}`),e}return a}catch(e){this.state.errorCount++;const t=e instanceof Error?e.message:String(e);throw console.error(`[API Auto Switch] generateRaw 拦截过程中发生错误 #${this.state.errorCount}:`,t),this.debugMode&&(console.error('拦截过程错误:',e),console.groupEnd()),this.log({level:'error',message:`generateRaw 拦截过程中发生错误 (错误 #${this.state.errorCount}): ${t}`,world:this.currentWorld,error:e instanceof Error?e:new Error(String(e))}),e}}applyAPIConfigToGenerate(e,t){return this.requestModifier.applyToGenerate(e,t)}applyAPIConfigToGenerateRaw(e,t){return this.requestModifier.applyToGenerateRaw(e,t)}validateRequestConfig(e){return this.requestModifier.validate(e)}async cleanup(){try{console.log('[API Auto Switch] 开始清理...'),this.restoreOriginalFunctions(),this.mvuEventCleanup&&(this.mvuEventCleanup(),this.mvuEventCleanup=null,console.log('[API Auto Switch] 事件监听器已移除')),this.configResolver.clearCache(),console.log('[API Auto Switch] 配置缓存已清除'),this.state={enabled:!1,currentWorld:'realWorld',lastWorldChange:Date.now(),requestCount:0,errorCount:0},this.initialized=!1,this.state.enabled=!1,console.log('[API Auto Switch] 清理完成')}catch(e){throw console.error('[API Auto Switch] 清理失败:',e),e}}getState(){return{...this.state}}enableDebugMode(){this.debugMode=!0,console.log('[API Auto Switch] 调试模式已启用'),toastr.info('API 自动切换调试模式已启用，详细日志将输出到控制台')}disableDebugMode(){this.debugMode=!1,console.log('[API Auto Switch] 调试模式已禁用'),toastr.info('API 自动切换调试模式已禁用')}toggleDebugMode(){this.debugMode?this.disableDebugMode():this.enableDebugMode()}isDebugMode(){return this.debugMode}log(e){const t={...e,timestamp:Date.now()},a=new Date(t.timestamp).toISOString(),o=t.world?` [${t.world}]`:'';let n='';if(t.apiConfig){const e={};if(t.apiConfig.key){const a=t.apiConfig.key;a.length>8?e.key=`${a.substring(0,4)}...${a.substring(a.length-4)}`:e.key='***'}if(t.apiConfig.apiurl){const a=t.apiConfig.apiurl;a.length>50?e.apiurl=a.substring(0,47)+'...':e.apiurl=a}t.apiConfig.model&&(e.model=t.apiConfig.model),void 0!==t.apiConfig.temperature&&(e.temperature=t.apiConfig.temperature),void 0!==t.apiConfig.max_tokens&&(e.max_tokens=t.apiConfig.max_tokens),n=` [API: ${JSON.stringify(e)}]`}const r=`[API Auto Switch] [${a}]${o} ${t.message}${n}`;switch(t.level){case'info':console.log(r),t.error&&console.log('  Error details:',t.error);break;case'warn':console.warn(r),t.error&&console.warn('  Error details:',t.error);break;case'error':console.error(r),t.error&&(console.error('  Error details:',t.error),t.error.stack&&console.error('  Stack trace:',t.error.stack))}}},w={class:'api-config-panel'},E={class:'current-api-info'},k={class:'info-row'},b={class:'info-value'},V={class:'info-row'},I={key:0,class:'info-row model-info'},P={class:'info-value'},A={class:'config-tabs'},M=['onClick'],D={class:'config-form'},B={class:'form-group'},R={class:'form-label'},W=['checked'],x={class:'form-group'},T={class:'form-group'},U={class:'form-group'},G={class:'model-input-group'},O={class:'model-presets'},L=['title','onClick'],F={class:'form-group'},j={class:'form-label'},H={class:'form-group'},J={class:'form-actions'},X=['disabled'],q={class:'debug-mode-section'},K={class:'debug-mode-label'},Z=['checked'],Y=(0,d.defineComponent)({__name:'APIConfigPanel',emits:['close'],setup(e,{emit:t}){const a=t,o=[{key:'realWorld',name:'现实世界'},{key:'innerWorld',name:'里世界副本'},{key:'sanctuary',name:'归所'}],n=[{label:'Gemini Pro 2.5',value:'gemini-2.5-pro-latest',apiurl:'http://localhost:8000/api/backends/google_gemini/chat-completions/generate',description:'Google 最新 Pro 版本，最强性能（需在 SillyTavern 后端配置）'},{label:'Gemini 2.0 Flash',value:'gemini-2.0-flash-exp',apiurl:'http://localhost:8000/api/backends/google_gemini/chat-completions/generate',description:'Google 2.0 实验版本，速度快（需在 SillyTavern 后端配置）'},{label:'Gemini 1.5 Pro',value:'gemini-1.5-pro-latest',apiurl:'http://localhost:8000/api/backends/google_gemini/chat-completions/generate',description:'Google 1.5 高质量模型（需在 SillyTavern 后端配置）'},{label:'Gemini 1.5 Flash',value:'gemini-1.5-flash-latest',apiurl:'http://localhost:8000/api/backends/google_gemini/chat-completions/generate',description:'Google 1.5 快速模型（需在 SillyTavern 后端配置）'},{label:'Gemini Pro',value:'gemini-pro',apiurl:'http://localhost:8000/api/backends/google_gemini/chat-completions/generate',description:'Google 标准模型（需在 SillyTavern 后端配置）'},{label:'GPT-4',value:'gpt-4',apiurl:'http://localhost:8000/api/backends/openai/chat-completions/generate',description:'OpenAI 最强模型（需在 SillyTavern 后端配置）'},{label:'GPT-4 Turbo',value:'gpt-4-turbo-preview',apiurl:'http://localhost:8000/api/backends/openai/chat-completions/generate',description:'OpenAI 快速版本（需在 SillyTavern 后端配置）'},{label:'GPT-3.5',value:'gpt-3.5-turbo',apiurl:'http://localhost:8000/api/backends/openai/chat-completions/generate',description:'OpenAI 经济模型（需在 SillyTavern 后端配置）'},{label:'Claude 3 Opus',value:'claude-3-opus-20240229',apiurl:'http://localhost:8000/api/backends/anthropic/chat-completions/generate',description:'Anthropic 最强模型（需在 SillyTavern 后端配置）'},{label:'Claude 3 Sonnet',value:'claude-3-sonnet-20240229',apiurl:'http://localhost:8000/api/backends/anthropic/chat-completions/generate',description:'Anthropic 平衡模型（需在 SillyTavern 后端配置）'},{label:'Claude 3 Haiku',value:'claude-3-haiku-20240307',apiurl:'http://localhost:8000/api/backends/anthropic/chat-completions/generate',description:'Anthropic 快速模型（需在 SillyTavern 后端配置）'}],r=(0,d.ref)('realWorld'),l=(0,d.ref)({realWorld:null,innerWorld:null,sanctuary:null}),s=(0,d.ref)(!1),c=(0,d.ref)(null),i=(0,d.ref)(!1),u=(0,d.computed)(()=>{const e=f.apiConfigService.getCurrentWorld(),t=o.find(t=>t.key===e);return t?t.name:'未知'}),m=(0,d.computed)(()=>{const e=f.apiConfigService.getCurrentWorld(),t=l.value[e];return t?{isCustom:!0,displayText:'自定义 API',model:t.model||'未设置'}:{isCustom:!1,displayText:'酒馆默认 API',model:null}});async function v(){const e=l.value[r.value];if(!e)return void toastr.warning('请先启用自定义 API');const t=f.apiConfigService.validateConfig(e);if(t.valid){s.value=!0,c.value=null;try{const e=await f.apiConfigService.testConnection(r.value);c.value=e,e.success?toastr.success('API 连接测试成功！'):toastr.error('API 连接测试失败')}catch(e){console.error('[API Config Panel] 测试连接失败:',e),c.value={success:!1,message:`测试失败: ${e instanceof Error?e.message:'未知错误'}`},toastr.error('测试连接失败')}finally{s.value=!1}}else c.value={success:!1,message:t.errors.join('; ')}}async function p(){try{for(const e of o){const t=l.value[e.key];if(t){const a=f.apiConfigService.validateConfig(t);if(!a.valid)return void toastr.error(`${e.name} 配置无效: ${a.errors.join('; ')}`)}}await f.apiConfigService.saveConfigs(l.value),toastr.success('API 配置已保存')}catch(e){console.error('[API Config Panel] 保存配置失败:',e),toastr.error('保存配置失败')}}async function g(){if(confirm('确定要重置所有 API 配置吗？这将使所有世界使用酒馆默认 API。'))try{await f.apiConfigService.resetConfigs(),l.value={realWorld:null,innerWorld:null,sanctuary:null},c.value=null,toastr.success('配置已重置')}catch(e){console.error('[API Config Panel] 重置配置失败:',e),toastr.error('重置配置失败')}}function h(){a('close')}function y(){N.toggleDebugMode(),i.value=N.isDebugMode()}return(0,d.onMounted)(async()=>{try{await f.apiConfigService.initialize(),l.value=f.apiConfigService.getAllConfigs(),i.value=N.isDebugMode(),console.log('[API Config Panel] 配置已加载:',l.value)}catch(e){console.error('[API Config Panel] 加载配置失败:',e),toastr.error('加载 API 配置失败')}}),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',w,[t[18]||(t[18]=(0,d.createElementVNode)('h2',{class:'panel-title'},'API 配置管理',-1)),t[19]||(t[19]=(0,d.createElementVNode)('p',{class:'panel-description'},'为不同世界配置独立的 API，实现完全隔离的游戏体验。未配置时将使用酒馆默认 API。',-1)),(0,d.createCommentVNode)(' 当前使用的 API '),(0,d.createElementVNode)('div',E,[(0,d.createElementVNode)('div',k,[t[6]||(t[6]=(0,d.createElementVNode)('span',{class:'info-label'},'当前世界：',-1)),(0,d.createElementVNode)('span',b,(0,d.toDisplayString)(u.value),1)]),(0,d.createElementVNode)('div',V,[t[7]||(t[7]=(0,d.createElementVNode)('span',{class:'info-label'},'当前使用的 API：',-1)),(0,d.createElementVNode)('span',{class:(0,d.normalizeClass)(['info-value',m.value.isCustom?'custom-api':'default-api'])},(0,d.toDisplayString)(m.value.displayText),3)]),m.value.isCustom&&m.value.model?((0,d.openBlock)(),(0,d.createElementBlock)('div',I,[t[8]||(t[8]=(0,d.createElementVNode)('span',{class:'info-label'},'模型：',-1)),(0,d.createElementVNode)('span',P,(0,d.toDisplayString)(m.value.model),1)])):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' 配置标签页 '),(0,d.createElementVNode)('div',A,[((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(o,e=>(0,d.createElementVNode)('button',{key:e.key,class:(0,d.normalizeClass)(['tab-button',{active:r.value===e.key}]),onClick:t=>r.value=e.key},(0,d.toDisplayString)(e.name),11,M)),64))]),(0,d.createCommentVNode)(' 配置表单 '),(0,d.createElementVNode)('div',D,[(0,d.createElementVNode)('div',B,[(0,d.createElementVNode)('label',R,[(0,d.createElementVNode)('input',{type:'checkbox',checked:null!==l.value[r.value],onChange:t[0]||(t[0]=e=>{return t=r.value,e.target.checked?l.value={...l.value,[t]:{apiurl:'',key:'',model:'',temperature:1,max_tokens:2e3}}:l.value={...l.value,[t]:null},void(c.value=null);var t})},null,40,W),t[9]||(t[9]=(0,d.createTextVNode)(' 启用自定义 API（不勾选则使用酒馆默认 API） ',-1))])]),null!==l.value[r.value]?((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:0},[(0,d.createElementVNode)('div',x,[t[10]||(t[10]=(0,d.createElementVNode)('label',{class:'form-label'},'API 地址',-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>l.value[r.value].apiurl=e),type:'text',class:'form-input',placeholder:'https://api.example.com/v1/chat/completions'},null,512),[[d.vModelText,l.value[r.value].apiurl]])]),(0,d.createElementVNode)('div',T,[t[11]||(t[11]=(0,d.createElementVNode)('label',{class:'form-label'},'API 密钥',-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t[2]||(t[2]=e=>l.value[r.value].key=e),type:'password',class:'form-input',placeholder:'留空（密钥在 SillyTavern 后端配置）'},null,512),[[d.vModelText,l.value[r.value].key]]),t[12]||(t[12]=(0,d.createElementVNode)('span',{class:'api-key-hint'},'💡 使用本地后端时可留空，真实密钥应配置在 SillyTavern 的 config.yaml 中',-1))]),(0,d.createElementVNode)('div',U,[t[13]||(t[13]=(0,d.createElementVNode)('label',{class:'form-label'},'模型名称',-1)),(0,d.createElementVNode)('div',G,[(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>l.value[r.value].model=e),type:'text',class:'form-input',placeholder:'输入模型名称或从下方选择'},null,512),[[d.vModelText,l.value[r.value].model]]),(0,d.createElementVNode)('div',O,[((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(n,e=>(0,d.createElementVNode)('button',{key:e.value,type:'button',class:'preset-chip',title:e.description,onClick:t=>function(e){const t=l.value[r.value];if(t){const a=n.find(t=>t.value===e);l.value={...l.value,[r.value]:{...t,model:e,apiurl:a?.apiurl||t.apiurl}},c.value=null}}(e.value)},(0,d.toDisplayString)(e.label),9,L)),64))])]),t[14]||(t[14]=(0,d.createElementVNode)('span',{class:'model-hint'},'💡 常用模型：Gemini、GPT、Claude 等',-1))]),(0,d.createElementVNode)('div',F,[(0,d.createElementVNode)('label',j,'温度参数 ('+(0,d.toDisplayString)(l.value[r.value].temperature)+')',1),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t[4]||(t[4]=e=>l.value[r.value].temperature=e),type:'range',min:'0',max:'2',step:'0.1',class:'form-range'},null,512),[[d.vModelText,l.value[r.value].temperature,void 0,{number:!0}]]),t[15]||(t[15]=(0,d.createElementVNode)('span',{class:'range-hint'},'控制输出随机性，0=确定性，2=高随机性',-1))]),(0,d.createElementVNode)('div',H,[t[16]||(t[16]=(0,d.createElementVNode)('label',{class:'form-label'},'最大 Token 数',-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>l.value[r.value].max_tokens=e),type:'number',min:'1',max:'32000',class:'form-input',placeholder:'2000'},null,512),[[d.vModelText,l.value[r.value].max_tokens,void 0,{number:!0}]])]),(0,d.createCommentVNode)(' 测试连接按钮 '),(0,d.createElementVNode)('div',J,[(0,d.createElementVNode)('button',{class:'btn btn-test',disabled:s.value,onClick:v},(0,d.toDisplayString)(s.value?'测试中...':'测试连接'),9,X)]),(0,d.createCommentVNode)(' 测试结果 '),c.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:0,class:(0,d.normalizeClass)(['test-result',c.value.success?'success':'error'])},(0,d.toDisplayString)(c.value.message),3)):(0,d.createCommentVNode)('v-if',!0)],64)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' 调试模式开关 '),(0,d.createElementVNode)('div',q,[(0,d.createElementVNode)('label',K,[(0,d.createElementVNode)('input',{type:'checkbox',checked:i.value,onChange:y},null,40,Z),t[17]||(t[17]=(0,d.createTextVNode)(' 调试模式（在控制台显示详细日志） ',-1))])]),(0,d.createCommentVNode)(' 底部操作按钮 '),(0,d.createElementVNode)('div',{class:'panel-actions'},[(0,d.createElementVNode)('button',{class:'btn btn-primary',onClick:p},'保存配置'),(0,d.createElementVNode)('button',{class:'btn btn-secondary',onClick:g},'重置为默认'),(0,d.createElementVNode)('button',{class:'btn btn-secondary',onClick:h},'关闭')])]))}});var Q=s(895);const ee=(0,Q.A)(Y,[['__scopeId','data-v-5f7754f2']]);function te(e){const t=a.timeline();return t.to(e,{scale:.95,duration:.1,ease:'power2.in'}).to(e,{scale:1,duration:.1,ease:'power2.out'}),t}function ae(e,t=10,o=.5){const n=a.timeline(),r=o/8;for(let a=0;a<8;a++){const a=(Math.random()-.5)*t*2,o=(Math.random()-.5)*t*2;n.to(e,{x:a,y:o,duration:r,ease:'power2.inOut'})}return n.to(e,{x:0,y:0,duration:r,ease:'power2.out'}),n}function oe(e,t=['transform','opacity']){const a='string'==typeof e?document.querySelector(e):e;a instanceof HTMLElement&&(a.style.willChange=t.join(', '))}function ne(e){const t='string'==typeof e?document.querySelector(e):e;t instanceof HTMLElement&&(t.style.willChange='auto')}const re=['src'],le=(0,d.defineComponent)({__name:'Background',setup(e){const t=(0,h.useGameStore)(),o=(0,d.ref)(null),n=(0,d.ref)(''),r=new Map;return(0,d.onMounted)(()=>{t.currentScene.background&&(n.value=t.currentScene.background),o.value&&oe(o.value,['opacity'])}),(0,d.watch)(()=>t.currentScene.background,async(e,t)=>{if(e!==t)if(e){try{await(l=e,r.has(l)?Promise.resolve(r.get(l)):new Promise((e,t)=>{const a=new Image;a.onload=()=>{r.set(l,a),console.log('[Background] 图片预加载成功:',l),e(a)},a.onerror=()=>{console.error('[Background] 图片预加载失败:',l),t(new Error(`Failed to preload image: ${l}`))},a.src=l}))}catch(e){console.error('[Background] 预加载背景失败，使用默认加载:',e)}var l;t&&n.value?o.value&&a.to(o.value,{opacity:0,duration:.5,ease:'power2.in',onComplete:()=>{n.value=e,a.to(o.value,{opacity:1,duration:.5,ease:'power2.out'})}}):n.value=e}else n.value=''}),(0,d.onBeforeUnmount)(()=>{o.value&&ne(o.value)}),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{ref_key:'backgroundRef',ref:o,class:'background-layer'},[n.value?((0,d.openBlock)(),(0,d.createElementBlock)('img',{key:0,src:n.value,alt:'场景背景',class:'background-image'},null,8,re)):(0,d.createCommentVNode)('v-if',!0)],512))}}),se=(0,Q.A)(le,[['__scopeId','data-v-8e8ada04']]);var ce=s(665);const ie={class:'character-creator'},ue={class:'creator-header'},de={class:'creator-title'},me={class:'creator-subtitle'},ve={class:'creator-content'},pe={class:'section'},ge={class:'form-grid'},he={class:'form-group'},fe={class:'form-group'},ye={class:'form-group'},Se=['value'],Ce={key:0,class:'form-group'},Ne={class:'form-group'},we={class:'section'},Ee={class:'attributes-grid'},ke={class:'attribute-label'},be=['onUpdate:modelValue'],Ve={class:'section'},Ie={class:'derived-stats'},Pe={class:'stat-item'},Ae={class:'stat-value'},$e={class:'stat-item'},Me={class:'stat-value'},De={class:'stat-item'},Be={class:'stat-value'},_e={class:'stat-item'},Re={class:'stat-value'},ze={class:'stat-item'},We={class:'stat-value'},xe={class:'stat-item'},Te={class:'stat-value'},Ue={key:0,class:'section'},Ge={class:'skills-info'},Oe={class:'info-text'},Le={class:'info-text'},Fe={class:'skills-grid'},je={class:'skill-label'},He=['onUpdate:modelValue'],Je=['onUpdate:modelValue'],Xe=['onClick'],qe={class:'add-skill'},Ke={class:'creator-actions'},Ze=['disabled'],Ye=(0,d.defineComponent)({__name:'CharacterCreator',props:{syncToTavern:{type:Boolean,default:!0},characterType:{default:'player'},showSkills:{type:Boolean,default:!0},editingCharacter:{default:void 0}},emits:['created'],setup(e,{emit:t}){const a=e,o=t,n=(0,g.m)(),r=(0,d.reactive)({name:'',age:void 0,occupation:'',background:'',attributes:{STR:50,CON:50,SIZ:50,DEX:50,APP:50,INT:50,POW:50,EDU:50,LUK:50}}),l=(0,d.ref)([]),c=(0,d.ref)(''),i=(0,d.ref)(''),u=(0,d.ref)(''),m=['侦探','记者','医生','教授','警察','士兵','艺术家','作家','律师','商人','工程师','科学家','神秘学家','冒险家','其他'],h=(0,d.computed)(()=>(0,ce.calculateDerivedStats)(r.attributes)),f=(0,d.computed)(()=>{const e=r.name.trim().length>0,t='其他'!==i.value||u.value.trim().length>0;return e&&t&&k.value}),y=(0,d.computed)(()=>4*r.attributes.EDU),S=(0,d.computed)(()=>2*r.attributes.INT),C=(0,d.computed)(()=>l.value.filter(e=>'occupational'===e.pointType).reduce((e,t)=>e+t.value,0)),N=(0,d.computed)(()=>l.value.filter(e=>'interest'===e.pointType).reduce((e,t)=>e+t.value,0)),w=(0,d.computed)(()=>y.value-C.value),E=(0,d.computed)(()=>S.value-N.value),k=(0,d.computed)(()=>w.value>=0&&E.value>=0);function b(e){return{STR:'力量',CON:'体质',SIZ:'体型',DEX:'敏捷',APP:'外貌',INT:'智力',POW:'意志',EDU:'教育',LUK:'幸运'}[e]||e}function V(){const e=(0,ce.generateRandomAttributes)('3d6x5');Object.assign(r.attributes,e),toastr.success('属性已随机生成')}function I(){}function P(){'其他'===i.value?r.occupation='':(r.occupation=i.value,u.value='')}function A(){const e=c.value.trim();e?l.value.some(t=>t.name===e)?toastr.warning('该技能已存在'):(l.value.push({name:e,value:20,pointType:'occupational'}),c.value=''):toastr.warning('请输入技能名称')}async function M(){if(f.value)try{'其他'===i.value&&(r.occupation=u.value.trim());const e=a.editingCharacter?.id||`char_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,t=new Map;l.value.forEach(e=>{t.set(e.name,e.value)});const c=[{id:'head',name:'头部',damage:0,debuffs:[],children:[{id:'eyes',name:'眼睛',parent:'head',damage:0,debuffs:[]},{id:'mouth',name:'嘴巴',parent:'head',damage:0,debuffs:[]},{id:'nose',name:'鼻子',parent:'head',damage:0,debuffs:[]},{id:'ears',name:'耳朵',parent:'head',damage:0,debuffs:[]}]},{id:'torso',name:'躯体',damage:0,debuffs:[],children:[{id:'chest',name:'胸部',parent:'torso',damage:0,debuffs:[]},{id:'abdomen',name:'腹部',parent:'torso',damage:0,debuffs:[]},{id:'back',name:'背部',parent:'torso',damage:0,debuffs:[]}]},{id:'limbs',name:'四肢',damage:0,debuffs:[],children:[{id:'left_arm',name:'左臂',parent:'limbs',damage:0,debuffs:[]},{id:'right_arm',name:'右臂',parent:'limbs',damage:0,debuffs:[]},{id:'left_leg',name:'左腿',parent:'limbs',damage:0,debuffs:[]},{id:'right_leg',name:'右腿',parent:'limbs',damage:0,debuffs:[]}]}],d={id:e,name:r.name,age:r.age,occupation:r.occupation||void 0,background:r.background||void 0,attributes:{...r.attributes},derivedStats:{...h.value},skills:t,bodyParts:c,inventory:[]};let m;if(m='player'===a.characterType?{...d,type:'player'}:{...d,type:'npc',affection:50,isImportant:!1,events:[]},await v.mvuService.saveCharacter(m),a.syncToTavern&&'player'===a.characterType&&await p.updateUserCharacter(m),'player'===a.characterType){if(await n.setPlayer(m),!a.editingCharacter)try{const{realWorldMapService:e}=await Promise.resolve().then(s.bind(s,76));await e.hasMap()||(console.log('[CharacterCreator] 开始生成现实世界地图...'),await e.generateMap(m))}catch(e){console.error('[CharacterCreator] 生成现实世界地图失败:',e),toastr.warning('现实世界地图生成失败，可稍后手动生成')}}else await n.addNPC(m);toastr.success(`角色 ${m.name} 创建成功`),o('created',m),'player'===a.characterType&&(console.log('[CharacterCreator] 触发全局 character_created 事件'),eventEmit('character_created'))}catch(e){console.error('[CharacterCreator] 创建角色失败:',e),toastr.error('创建角色失败')}else k.value?'其他'!==i.value||u.value.trim()?toastr.error('请填写必填项'):toastr.error('请输入自定义职业名称'):toastr.error('技能点分配超出限制，请检查职业点和兴趣点')}return(0,d.onMounted)(()=>{if(a.editingCharacter){r.name=a.editingCharacter.name,r.age=a.editingCharacter.age,r.occupation=a.editingCharacter.occupation||'',r.background=a.editingCharacter.background||'',Object.assign(r.attributes,a.editingCharacter.attributes);const e=a.editingCharacter.occupation||'';m.includes(e)?i.value=e:e&&(i.value='其他',u.value=e);const t=Array.from(a.editingCharacter.skills.entries());l.value=t.map(e=>({name:e[0],value:e[1],pointType:'occupational'}))}}),(t,a)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',ie,[(0,d.createElementVNode)('div',ue,[(0,d.createElementVNode)('h2',de,(0,d.toDisplayString)(e.editingCharacter?'编辑角色':'角色创建'),1),(0,d.createElementVNode)('p',me,'根据 COC7 规则'+(0,d.toDisplayString)(e.editingCharacter?'编辑':'创建')+'你的角色',1)]),(0,d.createElementVNode)('div',ve,[(0,d.createCommentVNode)(' 基本信息 '),(0,d.createElementVNode)('section',pe,[a[12]||(a[12]=(0,d.createElementVNode)('h3',{class:'section-title'},'基本信息',-1)),(0,d.createElementVNode)('div',ge,[(0,d.createElementVNode)('div',he,[a[6]||(a[6]=(0,d.createElementVNode)('label',{class:'form-label'},'姓名 *',-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':a[0]||(a[0]=e=>r.name=e),type:'text',class:'form-input',placeholder:'输入角色姓名'},null,512),[[d.vModelText,r.name]])]),(0,d.createElementVNode)('div',fe,[a[7]||(a[7]=(0,d.createElementVNode)('label',{class:'form-label'},'年龄',-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':a[1]||(a[1]=e=>r.age=e),type:'number',class:'form-input',placeholder:'输入年龄',min:'15',max:'90'},null,512),[[d.vModelText,r.age,void 0,{number:!0}]])]),(0,d.createElementVNode)('div',ye,[a[9]||(a[9]=(0,d.createElementVNode)('label',{class:'form-label'},'职业',-1)),(0,d.withDirectives)((0,d.createElementVNode)('select',{'onUpdate:modelValue':a[2]||(a[2]=e=>i.value=e),class:'form-select',onChange:P},[a[8]||(a[8]=(0,d.createElementVNode)('option',{value:''},'选择职业',-1)),((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(m,e=>(0,d.createElementVNode)('option',{key:e,value:e},(0,d.toDisplayString)(e),9,Se)),64))],544),[[d.vModelSelect,i.value]])]),'其他'===i.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Ce,[a[10]||(a[10]=(0,d.createElementVNode)('label',{class:'form-label'},'自定义职业名称',-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':a[3]||(a[3]=e=>u.value=e),type:'text',class:'form-input',placeholder:'输入职业名称'},null,512),[[d.vModelText,u.value]])])):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createElementVNode)('div',Ne,[a[11]||(a[11]=(0,d.createElementVNode)('label',{class:'form-label'},'背景故事',-1)),(0,d.withDirectives)((0,d.createElementVNode)('textarea',{'onUpdate:modelValue':a[4]||(a[4]=e=>r.background=e),class:'form-textarea',placeholder:'输入角色的背景故事...',rows:'3'},null,512),[[d.vModelText,r.background]])])]),(0,d.createCommentVNode)(' COC7 属性 '),(0,d.createElementVNode)('section',we,[(0,d.createElementVNode)('div',{class:'section-header'},[a[14]||(a[14]=(0,d.createElementVNode)('h3',{class:'section-title'},'COC7 属性',-1)),(0,d.createElementVNode)('button',{class:'btn-secondary',onClick:V},[...a[13]||(a[13]=[(0,d.createElementVNode)('span',{class:'btn-icon'},'🎲',-1),(0,d.createTextVNode)(' 随机生成 ',-1)])])]),(0,d.createElementVNode)('div',Ee,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(r.attributes,(_,e)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e,class:'attribute-item'},[(0,d.createElementVNode)('label',ke,(0,d.toDisplayString)(b(e)),1),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t=>r.attributes[e]=t,type:'number',class:'attribute-input',min:'0',max:'100',onInput:I},null,40,be),[[d.vModelText,r.attributes[e],void 0,{number:!0}]])]))),128))])]),(0,d.createCommentVNode)(' 衍生属性 '),(0,d.createElementVNode)('section',Ve,[a[21]||(a[21]=(0,d.createElementVNode)('h3',{class:'section-title'},'衍生属性（自动计算）',-1)),(0,d.createElementVNode)('div',Ie,[(0,d.createElementVNode)('div',Pe,[a[15]||(a[15]=(0,d.createElementVNode)('span',{class:'stat-label'},'生命值 (HP)',-1)),(0,d.createElementVNode)('span',Ae,(0,d.toDisplayString)(h.value.HP)+' / '+(0,d.toDisplayString)(h.value.maxHP),1)]),(0,d.createElementVNode)('div',$e,[a[16]||(a[16]=(0,d.createElementVNode)('span',{class:'stat-label'},'魔法值 (MP)',-1)),(0,d.createElementVNode)('span',Me,(0,d.toDisplayString)(h.value.MP)+' / '+(0,d.toDisplayString)(h.value.maxMP),1)]),(0,d.createElementVNode)('div',De,[a[17]||(a[17]=(0,d.createElementVNode)('span',{class:'stat-label'},'理智值 (SAN)',-1)),(0,d.createElementVNode)('span',Be,(0,d.toDisplayString)(h.value.SAN)+' / '+(0,d.toDisplayString)(h.value.maxSAN),1)]),(0,d.createElementVNode)('div',_e,[a[18]||(a[18]=(0,d.createElementVNode)('span',{class:'stat-label'},'移动力 (MOV)',-1)),(0,d.createElementVNode)('span',Re,(0,d.toDisplayString)(h.value.MOV),1)]),(0,d.createElementVNode)('div',ze,[a[19]||(a[19]=(0,d.createElementVNode)('span',{class:'stat-label'},'伤害加值 (DB)',-1)),(0,d.createElementVNode)('span',We,(0,d.toDisplayString)(h.value.DB),1)]),(0,d.createElementVNode)('div',xe,[a[20]||(a[20]=(0,d.createElementVNode)('span',{class:'stat-label'},'体格 (BUILD)',-1)),(0,d.createElementVNode)('span',Te,(0,d.toDisplayString)(h.value.BUILD),1)])])]),(0,d.createCommentVNode)(' 技能点分配 '),e.showSkills?((0,d.openBlock)(),(0,d.createElementBlock)('section',Ue,[a[25]||(a[25]=(0,d.createElementVNode)('h3',{class:'section-title'},'技能点分配',-1)),(0,d.createElementVNode)('div',Ge,[(0,d.createElementVNode)('p',Oe,[a[22]||(a[22]=(0,d.createTextVNode)(' 职业技能点: ',-1)),(0,d.createElementVNode)('span',{class:(0,d.normalizeClass)(['points-value',{'points-negative':w.value<0}])},(0,d.toDisplayString)(w.value)+' / '+(0,d.toDisplayString)(y.value),3)]),(0,d.createElementVNode)('p',Le,[a[23]||(a[23]=(0,d.createTextVNode)(' 兴趣技能点: ',-1)),(0,d.createElementVNode)('span',{class:(0,d.normalizeClass)(['points-value',{'points-negative':E.value<0}])},(0,d.toDisplayString)(E.value)+' / '+(0,d.toDisplayString)(S.value),3)])]),(0,d.createElementVNode)('div',Fe,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(l.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.name,class:'skill-item'},[(0,d.createElementVNode)('label',je,(0,d.toDisplayString)(e.name),1),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t=>e.value=t,type:'number',class:'skill-input',min:'0',max:'100'},null,8,He),[[d.vModelText,e.value,void 0,{number:!0}]]),(0,d.withDirectives)((0,d.createElementVNode)('select',{'onUpdate:modelValue':t=>e.pointType=t,class:'skill-type-select'},[...a[24]||(a[24]=[(0,d.createElementVNode)('option',{value:'occupational'},'职业点',-1),(0,d.createElementVNode)('option',{value:'interest'},'兴趣点',-1)])],8,Je),[[d.vModelSelect,e.pointType]]),(0,d.createElementVNode)('button',{class:'btn-remove',onClick:t=>{return a=e.name,void(l.value=l.value.filter(e=>e.name!==a));var a}},'×',8,Xe)]))),128))]),(0,d.createElementVNode)('div',qe,[(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':a[5]||(a[5]=e=>c.value=e),type:'text',class:'form-input',placeholder:'输入技能名称',onKeyup:(0,d.withKeys)(A,['enter'])},null,544),[[d.vModelText,c.value]]),(0,d.createElementVNode)('button',{class:'btn-secondary',onClick:A},'添加技能')])])):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' 操作按钮 '),(0,d.createElementVNode)('div',Ke,[(0,d.createElementVNode)('button',{class:'btn-primary',disabled:!f.value,onClick:M},(0,d.toDisplayString)(e.editingCharacter?'保存修改':e.syncToTavern?'创建并同步到酒馆':'创建角色'),9,Ze)])]))}}),Qe=(0,Q.A)(Ye,[['__scopeId','data-v-6ec1bc54']]),et={class:'character-panel'},tt={class:'panel-content'},at={class:'character-detail'},ot={key:0,class:'detail-content'},nt={class:'detail-section'},rt={class:'detail-header'},lt={class:'detail-title'},st={class:'basic-info'},ct={class:'info-item'},it={class:'info-value'},ut={class:'info-item'},dt={class:'info-value'},mt={class:'background-text'},vt={class:'background-content'},pt={class:'detail-section'},gt={class:'attributes-grid'},ht={class:'attribute-label'},ft={class:'attribute-value'},yt={class:'detail-section'},St={class:'derived-grid'},Ct={class:'derived-item'},Nt={class:'derived-value'},wt={class:'derived-item'},Et={class:'derived-value'},kt={class:'derived-item'},bt={class:'derived-value'},Vt={class:'derived-item'},It={class:'derived-value'},Pt={class:'derived-item'},At={class:'derived-value'},$t={class:'derived-item'},Mt={class:'derived-value'},Dt={class:'detail-section'},Bt={class:'body-parts'},_t=['onClick'],Rt={class:'expand-icon'},zt={class:'part-name'},Wt={key:0,class:'body-part-children'},xt={class:'child-name'},Tt={key:0,class:'debuffs'},Ut={key:1,class:'part-debuffs'},Gt={key:1,class:'empty-detail'},Ot=(0,d.defineComponent)({__name:'CharacterPanel',emits:['close','edit'],setup(e,{emit:t}){const a=t,o=(0,g.m)(),n=(0,d.ref)(new Set);function r(){o.player&&a('edit',o.player)}function l(){a('close')}function s(e){return{STR:'力量',CON:'体质',SIZ:'体型',DEX:'敏捷',APP:'外貌',INT:'智力',POW:'意志',EDU:'教育',LUK:'幸运'}[e]||e}function c(e){return 0===e?'damage-none':e<25?'damage-light':e<50?'damage-moderate':e<75?'damage-heavy':'damage-critical'}return(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',et,[(0,d.createCommentVNode)(' 面板头部 '),(0,d.createElementVNode)('div',{class:'panel-header'},[t[0]||(t[0]=(0,d.createElementVNode)('h2',{class:'panel-title'},'角色管理',-1)),(0,d.createElementVNode)('button',{class:'btn-close',onClick:l},'×')]),(0,d.createCommentVNode)(' 面板内容 '),(0,d.createElementVNode)('div',tt,[(0,d.createCommentVNode)(' 主控角色详情 '),(0,d.createElementVNode)('div',at,[(0,d.unref)(o).player?((0,d.openBlock)(),(0,d.createElementBlock)('div',ot,[(0,d.createCommentVNode)(' 角色基本信息 '),(0,d.createElementVNode)('section',nt,[(0,d.createElementVNode)('div',rt,[(0,d.createElementVNode)('h3',lt,(0,d.toDisplayString)((0,d.unref)(o).player.name),1),(0,d.createElementVNode)('div',{class:'detail-actions'},[(0,d.createElementVNode)('button',{class:'btn-edit',onClick:r},'✏️ 编辑')])]),(0,d.createElementVNode)('div',st,[(0,d.createElementVNode)('div',ct,[t[1]||(t[1]=(0,d.createElementVNode)('span',{class:'info-label'},'年龄:',-1)),(0,d.createElementVNode)('span',it,(0,d.toDisplayString)((0,d.unref)(o).player.age||'-'),1)]),(0,d.createElementVNode)('div',ut,[t[2]||(t[2]=(0,d.createElementVNode)('span',{class:'info-label'},'职业:',-1)),(0,d.createElementVNode)('span',dt,(0,d.toDisplayString)((0,d.unref)(o).player.occupation||'-'),1)])]),(0,d.createElementVNode)('div',mt,[t[3]||(t[3]=(0,d.createElementVNode)('p',{class:'info-label'},'背景故事:',-1)),(0,d.createElementVNode)('p',vt,(0,d.toDisplayString)((0,d.unref)(o).player.background||'暂无背景故事'),1)])]),(0,d.createCommentVNode)(' COC7 属性 '),(0,d.createElementVNode)('section',pt,[t[4]||(t[4]=(0,d.createElementVNode)('h4',{class:'subsection-title'},'COC7 属性',-1)),(0,d.createElementVNode)('div',gt,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)((0,d.unref)(o).player.attributes,(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:t,class:'attribute-item'},[(0,d.createElementVNode)('span',ht,(0,d.toDisplayString)(s(t)),1),(0,d.createElementVNode)('span',ft,(0,d.toDisplayString)(e),1)]))),128))])]),(0,d.createCommentVNode)(' 衍生属性 '),(0,d.createElementVNode)('section',yt,[t[11]||(t[11]=(0,d.createElementVNode)('h4',{class:'subsection-title'},'衍生属性',-1)),(0,d.createElementVNode)('div',St,[(0,d.createElementVNode)('div',Ct,[t[5]||(t[5]=(0,d.createElementVNode)('span',{class:'derived-label'},'生命值 (HP)',-1)),(0,d.createElementVNode)('span',Nt,(0,d.toDisplayString)((0,d.unref)(o).player.derivedStats.HP)+' / '+(0,d.toDisplayString)((0,d.unref)(o).player.derivedStats.maxHP),1)]),(0,d.createElementVNode)('div',wt,[t[6]||(t[6]=(0,d.createElementVNode)('span',{class:'derived-label'},'魔法值 (MP)',-1)),(0,d.createElementVNode)('span',Et,(0,d.toDisplayString)((0,d.unref)(o).player.derivedStats.MP)+' / '+(0,d.toDisplayString)((0,d.unref)(o).player.derivedStats.maxMP),1)]),(0,d.createElementVNode)('div',kt,[t[7]||(t[7]=(0,d.createElementVNode)('span',{class:'derived-label'},'理智值 (SAN)',-1)),(0,d.createElementVNode)('span',bt,(0,d.toDisplayString)((0,d.unref)(o).player.derivedStats.SAN)+' / '+(0,d.toDisplayString)((0,d.unref)(o).player.derivedStats.maxSAN),1)]),(0,d.createElementVNode)('div',Vt,[t[8]||(t[8]=(0,d.createElementVNode)('span',{class:'derived-label'},'移动力 (MOV)',-1)),(0,d.createElementVNode)('span',It,(0,d.toDisplayString)((0,d.unref)(o).player.derivedStats.MOV),1)]),(0,d.createElementVNode)('div',Pt,[t[9]||(t[9]=(0,d.createElementVNode)('span',{class:'derived-label'},'伤害加值 (DB)',-1)),(0,d.createElementVNode)('span',At,(0,d.toDisplayString)((0,d.unref)(o).player.derivedStats.DB),1)]),(0,d.createElementVNode)('div',$t,[t[10]||(t[10]=(0,d.createElementVNode)('span',{class:'derived-label'},'体格 (BUILD)',-1)),(0,d.createElementVNode)('span',Mt,(0,d.toDisplayString)((0,d.unref)(o).player.derivedStats.BUILD),1)])])]),(0,d.createCommentVNode)(' 肢体状态 '),(0,d.createElementVNode)('section',Dt,[t[12]||(t[12]=(0,d.createElementVNode)('h4',{class:'subsection-title'},'肢体状态',-1)),(0,d.createElementVNode)('div',Bt,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)((0,d.unref)(o).player.bodyParts,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:'body-part-group'},[(0,d.createElementVNode)('div',{class:'body-part-header',onClick:t=>{return a=e.id,void(n.value.has(a)?n.value.delete(a):n.value.add(a));var a}},[(0,d.createElementVNode)('span',Rt,(0,d.toDisplayString)(n.value.has(e.id)?'▼':'▶'),1),(0,d.createElementVNode)('span',zt,(0,d.toDisplayString)(e.name),1),(0,d.createElementVNode)('span',{class:(0,d.normalizeClass)(['part-damage',c(e.damage)])},' 损伤: '+(0,d.toDisplayString)(e.damage)+'% ',3)],8,_t),(0,d.createCommentVNode)(' 子部位 '),n.value.has(e.id)&&e.children?((0,d.openBlock)(),(0,d.createElementBlock)('div',Wt,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(e.children,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:'body-part-child'},[(0,d.createElementVNode)('span',xt,(0,d.toDisplayString)(e.name),1),(0,d.createElementVNode)('span',{class:(0,d.normalizeClass)(['child-damage',c(e.damage)])},(0,d.toDisplayString)(e.damage)+'% ',3),e.debuffs&&e.debuffs.length>0?((0,d.openBlock)(),(0,d.createElementBlock)('div',Tt,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(e.debuffs,(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('span',{key:t,class:'debuff-tag'},(0,d.toDisplayString)(e.type),1))),128))])):(0,d.createCommentVNode)('v-if',!0)]))),128))])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 部位 debuff '),e.debuffs&&e.debuffs.length>0?((0,d.openBlock)(),(0,d.createElementBlock)('div',Ut,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(e.debuffs,(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('span',{key:t,class:'debuff-tag'},(0,d.toDisplayString)(e.type),1))),128))])):(0,d.createCommentVNode)('v-if',!0)]))),128))])])])):((0,d.openBlock)(),(0,d.createElementBlock)('div',Gt,[...t[13]||(t[13]=[(0,d.createElementVNode)('p',null,'暂无主控角色',-1)])]))])])]))}}),Lt=(0,Q.A)(Ot,[['__scopeId','data-v-50159846']]),Ft={class:'sprite-layer'},jt=['src','alt'],Ht=(0,d.defineComponent)({__name:'CharacterSprite',setup(e){const t=(0,h.useGameStore)(),o=(0,d.ref)(new Map),n=(0,d.ref)([]),r=new Map;function l(e){return r.has(e)?Promise.resolve(r.get(e)):new Promise((t,a)=>{const o=new Image;o.onload=()=>{r.set(e,o),console.log('[CharacterSprite] 立绘预加载成功:',e),t(o)},o.onerror=()=>{console.error('[CharacterSprite] 立绘预加载失败:',e),a(new Error(`Failed to preload sprite: ${e}`))},o.src=e})}function s(e){return'custom'===e.position?'position-custom':`position-${e.position}`}function c(e){const t={opacity:(e.opacity??1).toString(),transform:`scale(${e.scale??1})`};return'custom'===e.position&&void 0!==e.x&&void 0!==e.y&&(t.left=`${e.x}px`,t.top=`${e.y}px`),t}return(0,d.watch)(()=>t.currentScene.sprites,(e,t)=>{if(!t)return void(n.value=[...e]);const r=new Set(t.map(e=>e.characterId)),s=new Set(e.map(e=>e.characterId));t.forEach(e=>{s.has(e.characterId)||function(e){const t=o.value.get(e);t?a.to(t,{opacity:0,duration:.5,ease:'power2.in',onComplete:()=>{n.value=n.value.filter(t=>t.characterId!==e),o.value.delete(e)}}):n.value=n.value.filter(t=>t.characterId!==e)}(e.characterId)}),e.forEach(e=>{if(r.has(e.characterId)){const r=t.find(t=>t.characterId===e.characterId);r&&r.url!==e.url&&async function(e){const t=n.value.findIndex(t=>t.characterId===e.characterId);if(-1===t)return;try{await l(e.url)}catch(e){console.error('[CharacterSprite] 预加载立绘失败，使用默认加载:',e)}const r=o.value.get(e.characterId);r?a.to(r,{opacity:0,duration:.3,ease:'power2.in',onComplete:()=>{n.value[t]=e,setTimeout(()=>{a.to(r,{opacity:e.opacity??1,duration:.3,ease:'power2.out'})},50)}}):n.value[t]=e}(e)}else!async function(e){try{await l(e.url)}catch(e){console.error('[CharacterSprite] 预加载立绘失败，使用默认加载:',e)}n.value.push(e),setTimeout(()=>{const t=o.value.get(e.characterId);t&&a.fromTo(t,{opacity:0},{opacity:e.opacity??1,duration:.5,ease:'power2.out'})},50)}(e)})},{deep:!0}),(0,d.onMounted)(()=>{t.currentScene.sprites.length>0&&(n.value=[...t.currentScene.sprites])}),(0,d.onBeforeUnmount)(()=>{o.value.forEach(e=>{ne(e)})}),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',Ft,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(n.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.characterId,ref_for:!0,ref:t=>function(e,t){t&&(o.value.set(e,t),oe(t,['opacity','transform']))}(e.characterId,t),class:(0,d.normalizeClass)(['character-sprite',s(e)]),style:(0,d.normalizeStyle)(c(e))},[(0,d.createElementVNode)('img',{src:e.url,alt:`${e.characterId} 立绘`,class:'sprite-image'},null,8,jt)],6))),128))]))}}),Jt=(0,Q.A)(Ht,[['__scopeId','data-v-650574d0']]);const Xt=new class{rollDice(){return ce.zP()}evaluateRoll(e,t){return ce.jj(e,t)}performSkillCheck(e,t){return ce.VW(e,t)}getRollResultText(e){return ce.yD(e)}resolveOpposedRoll(e,t){return ce.iy(e,t)}calculateDerivedStats(e){return ce.calculateDerivedStats(e)}calculateMovement(e){return ce.q7(e)}calculateDamageBonus(e){return ce.jp(e)}generateRandomAttributes(e='3d6x5'){return ce.generateRandomAttributes(e)}calculateDamage(e,t=0){return ce.ST(e,t)}rollDamageBonus(e){if('0'===e||'-1'===e||'-2'===e)return parseInt(e);const t=e.match(/\+?(\d+)d(\d+)/);if(t){const e=parseInt(t[1]),a=parseInt(t[2]);let o=0;for(let t=0;t<e;t++)o+=Math.floor(Math.random()*a)+1;return o}return 0}calculateAttackDamage(e,t,a=0){const o=t+this.rollDamageBonus(e.derivedStats.DB);return this.calculateDamage(o,a)}calculateInitiative(e){return e.attributes.DEX+(Math.floor(10*Math.random())+1)}executeAttack(e,t,a,o,n){const r=this.resolveOpposedRoll(a,o),l={type:'attack',actorId:e.id,targetId:t.id,attackType:'melee',skillUsed:'格斗',roll:r.attackerRoll};if('attacker_wins'===r.result){const a=e.character||e.enemy;if(a){const o=this.calculateAttackDamage(a,n);l.damage=o,l.description=`${e.id} 攻击命中，造成 ${o} 点伤害`,t.currentHP=Math.max(0,t.currentHP-o)}}else'defender_wins'===r.result?l.description=`${t.id} 成功闪避攻击`:l.description='攻击与闪避势均力敌';return l}attemptEscape(e,t){const a=e.character?.attributes.DEX||e.enemy?.attributes.DEX||50,o=t.character?.attributes.DEX||t.enemy?.attributes.DEX||50,n=this.resolveOpposedRoll(a,o),r='attacker_wins'===n.result;return{success:r,roll:n.attackerRoll,consequence:r?void 0:'逃跑失败，敌人获得一次攻击机会'}}resolveCombat(e,t,a=10){try{if(console.log('[COC7 Service] 开始战斗:',e.name,'vs',t.name),!e||!t)throw new Error('战斗参与者数据无效');if(a<=0)throw new Error('最大回合数必须大于 0');const o={id:e.id,character:e,isPlayer:!0,currentHP:e.derivedStats.HP,currentMP:e.derivedStats.MP,currentSAN:e.derivedStats.SAN,statusEffects:[],initiative:this.calculateInitiative(e)},n={id:t.id,enemy:t,isPlayer:!1,currentHP:t.derivedStats.HP,currentMP:t.derivedStats.MP,currentSAN:t.derivedStats.SAN,statusEffects:[],initiative:this.calculateInitiative(t)},r=[];let l=1,s='active';for(;l<=a&&'active'===s;){const e=[],t=o.initiative>=n.initiative?[o,n]:[n,o];for(const a of t){const t=a===o?n:o;if(a.currentHP<=0||t.currentHP<=0)break;const r=a.character?.skills.get('格斗')||a.enemy?.skills.get('格斗')||50,l=t.character?.skills.get('闪避')||t.enemy?.skills.get('闪避')||50,s=this.executeAttack(a,t,r,l,6);e.push(s)}r.push({roundNumber:l,actions:e,timestamp:Date.now()}),o.currentHP<=0?s='defeat':n.currentHP<=0&&(s='victory'),l++}'active'===s&&(s='defeat',console.log('[COC7 Service] 达到最大回合数，战斗结束'));const c={status:s,rounds:r,winner:'victory'===s?e.id:'defeat'===s?t.id:void 0,loser:'victory'===s?t.id:'defeat'===s?e.id:void 0,endTime:Date.now()};return'victory'===s&&t.loot&&(c.rewards={items:t.loot,experience:10*t.derivedStats.HP}),console.log('[COC7 Service] 战斗结束:',s),c}catch(e){throw console.error('[COC7 Service] 战斗解决失败:',e),toastr.error('战斗系统错误'),e}}checkInsanity(e,t){return ce.oA(e,t)}performSanityCheck(e,t){const a=this.performSkillCheck('理智',e.derivedStats.SAN),o='failure'===a.result?t.failure:t.success;return{roll:a,actualLoss:o,insanity:this.checkInsanity(e.derivedStats.SAN,o)}}getSkillValue(e,t,a=50){return e.skills.get(t)||a}setSkillValue(e,t,a){e.skills.set(t,Math.max(0,Math.min(100,a)))}skillImprovement(e){if(this.rollDice()>e){const t=Math.floor(10*Math.random())+1;return{improved:!0,newValue:Math.min(100,e+t)}}return{improved:!1,newValue:e}}},qt=(0,c.defineStore)('combat',()=>{const e=(0,d.ref)(void 0),t=(0,d.ref)(!1),a=(0,d.ref)([]),o=(0,d.computed)(()=>e.value?.id),n=(0,d.computed)(()=>e.value?.currentRound||0),r=(0,d.computed)(()=>e.value?.currentTurn||0),l=(0,d.computed)(()=>e.value?.status||'active'),s=(0,d.computed)(()=>e.value?.participants||[]),c=(0,d.computed)(()=>s.value.filter(e=>e.isPlayer)),i=(0,d.computed)(()=>s.value.filter(e=>!e.isPlayer)),u=(0,d.computed)(()=>{if(e.value)return s.value[e.value.currentTurn]}),m=(0,d.computed)(()=>u.value?.isPlayer||!1),v=(0,d.computed)(()=>e.value?.rounds||[]),p=(0,d.computed)(()=>{if(0!==v.value.length)return v.value[v.value.length-1]}),g=(0,d.computed)(()=>'active'===l.value),h=(0,d.computed)(()=>'victory'===l.value),f=(0,d.computed)(()=>'defeat'===l.value),y=(0,d.computed)(()=>'escaped'===l.value);function S(e){return e+Math.floor(10*Math.random())+1}function C(){if(!e.value)return;const t=c.value.some(e=>e.currentHP>0),a=i.value.some(e=>e.currentHP>0);t?a||E('victory'):E('defeat')}function N(){e.value&&(e.value.currentTurn++,e.value.currentTurn>=s.value.length&&w())}function w(){e.value&&(e.value.currentRound++,e.value.currentTurn=0,function(){if(!e.value)return;s.value.forEach(e=>{e.statusEffects.forEach(t=>{t.effect.damagePerRound&&(e.currentHP=Math.max(0,e.currentHP-t.effect.damagePerRound),console.log(`[Combat Store] ${e.id} 受到 ${t.name} 的 ${t.effect.damagePerRound} 点伤害`)),t.duration>0&&t.duration--}),e.statusEffects=e.statusEffects.filter(e=>0!==e.duration)}),C()}(),console.log(`[Combat Store] 进入第 ${e.value.currentRound} 回合`),toastr.info(`第 ${e.value.currentRound} 回合`))}function E(o){if(e.value)try{switch(e.value.status=o,t.value=!1,a.value.push(e.value),console.log('[Combat Store] 战斗结束:',o),o){case'victory':toastr.success('战斗胜利！');break;case'defeat':toastr.error('战斗失败...');break;case'escaped':toastr.info('成功逃脱')}}catch(e){throw console.error('[Combat Store] 结束战斗失败:',e),e}}return{currentCombat:e,isInCombat:t,combatHistory:a,combatId:o,currentRound:n,currentTurn:r,status:l,participants:s,playerParticipants:c,enemyParticipants:i,currentParticipant:u,isPlayerTurn:m,rounds:v,latestRound:p,isActive:g,isVictory:h,isDefeat:f,isEscaped:y,startCombat:function(a,o,n){try{const r=[];r.push({id:a.id,character:a,isPlayer:!0,currentHP:a.derivedStats.HP,currentMP:a.derivedStats.MP,currentSAN:a.derivedStats.SAN,statusEffects:[],initiative:S(a.attributes.DEX)}),o.forEach(e=>{r.push({id:e.id,enemy:e,isPlayer:!1,currentHP:e.derivedStats.HP,currentMP:e.derivedStats.MP,currentSAN:e.derivedStats.SAN,statusEffects:[],initiative:S(e.attributes.DEX)})}),r.sort((e,t)=>t.initiative-e.initiative),e.value={id:`combat_${Date.now()}`,participants:r,currentRound:1,currentTurn:0,status:'active',rounds:[],startTime:Date.now(),environment:n},t.value=!0,console.log('[Combat Store] 战斗开始:',e.value.id),toastr.warning('战斗开始！')}catch(e){throw console.error('[Combat Store] 开始战斗失败:',e),toastr.error('开始战斗失败'),e}},executeAction:function(t){if(!e.value)throw new Error('当前没有进行中的战斗');try{let a=v.value.find(e=>e.roundNumber===n.value);a||(a={roundNumber:n.value,actions:[],timestamp:Date.now()},e.value.rounds.push(a)),a.actions.push(t),console.log('[Combat Store] 执行行动:',t.type),function(t){if(!e.value)return;if(t.damage&&t.targetId){const e=s.value.find(e=>e.id===t.targetId);e&&(e.currentHP=Math.max(0,e.currentHP-t.damage),console.log(`[Combat Store] ${t.targetId} 受到 ${t.damage} 点伤害`),0===e.currentHP&&console.log(`[Combat Store] ${t.targetId} 已被击败`))}C()}(t),N()}catch(e){throw console.error('[Combat Store] 执行行动失败:',e),toastr.error('执行行动失败'),e}},nextTurn:N,nextRound:w,addStatusEffect:function(e,t){const a=s.value.find(t=>t.id===e);if(!a)throw new Error(`参与者 ${e} 不存在`);a.statusEffects.push(t),console.log(`[Combat Store] ${e} 获得状态效果: ${t.name}`);const o='buff'===t.type?'增益':'减益';toastr.info(`${o}：${t.name}`)},removeStatusEffect:function(e,t){const a=s.value.find(t=>t.id===e);if(!a)throw new Error(`参与者 ${e} 不存在`);const o=a.statusEffects.find(e=>e.id===t);o&&(a.statusEffects=a.statusEffects.filter(e=>e.id!==t),console.log(`[Combat Store] ${e} 失去状态效果: ${o.name}`))},attemptEscape:function(){if(!e.value)throw new Error('当前没有进行中的战斗');const t=Math.random()<.5;return t?(E('escaped'),toastr.success('成功逃脱！')):toastr.warning('逃跑失败！'),t},endCombat:E,getParticipant:function(e){return s.value.find(t=>t.id===e)},updateParticipant:function(e,t){const a=s.value.find(t=>t.id===e);if(!a)throw new Error(`参与者 ${e} 不存在`);Object.assign(a,t),console.log(`[Combat Store] 参与者 ${e} 状态已更新`)},getCombatStats:function(){return e.value?{roundCount:n.value,actionCount:v.value.reduce((e,t)=>e+t.actions.length,0),duration:Date.now()-e.value.startTime,playerHP:c.value.map(e=>({id:e.id,current:e.currentHP,max:e.character?.derivedStats.maxHP||0})),enemyHP:i.value.map(e=>({id:e.id,current:e.currentHP,max:e.enemy?.derivedStats.maxHP||0}))}:null},reset:function(){e.value=void 0,t.value=!1,console.log('[Combat Store] 战斗状态已重置')},clearHistory:function(){a.value=[],console.log('[Combat Store] 战斗历史已清除')}}}),Kt={class:'combat-status-bar'},Zt={class:'combat-status'},Yt={key:0,class:'status-active'},Qt={key:1,class:'status-victory'},ea={key:2,class:'status-defeat'},ta={key:3,class:'status-escaped'},aa={class:'combat-header'},oa={class:'enemies-area'},na={class:'participants-list'},ra={class:'participant-name'},la={class:'participant-stats'},sa={class:'stat-bar hp-bar'},ca={class:'bar-container'},ia={class:'bar-text'},ua={class:'players-area'},da={class:'participants-list'},ma={class:'participant-name'},va={key:0,class:'combat-actions'},pa=['disabled'],ga=['disabled'],ha={key:1,class:'combat-end-actions'},fa=(0,d.defineComponent)({__name:'CombatPanel',emits:['close'],setup(e,{emit:t}){const a=qt(),o=(0,d.ref)(!1);function n(e){const t=e.character?.derivedStats.maxHP||e.enemy?.derivedStats.maxHP||1;return Math.max(0,Math.min(100,e.currentHP/t*100))}function r(e){return a.currentParticipant?.id===e.id}async function l(){if(a.currentCombat&&!o.value)try{o.value=!0;const e=a.playerParticipants[0],t=a.enemyParticipants.find(e=>e.currentHP>0);if(!(e&&t&&e.character&&t.enemy))return void toastr.error('战斗参与者数据异常');const n=Xt.getSkillValue(e.character,'格斗',50),r=Xt.getSkillValue(t.enemy,'闪避',50),l=Xt.executeAttack(e,t,n,r,6);a.executeAction(l),a.isActive||await async function(){try{const e=a.playerParticipants[0];if(!e||!e.character)return;await v.mvuService.updateCharacterStatus('player',{derivedStats:{HP:e.currentHP,MP:e.currentMP,SAN:e.currentSAN,maxHP:e.character.derivedStats.maxHP,maxMP:e.character.derivedStats.maxMP,maxSAN:e.character.derivedStats.maxSAN,MOV:e.character.derivedStats.MOV,DB:e.character.derivedStats.DB,BUILD:e.character.derivedStats.BUILD}})}catch(e){console.error('[Combat Panel] 更新 MVU 变量失败:',e)}}()}catch(e){console.error('[Combat Panel] 攻击失败:',e),toastr.error('攻击失败')}finally{o.value=!1}}const s=t;return(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{class:(0,d.normalizeClass)(['combat-panel',{'combat-ended':!(0,d.unref)(a).isActive}])},[(0,d.createCommentVNode)(' 顶部状态栏 '),(0,d.createElementVNode)('div',Kt,[(0,d.createElementVNode)('div',Zt,[(0,d.unref)(a).isActive?((0,d.openBlock)(),(0,d.createElementBlock)('span',Yt,'进行中')):(0,d.unref)(a).isVictory?((0,d.openBlock)(),(0,d.createElementBlock)('span',Qt,'胜利')):(0,d.unref)(a).isDefeat?((0,d.openBlock)(),(0,d.createElementBlock)('span',ea,'失败')):(0,d.unref)(a).isEscaped?((0,d.openBlock)(),(0,d.createElementBlock)('span',ta,'已逃脱')):(0,d.createCommentVNode)('v-if',!0)])]),(0,d.createCommentVNode)(' 右上角退出按钮 '),(0,d.createElementVNode)('button',{class:'floating-exit-btn-top',title:'退出战斗',onClick:t[0]||(t[0]=e=>s('close'))},'✕'),(0,d.createElementVNode)('div',aa,[(0,d.createElementVNode)('h2',null,'战斗 - 第 '+(0,d.toDisplayString)((0,d.unref)(a).currentRound)+' 回合',1)]),(0,d.createElementVNode)('div',oa,[t[4]||(t[4]=(0,d.createElementVNode)('h3',null,'敌人',-1)),(0,d.createElementVNode)('div',na,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)((0,d.unref)(a).enemyParticipants,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:(0,d.normalizeClass)(['participant enemy',{dead:e.currentHP<=0,active:r(e)}])},[(0,d.createElementVNode)('div',ra,(0,d.toDisplayString)(e.enemy?.name||e.id),1),(0,d.createElementVNode)('div',la,[(0,d.createElementVNode)('div',sa,[t[3]||(t[3]=(0,d.createElementVNode)('label',null,'HP',-1)),(0,d.createElementVNode)('div',ca,[(0,d.createElementVNode)('div',{class:'bar-fill hp',style:(0,d.normalizeStyle)({width:n(e)+'%'})},null,4),(0,d.createElementVNode)('span',ia,(0,d.toDisplayString)(e.currentHP)+' / '+(0,d.toDisplayString)(e.enemy?.derivedStats.maxHP),1)])])])],2))),128))])]),(0,d.createElementVNode)('div',ua,[t[5]||(t[5]=(0,d.createElementVNode)('h3',null,'玩家',-1)),(0,d.createElementVNode)('div',da,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)((0,d.unref)(a).playerParticipants,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:(0,d.normalizeClass)(['participant player',{dead:e.currentHP<=0,active:r(e)}])},[(0,d.createElementVNode)('div',ma,(0,d.toDisplayString)(e.character?.name||e.id),1)],2))),128))])]),(0,d.unref)(a).isActive?((0,d.openBlock)(),(0,d.createElementBlock)('div',va,[(0,d.createElementVNode)('button',{class:'btn-attack',disabled:o.value||!(0,d.unref)(a).isPlayerTurn,onClick:l},(0,d.toDisplayString)(o.value?'处理中...':'攻击'),9,pa),(0,d.createElementVNode)('button',{class:'btn-escape',disabled:o.value,onClick:t[1]||(t[1]=e=>s('close'))},'逃跑',8,ga)])):((0,d.openBlock)(),(0,d.createElementBlock)('div',ha,[(0,d.createElementVNode)('button',{class:'btn-close',onClick:t[2]||(t[2]=e=>s('close'))},'关闭战斗面板')]))],2))}}),ya=(0,Q.A)(fa,[['__scopeId','data-v-08965543']]);const Sa=new class{inferAge(e,t){const a=new RegExp(`${t}.*?(\\d+)岁`),o=e.match(a);if(o)return parseInt(o[1]);const n={幼儿:5,儿童:10,少年:15,少女:16,青年:25,中年:45,老年:65,老人:70,小孩:10,孩子:12};for(const[a,o]of Object.entries(n)){if(new RegExp(`${a}.*?${t}|${t}.*?${a}`).test(e))return o}}inferOccupation(e,t){const a=['医生','护士','教师','学生','警察','军人','商人','工人','农民','记者','作家','艺术家','科学家','工程师','律师','法官','侦探','间谍','杀手','盗贼','僧侣','道士','巫师','猎人','渔夫','厨师','服务员','司机','飞行员','船长'];for(const o of a){if(new RegExp(`${t}.*?${o}|${o}.*?${t}`).test(e))return o}}inferAttributes(e,t,a){const o={STR:50,CON:50,SIZ:50,DEX:50,APP:50,INT:50,POW:50,EDU:50,LUK:50},n=(a,n)=>{const r=new RegExp(`${t}.*?|.*?${t}`),l=e.match(r)?.[0]||e;for(const e of n.high)if(l.includes(e)){o[a]=Math.min(90,o[a]+20);break}for(const e of n.low)if(l.includes(e)){o[a]=Math.max(15,o[a]-20);break}};return n('STR',{high:['强壮','有力','魁梧','健壮','肌肉','力大','孔武'],low:['瘦弱','虚弱','无力','纤细','柔弱']}),n('CON',{high:['健康','强健','结实','精力充沛','体格好'],low:['虚弱','病弱','苍白','憔悴','体弱']}),n('SIZ',{high:['高大','魁梧','壮硕','肥胖','巨大'],low:['瘦小','矮小','娇小','纤细','苗条']}),n('DEX',{high:['敏捷','灵活','迅速','快速','身手矫健','动作敏捷'],low:['笨拙','迟缓','缓慢','行动不便']}),n('APP',{high:['英俊','美丽','漂亮','俊美','清秀','俏丽','帅气','迷人'],low:['丑陋','难看','相貌平平','其貌不扬']}),n('INT',{high:['聪明','智慧','机智','睿智','博学','精明'],low:['愚笨','迟钝','愚蠢','呆滞']}),n('POW',{high:['坚定','果断','意志坚强','冷静','镇定','沉着'],low:['软弱','胆小','懦弱','犹豫','慌张']}),n('EDU',{high:['博学','学识渊博','知识丰富','教授','学者','专家'],low:['无知','文盲','没文化']}),void 0!==a&&(a<15?(o.STR=Math.max(15,o.STR-20),o.SIZ=Math.max(15,o.SIZ-20),o.EDU=Math.max(15,o.EDU-30)):a>=60&&(o.STR=Math.max(15,o.STR-15),o.DEX=Math.max(15,o.DEX-15),o.CON=Math.max(15,o.CON-10),o.EDU=Math.min(90,o.EDU+10))),o.LUK=40+Math.floor(21*Math.random()),o}calculateDerivedStats(e){const t=Math.floor((e.CON+e.SIZ)/10),a=Math.floor(e.POW/5),o=e.POW;let n=8;e.DEX<e.SIZ&&e.STR<e.SIZ?n=7:e.DEX>=e.SIZ&&e.STR>=e.SIZ&&(n=9);const r=e.STR+e.SIZ;let l='0',s=0;return r<=64?(l='-2',s=-2):r<=84?(l='-1',s=-1):r<=124?(l='0',s=0):r<=164?(l='+1d4',s=1):r<=204?(l='+1d6',s=2):(l='+2d6',s=3),{HP:t,maxHP:t,MP:a,maxMP:a,SAN:o,maxSAN:99,MOV:n,DB:l,BUILD:s}}generateSkillsByOccupation(e,t){const a=new Map;if(['闪避','母语','聆听','侦察','说服','心理学','图书馆使用','急救'].forEach(e=>{let o=20;t&&('闪避'===e&&t.DEX?o=Math.floor(t.DEX/2):'母语'===e&&t.EDU?o=t.EDU:'聆听'===e&&t.INT?o=20+Math.floor((t.INT-50)/5):'侦察'===e&&t.INT&&(o=25+Math.floor((t.INT-50)/5))),a.set(e,Math.max(1,Math.min(99,o)))}),e){this.getOccupationSkills(e).forEach(e=>{const t=40+Math.floor(31*Math.random());a.set(e,t)})}return a}getOccupationSkills(e){return{医生:['医学','急救','生物学','心理学','说服','科学（药学）'],护士:['急救','医学','心理学','说服','聆听'],教师:['教育学','心理学','说服','图书馆使用','母语'],学生:['图书馆使用','母语','聆听','侦察'],警察:['射击','格斗','法律','侦察','聆听','追踪'],军人:['射击','格斗','生存','急救','驾驶'],商人:['说服','心理学','会计','估价','谈判'],记者:['说服','心理学','摄影','图书馆使用','聆听'],侦探:['侦察','聆听','追踪','心理学','法律','图书馆使用'],科学家:['科学','图书馆使用','母语','计算机使用'],工程师:['机械维修','电气维修','计算机使用','科学'],律师:['法律','说服','心理学','图书馆使用','母语'],艺术家:['艺术','历史','心理学','说服'],作家:['母语','图书馆使用','心理学','历史'],厨师:['烹饪','化学','生物学'],司机:['驾驶','机械维修','导航'],猎人:['射击','追踪','生存','聆听','侦察','潜行']}[e]||['说服','心理学','聆听']}inferRelationship(e,t){const a={朋友:'朋友',好友:'好友',同事:'同事',同学:'同学',老师:'老师',学生:'学生',上司:'上司',下属:'下属',敌人:'敌人',对手:'对手',陌生人:'陌生人',家人:'家人',亲人:'亲人',父亲:'父亲',母亲:'母亲',兄弟:'兄弟',姐妹:'姐妹'};for(const[o,n]of Object.entries(a)){if(new RegExp(`${t}.*?${o}|${o}.*?${t}`).test(e))return n}}generateNPC(e,t){const a=this.inferAge(e,t)||25+Math.floor(30*Math.random()),o=this.inferOccupation(e,t)||'普通人',n=this.inferAttributes(e,t,a),r=this.calculateDerivedStats(n),l=this.generateSkillsByOccupation(o,n),s=this.inferRelationship(e,t);let c=`${t}，年龄${a}岁，职业是${o}`;return s&&(c+=`，与主角的关系是${s}`),c+='。',{attributes:n,derivedStats:r,occupation:o,age:a,background:c,skills:l,relationship:s}}};var Ca=s(371),Na=s(493);const wa=new class{generateAppearancePrompt(e){if(!e||0===e.length)return'';const t=[...e].sort((e,t)=>{const a=e.importance||(e.isImportant?3:2);return(t.importance||(t.isImportant?3:2))-a});let a='当前场景中的角色：\n';for(const e of t){const t=e.importance||(e.isImportant?3:2),o=this.getFrequencyDescription(t),n=e.character;a+=`- ${n.name}（${n.occupation||'未知职业'}）：${o}\n`,a+=`  背景：${n.background||'无背景信息'}\n`}return a+='\n请根据角色的重要程度合理安排他们的出场和互动。重要程度越高的角色应该越频繁地出现并推动剧情发展。',a}getFrequencyDescription(e){const t={1:'次要角色，仅在必要时出现',2:'普通角色，偶尔出现',3:'重要角色，经常出现',4:'核心角色，频繁出现并推动剧情',5:'主要角色，贯穿整个剧情'};return t[e]||t[2]}shouldNPCAppear(e,t){const a=e.importance||(e.isImportant?3:2),o=e.character,n=.15*a,r=t.includes(o.name)?.3:0,l=this.calculateAbsenceBonus(e),s=Math.min(1,n+r+l);return Math.random()<s}calculateAbsenceBonus(e){const t=e.importance||(e.isImportant?3:2),a=e.appearanceCount||0,o=5*t;return a<.5*o?.2:a<.75*o?.1:0}generateSimpleAppearancePrompt(e){if(!e||0===e.length)return'';return`场景角色：${[...e].sort((e,t)=>{const a=e.importance||(e.isImportant?3:2);return(t.importance||(t.isImportant?3:2))-a}).map(e=>{const t=e.importance||(e.isImportant?3:2),a='★'.repeat(t);return`${e.character.name}(${a})`}).join('、')}。请根据星级（★）合理安排出场频率。`}};const Ea=new class{callbacks={};isStreaming=!1;currentStreamText='';setupStreamListeners(){eventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY,e=>{this.handleIncrementalText(e)}),eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY,e=>{this.handleFullText(e)}),console.log('[Stream Service] 流式传输监听器已设置')}handleIncrementalText(e){this.isStreaming=!0,this.currentStreamText=e,this.callbacks.onIncremental&&this.callbacks.onIncremental(e)}async handleFullText(e){try{this.isStreaming=!1,this.currentStreamText=e,await this.updateNPCAppearanceCounts(e),await this.recordEvents(e),this.callbacks.onComplete&&this.callbacks.onComplete(e)}catch(e){console.error('[Stream Service] 处理完整文本失败:',e),this.callbacks.onError&&this.callbacks.onError(e)}}async updateNPCAppearanceCounts(e){try{const t=(0,Ca.useInstanceStore)(),a=t.currentInstance;if(!a||'active'!==a.status)return;for(const t of a.characters){const a=t.character;if(e.includes(a.name)){const e=t.appearanceCount||0;t.appearanceCount=e+1,console.log(`[Stream Service] NPC ${a.name} 出场次数更新: ${t.appearanceCount}`)}}await t.updateInstance(a.id,{characters:a.characters});try{if(v.mvuService){const e=await v.mvuService.loadGameData();e.instances[a.id]&&(e.instances[a.id].characters=a.characters,await v.mvuService.saveGameData(e))}}catch(e){console.warn('[Stream Service] 保存到 MVU 失败（可能未初始化）:',e)}}catch(e){console.error('[Stream Service] 更新 NPC 出场次数失败:',e)}}async recordEvents(e){try{const t=(0,Ca.useInstanceStore)().currentInstance;if(!t||'active'!==t.status)return;const a=t.characters.filter(t=>e.includes(t.character.name)).map(e=>e.characterId);await Na.eventRecordService.recordEventFromAIOutput(t.id,e,a);try{if(v.mvuService){const e=await v.mvuService.loadGameData();e.instances[t.id]&&(e.instances[t.id].events=t.events,await v.mvuService.saveGameData(e))}}catch(e){console.warn('[Stream Service] 保存事件到 MVU 失败（可能未初始化）:',e)}}catch(e){console.error('[Stream Service] 记录事件失败:',e)}}async sendMessage(e){try{console.log('[Stream Service] 发送消息:',e),await this.injectNPCAppearancePrompt(),await generate({user_input:e,should_stream:!0}),console.log('[Stream Service] 消息已发送，等待 AI 回复')}catch(e){console.error('[Stream Service] 发送消息失败:',e),toastr.error('发送消息失败'),this.callbacks.onError&&this.callbacks.onError(e)}}async injectNPCAppearancePrompt(){try{const e=(0,Ca.useInstanceStore)().currentInstance;if(!e||'active'!==e.status)return;if(!e.characters||0===e.characters.length)return;const t=wa.generateAppearancePrompt(e.characters);if(!t)return;console.log('[Stream Service] 注入 NPC 出场提示词'),injectPrompts([{id:'npc_appearance_control',content:t,position:'in_chat',depth:4,role:'system'}],{once:!0})}catch(e){console.error('[Stream Service] 注入 NPC 出场提示词失败:',e)}}setCallbacks(e){this.callbacks=e,console.log('[Stream Service] 回调函数已设置')}clearCallbacks(){this.callbacks={},console.log('[Stream Service] 回调函数已清除')}getIsStreaming(){return this.isStreaming}getCurrentText(){return this.currentStreamText}async generatePlotBasedOnRoll(e,t,a){try{const o=`玩家进行了${a}，使用技能：${t}，投骰结果：${e}。请根据这个结果生成后续剧情发展。`;await this.sendMessage(o)}catch(e){console.error('[Stream Service] 生成剧情失败:',e),toastr.error('生成剧情失败')}}async generateAreaEvent(e){try{const t=`玩家进入了「${e}」，请描述这个区域的情况和可能发生的事件。`;await this.sendMessage(t)}catch(e){console.error('[Stream Service] 生成区域事件失败:',e),toastr.error('生成区域事件失败')}}};function ka(e){return/[。！？，、；：……]$|\.{2,}$|…+$/.test(e)}function ba(e,t){const a=[];if(e.length<=t)return a.push(e),a;let o=0;for(;o<e.length;){let n=o+t;if(n<e.length){const a=/[。！？.!?]/,r=/[，,、；;]/,l=/\s/;let s=-1,c=0;const i=Math.max(o+Math.floor(.6*t),o+50),u=Math.min(n+Math.floor(.3*t),e.length);for(let t=i;t<u;t++)a.test(e[t])&&c<3?(s=t+1,c=3):r.test(e[t])&&c<2?(s=t+1,c=2):l.test(e[t])&&c<1&&(s=t+1,c=1);s>o&&(n=s)}const r=e.slice(o,n).trim();r&&a.push(r),o=n}return a}function Va(e){const t=function(e){let t=e;return t=t.replace(/```yaml[\s\S]*?```/gi,''),t=t.replace(/```json[\s\S]*?```/gi,''),t=t.replace(/```[\s\S]*?```/g,''),t=t.replace(/`[^`]+`/g,''),t=t.replace(/\{\{[\s\S]*?\}\}/g,''),t=t.replace(/<[^>]+>/g,''),t=t.replace(/([^\n])"([^"]+)"(?!\n)/g,(e,t,a)=>{if(console.log('[textParser] 匹配到引号:',e.substring(0,50)),console.log('[textParser] 前面字符:',t),console.log('[textParser] 对话内容:',a),console.log('[textParser] 是否为对话:',ka(a)),ka(a)){const e=`${t}\n"${a}"\n`;return console.log('[textParser] 替换为:',e.substring(0,50)),e}return e}),t=t.replace(/([^\n])「([^」]+)」(?!\n)/g,(e,t,a)=>ka(a)?`${t}\n「${a}」\n`:e),t=t.replace(/([^\n])『([^』]+)』(?!\n)/g,(e,t,a)=>ka(a)?`${t}\n『${a}』\n`:e),t=t.trim(),t}(e),a='undefined'!=typeof window&&window.innerWidth<768?180:250,o=t.split('\n').map(e=>e.trim()).filter(e=>e.length>0),n=[];for(const e of o){const t=ba(e,a);n.push(...t)}return n}function Ia(e){return Va(e).map(e=>({content:e}))}const Pa={key:0,class:'dialogue-content'},Aa={key:0,class:'continue-hint'},$a={key:1,class:'dialogue-placeholder'},Ma={key:0,class:'custom-input-container'},Da=['onKeydown'],Ba=['disabled'],_a={key:0},Ra={key:1},za=(0,d.defineComponent)({__name:'DialogueBox',emits:['newMessage'],setup(e,{expose:t,emit:a}){const o=(0,h.useGameStore)(),n=(0,g.m)(),r=(0,Ca.useInstanceStore)(),l=a,s=(0,d.ref)(!1),c=(0,d.ref)(''),i=(0,d.ref)(''),u=(0,d.ref)(null),m=(0,d.ref)(null),v=(0,d.ref)(''),p=(0,d.ref)(!1),f=(0,d.ref)(null),y=(0,d.ref)(!1),S=(0,d.ref)([]),C=(0,d.ref)(0),N=(0,d.ref)(null);function w(){o.isStreaming||(C.value<S.value.length-1?(C.value++,k()):(y.value=!0,(0,d.nextTick)(()=>{f.value?.focus()})))}function E(){(0,d.nextTick)(()=>{(0,d.nextTick)(()=>{m.value&&(m.value.scrollTop=m.value.scrollHeight,console.log('[DialogueBox] 滚动到底部，scrollHeight:',m.value.scrollHeight))})})}function k(){if(C.value>=S.value.length)return;const e=S.value[C.value];e.content&&(i.value=e.content,E())}async function b(e){if(!e)return;const t=/\{\{NPC_CREATE:([^}]+)\}\}/g,a=[];let l;for(;null!==(l=t.exec(e));)a.push(l[1].trim());if(0===a.length)return;const s=void 0!==o.currentInstanceId;for(const t of a)try{const a=n.npcList.find(e=>e.name===t);if(a){if(s&&o.currentInstanceId){const e=r.getInstance(o.currentInstanceId),n=e?.characters.some(e=>e.characterId===a.id);n||(await r.addCharacterToInstance(o.currentInstanceId,a,!1),toastr.info(`${t} 加入场景`))}}else{const a=Sa.generateNPC(e,t),l={id:`npc_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,type:'npc',name:t,age:a.age,occupation:a.occupation,background:a.background,relationship:a.relationship,attributes:a.attributes,derivedStats:a.derivedStats,skills:a.skills,bodyParts:[],inventory:[],affection:50,isImportant:!1,events:[]};await n.addNPC(l),s&&o.currentInstanceId&&await r.addCharacterToInstance(o.currentInstanceId,l,!1);const c=[a.occupation,`${a.age}岁`];a.relationship&&c.push(a.relationship),toastr.success(`新角色 ${t}（${c.join('，')}）已生成`)}}catch(e){console.error(`[DialogueBox] 处理角色 ${t} 失败:`,e),toastr.error(`处理角色 ${t} 失败`)}}async function V(e){if(y.value=!1,c.value=e,await b(e),S.value=Ia(e),C.value=0,console.log('[DialogueBox] 原始内容:',e.substring(0,100)+'...'),console.log('[DialogueBox] 解析段落数:',S.value.length),S.value.forEach((e,t)=>{console.log(`[DialogueBox] 段落 ${t+1}:`,e.content.substring(0,50)+(e.content.length>50?'...':''))}),S.value.length>0){const e=S.value[0];i.value=e.content,E(),1===S.value.length&&(y.value=!0,(0,d.nextTick)(()=>{f.value?.focus()}))}else console.warn('[DialogueBox] 解析后没有段落可显示'),i.value=''}function I(){console.log('[DialogueBox] 设置流式传输回调'),Ea.setCallbacks({onIncremental:async e=>{console.log('[DialogueBox] 接收到增量文本，长度:',e.length),e&&e.trim()&&(await async function(e){y.value=!1,c.value=e,await b(e),S.value=Ia(e),C.value=0,console.log('[DialogueBox] 原始内容:',e.substring(0,100)+'...'),console.log('[DialogueBox] 解析段落数:',S.value.length),S.value.forEach((e,t)=>{console.log(`[DialogueBox] 段落 ${t+1}:`,e.content.substring(0,50)+(e.content.length>50?'...':''))}),S.value.length>0?(k(),E()):console.warn('[DialogueBox] 解析后没有段落可显示')}(e),l('newMessage'),s.value&&(console.log('[DialogueBox] 对话框已关闭，自动打开以显示新消息'),s.value=!1))},onComplete:async e=>{console.log('[DialogueBox] 流式传输完成，文本长度:',e.length),e&&e.trim()&&(await V(e),l('newMessage'),s.value&&(console.log('[DialogueBox] 对话框已关闭，自动打开以显示新消息'),s.value=!1))},onError:e=>{console.error('[DialogueBox] 流式传输错误:',e),toastr.error('接收对话失败')}})}async function P(){if(!v.value.trim()||p.value)return;const e=v.value.trim();try{p.value=!0,console.log('[DialogueBox] 用户输入:',e);const t=$('#send_textarea',window.parent.document),a=$('#send_but',window.parent.document);t.length>0&&a.length>0?(t.val(e),t.trigger('input'),console.log('[DialogueBox] 已将内容同步到酒馆输入框'),v.value='',y.value=!1,c.value='等待 AI 回复...',i.value='等待 AI 回复...',a.trigger('click'),console.log('[DialogueBox] 已触发酒馆发送按钮')):(console.error('[DialogueBox] 未找到酒馆输入框或发送按钮'),toastr.error('无法发送消息：未找到酒馆输入框'),v.value=e)}catch(t){console.error('[DialogueBox] 发送消息失败:',t),toastr.error('发送消息失败'),v.value=e}finally{p.value=!1}}return t({openDialogue:function(){s.value=!1,N.value&&(c.value=N.value.currentText,i.value=N.value.displayText,S.value=N.value.paragraphs,C.value=N.value.currentParagraphIndex,console.log('[DialogueBox] 打开对话框，已恢复状态'))}}),(0,d.onMounted)(async()=>{console.log('[DialogueBox] 组件开始挂载'),I(),await async function(){try{console.log('[DialogueBox] 开始加载最新消息...');const e=getChatMessages(-1);if(e&&e.length>0){const t=e[0];console.log('[DialogueBox] 最后一条消息:',{role:t.role,message_id:t.message_id,content:t.message.substring(0,50)+'...'}),'assistant'!==t.role&&'system'!==t.role||!t.message?'user'===t.role&&(console.log('[DialogueBox] 最后一条是用户消息，等待 AI 回复'),c.value='等待 AI 回复...',i.value='等待 AI 回复...'):(console.log('[DialogueBox] 显示最新的 AI 消息'),await V(t.message))}else console.log('[DialogueBox] 未找到任何消息，显示欢迎信息'),c.value='欢迎来到无限流世界',i.value='欢迎来到无限流世界';E()}catch(e){console.error('[DialogueBox] 加载最新消息失败:',e)}}(),console.log('[DialogueBox] 组件挂载完成')}),(0,d.watch)(()=>o.mode,(e,t)=>{console.log('[DialogueBox] 游戏模式变化:',t,'->',e),'main'===e&&'main'!==t&&(console.log('[DialogueBox] 返回主游戏模式，重新设置流式传输回调'),I())}),(0,d.onBeforeUnmount)(()=>{console.log('[DialogueBox] 组件即将卸载'),console.log('[DialogueBox] 组件卸载完成（保留流式传输回调）')}),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',null,[s.value?(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:0,class:'dialogue-box',onClick:w},[(0,d.createCommentVNode)(' 对话显示 '),(0,d.createElementVNode)('div',{ref_key:'dialogueDisplayRef',ref:m,class:'dialogue-display'},[c.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Pa,[(0,d.createElementVNode)('div',{ref_key:'dialogueTextRef',ref:u,class:'dialogue-text'},(0,d.toDisplayString)(i.value),513),C.value<S.value.length-1?((0,d.openBlock)(),(0,d.createElementBlock)('div',Aa,'点击继续')):(0,d.createCommentVNode)('v-if',!0)])):((0,d.openBlock)(),(0,d.createElementBlock)('div',$a,[...t[1]||(t[1]=[(0,d.createElementVNode)('p',null,'欢迎来到无限流世界',-1),(0,d.createElementVNode)('p',{class:'hint'},'正在加载最新消息...',-1)])]))],512),(0,d.createCommentVNode)(' 自定义输入框 - 只在 AI 输出完成且所有段落显示完毕后显示 '),y.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Ma,[(0,d.withDirectives)((0,d.createElementVNode)('textarea',{ref_key:'customInputRef',ref:f,'onUpdate:modelValue':t[0]||(t[0]=e=>v.value=e),class:'custom-input-field',placeholder:'输入你的回复...',onKeydown:(0,d.withKeys)((0,d.withModifiers)(P,['ctrl']),['enter'])},null,40,Da),[[d.vModelText,v.value]]),(0,d.createElementVNode)('button',{class:'custom-send-button',disabled:!v.value.trim()||p.value,onClick:P},[p.value?((0,d.openBlock)(),(0,d.createElementBlock)('span',Ra,'发送中...')):((0,d.openBlock)(),(0,d.createElementBlock)('span',_a,'发送'))],8,Ba)])):(0,d.createCommentVNode)('v-if',!0)]))]))}}),Wa=(0,Q.A)(za,[['__scopeId','data-v-528d5549']]),xa={class:'skill-selection'},Ta=['disabled'],Ua=['value'],Ga={class:'roll-actions'},Oa=['disabled'],La=['disabled'],Fa={key:0,class:'roll-result'},ja={class:'dice-value'},Ha={class:'result-info'},Ja={class:'result-details'},Xa=['disabled'],qa=(0,d.defineComponent)({__name:'DiceRoller',emits:['close'],setup(e,{emit:t}){const a=(0,g.m)(),o=(0,d.ref)(''),n=(0,d.ref)(null),r=(0,d.ref)(!1),l=(0,d.ref)(!1),s=(0,d.ref)(''),c=(0,d.ref)(),i=(0,d.ref)(),u=(0,d.ref)(),m=(0,d.ref)(),v=(0,d.computed)(()=>{if(!a.player)return[];const e=[];return a.player.skills instanceof Map?a.player.skills.forEach((t,a)=>{e.push({name:a,value:t})}):a.player.skills&&'object'==typeof a.player.skills&&Object.entries(a.player.skills).forEach(([t,a])=>{e.push({name:t,value:a})}),0===e.length&&e.push({name:'侦查',value:50},{name:'聆听',value:50},{name:'图书馆使用',value:50},{name:'说服',value:50},{name:'格斗',value:50},{name:'闪避',value:50}),e.sort((e,t)=>e.name.localeCompare(t.name))});async function p(){if(o.value&&!r.value)try{r.value=!0;const e=v.value.find(e=>e.name===o.value)?.value||50;if(c.value&&te(c.value),m.value){const e=20,t=1/e;for(let a=0;a<e;a++)if(await new Promise(e=>setTimeout(e,1e3*t)),m.value){const e=Math.floor(100*Math.random())+1;m.value.querySelector('.dice-value').textContent=e.toString()}}const t=Xt.performSkillCheck(o.value,e);if(n.value=t,m.value){const e=m.value.querySelector('.dice-value');e&&(e.textContent=t.roll.toString(),'critical_success'===t.result?ae(m.value,15,.5):'critical_failure'===t.result&&ae(m.value,20,.8))}console.log('[Dice Roller] 投骰结果:',t),toastr.info(`${o.value} 检定: ${(0,ce.yD)(t.result)}`)}catch(e){console.error('[Dice Roller] 投骰失败:',e),toastr.error('投骰失败')}finally{r.value=!1}}async function h(){i.value&&te(i.value),n.value=null,await new Promise(e=>setTimeout(e,200)),await p()}async function f(){if(n.value&&!l.value)try{l.value=!0,u.value&&te(u.value);const e=(0,ce.yD)(n.value.result),t=n.value.skillName||o.value;await Ea.generatePlotBasedOnRoll(e,t,s.value||'进行检定'),console.log('[Dice Roller] 开始生成剧情'),toastr.success('开始生成剧情，返回主界面'),await new Promise(e=>setTimeout(e,500)),y('close')}catch(e){console.error('[Dice Roller] 生成剧情失败:',e),toastr.error('生成剧情失败')}finally{l.value=!1}}const y=t;return v.value.length>0&&(o.value=v.value[0].name),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{class:(0,d.normalizeClass)(['dice-roller',{'is-rolling':r.value}])},[(0,d.createCommentVNode)(' 投骰器标题 '),t[2]||(t[2]=(0,d.createElementVNode)('div',{class:'roller-header'},[(0,d.createElementVNode)('h3',null,'技能检定')],-1)),(0,d.createCommentVNode)(' 技能选择 '),(0,d.createElementVNode)('div',xa,[t[1]||(t[1]=(0,d.createElementVNode)('label',{for:'skill-select'},'选择技能：',-1)),(0,d.withDirectives)((0,d.createElementVNode)('select',{id:'skill-select','onUpdate:modelValue':t[0]||(t[0]=e=>o.value=e),disabled:r.value},[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(v.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('option',{key:e.name,value:e.name},(0,d.toDisplayString)(e.name)+' ('+(0,d.toDisplayString)(e.value)+') ',9,Ua))),128))],8,Ta),[[d.vModelSelect,o.value]])]),(0,d.createCommentVNode)(' 投骰按钮 '),(0,d.createElementVNode)('div',Ga,[(0,d.createElementVNode)('button',{ref_key:'rollButtonRef',ref:c,class:'btn-roll',disabled:!o.value||r.value,onClick:p},(0,d.toDisplayString)(r.value?'投骰中...':'投骰'),9,Oa),n.value?((0,d.openBlock)(),(0,d.createElementBlock)('button',{key:0,ref_key:'rerollButtonRef',ref:i,class:'btn-reroll',disabled:r.value,onClick:h},' 重新投掷 ',8,La)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' 投骰结果显示 '),(0,d.createVNode)(d.Transition,{name:'fade'},{default:(0,d.withCtx)(()=>[n.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Fa,[(0,d.createElementVNode)('div',{ref_key:'diceDisplayRef',ref:m,class:'dice-display'},[(0,d.createElementVNode)('div',ja,(0,d.toDisplayString)(n.value.roll),1)],512),(0,d.createElementVNode)('div',Ha,[(0,d.createElementVNode)('div',{class:(0,d.normalizeClass)(['result-level',`result-${n.value.result}`])},(0,d.toDisplayString)((0,d.unref)(ce.yD)(n.value.result)),3),(0,d.createElementVNode)('div',Ja,[(0,d.createElementVNode)('span',null,'技能值: '+(0,d.toDisplayString)(n.value.skill),1),(0,d.createElementVNode)('span',null,'投骰: '+(0,d.toDisplayString)(n.value.roll),1)])]),(0,d.createCommentVNode)(' 生成剧情按钮 '),(0,d.createElementVNode)('button',{ref_key:'generateButtonRef',ref:u,class:'btn-generate',disabled:l.value,onClick:f},(0,d.toDisplayString)(l.value?'生成中...':'根据结果生成剧情'),9,Xa)])):(0,d.createCommentVNode)('v-if',!0)]),_:1})],2))}}),Ka=(0,Q.A)(qa,[['__scopeId','data-v-6a8485b2']]);var Za=s(877);const Ya={class:'instance-generator'},Qa={class:'generator-container'},eo={class:'generator-content'},to={class:'form-group'},ao={class:'difficulty-selector'},oo=['onClick'],no={class:'form-group'},ro={class:'form-group'},lo={class:'form-group npc-management'},so={class:'npc-list'},co={key:0,class:'npc-empty'},io={class:'npc-info'},uo={class:'npc-name'},mo={class:'npc-occupation'},vo={class:'npc-controls'},po=['onUpdate:modelValue'],go=['onClick'],ho={class:'npc-actions'},fo=['disabled'],yo={key:0},So={key:1},Co=['disabled'],No={class:'button-group'},wo=['disabled'],Eo={key:0},ko={key:1},bo=['disabled'],Vo={key:0},Io={key:1},Po={key:0,class:'generation-progress'},Ao={class:'progress-text'},$o={key:1,class:'generation-result'},Mo={class:'result-success'},Do={key:0,class:'custom-npc-dialog'},Bo={class:'dialog-content'},_o={class:'dialog-actions'},Ro=['disabled'],zo={key:0},Wo={key:1},xo=(0,d.defineComponent)({__name:'InstanceGenerator',emits:['close'],setup(e,{emit:t}){const a=t,o=(0,h.useGameStore)(),n=(0,d.ref)(3),r=(0,d.ref)(''),l=(0,d.ref)(''),s=(0,d.ref)(!1),c=(0,d.ref)(''),i=(0,d.ref)(''),u=(0,d.ref)([]),m=(0,d.ref)(!1),v=(0,d.ref)(!1),p=(0,d.ref)(''),g=(0,d.ref)(null),f=(0,d.ref)(null),y=(0,d.ref)(null),S=(0,d.ref)(null),C=(0,d.ref)(null),N=(0,d.ref)(null);async function w(){C.value&&te(C.value);try{m.value=!0;const e=await Za.n.generateRandom(r.value||void 0);u.value.push({id:e.id,characterId:e.id,character:e,importance:2,appearanceCount:0,isImportant:!1}),toastr.success(`NPC ${e.name} 生成成功`)}catch(e){console.error('[Instance Generator] 生成 NPC 失败:',e),toastr.error('生成 NPC 失败，请重试')}finally{m.value=!1}}function E(){N.value&&te(N.value),v.value=!0,p.value=''}function k(){v.value=!1,p.value=''}async function b(){if(p.value.trim())try{m.value=!0;const e=await Za.n.generateCustom(p.value,r.value||void 0);u.value.push({id:e.id,characterId:e.id,character:e,importance:2,appearanceCount:0,isImportant:!1}),toastr.success(`NPC ${e.name} 生成成功`),k()}catch(e){console.error('[Instance Generator] 生成自定义 NPC 失败:',e),toastr.error('生成 NPC 失败，请重试')}finally{m.value=!1}else toastr.warning('请输入 NPC 描述')}async function V(){f.value&&te(f.value);try{s.value=!0,c.value='正在生成副本...',i.value='';const e={difficulty:n.value,npcs:u.value};r.value&&(e.type=r.value);const t=await o.generateInstance(e);i.value=t,c.value='副本生成完成！'}catch(e){console.error('[Instance Generator] 生成副本失败:',e),toastr.error('生成副本失败，请重试')}finally{s.value=!1}}async function I(){if(l.value.trim()){y.value&&te(y.value);try{s.value=!0,c.value='正在根据提示词生成副本...',i.value='';const e={difficulty:n.value,customPrompt:l.value,npcs:u.value};r.value&&(e.type=r.value);const t=await o.generateInstance(e);i.value=t,c.value='副本生成完成！'}catch(e){console.error('[Instance Generator] 生成副本失败:',e),toastr.error('生成副本失败，请重试')}finally{s.value=!1}}else toastr.warning('请输入自定义提示词')}async function P(){if(i.value){S.value&&te(S.value);try{await o.setMode('main'),toastr.success('已进入副本'),n.value=3,r.value='',l.value='',i.value='',c.value='',u.value=[],v.value=!1,p.value='',a('close')}catch(e){console.error('[Instance Generator] 进入副本失败:',e),toastr.error('进入副本失败')}}}function A(){g.value&&te(g.value),a('close')}return(0,d.onMounted)(()=>{document.querySelectorAll('.btn, .difficulty-btn').forEach(e=>{oe(e,['transform','box-shadow'])})}),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',Ya,[(0,d.createElementVNode)('div',Qa,[(0,d.createElementVNode)('button',{ref_key:'closeButtonRef',ref:g,class:'close-btn',title:'关闭',onClick:A},'✕',512),t[14]||(t[14]=(0,d.createElementVNode)('h2',{class:'generator-title'},'副本生成器',-1)),(0,d.createElementVNode)('div',eo,[(0,d.createCommentVNode)(' 难度选择 '),(0,d.createElementVNode)('div',to,[t[3]||(t[3]=(0,d.createElementVNode)('label',{for:'difficulty'},'难度选择',-1)),(0,d.createElementVNode)('div',ao,[((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(5,e=>(0,d.createElementVNode)('button',{key:e,class:(0,d.normalizeClass)(['difficulty-btn',{active:n.value===e}]),onClick:t=>n.value=e},(0,d.toDisplayString)(e),11,oo)),64))])]),(0,d.createCommentVNode)(' 副本类型 '),(0,d.createElementVNode)('div',no,[t[5]||(t[5]=(0,d.createElementVNode)('label',{for:'type'},'副本类型（可选）',-1)),(0,d.withDirectives)((0,d.createElementVNode)('select',{id:'type','onUpdate:modelValue':t[0]||(t[0]=e=>r.value=e),class:'form-control'},[...t[4]||(t[4]=[(0,d.createStaticVNode)('<option value="" data-v-09d22cd3>随机</option><option value="恐怖" data-v-09d22cd3>恐怖</option><option value="修仙" data-v-09d22cd3>修仙</option><option value="现代" data-v-09d22cd3>现代</option><option value="科幻" data-v-09d22cd3>科幻</option><option value="奇幻" data-v-09d22cd3>奇幻</option><option value="武侠" data-v-09d22cd3>武侠</option><option value="末日" data-v-09d22cd3>末日</option><option value="推理" data-v-09d22cd3>推理</option>',9)])],512),[[d.vModelSelect,r.value]])]),(0,d.createCommentVNode)(' 自定义提示词 '),(0,d.createElementVNode)('div',ro,[t[6]||(t[6]=(0,d.createElementVNode)('label',{for:'customPrompt'},'自定义提示词（可选）',-1)),(0,d.withDirectives)((0,d.createElementVNode)('textarea',{id:'customPrompt','onUpdate:modelValue':t[1]||(t[1]=e=>l.value=e),class:'form-control',rows:'4',placeholder:'例如：一个发生在废弃医院的恐怖副本，充满了诡异的医疗器械和未知的生物...'},null,512),[[d.vModelText,l.value]])]),(0,d.createCommentVNode)(' NPC 管理区域 '),(0,d.createElementVNode)('div',lo,[t[10]||(t[10]=(0,d.createElementVNode)('label',null,'副本 NPC',-1)),(0,d.createElementVNode)('div',so,[0===u.value.length?((0,d.openBlock)(),(0,d.createElementBlock)('div',co,[...t[7]||(t[7]=[(0,d.createElementVNode)('p',null,'暂无 NPC，点击下方按钮添加',-1)])])):(0,d.createCommentVNode)('v-if',!0),((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(u.value,(e,a)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:'npc-item'},[(0,d.createElementVNode)('div',io,[(0,d.createElementVNode)('span',uo,(0,d.toDisplayString)(e.character.name),1),(0,d.createElementVNode)('span',mo,(0,d.toDisplayString)(e.character.occupation||'未知职业'),1)]),(0,d.createElementVNode)('div',vo,[t[9]||(t[9]=(0,d.createElementVNode)('label',{class:'importance-label'},'重要程度：',-1)),(0,d.withDirectives)((0,d.createElementVNode)('select',{'onUpdate:modelValue':t=>e.importance=t,class:'importance-selector'},[...t[8]||(t[8]=[(0,d.createElementVNode)('option',{value:1},'1 - 次要',-1),(0,d.createElementVNode)('option',{value:2},'2 - 普通',-1),(0,d.createElementVNode)('option',{value:3},'3 - 重要',-1),(0,d.createElementVNode)('option',{value:4},'4 - 核心',-1),(0,d.createElementVNode)('option',{value:5},'5 - 主角',-1)])],8,po),[[d.vModelSelect,e.importance]]),(0,d.createElementVNode)('button',{class:'btn-delete',title:'删除',onClick:e=>function(e){const t=u.value[e];t&&(u.value.splice(e,1),toastr.info(`已删除 NPC ${t.character.name}`))}(a)},'✕',8,go)])]))),128))]),(0,d.createElementVNode)('div',ho,[(0,d.createElementVNode)('button',{ref_key:'randomNPCButtonRef',ref:C,class:'btn btn-secondary',disabled:s.value||m.value,onClick:w},[m.value?((0,d.openBlock)(),(0,d.createElementBlock)('span',So,'生成中...')):((0,d.openBlock)(),(0,d.createElementBlock)('span',yo,'随机生成 NPC'))],8,fo),(0,d.createElementVNode)('button',{ref_key:'customNPCButtonRef',ref:N,class:'btn btn-secondary',disabled:s.value||m.value,onClick:E},' 自定义 NPC ',8,Co)])]),(0,d.createCommentVNode)(' 生成按钮 '),(0,d.createElementVNode)('div',No,[(0,d.createElementVNode)('button',{ref_key:'randomButtonRef',ref:f,class:'btn btn-primary',disabled:s.value,onClick:V},[s.value?((0,d.openBlock)(),(0,d.createElementBlock)('span',ko,'生成中...')):((0,d.openBlock)(),(0,d.createElementBlock)('span',Eo,'随机生成副本'))],8,wo),l.value?((0,d.openBlock)(),(0,d.createElementBlock)('button',{key:0,ref_key:'customButtonRef',ref:y,class:'btn btn-secondary',disabled:s.value,onClick:I},[s.value?((0,d.openBlock)(),(0,d.createElementBlock)('span',Io,'生成中...')):((0,d.openBlock)(),(0,d.createElementBlock)('span',Vo,'使用提示词生成'))],8,bo)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' 生成进度 '),s.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Po,[t[11]||(t[11]=(0,d.createElementVNode)('div',{class:'progress-bar'},[(0,d.createElementVNode)('div',{class:'progress-fill'})],-1)),(0,d.createElementVNode)('p',Ao,(0,d.toDisplayString)(c.value),1)])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 生成结果 '),i.value&&!s.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',$o,[(0,d.createElementVNode)('div',Mo,[t[12]||(t[12]=(0,d.createElementVNode)('i',{class:'icon-check'},null,-1)),t[13]||(t[13]=(0,d.createElementVNode)('p',null,'副本生成成功！',-1)),(0,d.createElementVNode)('button',{ref_key:'enterButtonRef',ref:S,class:'btn btn-success',onClick:P},'进入副本',512)])])):(0,d.createCommentVNode)('v-if',!0)])]),(0,d.createCommentVNode)(' 自定义 NPC 对话框 '),v.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Do,[(0,d.createElementVNode)('div',Bo,[t[15]||(t[15]=(0,d.createElementVNode)('h3',null,'自定义 NPC',-1)),(0,d.withDirectives)((0,d.createElementVNode)('textarea',{'onUpdate:modelValue':t[2]||(t[2]=e=>p.value=e),class:'form-control',rows:'4',placeholder:'描述你想要的 NPC，例如：一个神秘的老人，精通古代魔法，性格古怪但心地善良...'},null,512),[[d.vModelText,p.value]]),(0,d.createElementVNode)('div',_o,[(0,d.createElementVNode)('button',{class:'btn btn-primary',disabled:!p.value.trim()||m.value,onClick:b},[m.value?((0,d.openBlock)(),(0,d.createElementBlock)('span',Wo,'生成中...')):((0,d.openBlock)(),(0,d.createElementBlock)('span',zo,'生成'))],8,Ro),(0,d.createElementVNode)('button',{class:'btn btn-secondary',onClick:k},'取消')])])])):(0,d.createCommentVNode)('v-if',!0)]))}}),To=(0,Q.A)(xo,[['__scopeId','data-v-09d22cd3']]);const Uo=new class{initialized=!1;async initialize(){if(this.initialized)console.log('[Story Review Service] 已经初始化，跳过');else try{console.log('[Story Review Service] 开始初始化...'),await f.apiConfigService.initialize(),this.initialized=!0,console.log('[Story Review Service] 初始化完成')}catch(e){throw console.error('[Story Review Service] 初始化失败:',e),e}}async reviewRealWorldStory(){try{console.log('[Story Review Service] 开始回顾现实世界剧情...');const e=this.getChatHistory();if(0===e.length)return'暂无现实世界剧情记录。';const t=e.map(e=>({role:e.role,content:this.cleanMessages(e.message)})),a=this.buildReviewPrompt(t,'现实世界'),o=f.apiConfigService.getAllConfigs().realWorld,n=await this.generateReview(a,o);return console.log('[Story Review Service] 现实世界剧情回顾生成完成'),n}catch(e){throw console.error('[Story Review Service] 回顾现实世界剧情失败:',e),e}}async reviewInstanceStory(e){try{console.log('[Story Review Service] 开始回顾副本剧情...',e);const t=this.getChatHistory();if(0===t.length)return'暂无副本剧情记录。';const a=t.map(e=>({role:e.role,content:this.cleanMessages(e.message)})),o=e?`副本 ${e}`:'里世界副本',n=this.buildReviewPrompt(a,o),r=f.apiConfigService.getAllConfigs().innerWorld,l=await this.generateReview(n,r);return console.log('[Story Review Service] 副本剧情回顾生成完成'),l}catch(e){throw console.error('[Story Review Service] 回顾副本剧情失败:',e),e}}searchInStory(e){try{if(console.log('[Story Review Service] 搜索关键词:',e),!e||''===e.trim())return[];const t=this.getChatHistory(),a=[];return t.forEach((t,o)=>{const n=this.cleanMessages(t.message);n.toLowerCase().includes(e.toLowerCase())&&a.push({index:o,role:t.role,content:n})}),console.log(`[Story Review Service] 找到 ${a.length} 条匹配结果`),a}catch(e){return console.error('[Story Review Service] 搜索失败:',e),[]}}getChatHistory(){try{return getChatMessages('0-{{lastMessageId}}').map(e=>({role:e.role,message:e.message}))}catch(e){return console.error('[Story Review Service] 获取聊天历史失败:',e),[]}}cleanMessages(e){if(!e)return'';let t=e;return t=t.replace(/<[^>]+>/g,''),t=t.replace(/\{\{[^}]+\}\}/g,''),t=t.replace(/```[\s\S]*?```/g,''),t=t.replace(/`[^`]+`/g,''),t=t.replace(/^#{1,6}\s+/gm,''),t=t.replace(/\*\*([^*]+)\*\*/g,'$1'),t=t.replace(/\*([^*]+)\*/g,'$1'),t=t.replace(/__([^_]+)__/g,'$1'),t=t.replace(/_([^_]+)_/g,'$1'),t=t.replace(/\[([^\]]+)\]/g,''),t=t.replace(/\[memory_event[^\]]*\][\s\S]*?\[\/memory_event\]/g,''),t=t.replace(/\n{3,}/g,'\n\n'),t=t.trim(),t}buildReviewPrompt(e,t){let a=`请根据以下${t}的剧情记录，生成一份简洁的剧情回顾。\n\n`;a+='要求：\n',a+='1. 按时间顺序梳理主要剧情发展\n',a+='2. 突出关键事件和转折点\n',a+='3. 保持客观叙述，不添加主观评价\n',a+='4. 使用简洁明了的语言\n\n',a+='剧情记录：\n\n';return e.slice(-50).forEach((e,t)=>{const o='user'===e.role?'玩家':'AI';a+=`[${t+1}] ${o}：${e.content}\n\n`}),a+='\n请生成剧情回顾：',a}async generateReview(e,t){return await withAPIContext('sanctuary',async()=>{try{console.log('[Story Review Service] 开始生成回顾内容...');const t={ordered_prompts:[{role:'user',content:e}]};console.log('[Story Review Service] 使用归所 API 配置');return await generateRaw(t)}catch(e){throw console.error('[Story Review Service] 生成回顾内容失败:',e),e}})}},Go={class:'plot-review'},Oo={class:'plot-review-header'},Lo={class:'plot-review-controls'},Fo={class:'control-group'},jo={key:0,class:'control-group'},Ho=['value'],Jo={class:'control-group search-group'},Xo={class:'control-group'},qo=['disabled'],Ko={key:0},Zo={key:1},Yo={class:'plot-review-content'},Qo={key:0,class:'ai-review-section'},en={class:'ai-review-header'},tn={class:'ai-review-content'},an={key:1,class:'loading-state'},on={class:'empty-state'},nn={key:0},rn={key:1},ln={class:'messages-list'},sn={class:'message-header'},cn={class:'message-name'},un={class:'message-index'},dn=['onClick'],mn=(0,d.defineComponent)({__name:'PlotReview',props:{instanceId:{}},emits:['close'],setup(e){const t=e,a=(0,Ca.useInstanceStore)(),o=(0,d.ref)([]),n=(0,d.ref)(!1),r=(0,d.ref)(new Set),l=(0,d.ref)('realWorld'),s=(0,d.ref)(''),c=(0,d.ref)(''),i=(0,d.ref)([]),u=(0,d.ref)(''),m=(0,d.ref)(!1),v=(0,d.computed)(()=>a.getAllInstances()),p=(0,d.computed)(()=>c.value&&i.value.length>0?i.value.map(e=>({...o.value[e.index],originalIndex:e.index,isHighlighted:!0})):o.value.map((e,t)=>({...e,originalIndex:t})));async function g(){n.value=!0;try{console.log('[PlotReview] 开始加载消息...');let e=getChatMessages('0-{{lastMessageId}}');if(console.log('[PlotReview] 方法1 获取到',e.length,'条消息'),0===e.length){console.log('[PlotReview] 方法1 失败，尝试方法2...');const t=getChatMessages(-1);if(t&&t.length>0){const a=t[0].message_id;console.log('[PlotReview] 最后一条消息 ID:',a),e=getChatMessages(`0-${a}`),console.log('[PlotReview] 方法2 获取到',e.length,'条消息')}}o.value=e.map((e,t)=>({name:e.name,is_user:'user'===e.role,is_system:'system'===e.role,mes:e.message,send_date:void 0,originalIndex:t})),console.log('[PlotReview] 成功加载',o.value.length,'条消息'),o.value.slice(0,3).forEach((e,t)=>{console.log(`[PlotReview] 消息 ${t}:`,e.name,e.is_user?'(用户)':'(AI)',e.mes.substring(0,50)+'...')})}catch(e){console.error('[PlotReview] 加载消息失败:',e),toastr.error('加载历史记录失败'),o.value=[]}finally{n.value=!1}}function h(){console.log('[PlotReview] 切换世界:',l.value),c.value='',i.value=[],u.value='',g()}function f(){console.log('[PlotReview] 切换副本:',s.value),c.value='',i.value=[],u.value='',g()}function y(){if(!c.value||''===c.value.trim())return i.value=[],void toastr.info('请输入搜索关键词');console.log('[PlotReview] 搜索关键词:',c.value);try{const e=Uo.searchInStory(c.value);i.value=e,0===e.length?toastr.info('未找到匹配的内容'):toastr.success(`找到 ${e.length} 条匹配结果`)}catch(e){console.error('[PlotReview] 搜索失败:',e),toastr.error('搜索失败')}}async function S(){if(!m.value){m.value=!0,u.value='';try{let e;console.log('[PlotReview] 开始生成 AI 回顾...'),await Uo.initialize(),e='realWorld'===l.value?await Uo.reviewRealWorldStory():await Uo.reviewInstanceStory(s.value||void 0),u.value=e,toastr.success('AI 回顾生成完成'),setTimeout(()=>w(),100)}catch(e){console.error('[PlotReview] 生成 AI 回顾失败:',e),toastr.error('生成 AI 回顾失败')}finally{m.value=!1}}}function C(e){if(!e)return'';let t=e;return t=t.replace(/<[^>]+>/g,''),t=t.replace(/\{\{[^}]+\}\}/g,''),t=t.replace(/\{\{NPC_CREATE:[^}]+\}\}/g,''),t=t.replace(/```[\s\S]*?```/g,''),t=t.replace(/`[^`]+`/g,''),t=t.replace(/^#{1,6}\s+/gm,''),t=t.replace(/\*\*([^*]+)\*\*/g,'$1'),t=t.replace(/\*([^*]+)\*/g,'$1'),t=t.replace(/__([^_]+)__/g,'$1'),t=t.replace(/_([^_]+)_/g,'$1'),t=t.replace(/\[([^\]]+)\]/g,''),t=t.replace(/\n{3,}/g,'\n\n'),t=t.trim(),t}async function N(){await g(),toastr.success('已刷新历史记录')}function w(){const e=document.querySelector('.messages-list');e&&e.scrollTo({top:0,behavior:'smooth'})}function E(){const e=document.querySelector('.messages-list');e&&e.scrollTo({top:e.scrollHeight,behavior:'smooth'})}return(0,d.onMounted)(()=>{t.instanceId&&(l.value='innerWorld',s.value=t.instanceId),g()}),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',Go,[(0,d.createElementVNode)('div',Oo,[t[5]||(t[5]=(0,d.createElementVNode)('h2',{class:'plot-review-title'},'📜 剧情回顾',-1)),(0,d.createElementVNode)('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'✕')]),(0,d.createCommentVNode)(' 世界选择器和副本选择器 '),(0,d.createElementVNode)('div',Lo,[(0,d.createElementVNode)('div',Fo,[t[7]||(t[7]=(0,d.createElementVNode)('label',{class:'control-label'},'世界：',-1)),(0,d.withDirectives)((0,d.createElementVNode)('select',{'onUpdate:modelValue':t[1]||(t[1]=e=>l.value=e),class:'world-selector',onChange:h},[...t[6]||(t[6]=[(0,d.createElementVNode)('option',{value:'realWorld'},'现实世界',-1),(0,d.createElementVNode)('option',{value:'innerWorld'},'里世界副本',-1)])],544),[[d.vModelSelect,l.value]])]),(0,d.createCommentVNode)(' 副本选择器（仅在里世界模式下显示） '),'innerWorld'===l.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',jo,[t[9]||(t[9]=(0,d.createElementVNode)('label',{class:'control-label'},'副本：',-1)),(0,d.withDirectives)((0,d.createElementVNode)('select',{'onUpdate:modelValue':t[2]||(t[2]=e=>s.value=e),class:'instance-selector',onChange:f},[t[8]||(t[8]=(0,d.createElementVNode)('option',{value:''},'全部副本',-1)),((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(v.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('option',{key:e.id,value:e.id},(0,d.toDisplayString)(e.name),9,Ho))),128))],544),[[d.vModelSelect,s.value]])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 搜索功能 '),(0,d.createElementVNode)('div',Jo,[(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>c.value=e),type:'text',class:'search-input',placeholder:'搜索关键词...',onKeyup:(0,d.withKeys)(y,['enter'])},null,544),[[d.vModelText,c.value]]),(0,d.createElementVNode)('button',{class:'search-btn',onClick:y},'🔍')]),(0,d.createCommentVNode)(' AI 回顾按钮 '),(0,d.createElementVNode)('div',Xo,[(0,d.createElementVNode)('button',{class:'ai-review-btn',disabled:m.value,onClick:S},[m.value?((0,d.openBlock)(),(0,d.createElementBlock)('span',Zo,'生成中...')):((0,d.openBlock)(),(0,d.createElementBlock)('span',Ko,'✨ AI 回顾'))],8,qo)])]),(0,d.createElementVNode)('div',Yo,[(0,d.createCommentVNode)(' AI 回顾内容 '),u.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Qo,[(0,d.createElementVNode)('div',en,[t[10]||(t[10]=(0,d.createElementVNode)('h3',null,'AI 生成的剧情回顾',-1)),(0,d.createElementVNode)('button',{class:'close-review-btn',onClick:t[4]||(t[4]=e=>u.value='')},'✕')]),(0,d.createElementVNode)('div',tn,(0,d.toDisplayString)(u.value),1)])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 加载状态 '),n.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',an,[...t[11]||(t[11]=[(0,d.createElementVNode)('div',{class:'loading-spinner'},null,-1),(0,d.createElementVNode)('p',null,'加载中...',-1)])])):0===p.value.length?((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:2},[(0,d.createCommentVNode)(' 空状态 '),(0,d.createElementVNode)('div',on,[t[12]||(t[12]=(0,d.createElementVNode)('p',null,'📭',-1)),c.value?((0,d.openBlock)(),(0,d.createElementBlock)('p',nn,'未找到匹配的内容')):((0,d.openBlock)(),(0,d.createElementBlock)('p',rn,'暂无历史记录'))])],2112)):((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:3},[(0,d.createCommentVNode)(' 消息列表 '),(0,d.createElementVNode)('div',ln,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(p.value,(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:t,class:(0,d.normalizeClass)(['message-item',{'is-user':e.is_user,'is-system':e.is_system,'is-highlighted':e.isHighlighted}])},[(0,d.createElementVNode)('div',sn,[(0,d.createElementVNode)('span',cn,(0,d.toDisplayString)(e.name),1),(0,d.createElementVNode)('span',un,'#'+(0,d.toDisplayString)(e.originalIndex+1),1)]),(0,d.createElementVNode)('div',{class:(0,d.normalizeClass)(['message-content',{'is-collapsed':!r.value.has(t)}]),onClick:e=>function(e){r.value.has(e)?r.value.delete(e):r.value.add(e)}(t)},(0,d.toDisplayString)(C(e.mes)),11,dn)],2))),128))])],2112))]),(0,d.createElementVNode)('div',{class:'plot-review-footer'},[(0,d.createElementVNode)('button',{class:'action-btn',onClick:N},[...t[13]||(t[13]=[(0,d.createElementVNode)('span',null,'🔄',-1),(0,d.createElementVNode)('span',null,'刷新',-1)])]),(0,d.createElementVNode)('button',{class:'action-btn',onClick:w},[...t[14]||(t[14]=[(0,d.createElementVNode)('span',null,'⬆️',-1),(0,d.createElementVNode)('span',null,'回到顶部',-1)])]),(0,d.createElementVNode)('button',{class:'action-btn',onClick:E},[...t[15]||(t[15]=[(0,d.createElementVNode)('span',null,'⬇️',-1),(0,d.createElementVNode)('span',null,'回到底部',-1)])])])]))}}),vn=(0,Q.A)(mn,[['__scopeId','data-v-3ee520ab']]),pn={class:'instance-record'},gn={key:0,class:'instance-list-view'},hn={key:0,class:'empty-state'},fn={key:1,class:'instance-list'},yn=['onClick'],Sn={class:'instance-card-header'},Cn={class:'instance-name'},Nn={key:0,class:'draft-badge'},wn={key:1,class:'active-badge'},En={key:2,class:'completed-badge'},kn={class:'instance-info'},bn={class:'info-item'},Vn={class:'info-value'},In={class:'info-item'},Pn={class:'info-value'},An={class:'instance-stats'},$n={class:'stat-item'},Mn={class:'stat-item'},Dn={key:0,class:'stat-item'},Bn={class:'instance-detail-view'},_n={class:'detail-header'},Rn={class:'detail-title'},zn={class:'detail-content'},Wn={class:'detail-section'},xn={class:'info-grid'},Tn={class:'info-row'},Un={class:'info-value'},Gn={class:'info-row'},On={class:'info-value'},Ln={class:'info-row'},Fn={class:'detail-section'},jn={class:'world-setting'},Hn={class:'detail-section'},Jn={class:'section-header'},Xn={class:'section-title'},qn={key:0,class:'empty-characters'},Kn={key:1,class:'characters-list'},Zn=['onClick'],Yn={class:'character-basic'},Qn={class:'character-name'},er={key:0,class:'importance-badge'},tr={key:1,class:'important-badge'},ar={class:'expand-icon'},or={key:0,class:'character-details'},nr={class:'character-info'},rr={key:0,class:'char-occupation'},lr={key:1,class:'char-background'},sr={key:2,class:'char-appearance'},cr={class:'character-actions'},ir=['onClick'],ur={class:'detail-section'},dr={class:'section-title'},mr={key:0,class:'empty-events'},vr={key:1,class:'events-list'},pr={class:'event-header'},gr={class:'event-time'},hr={key:0,class:'event-location'},fr={class:'event-summary'},yr={key:0,class:'event-characters'},Sr={key:0,class:'detail-section'},Cr={class:'section-title'},Nr={class:'mementos-list'},wr={class:'memento-header'},Er={class:'memento-name'},kr={class:'memento-time'},br={class:'memento-description'},Vr={key:1,class:'detail-section'},Ir={class:'ending-text'},Pr={class:'detail-section action-section'},Ar={class:'action-buttons'},$r={class:'plot-review-modal'},Mr={class:'modal-content'},Dr=(0,d.defineComponent)({__name:'InstanceRecord',emits:['close'],setup(e,{emit:t}){const a=t,o=(0,Ca.useInstanceStore)(),n=(0,d.ref)(null),r=(0,d.ref)(new Set),l=(0,d.ref)(!1),c=(0,d.ref)(!1),i=(0,d.computed)(()=>n.value?o.instances.get(n.value):null),u=(0,d.computed)(()=>i.value?[...i.value.events].sort((e,t)=>e.timestamp-t.timestamp):[]);async function m(e){if(n.value)if('npc'===e.type)try{const t=i.value;if(t){const a=o.getInstancesByWorldSetting(t.worldSetting),n=function(e,t){for(const a of t){const t=a.characters.find(t=>t.character.name===e);if(t)return t.character}return null}(e.name,a);n&&(console.log(`[InstanceRecord] 继承角色 ${e.name} 的设定`),toastr.info(`继承了 ${e.name} 在其他副本中的设定`))}await o.addCharacterToInstance(n.value,e,!1),l.value=!1}catch(e){console.error('[InstanceRecord] 添加角色到副本失败:',e)}else console.warn('[InstanceRecord] 只能添加 NPC 角色到副本')}function v(e){const t=new Date(e),a=new Date;return a.getTime()-t.getTime()<864e5&&t.getDate()===a.getDate()?t.toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'}):t.getFullYear()===a.getFullYear()?t.toLocaleDateString('zh-CN',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}):t.toLocaleDateString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'})}function p(){c.value=!0}async function g(){if(!n.value)return;if(confirm('确定要结束这个副本吗？\n\n结束后将：\n- 清除副本的 NPC 数据\n- 清除副本的地图数据\n- 保留事件记录\n- 保留纪念品\n\n此操作不可撤销！'))try{await o.completeInstance(n.value),f.apiConfigService.switchToRealWorld();const{worldBookService:e}=await Promise.resolve().then(s.bind(s,57));await e.activateRealWorldEntries(),toastr.success('副本已完成！事件记录和纪念品已保留。'),n.value=null}catch(e){console.error('[InstanceRecord] 结束副本失败:',e),toastr.error('结束副本失败')}}async function h(){if(n.value)try{f.apiConfigService.switchToRealWorld();const{worldBookService:e}=await Promise.resolve().then(s.bind(s,57));await e.activateRealWorldEntries();const{useGameStore:t}=await Promise.resolve().then(s.bind(s,605)),a=t();await a.setCurrentInstance(null),toastr.info('已关闭副本页面，进度已保存'),n.value=null}catch(e){console.error('[InstanceRecord] 关闭副本页面失败:',e),toastr.error('关闭副本页面失败')}}return(e,t)=>{return(0,d.openBlock)(),(0,d.createElementBlock)('div',pn,[(0,d.createCommentVNode)(' 右上角退出按钮 '),(0,d.createElementVNode)('button',{class:'floating-exit-btn',title:'关闭',onClick:t[0]||(t[0]=e=>a('close'))},'✕'),(0,d.createCommentVNode)(' 副本列表视图 '),n.value?i.value?((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:1},[(0,d.createCommentVNode)(' 副本详情视图 '),(0,d.createElementVNode)('div',Bn,[(0,d.createElementVNode)('div',_n,[(0,d.createElementVNode)('button',{class:'btn-back',onClick:t[1]||(t[1]=e=>n.value=null)},[...t[11]||(t[11]=[(0,d.createElementVNode)('span',{class:'back-icon'},'←',-1),(0,d.createTextVNode)(' 返回列表 ',-1)])]),(0,d.createElementVNode)('h2',Rn,(0,d.toDisplayString)(i.value.name),1)]),(0,d.createElementVNode)('div',zn,[(0,d.createCommentVNode)(' 基本信息 '),(0,d.createElementVNode)('section',Wn,[t[15]||(t[15]=(0,d.createElementVNode)('h3',{class:'section-title'},'基本信息',-1)),(0,d.createElementVNode)('div',xn,[(0,d.createElementVNode)('div',Tn,[t[12]||(t[12]=(0,d.createElementVNode)('span',{class:'info-label'},'类型:',-1)),(0,d.createElementVNode)('span',Un,(0,d.toDisplayString)(i.value.type),1)]),(0,d.createElementVNode)('div',Gn,[t[13]||(t[13]=(0,d.createElementVNode)('span',{class:'info-label'},'难度:',-1)),(0,d.createElementVNode)('span',On,(0,d.toDisplayString)('★'.repeat(i.value.difficulty)),1)]),(0,d.createElementVNode)('div',Ln,[t[14]||(t[14]=(0,d.createElementVNode)('span',{class:'info-label'},'状态:',-1)),(0,d.createElementVNode)('span',{class:(0,d.normalizeClass)(['info-value status-badge',`status-${i.value.status}`])},(0,d.toDisplayString)((s=i.value.status,{draft:'草稿',active:'进行中',completed:'已完成'}[s]||s)),3)])])]),(0,d.createCommentVNode)(' 世界观与背景 '),(0,d.createElementVNode)('section',Fn,[t[16]||(t[16]=(0,d.createElementVNode)('h3',{class:'section-title'},'世界观与背景',-1)),(0,d.createElementVNode)('p',jn,(0,d.toDisplayString)(i.value.worldSetting),1)]),(0,d.createCommentVNode)(' 出场人物 '),(0,d.createElementVNode)('section',Hn,[(0,d.createElementVNode)('div',Jn,[(0,d.createElementVNode)('h3',Xn,'出场人物 ('+(0,d.toDisplayString)(i.value.characters.length)+')',1),(0,d.createElementVNode)('button',{class:'btn-add',onClick:t[2]||(t[2]=e=>l.value=!0)},[...t[17]||(t[17]=[(0,d.createElementVNode)('span',{class:'add-icon'},'+',-1),(0,d.createTextVNode)(' 添加人物 ',-1)])])]),0===i.value.characters.length?((0,d.openBlock)(),(0,d.createElementBlock)('div',qn,[...t[18]||(t[18]=[(0,d.createElementVNode)('p',{class:'empty-text'},'暂无出场人物',-1)])])):((0,d.openBlock)(),(0,d.createElementBlock)('div',Kn,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(i.value.characters,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.characterId,class:(0,d.normalizeClass)(['character-item',{important:e.isImportant}])},[(0,d.createElementVNode)('div',{class:'character-header',onClick:t=>{return a=e.characterId,void(r.value.has(a)?r.value.delete(a):r.value.add(a));var a}},[(0,d.createElementVNode)('div',Yn,[(0,d.createElementVNode)('span',Qn,(0,d.toDisplayString)(e.character.name),1),e.importance?((0,d.openBlock)(),(0,d.createElementBlock)('span',er,(0,d.toDisplayString)('★'.repeat(e.importance)),1)):e.isImportant?((0,d.openBlock)(),(0,d.createElementBlock)('span',tr,'重要')):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createElementVNode)('span',ar,(0,d.toDisplayString)(r.value.has(e.characterId)?'▼':'▶'),1)],8,Zn),r.value.has(e.characterId)?((0,d.openBlock)(),(0,d.createElementBlock)('div',or,[(0,d.createElementVNode)('div',nr,[e.character.occupation?((0,d.openBlock)(),(0,d.createElementBlock)('p',rr,' 职业: '+(0,d.toDisplayString)(e.character.occupation),1)):(0,d.createCommentVNode)('v-if',!0),e.character.background?((0,d.openBlock)(),(0,d.createElementBlock)('p',lr,(0,d.toDisplayString)(e.character.background),1)):(0,d.createCommentVNode)('v-if',!0),e.firstAppearance?((0,d.openBlock)(),(0,d.createElementBlock)('p',sr,' 首次出场: '+(0,d.toDisplayString)(e.firstAppearance),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createElementVNode)('div',cr,[(0,d.createElementVNode)('button',{class:'btn-toggle-important',onClick:t=>async function(e){if(n.value)try{await o.toggleImportantNPC(n.value,e)}catch(e){console.error('[InstanceRecord] 切换角色重要性失败:',e)}}(e.characterId)},(0,d.toDisplayString)(e.isImportant?'取消重要':'设为重要'),9,ir)])])):(0,d.createCommentVNode)('v-if',!0)],2))),128))]))]),(0,d.createCommentVNode)(' 重要事件 '),(0,d.createElementVNode)('section',ur,[(0,d.createElementVNode)('h3',dr,'重要事件 ('+(0,d.toDisplayString)(i.value.events.length)+')',1),0===i.value.events.length?((0,d.openBlock)(),(0,d.createElementBlock)('div',mr,[...t[19]||(t[19]=[(0,d.createElementVNode)('p',{class:'empty-text'},'暂无重要事件记录',-1)])])):((0,d.openBlock)(),(0,d.createElementBlock)('div',vr,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(u.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:'event-item'},[(0,d.createElementVNode)('div',pr,[(0,d.createElementVNode)('span',gr,(0,d.toDisplayString)(v(e.timestamp)),1),e.location?((0,d.openBlock)(),(0,d.createElementBlock)('span',hr,(0,d.toDisplayString)(e.location),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createElementVNode)('p',fr,(0,d.toDisplayString)(e.summary),1),e.involvedCharacters.length>0?((0,d.openBlock)(),(0,d.createElementBlock)('div',yr,[t[20]||(t[20]=(0,d.createElementVNode)('span',{class:'involved-label'},'涉及人物:',-1)),((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(e.involvedCharacters,e=>((0,d.openBlock)(),(0,d.createElementBlock)('span',{key:e,class:'involved-character'},(0,d.toDisplayString)(function(e){if(!i.value)return'未知';const t=i.value.characters.find(t=>t.characterId===e);return t?.character.name||'未知'}(e)),1))),128))])):(0,d.createCommentVNode)('v-if',!0)]))),128))]))]),(0,d.createCommentVNode)(' 纪念品 '),i.value.mementos&&i.value.mementos.length>0?((0,d.openBlock)(),(0,d.createElementBlock)('section',Sr,[(0,d.createElementVNode)('h3',Cr,'纪念品 ('+(0,d.toDisplayString)(i.value.mementos.length)+')',1),(0,d.createElementVNode)('div',Nr,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(i.value.mementos,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:'memento-item'},[(0,d.createElementVNode)('div',wr,[(0,d.createElementVNode)('span',Er,(0,d.toDisplayString)(e.name),1),(0,d.createElementVNode)('span',kr,(0,d.toDisplayString)(v(e.obtainedAt)),1)]),(0,d.createElementVNode)('p',br,(0,d.toDisplayString)(e.description),1)]))),128))])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 结局 '),i.value.ending?((0,d.openBlock)(),(0,d.createElementBlock)('section',Vr,[t[21]||(t[21]=(0,d.createElementVNode)('h3',{class:'section-title'},'副本结局',-1)),(0,d.createElementVNode)('p',Ir,(0,d.toDisplayString)(i.value.ending),1)])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 操作按钮 '),(0,d.createElementVNode)('section',Pr,[(0,d.createElementVNode)('div',Ar,[(0,d.createElementVNode)('button',{class:'action-button plot-review-button',onClick:p},[...t[22]||(t[22]=[(0,d.createElementVNode)('span',{class:'button-icon'},'📜',-1),(0,d.createElementVNode)('span',{class:'button-text'},'剧情回顾',-1)])]),'active'===i.value.status?((0,d.openBlock)(),(0,d.createElementBlock)('button',{key:0,class:'action-button end-instance-button',onClick:g},[...t[23]||(t[23]=[(0,d.createElementVNode)('span',{class:'button-icon'},'🏁',-1),(0,d.createElementVNode)('span',{class:'button-text'},'副本结束',-1)])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createElementVNode)('button',{class:'action-button close-instance-button',onClick:h},[...t[24]||(t[24]=[(0,d.createElementVNode)('span',{class:'button-icon'},'💾',-1),(0,d.createElementVNode)('span',{class:'button-text'},'关闭副本页面',-1)])])])])])])],2112)):(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('div',gn,[t[10]||(t[10]=(0,d.createElementVNode)('div',{class:'record-header'},[(0,d.createElementVNode)('h2',{class:'record-title'},'副本记录'),(0,d.createElementVNode)('p',{class:'record-subtitle'},'查看已进入的副本信息和历史记录')],-1)),0===(0,d.unref)(o).instanceCount?((0,d.openBlock)(),(0,d.createElementBlock)('div',hn,[...t[7]||(t[7]=[(0,d.createElementVNode)('p',{class:'empty-text'},'暂无副本记录',-1),(0,d.createElementVNode)('p',{class:'empty-hint'},'开始游戏后，副本记录将显示在这里',-1)])])):((0,d.openBlock)(),(0,d.createElementBlock)('div',fn,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)((0,d.unref)(o).instanceList,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:(0,d.normalizeClass)(['instance-card',{active:e.isActive}]),onClick:t=>{return a=e.id,n.value=a,void r.value.clear();var a}},[(0,d.createElementVNode)('div',Sn,[(0,d.createElementVNode)('h3',Cn,(0,d.toDisplayString)(e.name),1),'draft'===e.status?((0,d.openBlock)(),(0,d.createElementBlock)('span',Nn,'草稿')):'active'===e.status?((0,d.openBlock)(),(0,d.createElementBlock)('span',wn,'进行中')):'completed'===e.status?((0,d.openBlock)(),(0,d.createElementBlock)('span',En,'已完成')):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createElementVNode)('div',kn,[(0,d.createElementVNode)('span',bn,[t[8]||(t[8]=(0,d.createElementVNode)('span',{class:'info-label'},'类型:',-1)),(0,d.createElementVNode)('span',Vn,(0,d.toDisplayString)(e.type),1)]),(0,d.createElementVNode)('span',In,[t[9]||(t[9]=(0,d.createElementVNode)('span',{class:'info-label'},'难度:',-1)),(0,d.createElementVNode)('span',Pn,(0,d.toDisplayString)('★'.repeat(e.difficulty)),1)])]),(0,d.createElementVNode)('div',An,[(0,d.createElementVNode)('span',$n,(0,d.toDisplayString)(e.characters.length)+' 人物',1),(0,d.createElementVNode)('span',Mn,(0,d.toDisplayString)(e.events.length)+' 事件',1),e.mementos&&e.mementos.length>0?((0,d.openBlock)(),(0,d.createElementBlock)('span',Dn,(0,d.toDisplayString)(e.mementos.length)+' 纪念品 ',1)):(0,d.createCommentVNode)('v-if',!0)])],10,yn))),128))]))])),(0,d.createCommentVNode)(' 剧情回顾弹窗 '),c.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:2,class:'modal-overlay',onClick:t[4]||(t[4]=(0,d.withModifiers)(e=>c.value=!1,['self']))},[(0,d.createElementVNode)('div',$r,[(0,d.createVNode)(vn,{'instance-id':n.value||void 0,onClose:t[3]||(t[3]=e=>c.value=!1)},null,8,['instance-id'])])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 角色创建弹窗 '),l.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:3,class:'modal-overlay',onClick:t[6]||(t[6]=(0,d.withModifiers)(e=>l.value=!1,['self']))},[(0,d.createElementVNode)('div',Mr,[(0,d.createVNode)(Qe,{'sync-to-tavern':!1,'character-type':'npc',onCreated:m,onCancelled:t[5]||(t[5]=e=>l.value=!1)})])])):(0,d.createCommentVNode)('v-if',!0)]);var s}}}),Br=(0,Q.A)(Dr,[['__scopeId','data-v-6a85f072']]);var _r=s(202);const Rr={class:'inventory-panel'},zr={class:'inventory-tabs'},Wr={key:0,class:'inventory-content'},xr={key:0,class:'empty-inventory'},Tr={key:1,class:'items-grid'},Ur=['onClick'],Gr={class:'item-header'},Or={class:'item-name'},Lr={key:0,class:'item-type'},Fr={class:'item-description'},jr={key:0,class:'item-meta'},Hr={class:'item-source'},Jr={key:1,class:'inventory-content'},Xr={key:0,class:'empty-inventory'},qr={key:1,class:'items-grid'},Kr=['onClick'],Zr={class:'item-header'},Yr={class:'item-name'},Qr={key:0,class:'item-type'},el={class:'item-description'},tl={key:0,class:'item-meta'},al={class:'item-source'},ol={key:0,class:'detail-type'},nl={class:'detail-description'},rl={key:1,class:'detail-meta'},ll={key:0},sl={class:'detail-actions'},cl=(0,d.defineComponent)({__name:'InventoryPanel',emits:['close'],setup(e,{emit:t}){const a=(0,_r.useInventoryStore)(),o=(0,d.ref)('realworld'),n=(0,d.ref)(null);function r(e){n.value=e}function l(){n.value&&(toastr.info(`使用了 ${n.value.name}`),n.value=null)}async function s(){if(!n.value)return;const e=n.value,t=e.name;try{'realworld'===o.value?a.removeFromRealWorld(e.id):a.removeFromInstance(e.id),await a.saveToGlobal(),toastr.success(`已丢弃: ${t}`),n.value=null}catch(e){console.error('[InventoryPanel] 丢弃道具失败:',e),toastr.error('丢弃道具失败')}}return(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',Rr,[(0,d.createElementVNode)('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'×'),t[8]||(t[8]=(0,d.createElementVNode)('h2',{class:'panel-title'},'背包',-1)),(0,d.createCommentVNode)(' 标签页切换 '),(0,d.createElementVNode)('div',zr,[(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['tab-btn',{active:'realworld'===o.value}]),onClick:t[1]||(t[1]=e=>o.value='realworld')},' 现实世界 ',2),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['tab-btn',{active:'instance'===o.value}]),onClick:t[2]||(t[2]=e=>o.value='instance')},' 副本背包 ',2)]),(0,d.createCommentVNode)(' 现实世界背包 '),'realworld'===o.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Wr,[0===(0,d.unref)(a).realWorldInventory.items.length?((0,d.openBlock)(),(0,d.createElementBlock)('div',xr,[...t[6]||(t[6]=[(0,d.createElementVNode)('p',null,'背包是空的',-1)])])):((0,d.openBlock)(),(0,d.createElementBlock)('div',Tr,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)((0,d.unref)(a).realWorldInventory.items,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:'item-card',onClick:t=>r(e)},[(0,d.createElementVNode)('div',Gr,[(0,d.createElementVNode)('span',Or,(0,d.toDisplayString)(e.name),1),e.type?((0,d.openBlock)(),(0,d.createElementBlock)('span',Lr,(0,d.toDisplayString)(e.type),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createElementVNode)('p',Fr,(0,d.toDisplayString)(e.description),1),e.fromArea?((0,d.openBlock)(),(0,d.createElementBlock)('div',jr,[(0,d.createElementVNode)('span',Hr,'来源: '+(0,d.toDisplayString)(e.fromArea),1)])):(0,d.createCommentVNode)('v-if',!0)],8,Ur))),128))]))])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 副本背包 '),'instance'===o.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Jr,[0===(0,d.unref)(a).instanceInventory.items.length?((0,d.openBlock)(),(0,d.createElementBlock)('div',Xr,[...t[7]||(t[7]=[(0,d.createElementVNode)('p',null,'背包是空的',-1)])])):((0,d.openBlock)(),(0,d.createElementBlock)('div',qr,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)((0,d.unref)(a).instanceInventory.items,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:'item-card',onClick:t=>r(e)},[(0,d.createElementVNode)('div',Zr,[(0,d.createElementVNode)('span',Yr,(0,d.toDisplayString)(e.name),1),e.type?((0,d.openBlock)(),(0,d.createElementBlock)('span',Qr,(0,d.toDisplayString)(e.type),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createElementVNode)('p',el,(0,d.toDisplayString)(e.description),1),e.fromArea?((0,d.openBlock)(),(0,d.createElementBlock)('div',tl,[(0,d.createElementVNode)('span',al,'来源: '+(0,d.toDisplayString)(e.fromArea),1)])):(0,d.createCommentVNode)('v-if',!0)],8,Kr))),128))]))])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 道具详情模态框 '),n.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:2,class:'item-detail-overlay',onClick:t[5]||(t[5]=e=>n.value=null)},[(0,d.createElementVNode)('div',{class:'item-detail-modal',onClick:t[4]||(t[4]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createElementVNode)('h3',null,(0,d.toDisplayString)(n.value.name),1),n.value.type?((0,d.openBlock)(),(0,d.createElementBlock)('p',ol,'类型: '+(0,d.toDisplayString)(n.value.type),1)):(0,d.createCommentVNode)('v-if',!0),(0,d.createElementVNode)('p',nl,(0,d.toDisplayString)(n.value.description),1),n.value.fromArea?((0,d.openBlock)(),(0,d.createElementBlock)('div',rl,[(0,d.createElementVNode)('p',null,'来源: '+(0,d.toDisplayString)(n.value.fromArea),1),n.value.obtainedAt?((0,d.openBlock)(),(0,d.createElementBlock)('p',ll,'获得时间: '+(0,d.toDisplayString)(new Date(n.value.obtainedAt).toLocaleString()),1)):(0,d.createCommentVNode)('v-if',!0)])):(0,d.createCommentVNode)('v-if',!0),(0,d.createElementVNode)('div',sl,[(0,d.createElementVNode)('button',{class:'btn-action btn-use',onClick:l},'使用'),(0,d.createElementVNode)('button',{class:'btn-action btn-discard',onClick:s},'丢弃'),(0,d.createElementVNode)('button',{class:'btn-action btn-close-detail',onClick:t[3]||(t[3]=e=>n.value=null)},'关闭')])])])):(0,d.createCommentVNode)('v-if',!0)]))}}),il=(0,Q.A)(cl,[['__scopeId','data-v-6284e47b']]),ul={class:'modal-title'},dl={key:0,class:'loading'},ml={key:1,class:'details-content'},vl={class:'detail-section'},pl={class:'detail-section'},gl={key:0,class:'detail-section'},hl={class:'items-list'},fl=['onClick'],yl={class:'item-header'},Sl={class:'item-name'},Cl={key:0,class:'item-type'},Nl={class:'item-description'},wl={key:0,class:'item-actions'},El={key:1,class:'no-items'},kl=(0,d.defineComponent)({__name:'AreaDetailsModal',props:{area:{},isRealWorld:{type:Boolean}},emits:['close','itemPickedUp','detailsGenerated'],setup(e,{emit:t}){const a=e,o=t,n=(0,_r.useInventoryStore)(),r=(0,d.ref)(!1),l=(0,d.ref)(null),c=(0,d.ref)(null);async function i(){if(!c.value||!l.value)return;const e=c.value;try{e.obtainedAt=Date.now(),e.fromArea=a.area.name,a.isRealWorld?n.addToRealWorld(e):n.addToInstance(e);const t=l.value.items.findIndex(t=>t.id===e.id);-1!==t&&l.value.items.splice(t,1),await n.saveToGlobal(),o('itemPickedUp',e.id),toastr.success(`已拾取: ${e.name}`),c.value=null}catch(e){console.error('[AreaDetailsModal] 拾取道具失败:',e),toastr.error('拾取道具失败')}}return(0,d.onMounted)(()=>{!async function(){if(a.area.details)l.value=a.area.details;else{r.value=!0;try{const{areaDetailsService:e}=await Promise.resolve().then(s.bind(s,425)),t=await e.generateDetails(a.area,a.isRealWorld);l.value=t,o('detailsGenerated',t)}catch(e){console.error('[AreaDetailsModal] 加载详细信息失败:',e),toastr.error('加载详细信息失败')}finally{r.value=!1}}}()}),(t,a)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{class:'area-details-modal-overlay',onClick:a[3]||(a[3]=e=>t.$emit('close'))},[(0,d.createElementVNode)('div',{class:'area-details-modal',onClick:a[2]||(a[2]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createElementVNode)('button',{class:'close-btn',onClick:a[0]||(a[0]=e=>t.$emit('close'))},'×'),(0,d.createElementVNode)('h2',ul,(0,d.toDisplayString)(e.area.name),1),r.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',dl,[...a[4]||(a[4]=[(0,d.createElementVNode)('p',null,'正在生成区域详细信息...',-1)])])):l.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',ml,[(0,d.createCommentVNode)(' 环境描述 '),(0,d.createElementVNode)('div',vl,[a[5]||(a[5]=(0,d.createElementVNode)('h3',null,'环境',-1)),(0,d.createElementVNode)('p',null,(0,d.toDisplayString)(l.value.environment),1)]),(0,d.createCommentVNode)(' 氛围描述 '),(0,d.createElementVNode)('div',pl,[a[6]||(a[6]=(0,d.createElementVNode)('h3',null,'氛围',-1)),(0,d.createElementVNode)('p',null,(0,d.toDisplayString)(l.value.atmosphere),1)]),(0,d.createCommentVNode)(' 可获取道具 '),l.value.items&&l.value.items.length>0?((0,d.openBlock)(),(0,d.createElementBlock)('div',gl,[a[7]||(a[7]=(0,d.createElementVNode)('h3',null,'可获取道具',-1)),(0,d.createElementVNode)('div',hl,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(l.value.items,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:(0,d.normalizeClass)(['item-card',{selected:c.value?.id===e.id}]),onClick:t=>function(e){c.value=e,console.log(`[AreaDetailsModal] 选择道具: ${e.name}`)}(e)},[(0,d.createElementVNode)('div',yl,[(0,d.createElementVNode)('span',Sl,(0,d.toDisplayString)(e.name),1),e.type?((0,d.openBlock)(),(0,d.createElementBlock)('span',Cl,(0,d.toDisplayString)(e.type),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createElementVNode)('p',Nl,(0,d.toDisplayString)(e.description),1)],10,fl))),128))]),(0,d.createCommentVNode)(' 拾取和取消按钮 '),c.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',wl,[(0,d.createElementVNode)('button',{class:'btn-action btn-pickup',onClick:i},'拾取'),(0,d.createElementVNode)('button',{class:'btn-action btn-cancel-item',onClick:a[1]||(a[1]=e=>c.value=null)},'取消')])):(0,d.createCommentVNode)('v-if',!0)])):((0,d.openBlock)(),(0,d.createElementBlock)('div',El,[...a[8]||(a[8]=[(0,d.createElementVNode)('p',null,'这里没有可获取的道具',-1)])]))])):(0,d.createCommentVNode)('v-if',!0)])]))}}),bl=(0,Q.A)(kl,[['__scopeId','data-v-3cc40fe2']]),Vl={class:'map-panel'},Il={class:'map-header'},Pl={class:'map-tabs'},Al={key:0,class:'instance-name'},$l={key:0},Ml={key:0,class:'no-map'},Dl={key:1},Bl={key:0,class:'current-area'},_l={class:'area-card current'},Rl={class:'area-name'},zl={key:0,class:'area-description'},Wl={key:1,class:'connected-areas'},xl={class:'areas-list'},Tl=['onClick'],Ul={class:'area-name'},Gl={key:0,class:'area-description'},Ol={key:0,class:'action-buttons'},Ll={key:1},Fl={key:0,class:'no-map'},jl={key:1},Hl={key:0,class:'current-area'},Jl={class:'area-card current'},Xl={class:'area-name'},ql={key:0,class:'area-description'},Kl={key:1,class:'connected-areas'},Zl={class:'areas-list'},Yl=['onClick'],Ql={class:'area-name'},es={key:0,class:'area-description'},ts={key:0,class:'action-buttons'},as=(0,d.defineComponent)({__name:'MapPanel',emits:['close'],setup(e,{emit:t}){const a=t,o=(0,Ca.useInstanceStore)(),n=(0,g.m)(),r=(0,_r.useInventoryStore)(),l=(0,d.ref)(!1),c=(0,d.ref)('realworld'),i=(0,d.ref)(null),u=(0,d.ref)(null),m=(0,d.ref)(null),v=(0,d.ref)(!1),p=(0,d.ref)(null),h=(0,d.ref)(!1),f=(0,d.computed)(()=>{if(!i.value)return null;const e=i.value.playerLocation;return i.value.areas.get(e)||null}),y=(0,d.computed)(()=>f.value?f.value.connectedAreas.map(e=>i.value?.areas.get(e)).filter(e=>void 0!==e):[]);async function S(){try{const{realWorldMapService:e}=await Promise.resolve().then(s.bind(s,76));i.value=await e.loadMap(),console.log('[MapPanel] 现实世界地图加载完成:',i.value?'成功':'未找到')}catch(e){console.error('[MapPanel] 加载现实世界地图失败:',e)}}async function C(){if(n.player)try{toastr.info('正在生成现实世界地图...');const{realWorldMapService:e}=await Promise.resolve().then(s.bind(s,76));i.value=await e.generateMap(n.player),toastr.success('现实世界地图生成成功！')}catch(e){console.error('[MapPanel] 生成现实世界地图失败:',e),toastr.error('生成现实世界地图失败')}else toastr.error('请先创建主控角色')}async function N(){if(!u.value||l.value)return;const e=u.value;try{l.value=!0;const{realWorldMapService:t}=await Promise.resolve().then(s.bind(s,76));await t.updatePlayerLocation(e.id),await S(),u.value=null,toastr.success(`已移动到: ${e.name}`),console.log(`[Map Panel] 已移动到现实世界区域: ${e.name}`)}catch(e){console.error('[Map Panel] 移动失败:',e),toastr.error('移动失败')}finally{l.value=!1}}async function w(){if(l.value)return;const e=n.player?.name||'主控',t=f.value?.name||'当前位置';try{l.value=!0;const o=`${e}在${t}`;console.log(`[Map Panel] 发送确认消息: ${o}`),await generate({user_input:o}),toastr.success('已发送位置信息'),a('close')}catch(e){console.error('[Map Panel] 发送消息失败:',e),toastr.error('发送消息失败')}finally{l.value=!1}}async function E(){if(!m.value||l.value)return;const e=m.value;try{l.value=!0,await o.updatePlayerLocation(e.id),e.isDiscovered||await o.discoverArea(e.id),m.value=null,toastr.success(`已移动到: ${e.name}`),console.log(`[Map Panel] 已移动到副本区域: ${e.name}`)}catch(e){console.error('[Map Panel] 移动失败:',e),toastr.error('移动失败')}finally{l.value=!1}}async function k(){if(l.value)return;const e=n.player?.name||'主控',t=o.currentArea?.name||'当前位置';try{l.value=!0;const o=`${e}在${t}`;console.log(`[Map Panel] 发送确认消息: ${o}`),await generate({user_input:o}),toastr.success('已发送位置信息'),a('close')}catch(e){console.error('[Map Panel] 发送消息失败:',e),toastr.error('发送消息失败')}finally{l.value=!1}}function b(){f.value&&I(f.value,!0)}function V(){o.currentArea&&I(o.currentArea,!1)}function I(e,t){p.value=e,h.value=t,v.value=!0}function P(){v.value=!1,p.value=null}async function A(e){if(p.value)try{if(p.value.details=e,h.value){const{realWorldMapService:e}=await Promise.resolve().then(s.bind(s,76));i.value&&await e.saveMap(i.value)}else await o.saveToMVU();console.log('[MapPanel] 区域详细信息已保存')}catch(e){console.error('[MapPanel] 保存区域详细信息失败:',e)}}async function M(){try{if(h.value){const{realWorldMapService:e}=await Promise.resolve().then(s.bind(s,76));i.value&&await e.saveMap(i.value)}else await o.saveToMVU();console.log('[MapPanel] 地图数据已保存')}catch(e){console.error('[MapPanel] 保存地图数据失败:',e)}}return(0,d.onMounted)(async()=>{try{await S(),await r.loadFromGlobal()}catch(e){console.error('[MapPanel] 初始化失败:',e)}}),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',Vl,[(0,d.createElementVNode)('div',Il,[t[2]||(t[2]=(0,d.createElementVNode)('h2',null,'地图',-1)),(0,d.createElementVNode)('div',Pl,[(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['tab-btn',{active:'realworld'===c.value}]),onClick:t[0]||(t[0]=e=>c.value='realworld')},' 现实世界 ',2),(0,d.unref)(o).currentInstance?((0,d.openBlock)(),(0,d.createElementBlock)('button',{key:0,class:(0,d.normalizeClass)(['tab-btn',{active:'instance'===c.value}]),onClick:t[1]||(t[1]=e=>c.value='instance')},' 副本地图 ',2)):(0,d.createCommentVNode)('v-if',!0)]),'instance'===c.value&&(0,d.unref)(o).currentInstance?((0,d.openBlock)(),(0,d.createElementBlock)('div',Al,(0,d.toDisplayString)((0,d.unref)(o).currentInstance.name),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' 现实世界地图 '),'realworld'===c.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',$l,[i.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Dl,[f.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Bl,[t[4]||(t[4]=(0,d.createElementVNode)('h3',null,'当前位置',-1)),(0,d.createElementVNode)('div',_l,[(0,d.createElementVNode)('div',Rl,(0,d.toDisplayString)(f.value.name),1),f.value.description?((0,d.openBlock)(),(0,d.createElementBlock)('div',zl,(0,d.toDisplayString)(f.value.description),1)):(0,d.createCommentVNode)('v-if',!0),(0,d.createElementVNode)('button',{class:'btn-view-details',onClick:b},'查看详情')])])):(0,d.createCommentVNode)('v-if',!0),y.value.length>0?((0,d.openBlock)(),(0,d.createElementBlock)('div',Wl,[t[5]||(t[5]=(0,d.createElementVNode)('h3',null,'可前往的区域',-1)),(0,d.createElementVNode)('div',xl,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(y.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:(0,d.normalizeClass)(['area-card',{discovered:e.isDiscovered,selected:u.value?.id===e.id}]),onClick:t=>function(e){e.id!==f.value?.id?(u.value=e,m.value=null,console.log(`[Map Panel] 选择现实世界区域: ${e.name}`)):toastr.info('你已经在这个区域了')}(e)},[(0,d.createElementVNode)('div',Ul,(0,d.toDisplayString)(e.isDiscovered?e.name:'???'),1),e.isDiscovered&&e.description?((0,d.openBlock)(),(0,d.createElementBlock)('div',Gl,(0,d.toDisplayString)(e.description),1)):(0,d.createCommentVNode)('v-if',!0)],10,Tl))),128))]),(0,d.createCommentVNode)(' 前进和确认按钮 '),u.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Ol,[(0,d.createElementVNode)('button',{class:'btn-action btn-move',onClick:N},'前进'),(0,d.createElementVNode)('button',{class:'btn-action btn-confirm',onClick:w},'确认')])):(0,d.createCommentVNode)('v-if',!0)])):(0,d.createCommentVNode)('v-if',!0)])):((0,d.openBlock)(),(0,d.createElementBlock)('div',Ml,[t[3]||(t[3]=(0,d.createElementVNode)('p',null,'现实世界地图尚未生成',-1)),(0,d.createElementVNode)('button',{class:'btn-generate',onClick:C},'生成地图')]))])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 副本地图 '),'instance'===c.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Ll,[(0,d.unref)(o).currentInstance?((0,d.openBlock)(),(0,d.createElementBlock)('div',jl,[(0,d.unref)(o).currentArea?((0,d.openBlock)(),(0,d.createElementBlock)('div',Hl,[t[7]||(t[7]=(0,d.createElementVNode)('h3',null,'当前位置',-1)),(0,d.createElementVNode)('div',Jl,[(0,d.createElementVNode)('div',Xl,(0,d.toDisplayString)((0,d.unref)(o).currentArea.name),1),(0,d.unref)(o).currentArea.description?((0,d.openBlock)(),(0,d.createElementBlock)('div',ql,(0,d.toDisplayString)((0,d.unref)(o).currentArea.description),1)):(0,d.createCommentVNode)('v-if',!0),(0,d.createElementVNode)('button',{class:'btn-view-details',onClick:V},'查看详情')])])):(0,d.createCommentVNode)('v-if',!0),(0,d.unref)(o).connectedAreas.length>0?((0,d.openBlock)(),(0,d.createElementBlock)('div',Kl,[t[8]||(t[8]=(0,d.createElementVNode)('h3',null,'可前往的区域',-1)),(0,d.createElementVNode)('div',Zl,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)((0,d.unref)(o).connectedAreas,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:(0,d.normalizeClass)(['area-card',{discovered:e.isDiscovered,selected:m.value?.id===e.id}]),onClick:t=>function(e){e.id!==o.currentArea?.id?(m.value=e,u.value=null,console.log(`[Map Panel] 选择副本区域: ${e.name}`)):toastr.info('你已经在这个区域了')}(e)},[(0,d.createElementVNode)('div',Ql,(0,d.toDisplayString)(e.isDiscovered?e.name:'???'),1),e.isDiscovered&&e.description?((0,d.openBlock)(),(0,d.createElementBlock)('div',es,(0,d.toDisplayString)(e.description),1)):(0,d.createCommentVNode)('v-if',!0)],10,Yl))),128))]),(0,d.createCommentVNode)(' 前进和确认按钮 '),m.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',ts,[(0,d.createElementVNode)('button',{class:'btn-action btn-move',onClick:E},'前进'),(0,d.createElementVNode)('button',{class:'btn-action btn-confirm',onClick:k},'确认')])):(0,d.createCommentVNode)('v-if',!0)])):(0,d.createCommentVNode)('v-if',!0)])):((0,d.openBlock)(),(0,d.createElementBlock)('div',Fl,[...t[6]||(t[6]=[(0,d.createElementVNode)('p',null,'当前没有活跃的副本',-1)])]))])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 区域详情模态框 '),v.value&&p.value?((0,d.openBlock)(),(0,d.createBlock)(bl,{key:2,area:p.value,'is-real-world':h.value,onClose:P,onItemPickedUp:M,onDetailsGenerated:A},null,8,['area','is-real-world'])):(0,d.createCommentVNode)('v-if',!0)]))}}),os=(0,Q.A)(as,[['__scopeId','data-v-4ba1ef10']]);var ns=s(820),rs=s(15);const ls=new class{initialized=!1;async initialize(){if(this.initialized)return void console.log('[Journal Service] 服务已初始化');console.log('[Journal Service] 初始化服务...');await this.getAllJournals()||await this.saveAllJournals([]),this.initialized=!0,console.log('[Journal Service] 服务初始化完成')}async generateJournalDraft(e,t,a){return await withAPIContext('sanctuary',async()=>{try{console.log(`[Journal Service] 为 ${t} 生成日志草稿...`);const o=await this.getRelevantEvents(e,a),n=await this.getRelevantMemories(e,a),r={ordered_prompts:[{role:'user',content:this.buildJournalPrompt(t,o,n,a)}]};console.log('[Journal Service] 使用归所 API 配置');const l=await generateRaw(r);return console.log(`[Journal Service] 日志草稿生成完成，长度: ${l.length}`),l}catch(e){throw console.error('[Journal Service] 生成日志草稿失败:',e),e}})}buildJournalPrompt(e,t,a,o){let n=`你是 ${e}，请以第一人称写一篇内省式的日志。\n\n`;return n+='**写作要求：**\n',n+='1. 使用"留白"美学，通过场景描写和心象风景表达内心状态，避免直接定义情绪\n',n+='2. 不要使用"我感到..."、"我觉得..."等直接表达情感的句式\n',n+='3. 通过具体的意象、场景、感官细节来暗示内心世界\n',n+='4. 保持简洁，字数控制在 200-500 字之间\n',n+='5. 不要总结或解释情感，让读者自己体会\n\n',t.length>0&&(n+='**最近经历的事件：**\n',t.slice(0,5).forEach((e,t)=>{n+=`${t+1}. ${e.summary}\n`}),n+='\n'),a.length>0&&(n+='**重要的记忆：**\n',a.slice(0,5).forEach((e,t)=>{n+=`${t+1}. ${e.description}\n`}),n+='\n'),0===t.length&&0===a.length&&(n+='目前还没有特别的经历或记忆，请写一篇关于当下状态的日志。\n\n'),n+=`现在，请以 ${e} 的视角，写一篇内省式的日志：`,n}async getRelevantEvents(e,t){try{const a=(0,Ca.useInstanceStore)().getAllInstances();if(t){const e=[];for(const t of a)t.events&&t.events.length>0&&e.push(...t.events);return e.sort((e,t)=>t.timestamp-e.timestamp)}{const t=a.filter(t=>t.characters.some(t=>t.characterId===e)),o=[];for(const a of t)if(a.events&&a.events.length>0){const t=a.events.filter(t=>t.involvedCharacters&&t.involvedCharacters.includes(e));o.push(...t)}return o.sort((e,t)=>t.timestamp-e.timestamp)}}catch(e){return console.error('[Journal Service] 获取相关事件失败:',e),[]}}async getRelevantMemories(e,t){try{if(t){const e=await m.z.getAllArchives(),t=[];for(const a of e)a.memories&&a.memories.length>0&&t.push(...a.memories);return t.sort((e,t)=>t.timestamp-e.timestamp)}{const t=await m.z.getArchive(e);return t&&t.memories?[...t.memories].sort((e,t)=>t.timestamp-e.timestamp):[]}}catch(e){return console.error('[Journal Service] 获取相关记忆失败:',e),[]}}async saveJournal(e){try{const t=await this.getAllJournals();t.push(e),await this.saveAllJournals(t),console.log(`[Journal Service] 日志已保存: ${e.authorName} - ${e.id}`),toastr.success('日志已保存')}catch(e){throw console.error('[Journal Service] 保存日志失败:',e),toastr.error('保存日志失败'),e}}async updateJournal(e,t){try{const a=await this.getAllJournals(),o=a.find(t=>t.id===e);if(!o)throw new Error(`日志不存在: ${e}`);o.content=t,o.editedAt=Date.now(),await this.saveAllJournals(a),console.log(`[Journal Service] 日志已更新: ${e}`),toastr.success('日志已更新')}catch(e){throw console.error('[Journal Service] 更新日志失败:',e),toastr.error('更新日志失败'),e}}async deleteJournal(e){try{const t=await this.getAllJournals(),a=t.filter(t=>t.id!==e);if(a.length===t.length)throw new Error(`日志不存在: ${e}`);await this.saveAllJournals(a),console.log(`[Journal Service] 日志已删除: ${e}`),toastr.success('日志已删除')}catch(e){throw console.error('[Journal Service] 删除日志失败:',e),toastr.error('删除日志失败'),e}}async getJournalsByAuthor(e){try{return(await this.getAllJournals()).filter(t=>t.authorId===e).sort((e,t)=>t.createdAt-e.createdAt)}catch(e){return console.error('[Journal Service] 获取作者日志失败:',e),[]}}async getAllJournals(){try{const e=getVariables({type:'global'});return e.journal_entries||[]}catch(e){return console.error('[Journal Service] 获取所有日志失败:',e),[]}}async saveAllJournals(e){try{const t=(0,rs.klona)(e);await insertOrAssignVariables({journal_entries:t},{type:'global'})}catch(e){throw console.error('[Journal Service] 保存所有日志失败:',e),e}}generateId(){return`journal_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}},ss={class:'journal-view'},cs={class:'panel-content'},is={class:'journal-list'},us={class:'author-selector'},ds={label:'主控角色'},ms=['value'],vs={key:0,label:'NPC'},ps=['value'],gs={class:'history-section'},hs={class:'section-title'},fs={key:0,class:'journal-items'},ys=['onClick'],Ss={class:'journal-header'},Cs={class:'journal-date'},Ns={key:0,class:'journal-edited'},ws={class:'journal-preview'},Es={key:1,class:'empty-state'},ks={class:'journal-editor'},bs={key:0,class:'editor-content'},Vs={class:'editor-header'},Is={class:'editor-title'},Ps={class:'editor-actions'},As=['disabled'],$s=['disabled'],Ms={class:'editor-body'},Ds=['placeholder','disabled'],Bs={key:1,class:'empty-editor'},_s=(0,d.defineComponent)({__name:'JournalView',emits:['close'],setup(e,{emit:t}){const a=t,o=(0,g.m)(),n=(0,Ca.useInstanceStore)(),r=(0,d.ref)(''),l=(0,d.ref)(''),s=(0,d.ref)(''),c=(0,d.ref)([]),i=(0,d.ref)(!1),u=(0,d.ref)(!1),m=(0,d.computed)(()=>o.player),v=(0,d.computed)(()=>'在这里写下你的心象风景...\n\n或点击"沉思"按钮，让 AI 帮你生成一篇内省式的日志。'),p=(0,d.computed)(()=>{const e=n.getAllInstances(),t=new Map;for(const a of e)for(const e of a.characters)e.character&&!t.has(e.characterId)&&t.set(e.characterId,{id:e.characterId,name:e.character.name});return Array.from(t.values())});async function h(){await f()}async function f(){if(r.value)try{c.value=await ls.getJournalsByAuthor(r.value)}catch(e){console.error('[JournalView] 加载日志失败:',e),toastr.error('加载日志失败')}else c.value=[]}async function y(){if(r.value)try{i.value=!0;const e=w(),t=r.value===m.value?.id,a=await ls.generateJournalDraft(r.value,e,t);s.value=a,toastr.success('日志草稿已生成')}catch(e){console.error('[JournalView] 生成日志草稿失败:',e),toastr.error('生成日志草稿失败')}finally{i.value=!1}else toastr.warning('请先选择作者')}async function S(){if(r.value)if(s.value.trim())try{if(u.value=!0,l.value)await ls.updateJournal(l.value,s.value);else{const e={id:ls.generateId(),authorId:r.value,authorName:w(),content:s.value,relatedEvents:[],relatedMemories:[],createdAt:Date.now()};await ls.saveJournal(e),l.value=e.id}await f()}catch(e){console.error('[JournalView] 保存日志失败:',e)}finally{u.value=!1}else toastr.warning('日志内容不能为空');else toastr.warning('请先选择作者')}function C(){l.value&&confirm('确定要删除这篇日志吗？此操作不可撤销。')&&async function(){if(!l.value)return;try{await ls.deleteJournal(l.value),l.value='',s.value='',await f()}catch(e){console.error('[JournalView] 删除日志失败:',e)}}()}function N(){l.value='',s.value=''}function w(){if(r.value===m.value?.id)return m.value.name;const e=p.value.find(e=>e.id===r.value);return e?.name||'未知'}function E(e){const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')} ${String(t.getHours()).padStart(2,'0')}:${String(t.getMinutes()).padStart(2,'0')}`}function k(){a('close')}return(0,d.onMounted)(async()=>{await ls.initialize(),m.value&&(r.value=m.value.id,await f())}),(0,d.watch)(r,async()=>{await f(),l.value='',s.value=''}),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',ss,[(0,d.createCommentVNode)(' 面板头部 '),(0,d.createElementVNode)('div',{class:'panel-header'},[t[2]||(t[2]=(0,d.createElementVNode)('h2',{class:'panel-title'},'心象风景日志',-1)),(0,d.createElementVNode)('button',{class:'btn-close',onClick:k},'×')]),(0,d.createCommentVNode)(' 面板内容 '),(0,d.createElementVNode)('div',cs,[(0,d.createCommentVNode)(' 左侧：日志列表 '),(0,d.createElementVNode)('div',is,[(0,d.createCommentVNode)(' 作者选择器 '),(0,d.createElementVNode)('div',us,[t[4]||(t[4]=(0,d.createElementVNode)('label',{for:'author-select'},'选择作者：',-1)),(0,d.withDirectives)((0,d.createElementVNode)('select',{id:'author-select','onUpdate:modelValue':t[0]||(t[0]=e=>r.value=e),onChange:h},[t[3]||(t[3]=(0,d.createElementVNode)('option',{value:''},'-- 请选择 --',-1)),(0,d.createElementVNode)('optgroup',ds,[m.value?((0,d.openBlock)(),(0,d.createElementBlock)('option',{key:0,value:m.value.id},(0,d.toDisplayString)(m.value.name),9,ms)):(0,d.createCommentVNode)('v-if',!0)]),p.value.length>0?((0,d.openBlock)(),(0,d.createElementBlock)('optgroup',vs,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(p.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('option',{key:e.id,value:e.id},(0,d.toDisplayString)(e.name),9,ps))),128))])):(0,d.createCommentVNode)('v-if',!0)],544),[[d.vModelSelect,r.value]])]),(0,d.createCommentVNode)(' 历史日志列表 '),(0,d.createElementVNode)('div',gs,[(0,d.createElementVNode)('h3',hs,'历史日志 ('+(0,d.toDisplayString)(c.value.length)+')',1),c.value.length>0?((0,d.openBlock)(),(0,d.createElementBlock)('div',fs,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(c.value,e=>{return(0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:(0,d.normalizeClass)(['journal-item',{active:l.value===e.id}]),onClick:t=>function(e){const t=c.value.find(t=>t.id===e);t&&(l.value=t.id,s.value=t.content)}(e.id)},[(0,d.createElementVNode)('div',Ss,[(0,d.createElementVNode)('span',Cs,(0,d.toDisplayString)(E(e.createdAt)),1),e.editedAt?((0,d.openBlock)(),(0,d.createElementBlock)('span',Ns,'(已编辑)')):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createElementVNode)('div',ws,(0,d.toDisplayString)((t=e.content,t.length<=60?t:t.substring(0,60)+'...')),1)],10,ys);var t}),128))])):((0,d.openBlock)(),(0,d.createElementBlock)('div',Es,[...t[5]||(t[5]=[(0,d.createElementVNode)('p',null,'暂无日志',-1)])]))])]),(0,d.createCommentVNode)(' 右侧：日志编辑器 '),(0,d.createElementVNode)('div',ks,[r.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',bs,[(0,d.createCommentVNode)(' 编辑器头部 '),(0,d.createElementVNode)('div',Vs,[(0,d.createElementVNode)('h3',Is,(0,d.toDisplayString)(l.value?'编辑日志':'新建日志'),1),(0,d.createElementVNode)('div',Ps,[(0,d.createElementVNode)('button',{class:'btn-generate',disabled:i.value,onClick:y},(0,d.toDisplayString)(i.value?'沉思中...':'🌙 沉思'),9,As),(0,d.createElementVNode)('button',{class:'btn-save',disabled:!s.value.trim()||u.value,onClick:S},(0,d.toDisplayString)(u.value?'保存中...':'💾 保存'),9,$s),l.value?((0,d.openBlock)(),(0,d.createElementBlock)('button',{key:0,class:'btn-delete',onClick:C},'🗑️ 删除')):(0,d.createCommentVNode)('v-if',!0),(0,d.createElementVNode)('button',{class:'btn-new',onClick:N},'✨ 新建')])]),(0,d.createCommentVNode)(' 文本编辑器 '),(0,d.createElementVNode)('div',Ms,[(0,d.withDirectives)((0,d.createElementVNode)('textarea',{'onUpdate:modelValue':t[1]||(t[1]=e=>s.value=e),class:'journal-textarea',placeholder:v.value,disabled:i.value},null,8,Ds),[[d.vModelText,s.value]])]),(0,d.createCommentVNode)(' 提示信息 '),t[6]||(t[6]=(0,d.createElementVNode)('div',{class:'editor-footer'},[(0,d.createElementVNode)('p',{class:'editor-hint'},' 💡 提示：心象风景日志使用"留白"美学，通过场景描写和意象表达内心状态，避免直接定义情绪。 ')],-1))])):((0,d.openBlock)(),(0,d.createElementBlock)('div',Bs,[...t[7]||(t[7]=[(0,d.createElementVNode)('p',null,'请先选择一个作者',-1)])]))])])]))}}),Rs=(0,Q.A)(_s,[['__scopeId','data-v-30f8d2fa']]),zs={class:'sanctuary-view'},Ws={key:0,class:'sanctuary-container'},xs=['onClick'],Ts=['src','alt'],Us={key:1,class:'placeholder-item'},Gs=['onClick'],Os={class:'sanctuary-actions'},Ls={class:'chat-container'},Fs={class:'chat-header'},js={class:'chat-title'},Hs={key:0,class:'no-messages'},Js={class:'message-content'},Xs={class:'message-author'},qs={class:'message-text'},Ks={class:'chat-input-container'},Zs=['onKeydown'],Ys=['disabled'],Qs={key:0},ec={key:1},tc={class:'invite-dialog'},ac={class:'npc-list'},oc=['value'],nc={class:'npc-name'},rc={class:'npc-info'},lc={class:'dialog-actions'},sc=['disabled'],cc={class:'journal-modal-container'},ic=(0,d.defineComponent)({__name:'SanctuaryView',emits:['close'],setup(e,{emit:t}){const a=(0,Ca.useInstanceStore)(),o=t,n=(0,d.ref)('sanctuary'),r=(0,d.ref)(null),l=(0,d.ref)(!1),s=(0,d.ref)(!1),c=(0,d.ref)([]),i=(0,d.ref)(!1),u=(0,d.ref)(!1),m=(0,d.ref)(''),v=(0,d.ref)(!1),p=(0,d.ref)([]),g=(0,d.ref)(null),h=(0,d.ref)([]),y=(0,d.computed)(()=>r.value?{backgroundImage:`url(${r.value.backgroundImage})`}:{}),S=(0,d.computed)(()=>{const e=a.getAllInstances(),t=[];for(const a of e)for(const e of a.characters)e.character&&t.push({id:e.characterId,name:e.character.name,occupation:e.character.occupation||'未知'});return t}),C=(0,d.computed)(()=>{if(0===h.value.length)return'';return h.value.map(e=>{const t=S.value.find(t=>t.id===e);return t?t.name:e}).join('、')});function N(e){return{left:`${e.position.x}px`,top:`${e.position.y}px`,transform:`scale(${e.scale})`}}function w(){i.value=!i.value,i.value?toastr.info('整理模式已开启，点击物品进行互动'):toastr.success('整理完成')}async function E(){if(0!==c.value.length)try{u.value=!0,await ns.sanctuaryService.inviteNPC(c.value),h.value=[...c.value],l.value=!1,c.value=[],await async function(){try{if(0===h.value.length)return void(p.value=[]);const e=await ns.sanctuaryService.getConversationHistory(h.value);e&&e.messages&&e.messages.length>0?(p.value=e.messages,console.log('[SanctuaryView] 已加载对话历史，消息数:',e.messages.length),await(0,d.nextTick)(),V(),toastr.info(`已加载 ${e.messages.length} 条历史消息`)):(p.value=[],console.log('[SanctuaryView] 无历史对话，开始新对话'))}catch(e){console.error('[SanctuaryView] 加载对话历史失败:',e),p.value=[]}}(),n.value='chat',toastr.success('NPC 已邀请到归所，开始对话')}catch(e){console.error('[SanctuaryView] 邀请 NPC 失败:',e),toastr.error('邀请失败')}finally{u.value=!1}else toastr.warning('请至少选择一位 NPC')}async function k(){if(h.value.length>0&&p.value.length>0)try{await ns.sanctuaryService.saveConversation(h.value,p.value),console.log('[SanctuaryView] 对话历史已保存')}catch(e){console.error('[SanctuaryView] 保存对话历史失败:',e)}f.apiConfigService.switchToRealWorld(),console.log('[SanctuaryView] 已切换回现实世界 API'),n.value='sanctuary',h.value=[],toastr.info('已返回归所')}async function b(){if(!m.value.trim()||v.value)return;const e=m.value.trim();try{v.value=!0,p.value.push({role:'user',author:'你',content:e}),m.value='',await(0,d.nextTick)(),V(),console.log('[SanctuaryView] 发送消息到归所:',e);const t=f.apiConfigService.getCurrentAPI();let a;a=t?await generateRaw({ordered_prompts:[{role:'user',content:e}],custom_api:{apiurl:t.apiurl,key:t.key,model:t.model,temperature:t.temperature,max_tokens:t.max_tokens}}):await generate({user_input:e}),p.value.push({role:'assistant',author:C.value||'NPC',content:a}),await(0,d.nextTick)(),V(),console.log('[SanctuaryView] 收到 AI 回复')}catch(e){console.error('[SanctuaryView] 发送消息失败:',e),toastr.error('发送消息失败')}finally{v.value=!1}}function V(){g.value&&(g.value.scrollTop=g.value.scrollHeight)}function I(){o('close'),toastr.info('返回主界面')}return(0,d.onMounted)(async()=>{try{await ns.sanctuaryService.initialize(),r.value=await ns.sanctuaryService.getSanctuary(),console.log('[SanctuaryView] 归所数据已加载')}catch(e){console.error('[SanctuaryView] 加载归所数据失败:',e),toastr.error('加载归所失败')}}),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',zs,[(0,d.createCommentVNode)(' 归所视图 '),'sanctuary'===n.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Ws,[(0,d.createCommentVNode)(' 背景图层 '),(0,d.createElementVNode)('div',{class:'sanctuary-background',style:(0,d.normalizeStyle)(y.value)},[(0,d.createCommentVNode)(' 家具图层 '),((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(r.value?.furniture||[],e=>{return(0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:'furniture-item',style:(0,d.normalizeStyle)((t=e.position,{left:`${t.x}px`,top:`${t.y}px`})),onClick:t=>async function(e,t){if(i.value)try{const a=await ns.sanctuaryService.interactWithItem(e);toastr.info(`${t}: ${a}`)}catch(e){console.error('[SanctuaryView] 物品互动失败:',e)}}(e.id,e.name)},[e.imageUrl?((0,d.openBlock)(),(0,d.createElementBlock)('img',{key:0,src:e.imageUrl,alt:e.name},null,8,Ts)):((0,d.openBlock)(),(0,d.createElementBlock)('div',Us,(0,d.toDisplayString)(e.name),1))],12,xs);var t}),128)),(0,d.createCommentVNode)(' 纪念品图层 '),((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(r.value?.mementos||[],e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.mementoId,class:'memento-item',style:(0,d.normalizeStyle)(N(e)),onClick:t=>async function(e){if(i.value)try{const t=await ns.sanctuaryService.interactWithItem(e);toastr.info(`纪念品: ${t}`)}catch(e){console.error('[SanctuaryView] 纪念品互动失败:',e)}}(e.mementoId)},[...t[8]||(t[8]=[(0,d.createElementVNode)('div',{class:'memento-placeholder'},'纪念品',-1)])],12,Gs))),128))],4),(0,d.createCommentVNode)(' 操作按钮 '),(0,d.createElementVNode)('div',Os,[(0,d.createElementVNode)('button',{class:'action-btn',onClick:w},[(0,d.createElementVNode)('span',null,(0,d.toDisplayString)(i.value?'完成整理':'整理'),1)]),(0,d.createElementVNode)('button',{class:'action-btn',onClick:t[0]||(t[0]=e=>l.value=!0)},[...t[9]||(t[9]=[(0,d.createElementVNode)('span',null,'邀请 NPC',-1)])]),(0,d.createElementVNode)('button',{class:'action-btn',onClick:t[1]||(t[1]=e=>s.value=!0)},[...t[10]||(t[10]=[(0,d.createElementVNode)('span',null,'日志',-1)])]),(0,d.createElementVNode)('button',{class:'action-btn close-btn',onClick:I},[...t[11]||(t[11]=[(0,d.createElementVNode)('span',null,'返回',-1)])])])])):'chat'===n.value?((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:1},[(0,d.createCommentVNode)(' 聊天室视图 '),(0,d.createElementVNode)('div',Ls,[(0,d.createCommentVNode)(' 聊天界面头部 '),(0,d.createElementVNode)('div',Fs,[(0,d.createElementVNode)('div',js,[(0,d.createElementVNode)('span',null,'与 '+(0,d.toDisplayString)(C.value)+' 的对话',1)]),(0,d.createElementVNode)('button',{class:'back-btn',onClick:k},[...t[12]||(t[12]=[(0,d.createElementVNode)('span',null,'返回归所',-1)])])]),(0,d.createCommentVNode)(' 聊天消息区域 '),(0,d.createElementVNode)('div',{ref_key:'chatMessagesRef',ref:g,class:'chat-messages'},[0===p.value.length?((0,d.openBlock)(),(0,d.createElementBlock)('div',Hs,[...t[13]||(t[13]=[(0,d.createElementVNode)('p',null,'开始与 NPC 对话吧...',-1)])])):(0,d.createCommentVNode)('v-if',!0),((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(p.value,(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:t,class:(0,d.normalizeClass)(['message-item',e.role])},[(0,d.createElementVNode)('div',Js,[(0,d.createElementVNode)('div',Xs,(0,d.toDisplayString)(e.author),1),(0,d.createElementVNode)('div',qs,(0,d.toDisplayString)(e.content),1)])],2))),128))],512),(0,d.createCommentVNode)(' 聊天输入区域 '),(0,d.createElementVNode)('div',Ks,[(0,d.withDirectives)((0,d.createElementVNode)('textarea',{'onUpdate:modelValue':t[2]||(t[2]=e=>m.value=e),class:'chat-input',placeholder:'输入你的消息... (Ctrl+Enter 发送)',onKeydown:(0,d.withKeys)((0,d.withModifiers)(b,['ctrl']),['enter'])},null,40,Zs),[[d.vModelText,m.value]]),(0,d.createElementVNode)('button',{class:'send-btn',disabled:!m.value.trim()||v.value,onClick:b},[v.value?((0,d.openBlock)(),(0,d.createElementBlock)('span',ec,'发送中...')):((0,d.openBlock)(),(0,d.createElementBlock)('span',Qs,'发送'))],8,Ys)])])],2112)):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' NPC 邀请对话框 '),l.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:2,class:'modal-overlay',onClick:t[5]||(t[5]=(0,d.withModifiers)(e=>l.value=!1,['self']))},[(0,d.createElementVNode)('div',tc,[t[14]||(t[14]=(0,d.createElementVNode)('h3',null,'邀请 NPC',-1)),(0,d.createElementVNode)('div',ac,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(S.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:'npc-option'},[(0,d.createElementVNode)('label',null,[(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>c.value=e),type:'checkbox',value:e.id},null,8,oc),[[d.vModelCheckbox,c.value]]),(0,d.createElementVNode)('span',nc,(0,d.toDisplayString)(e.name),1),(0,d.createElementVNode)('span',rc,(0,d.toDisplayString)(e.occupation),1)])]))),128))]),(0,d.createElementVNode)('div',lc,[(0,d.createElementVNode)('button',{class:'btn-primary',disabled:0===c.value.length,onClick:E},' 确认邀请 ('+(0,d.toDisplayString)(c.value.length)+') ',9,sc),(0,d.createElementVNode)('button',{class:'btn-secondary',onClick:t[4]||(t[4]=e=>l.value=!1)},'取消')])])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 日志对话框 '),((0,d.openBlock)(),(0,d.createBlock)(d.Teleport,{to:'body'},[s.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:0,class:'modal-overlay',onClick:t[7]||(t[7]=(0,d.withModifiers)(e=>s.value=!1,['self']))},[(0,d.createElementVNode)('div',cc,[(0,d.createVNode)(Rs,{onClose:t[6]||(t[6]=e=>s.value=!1)})])])):(0,d.createCommentVNode)('v-if',!0)]))]))}}),uc=(0,Q.A)(ic,[['__scopeId','data-v-efcbae3e']]),dc={key:0,class:'status-bar'},mc={class:'character-name'},vc={class:'status-bars'},pc={class:'stat-row'},gc={class:'progress-bar hp-bar'},hc={class:'stat-row'},fc={class:'progress-bar mp-bar'},yc={class:'stat-row'},Sc={class:'progress-bar san-bar'},Cc=(0,d.defineComponent)({__name:'StatusBar',setup(e){const t=(0,g.m)(),o=(0,d.ref)(null),n=(0,d.ref)(null),r=(0,d.ref)(null),l=(0,d.ref)(null),s=(0,d.ref)(null),c=(0,d.ref)(null),i=(0,d.ref)(0),u=(0,d.ref)(0),m=(0,d.ref)(0),v=(0,d.computed)(()=>t.player),p=(0,d.computed)(()=>v.value?v.value.derivedStats.HP/v.value.derivedStats.maxHP*100:0),h=(0,d.computed)(()=>v.value?v.value.derivedStats.MP/v.value.derivedStats.maxMP*100:0),f=(0,d.computed)(()=>v.value?v.value.derivedStats.SAN/v.value.derivedStats.maxSAN*100:0);function y(e,t){if(!e)return;!function(e,t='#d4af37',o=.5){const n=a.timeline();n.to(e,{backgroundColor:t,duration:o/2,ease:'power2.out'}).to(e,{backgroundColor:'transparent',duration:o/2,ease:'power2.in'})}(e,t?'#4caf50':'#f44336',.5)}function S(e,t,o,n){if(!e)return;const r={value:t};a.to(r,{value:o,duration:.8,ease:'power2.out',onUpdate:()=>{e.textContent=`${Math.round(r.value)} / ${n}`}})}return(0,d.watch)(()=>v.value?.derivedStats.HP,(e,t)=>{void 0!==e&&void 0!==t&&e!==t&&(y(o.value,e>t),l.value&&v.value&&S(l.value,t,e,v.value.derivedStats.maxHP),i.value=e)}),(0,d.watch)(()=>v.value?.derivedStats.MP,(e,t)=>{void 0!==e&&void 0!==t&&e!==t&&(y(n.value,e>t),s.value&&v.value&&S(s.value,t,e,v.value.derivedStats.maxMP),u.value=e)}),(0,d.watch)(()=>v.value?.derivedStats.SAN,(e,t)=>{void 0!==e&&void 0!==t&&e!==t&&(y(r.value,e>t),c.value&&v.value&&S(c.value,t,e,v.value.derivedStats.maxSAN),m.value=e)}),(0,d.onMounted)(()=>{v.value&&(i.value=v.value.derivedStats.HP,u.value=v.value.derivedStats.MP,m.value=v.value.derivedStats.SAN)}),(e,t)=>v.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',dc,[(0,d.createCommentVNode)(' 角色名称 '),(0,d.createElementVNode)('div',mc,(0,d.toDisplayString)(v.value.name),1),(0,d.createCommentVNode)(' 状态条 '),(0,d.createElementVNode)('div',vc,[(0,d.createCommentVNode)(' HP 条 '),(0,d.createElementVNode)('div',pc,[t[0]||(t[0]=(0,d.createElementVNode)('span',{class:'stat-label'},'HP',-1)),(0,d.createElementVNode)('div',gc,[(0,d.createElementVNode)('div',{ref_key:'hpFillRef',ref:o,class:'progress-fill',style:(0,d.normalizeStyle)({width:p.value+'%'})},null,4),(0,d.createElementVNode)('span',{ref_key:'hpValueRef',ref:l,class:'stat-value'},(0,d.toDisplayString)(v.value.derivedStats.HP)+' / '+(0,d.toDisplayString)(v.value.derivedStats.maxHP),513)])]),(0,d.createCommentVNode)(' MP 条 '),(0,d.createElementVNode)('div',hc,[t[1]||(t[1]=(0,d.createElementVNode)('span',{class:'stat-label'},'MP',-1)),(0,d.createElementVNode)('div',fc,[(0,d.createElementVNode)('div',{ref_key:'mpFillRef',ref:n,class:'progress-fill',style:(0,d.normalizeStyle)({width:h.value+'%'})},null,4),(0,d.createElementVNode)('span',{ref_key:'mpValueRef',ref:s,class:'stat-value'},(0,d.toDisplayString)(v.value.derivedStats.MP)+' / '+(0,d.toDisplayString)(v.value.derivedStats.maxMP),513)])]),(0,d.createCommentVNode)(' SAN 条 '),(0,d.createElementVNode)('div',yc,[t[2]||(t[2]=(0,d.createElementVNode)('span',{class:'stat-label'},'SAN',-1)),(0,d.createElementVNode)('div',Sc,[(0,d.createElementVNode)('div',{ref_key:'sanFillRef',ref:r,class:'progress-fill',style:(0,d.normalizeStyle)({width:f.value+'%'})},null,4),(0,d.createElementVNode)('span',{ref_key:'sanValueRef',ref:c,class:'stat-value'},(0,d.toDisplayString)(v.value.derivedStats.SAN)+' / '+(0,d.toDisplayString)(v.value.derivedStats.maxSAN),513)])])])])):(0,d.createCommentVNode)('v-if',!0)}}),Nc=(0,Q.A)(Cc,[['__scopeId','data-v-0bbeca14']]);var wc=s(76);const Ec=new class{testResults=[];async runAllTests(){return this.testResults=[],toastr.info('开始运行集成测试...'),await this.testAPISwitch(),await this.testMemorySystem(),await this.testSanctuarySystem(),await this.testInstanceCompletion(),await this.testCharacterInitialization(),this.displayResults(),this.testResults}async testAPISwitch(){console.log('=== 测试 18.1: API 切换功能 ===');try{const e=f.apiConfigService.getCurrentAPI();this.addResult({testName:'18.1.1 - 获取当前 API 配置',passed:!0,message:e?'成功获取当前 API 配置':'当前使用酒馆默认 API',details:e}),await f.apiConfigService.switchToRealWorld();const t=f.apiConfigService.getCurrentAPI();this.addResult({testName:'18.1.2 - 切换到现实世界 API',passed:!0,message:'成功切换到现实世界 API',details:t}),await f.apiConfigService.switchToInnerWorld();const a=f.apiConfigService.getCurrentAPI();this.addResult({testName:'18.1.3 - 切换到里世界 API',passed:!0,message:'成功切换到里世界 API',details:a}),await f.apiConfigService.switchToSanctuary();const o=f.apiConfigService.getCurrentAPI();this.addResult({testName:'18.1.4 - 切换到归所 API',passed:!0,message:'成功切换到归所 API',details:o});const n=await f.apiConfigService.getAllConfigs(),r=null!==n.realWorld;this.addResult({testName:'18.1.5 - API 配置回退机制',passed:!0,message:r?'已配置现实世界 API':'未配置现实世界 API，将使用酒馆默认 API',details:{hasRealWorldConfig:r,allConfigs:n}});const l={apiurl:'https://test.api.com',key:'test_key',model:'test_model',temperature:.7,max_tokens:2e3};await f.apiConfigService.saveConfigs({realWorld:l,innerWorld:l,sanctuary:l});const s=await f.apiConfigService.getAllConfigs(),c=s.realWorld?.apiurl===l.apiurl&&s.realWorld?.key===l.key;this.addResult({testName:'18.1.6 - API 配置保存和加载',passed:c,message:c?'API 配置保存和加载成功':'API 配置保存或加载失败',details:{saved:l,loaded:s.realWorld}})}catch(e){this.addResult({testName:'18.1 - API 切换功能测试',passed:!1,message:`测试过程中发生错误: ${e}`,details:e})}}async testMemorySystem(){console.log('=== 测试 18.2: 记忆系统 ===');try{const e='test_npc_001',t=await m.z.getArchive(e);if(this.addResult({testName:'18.2.1 - 记忆档案系统',passed:!0,message:t?`找到 NPC ${e} 的记忆档案`:`NPC ${e} 暂无记忆档案`,details:t}),t&&t.memories.length>0){const t=await m.z.injectMemoryPrompt(e),a=t.length>0;this.addResult({testName:'18.2.2 - 记忆注入',passed:a,message:a?'成功生成记忆提示词':'记忆提示词生成失败',details:{prompt:t}})}else this.addResult({testName:'18.2.2 - 记忆注入',passed:!0,message:'暂无记忆档案，跳过记忆注入测试',details:null});const a=t?.relationshipScore||0;this.addResult({testName:'18.2.3 - 关系分数系统',passed:!0,message:`当前关系分数: ${a}`,details:{initialScore:a}});const o=await m.z.getAllArchives();this.addResult({testName:'18.2.4 - 跨副本记忆追踪',passed:!0,message:`记忆档案系统正常 (共 ${o.length} 个档案)`,details:{totalArchives:o.length}})}catch(e){this.addResult({testName:'18.2 - 记忆系统测试',passed:!1,message:`测试过程中发生错误: ${e}`,details:e})}}async testSanctuarySystem(){console.log('=== 测试 18.3: 归所系统 ===');try{await ns.sanctuaryService.initialize();const e=await ns.sanctuaryService.getSanctuary();this.addResult({testName:'18.3.1 - 归所初始化',passed:null!==e,message:e?'归所初始化成功':'归所初始化失败',details:e});const t=['test_npc_001'];try{await ns.sanctuaryService.inviteNPC(t);const e=await ns.sanctuaryService.getSanctuary(),a=null!==e&&e.conversationHistory.length>0;this.addResult({testName:'18.3.2 - 邀请 NPC 到归所',passed:a,message:a?'NPC 邀请成功，创建了对话记录':'NPC 邀请失败',details:e?.conversationHistory})}catch(e){this.addResult({testName:'18.3.2 - 邀请 NPC 到归所',passed:!1,message:`邀请 NPC 时发生错误: ${e}`,details:e})}const a={id:'test_memento_001',name:'测试纪念品',description:'用于测试的纪念品',sourceInstance:'test_instance',obtainedAt:Date.now()};await ns.sanctuaryService.addMemento(a,{x:100,y:100});const o=await ns.sanctuaryService.getSanctuary(),n=null!==o&&o.mementos.length>0;this.addResult({testName:'18.3.3 - 纪念品添加',passed:n,message:n?'纪念品添加成功':'纪念品添加失败',details:o?.mementos});const r=o?.conversationHistory||[],l=r.length>0;this.addResult({testName:'18.3.4 - 对话历史持久化',passed:l,message:l?'对话历史已持久化':'对话历史持久化失败',details:{historyCount:r.length}});const s=f.apiConfigService.getCurrentAPI();this.addResult({testName:'18.3.5 - API 切换',passed:null!==s||null===s,message:s?'归所 API 已配置':'归所使用酒馆默认 API',details:s})}catch(e){this.addResult({testName:'18.3 - 归所系统测试',passed:!1,message:`测试过程中发生错误: ${e}`,details:e})}}async testInstanceCompletion(){console.log('=== 测试 18.4: 副本完成流程 ===');try{const e=(0,Ca.useInstanceStore)().getAllInstances();this.addResult({testName:'18.4.1 - 副本存储系统',passed:!0,message:`副本存储系统正常 (共 ${e.length} 个副本)`,details:{instanceCount:e.length}});const t=e.filter(e=>'active'===e.status),a=e.filter(e=>'completed'===e.status);this.addResult({testName:'18.4.2 - 副本状态管理',passed:!0,message:`活跃副本: ${t.length}, 已完成副本: ${a.length}`,details:{activeCount:t.length,completedCount:a.length}});const o=e.filter(e=>e.events&&e.events.length>0);this.addResult({testName:'18.4.3 - 事件记录保留',passed:!0,message:`${o.length} 个副本包含事件记录`,details:{instancesWithEvents:o.length}});const n=e.filter(e=>e.mementos&&e.mementos.length>0);this.addResult({testName:'18.4.4 - 纪念品保留',passed:!0,message:`${n.length} 个副本包含纪念品`,details:{instancesWithMementos:n.length}})}catch(e){this.addResult({testName:'18.4 - 副本完成流程测试',passed:!1,message:`测试过程中发生错误: ${e}`,details:e})}}async testCharacterInitialization(){console.log('=== 测试 18.5: 主控角色初始化 ===');try{const e=SillyTavern.getCurrentChatId()?(SillyTavern.chat?.length??0)-1:-1,t=e>=0?getChatMessages(`0-${e}`):[],a=0===t.length;this.addResult({testName:'18.5.1 - 消息楼层检测',passed:!0,message:a?'当前在第 0 楼':`当前在第 ${t.length} 楼`,details:{messageCount:t.length}});const o=getVariables({type:'global'}).player_character,n=null!=o;if(this.addResult({testName:'18.5.2 - 主控角色检查',passed:!0,message:n?'主控角色已存在':'主控角色不存在',details:o}),n)try{const e=SillyTavern,t=e.characterId,a=e.characters[t],o=a&&a.description&&a.description.length>0;this.addResult({testName:'18.5.3 - 角色卡同步',passed:o||!1,message:o?'角色卡描述已同步':'角色卡描述未同步或为空',details:{descriptionLength:a?.description?.length||0}})}catch(e){this.addResult({testName:'18.5.3 - 角色卡同步',passed:!1,message:`获取角色卡信息时发生错误: ${e}`,details:e})}else this.addResult({testName:'18.5.3 - 角色卡同步',passed:!0,message:'主控角色不存在，跳过角色卡同步测试',details:null});const r=await wc.realWorldMapService.loadMap(),l=null!==r&&r.areas&&r.areas.size>0;this.addResult({testName:'18.5.4 - 现实世界地图',passed:l,message:l?`现实世界地图已生成 (${r.areas.size} 个地点)`:'现实世界地图未生成',details:r})}catch(e){this.addResult({testName:'18.5 - 主控角色初始化测试',passed:!1,message:`测试过程中发生错误: ${e}`,details:e})}}addResult(e){this.testResults.push(e);const t=e.passed?'✓':'✗',a=e.passed?'green':'red';console.log(`%c${t} ${e.testName}: ${e.message}`,`color: ${a}`),e.details&&console.log('详细信息:',e.details)}displayResults(){const e=this.testResults.length,t=this.testResults.filter(e=>e.passed).length,a=e-t;console.log('\n=== 测试结果摘要 ==='),console.log(`总测试数: ${e}`),console.log(`%c通过: ${t}`,'color: green'),console.log(`%c失败: ${a}`,'color: red'),console.log(`通过率: ${(t/e*100).toFixed(2)}%`),a>0?(console.log('\n失败的测试:'),this.testResults.filter(e=>!e.passed).forEach(e=>{console.log(`%c✗ ${e.testName}: ${e.message}`,'color: red')}),toastr.warning(`集成测试完成: ${t}/${e} 通过`)):toastr.success(`所有集成测试通过! (${e}/${e})`)}getResults(){return this.testResults}generateReport(){const e=this.testResults.length,t=this.testResults.filter(e=>e.passed).length;let a='# 副本系统与 NPC 管理重构 - 集成测试报告\n\n';return a+=`**测试时间**: ${(new Date).toLocaleString()}\n\n`,a+=`**测试结果**: ${t}/${e} 通过 (${(t/e*100).toFixed(2)}%)\n\n`,a+='## 测试详情\n\n',this.testResults.forEach(e=>{const t=e.passed?'✓ 通过':'✗ 失败';a+=`### ${e.testName}\n`,a+=`**状态**: ${t}\n`,a+=`**消息**: ${e.message}\n`,e.details&&(a+=`**详细信息**:\n\`\`\`json\n${JSON.stringify(e.details,null,2)}\n\`\`\`\n`),a+='\n'}),a}};var kc=s(976);const bc={class:'test-panel'},Vc={class:'test-header'},Ic={class:'test-content'},Pc={class:'test-section'},Ac={key:0,class:'test-result'},$c={class:'test-section'},Mc={key:0,class:'test-result'},Dc={class:'test-section'},Bc={key:0,class:'test-result'},_c={class:'test-section'},Rc={key:0,class:'test-result'},zc={class:'test-section'},Wc={key:0,class:'test-result'},xc={class:'test-section'},Tc={key:0,class:'test-result'},Uc=(0,d.defineComponent)({__name:'TestPanel',emits:['close'],setup(e){const t=(0,d.ref)(''),a=(0,d.ref)(''),o=(0,d.ref)(''),n=(0,d.ref)(''),r=(0,d.ref)(''),l=(0,d.ref)(''),c=(0,Ca.useInstanceStore)();async function i(){try{t.value='正在测试记忆捕获...';const e={id:`test_${Date.now()}`,description:'测试记忆：玩家帮助了 NPC',type:'positive',timestamp:Date.now(),sourceInstance:'test_instance'};await m.z.addMemoryToNPC('test_npc_001',e),t.value='✅ 记忆捕获测试成功！已添加测试记忆。'}catch(e){t.value=`❌ 测试失败: ${e}`}}async function u(){try{const e=await m.z.getAllArchives();t.value=`📚 当前记忆档案数量: ${e.length}\n${JSON.stringify(e,null,2)}`}catch(e){t.value=`❌ 获取失败: ${e}`}}async function v(){try{const e=await m.z.injectMemoryPrompt('test_npc_001');t.value=e?`✅ 记忆注入成功:\n${e}`:'⚠️ 该 NPC 暂无记忆'}catch(e){t.value=`❌ 注入失败: ${e}`}}async function p(){try{a.value='正在生成测试 NPC...';const e=c.currentInstance;if(!e)return void(a.value='❌ 请先创建副本');const t=await kc.npcGenerationCoordinator.generateRandomNPCs(2,e.type||'克苏鲁神话',[]);a.value=`✅ 生成成功！\n生成了 ${t.length} 个 NPC`}catch(e){a.value=`❌ 生成失败: ${e}`}}async function g(){try{const e=c.currentInstance;if(!e||!e.characters.length)return void(a.value='❌ 当前副本没有 NPC');const t=e.characters[0];a.value=`📊 NPC: ${t.character.name}\n出场次数: ${t.appearanceCount||0}`}catch(e){a.value=`❌ 测试失败: ${e}`}}async function h(){try{o.value='正在记录测试事件...';const e=c.currentInstance;if(!e)return void(o.value='❌ 请先创建副本');await Na.eventRecordService.recordEventFromAIOutput(e.id,'玩家发现了一个神秘的宝箱，里面装满了金币。',[]),o.value='✅ 事件记录成功！'}catch(e){o.value=`❌ 记录失败: ${e}`}}async function f(){try{const e=c.currentInstance;if(!e)return void(o.value='❌ 请先创建副本');const t=e.events||[];o.value=`📋 事件历史 (${t.length} 条):\n${JSON.stringify(t.slice(-5),null,2)}`}catch(e){o.value=`❌ 获取失败: ${e}`}}async function y(){try{n.value='正在生成测试地图...';const e={id:'test_player',type:'player',name:'测试角色',age:25,occupation:'调查员',background:'一位居住在北京的调查员',attributes:{STR:50,CON:50,SIZ:50,DEX:50,APP:50,INT:50,POW:50,EDU:50,LUK:50},derivedStats:{HP:10,MP:10,SAN:50,luck:50,MOV:8,DB:'0',build:0,BUILD:0,maxHP:10,maxMP:10,maxSAN:50},skills:new Map,bodyParts:[],inventory:[]},t=await wc.realWorldMapService.generateMap(e);n.value=`✅ 地图生成成功！\n区域数量: ${t.areas.size}\n起始区域: ${t.startArea}`}catch(e){n.value=`❌ 生成失败: ${e}`}}async function S(){try{n.value='测试功能开发中...'}catch(e){n.value=`❌ 测试失败: ${e}`}}async function C(){try{r.value='正在测试 AI 连接...';const{testAIService:e}=await Promise.resolve().then(s.bind(s,335)),t=await e();t.success?r.value=`✅ ${t.message}\n\n详情:\n${JSON.stringify(t.details,null,2)}`:r.value=`❌ ${t.message}\n\n${t.details?.diagnosis||''}`}catch(e){r.value=`❌ 测试失败: ${e}`}}async function N(){try{r.value='正在运行完整诊断...';const{runFullDiagnostics:e}=await Promise.resolve().then(s.bind(s,335)),t=await e();r.value=t}catch(e){r.value=`❌ 诊断失败: ${e}`}}async function w(){try{l.value='正在运行综合测试...\n',await Ec.runAllTests();const e=Ec.getResults();l.value=`测试完成！\n通过: ${e.filter(e=>e.passed).length}/${e.length}\n\n${e.map(e=>`${e.passed?'✅':'❌'} ${e.testName}: ${e.message}`).join('\n')}`}catch(e){l.value=`❌ 测试失败: ${e}`}}return(e,s)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',bc,[(0,d.createElementVNode)('div',Vc,[s[1]||(s[1]=(0,d.createElementVNode)('h2',null,'🧪 功能测试面板',-1)),(0,d.createElementVNode)('button',{class:'close-btn',onClick:s[0]||(s[0]=t=>e.$emit('close'))},'✕')]),(0,d.createElementVNode)('div',Ic,[(0,d.createCommentVNode)(' 记忆碎片系统测试 '),(0,d.createElementVNode)('div',Pc,[s[2]||(s[2]=(0,d.createElementVNode)('h3',null,'📝 记忆碎片系统',-1)),(0,d.createElementVNode)('div',{class:'test-actions'},[(0,d.createElementVNode)('button',{onClick:i},'测试记忆捕获'),(0,d.createElementVNode)('button',{onClick:u},'查看记忆档案'),(0,d.createElementVNode)('button',{onClick:v},'测试记忆注入')]),t.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Ac,(0,d.toDisplayString)(t.value),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' NPC 生成系统测试 '),(0,d.createElementVNode)('div',$c,[s[3]||(s[3]=(0,d.createElementVNode)('h3',null,'👥 NPC 生成系统',-1)),(0,d.createElementVNode)('div',{class:'test-actions'},[(0,d.createElementVNode)('button',{onClick:p},'生成测试 NPC'),(0,d.createElementVNode)('button',{onClick:g},'测试 NPC 出场')]),a.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Mc,(0,d.toDisplayString)(a.value),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' 事件记录系统测试 '),(0,d.createElementVNode)('div',Dc,[s[4]||(s[4]=(0,d.createElementVNode)('h3',null,'📋 事件记录系统',-1)),(0,d.createElementVNode)('div',{class:'test-actions'},[(0,d.createElementVNode)('button',{onClick:h},'记录测试事件'),(0,d.createElementVNode)('button',{onClick:f},'查看事件历史')]),o.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Bc,(0,d.toDisplayString)(o.value),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' 真实世界地图测试 '),(0,d.createElementVNode)('div',_c,[s[5]||(s[5]=(0,d.createElementVNode)('h3',null,'🗺️ 真实世界地图',-1)),(0,d.createElementVNode)('div',{class:'test-actions'},[(0,d.createElementVNode)('button',{onClick:y},'生成测试地图'),(0,d.createElementVNode)('button',{onClick:S},'测试区域详情')]),n.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Rc,(0,d.toDisplayString)(n.value),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' AI 服务诊断 '),(0,d.createElementVNode)('div',zc,[s[6]||(s[6]=(0,d.createElementVNode)('h3',null,'🔍 AI 服务诊断',-1)),(0,d.createElementVNode)('div',{class:'test-actions'},[(0,d.createElementVNode)('button',{onClick:C},'测试 AI 连接'),(0,d.createElementVNode)('button',{onClick:N},'完整诊断')]),r.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Wc,[(0,d.createElementVNode)('pre',null,(0,d.toDisplayString)(r.value),1)])):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' 综合测试 '),(0,d.createElementVNode)('div',xc,[s[7]||(s[7]=(0,d.createElementVNode)('h3',null,'🔄 综合测试',-1)),(0,d.createElementVNode)('div',{class:'test-actions'},[(0,d.createElementVNode)('button',{class:'primary-btn',onClick:w},'运行完整测试')]),l.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Tc,[(0,d.createElementVNode)('pre',null,(0,d.toDisplayString)(l.value),1)])):(0,d.createCommentVNode)('v-if',!0)])])]))}}),Gc=(0,Q.A)(Uc,[['__scopeId','data-v-12099c54']]);var Oc=s(853);const Lc={class:'dialog-title'},Fc={class:'dialog-message'},jc={class:'dialog-buttons'},Hc=(0,d.defineComponent)({__name:'ConfirmDialog',props:{show:{type:Boolean},title:{},message:{},confirmText:{default:'确认'},cancelText:{default:'取消'},dangerMode:{type:Boolean,default:!1}},emits:['confirm','cancel'],setup(e,{emit:t}){const a=e,o=t;function n(){o('confirm')}function r(){o('cancel')}function l(){o('cancel')}function s(e){'Escape'===e.key&&a.show&&o('cancel')}return(0,d.onMounted)(()=>{window.addEventListener('keydown',s)}),(0,d.onUnmounted)(()=>{window.removeEventListener('keydown',s)}),(t,a)=>((0,d.openBlock)(),(0,d.createBlock)(d.Teleport,{to:'body'},[(0,d.createVNode)(d.Transition,{name:'fade'},{default:(0,d.withCtx)(()=>[e.show?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:0,class:'confirm-dialog-overlay',onClick:l},[(0,d.createVNode)(d.Transition,{name:'scale'},{default:(0,d.withCtx)(()=>[e.show?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:0,class:'confirm-dialog',onClick:a[0]||(a[0]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createElementVNode)('h2',Lc,(0,d.toDisplayString)(e.title),1),(0,d.createElementVNode)('p',Fc,(0,d.toDisplayString)(e.message),1),(0,d.createElementVNode)('div',jc,[(0,d.createElementVNode)('button',{class:'btn-dialog btn-cancel',onClick:r},(0,d.toDisplayString)(e.cancelText),1),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['btn-dialog btn-confirm',{'btn-danger':e.dangerMode}]),onClick:n},(0,d.toDisplayString)(e.confirmText),3)])])):(0,d.createCommentVNode)('v-if',!0)]),_:1})])):(0,d.createCommentVNode)('v-if',!0)]),_:1})]))}}),Jc=(0,Q.A)(Hc,[['__scopeId','data-v-1cd92598']]),Xc={class:'welcome-modal-overlay'},qc=(0,d.defineComponent)({__name:'WelcomeModal',emits:['updateCharacter','continue'],setup(e,{emit:t}){const a=(0,d.ref)(!1),o=t;function n(){a.value=!0}async function r(){a.value=!1;try{await Oc.gameResetService.clearAllGameData(),o('updateCharacter')}catch(e){console.error('[WelcomeModal] 重置游戏数据失败:',e),toastr.error('重置游戏数据失败，请查看控制台了解详情')}}function l(){a.value=!1}function s(){o('continue')}return(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',Xc,[(0,d.createElementVNode)('div',{class:'welcome-modal'},[(0,d.createElementVNode)('div',{class:'welcome-content'},[t[0]||(t[0]=(0,d.createElementVNode)('h1',{class:'welcome-title'},'欢迎使用无限流前端',-1)),(0,d.createElementVNode)('div',{class:'button-group'},[(0,d.createElementVNode)('button',{class:'btn-action btn-update',onClick:n},'开始游戏'),(0,d.createElementVNode)('button',{class:'btn-action btn-continue',onClick:s},'继续游戏')])])]),(0,d.createCommentVNode)(' 确认对话框 '),(0,d.createVNode)(Jc,{show:a.value,title:'确认开始新游戏',message:'开始新游戏将会清空以下数据：\n\n• 所有 MVU 变量（消息楼层变量）\n• 所有全局变量\n• 所有聊天变量\n• 背包中的所有物品\n\n此操作不可撤销，确定要继续吗？','confirm-text':'确认','cancel-text':'取消','danger-mode':!0,onConfirm:r,onCancel:l},null,8,['show'])]))}}),Kc=(0,Q.A)(qc,[['__scopeId','data-v-e852e086']]),Zc={class:'main-interface'},Yc={class:'layer layer-background'},Qc={class:'layer layer-sprite'},ei={class:'layer layer-ui'},ti={key:1,class:'modal-overlay sanctuary-modal'},ai={key:2,class:'modal-overlay character-creation-overlay'},oi={key:4,class:'control-panel'},ni=['title'],ri=['title'],li=['title'],si={key:8,class:'modal-overlay'},ci=(0,d.defineComponent)({__name:'MainInterface',setup(e){const t=(0,g.m)(),a=(0,h.useGameStore)(),o=(0,d.ref)(!0),n=(0,d.ref)(!1),r=(0,d.ref)(!1),l=(0,d.ref)(!1),c=(0,d.ref)(!1),i=(0,d.ref)(!1),u=(0,d.ref)(!1),f=(0,d.ref)(!1),y=(0,d.ref)(!1),S=(0,d.ref)(!1),C=(0,d.ref)(!1),N=(0,d.ref)(!1),w=(0,d.ref)(!1),E=(0,d.ref)(!1),k=(0,d.ref)(null),b=(0,d.ref)(void 0),V=(0,d.computed)(()=>a.currentScene?.background||''),I=(0,d.computed)(()=>a.currentScene?.sprites||[]);function P(){n.value=!n.value}function A(){l.value=!l.value}function M(){'combat'===a.mode?D():a.setMode('combat')}function D(){a.setMode('main')}function B(){c.value=!c.value}function R(){i.value=!i.value}function W(){u.value=!u.value}function x(){y.value=!y.value}function T(){f.value=!f.value}function U(){S.value=!S.value}function G(){C.value=!C.value}function O(){'sanctuary'===a.mode?L():a.setMode('sanctuary')}function L(){a.setMode('main')}function F(){console.log('[MainInterface] 关闭欢迎页面，进入角色创建'),o.value=!1,a.setMode('creation')}function j(){console.log('[MainInterface] 关闭欢迎页面，继续游戏'),o.value=!1}async function H(e){if(console.log('[MainInterface] 角色创建完成:',e.name),r.value=!1,b.value=void 0,'creation'===a.mode&&a.setMode('main'),toastr.success(`角色 ${e.name} 创建成功！`),'player'===e.type){console.log('[MainInterface] 检测到主控角色创建，调用 characterInitializer.onCharacterCreated()');try{const{characterInitializer:t}=await Promise.resolve().then(s.bind(s,391));await t.onCharacterCreated(e),console.log('[MainInterface] ✅ 主控角色创建后处理完成')}catch(e){console.error('[MainInterface] ❌ 主控角色创建后处理失败:',e),toastr.error('角色创建后处理失败，请查看控制台')}}}function J(e){b.value=e,n.value=!1,r.value=!0}function X(){console.log('[MainInterface] 收到新消息，自动显示对话框'),N.value&&(N.value=!1,k.value?.openDialogue())}function q(){N.value?(N.value=!1,k.value?.openDialogue()):N.value=!0}function K(){w.value=!w.value}function Z(){const e=document.documentElement;E.value?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function Y(){E.value=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}return(0,d.watch)(()=>a.mode,e=>{'main'!==e&&y.value&&(y.value=!1)}),(0,d.onMounted)(()=>{console.log('[MainInterface] 注册事件监听器...'),document.addEventListener('fullscreenchange',Y),document.addEventListener('webkitfullscreenchange',Y),document.addEventListener('msfullscreenchange',Y),eventOn('character_created',async()=>{console.log('[MainInterface] 角色创建完成，同步到酒馆并生成现实世界地图');try{const{characterInitializer:e}=await Promise.resolve().then(s.bind(s,391));await e.syncToSillyTavern();const{realWorldMapService:t}=await Promise.resolve().then(s.bind(s,76)),a=(0,g.m)();if(a.player){await t.hasMap()?console.log('[MainInterface] 现实世界地图已存在，跳过生成'):(console.log('[MainInterface] 开始生成现实世界地图...'),await t.generateMap(a.player),console.log('[MainInterface] 现实世界地图生成成功'))}}catch(e){console.error('[MainInterface] 角色创建后处理失败:',e),toastr.error('角色创建后处理失败，请检查控制台')}finally{'creation'===a.mode&&a.setMode('main')}}),console.log('[MainInterface] 事件监听器注册完成，开始初始化...'),setTimeout(()=>{!async function(){try{console.log('[MainInterface] 开始初始化...'),console.log('[MainInterface] 1/9 初始化 MVU 服务...'),await v.mvuService.initialize(),console.log('[MainInterface] 2/9 初始化酒馆服务...'),p.initialize(),p.setupEventListeners(),console.log('[MainInterface] 3/9 加载角色数据...'),await t.loadFromMVU(),console.log('[MainInterface] 角色数据加载完成，hasPlayer:',t.hasPlayer),console.log('[MainInterface] 4/9 初始化游戏状态...'),await a.initialize(),console.log('[MainInterface] 5/9 初始化记忆碎片服务...'),await m.z.initialize(),m.z.startListening(),console.log('[MainInterface] 6/9 初始化事件记录服务...');const{eventRecordService:e}=await Promise.resolve().then(s.bind(s,493));e.initialize(),console.log('[MainInterface] 7/9 初始化 API 配置服务...');const{apiConfigService:o}=await Promise.resolve().then(s.bind(s,588));await o.initialize(),console.log('[MainInterface] 8/10 初始化归所服务...');const{sanctuaryService:n}=await Promise.resolve().then(s.bind(s,820));await n.initialize(),console.log('[MainInterface] 9/10 初始化背包系统...');try{const{useInventoryStore:e}=await Promise.resolve().then(s.bind(s,202)),t=e();await t.loadFromGlobal(),console.log('[MainInterface] 背包系统初始化完成')}catch(e){console.error('[MainInterface] 背包系统初始化失败:',e)}console.log('[MainInterface] 10/10 检查主控角色初始化...');const{characterInitializer:r}=await Promise.resolve().then(s.bind(s,391));await r.checkAndInitialize()?console.log('[MainInterface] ✅ 需要初始化主控角色，等待欢迎页面显示'):console.log('[MainInterface] ℹ️ 无需初始化主控角色'),console.log('[MainInterface] ✅ 初始化完成'),toastr.success('无限流系统初始化完成')}catch(e){console.error('[MainInterface] ❌ 初始化失败:',e),toastr.error('初始化失败，请刷新页面重试')}}()},0)}),(0,d.onBeforeUnmount)(()=>{document.removeEventListener('fullscreenchange',Y),document.removeEventListener('webkitfullscreenchange',Y),document.removeEventListener('msfullscreenchange',Y)}),(e,s)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',Zc,[(0,d.createCommentVNode)(' ==================== 背景层 ==================== '),(0,d.createElementVNode)('div',Yc,[(0,d.createVNode)(se,{'background-url':V.value},null,8,['background-url'])]),(0,d.createCommentVNode)(' ==================== 立绘层 ==================== '),(0,d.createElementVNode)('div',Qc,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(I.value,e=>((0,d.openBlock)(),(0,d.createBlock)(Jt,{key:e.characterId,'sprite-data':e},null,8,['sprite-data']))),128))]),(0,d.createCommentVNode)(' ==================== UI 层 ==================== '),(0,d.withDirectives)((0,d.createElementVNode)('div',ei,[(0,d.createCommentVNode)(' 主游戏模式 UI '),'main'===(0,d.unref)(a).mode?((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:0},[(0,d.createCommentVNode)(' 状态栏 '),(0,d.withDirectives)((0,d.createVNode)(Nc,null,null,512),[[d.vShow,(0,d.unref)(t).hasPlayer]]),(0,d.createCommentVNode)(' 对话框 '),(0,d.withDirectives)((0,d.createVNode)(Wa,{ref_key:'dialogueBoxRef',ref:k,onNewMessage:X},null,512),[[d.vShow,!N.value]])],64)):(0,d.createCommentVNode)('v-if',!0)],512),[[d.vShow,!w.value]]),(0,d.createCommentVNode)(' ==================== 战斗模式（模态框） ==================== '),'combat'!==(0,d.unref)(a).mode||w.value?(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:0,class:'modal-overlay',onClick:D},[(0,d.createElementVNode)('div',{onClick:s[0]||(s[0]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(ya,{onClose:D})])])),(0,d.createCommentVNode)(' ==================== 归所模式（模态框） ==================== '),'sanctuary'!==(0,d.unref)(a).mode||w.value?(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('div',ti,[(0,d.createElementVNode)('div',{class:'sanctuary-container',onClick:s[1]||(s[1]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(uc,{onClose:L})])])),(0,d.createCommentVNode)(' ==================== 角色创建模式（模态框） ==================== '),'creation'!==(0,d.unref)(a).mode||w.value?(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('div',ai,[(0,d.createElementVNode)('div',{onClick:s[2]||(s[2]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(Qe,{'sync-to-tavern':!0,'character-type':'player',onCreated:H})])])),(0,d.createCommentVNode)(' ==================== 欢迎页面（模态框） ==================== '),o.value?((0,d.openBlock)(),(0,d.createBlock)(Kc,{key:3,onUpdateCharacter:F,onContinue:j})):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' ==================== 控制面板（常驻） ==================== '),w.value||'main'!==(0,d.unref)(a).mode?(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('div',oi,[(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['control-btn',{active:n.value}]),title:'角色管理',onClick:P},' 👥 ',2),(0,d.createCommentVNode)(' 角色创建按钮已移除，只能通过角色管理面板编辑 '),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['control-btn',{active:u.value}]),title:'副本生成器',onClick:W},' 🎭 ',2),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['control-btn',{active:f.value}]),title:'副本记录',onClick:T},' 📖 ',2),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['control-btn',{active:'sanctuary'===(0,d.unref)(a).mode}]),title:'归所',onClick:O},' 🏠 ',2),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['control-btn',{active:l.value}]),title:'投骰器',onClick:A},' 🎲 ',2),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['control-btn',{active:'combat'===(0,d.unref)(a).mode}]),title:'战斗面板',onClick:M},' ⚔️ ',2),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['control-btn',{active:c.value}]),title:'地图',onClick:B},'🗺️',2),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['control-btn',{active:i.value}]),title:'背包',onClick:R},'🎒',2),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['control-btn',{active:S.value}]),title:'API 配置',onClick:U},' ⚙️ ',2),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['control-btn',{active:C.value}]),title:'集成测试',onClick:G},' 🧪 ',2)])),(0,d.createCommentVNode)(' UI恢复按钮（左下角，常驻） '),(0,d.createElementVNode)('button',{class:(0,d.normalizeClass)(['ui-toggle-btn',{'ui-hidden':w.value}]),title:w.value?'显示UI':'隐藏UI',onClick:K},(0,d.toDisplayString)(w.value?'👁️':'🙈'),11,ni),(0,d.createCommentVNode)(' 切换对话框按钮（右下角） '),w.value||'main'!==(0,d.unref)(a).mode?(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('button',{key:5,class:(0,d.normalizeClass)(['toggle-dialogue-btn',{active:!N.value}]),title:N.value?'显示对话框':'隐藏对话框',onClick:q},' 💬 ',10,ri)),(0,d.createCommentVNode)(' 全屏按钮（右上角） '),w.value||'sanctuary'===(0,d.unref)(a).mode?(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('button',{key:6,class:'fullscreen-btn',title:E.value?'退出全屏':'全屏显示',onClick:Z},(0,d.toDisplayString)(E.value?'🗗':'⛶'),9,li)),(0,d.createCommentVNode)(' 角色面板（模态框） '),n.value&&!w.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:7,class:'modal-overlay',onClick:P},[(0,d.createElementVNode)('div',{onClick:s[3]||(s[3]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(Lt,{onClose:P,onEdit:J})])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 角色创建器（模态框） '),r.value&&!w.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',si,[(0,d.createElementVNode)('div',{onClick:s[4]||(s[4]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(Qe,{'sync-to-tavern':!0,'character-type':b.value?.type||'player','editing-character':b.value,onCreated:H},null,8,['character-type','editing-character'])])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 投骰器（模态框） '),l.value&&!w.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:9,class:'modal-overlay',onClick:A},[(0,d.createElementVNode)('div',{onClick:s[5]||(s[5]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(Ka,{onClose:A})])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 地图面板（模态框） '),c.value&&!w.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:10,class:'modal-overlay',onClick:B},[(0,d.createElementVNode)('div',{onClick:s[6]||(s[6]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(os)])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 背包面板（模态框） '),i.value&&!w.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:11,class:'modal-overlay',onClick:R},[(0,d.createElementVNode)('div',{onClick:s[7]||(s[7]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(il,{onClose:R})])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 副本生成器（模态框） '),u.value&&!w.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:12,class:'modal-overlay',onClick:W},[(0,d.createElementVNode)('div',{onClick:s[8]||(s[8]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(To,{onClose:W})])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 副本记录（模态框） '),f.value&&!w.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:13,class:'modal-overlay',onClick:T},[(0,d.createElementVNode)('div',{onClick:s[9]||(s[9]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(Br,{onClose:T})])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' API 配置面板（模态框） '),S.value&&!w.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:14,class:'modal-overlay',onClick:U},[(0,d.createElementVNode)('div',{onClick:s[10]||(s[10]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(ee,{onClose:U})])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 集成测试面板（模态框） '),C.value&&!w.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:15,class:'modal-overlay',onClick:G},[(0,d.createElementVNode)('div',{onClick:s[11]||(s[11]=(0,d.withModifiers)(()=>{},['stop']))},[(0,d.createVNode)(Gc,{onClose:G})])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 剧情回顾面板（左侧，仅在主模式显示） '),y.value&&!w.value&&'main'===(0,d.unref)(a).mode?((0,d.openBlock)(),(0,d.createBlock)(vn,{key:16,onClose:x})):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 剧情回顾按钮（左上角，仅在主模式显示） '),w.value||'main'!==(0,d.unref)(a).mode?(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('button',{key:17,class:(0,d.normalizeClass)(['plot-review-btn',{active:y.value}]),title:'剧情回顾',onClick:x},' 📜 ',2))]))}}),ii=(0,Q.A)(ci,[['__scopeId','data-v-470a9889']]),ui={class:'infinite-flow-game'},di={key:0,class:'loading-overlay'},mi={class:'loading-content'},vi={class:'error-overlay'},pi={class:'error-content'},gi=(0,d.defineComponent)({__name:'app',setup(e){const t=(0,d.ref)(!0),a=(0,d.ref)(!1),o=(0,d.ref)(''),n=(0,d.ref)('正在初始化...');async function r(){t.value=!0,a.value=!1,o.value='';try{n.value='等待 MVU 初始化...',console.log('[App] 主应用容器已挂载'),console.log('[App] 准备加载主界面'),t.value=!1}catch(e){console.error('[App] 游戏初始化失败:',e),a.value=!0,o.value=e instanceof Error?e.message:'未知错误',toastr.error('游戏初始化失败'),t.value=!1}}function l(){r()}return(0,d.onMounted)(()=>{r()}),(e,r)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',ui,[(0,d.createCommentVNode)(' 加载提示 '),t.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',di,[(0,d.createElementVNode)('div',mi,[r[0]||(r[0]=(0,d.createElementVNode)('div',{class:'loading-spinner'},null,-1)),(0,d.createElementVNode)('p',null,(0,d.toDisplayString)(n.value),1)])])):a.value?((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:1},[(0,d.createCommentVNode)(' 错误提示 '),(0,d.createElementVNode)('div',vi,[(0,d.createElementVNode)('div',pi,[r[1]||(r[1]=(0,d.createElementVNode)('h2',null,'⚠️ 初始化失败',-1)),(0,d.createElementVNode)('p',null,(0,d.toDisplayString)(o.value),1),(0,d.createElementVNode)('button',{class:'retry-button',onClick:l},'重试')])])],2112)):((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:2},[(0,d.createCommentVNode)(' 游戏界面 '),(0,d.createVNode)(ii)],2112))]))}}),hi=(0,Q.A)(gi,[['__scopeId','data-v-dd7cafd0']]);window.addEventListener('error',e=>{console.error('全局错误:',e.error),u().error('发生错误，请检查控制台')}),$(()=>{console.log('[无限流] 开始加载界面...'),console.log('[无限流] 当前时间:',(new Date).toLocaleString()),function(){try{console.log('[无限流] 开始隐藏非 0 楼消息...');const e=$('.mes',window.parent.document);console.log('[无限流] 找到',e.length,'条消息');let t=0;e.each((e,a)=>{const o=$(a),n=o.attr('mesid');console.log(`[无限流] 消息 ${e}: mesid=${n}`),'0'!==n&&void 0!==n?(o.addClass('hidden-by-infinite-flow').hide(),t++,console.log(`[无限流] 隐藏消息: mesid=${n}`)):console.log(`[无限流] 保留消息: mesid=${n} (第 0 楼)`)}),console.log('[无限流] 已隐藏',t,'条非 0 楼消息，保留第 0 楼')}catch(e){console.error('[无限流] 隐藏消息失败:',e)}}(),console.log('[无限流] 等待 MVU 变量框架初始化...'),waitGlobalInitialized('Mvu').then(async()=>{console.log('[无限流] MVU 变量框架初始化完成'),console.log('[无限流] 设置流式传输监听器...'),Ea.setupStreamListeners(),console.log('[无限流] 流式传输监听器设置完成'),console.log('[无限流] 初始化记忆碎片服务...'),await m.z.initialize(),m.z.startListening(),console.log('[无限流] 记忆碎片服务已启动'),console.log('[无限流] 初始化归所服务...'),await ns.sanctuaryService.initialize(),console.log('[无限流] 归所服务已启动'),console.log('[无限流] 初始化 API 自动切换服务...');try{await N.initialize(),console.log('[无限流] API 自动切换服务已启动')}catch(e){console.error('[无限流] API 自动切换服务初始化失败:',e),console.error('[无限流] 错误详情:',e),u().warning('API 自动切换服务初始化失败，将使用默认 API')}console.log('[无限流] 创建 Vue 应用...');const e=(0,d.createApp)(hi);console.log('[无限流] 创建 Pinia 状态管理...');const t=(0,c.createPinia)();e.use(t),console.log('[无限流] 挂载 Vue 应用到 #app...'),e.mount('#app'),console.log('[无限流] 无限流视觉互动小说游戏界面加载完成'),u().success('游戏界面加载成功');const a=SillyTavern.getCurrentChatId();console.log('[无限流] 当前聊天 ID:',a),console.log('[无限流] 设置聊天文件变更监听器...'),eventOn(tavern_events.CHAT_CHANGED,e=>{console.log('[无限流] 检测到聊天文件变更'),console.log('[无限流] 旧聊天 ID:',a),console.log('[无限流] 新聊天 ID:',e),a!==e&&(console.log('[无限流] 聊天文件已变更，准备重新加载界面...'),u().info('聊天文件已变更，正在重新加载...'),window.location.reload())}),console.log('[无限流] 所有初始化完成，界面已就绪')}).catch(e=>{console.error('[无限流] MVU 初始化失败:',e),console.error('[无限流] 错误详情:',{message:e.message,stack:e.stack,name:e.name}),u().error('MVU 初始化失败，请检查是否安装了 MVU 变量框架')})}),$(window).on('pagehide',async()=>{console.log('[无限流] 界面卸载事件触发'),console.log('[无限流] 卸载时间:',(new Date).toLocaleString());try{console.log('[无限流] 清理 API 自动切换服务...'),await N.cleanup(),console.log('[无限流] API 自动切换服务已清理')}catch(e){console.error('[无限流] API 自动切换服务清理失败:',e)}!function(){try{console.log('[无限流] 开始恢复被隐藏的消息...');const e=$('.hidden-by-infinite-flow',window.parent.document);console.log('[无限流] 找到',e.length,'条被隐藏的消息'),e.removeClass('hidden-by-infinite-flow').show(),console.log('[无限流] 已恢复所有被隐藏的消息')}catch(e){console.error('[无限流] 恢复消息失败:',e)}}(),console.log('[无限流] 无限流视觉互动小说游戏界面已卸载'),u().info('游戏界面已卸载')});
//# sourceMappingURL=index.js.map</script><style>[data-v-5f7754f2]{box-sizing:border-box;margin:0;padding:0}body[data-v-5f7754f2]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-5f7754f2]::-webkit-scrollbar{width:8px;height:8px}[data-v-5f7754f2]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-5f7754f2]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-5f7754f2]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-5f7754f2]{color:#d4af37}.text-muted[data-v-5f7754f2]{color:#888}.bg-overlay[data-v-5f7754f2]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-5f7754f2]{border:2px solid #d4af37}.shadow-gold[data-v-5f7754f2]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-5f7754f2]{z-index:50 !important}.dialogue-box[data-v-5f7754f2],.combat-panel[data-v-5f7754f2],.character-panel[data-v-5f7754f2],.character-creator[data-v-5f7754f2],.instance-record[data-v-5f7754f2],.instance-generator[data-v-5f7754f2],.interaction-room[data-v-5f7754f2],.dice-roller[data-v-5f7754f2],.map-panel[data-v-5f7754f2],.plot-review[data-v-5f7754f2]{z-index:50 !important}[data-v-5f7754f2]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-5f7754f2]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-5f7754f2]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-5f7754f2],.dialogue-box[data-v-5f7754f2],.combat-panel[data-v-5f7754f2],.character-panel[data-v-5f7754f2],.character-creator[data-v-5f7754f2],.instance-record[data-v-5f7754f2],.instance-generator[data-v-5f7754f2],.interaction-room[data-v-5f7754f2],.dice-roller[data-v-5f7754f2],.map-panel[data-v-5f7754f2],.plot-review[data-v-5f7754f2]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-5f7754f2],.dialogue-box[data-v-5f7754f2],.combat-panel[data-v-5f7754f2],.character-panel[data-v-5f7754f2],.character-creator[data-v-5f7754f2],.instance-record[data-v-5f7754f2],.instance-generator[data-v-5f7754f2],.interaction-room[data-v-5f7754f2],.dice-roller[data-v-5f7754f2],.map-panel[data-v-5f7754f2],.plot-review[data-v-5f7754f2]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-5f7754f2],.dialogue-box[data-v-5f7754f2],.combat-panel[data-v-5f7754f2],.character-panel[data-v-5f7754f2],.character-creator[data-v-5f7754f2],.instance-record[data-v-5f7754f2],.instance-generator[data-v-5f7754f2],.interaction-room[data-v-5f7754f2],.dice-roller[data-v-5f7754f2],.map-panel[data-v-5f7754f2],.plot-review[data-v-5f7754f2]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-5f7754f2],.modal-overlay input[data-v-5f7754f2],.modal-overlay textarea[data-v-5f7754f2],.modal-overlay select[data-v-5f7754f2],.modal-overlay .btn[data-v-5f7754f2],.modal-overlay .form-control[data-v-5f7754f2],.modal-overlay .modal-title[data-v-5f7754f2],.modal-overlay .close-btn[data-v-5f7754f2],.dialogue-box button[data-v-5f7754f2],.dialogue-box input[data-v-5f7754f2],.dialogue-box textarea[data-v-5f7754f2],.dialogue-box select[data-v-5f7754f2],.dialogue-box .btn[data-v-5f7754f2],.dialogue-box .form-control[data-v-5f7754f2],.dialogue-box .modal-title[data-v-5f7754f2],.dialogue-box .close-btn[data-v-5f7754f2],.combat-panel button[data-v-5f7754f2],.combat-panel input[data-v-5f7754f2],.combat-panel textarea[data-v-5f7754f2],.combat-panel select[data-v-5f7754f2],.combat-panel .btn[data-v-5f7754f2],.combat-panel .form-control[data-v-5f7754f2],.combat-panel .modal-title[data-v-5f7754f2],.combat-panel .close-btn[data-v-5f7754f2],.character-panel button[data-v-5f7754f2],.character-panel input[data-v-5f7754f2],.character-panel textarea[data-v-5f7754f2],.character-panel select[data-v-5f7754f2],.character-panel .btn[data-v-5f7754f2],.character-panel .form-control[data-v-5f7754f2],.character-panel .modal-title[data-v-5f7754f2],.character-panel .close-btn[data-v-5f7754f2],.character-creator button[data-v-5f7754f2],.character-creator input[data-v-5f7754f2],.character-creator textarea[data-v-5f7754f2],.character-creator select[data-v-5f7754f2],.character-creator .btn[data-v-5f7754f2],.character-creator .form-control[data-v-5f7754f2],.character-creator .modal-title[data-v-5f7754f2],.character-creator .close-btn[data-v-5f7754f2],.instance-record button[data-v-5f7754f2],.instance-record input[data-v-5f7754f2],.instance-record textarea[data-v-5f7754f2],.instance-record select[data-v-5f7754f2],.instance-record .btn[data-v-5f7754f2],.instance-record .form-control[data-v-5f7754f2],.instance-record .modal-title[data-v-5f7754f2],.instance-record .close-btn[data-v-5f7754f2],.instance-generator button[data-v-5f7754f2],.instance-generator input[data-v-5f7754f2],.instance-generator textarea[data-v-5f7754f2],.instance-generator select[data-v-5f7754f2],.instance-generator .btn[data-v-5f7754f2],.instance-generator .form-control[data-v-5f7754f2],.instance-generator .modal-title[data-v-5f7754f2],.instance-generator .close-btn[data-v-5f7754f2],.interaction-room button[data-v-5f7754f2],.interaction-room input[data-v-5f7754f2],.interaction-room textarea[data-v-5f7754f2],.interaction-room select[data-v-5f7754f2],.interaction-room .btn[data-v-5f7754f2],.interaction-room .form-control[data-v-5f7754f2],.interaction-room .modal-title[data-v-5f7754f2],.interaction-room .close-btn[data-v-5f7754f2],.dice-roller button[data-v-5f7754f2],.dice-roller input[data-v-5f7754f2],.dice-roller textarea[data-v-5f7754f2],.dice-roller select[data-v-5f7754f2],.dice-roller .btn[data-v-5f7754f2],.dice-roller .form-control[data-v-5f7754f2],.dice-roller .modal-title[data-v-5f7754f2],.dice-roller .close-btn[data-v-5f7754f2],.map-panel button[data-v-5f7754f2],.map-panel input[data-v-5f7754f2],.map-panel textarea[data-v-5f7754f2],.map-panel select[data-v-5f7754f2],.map-panel .btn[data-v-5f7754f2],.map-panel .form-control[data-v-5f7754f2],.map-panel .modal-title[data-v-5f7754f2],.map-panel .close-btn[data-v-5f7754f2],.plot-review button[data-v-5f7754f2],.plot-review input[data-v-5f7754f2],.plot-review textarea[data-v-5f7754f2],.plot-review select[data-v-5f7754f2],.plot-review .btn[data-v-5f7754f2],.plot-review .form-control[data-v-5f7754f2],.plot-review .modal-title[data-v-5f7754f2],.plot-review .close-btn[data-v-5f7754f2]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-5f7754f2],.modal-overlay h2[data-v-5f7754f2],.modal-overlay h3[data-v-5f7754f2],.modal-overlay .modal-title[data-v-5f7754f2],.dialogue-box h1[data-v-5f7754f2],.dialogue-box h2[data-v-5f7754f2],.dialogue-box h3[data-v-5f7754f2],.dialogue-box .modal-title[data-v-5f7754f2],.combat-panel h1[data-v-5f7754f2],.combat-panel h2[data-v-5f7754f2],.combat-panel h3[data-v-5f7754f2],.combat-panel .modal-title[data-v-5f7754f2],.character-panel h1[data-v-5f7754f2],.character-panel h2[data-v-5f7754f2],.character-panel h3[data-v-5f7754f2],.character-panel .modal-title[data-v-5f7754f2],.character-creator h1[data-v-5f7754f2],.character-creator h2[data-v-5f7754f2],.character-creator h3[data-v-5f7754f2],.character-creator .modal-title[data-v-5f7754f2],.instance-record h1[data-v-5f7754f2],.instance-record h2[data-v-5f7754f2],.instance-record h3[data-v-5f7754f2],.instance-record .modal-title[data-v-5f7754f2],.instance-generator h1[data-v-5f7754f2],.instance-generator h2[data-v-5f7754f2],.instance-generator h3[data-v-5f7754f2],.instance-generator .modal-title[data-v-5f7754f2],.interaction-room h1[data-v-5f7754f2],.interaction-room h2[data-v-5f7754f2],.interaction-room h3[data-v-5f7754f2],.interaction-room .modal-title[data-v-5f7754f2],.dice-roller h1[data-v-5f7754f2],.dice-roller h2[data-v-5f7754f2],.dice-roller h3[data-v-5f7754f2],.dice-roller .modal-title[data-v-5f7754f2],.map-panel h1[data-v-5f7754f2],.map-panel h2[data-v-5f7754f2],.map-panel h3[data-v-5f7754f2],.map-panel .modal-title[data-v-5f7754f2],.plot-review h1[data-v-5f7754f2],.plot-review h2[data-v-5f7754f2],.plot-review h3[data-v-5f7754f2],.plot-review .modal-title[data-v-5f7754f2]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-5f7754f2],.modal-overlay .form-group[data-v-5f7754f2],.dialogue-box .button-group[data-v-5f7754f2],.dialogue-box .form-group[data-v-5f7754f2],.combat-panel .button-group[data-v-5f7754f2],.combat-panel .form-group[data-v-5f7754f2],.character-panel .button-group[data-v-5f7754f2],.character-panel .form-group[data-v-5f7754f2],.character-creator .button-group[data-v-5f7754f2],.character-creator .form-group[data-v-5f7754f2],.instance-record .button-group[data-v-5f7754f2],.instance-record .form-group[data-v-5f7754f2],.instance-generator .button-group[data-v-5f7754f2],.instance-generator .form-group[data-v-5f7754f2],.interaction-room .button-group[data-v-5f7754f2],.interaction-room .form-group[data-v-5f7754f2],.dice-roller .button-group[data-v-5f7754f2],.dice-roller .form-group[data-v-5f7754f2],.map-panel .button-group[data-v-5f7754f2],.map-panel .form-group[data-v-5f7754f2],.plot-review .button-group[data-v-5f7754f2],.plot-review .form-group[data-v-5f7754f2]{gap:calc(16px*var(--modal-scale))}.api-config-panel[data-v-5f7754f2]{width:100%;max-width:800px;max-height:90vh;overflow-y:auto;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:32px;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.api-config-panel[data-v-5f7754f2]{max-width:95vw;max-height:95vh;padding:16px;border-width:1px}}@media (max-width:480px){.api-config-panel[data-v-5f7754f2]{max-width:98vw;padding:8px}}.api-config-panel[data-v-5f7754f2]{max-width:600px;width:100%}.panel-title[data-v-5f7754f2]{--base-title-size:32px;font-size:32px;color:#d4af37;text-align:center;margin-bottom:32px;text-shadow:0 0 10px rgba(212,175,55,.5)}@media (max-width:767px){.panel-title[data-v-5f7754f2]{--base-title-size:24px;font-size:24px;margin-bottom:16px}}@media (max-width:480px){.panel-title[data-v-5f7754f2]{--base-title-size:20px;font-size:20px;margin-bottom:8px}}.panel-title[data-v-5f7754f2]{text-align:center;margin-bottom:8px}.panel-description[data-v-5f7754f2]{font-size:14px;color:#ccc;margin-bottom:24px;text-align:center;line-height:1.5}@media (max-width:767px){.panel-description[data-v-5f7754f2]{font-size:12px;margin-bottom:16px}}.current-api-info[data-v-5f7754f2]{background:rgba(212,175,55,.1);padding:16px;border-radius:4px;border:1px solid #d4af37;margin-bottom:24px}@media (max-width:767px){.current-api-info[data-v-5f7754f2]{padding:8px;margin-bottom:16px}}.current-api-info .info-row[data-v-5f7754f2]{display:flex;justify-content:space-between;align-items:center;padding:4px 0}.current-api-info .info-row[data-v-5f7754f2]:not(:last-child){border-bottom:1px solid rgba(212,175,55,.3)}@media (max-width:767px){.current-api-info .info-row[data-v-5f7754f2]{flex-direction:column;align-items:flex-start;gap:4px}}.current-api-info .info-row.model-info[data-v-5f7754f2]{font-size:14px;opacity:.9}@media (max-width:767px){.current-api-info .info-row.model-info[data-v-5f7754f2]{font-size:12px}}.current-api-info .info-label[data-v-5f7754f2]{color:#d4af37;font-size:14px}@media (max-width:767px){.current-api-info .info-label[data-v-5f7754f2]{font-size:12px}}.current-api-info .info-value[data-v-5f7754f2]{font-weight:700;font-size:16px}@media (max-width:767px){.current-api-info .info-value[data-v-5f7754f2]{font-size:14px}}.current-api-info .info-value.custom-api[data-v-5f7754f2]{color:#f4d03f}.current-api-info .info-value.default-api[data-v-5f7754f2]{color:#2196f3}.config-tabs[data-v-5f7754f2]{display:flex;gap:4px;margin-bottom:24px;border-bottom:2px solid #d4af37}@media (max-width:767px){.config-tabs[data-v-5f7754f2]{margin-bottom:16px}}.tab-button[data-v-5f7754f2]{flex:1;padding:8px 16px;background:rgba(0,0,0,0);border:none;color:#ccc;cursor:pointer;transition:all .3s ease;border-bottom:2px solid rgba(0,0,0,0);margin-bottom:-2px;font-size:16px}@media (max-width:767px){.tab-button[data-v-5f7754f2]{padding:4px 8px;font-size:14px}}.tab-button[data-v-5f7754f2]:hover{color:#f5f5f5;background:rgba(212,175,55,.1)}.tab-button.active[data-v-5f7754f2]{color:#f4d03f;border-bottom-color:#f4d03f;font-weight:700}.config-form[data-v-5f7754f2]{margin-bottom:32px}@media (max-width:767px){.config-form[data-v-5f7754f2]{margin-bottom:24px}}.form-group[data-v-5f7754f2]{margin-bottom:24px}@media (max-width:767px){.form-group[data-v-5f7754f2]{margin-bottom:16px}}.form-label[data-v-5f7754f2]{display:block;margin-bottom:8px;color:#d4af37;font-size:14px}@media (max-width:767px){.form-label[data-v-5f7754f2]{font-size:12px}}.form-label input[type=checkbox][data-v-5f7754f2]{margin-right:8px;cursor:pointer}.form-input[data-v-5f7754f2]{--base-font-size:16px;--base-padding:16px;--base-border-radius:4px;padding:16px;background:rgba(0,0,0,.5);border:1px solid #d4af37;color:#f5f5f5;font-size:16px;font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;border-radius:4px;transition:all .3s ease}@media (max-width:767px){.form-input[data-v-5f7754f2]{--base-padding:8px;--base-font-size:14px;padding:8px;font-size:14px}}.form-input[data-v-5f7754f2]:focus{outline:none;border-color:#d4af37;box-shadow:0 0 20px rgba(212,175,55,.3)}.form-input[data-v-5f7754f2]::placeholder{color:#888}.form-input[data-v-5f7754f2]{width:100%}.form-input[data-v-5f7754f2]:hover{border-color:#f4d03f}.form-input[data-v-5f7754f2]:focus{border-color:#f4d03f;box-shadow:0 0 20px rgba(212,175,55,.3)}.model-input-group .model-presets[data-v-5f7754f2]{display:flex;flex-wrap:wrap;gap:4px;margin-top:8px}@media (max-width:767px){.model-input-group .model-presets[data-v-5f7754f2]{gap:4px}}.model-input-group .preset-chip[data-v-5f7754f2]{padding:4px 8px;background:rgba(212,175,55,.1);border:1px solid #d4af37;border-radius:4px;color:#f5f5f5;font-size:12px;cursor:pointer;transition:all .3s ease}@media (max-width:767px){.model-input-group .preset-chip[data-v-5f7754f2]{padding:4px 4px;font-size:10px}}.model-input-group .preset-chip[data-v-5f7754f2]:hover{background:rgba(244,208,63,.2);border-color:#f4d03f;transform:translateY(-1px)}.model-input-group .preset-chip[data-v-5f7754f2]:active{transform:translateY(0)}.model-input-group .model-hint[data-v-5f7754f2]{display:block;font-size:12px;color:#ccc;margin-top:4px}.api-key-hint[data-v-5f7754f2]{display:block;font-size:12px;color:#ccc;margin-top:4px;font-style:italic}.form-range[data-v-5f7754f2]{width:100%;margin-bottom:4px;cursor:pointer}.form-range[data-v-5f7754f2]::-webkit-slider-thumb{background:#d4af37}.form-range[data-v-5f7754f2]::-moz-range-thumb{background:#d4af37}.range-hint[data-v-5f7754f2]{display:block;font-size:12px;color:#ccc;margin-top:4px}.form-actions[data-v-5f7754f2]{margin-top:24px}@media (max-width:767px){.form-actions[data-v-5f7754f2]{margin-top:16px}}.test-result[data-v-5f7754f2]{margin-top:16px;padding:16px;border-radius:4px;font-size:14px}@media (max-width:767px){.test-result[data-v-5f7754f2]{padding:8px;font-size:12px}}.test-result.success[data-v-5f7754f2]{background:rgba(76,175,80,.2);border:1px solid #4caf50;color:rgb(145.5378486056,207.4621513944,148.0398406375)}.test-result.error[data-v-5f7754f2]{background:rgba(244,67,54,.2);border:1px solid #f44336;color:hsl(4.1052631579,89.6226415094%,78.431372549%)}.panel-actions[data-v-5f7754f2]{display:flex;gap:16px;flex-wrap:wrap}@media (max-width:767px){.panel-actions[data-v-5f7754f2]{gap:8px}}@media (max-width:480px){.panel-actions[data-v-5f7754f2]{flex-direction:column}}.panel-actions[data-v-5f7754f2]{justify-content:center}.btn[data-v-5f7754f2]{padding:8px 32px;border:none;border-radius:4px;cursor:pointer;font-size:16px;font-weight:700;transition:all .3s ease}@media (max-width:767px){.btn[data-v-5f7754f2]{padding:4px 24px;font-size:14px}}.btn[data-v-5f7754f2]:disabled{opacity:.5;cursor:not-allowed}.btn[data-v-5f7754f2]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.4)}.btn[data-v-5f7754f2]:active:not(:disabled){transform:translateY(0)}.btn-primary[data-v-5f7754f2]{background:linear-gradient(135deg,#d4af37,#b8941e);color:#0a0a0a;text-shadow:0 1px 2px hsla(0,0%,100%,.3)}.btn-primary[data-v-5f7754f2]:hover:not(:disabled){background:linear-gradient(135deg,#f4d03f,#d4af37);box-shadow:0 4px 8px rgba(0,0,0,.4),0 0 20px rgba(212,175,55,.3)}.btn-secondary[data-v-5f7754f2]{background:hsla(0,0%,80%,.2);color:#f5f5f5;border:1px solid #d4af37}.btn-secondary[data-v-5f7754f2]:hover:not(:disabled){background:hsla(0,0%,80%,.3);border-color:#f4d03f}.btn-test[data-v-5f7754f2]{background:linear-gradient(135deg,#2196f3,rgb(11.5384615385,124.0384615385,213.4615384615));color:#f5f5f5}.btn-test[data-v-5f7754f2]:hover:not(:disabled){background:linear-gradient(135deg,rgb(81.3846153846,172.8846153846,245.6153846154),#2196f3);box-shadow:0 4px 8px rgba(0,0,0,.4),0 0 15px rgba(33,150,243,.5)}.debug-mode-section[data-v-5f7754f2]{background:hsla(0,0%,80%,.1);padding:16px;border-radius:4px;border:1px solid #d4af37;margin-bottom:24px}@media (max-width:767px){.debug-mode-section[data-v-5f7754f2]{padding:8px;margin-bottom:16px}}.debug-mode-section .debug-mode-label[data-v-5f7754f2]{display:flex;align-items:center;color:#d4af37;font-size:14px;cursor:pointer}@media (max-width:767px){.debug-mode-section .debug-mode-label[data-v-5f7754f2]{font-size:12px}}.debug-mode-section .debug-mode-label input[type=checkbox][data-v-5f7754f2]{margin-right:8px;cursor:pointer;width:16px;height:16px}@media (max-width:767px){.debug-mode-section .debug-mode-label input[type=checkbox][data-v-5f7754f2]{width:14px;height:14px}}.debug-mode-section .debug-mode-label[data-v-5f7754f2]:hover{color:#f4d03f}
[data-v-8e8ada04]{box-sizing:border-box;margin:0;padding:0}body[data-v-8e8ada04]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-8e8ada04]::-webkit-scrollbar{width:8px;height:8px}[data-v-8e8ada04]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-8e8ada04]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-8e8ada04]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-8e8ada04]{color:#d4af37}.text-muted[data-v-8e8ada04]{color:#888}.bg-overlay[data-v-8e8ada04]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-8e8ada04]{border:2px solid #d4af37}.shadow-gold[data-v-8e8ada04]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-8e8ada04]{z-index:50 !important}.dialogue-box[data-v-8e8ada04],.combat-panel[data-v-8e8ada04],.character-panel[data-v-8e8ada04],.character-creator[data-v-8e8ada04],.instance-record[data-v-8e8ada04],.instance-generator[data-v-8e8ada04],.interaction-room[data-v-8e8ada04],.dice-roller[data-v-8e8ada04],.map-panel[data-v-8e8ada04],.plot-review[data-v-8e8ada04]{z-index:50 !important}[data-v-8e8ada04]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-8e8ada04]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-8e8ada04]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-8e8ada04],.dialogue-box[data-v-8e8ada04],.combat-panel[data-v-8e8ada04],.character-panel[data-v-8e8ada04],.character-creator[data-v-8e8ada04],.instance-record[data-v-8e8ada04],.instance-generator[data-v-8e8ada04],.interaction-room[data-v-8e8ada04],.dice-roller[data-v-8e8ada04],.map-panel[data-v-8e8ada04],.plot-review[data-v-8e8ada04]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-8e8ada04],.dialogue-box[data-v-8e8ada04],.combat-panel[data-v-8e8ada04],.character-panel[data-v-8e8ada04],.character-creator[data-v-8e8ada04],.instance-record[data-v-8e8ada04],.instance-generator[data-v-8e8ada04],.interaction-room[data-v-8e8ada04],.dice-roller[data-v-8e8ada04],.map-panel[data-v-8e8ada04],.plot-review[data-v-8e8ada04]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-8e8ada04],.dialogue-box[data-v-8e8ada04],.combat-panel[data-v-8e8ada04],.character-panel[data-v-8e8ada04],.character-creator[data-v-8e8ada04],.instance-record[data-v-8e8ada04],.instance-generator[data-v-8e8ada04],.interaction-room[data-v-8e8ada04],.dice-roller[data-v-8e8ada04],.map-panel[data-v-8e8ada04],.plot-review[data-v-8e8ada04]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-8e8ada04],.modal-overlay input[data-v-8e8ada04],.modal-overlay textarea[data-v-8e8ada04],.modal-overlay select[data-v-8e8ada04],.modal-overlay .btn[data-v-8e8ada04],.modal-overlay .form-control[data-v-8e8ada04],.modal-overlay .modal-title[data-v-8e8ada04],.modal-overlay .close-btn[data-v-8e8ada04],.dialogue-box button[data-v-8e8ada04],.dialogue-box input[data-v-8e8ada04],.dialogue-box textarea[data-v-8e8ada04],.dialogue-box select[data-v-8e8ada04],.dialogue-box .btn[data-v-8e8ada04],.dialogue-box .form-control[data-v-8e8ada04],.dialogue-box .modal-title[data-v-8e8ada04],.dialogue-box .close-btn[data-v-8e8ada04],.combat-panel button[data-v-8e8ada04],.combat-panel input[data-v-8e8ada04],.combat-panel textarea[data-v-8e8ada04],.combat-panel select[data-v-8e8ada04],.combat-panel .btn[data-v-8e8ada04],.combat-panel .form-control[data-v-8e8ada04],.combat-panel .modal-title[data-v-8e8ada04],.combat-panel .close-btn[data-v-8e8ada04],.character-panel button[data-v-8e8ada04],.character-panel input[data-v-8e8ada04],.character-panel textarea[data-v-8e8ada04],.character-panel select[data-v-8e8ada04],.character-panel .btn[data-v-8e8ada04],.character-panel .form-control[data-v-8e8ada04],.character-panel .modal-title[data-v-8e8ada04],.character-panel .close-btn[data-v-8e8ada04],.character-creator button[data-v-8e8ada04],.character-creator input[data-v-8e8ada04],.character-creator textarea[data-v-8e8ada04],.character-creator select[data-v-8e8ada04],.character-creator .btn[data-v-8e8ada04],.character-creator .form-control[data-v-8e8ada04],.character-creator .modal-title[data-v-8e8ada04],.character-creator .close-btn[data-v-8e8ada04],.instance-record button[data-v-8e8ada04],.instance-record input[data-v-8e8ada04],.instance-record textarea[data-v-8e8ada04],.instance-record select[data-v-8e8ada04],.instance-record .btn[data-v-8e8ada04],.instance-record .form-control[data-v-8e8ada04],.instance-record .modal-title[data-v-8e8ada04],.instance-record .close-btn[data-v-8e8ada04],.instance-generator button[data-v-8e8ada04],.instance-generator input[data-v-8e8ada04],.instance-generator textarea[data-v-8e8ada04],.instance-generator select[data-v-8e8ada04],.instance-generator .btn[data-v-8e8ada04],.instance-generator .form-control[data-v-8e8ada04],.instance-generator .modal-title[data-v-8e8ada04],.instance-generator .close-btn[data-v-8e8ada04],.interaction-room button[data-v-8e8ada04],.interaction-room input[data-v-8e8ada04],.interaction-room textarea[data-v-8e8ada04],.interaction-room select[data-v-8e8ada04],.interaction-room .btn[data-v-8e8ada04],.interaction-room .form-control[data-v-8e8ada04],.interaction-room .modal-title[data-v-8e8ada04],.interaction-room .close-btn[data-v-8e8ada04],.dice-roller button[data-v-8e8ada04],.dice-roller input[data-v-8e8ada04],.dice-roller textarea[data-v-8e8ada04],.dice-roller select[data-v-8e8ada04],.dice-roller .btn[data-v-8e8ada04],.dice-roller .form-control[data-v-8e8ada04],.dice-roller .modal-title[data-v-8e8ada04],.dice-roller .close-btn[data-v-8e8ada04],.map-panel button[data-v-8e8ada04],.map-panel input[data-v-8e8ada04],.map-panel textarea[data-v-8e8ada04],.map-panel select[data-v-8e8ada04],.map-panel .btn[data-v-8e8ada04],.map-panel .form-control[data-v-8e8ada04],.map-panel .modal-title[data-v-8e8ada04],.map-panel .close-btn[data-v-8e8ada04],.plot-review button[data-v-8e8ada04],.plot-review input[data-v-8e8ada04],.plot-review textarea[data-v-8e8ada04],.plot-review select[data-v-8e8ada04],.plot-review .btn[data-v-8e8ada04],.plot-review .form-control[data-v-8e8ada04],.plot-review .modal-title[data-v-8e8ada04],.plot-review .close-btn[data-v-8e8ada04]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-8e8ada04],.modal-overlay h2[data-v-8e8ada04],.modal-overlay h3[data-v-8e8ada04],.modal-overlay .modal-title[data-v-8e8ada04],.dialogue-box h1[data-v-8e8ada04],.dialogue-box h2[data-v-8e8ada04],.dialogue-box h3[data-v-8e8ada04],.dialogue-box .modal-title[data-v-8e8ada04],.combat-panel h1[data-v-8e8ada04],.combat-panel h2[data-v-8e8ada04],.combat-panel h3[data-v-8e8ada04],.combat-panel .modal-title[data-v-8e8ada04],.character-panel h1[data-v-8e8ada04],.character-panel h2[data-v-8e8ada04],.character-panel h3[data-v-8e8ada04],.character-panel .modal-title[data-v-8e8ada04],.character-creator h1[data-v-8e8ada04],.character-creator h2[data-v-8e8ada04],.character-creator h3[data-v-8e8ada04],.character-creator .modal-title[data-v-8e8ada04],.instance-record h1[data-v-8e8ada04],.instance-record h2[data-v-8e8ada04],.instance-record h3[data-v-8e8ada04],.instance-record .modal-title[data-v-8e8ada04],.instance-generator h1[data-v-8e8ada04],.instance-generator h2[data-v-8e8ada04],.instance-generator h3[data-v-8e8ada04],.instance-generator .modal-title[data-v-8e8ada04],.interaction-room h1[data-v-8e8ada04],.interaction-room h2[data-v-8e8ada04],.interaction-room h3[data-v-8e8ada04],.interaction-room .modal-title[data-v-8e8ada04],.dice-roller h1[data-v-8e8ada04],.dice-roller h2[data-v-8e8ada04],.dice-roller h3[data-v-8e8ada04],.dice-roller .modal-title[data-v-8e8ada04],.map-panel h1[data-v-8e8ada04],.map-panel h2[data-v-8e8ada04],.map-panel h3[data-v-8e8ada04],.map-panel .modal-title[data-v-8e8ada04],.plot-review h1[data-v-8e8ada04],.plot-review h2[data-v-8e8ada04],.plot-review h3[data-v-8e8ada04],.plot-review .modal-title[data-v-8e8ada04]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-8e8ada04],.modal-overlay .form-group[data-v-8e8ada04],.dialogue-box .button-group[data-v-8e8ada04],.dialogue-box .form-group[data-v-8e8ada04],.combat-panel .button-group[data-v-8e8ada04],.combat-panel .form-group[data-v-8e8ada04],.character-panel .button-group[data-v-8e8ada04],.character-panel .form-group[data-v-8e8ada04],.character-creator .button-group[data-v-8e8ada04],.character-creator .form-group[data-v-8e8ada04],.instance-record .button-group[data-v-8e8ada04],.instance-record .form-group[data-v-8e8ada04],.instance-generator .button-group[data-v-8e8ada04],.instance-generator .form-group[data-v-8e8ada04],.interaction-room .button-group[data-v-8e8ada04],.interaction-room .form-group[data-v-8e8ada04],.dice-roller .button-group[data-v-8e8ada04],.dice-roller .form-group[data-v-8e8ada04],.map-panel .button-group[data-v-8e8ada04],.map-panel .form-group[data-v-8e8ada04],.plot-review .button-group[data-v-8e8ada04],.plot-review .form-group[data-v-8e8ada04]{gap:calc(16px*var(--modal-scale))}.background-layer[data-v-8e8ada04]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;overflow:hidden}.background-image[data-v-8e8ada04]{width:100%;height:100%;object-fit:cover;object-position:center}
[data-v-6ec1bc54]{box-sizing:border-box;margin:0;padding:0}body[data-v-6ec1bc54]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-6ec1bc54]::-webkit-scrollbar{width:8px;height:8px}[data-v-6ec1bc54]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-6ec1bc54]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-6ec1bc54]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-6ec1bc54]{color:#d4af37}.text-muted[data-v-6ec1bc54]{color:#888}.bg-overlay[data-v-6ec1bc54]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-6ec1bc54]{border:2px solid #d4af37}.shadow-gold[data-v-6ec1bc54]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-6ec1bc54]{z-index:50 !important}.dialogue-box[data-v-6ec1bc54],.combat-panel[data-v-6ec1bc54],.character-panel[data-v-6ec1bc54],.character-creator[data-v-6ec1bc54],.instance-record[data-v-6ec1bc54],.instance-generator[data-v-6ec1bc54],.interaction-room[data-v-6ec1bc54],.dice-roller[data-v-6ec1bc54],.map-panel[data-v-6ec1bc54],.plot-review[data-v-6ec1bc54]{z-index:50 !important}[data-v-6ec1bc54]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-6ec1bc54]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-6ec1bc54]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-6ec1bc54],.dialogue-box[data-v-6ec1bc54],.combat-panel[data-v-6ec1bc54],.character-panel[data-v-6ec1bc54],.character-creator[data-v-6ec1bc54],.instance-record[data-v-6ec1bc54],.instance-generator[data-v-6ec1bc54],.interaction-room[data-v-6ec1bc54],.dice-roller[data-v-6ec1bc54],.map-panel[data-v-6ec1bc54],.plot-review[data-v-6ec1bc54]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-6ec1bc54],.dialogue-box[data-v-6ec1bc54],.combat-panel[data-v-6ec1bc54],.character-panel[data-v-6ec1bc54],.character-creator[data-v-6ec1bc54],.instance-record[data-v-6ec1bc54],.instance-generator[data-v-6ec1bc54],.interaction-room[data-v-6ec1bc54],.dice-roller[data-v-6ec1bc54],.map-panel[data-v-6ec1bc54],.plot-review[data-v-6ec1bc54]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-6ec1bc54],.dialogue-box[data-v-6ec1bc54],.combat-panel[data-v-6ec1bc54],.character-panel[data-v-6ec1bc54],.character-creator[data-v-6ec1bc54],.instance-record[data-v-6ec1bc54],.instance-generator[data-v-6ec1bc54],.interaction-room[data-v-6ec1bc54],.dice-roller[data-v-6ec1bc54],.map-panel[data-v-6ec1bc54],.plot-review[data-v-6ec1bc54]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-6ec1bc54],.modal-overlay input[data-v-6ec1bc54],.modal-overlay textarea[data-v-6ec1bc54],.modal-overlay select[data-v-6ec1bc54],.modal-overlay .btn[data-v-6ec1bc54],.modal-overlay .form-control[data-v-6ec1bc54],.modal-overlay .modal-title[data-v-6ec1bc54],.modal-overlay .close-btn[data-v-6ec1bc54],.dialogue-box button[data-v-6ec1bc54],.dialogue-box input[data-v-6ec1bc54],.dialogue-box textarea[data-v-6ec1bc54],.dialogue-box select[data-v-6ec1bc54],.dialogue-box .btn[data-v-6ec1bc54],.dialogue-box .form-control[data-v-6ec1bc54],.dialogue-box .modal-title[data-v-6ec1bc54],.dialogue-box .close-btn[data-v-6ec1bc54],.combat-panel button[data-v-6ec1bc54],.combat-panel input[data-v-6ec1bc54],.combat-panel textarea[data-v-6ec1bc54],.combat-panel select[data-v-6ec1bc54],.combat-panel .btn[data-v-6ec1bc54],.combat-panel .form-control[data-v-6ec1bc54],.combat-panel .modal-title[data-v-6ec1bc54],.combat-panel .close-btn[data-v-6ec1bc54],.character-panel button[data-v-6ec1bc54],.character-panel input[data-v-6ec1bc54],.character-panel textarea[data-v-6ec1bc54],.character-panel select[data-v-6ec1bc54],.character-panel .btn[data-v-6ec1bc54],.character-panel .form-control[data-v-6ec1bc54],.character-panel .modal-title[data-v-6ec1bc54],.character-panel .close-btn[data-v-6ec1bc54],.character-creator button[data-v-6ec1bc54],.character-creator input[data-v-6ec1bc54],.character-creator textarea[data-v-6ec1bc54],.character-creator select[data-v-6ec1bc54],.character-creator .btn[data-v-6ec1bc54],.character-creator .form-control[data-v-6ec1bc54],.character-creator .modal-title[data-v-6ec1bc54],.character-creator .close-btn[data-v-6ec1bc54],.instance-record button[data-v-6ec1bc54],.instance-record input[data-v-6ec1bc54],.instance-record textarea[data-v-6ec1bc54],.instance-record select[data-v-6ec1bc54],.instance-record .btn[data-v-6ec1bc54],.instance-record .form-control[data-v-6ec1bc54],.instance-record .modal-title[data-v-6ec1bc54],.instance-record .close-btn[data-v-6ec1bc54],.instance-generator button[data-v-6ec1bc54],.instance-generator input[data-v-6ec1bc54],.instance-generator textarea[data-v-6ec1bc54],.instance-generator select[data-v-6ec1bc54],.instance-generator .btn[data-v-6ec1bc54],.instance-generator .form-control[data-v-6ec1bc54],.instance-generator .modal-title[data-v-6ec1bc54],.instance-generator .close-btn[data-v-6ec1bc54],.interaction-room button[data-v-6ec1bc54],.interaction-room input[data-v-6ec1bc54],.interaction-room textarea[data-v-6ec1bc54],.interaction-room select[data-v-6ec1bc54],.interaction-room .btn[data-v-6ec1bc54],.interaction-room .form-control[data-v-6ec1bc54],.interaction-room .modal-title[data-v-6ec1bc54],.interaction-room .close-btn[data-v-6ec1bc54],.dice-roller button[data-v-6ec1bc54],.dice-roller input[data-v-6ec1bc54],.dice-roller textarea[data-v-6ec1bc54],.dice-roller select[data-v-6ec1bc54],.dice-roller .btn[data-v-6ec1bc54],.dice-roller .form-control[data-v-6ec1bc54],.dice-roller .modal-title[data-v-6ec1bc54],.dice-roller .close-btn[data-v-6ec1bc54],.map-panel button[data-v-6ec1bc54],.map-panel input[data-v-6ec1bc54],.map-panel textarea[data-v-6ec1bc54],.map-panel select[data-v-6ec1bc54],.map-panel .btn[data-v-6ec1bc54],.map-panel .form-control[data-v-6ec1bc54],.map-panel .modal-title[data-v-6ec1bc54],.map-panel .close-btn[data-v-6ec1bc54],.plot-review button[data-v-6ec1bc54],.plot-review input[data-v-6ec1bc54],.plot-review textarea[data-v-6ec1bc54],.plot-review select[data-v-6ec1bc54],.plot-review .btn[data-v-6ec1bc54],.plot-review .form-control[data-v-6ec1bc54],.plot-review .modal-title[data-v-6ec1bc54],.plot-review .close-btn[data-v-6ec1bc54]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-6ec1bc54],.modal-overlay h2[data-v-6ec1bc54],.modal-overlay h3[data-v-6ec1bc54],.modal-overlay .modal-title[data-v-6ec1bc54],.dialogue-box h1[data-v-6ec1bc54],.dialogue-box h2[data-v-6ec1bc54],.dialogue-box h3[data-v-6ec1bc54],.dialogue-box .modal-title[data-v-6ec1bc54],.combat-panel h1[data-v-6ec1bc54],.combat-panel h2[data-v-6ec1bc54],.combat-panel h3[data-v-6ec1bc54],.combat-panel .modal-title[data-v-6ec1bc54],.character-panel h1[data-v-6ec1bc54],.character-panel h2[data-v-6ec1bc54],.character-panel h3[data-v-6ec1bc54],.character-panel .modal-title[data-v-6ec1bc54],.character-creator h1[data-v-6ec1bc54],.character-creator h2[data-v-6ec1bc54],.character-creator h3[data-v-6ec1bc54],.character-creator .modal-title[data-v-6ec1bc54],.instance-record h1[data-v-6ec1bc54],.instance-record h2[data-v-6ec1bc54],.instance-record h3[data-v-6ec1bc54],.instance-record .modal-title[data-v-6ec1bc54],.instance-generator h1[data-v-6ec1bc54],.instance-generator h2[data-v-6ec1bc54],.instance-generator h3[data-v-6ec1bc54],.instance-generator .modal-title[data-v-6ec1bc54],.interaction-room h1[data-v-6ec1bc54],.interaction-room h2[data-v-6ec1bc54],.interaction-room h3[data-v-6ec1bc54],.interaction-room .modal-title[data-v-6ec1bc54],.dice-roller h1[data-v-6ec1bc54],.dice-roller h2[data-v-6ec1bc54],.dice-roller h3[data-v-6ec1bc54],.dice-roller .modal-title[data-v-6ec1bc54],.map-panel h1[data-v-6ec1bc54],.map-panel h2[data-v-6ec1bc54],.map-panel h3[data-v-6ec1bc54],.map-panel .modal-title[data-v-6ec1bc54],.plot-review h1[data-v-6ec1bc54],.plot-review h2[data-v-6ec1bc54],.plot-review h3[data-v-6ec1bc54],.plot-review .modal-title[data-v-6ec1bc54]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-6ec1bc54],.modal-overlay .form-group[data-v-6ec1bc54],.dialogue-box .button-group[data-v-6ec1bc54],.dialogue-box .form-group[data-v-6ec1bc54],.combat-panel .button-group[data-v-6ec1bc54],.combat-panel .form-group[data-v-6ec1bc54],.character-panel .button-group[data-v-6ec1bc54],.character-panel .form-group[data-v-6ec1bc54],.character-creator .button-group[data-v-6ec1bc54],.character-creator .form-group[data-v-6ec1bc54],.instance-record .button-group[data-v-6ec1bc54],.instance-record .form-group[data-v-6ec1bc54],.instance-generator .button-group[data-v-6ec1bc54],.instance-generator .form-group[data-v-6ec1bc54],.interaction-room .button-group[data-v-6ec1bc54],.interaction-room .form-group[data-v-6ec1bc54],.dice-roller .button-group[data-v-6ec1bc54],.dice-roller .form-group[data-v-6ec1bc54],.map-panel .button-group[data-v-6ec1bc54],.map-panel .form-group[data-v-6ec1bc54],.plot-review .button-group[data-v-6ec1bc54],.plot-review .form-group[data-v-6ec1bc54]{gap:calc(16px*var(--modal-scale))}.character-creator[data-v-6ec1bc54]{width:100%;max-width:800px;max-height:90vh;overflow-y:auto;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:32px;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.character-creator[data-v-6ec1bc54]{max-width:95vw;max-height:95vh;padding:16px;border-width:1px}}@media (max-width:480px){.character-creator[data-v-6ec1bc54]{max-width:98vw;padding:8px}}.character-creator[data-v-6ec1bc54]{width:100%;max-width:800px;max-height:85vh;padding:24px;overflow-y:auto}@media (max-width:767px){.character-creator[data-v-6ec1bc54]{padding:16px;border-width:1px}}@media (max-width:480px){.character-creator[data-v-6ec1bc54]{padding:8px}}.creator-header[data-v-6ec1bc54]{text-align:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #333}@media (max-width:767px){.creator-header[data-v-6ec1bc54]{margin-bottom:16px;padding-bottom:8px}}.creator-title[data-v-6ec1bc54]{--base-title-size:32px;font-size:32px;color:#d4af37;text-align:center;margin-bottom:32px;text-shadow:0 0 10px rgba(212,175,55,.5)}@media (max-width:767px){.creator-title[data-v-6ec1bc54]{--base-title-size:24px;font-size:24px;margin-bottom:16px}}@media (max-width:480px){.creator-title[data-v-6ec1bc54]{--base-title-size:20px;font-size:20px;margin-bottom:8px}}.creator-title[data-v-6ec1bc54]{margin-bottom:4px}.creator-subtitle[data-v-6ec1bc54]{font-size:14px;color:#ccc}@media (max-width:767px){.creator-subtitle[data-v-6ec1bc54]{font-size:12px}}.creator-content[data-v-6ec1bc54]{display:flex;flex-direction:column;gap:24px}.section[data-v-6ec1bc54]{background:rgba(0,0,0,.3);border:1px solid #333;border-radius:8px;padding:16px}.section-header[data-v-6ec1bc54]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.section-title[data-v-6ec1bc54]{font-size:18px;font-weight:700;color:#d4af37;margin-bottom:16px}@media (max-width:767px){.section-title[data-v-6ec1bc54]{font-size:16px;margin-bottom:8px}}.form-grid[data-v-6ec1bc54]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}@media (max-width:767px){.form-grid[data-v-6ec1bc54]{grid-template-columns:1fr;gap:8px}}.form-group[data-v-6ec1bc54]{display:flex;flex-direction:column;gap:4px}.form-label[data-v-6ec1bc54]{font-size:14px;font-weight:500;color:#ccc}.form-input[data-v-6ec1bc54],.form-select[data-v-6ec1bc54],.form-textarea[data-v-6ec1bc54]{padding:8px;background:rgba(0,0,0,.5);border:1px solid #333;border-radius:4px;color:#f5f5f5;font-size:14px;font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;transition:border-color .15s ease}.form-input[data-v-6ec1bc54]:focus,.form-select[data-v-6ec1bc54]:focus,.form-textarea[data-v-6ec1bc54]:focus{outline:none;border-color:#d4af37}.form-input[data-v-6ec1bc54]::placeholder,.form-select[data-v-6ec1bc54]::placeholder,.form-textarea[data-v-6ec1bc54]::placeholder{color:#888}.form-textarea[data-v-6ec1bc54]{resize:vertical;min-height:60px}.attributes-grid[data-v-6ec1bc54]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}@media (max-width:767px){.attributes-grid[data-v-6ec1bc54]{grid-template-columns:repeat(2,1fr);gap:8px}}@media (max-width:480px){.attributes-grid[data-v-6ec1bc54]{grid-template-columns:1fr}}.attribute-item[data-v-6ec1bc54]{display:flex;flex-direction:column;gap:4px}.attribute-label[data-v-6ec1bc54]{font-size:14px;font-weight:500;color:#ccc}.attribute-input[data-v-6ec1bc54]{padding:8px;background:rgba(0,0,0,.5);border:1px solid #333;border-radius:4px;color:#d4af37;font-size:16px;font-weight:700;text-align:center;transition:border-color .15s ease}.attribute-input[data-v-6ec1bc54]:focus{outline:none;border-color:#d4af37}.derived-stats[data-v-6ec1bc54]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}@media (max-width:767px){.derived-stats[data-v-6ec1bc54]{grid-template-columns:repeat(2,1fr);gap:8px}}@media (max-width:480px){.derived-stats[data-v-6ec1bc54]{grid-template-columns:1fr}}.stat-item[data-v-6ec1bc54]{display:flex;justify-content:space-between;align-items:center;padding:8px;background:rgba(0,0,0,.3);border-radius:4px}.stat-label[data-v-6ec1bc54]{font-size:14px;color:#ccc}.stat-value[data-v-6ec1bc54]{font-size:14px;font-weight:700;color:#d4af37}.skills-info[data-v-6ec1bc54]{display:flex;gap:24px;margin-bottom:16px;padding:8px;background:rgba(212,175,55,.1);border-radius:4px}.info-text[data-v-6ec1bc54]{font-size:14px;color:#ccc}.points-value[data-v-6ec1bc54]{font-weight:700;color:#d4af37}.points-value.points-negative[data-v-6ec1bc54]{color:#f44336}.skills-grid[data-v-6ec1bc54]{display:flex;flex-direction:column;gap:8px;margin-bottom:16px}.skill-item[data-v-6ec1bc54]{display:grid;grid-template-columns:1fr auto auto auto;gap:8px;align-items:center}.skill-label[data-v-6ec1bc54]{font-size:14px;color:#ccc}.skill-input[data-v-6ec1bc54]{width:80px;padding:4px 8px;background:rgba(0,0,0,.5);border:1px solid #333;border-radius:4px;color:#d4af37;font-size:14px;text-align:center}.skill-input[data-v-6ec1bc54]:focus{outline:none;border-color:#d4af37}.skill-type-select[data-v-6ec1bc54]{width:90px;padding:4px 8px;background:rgba(0,0,0,.5);border:1px solid #333;border-radius:4px;color:#f5f5f5;font-size:12px;cursor:pointer}.skill-type-select[data-v-6ec1bc54]:focus{outline:none;border-color:#d4af37}.add-skill[data-v-6ec1bc54]{display:flex;gap:8px}.creator-actions[data-v-6ec1bc54]{display:flex;justify-content:flex-end;gap:16px;margin-top:24px;padding-top:16px;border-top:1px solid #333}@media (max-width:767px){.creator-actions[data-v-6ec1bc54]{flex-direction:column;gap:8px}}.btn-primary[data-v-6ec1bc54],.btn-secondary[data-v-6ec1bc54],.btn-cancel[data-v-6ec1bc54],.btn-remove[data-v-6ec1bc54]{padding:8px 24px;border:none;border-radius:4px;font-size:14px;font-weight:500;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.btn-primary[data-v-6ec1bc54],.btn-secondary[data-v-6ec1bc54],.btn-cancel[data-v-6ec1bc54],.btn-remove[data-v-6ec1bc54]{padding:4px 16px;font-size:12px;min-height:36px}}@media (max-width:480px){.btn-primary[data-v-6ec1bc54],.btn-secondary[data-v-6ec1bc54],.btn-cancel[data-v-6ec1bc54],.btn-remove[data-v-6ec1bc54]{padding:4px 8px;min-height:32px}}.btn-primary[data-v-6ec1bc54]:disabled,.btn-secondary[data-v-6ec1bc54]:disabled,.btn-cancel[data-v-6ec1bc54]:disabled,.btn-remove[data-v-6ec1bc54]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[data-v-6ec1bc54]{background:linear-gradient(135deg,#d4af37,#f4d03f);color:#0a0a0a}.btn-primary[data-v-6ec1bc54]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 0 20px rgba(212,175,55,.3)}.btn-secondary[data-v-6ec1bc54]{background:rgba(212,175,55,.2);color:#d4af37;border:1px solid #d4af37;display:flex;align-items:center;gap:4px}.btn-secondary[data-v-6ec1bc54]:hover{background:rgba(212,175,55,.3)}.btn-cancel[data-v-6ec1bc54]{background:hsla(0,0%,100%,.1);color:#ccc;border:1px solid #333}.btn-cancel[data-v-6ec1bc54]:hover{background:hsla(0,0%,100%,.15);color:#f5f5f5}.btn-remove[data-v-6ec1bc54]{width:28px;height:28px;padding:0;background:rgba(244,67,54,.2);color:#f44336;border:1px solid #f44336;font-size:18px;line-height:1}.btn-remove[data-v-6ec1bc54]:hover{background:rgba(244,67,54,.3)}.btn-icon[data-v-6ec1bc54]{font-size:16px}
[data-v-50159846]{box-sizing:border-box;margin:0;padding:0}body[data-v-50159846]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-50159846]::-webkit-scrollbar{width:8px;height:8px}[data-v-50159846]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-50159846]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-50159846]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-50159846]{color:#d4af37}.text-muted[data-v-50159846]{color:#888}.bg-overlay[data-v-50159846]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-50159846]{border:2px solid #d4af37}.shadow-gold[data-v-50159846]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-50159846]{z-index:50 !important}.dialogue-box[data-v-50159846],.combat-panel[data-v-50159846],.character-panel[data-v-50159846],.character-creator[data-v-50159846],.instance-record[data-v-50159846],.instance-generator[data-v-50159846],.interaction-room[data-v-50159846],.dice-roller[data-v-50159846],.map-panel[data-v-50159846],.plot-review[data-v-50159846]{z-index:50 !important}[data-v-50159846]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-50159846]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-50159846]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-50159846],.dialogue-box[data-v-50159846],.combat-panel[data-v-50159846],.character-panel[data-v-50159846],.character-creator[data-v-50159846],.instance-record[data-v-50159846],.instance-generator[data-v-50159846],.interaction-room[data-v-50159846],.dice-roller[data-v-50159846],.map-panel[data-v-50159846],.plot-review[data-v-50159846]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-50159846],.dialogue-box[data-v-50159846],.combat-panel[data-v-50159846],.character-panel[data-v-50159846],.character-creator[data-v-50159846],.instance-record[data-v-50159846],.instance-generator[data-v-50159846],.interaction-room[data-v-50159846],.dice-roller[data-v-50159846],.map-panel[data-v-50159846],.plot-review[data-v-50159846]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-50159846],.dialogue-box[data-v-50159846],.combat-panel[data-v-50159846],.character-panel[data-v-50159846],.character-creator[data-v-50159846],.instance-record[data-v-50159846],.instance-generator[data-v-50159846],.interaction-room[data-v-50159846],.dice-roller[data-v-50159846],.map-panel[data-v-50159846],.plot-review[data-v-50159846]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-50159846],.modal-overlay input[data-v-50159846],.modal-overlay textarea[data-v-50159846],.modal-overlay select[data-v-50159846],.modal-overlay .btn[data-v-50159846],.modal-overlay .form-control[data-v-50159846],.modal-overlay .modal-title[data-v-50159846],.modal-overlay .close-btn[data-v-50159846],.dialogue-box button[data-v-50159846],.dialogue-box input[data-v-50159846],.dialogue-box textarea[data-v-50159846],.dialogue-box select[data-v-50159846],.dialogue-box .btn[data-v-50159846],.dialogue-box .form-control[data-v-50159846],.dialogue-box .modal-title[data-v-50159846],.dialogue-box .close-btn[data-v-50159846],.combat-panel button[data-v-50159846],.combat-panel input[data-v-50159846],.combat-panel textarea[data-v-50159846],.combat-panel select[data-v-50159846],.combat-panel .btn[data-v-50159846],.combat-panel .form-control[data-v-50159846],.combat-panel .modal-title[data-v-50159846],.combat-panel .close-btn[data-v-50159846],.character-panel button[data-v-50159846],.character-panel input[data-v-50159846],.character-panel textarea[data-v-50159846],.character-panel select[data-v-50159846],.character-panel .btn[data-v-50159846],.character-panel .form-control[data-v-50159846],.character-panel .modal-title[data-v-50159846],.character-panel .close-btn[data-v-50159846],.character-creator button[data-v-50159846],.character-creator input[data-v-50159846],.character-creator textarea[data-v-50159846],.character-creator select[data-v-50159846],.character-creator .btn[data-v-50159846],.character-creator .form-control[data-v-50159846],.character-creator .modal-title[data-v-50159846],.character-creator .close-btn[data-v-50159846],.instance-record button[data-v-50159846],.instance-record input[data-v-50159846],.instance-record textarea[data-v-50159846],.instance-record select[data-v-50159846],.instance-record .btn[data-v-50159846],.instance-record .form-control[data-v-50159846],.instance-record .modal-title[data-v-50159846],.instance-record .close-btn[data-v-50159846],.instance-generator button[data-v-50159846],.instance-generator input[data-v-50159846],.instance-generator textarea[data-v-50159846],.instance-generator select[data-v-50159846],.instance-generator .btn[data-v-50159846],.instance-generator .form-control[data-v-50159846],.instance-generator .modal-title[data-v-50159846],.instance-generator .close-btn[data-v-50159846],.interaction-room button[data-v-50159846],.interaction-room input[data-v-50159846],.interaction-room textarea[data-v-50159846],.interaction-room select[data-v-50159846],.interaction-room .btn[data-v-50159846],.interaction-room .form-control[data-v-50159846],.interaction-room .modal-title[data-v-50159846],.interaction-room .close-btn[data-v-50159846],.dice-roller button[data-v-50159846],.dice-roller input[data-v-50159846],.dice-roller textarea[data-v-50159846],.dice-roller select[data-v-50159846],.dice-roller .btn[data-v-50159846],.dice-roller .form-control[data-v-50159846],.dice-roller .modal-title[data-v-50159846],.dice-roller .close-btn[data-v-50159846],.map-panel button[data-v-50159846],.map-panel input[data-v-50159846],.map-panel textarea[data-v-50159846],.map-panel select[data-v-50159846],.map-panel .btn[data-v-50159846],.map-panel .form-control[data-v-50159846],.map-panel .modal-title[data-v-50159846],.map-panel .close-btn[data-v-50159846],.plot-review button[data-v-50159846],.plot-review input[data-v-50159846],.plot-review textarea[data-v-50159846],.plot-review select[data-v-50159846],.plot-review .btn[data-v-50159846],.plot-review .form-control[data-v-50159846],.plot-review .modal-title[data-v-50159846],.plot-review .close-btn[data-v-50159846]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-50159846],.modal-overlay h2[data-v-50159846],.modal-overlay h3[data-v-50159846],.modal-overlay .modal-title[data-v-50159846],.dialogue-box h1[data-v-50159846],.dialogue-box h2[data-v-50159846],.dialogue-box h3[data-v-50159846],.dialogue-box .modal-title[data-v-50159846],.combat-panel h1[data-v-50159846],.combat-panel h2[data-v-50159846],.combat-panel h3[data-v-50159846],.combat-panel .modal-title[data-v-50159846],.character-panel h1[data-v-50159846],.character-panel h2[data-v-50159846],.character-panel h3[data-v-50159846],.character-panel .modal-title[data-v-50159846],.character-creator h1[data-v-50159846],.character-creator h2[data-v-50159846],.character-creator h3[data-v-50159846],.character-creator .modal-title[data-v-50159846],.instance-record h1[data-v-50159846],.instance-record h2[data-v-50159846],.instance-record h3[data-v-50159846],.instance-record .modal-title[data-v-50159846],.instance-generator h1[data-v-50159846],.instance-generator h2[data-v-50159846],.instance-generator h3[data-v-50159846],.instance-generator .modal-title[data-v-50159846],.interaction-room h1[data-v-50159846],.interaction-room h2[data-v-50159846],.interaction-room h3[data-v-50159846],.interaction-room .modal-title[data-v-50159846],.dice-roller h1[data-v-50159846],.dice-roller h2[data-v-50159846],.dice-roller h3[data-v-50159846],.dice-roller .modal-title[data-v-50159846],.map-panel h1[data-v-50159846],.map-panel h2[data-v-50159846],.map-panel h3[data-v-50159846],.map-panel .modal-title[data-v-50159846],.plot-review h1[data-v-50159846],.plot-review h2[data-v-50159846],.plot-review h3[data-v-50159846],.plot-review .modal-title[data-v-50159846]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-50159846],.modal-overlay .form-group[data-v-50159846],.dialogue-box .button-group[data-v-50159846],.dialogue-box .form-group[data-v-50159846],.combat-panel .button-group[data-v-50159846],.combat-panel .form-group[data-v-50159846],.character-panel .button-group[data-v-50159846],.character-panel .form-group[data-v-50159846],.character-creator .button-group[data-v-50159846],.character-creator .form-group[data-v-50159846],.instance-record .button-group[data-v-50159846],.instance-record .form-group[data-v-50159846],.instance-generator .button-group[data-v-50159846],.instance-generator .form-group[data-v-50159846],.interaction-room .button-group[data-v-50159846],.interaction-room .form-group[data-v-50159846],.dice-roller .button-group[data-v-50159846],.dice-roller .form-group[data-v-50159846],.map-panel .button-group[data-v-50159846],.map-panel .form-group[data-v-50159846],.plot-review .button-group[data-v-50159846],.plot-review .form-group[data-v-50159846]{gap:calc(16px*var(--modal-scale))}.character-panel[data-v-50159846]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:1200px;aspect-ratio:16/9;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;box-shadow:0 8px 16px rgba(0,0,0,.5);z-index:40;display:flex;flex-direction:column}.panel-header[data-v-50159846]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #333}.panel-title[data-v-50159846]{font-size:20px;font-weight:700;color:#d4af37;text-shadow:0 0 10px rgba(212,175,55,.5)}.btn-close[data-v-50159846]{width:32px;height:32px;padding:0;background:hsla(0,0%,100%,.1);border:1px solid #333;border-radius:4px;color:#ccc;font-size:24px;line-height:1;cursor:pointer;transition:all .15s ease}.btn-close[data-v-50159846]:hover{background:rgba(244,67,54,.2);border-color:#f44336;color:#f44336}.panel-content[data-v-50159846]{flex:1;padding:24px;overflow:hidden}.character-detail[data-v-50159846]{height:100%;overflow-y:auto;padding-right:8px}.detail-content[data-v-50159846]{display:flex;flex-direction:column;gap:24px}.detail-section[data-v-50159846]{background:rgba(0,0,0,.3);border:1px solid #333;border-radius:8px;padding:16px}.detail-header[data-v-50159846]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid #333}.detail-title[data-v-50159846]{font-size:20px;font-weight:700;color:#d4af37}.detail-actions[data-v-50159846]{display:flex;gap:8px}.btn-edit[data-v-50159846],.btn-danger[data-v-50159846]{padding:4px 16px;border:1px solid;border-radius:4px;font-size:14px;font-weight:500;cursor:pointer;transition:all .15s ease}.btn-edit[data-v-50159846]{background:rgba(33,150,243,.2);border-color:#2196f3;color:#2196f3}.btn-edit[data-v-50159846]:hover{background:rgba(33,150,243,.3)}.btn-danger[data-v-50159846]{background:rgba(244,67,54,.2);border-color:#f44336;color:#f44336}.btn-danger[data-v-50159846]:hover{background:rgba(244,67,54,.3)}.basic-info[data-v-50159846]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;margin-bottom:16px}.info-item[data-v-50159846]{display:flex;gap:4px;align-items:center}.info-label[data-v-50159846]{font-size:14px;color:#ccc;font-weight:500}.info-value[data-v-50159846]{font-size:14px;color:#f5f5f5}.affection-value[data-v-50159846]{color:#d4af37;font-weight:700}.background-text[data-v-50159846]{margin-top:8px;padding-top:8px;border-top:1px solid #333}.background-content[data-v-50159846]{margin-top:4px;font-size:14px;color:#ccc;line-height:1.6}.subsection-title[data-v-50159846]{font-size:16px;font-weight:700;color:#d4af37;margin-bottom:16px}.attributes-grid[data-v-50159846]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}.attribute-item[data-v-50159846]{display:flex;justify-content:space-between;align-items:center;padding:8px;background:rgba(0,0,0,.3);border-radius:4px}.attribute-label[data-v-50159846]{font-size:14px;color:#ccc}.attribute-value[data-v-50159846]{font-size:14px;font-weight:700;color:#d4af37}.derived-grid[data-v-50159846]{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}.derived-item[data-v-50159846]{display:flex;justify-content:space-between;align-items:center;padding:8px;background:rgba(0,0,0,.3);border-radius:4px}.derived-label[data-v-50159846]{font-size:14px;color:#ccc}.derived-value[data-v-50159846]{font-size:14px;font-weight:700;color:#d4af37}.body-parts[data-v-50159846]{display:flex;flex-direction:column;gap:8px}.body-part-group[data-v-50159846]{background:rgba(0,0,0,.3);border:1px solid #333;border-radius:4px;overflow:hidden}.body-part-header[data-v-50159846]{display:flex;align-items:center;gap:8px;padding:8px;cursor:pointer;transition:background .15s ease}.body-part-header[data-v-50159846]:hover{background:hsla(0,0%,100%,.05)}.expand-icon[data-v-50159846]{font-size:12px;color:#ccc;width:12px}.part-name[data-v-50159846]{flex:1;font-size:14px;font-weight:500;color:#f5f5f5}.part-damage[data-v-50159846]{font-size:12px;font-weight:700;padding:2px 4px;border-radius:4px}.damage-none[data-v-50159846]{color:#4caf50}.damage-light[data-v-50159846]{color:#2196f3}.damage-moderate[data-v-50159846]{color:#ff9800}.damage-heavy[data-v-50159846]{color:#ff5722}.damage-critical[data-v-50159846]{color:#f44336}.body-part-children[data-v-50159846]{padding:4px 16px 8px;background:rgba(0,0,0,.2);border-top:1px solid #333}.body-part-child[data-v-50159846]{display:flex;align-items:center;gap:8px;padding:4px;margin-bottom:4px}.body-part-child[data-v-50159846]:last-child{margin-bottom:0}.child-name[data-v-50159846]{flex:1;font-size:12px;color:#ccc}.child-damage[data-v-50159846]{font-size:12px;font-weight:700}.debuffs[data-v-50159846],.part-debuffs[data-v-50159846]{display:flex;flex-wrap:wrap;gap:4px;padding:4px 8px}.debuff-tag[data-v-50159846]{padding:2px 4px;background:rgba(244,67,54,.2);border:1px solid #f44336;border-radius:4px;font-size:12px;color:#f44336}.empty-detail[data-v-50159846]{display:flex;align-items:center;justify-content:center;height:100%;color:#888;font-size:16px}
[data-v-650574d0]{box-sizing:border-box;margin:0;padding:0}body[data-v-650574d0]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-650574d0]::-webkit-scrollbar{width:8px;height:8px}[data-v-650574d0]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-650574d0]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-650574d0]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-650574d0]{color:#d4af37}.text-muted[data-v-650574d0]{color:#888}.bg-overlay[data-v-650574d0]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-650574d0]{border:2px solid #d4af37}.shadow-gold[data-v-650574d0]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-650574d0]{z-index:50 !important}.dialogue-box[data-v-650574d0],.combat-panel[data-v-650574d0],.character-panel[data-v-650574d0],.character-creator[data-v-650574d0],.instance-record[data-v-650574d0],.instance-generator[data-v-650574d0],.interaction-room[data-v-650574d0],.dice-roller[data-v-650574d0],.map-panel[data-v-650574d0],.plot-review[data-v-650574d0]{z-index:50 !important}[data-v-650574d0]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-650574d0]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-650574d0]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-650574d0],.dialogue-box[data-v-650574d0],.combat-panel[data-v-650574d0],.character-panel[data-v-650574d0],.character-creator[data-v-650574d0],.instance-record[data-v-650574d0],.instance-generator[data-v-650574d0],.interaction-room[data-v-650574d0],.dice-roller[data-v-650574d0],.map-panel[data-v-650574d0],.plot-review[data-v-650574d0]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-650574d0],.dialogue-box[data-v-650574d0],.combat-panel[data-v-650574d0],.character-panel[data-v-650574d0],.character-creator[data-v-650574d0],.instance-record[data-v-650574d0],.instance-generator[data-v-650574d0],.interaction-room[data-v-650574d0],.dice-roller[data-v-650574d0],.map-panel[data-v-650574d0],.plot-review[data-v-650574d0]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-650574d0],.dialogue-box[data-v-650574d0],.combat-panel[data-v-650574d0],.character-panel[data-v-650574d0],.character-creator[data-v-650574d0],.instance-record[data-v-650574d0],.instance-generator[data-v-650574d0],.interaction-room[data-v-650574d0],.dice-roller[data-v-650574d0],.map-panel[data-v-650574d0],.plot-review[data-v-650574d0]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-650574d0],.modal-overlay input[data-v-650574d0],.modal-overlay textarea[data-v-650574d0],.modal-overlay select[data-v-650574d0],.modal-overlay .btn[data-v-650574d0],.modal-overlay .form-control[data-v-650574d0],.modal-overlay .modal-title[data-v-650574d0],.modal-overlay .close-btn[data-v-650574d0],.dialogue-box button[data-v-650574d0],.dialogue-box input[data-v-650574d0],.dialogue-box textarea[data-v-650574d0],.dialogue-box select[data-v-650574d0],.dialogue-box .btn[data-v-650574d0],.dialogue-box .form-control[data-v-650574d0],.dialogue-box .modal-title[data-v-650574d0],.dialogue-box .close-btn[data-v-650574d0],.combat-panel button[data-v-650574d0],.combat-panel input[data-v-650574d0],.combat-panel textarea[data-v-650574d0],.combat-panel select[data-v-650574d0],.combat-panel .btn[data-v-650574d0],.combat-panel .form-control[data-v-650574d0],.combat-panel .modal-title[data-v-650574d0],.combat-panel .close-btn[data-v-650574d0],.character-panel button[data-v-650574d0],.character-panel input[data-v-650574d0],.character-panel textarea[data-v-650574d0],.character-panel select[data-v-650574d0],.character-panel .btn[data-v-650574d0],.character-panel .form-control[data-v-650574d0],.character-panel .modal-title[data-v-650574d0],.character-panel .close-btn[data-v-650574d0],.character-creator button[data-v-650574d0],.character-creator input[data-v-650574d0],.character-creator textarea[data-v-650574d0],.character-creator select[data-v-650574d0],.character-creator .btn[data-v-650574d0],.character-creator .form-control[data-v-650574d0],.character-creator .modal-title[data-v-650574d0],.character-creator .close-btn[data-v-650574d0],.instance-record button[data-v-650574d0],.instance-record input[data-v-650574d0],.instance-record textarea[data-v-650574d0],.instance-record select[data-v-650574d0],.instance-record .btn[data-v-650574d0],.instance-record .form-control[data-v-650574d0],.instance-record .modal-title[data-v-650574d0],.instance-record .close-btn[data-v-650574d0],.instance-generator button[data-v-650574d0],.instance-generator input[data-v-650574d0],.instance-generator textarea[data-v-650574d0],.instance-generator select[data-v-650574d0],.instance-generator .btn[data-v-650574d0],.instance-generator .form-control[data-v-650574d0],.instance-generator .modal-title[data-v-650574d0],.instance-generator .close-btn[data-v-650574d0],.interaction-room button[data-v-650574d0],.interaction-room input[data-v-650574d0],.interaction-room textarea[data-v-650574d0],.interaction-room select[data-v-650574d0],.interaction-room .btn[data-v-650574d0],.interaction-room .form-control[data-v-650574d0],.interaction-room .modal-title[data-v-650574d0],.interaction-room .close-btn[data-v-650574d0],.dice-roller button[data-v-650574d0],.dice-roller input[data-v-650574d0],.dice-roller textarea[data-v-650574d0],.dice-roller select[data-v-650574d0],.dice-roller .btn[data-v-650574d0],.dice-roller .form-control[data-v-650574d0],.dice-roller .modal-title[data-v-650574d0],.dice-roller .close-btn[data-v-650574d0],.map-panel button[data-v-650574d0],.map-panel input[data-v-650574d0],.map-panel textarea[data-v-650574d0],.map-panel select[data-v-650574d0],.map-panel .btn[data-v-650574d0],.map-panel .form-control[data-v-650574d0],.map-panel .modal-title[data-v-650574d0],.map-panel .close-btn[data-v-650574d0],.plot-review button[data-v-650574d0],.plot-review input[data-v-650574d0],.plot-review textarea[data-v-650574d0],.plot-review select[data-v-650574d0],.plot-review .btn[data-v-650574d0],.plot-review .form-control[data-v-650574d0],.plot-review .modal-title[data-v-650574d0],.plot-review .close-btn[data-v-650574d0]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-650574d0],.modal-overlay h2[data-v-650574d0],.modal-overlay h3[data-v-650574d0],.modal-overlay .modal-title[data-v-650574d0],.dialogue-box h1[data-v-650574d0],.dialogue-box h2[data-v-650574d0],.dialogue-box h3[data-v-650574d0],.dialogue-box .modal-title[data-v-650574d0],.combat-panel h1[data-v-650574d0],.combat-panel h2[data-v-650574d0],.combat-panel h3[data-v-650574d0],.combat-panel .modal-title[data-v-650574d0],.character-panel h1[data-v-650574d0],.character-panel h2[data-v-650574d0],.character-panel h3[data-v-650574d0],.character-panel .modal-title[data-v-650574d0],.character-creator h1[data-v-650574d0],.character-creator h2[data-v-650574d0],.character-creator h3[data-v-650574d0],.character-creator .modal-title[data-v-650574d0],.instance-record h1[data-v-650574d0],.instance-record h2[data-v-650574d0],.instance-record h3[data-v-650574d0],.instance-record .modal-title[data-v-650574d0],.instance-generator h1[data-v-650574d0],.instance-generator h2[data-v-650574d0],.instance-generator h3[data-v-650574d0],.instance-generator .modal-title[data-v-650574d0],.interaction-room h1[data-v-650574d0],.interaction-room h2[data-v-650574d0],.interaction-room h3[data-v-650574d0],.interaction-room .modal-title[data-v-650574d0],.dice-roller h1[data-v-650574d0],.dice-roller h2[data-v-650574d0],.dice-roller h3[data-v-650574d0],.dice-roller .modal-title[data-v-650574d0],.map-panel h1[data-v-650574d0],.map-panel h2[data-v-650574d0],.map-panel h3[data-v-650574d0],.map-panel .modal-title[data-v-650574d0],.plot-review h1[data-v-650574d0],.plot-review h2[data-v-650574d0],.plot-review h3[data-v-650574d0],.plot-review .modal-title[data-v-650574d0]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-650574d0],.modal-overlay .form-group[data-v-650574d0],.dialogue-box .button-group[data-v-650574d0],.dialogue-box .form-group[data-v-650574d0],.combat-panel .button-group[data-v-650574d0],.combat-panel .form-group[data-v-650574d0],.character-panel .button-group[data-v-650574d0],.character-panel .form-group[data-v-650574d0],.character-creator .button-group[data-v-650574d0],.character-creator .form-group[data-v-650574d0],.instance-record .button-group[data-v-650574d0],.instance-record .form-group[data-v-650574d0],.instance-generator .button-group[data-v-650574d0],.instance-generator .form-group[data-v-650574d0],.interaction-room .button-group[data-v-650574d0],.interaction-room .form-group[data-v-650574d0],.dice-roller .button-group[data-v-650574d0],.dice-roller .form-group[data-v-650574d0],.map-panel .button-group[data-v-650574d0],.map-panel .form-group[data-v-650574d0],.plot-review .button-group[data-v-650574d0],.plot-review .form-group[data-v-650574d0]{gap:calc(16px*var(--modal-scale))}.sprite-layer[data-v-650574d0]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:10;pointer-events:none}.character-sprite[data-v-650574d0]{position:absolute;bottom:0;height:80%;transition:transform .3s ease}.character-sprite.position-left[data-v-650574d0]{left:10%}.character-sprite.position-center[data-v-650574d0]{left:50%;transform:translateX(-50%)}.character-sprite.position-right[data-v-650574d0]{right:10%}.character-sprite.position-custom[data-v-650574d0]{position:absolute}.sprite-image[data-v-650574d0]{height:100%;width:auto;object-fit:contain;object-position:bottom}
[data-v-08965543]{box-sizing:border-box;margin:0;padding:0}body[data-v-08965543]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-08965543]::-webkit-scrollbar{width:8px;height:8px}[data-v-08965543]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-08965543]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-08965543]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-08965543]{color:#d4af37}.text-muted[data-v-08965543]{color:#888}.bg-overlay[data-v-08965543]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-08965543]{border:2px solid #d4af37}.shadow-gold[data-v-08965543]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-08965543]{z-index:50 !important}.dialogue-box[data-v-08965543],.combat-panel[data-v-08965543],.character-panel[data-v-08965543],.character-creator[data-v-08965543],.instance-record[data-v-08965543],.instance-generator[data-v-08965543],.interaction-room[data-v-08965543],.dice-roller[data-v-08965543],.map-panel[data-v-08965543],.plot-review[data-v-08965543]{z-index:50 !important}[data-v-08965543]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-08965543]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-08965543]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-08965543],.dialogue-box[data-v-08965543],.combat-panel[data-v-08965543],.character-panel[data-v-08965543],.character-creator[data-v-08965543],.instance-record[data-v-08965543],.instance-generator[data-v-08965543],.interaction-room[data-v-08965543],.dice-roller[data-v-08965543],.map-panel[data-v-08965543],.plot-review[data-v-08965543]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-08965543],.dialogue-box[data-v-08965543],.combat-panel[data-v-08965543],.character-panel[data-v-08965543],.character-creator[data-v-08965543],.instance-record[data-v-08965543],.instance-generator[data-v-08965543],.interaction-room[data-v-08965543],.dice-roller[data-v-08965543],.map-panel[data-v-08965543],.plot-review[data-v-08965543]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-08965543],.dialogue-box[data-v-08965543],.combat-panel[data-v-08965543],.character-panel[data-v-08965543],.character-creator[data-v-08965543],.instance-record[data-v-08965543],.instance-generator[data-v-08965543],.interaction-room[data-v-08965543],.dice-roller[data-v-08965543],.map-panel[data-v-08965543],.plot-review[data-v-08965543]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-08965543],.modal-overlay input[data-v-08965543],.modal-overlay textarea[data-v-08965543],.modal-overlay select[data-v-08965543],.modal-overlay .btn[data-v-08965543],.modal-overlay .form-control[data-v-08965543],.modal-overlay .modal-title[data-v-08965543],.modal-overlay .close-btn[data-v-08965543],.dialogue-box button[data-v-08965543],.dialogue-box input[data-v-08965543],.dialogue-box textarea[data-v-08965543],.dialogue-box select[data-v-08965543],.dialogue-box .btn[data-v-08965543],.dialogue-box .form-control[data-v-08965543],.dialogue-box .modal-title[data-v-08965543],.dialogue-box .close-btn[data-v-08965543],.combat-panel button[data-v-08965543],.combat-panel input[data-v-08965543],.combat-panel textarea[data-v-08965543],.combat-panel select[data-v-08965543],.combat-panel .btn[data-v-08965543],.combat-panel .form-control[data-v-08965543],.combat-panel .modal-title[data-v-08965543],.combat-panel .close-btn[data-v-08965543],.character-panel button[data-v-08965543],.character-panel input[data-v-08965543],.character-panel textarea[data-v-08965543],.character-panel select[data-v-08965543],.character-panel .btn[data-v-08965543],.character-panel .form-control[data-v-08965543],.character-panel .modal-title[data-v-08965543],.character-panel .close-btn[data-v-08965543],.character-creator button[data-v-08965543],.character-creator input[data-v-08965543],.character-creator textarea[data-v-08965543],.character-creator select[data-v-08965543],.character-creator .btn[data-v-08965543],.character-creator .form-control[data-v-08965543],.character-creator .modal-title[data-v-08965543],.character-creator .close-btn[data-v-08965543],.instance-record button[data-v-08965543],.instance-record input[data-v-08965543],.instance-record textarea[data-v-08965543],.instance-record select[data-v-08965543],.instance-record .btn[data-v-08965543],.instance-record .form-control[data-v-08965543],.instance-record .modal-title[data-v-08965543],.instance-record .close-btn[data-v-08965543],.instance-generator button[data-v-08965543],.instance-generator input[data-v-08965543],.instance-generator textarea[data-v-08965543],.instance-generator select[data-v-08965543],.instance-generator .btn[data-v-08965543],.instance-generator .form-control[data-v-08965543],.instance-generator .modal-title[data-v-08965543],.instance-generator .close-btn[data-v-08965543],.interaction-room button[data-v-08965543],.interaction-room input[data-v-08965543],.interaction-room textarea[data-v-08965543],.interaction-room select[data-v-08965543],.interaction-room .btn[data-v-08965543],.interaction-room .form-control[data-v-08965543],.interaction-room .modal-title[data-v-08965543],.interaction-room .close-btn[data-v-08965543],.dice-roller button[data-v-08965543],.dice-roller input[data-v-08965543],.dice-roller textarea[data-v-08965543],.dice-roller select[data-v-08965543],.dice-roller .btn[data-v-08965543],.dice-roller .form-control[data-v-08965543],.dice-roller .modal-title[data-v-08965543],.dice-roller .close-btn[data-v-08965543],.map-panel button[data-v-08965543],.map-panel input[data-v-08965543],.map-panel textarea[data-v-08965543],.map-panel select[data-v-08965543],.map-panel .btn[data-v-08965543],.map-panel .form-control[data-v-08965543],.map-panel .modal-title[data-v-08965543],.map-panel .close-btn[data-v-08965543],.plot-review button[data-v-08965543],.plot-review input[data-v-08965543],.plot-review textarea[data-v-08965543],.plot-review select[data-v-08965543],.plot-review .btn[data-v-08965543],.plot-review .form-control[data-v-08965543],.plot-review .modal-title[data-v-08965543],.plot-review .close-btn[data-v-08965543]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-08965543],.modal-overlay h2[data-v-08965543],.modal-overlay h3[data-v-08965543],.modal-overlay .modal-title[data-v-08965543],.dialogue-box h1[data-v-08965543],.dialogue-box h2[data-v-08965543],.dialogue-box h3[data-v-08965543],.dialogue-box .modal-title[data-v-08965543],.combat-panel h1[data-v-08965543],.combat-panel h2[data-v-08965543],.combat-panel h3[data-v-08965543],.combat-panel .modal-title[data-v-08965543],.character-panel h1[data-v-08965543],.character-panel h2[data-v-08965543],.character-panel h3[data-v-08965543],.character-panel .modal-title[data-v-08965543],.character-creator h1[data-v-08965543],.character-creator h2[data-v-08965543],.character-creator h3[data-v-08965543],.character-creator .modal-title[data-v-08965543],.instance-record h1[data-v-08965543],.instance-record h2[data-v-08965543],.instance-record h3[data-v-08965543],.instance-record .modal-title[data-v-08965543],.instance-generator h1[data-v-08965543],.instance-generator h2[data-v-08965543],.instance-generator h3[data-v-08965543],.instance-generator .modal-title[data-v-08965543],.interaction-room h1[data-v-08965543],.interaction-room h2[data-v-08965543],.interaction-room h3[data-v-08965543],.interaction-room .modal-title[data-v-08965543],.dice-roller h1[data-v-08965543],.dice-roller h2[data-v-08965543],.dice-roller h3[data-v-08965543],.dice-roller .modal-title[data-v-08965543],.map-panel h1[data-v-08965543],.map-panel h2[data-v-08965543],.map-panel h3[data-v-08965543],.map-panel .modal-title[data-v-08965543],.plot-review h1[data-v-08965543],.plot-review h2[data-v-08965543],.plot-review h3[data-v-08965543],.plot-review .modal-title[data-v-08965543]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-08965543],.modal-overlay .form-group[data-v-08965543],.dialogue-box .button-group[data-v-08965543],.dialogue-box .form-group[data-v-08965543],.combat-panel .button-group[data-v-08965543],.combat-panel .form-group[data-v-08965543],.character-panel .button-group[data-v-08965543],.character-panel .form-group[data-v-08965543],.character-creator .button-group[data-v-08965543],.character-creator .form-group[data-v-08965543],.instance-record .button-group[data-v-08965543],.instance-record .form-group[data-v-08965543],.instance-generator .button-group[data-v-08965543],.instance-generator .form-group[data-v-08965543],.interaction-room .button-group[data-v-08965543],.interaction-room .form-group[data-v-08965543],.dice-roller .button-group[data-v-08965543],.dice-roller .form-group[data-v-08965543],.map-panel .button-group[data-v-08965543],.map-panel .form-group[data-v-08965543],.plot-review .button-group[data-v-08965543],.plot-review .form-group[data-v-08965543]{gap:calc(16px*var(--modal-scale))}.combat-panel[data-v-08965543]{width:100%;max-width:800px;max-height:90vh;overflow-y:auto;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:32px;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.combat-panel[data-v-08965543]{max-width:95vw;max-height:95vh;padding:16px;border-width:1px}}@media (max-width:480px){.combat-panel[data-v-08965543]{max-width:98vw;padding:8px}}.combat-panel[data-v-08965543]{position:relative;padding-top:60px;background:rgba(0,0,0,.9);width:100%}@media (max-width:767px){.combat-panel[data-v-08965543]{padding-top:50px}}@media (max-width:480px){.combat-panel[data-v-08965543]{padding-top:45px}}.combat-status-bar[data-v-08965543]{position:absolute;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:12px 20px;background:rgba(0,0,0,.8);border-bottom:2px solid #d4af37;border-radius:8px 8px 0 0}@media (max-width:767px){.combat-status-bar[data-v-08965543]{padding:10px 15px;border-bottom-width:1px}}@media (max-width:480px){.combat-status-bar[data-v-08965543]{padding:8px 10px}}.combat-status span[data-v-08965543]{padding:6px 20px;border-radius:20px;font-size:16px;font-weight:bold;text-transform:uppercase;letter-spacing:1px}@media (max-width:767px){.combat-status span[data-v-08965543]{padding:4px 15px;font-size:14px;letter-spacing:.5px}}@media (max-width:480px){.combat-status span[data-v-08965543]{padding:3px 10px;font-size:12px}}.combat-status .status-active[data-v-08965543]{background:linear-gradient(135deg,#4a90e2 0%,#357abd 100%);color:#fff;box-shadow:0 0 15px rgba(74,144,226,.5)}.combat-status .status-victory[data-v-08965543]{background:linear-gradient(135deg,#4caf50 0%,#388e3c 100%);color:#fff;box-shadow:0 0 15px rgba(76,175,80,.5)}.combat-status .status-defeat[data-v-08965543]{background:linear-gradient(135deg,#e24a4a 0%,#b83838 100%);color:#fff;box-shadow:0 0 15px rgba(226,74,74,.5)}.combat-status .status-escaped[data-v-08965543]{background:linear-gradient(135deg,#ff9800 0%,#f57c00 100%);color:#fff;box-shadow:0 0 15px rgba(255,152,0,.5)}.floating-exit-btn-top[data-v-08965543]{position:absolute;top:16px;right:16px;width:32px;height:32px;padding:0;background:rgba(0,0,0,.7);border:1px solid #d4af37;border-radius:4px;color:#d4af37;font-size:18px;cursor:pointer;transition:all .15s ease;z-index:10}@media (max-width:767px){.floating-exit-btn-top[data-v-08965543]{width:28px;height:28px;font-size:16px;top:8px;right:8px}}.floating-exit-btn-top[data-v-08965543]:hover{background:rgba(244,67,54,.3);border-color:#f44336;color:#f44336;transform:scale(1.1)}.floating-exit-btn-top[data-v-08965543]{background:rgba(244,67,54,.9);border-color:#f44336;color:#fff}.floating-exit-btn-top[data-v-08965543]:hover{background:#f44336;box-shadow:0 0 20px rgba(244,67,54,.6)}.combat-header[data-v-08965543]{display:flex;justify-content:center;margin-bottom:20px}@media (max-width:767px){.combat-header[data-v-08965543]{margin-bottom:15px}}.combat-header h2[data-v-08965543]{color:#d4af37;font-size:24px;margin:0}@media (max-width:767px){.combat-header h2[data-v-08965543]{font-size:18px}}@media (max-width:480px){.combat-header h2[data-v-08965543]{font-size:16px}}.enemies-area[data-v-08965543],.players-area[data-v-08965543]{margin-bottom:20px}@media (max-width:767px){.enemies-area[data-v-08965543],.players-area[data-v-08965543]{margin-bottom:15px}}.enemies-area h3[data-v-08965543],.players-area h3[data-v-08965543]{color:#d4af37;font-size:18px;margin-bottom:10px}@media (max-width:767px){.enemies-area h3[data-v-08965543],.players-area h3[data-v-08965543]{font-size:16px;margin-bottom:8px}}@media (max-width:480px){.enemies-area h3[data-v-08965543],.players-area h3[data-v-08965543]{font-size:14px}}.participants-list[data-v-08965543]{display:flex;flex-direction:column;gap:10px}@media (max-width:767px){.participants-list[data-v-08965543]{gap:8px}}@media (max-width:480px){.participants-list[data-v-08965543]{gap:6px}}.participant[data-v-08965543]{padding:15px;background:rgba(0,0,0,.6);border:2px solid #666;border-radius:4px}@media (max-width:767px){.participant[data-v-08965543]{padding:10px;border-width:1px}}@media (max-width:480px){.participant[data-v-08965543]{padding:8px}}.participant.player[data-v-08965543]{border-color:#4a90e2}.participant.enemy[data-v-08965543]{border-color:#e24a4a}.participant.dead[data-v-08965543]{opacity:.5}.participant-name[data-v-08965543]{font-size:16px;font-weight:bold;color:#d4af37;margin-bottom:8px}@media (max-width:767px){.participant-name[data-v-08965543]{font-size:14px;margin-bottom:6px}}@media (max-width:480px){.participant-name[data-v-08965543]{font-size:12px}}.participant-stats[data-v-08965543]{display:flex;flex-direction:column;gap:8px}@media (max-width:767px){.participant-stats[data-v-08965543]{gap:6px}}.stat-bar[data-v-08965543]{display:flex;align-items:center;gap:10px}@media (max-width:767px){.stat-bar[data-v-08965543]{gap:8px}}.stat-bar label[data-v-08965543]{min-width:30px;font-size:14px;color:#d4af37}@media (max-width:767px){.stat-bar label[data-v-08965543]{min-width:25px;font-size:12px}}.stat-bar .bar-container[data-v-08965543]{flex:1;height:20px;background:rgba(0,0,0,.8);border:1px solid #666;border-radius:4px;position:relative}@media (max-width:767px){.stat-bar .bar-container[data-v-08965543]{height:16px}}.stat-bar .bar-fill[data-v-08965543]{height:100%;transition:width .5s ease}.stat-bar .bar-fill.hp[data-v-08965543]{background:linear-gradient(90deg,#ff0000 0%,#ff6666 100%)}.stat-bar .bar-text[data-v-08965543]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);color:#fff;font-size:12px;z-index:1}@media (max-width:767px){.stat-bar .bar-text[data-v-08965543]{font-size:10px}}.combat-actions[data-v-08965543],.combat-end-actions[data-v-08965543]{display:flex;gap:16px;flex-wrap:wrap}@media (max-width:767px){.combat-actions[data-v-08965543],.combat-end-actions[data-v-08965543]{gap:8px}}@media (max-width:480px){.combat-actions[data-v-08965543],.combat-end-actions[data-v-08965543]{flex-direction:column}}.combat-actions[data-v-08965543],.combat-end-actions[data-v-08965543]{margin-top:20px}.combat-actions button[data-v-08965543],.combat-end-actions button[data-v-08965543]{flex:1;padding:12px 24px;border:none;border-radius:4px;font-size:16px;font-weight:bold;cursor:pointer;transition:all .3s ease}@media (max-width:767px){.combat-actions button[data-v-08965543],.combat-end-actions button[data-v-08965543]{padding:8px 16px;font-size:14px}}.combat-actions button[data-v-08965543]:hover:not(:disabled),.combat-end-actions button[data-v-08965543]:hover:not(:disabled){transform:translateY(-2px)}.combat-actions button[data-v-08965543]:disabled,.combat-end-actions button[data-v-08965543]:disabled{opacity:.5;cursor:not-allowed}.btn-attack[data-v-08965543]{background:linear-gradient(135deg,#e24a4a 0%,#b83838 100%);color:#fff}.btn-escape[data-v-08965543]{background:linear-gradient(135deg,#888888 0%,#666666 100%);color:#fff}.btn-close[data-v-08965543]{background:linear-gradient(135deg,#4a90e2 0%,#357abd 100%);color:#fff}
[data-v-528d5549]{box-sizing:border-box;margin:0;padding:0}body[data-v-528d5549]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-528d5549]::-webkit-scrollbar{width:8px;height:8px}[data-v-528d5549]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-528d5549]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-528d5549]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-528d5549]{color:#d4af37}.text-muted[data-v-528d5549]{color:#888}.bg-overlay[data-v-528d5549]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-528d5549]{border:2px solid #d4af37}.shadow-gold[data-v-528d5549]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-528d5549]{z-index:50 !important}.dialogue-box[data-v-528d5549],.combat-panel[data-v-528d5549],.character-panel[data-v-528d5549],.character-creator[data-v-528d5549],.instance-record[data-v-528d5549],.instance-generator[data-v-528d5549],.interaction-room[data-v-528d5549],.dice-roller[data-v-528d5549],.map-panel[data-v-528d5549],.plot-review[data-v-528d5549]{z-index:50 !important}[data-v-528d5549]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-528d5549]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-528d5549]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-528d5549],.dialogue-box[data-v-528d5549],.combat-panel[data-v-528d5549],.character-panel[data-v-528d5549],.character-creator[data-v-528d5549],.instance-record[data-v-528d5549],.instance-generator[data-v-528d5549],.interaction-room[data-v-528d5549],.dice-roller[data-v-528d5549],.map-panel[data-v-528d5549],.plot-review[data-v-528d5549]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-528d5549],.dialogue-box[data-v-528d5549],.combat-panel[data-v-528d5549],.character-panel[data-v-528d5549],.character-creator[data-v-528d5549],.instance-record[data-v-528d5549],.instance-generator[data-v-528d5549],.interaction-room[data-v-528d5549],.dice-roller[data-v-528d5549],.map-panel[data-v-528d5549],.plot-review[data-v-528d5549]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-528d5549],.dialogue-box[data-v-528d5549],.combat-panel[data-v-528d5549],.character-panel[data-v-528d5549],.character-creator[data-v-528d5549],.instance-record[data-v-528d5549],.instance-generator[data-v-528d5549],.interaction-room[data-v-528d5549],.dice-roller[data-v-528d5549],.map-panel[data-v-528d5549],.plot-review[data-v-528d5549]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-528d5549],.modal-overlay input[data-v-528d5549],.modal-overlay textarea[data-v-528d5549],.modal-overlay select[data-v-528d5549],.modal-overlay .btn[data-v-528d5549],.modal-overlay .form-control[data-v-528d5549],.modal-overlay .modal-title[data-v-528d5549],.modal-overlay .close-btn[data-v-528d5549],.dialogue-box button[data-v-528d5549],.dialogue-box input[data-v-528d5549],.dialogue-box textarea[data-v-528d5549],.dialogue-box select[data-v-528d5549],.dialogue-box .btn[data-v-528d5549],.dialogue-box .form-control[data-v-528d5549],.dialogue-box .modal-title[data-v-528d5549],.dialogue-box .close-btn[data-v-528d5549],.combat-panel button[data-v-528d5549],.combat-panel input[data-v-528d5549],.combat-panel textarea[data-v-528d5549],.combat-panel select[data-v-528d5549],.combat-panel .btn[data-v-528d5549],.combat-panel .form-control[data-v-528d5549],.combat-panel .modal-title[data-v-528d5549],.combat-panel .close-btn[data-v-528d5549],.character-panel button[data-v-528d5549],.character-panel input[data-v-528d5549],.character-panel textarea[data-v-528d5549],.character-panel select[data-v-528d5549],.character-panel .btn[data-v-528d5549],.character-panel .form-control[data-v-528d5549],.character-panel .modal-title[data-v-528d5549],.character-panel .close-btn[data-v-528d5549],.character-creator button[data-v-528d5549],.character-creator input[data-v-528d5549],.character-creator textarea[data-v-528d5549],.character-creator select[data-v-528d5549],.character-creator .btn[data-v-528d5549],.character-creator .form-control[data-v-528d5549],.character-creator .modal-title[data-v-528d5549],.character-creator .close-btn[data-v-528d5549],.instance-record button[data-v-528d5549],.instance-record input[data-v-528d5549],.instance-record textarea[data-v-528d5549],.instance-record select[data-v-528d5549],.instance-record .btn[data-v-528d5549],.instance-record .form-control[data-v-528d5549],.instance-record .modal-title[data-v-528d5549],.instance-record .close-btn[data-v-528d5549],.instance-generator button[data-v-528d5549],.instance-generator input[data-v-528d5549],.instance-generator textarea[data-v-528d5549],.instance-generator select[data-v-528d5549],.instance-generator .btn[data-v-528d5549],.instance-generator .form-control[data-v-528d5549],.instance-generator .modal-title[data-v-528d5549],.instance-generator .close-btn[data-v-528d5549],.interaction-room button[data-v-528d5549],.interaction-room input[data-v-528d5549],.interaction-room textarea[data-v-528d5549],.interaction-room select[data-v-528d5549],.interaction-room .btn[data-v-528d5549],.interaction-room .form-control[data-v-528d5549],.interaction-room .modal-title[data-v-528d5549],.interaction-room .close-btn[data-v-528d5549],.dice-roller button[data-v-528d5549],.dice-roller input[data-v-528d5549],.dice-roller textarea[data-v-528d5549],.dice-roller select[data-v-528d5549],.dice-roller .btn[data-v-528d5549],.dice-roller .form-control[data-v-528d5549],.dice-roller .modal-title[data-v-528d5549],.dice-roller .close-btn[data-v-528d5549],.map-panel button[data-v-528d5549],.map-panel input[data-v-528d5549],.map-panel textarea[data-v-528d5549],.map-panel select[data-v-528d5549],.map-panel .btn[data-v-528d5549],.map-panel .form-control[data-v-528d5549],.map-panel .modal-title[data-v-528d5549],.map-panel .close-btn[data-v-528d5549],.plot-review button[data-v-528d5549],.plot-review input[data-v-528d5549],.plot-review textarea[data-v-528d5549],.plot-review select[data-v-528d5549],.plot-review .btn[data-v-528d5549],.plot-review .form-control[data-v-528d5549],.plot-review .modal-title[data-v-528d5549],.plot-review .close-btn[data-v-528d5549]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-528d5549],.modal-overlay h2[data-v-528d5549],.modal-overlay h3[data-v-528d5549],.modal-overlay .modal-title[data-v-528d5549],.dialogue-box h1[data-v-528d5549],.dialogue-box h2[data-v-528d5549],.dialogue-box h3[data-v-528d5549],.dialogue-box .modal-title[data-v-528d5549],.combat-panel h1[data-v-528d5549],.combat-panel h2[data-v-528d5549],.combat-panel h3[data-v-528d5549],.combat-panel .modal-title[data-v-528d5549],.character-panel h1[data-v-528d5549],.character-panel h2[data-v-528d5549],.character-panel h3[data-v-528d5549],.character-panel .modal-title[data-v-528d5549],.character-creator h1[data-v-528d5549],.character-creator h2[data-v-528d5549],.character-creator h3[data-v-528d5549],.character-creator .modal-title[data-v-528d5549],.instance-record h1[data-v-528d5549],.instance-record h2[data-v-528d5549],.instance-record h3[data-v-528d5549],.instance-record .modal-title[data-v-528d5549],.instance-generator h1[data-v-528d5549],.instance-generator h2[data-v-528d5549],.instance-generator h3[data-v-528d5549],.instance-generator .modal-title[data-v-528d5549],.interaction-room h1[data-v-528d5549],.interaction-room h2[data-v-528d5549],.interaction-room h3[data-v-528d5549],.interaction-room .modal-title[data-v-528d5549],.dice-roller h1[data-v-528d5549],.dice-roller h2[data-v-528d5549],.dice-roller h3[data-v-528d5549],.dice-roller .modal-title[data-v-528d5549],.map-panel h1[data-v-528d5549],.map-panel h2[data-v-528d5549],.map-panel h3[data-v-528d5549],.map-panel .modal-title[data-v-528d5549],.plot-review h1[data-v-528d5549],.plot-review h2[data-v-528d5549],.plot-review h3[data-v-528d5549],.plot-review .modal-title[data-v-528d5549]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-528d5549],.modal-overlay .form-group[data-v-528d5549],.dialogue-box .button-group[data-v-528d5549],.dialogue-box .form-group[data-v-528d5549],.combat-panel .button-group[data-v-528d5549],.combat-panel .form-group[data-v-528d5549],.character-panel .button-group[data-v-528d5549],.character-panel .form-group[data-v-528d5549],.character-creator .button-group[data-v-528d5549],.character-creator .form-group[data-v-528d5549],.instance-record .button-group[data-v-528d5549],.instance-record .form-group[data-v-528d5549],.instance-generator .button-group[data-v-528d5549],.instance-generator .form-group[data-v-528d5549],.interaction-room .button-group[data-v-528d5549],.interaction-room .form-group[data-v-528d5549],.dice-roller .button-group[data-v-528d5549],.dice-roller .form-group[data-v-528d5549],.map-panel .button-group[data-v-528d5549],.map-panel .form-group[data-v-528d5549],.plot-review .button-group[data-v-528d5549],.plot-review .form-group[data-v-528d5549]{gap:calc(16px*var(--modal-scale))}.dialogue-box[data-v-528d5549]{position:fixed;bottom:var(--dialogue-bottom-offset);left:50%;transform:translateX(-50%);width:calc(100% - var(--dialogue-side-margin));max-width:800px;min-height:120px;max-height:var(--dialogue-max-height);background:rgba(0,0,0,.85);border:2px solid #d4af37;border-radius:12px;padding:24px;z-index:30;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3);cursor:pointer;transition:all .3s ease;display:flex;flex-direction:column;box-sizing:border-box}@media (max-width:767px){.dialogue-box[data-v-528d5549]{min-height:100px;padding:16px;border-width:1px;border-radius:8px}}@media (max-width:480px){.dialogue-box[data-v-528d5549]{padding:8px}}.dialogue-box[data-v-528d5549]:hover{border-color:#f4d03f;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 30px rgba(212,175,55,.5)}.dialogue-display[data-v-528d5549]{width:100%;flex:1;display:flex;flex-direction:column;overflow-y:auto;min-height:0}.dialogue-content[data-v-528d5549]{flex:1;min-height:0}.dialogue-text[data-v-528d5549]{font-size:16px;color:#f5f5f5;line-height:1.8;white-space:pre-wrap;word-wrap:break-word}@media (max-width:767px){.dialogue-text[data-v-528d5549]{font-size:14px;line-height:1.6}}.continue-hint[data-v-528d5549]{margin-top:16px;font-size:14px;color:#888;text-align:right;font-style:italic;animation:pulse-528d5549 2s ease-in-out infinite}@keyframes pulse-528d5549{0%,100%{opacity:.5}50%{opacity:1}}.dialogue-placeholder[data-v-528d5549]{font-size:16px;color:#ccc;text-align:center;padding:32px 0}.dialogue-placeholder p[data-v-528d5549]{margin:8px 0}.dialogue-placeholder .hint[data-v-528d5549]{font-size:14px;color:#888;font-style:italic}.custom-input-container[data-v-528d5549]{margin-top:16px;padding-top:16px;border-top:1px solid rgba(212,175,55,.3);display:flex;flex-direction:column;gap:8px;width:100%;box-sizing:border-box;flex-shrink:0}@media (max-width:767px){.custom-input-container[data-v-528d5549]{margin-top:8px;padding-top:8px;gap:4px}}@media (max-width:480px){.custom-input-container[data-v-528d5549]{margin-top:4px;padding-top:4px;gap:4px}}.custom-input-field[data-v-528d5549]{width:100%;min-height:80px;max-height:120px;padding:16px;background:rgba(0,0,0,.5);border:1px solid #555;border-radius:8px;color:#f5f5f5;font-size:16px;font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;resize:vertical;outline:none;transition:border-color .3s ease;box-sizing:border-box}@media (max-width:767px){.custom-input-field[data-v-528d5549]{min-height:50px;max-height:80px;padding:8px;font-size:16px}}@media (max-width:480px){.custom-input-field[data-v-528d5549]{min-height:40px;max-height:60px;padding:4px}}.custom-input-field[data-v-528d5549]:focus{border-color:#d4af37}.custom-input-field[data-v-528d5549]::placeholder{color:#888}.custom-send-button[data-v-528d5549]{align-self:flex-end;padding:8px 24px;background:linear-gradient(135deg,#d4af37,#b8941e);border:none;border-radius:8px;color:#0a0a0a;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease;box-shadow:0 2px 4px rgba(0,0,0,.3);white-space:nowrap;flex-shrink:0}@media (max-width:767px){.custom-send-button[data-v-528d5549]{padding:4px 16px;font-size:14px}}@media (max-width:480px){.custom-send-button[data-v-528d5549]{padding:4px 8px;font-size:12px}}.custom-send-button[data-v-528d5549]:hover:not(:disabled){background:linear-gradient(135deg,#f4d03f,#d4af37);box-shadow:0 4px 8px rgba(0,0,0,.4),0 0 20px rgba(212,175,55,.3);transform:translateY(-2px)}.custom-send-button[data-v-528d5549]:active:not(:disabled){transform:translateY(0);box-shadow:0 2px 4px rgba(0,0,0,.3)}.custom-send-button[data-v-528d5549]:disabled{opacity:.5;cursor:not-allowed}
[data-v-6a8485b2]{box-sizing:border-box;margin:0;padding:0}body[data-v-6a8485b2]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-6a8485b2]::-webkit-scrollbar{width:8px;height:8px}[data-v-6a8485b2]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-6a8485b2]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-6a8485b2]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-6a8485b2]{color:#d4af37}.text-muted[data-v-6a8485b2]{color:#888}.bg-overlay[data-v-6a8485b2]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-6a8485b2]{border:2px solid #d4af37}.shadow-gold[data-v-6a8485b2]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-6a8485b2]{z-index:50 !important}.dialogue-box[data-v-6a8485b2],.combat-panel[data-v-6a8485b2],.character-panel[data-v-6a8485b2],.character-creator[data-v-6a8485b2],.instance-record[data-v-6a8485b2],.instance-generator[data-v-6a8485b2],.interaction-room[data-v-6a8485b2],.dice-roller[data-v-6a8485b2],.map-panel[data-v-6a8485b2],.plot-review[data-v-6a8485b2]{z-index:50 !important}[data-v-6a8485b2]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-6a8485b2]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-6a8485b2]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-6a8485b2],.dialogue-box[data-v-6a8485b2],.combat-panel[data-v-6a8485b2],.character-panel[data-v-6a8485b2],.character-creator[data-v-6a8485b2],.instance-record[data-v-6a8485b2],.instance-generator[data-v-6a8485b2],.interaction-room[data-v-6a8485b2],.dice-roller[data-v-6a8485b2],.map-panel[data-v-6a8485b2],.plot-review[data-v-6a8485b2]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-6a8485b2],.dialogue-box[data-v-6a8485b2],.combat-panel[data-v-6a8485b2],.character-panel[data-v-6a8485b2],.character-creator[data-v-6a8485b2],.instance-record[data-v-6a8485b2],.instance-generator[data-v-6a8485b2],.interaction-room[data-v-6a8485b2],.dice-roller[data-v-6a8485b2],.map-panel[data-v-6a8485b2],.plot-review[data-v-6a8485b2]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-6a8485b2],.dialogue-box[data-v-6a8485b2],.combat-panel[data-v-6a8485b2],.character-panel[data-v-6a8485b2],.character-creator[data-v-6a8485b2],.instance-record[data-v-6a8485b2],.instance-generator[data-v-6a8485b2],.interaction-room[data-v-6a8485b2],.dice-roller[data-v-6a8485b2],.map-panel[data-v-6a8485b2],.plot-review[data-v-6a8485b2]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-6a8485b2],.modal-overlay input[data-v-6a8485b2],.modal-overlay textarea[data-v-6a8485b2],.modal-overlay select[data-v-6a8485b2],.modal-overlay .btn[data-v-6a8485b2],.modal-overlay .form-control[data-v-6a8485b2],.modal-overlay .modal-title[data-v-6a8485b2],.modal-overlay .close-btn[data-v-6a8485b2],.dialogue-box button[data-v-6a8485b2],.dialogue-box input[data-v-6a8485b2],.dialogue-box textarea[data-v-6a8485b2],.dialogue-box select[data-v-6a8485b2],.dialogue-box .btn[data-v-6a8485b2],.dialogue-box .form-control[data-v-6a8485b2],.dialogue-box .modal-title[data-v-6a8485b2],.dialogue-box .close-btn[data-v-6a8485b2],.combat-panel button[data-v-6a8485b2],.combat-panel input[data-v-6a8485b2],.combat-panel textarea[data-v-6a8485b2],.combat-panel select[data-v-6a8485b2],.combat-panel .btn[data-v-6a8485b2],.combat-panel .form-control[data-v-6a8485b2],.combat-panel .modal-title[data-v-6a8485b2],.combat-panel .close-btn[data-v-6a8485b2],.character-panel button[data-v-6a8485b2],.character-panel input[data-v-6a8485b2],.character-panel textarea[data-v-6a8485b2],.character-panel select[data-v-6a8485b2],.character-panel .btn[data-v-6a8485b2],.character-panel .form-control[data-v-6a8485b2],.character-panel .modal-title[data-v-6a8485b2],.character-panel .close-btn[data-v-6a8485b2],.character-creator button[data-v-6a8485b2],.character-creator input[data-v-6a8485b2],.character-creator textarea[data-v-6a8485b2],.character-creator select[data-v-6a8485b2],.character-creator .btn[data-v-6a8485b2],.character-creator .form-control[data-v-6a8485b2],.character-creator .modal-title[data-v-6a8485b2],.character-creator .close-btn[data-v-6a8485b2],.instance-record button[data-v-6a8485b2],.instance-record input[data-v-6a8485b2],.instance-record textarea[data-v-6a8485b2],.instance-record select[data-v-6a8485b2],.instance-record .btn[data-v-6a8485b2],.instance-record .form-control[data-v-6a8485b2],.instance-record .modal-title[data-v-6a8485b2],.instance-record .close-btn[data-v-6a8485b2],.instance-generator button[data-v-6a8485b2],.instance-generator input[data-v-6a8485b2],.instance-generator textarea[data-v-6a8485b2],.instance-generator select[data-v-6a8485b2],.instance-generator .btn[data-v-6a8485b2],.instance-generator .form-control[data-v-6a8485b2],.instance-generator .modal-title[data-v-6a8485b2],.instance-generator .close-btn[data-v-6a8485b2],.interaction-room button[data-v-6a8485b2],.interaction-room input[data-v-6a8485b2],.interaction-room textarea[data-v-6a8485b2],.interaction-room select[data-v-6a8485b2],.interaction-room .btn[data-v-6a8485b2],.interaction-room .form-control[data-v-6a8485b2],.interaction-room .modal-title[data-v-6a8485b2],.interaction-room .close-btn[data-v-6a8485b2],.dice-roller button[data-v-6a8485b2],.dice-roller input[data-v-6a8485b2],.dice-roller textarea[data-v-6a8485b2],.dice-roller select[data-v-6a8485b2],.dice-roller .btn[data-v-6a8485b2],.dice-roller .form-control[data-v-6a8485b2],.dice-roller .modal-title[data-v-6a8485b2],.dice-roller .close-btn[data-v-6a8485b2],.map-panel button[data-v-6a8485b2],.map-panel input[data-v-6a8485b2],.map-panel textarea[data-v-6a8485b2],.map-panel select[data-v-6a8485b2],.map-panel .btn[data-v-6a8485b2],.map-panel .form-control[data-v-6a8485b2],.map-panel .modal-title[data-v-6a8485b2],.map-panel .close-btn[data-v-6a8485b2],.plot-review button[data-v-6a8485b2],.plot-review input[data-v-6a8485b2],.plot-review textarea[data-v-6a8485b2],.plot-review select[data-v-6a8485b2],.plot-review .btn[data-v-6a8485b2],.plot-review .form-control[data-v-6a8485b2],.plot-review .modal-title[data-v-6a8485b2],.plot-review .close-btn[data-v-6a8485b2]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-6a8485b2],.modal-overlay h2[data-v-6a8485b2],.modal-overlay h3[data-v-6a8485b2],.modal-overlay .modal-title[data-v-6a8485b2],.dialogue-box h1[data-v-6a8485b2],.dialogue-box h2[data-v-6a8485b2],.dialogue-box h3[data-v-6a8485b2],.dialogue-box .modal-title[data-v-6a8485b2],.combat-panel h1[data-v-6a8485b2],.combat-panel h2[data-v-6a8485b2],.combat-panel h3[data-v-6a8485b2],.combat-panel .modal-title[data-v-6a8485b2],.character-panel h1[data-v-6a8485b2],.character-panel h2[data-v-6a8485b2],.character-panel h3[data-v-6a8485b2],.character-panel .modal-title[data-v-6a8485b2],.character-creator h1[data-v-6a8485b2],.character-creator h2[data-v-6a8485b2],.character-creator h3[data-v-6a8485b2],.character-creator .modal-title[data-v-6a8485b2],.instance-record h1[data-v-6a8485b2],.instance-record h2[data-v-6a8485b2],.instance-record h3[data-v-6a8485b2],.instance-record .modal-title[data-v-6a8485b2],.instance-generator h1[data-v-6a8485b2],.instance-generator h2[data-v-6a8485b2],.instance-generator h3[data-v-6a8485b2],.instance-generator .modal-title[data-v-6a8485b2],.interaction-room h1[data-v-6a8485b2],.interaction-room h2[data-v-6a8485b2],.interaction-room h3[data-v-6a8485b2],.interaction-room .modal-title[data-v-6a8485b2],.dice-roller h1[data-v-6a8485b2],.dice-roller h2[data-v-6a8485b2],.dice-roller h3[data-v-6a8485b2],.dice-roller .modal-title[data-v-6a8485b2],.map-panel h1[data-v-6a8485b2],.map-panel h2[data-v-6a8485b2],.map-panel h3[data-v-6a8485b2],.map-panel .modal-title[data-v-6a8485b2],.plot-review h1[data-v-6a8485b2],.plot-review h2[data-v-6a8485b2],.plot-review h3[data-v-6a8485b2],.plot-review .modal-title[data-v-6a8485b2]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-6a8485b2],.modal-overlay .form-group[data-v-6a8485b2],.dialogue-box .button-group[data-v-6a8485b2],.dialogue-box .form-group[data-v-6a8485b2],.combat-panel .button-group[data-v-6a8485b2],.combat-panel .form-group[data-v-6a8485b2],.character-panel .button-group[data-v-6a8485b2],.character-panel .form-group[data-v-6a8485b2],.character-creator .button-group[data-v-6a8485b2],.character-creator .form-group[data-v-6a8485b2],.instance-record .button-group[data-v-6a8485b2],.instance-record .form-group[data-v-6a8485b2],.instance-generator .button-group[data-v-6a8485b2],.instance-generator .form-group[data-v-6a8485b2],.interaction-room .button-group[data-v-6a8485b2],.interaction-room .form-group[data-v-6a8485b2],.dice-roller .button-group[data-v-6a8485b2],.dice-roller .form-group[data-v-6a8485b2],.map-panel .button-group[data-v-6a8485b2],.map-panel .form-group[data-v-6a8485b2],.plot-review .button-group[data-v-6a8485b2],.plot-review .form-group[data-v-6a8485b2]{gap:calc(16px*var(--modal-scale))}.dice-roller[data-v-6a8485b2]{width:100%;max-width:800px;max-height:90vh;overflow-y:auto;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:32px;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.dice-roller[data-v-6a8485b2]{max-width:95vw;max-height:95vh;padding:16px;border-width:1px}}@media (max-width:480px){.dice-roller[data-v-6a8485b2]{max-width:98vw;padding:8px}}.dice-roller[data-v-6a8485b2]{max-width:400px;width:100%;position:relative}.dice-roller.is-rolling[data-v-6a8485b2]{pointer-events:none}.roller-header[data-v-6a8485b2]{text-align:center;margin-bottom:24px}@media (max-width:767px){.roller-header[data-v-6a8485b2]{margin-bottom:16px}}.roller-header h3[data-v-6a8485b2]{--base-title-size:32px;font-size:32px;color:#d4af37;text-align:center;margin-bottom:32px;text-shadow:0 0 10px rgba(212,175,55,.5)}@media (max-width:767px){.roller-header h3[data-v-6a8485b2]{--base-title-size:24px;font-size:24px;margin-bottom:16px}}@media (max-width:480px){.roller-header h3[data-v-6a8485b2]{--base-title-size:20px;font-size:20px;margin-bottom:8px}}.roller-header h3[data-v-6a8485b2]{margin:0;margin-bottom:0}.skill-selection[data-v-6a8485b2]{margin-bottom:24px}@media (max-width:767px){.skill-selection[data-v-6a8485b2]{margin-bottom:16px}}.skill-selection label[data-v-6a8485b2]{display:block;color:#d4af37;font-size:14px;margin-bottom:8px}@media (max-width:767px){.skill-selection label[data-v-6a8485b2]{font-size:12px}}.skill-selection select[data-v-6a8485b2]{--base-font-size:16px;--base-padding:16px;--base-border-radius:4px;padding:16px;background:rgba(0,0,0,.5);border:1px solid #d4af37;color:#f5f5f5;font-size:16px;font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;border-radius:4px;transition:all .3s ease}@media (max-width:767px){.skill-selection select[data-v-6a8485b2]{--base-padding:8px;--base-font-size:14px;padding:8px;font-size:14px}}.skill-selection select[data-v-6a8485b2]:focus{outline:none;border-color:#d4af37;box-shadow:0 0 20px rgba(212,175,55,.3)}.skill-selection select[data-v-6a8485b2]::placeholder{color:#888}.skill-selection select[data-v-6a8485b2]{width:100%;cursor:pointer}.skill-selection select[data-v-6a8485b2]:hover:not(:disabled){border-color:#f4d03f;box-shadow:0 0 20px rgba(212,175,55,.3)}.skill-selection select[data-v-6a8485b2]:disabled{opacity:.5;cursor:not-allowed}.skill-selection select option[data-v-6a8485b2]{background:#0a0a0a;color:#f5f5f5}.roll-actions[data-v-6a8485b2]{display:flex;gap:16px;flex-wrap:wrap}@media (max-width:767px){.roll-actions[data-v-6a8485b2]{gap:8px}}@media (max-width:480px){.roll-actions[data-v-6a8485b2]{flex-direction:column}}.roll-actions[data-v-6a8485b2]{margin-bottom:24px}.roll-actions button[data-v-6a8485b2]{flex:1;padding:8px 24px;background:linear-gradient(135deg,#d4af37,#b8941e);border:none;border-radius:4px;color:#0a0a0a;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease;text-shadow:0 1px 2px hsla(0,0%,100%,.3)}@media (max-width:767px){.roll-actions button[data-v-6a8485b2]{padding:4px 16px;font-size:14px}}.roll-actions button[data-v-6a8485b2]:hover:not(:disabled){background:linear-gradient(135deg,#f4d03f,#d4af37);box-shadow:0 4px 8px rgba(0,0,0,.4),0 0 20px rgba(212,175,55,.3);transform:translateY(-2px)}.roll-actions button[data-v-6a8485b2]:active:not(:disabled){transform:translateY(0)}.roll-actions button[data-v-6a8485b2]:disabled{opacity:.5;cursor:not-allowed}.roll-actions .btn-reroll[data-v-6a8485b2]{background:linear-gradient(135deg,#888888,#666666)}.roll-actions .btn-reroll[data-v-6a8485b2]:hover:not(:disabled){background:linear-gradient(135deg,#aaaaaa,#888888)}.roll-result[data-v-6a8485b2]{padding:24px;background:rgba(212,175,55,.1);border:1px solid #d4af37;border-radius:4px}@media (max-width:767px){.roll-result[data-v-6a8485b2]{padding:16px}}.dice-display[data-v-6a8485b2]{display:flex;justify-content:center;align-items:center;margin-bottom:24px}@media (max-width:767px){.dice-display[data-v-6a8485b2]{margin-bottom:16px}}.dice-display .dice-value[data-v-6a8485b2]{width:80px;height:80px;display:flex;justify-content:center;align-items:center;background:linear-gradient(135deg,#d4af37,#b8941e);border:3px solid #f4d03f;border-radius:8px;color:#0a0a0a;font-size:32px;font-weight:700;box-shadow:0 4px 8px rgba(0,0,0,.4),0 0 20px rgba(212,175,55,.3);text-shadow:0 2px 4px hsla(0,0%,100%,.3)}@media (max-width:767px){.dice-display .dice-value[data-v-6a8485b2]{width:60px;height:60px;font-size:24px;border-width:2px}}.result-info[data-v-6a8485b2]{text-align:center;margin-bottom:16px}@media (max-width:767px){.result-info[data-v-6a8485b2]{margin-bottom:8px}}.result-level[data-v-6a8485b2]{font-size:24px;font-weight:700;margin-bottom:8px;text-shadow:0 0 10px currentColor}@media (max-width:767px){.result-level[data-v-6a8485b2]{font-size:20px}}.result-level.result-critical_success[data-v-6a8485b2]{color:#4caf50}.result-level.result-extreme_success[data-v-6a8485b2]{color:rgb(60.5577689243,139.4422310757,63.7450199203)}.result-level.result-hard_success[data-v-6a8485b2]{color:rgb(145.5378486056,207.4621513944,148.0398406375)}.result-level.result-success[data-v-6a8485b2]{color:rgb(181.0956175299,222.9043824701,182.7848605578)}.result-level.result-failure[data-v-6a8485b2]{color:hsl(4.1052631579,89.6226415094%,88.431372549%)}.result-level.result-critical_failure[data-v-6a8485b2]{color:#f44336}.result-details[data-v-6a8485b2]{display:flex;justify-content:space-around;color:#d4af37;font-size:14px;gap:4px;flex-wrap:wrap}@media (max-width:767px){.result-details[data-v-6a8485b2]{font-size:12px}}.result-details span[data-v-6a8485b2]{padding:4px 8px;background:rgba(0,0,0,.5);border-radius:4px}@media (max-width:767px){.result-details span[data-v-6a8485b2]{padding:4px 4px}}.btn-generate[data-v-6a8485b2]{width:100%;padding:8px 24px;background:linear-gradient(135deg,#2196f3,rgb(11.5384615385,124.0384615385,213.4615384615));border:none;border-radius:4px;color:#f5f5f5;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease}@media (max-width:767px){.btn-generate[data-v-6a8485b2]{padding:4px 16px;font-size:14px}}.btn-generate[data-v-6a8485b2]:hover:not(:disabled){background:linear-gradient(135deg,rgb(81.3846153846,172.8846153846,245.6153846154),#2196f3);box-shadow:0 4px 8px rgba(0,0,0,.4),0 0 15px rgba(33,150,243,.5);transform:translateY(-2px)}.btn-generate[data-v-6a8485b2]:active:not(:disabled){transform:translateY(0)}.btn-generate[data-v-6a8485b2]:disabled{opacity:.5;cursor:not-allowed}.fade-enter-active[data-v-6a8485b2],.fade-leave-active[data-v-6a8485b2]{transition:opacity .3s ease}.fade-enter-from[data-v-6a8485b2],.fade-leave-to[data-v-6a8485b2]{opacity:0}
[data-v-09d22cd3]{box-sizing:border-box;margin:0;padding:0}body[data-v-09d22cd3]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-09d22cd3]::-webkit-scrollbar{width:8px;height:8px}[data-v-09d22cd3]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-09d22cd3]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-09d22cd3]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-09d22cd3]{color:#d4af37}.text-muted[data-v-09d22cd3]{color:#888}.bg-overlay[data-v-09d22cd3]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-09d22cd3]{border:2px solid #d4af37}.shadow-gold[data-v-09d22cd3]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-09d22cd3]{z-index:50 !important}.dialogue-box[data-v-09d22cd3],.combat-panel[data-v-09d22cd3],.character-panel[data-v-09d22cd3],.character-creator[data-v-09d22cd3],.instance-record[data-v-09d22cd3],.instance-generator[data-v-09d22cd3],.interaction-room[data-v-09d22cd3],.dice-roller[data-v-09d22cd3],.map-panel[data-v-09d22cd3],.plot-review[data-v-09d22cd3]{z-index:50 !important}[data-v-09d22cd3]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-09d22cd3]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-09d22cd3]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-09d22cd3],.dialogue-box[data-v-09d22cd3],.combat-panel[data-v-09d22cd3],.character-panel[data-v-09d22cd3],.character-creator[data-v-09d22cd3],.instance-record[data-v-09d22cd3],.instance-generator[data-v-09d22cd3],.interaction-room[data-v-09d22cd3],.dice-roller[data-v-09d22cd3],.map-panel[data-v-09d22cd3],.plot-review[data-v-09d22cd3]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-09d22cd3],.dialogue-box[data-v-09d22cd3],.combat-panel[data-v-09d22cd3],.character-panel[data-v-09d22cd3],.character-creator[data-v-09d22cd3],.instance-record[data-v-09d22cd3],.instance-generator[data-v-09d22cd3],.interaction-room[data-v-09d22cd3],.dice-roller[data-v-09d22cd3],.map-panel[data-v-09d22cd3],.plot-review[data-v-09d22cd3]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-09d22cd3],.dialogue-box[data-v-09d22cd3],.combat-panel[data-v-09d22cd3],.character-panel[data-v-09d22cd3],.character-creator[data-v-09d22cd3],.instance-record[data-v-09d22cd3],.instance-generator[data-v-09d22cd3],.interaction-room[data-v-09d22cd3],.dice-roller[data-v-09d22cd3],.map-panel[data-v-09d22cd3],.plot-review[data-v-09d22cd3]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-09d22cd3],.modal-overlay input[data-v-09d22cd3],.modal-overlay textarea[data-v-09d22cd3],.modal-overlay select[data-v-09d22cd3],.modal-overlay .btn[data-v-09d22cd3],.modal-overlay .form-control[data-v-09d22cd3],.modal-overlay .modal-title[data-v-09d22cd3],.modal-overlay .close-btn[data-v-09d22cd3],.dialogue-box button[data-v-09d22cd3],.dialogue-box input[data-v-09d22cd3],.dialogue-box textarea[data-v-09d22cd3],.dialogue-box select[data-v-09d22cd3],.dialogue-box .btn[data-v-09d22cd3],.dialogue-box .form-control[data-v-09d22cd3],.dialogue-box .modal-title[data-v-09d22cd3],.dialogue-box .close-btn[data-v-09d22cd3],.combat-panel button[data-v-09d22cd3],.combat-panel input[data-v-09d22cd3],.combat-panel textarea[data-v-09d22cd3],.combat-panel select[data-v-09d22cd3],.combat-panel .btn[data-v-09d22cd3],.combat-panel .form-control[data-v-09d22cd3],.combat-panel .modal-title[data-v-09d22cd3],.combat-panel .close-btn[data-v-09d22cd3],.character-panel button[data-v-09d22cd3],.character-panel input[data-v-09d22cd3],.character-panel textarea[data-v-09d22cd3],.character-panel select[data-v-09d22cd3],.character-panel .btn[data-v-09d22cd3],.character-panel .form-control[data-v-09d22cd3],.character-panel .modal-title[data-v-09d22cd3],.character-panel .close-btn[data-v-09d22cd3],.character-creator button[data-v-09d22cd3],.character-creator input[data-v-09d22cd3],.character-creator textarea[data-v-09d22cd3],.character-creator select[data-v-09d22cd3],.character-creator .btn[data-v-09d22cd3],.character-creator .form-control[data-v-09d22cd3],.character-creator .modal-title[data-v-09d22cd3],.character-creator .close-btn[data-v-09d22cd3],.instance-record button[data-v-09d22cd3],.instance-record input[data-v-09d22cd3],.instance-record textarea[data-v-09d22cd3],.instance-record select[data-v-09d22cd3],.instance-record .btn[data-v-09d22cd3],.instance-record .form-control[data-v-09d22cd3],.instance-record .modal-title[data-v-09d22cd3],.instance-record .close-btn[data-v-09d22cd3],.instance-generator button[data-v-09d22cd3],.instance-generator input[data-v-09d22cd3],.instance-generator textarea[data-v-09d22cd3],.instance-generator select[data-v-09d22cd3],.instance-generator .btn[data-v-09d22cd3],.instance-generator .form-control[data-v-09d22cd3],.instance-generator .modal-title[data-v-09d22cd3],.instance-generator .close-btn[data-v-09d22cd3],.interaction-room button[data-v-09d22cd3],.interaction-room input[data-v-09d22cd3],.interaction-room textarea[data-v-09d22cd3],.interaction-room select[data-v-09d22cd3],.interaction-room .btn[data-v-09d22cd3],.interaction-room .form-control[data-v-09d22cd3],.interaction-room .modal-title[data-v-09d22cd3],.interaction-room .close-btn[data-v-09d22cd3],.dice-roller button[data-v-09d22cd3],.dice-roller input[data-v-09d22cd3],.dice-roller textarea[data-v-09d22cd3],.dice-roller select[data-v-09d22cd3],.dice-roller .btn[data-v-09d22cd3],.dice-roller .form-control[data-v-09d22cd3],.dice-roller .modal-title[data-v-09d22cd3],.dice-roller .close-btn[data-v-09d22cd3],.map-panel button[data-v-09d22cd3],.map-panel input[data-v-09d22cd3],.map-panel textarea[data-v-09d22cd3],.map-panel select[data-v-09d22cd3],.map-panel .btn[data-v-09d22cd3],.map-panel .form-control[data-v-09d22cd3],.map-panel .modal-title[data-v-09d22cd3],.map-panel .close-btn[data-v-09d22cd3],.plot-review button[data-v-09d22cd3],.plot-review input[data-v-09d22cd3],.plot-review textarea[data-v-09d22cd3],.plot-review select[data-v-09d22cd3],.plot-review .btn[data-v-09d22cd3],.plot-review .form-control[data-v-09d22cd3],.plot-review .modal-title[data-v-09d22cd3],.plot-review .close-btn[data-v-09d22cd3]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-09d22cd3],.modal-overlay h2[data-v-09d22cd3],.modal-overlay h3[data-v-09d22cd3],.modal-overlay .modal-title[data-v-09d22cd3],.dialogue-box h1[data-v-09d22cd3],.dialogue-box h2[data-v-09d22cd3],.dialogue-box h3[data-v-09d22cd3],.dialogue-box .modal-title[data-v-09d22cd3],.combat-panel h1[data-v-09d22cd3],.combat-panel h2[data-v-09d22cd3],.combat-panel h3[data-v-09d22cd3],.combat-panel .modal-title[data-v-09d22cd3],.character-panel h1[data-v-09d22cd3],.character-panel h2[data-v-09d22cd3],.character-panel h3[data-v-09d22cd3],.character-panel .modal-title[data-v-09d22cd3],.character-creator h1[data-v-09d22cd3],.character-creator h2[data-v-09d22cd3],.character-creator h3[data-v-09d22cd3],.character-creator .modal-title[data-v-09d22cd3],.instance-record h1[data-v-09d22cd3],.instance-record h2[data-v-09d22cd3],.instance-record h3[data-v-09d22cd3],.instance-record .modal-title[data-v-09d22cd3],.instance-generator h1[data-v-09d22cd3],.instance-generator h2[data-v-09d22cd3],.instance-generator h3[data-v-09d22cd3],.instance-generator .modal-title[data-v-09d22cd3],.interaction-room h1[data-v-09d22cd3],.interaction-room h2[data-v-09d22cd3],.interaction-room h3[data-v-09d22cd3],.interaction-room .modal-title[data-v-09d22cd3],.dice-roller h1[data-v-09d22cd3],.dice-roller h2[data-v-09d22cd3],.dice-roller h3[data-v-09d22cd3],.dice-roller .modal-title[data-v-09d22cd3],.map-panel h1[data-v-09d22cd3],.map-panel h2[data-v-09d22cd3],.map-panel h3[data-v-09d22cd3],.map-panel .modal-title[data-v-09d22cd3],.plot-review h1[data-v-09d22cd3],.plot-review h2[data-v-09d22cd3],.plot-review h3[data-v-09d22cd3],.plot-review .modal-title[data-v-09d22cd3]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-09d22cd3],.modal-overlay .form-group[data-v-09d22cd3],.dialogue-box .button-group[data-v-09d22cd3],.dialogue-box .form-group[data-v-09d22cd3],.combat-panel .button-group[data-v-09d22cd3],.combat-panel .form-group[data-v-09d22cd3],.character-panel .button-group[data-v-09d22cd3],.character-panel .form-group[data-v-09d22cd3],.character-creator .button-group[data-v-09d22cd3],.character-creator .form-group[data-v-09d22cd3],.instance-record .button-group[data-v-09d22cd3],.instance-record .form-group[data-v-09d22cd3],.instance-generator .button-group[data-v-09d22cd3],.instance-generator .form-group[data-v-09d22cd3],.interaction-room .button-group[data-v-09d22cd3],.interaction-room .form-group[data-v-09d22cd3],.dice-roller .button-group[data-v-09d22cd3],.dice-roller .form-group[data-v-09d22cd3],.map-panel .button-group[data-v-09d22cd3],.map-panel .form-group[data-v-09d22cd3],.plot-review .button-group[data-v-09d22cd3],.plot-review .form-group[data-v-09d22cd3]{gap:calc(16px*var(--modal-scale))}.instance-generator[data-v-09d22cd3]{width:100%;aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;padding:32px;background:linear-gradient(135deg,#0f0f0f 0%,#1a1a1a 100%)}@media (max-width:767px){.instance-generator[data-v-09d22cd3]{padding:16px;aspect-ratio:auto;min-height:100vh}}@media (max-width:480px){.instance-generator[data-v-09d22cd3]{padding:8px}}.generator-container[data-v-09d22cd3]{width:100%;max-width:800px;max-height:90vh;overflow-y:auto;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:32px;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.generator-container[data-v-09d22cd3]{max-width:95vw;max-height:95vh;padding:16px;border-width:1px}}@media (max-width:480px){.generator-container[data-v-09d22cd3]{max-width:98vw;padding:8px}}.generator-container[data-v-09d22cd3]{position:relative;max-width:600px;width:100%}.close-btn[data-v-09d22cd3]{position:absolute;top:16px;right:16px;width:32px;height:32px;padding:0;background:rgba(0,0,0,.7);border:1px solid #d4af37;border-radius:4px;color:#d4af37;font-size:18px;cursor:pointer;transition:all .15s ease;z-index:10}@media (max-width:767px){.close-btn[data-v-09d22cd3]{width:28px;height:28px;font-size:16px;top:8px;right:8px}}.close-btn[data-v-09d22cd3]:hover{background:rgba(244,67,54,.3);border-color:#f44336;color:#f44336;transform:scale(1.1)}.generator-title[data-v-09d22cd3]{--base-title-size:32px;font-size:32px;color:#d4af37;text-align:center;margin-bottom:32px;text-shadow:0 0 10px rgba(212,175,55,.5)}@media (max-width:767px){.generator-title[data-v-09d22cd3]{--base-title-size:24px;font-size:24px;margin-bottom:16px}}@media (max-width:480px){.generator-title[data-v-09d22cd3]{--base-title-size:20px;font-size:20px;margin-bottom:8px}}.generator-content[data-v-09d22cd3]{display:flex;flex-direction:column;gap:24px}@media (max-width:767px){.generator-content[data-v-09d22cd3]{gap:16px}}.form-group[data-v-09d22cd3]{display:flex;flex-direction:column;gap:8px}.form-group label[data-v-09d22cd3]{font-size:16px;color:#d4af37;font-weight:500}@media (max-width:767px){.form-group label[data-v-09d22cd3]{font-size:14px}}.difficulty-selector[data-v-09d22cd3]{display:flex;gap:8px}@media (max-width:767px){.difficulty-selector[data-v-09d22cd3]{gap:4px}}.difficulty-btn[data-v-09d22cd3]{flex:1;padding:16px;background:rgba(212,175,55,.1);border:2px solid #d4af37;color:#d4af37;font-size:18px;font-weight:700;cursor:pointer;transition:all .3s ease;border-radius:4px}@media (max-width:767px){.difficulty-btn[data-v-09d22cd3]{padding:8px;font-size:16px;border-width:1px}}@media (max-width:480px){.difficulty-btn[data-v-09d22cd3]{padding:4px;font-size:14px}}.difficulty-btn[data-v-09d22cd3]:hover{background:rgba(212,175,55,.2);transform:translateY(-2px)}.difficulty-btn.active[data-v-09d22cd3]{background:#d4af37;color:#0a0a0a;box-shadow:0 0 20px rgba(212,175,55,.3)}.difficulty-btn[data-v-09d22cd3]:disabled{opacity:.5;cursor:not-allowed}.form-control[data-v-09d22cd3]{--base-font-size:16px;--base-padding:16px;--base-border-radius:4px;padding:16px;background:rgba(0,0,0,.5);border:1px solid #d4af37;color:#f5f5f5;font-size:16px;font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;border-radius:4px;transition:all .3s ease}@media (max-width:767px){.form-control[data-v-09d22cd3]{--base-padding:8px;--base-font-size:14px;padding:8px;font-size:14px}}.form-control[data-v-09d22cd3]:focus{outline:none;border-color:#d4af37;box-shadow:0 0 20px rgba(212,175,55,.3)}.form-control[data-v-09d22cd3]::placeholder{color:#888}textarea.form-control[data-v-09d22cd3]{resize:vertical;min-height:100px}@media (max-width:767px){textarea.form-control[data-v-09d22cd3]{min-height:80px}}.button-group[data-v-09d22cd3]{display:flex;gap:16px;flex-wrap:wrap}@media (max-width:767px){.button-group[data-v-09d22cd3]{gap:8px}}@media (max-width:480px){.button-group[data-v-09d22cd3]{flex-direction:column}}.button-group[data-v-09d22cd3]{margin-top:16px}.btn[data-v-09d22cd3]{flex:1;padding:16px;font-size:18px;font-weight:700;border:none;border-radius:4px;cursor:pointer;transition:all .3s ease;text-transform:uppercase;letter-spacing:1px}.btn[data-v-09d22cd3]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[data-v-09d22cd3]{background:linear-gradient(135deg,#d4af37,#f4d03f);color:#0a0a0a;box-shadow:0 4px 8px rgba(0,0,0,.4),0 0 20px rgba(212,175,55,.3)}.btn-primary[data-v-09d22cd3]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}.btn-primary[data-v-09d22cd3]:active:not(:disabled){transform:translateY(0)}.btn-secondary[data-v-09d22cd3]{background:rgba(212,175,55,.2);color:#d4af37;border:2px solid #d4af37}.btn-secondary[data-v-09d22cd3]:hover:not(:disabled){background:rgba(212,175,55,.3);transform:translateY(-2px)}.btn-success[data-v-09d22cd3]{background:linear-gradient(135deg,#4caf50,rgb(109.9800796813,192.0199203187,113.2948207171));color:#f5f5f5;box-shadow:0 4px 8px rgba(0,0,0,.4),0 0 15px rgba(76,175,80,.4)}.btn-success[data-v-09d22cd3]:hover{transform:translateY(-2px);box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(76,175,80,.6)}.generation-progress[data-v-09d22cd3]{display:flex;flex-direction:column;gap:16px;padding:16px;background:rgba(212,175,55,.1);border:1px solid #d4af37;border-radius:4px}.progress-bar[data-v-09d22cd3]{width:100%;height:8px;background:rgba(0,0,0,.5);border-radius:4px;overflow:hidden}.progress-fill[data-v-09d22cd3]{height:100%;background:linear-gradient(90deg,#d4af37 0%,#f4d03f 50%,#d4af37 100%);background-size:200% 100%;animation:progress-animation-09d22cd3 2s linear infinite}@keyframes progress-animation-09d22cd3{0%{background-position:200% 0}100%{background-position:-200% 0}}.progress-text[data-v-09d22cd3]{text-align:center;color:#d4af37;font-size:16px;margin:0}.generation-result[data-v-09d22cd3]{padding:24px;background:rgba(76,175,80,.1);border:2px solid #4caf50;border-radius:4px}.result-success[data-v-09d22cd3]{display:flex;flex-direction:column;align-items:center;gap:16px}.result-success .icon-check[data-v-09d22cd3]{width:48px;height:48px;border-radius:50%;background:#4caf50;display:flex;align-items:center;justify-content:center;font-size:32px;color:#f5f5f5}.result-success .icon-check[data-v-09d22cd3]::before{content:"✓"}.result-success p[data-v-09d22cd3]{font-size:18px;color:#4caf50;margin:0;font-weight:700}.npc-management .npc-list[data-v-09d22cd3]{display:flex;flex-direction:column;gap:8px;margin-bottom:16px;max-height:300px;overflow-y:auto;padding:8px;background:rgba(0,0,0,.3);border-radius:4px}@media (max-width:767px){.npc-management .npc-list[data-v-09d22cd3]{max-height:200px}}.npc-management .npc-empty[data-v-09d22cd3]{text-align:center;padding:24px;color:rgba(212,175,55,.6);font-size:14px}.npc-management .npc-item[data-v-09d22cd3]{display:flex;flex-direction:column;gap:4px;padding:8px;background:rgba(212,175,55,.1);border:1px solid #d4af37;border-radius:4px;transition:all .3s ease}.npc-management .npc-item[data-v-09d22cd3]:hover{background:rgba(212,175,55,.15)}@media (max-width:767px){.npc-management .npc-item[data-v-09d22cd3]{padding:4px}}.npc-management .npc-info[data-v-09d22cd3]{display:flex;gap:16px;align-items:center}@media (max-width:767px){.npc-management .npc-info[data-v-09d22cd3]{flex-direction:column;gap:4px;align-items:flex-start}}.npc-management .npc-name[data-v-09d22cd3]{font-size:16px;color:#d4af37;font-weight:700}@media (max-width:767px){.npc-management .npc-name[data-v-09d22cd3]{font-size:14px}}.npc-management .npc-occupation[data-v-09d22cd3]{font-size:14px;color:rgba(212,175,55,.7)}@media (max-width:767px){.npc-management .npc-occupation[data-v-09d22cd3]{font-size:12px}}.npc-management .npc-controls[data-v-09d22cd3]{display:flex;gap:8px;align-items:center}@media (max-width:767px){.npc-management .npc-controls[data-v-09d22cd3]{flex-wrap:wrap}}.npc-management .importance-label[data-v-09d22cd3]{font-size:14px;color:#d4af37;white-space:nowrap}@media (max-width:767px){.npc-management .importance-label[data-v-09d22cd3]{font-size:12px}}.npc-management .importance-selector[data-v-09d22cd3]{flex:1;padding:4px 8px;background:rgba(0,0,0,.5);border:1px solid #d4af37;color:#d4af37;font-size:14px;border-radius:4px;cursor:pointer;transition:all .3s ease}.npc-management .importance-selector[data-v-09d22cd3]:hover{background:rgba(0,0,0,.7)}.npc-management .importance-selector[data-v-09d22cd3]:focus{outline:none;border-color:#d4af37}@media (max-width:767px){.npc-management .importance-selector[data-v-09d22cd3]{font-size:12px;padding:4px 4px}}.npc-management .btn-delete[data-v-09d22cd3]{padding:4px 8px;background:rgba(244,67,54,.2);border:1px solid rgba(244,67,54,.5);color:#f44336;font-size:16px;font-weight:700;border-radius:4px;cursor:pointer;transition:all .3s ease}.npc-management .btn-delete[data-v-09d22cd3]:hover{background:rgba(244,67,54,.3);transform:scale(1.1)}@media (max-width:767px){.npc-management .btn-delete[data-v-09d22cd3]{font-size:14px;padding:4px 4px}}.npc-management .npc-actions[data-v-09d22cd3]{display:flex;gap:8px}@media (max-width:767px){.npc-management .npc-actions[data-v-09d22cd3]{flex-direction:column}}.npc-management .npc-actions .btn[data-v-09d22cd3]{flex:1;padding:8px 16px;font-size:16px}@media (max-width:767px){.npc-management .npc-actions .btn[data-v-09d22cd3]{font-size:14px;padding:4px 8px}}.custom-npc-dialog[data-v-09d22cd3]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px}.custom-npc-dialog .dialog-content[data-v-09d22cd3]{background:linear-gradient(135deg,rgba(26,26,26,0.98),rgba(38,38,38,0.98));border:2px solid #d4af37;border-radius:8px;padding:32px;max-width:500px;width:100%;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.custom-npc-dialog .dialog-content[data-v-09d22cd3]{padding:16px;max-width:90%}}.custom-npc-dialog .dialog-content h3[data-v-09d22cd3]{color:#d4af37;font-size:20px;margin:0 0 16px 0;text-align:center}@media (max-width:767px){.custom-npc-dialog .dialog-content h3[data-v-09d22cd3]{font-size:18px}}.custom-npc-dialog .dialog-content .form-control[data-v-09d22cd3]{margin-bottom:16px}.custom-npc-dialog .dialog-content .dialog-actions[data-v-09d22cd3]{display:flex;gap:8px}@media (max-width:767px){.custom-npc-dialog .dialog-content .dialog-actions[data-v-09d22cd3]{flex-direction:column}}.custom-npc-dialog .dialog-content .dialog-actions .btn[data-v-09d22cd3]{flex:1;padding:8px 16px;font-size:16px}@media (max-width:767px){.custom-npc-dialog .dialog-content .dialog-actions .btn[data-v-09d22cd3]{font-size:14px}}
[data-v-3ee520ab]{box-sizing:border-box;margin:0;padding:0}body[data-v-3ee520ab]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-3ee520ab]::-webkit-scrollbar{width:8px;height:8px}[data-v-3ee520ab]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-3ee520ab]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-3ee520ab]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-3ee520ab]{color:#d4af37}.text-muted[data-v-3ee520ab]{color:#888}.bg-overlay[data-v-3ee520ab]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-3ee520ab]{border:2px solid #d4af37}.shadow-gold[data-v-3ee520ab]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-3ee520ab]{z-index:50 !important}.dialogue-box[data-v-3ee520ab],.combat-panel[data-v-3ee520ab],.character-panel[data-v-3ee520ab],.character-creator[data-v-3ee520ab],.instance-record[data-v-3ee520ab],.instance-generator[data-v-3ee520ab],.interaction-room[data-v-3ee520ab],.dice-roller[data-v-3ee520ab],.map-panel[data-v-3ee520ab],.plot-review[data-v-3ee520ab]{z-index:50 !important}[data-v-3ee520ab]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-3ee520ab]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-3ee520ab]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-3ee520ab],.dialogue-box[data-v-3ee520ab],.combat-panel[data-v-3ee520ab],.character-panel[data-v-3ee520ab],.character-creator[data-v-3ee520ab],.instance-record[data-v-3ee520ab],.instance-generator[data-v-3ee520ab],.interaction-room[data-v-3ee520ab],.dice-roller[data-v-3ee520ab],.map-panel[data-v-3ee520ab],.plot-review[data-v-3ee520ab]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-3ee520ab],.dialogue-box[data-v-3ee520ab],.combat-panel[data-v-3ee520ab],.character-panel[data-v-3ee520ab],.character-creator[data-v-3ee520ab],.instance-record[data-v-3ee520ab],.instance-generator[data-v-3ee520ab],.interaction-room[data-v-3ee520ab],.dice-roller[data-v-3ee520ab],.map-panel[data-v-3ee520ab],.plot-review[data-v-3ee520ab]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-3ee520ab],.dialogue-box[data-v-3ee520ab],.combat-panel[data-v-3ee520ab],.character-panel[data-v-3ee520ab],.character-creator[data-v-3ee520ab],.instance-record[data-v-3ee520ab],.instance-generator[data-v-3ee520ab],.interaction-room[data-v-3ee520ab],.dice-roller[data-v-3ee520ab],.map-panel[data-v-3ee520ab],.plot-review[data-v-3ee520ab]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-3ee520ab],.modal-overlay input[data-v-3ee520ab],.modal-overlay textarea[data-v-3ee520ab],.modal-overlay select[data-v-3ee520ab],.modal-overlay .btn[data-v-3ee520ab],.modal-overlay .form-control[data-v-3ee520ab],.modal-overlay .modal-title[data-v-3ee520ab],.modal-overlay .close-btn[data-v-3ee520ab],.dialogue-box button[data-v-3ee520ab],.dialogue-box input[data-v-3ee520ab],.dialogue-box textarea[data-v-3ee520ab],.dialogue-box select[data-v-3ee520ab],.dialogue-box .btn[data-v-3ee520ab],.dialogue-box .form-control[data-v-3ee520ab],.dialogue-box .modal-title[data-v-3ee520ab],.dialogue-box .close-btn[data-v-3ee520ab],.combat-panel button[data-v-3ee520ab],.combat-panel input[data-v-3ee520ab],.combat-panel textarea[data-v-3ee520ab],.combat-panel select[data-v-3ee520ab],.combat-panel .btn[data-v-3ee520ab],.combat-panel .form-control[data-v-3ee520ab],.combat-panel .modal-title[data-v-3ee520ab],.combat-panel .close-btn[data-v-3ee520ab],.character-panel button[data-v-3ee520ab],.character-panel input[data-v-3ee520ab],.character-panel textarea[data-v-3ee520ab],.character-panel select[data-v-3ee520ab],.character-panel .btn[data-v-3ee520ab],.character-panel .form-control[data-v-3ee520ab],.character-panel .modal-title[data-v-3ee520ab],.character-panel .close-btn[data-v-3ee520ab],.character-creator button[data-v-3ee520ab],.character-creator input[data-v-3ee520ab],.character-creator textarea[data-v-3ee520ab],.character-creator select[data-v-3ee520ab],.character-creator .btn[data-v-3ee520ab],.character-creator .form-control[data-v-3ee520ab],.character-creator .modal-title[data-v-3ee520ab],.character-creator .close-btn[data-v-3ee520ab],.instance-record button[data-v-3ee520ab],.instance-record input[data-v-3ee520ab],.instance-record textarea[data-v-3ee520ab],.instance-record select[data-v-3ee520ab],.instance-record .btn[data-v-3ee520ab],.instance-record .form-control[data-v-3ee520ab],.instance-record .modal-title[data-v-3ee520ab],.instance-record .close-btn[data-v-3ee520ab],.instance-generator button[data-v-3ee520ab],.instance-generator input[data-v-3ee520ab],.instance-generator textarea[data-v-3ee520ab],.instance-generator select[data-v-3ee520ab],.instance-generator .btn[data-v-3ee520ab],.instance-generator .form-control[data-v-3ee520ab],.instance-generator .modal-title[data-v-3ee520ab],.instance-generator .close-btn[data-v-3ee520ab],.interaction-room button[data-v-3ee520ab],.interaction-room input[data-v-3ee520ab],.interaction-room textarea[data-v-3ee520ab],.interaction-room select[data-v-3ee520ab],.interaction-room .btn[data-v-3ee520ab],.interaction-room .form-control[data-v-3ee520ab],.interaction-room .modal-title[data-v-3ee520ab],.interaction-room .close-btn[data-v-3ee520ab],.dice-roller button[data-v-3ee520ab],.dice-roller input[data-v-3ee520ab],.dice-roller textarea[data-v-3ee520ab],.dice-roller select[data-v-3ee520ab],.dice-roller .btn[data-v-3ee520ab],.dice-roller .form-control[data-v-3ee520ab],.dice-roller .modal-title[data-v-3ee520ab],.dice-roller .close-btn[data-v-3ee520ab],.map-panel button[data-v-3ee520ab],.map-panel input[data-v-3ee520ab],.map-panel textarea[data-v-3ee520ab],.map-panel select[data-v-3ee520ab],.map-panel .btn[data-v-3ee520ab],.map-panel .form-control[data-v-3ee520ab],.map-panel .modal-title[data-v-3ee520ab],.map-panel .close-btn[data-v-3ee520ab],.plot-review button[data-v-3ee520ab],.plot-review input[data-v-3ee520ab],.plot-review textarea[data-v-3ee520ab],.plot-review select[data-v-3ee520ab],.plot-review .btn[data-v-3ee520ab],.plot-review .form-control[data-v-3ee520ab],.plot-review .modal-title[data-v-3ee520ab],.plot-review .close-btn[data-v-3ee520ab]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-3ee520ab],.modal-overlay h2[data-v-3ee520ab],.modal-overlay h3[data-v-3ee520ab],.modal-overlay .modal-title[data-v-3ee520ab],.dialogue-box h1[data-v-3ee520ab],.dialogue-box h2[data-v-3ee520ab],.dialogue-box h3[data-v-3ee520ab],.dialogue-box .modal-title[data-v-3ee520ab],.combat-panel h1[data-v-3ee520ab],.combat-panel h2[data-v-3ee520ab],.combat-panel h3[data-v-3ee520ab],.combat-panel .modal-title[data-v-3ee520ab],.character-panel h1[data-v-3ee520ab],.character-panel h2[data-v-3ee520ab],.character-panel h3[data-v-3ee520ab],.character-panel .modal-title[data-v-3ee520ab],.character-creator h1[data-v-3ee520ab],.character-creator h2[data-v-3ee520ab],.character-creator h3[data-v-3ee520ab],.character-creator .modal-title[data-v-3ee520ab],.instance-record h1[data-v-3ee520ab],.instance-record h2[data-v-3ee520ab],.instance-record h3[data-v-3ee520ab],.instance-record .modal-title[data-v-3ee520ab],.instance-generator h1[data-v-3ee520ab],.instance-generator h2[data-v-3ee520ab],.instance-generator h3[data-v-3ee520ab],.instance-generator .modal-title[data-v-3ee520ab],.interaction-room h1[data-v-3ee520ab],.interaction-room h2[data-v-3ee520ab],.interaction-room h3[data-v-3ee520ab],.interaction-room .modal-title[data-v-3ee520ab],.dice-roller h1[data-v-3ee520ab],.dice-roller h2[data-v-3ee520ab],.dice-roller h3[data-v-3ee520ab],.dice-roller .modal-title[data-v-3ee520ab],.map-panel h1[data-v-3ee520ab],.map-panel h2[data-v-3ee520ab],.map-panel h3[data-v-3ee520ab],.map-panel .modal-title[data-v-3ee520ab],.plot-review h1[data-v-3ee520ab],.plot-review h2[data-v-3ee520ab],.plot-review h3[data-v-3ee520ab],.plot-review .modal-title[data-v-3ee520ab]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-3ee520ab],.modal-overlay .form-group[data-v-3ee520ab],.dialogue-box .button-group[data-v-3ee520ab],.dialogue-box .form-group[data-v-3ee520ab],.combat-panel .button-group[data-v-3ee520ab],.combat-panel .form-group[data-v-3ee520ab],.character-panel .button-group[data-v-3ee520ab],.character-panel .form-group[data-v-3ee520ab],.character-creator .button-group[data-v-3ee520ab],.character-creator .form-group[data-v-3ee520ab],.instance-record .button-group[data-v-3ee520ab],.instance-record .form-group[data-v-3ee520ab],.instance-generator .button-group[data-v-3ee520ab],.instance-generator .form-group[data-v-3ee520ab],.interaction-room .button-group[data-v-3ee520ab],.interaction-room .form-group[data-v-3ee520ab],.dice-roller .button-group[data-v-3ee520ab],.dice-roller .form-group[data-v-3ee520ab],.map-panel .button-group[data-v-3ee520ab],.map-panel .form-group[data-v-3ee520ab],.plot-review .button-group[data-v-3ee520ab],.plot-review .form-group[data-v-3ee520ab]{gap:calc(16px*var(--modal-scale))}.plot-review[data-v-3ee520ab]{position:fixed;top:0;left:0;width:400px;height:100%;background:linear-gradient(135deg,rgba(20,20,30,0.98),rgba(30,20,40,0.98));border-right:2px solid #d4af37;box-shadow:0 8px 16px rgba(0,0,0,.5),4px 0 20px rgba(212,175,55,.3);display:flex;flex-direction:column;z-index:50;animation:slideInLeft-3ee520ab .3s ease-out}@media (max-width:767px){.plot-review[data-v-3ee520ab]{width:85%;max-width:320px;border-right-width:1px}}@keyframes slideInLeft-3ee520ab{from{transform:translateX(-100%);opacity:0}to{transform:translateX(0);opacity:1}}.plot-review-header[data-v-3ee520ab]{padding:24px;border-bottom:1px solid rgba(212,175,55,.3);display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,.3)}@media (max-width:767px){.plot-review-header[data-v-3ee520ab]{padding:16px}}.plot-review-controls[data-v-3ee520ab]{padding:16px;background:rgba(0,0,0,.2);border-bottom:1px solid rgba(212,175,55,.2);display:flex;flex-direction:column;gap:8px}@media (max-width:767px){.plot-review-controls[data-v-3ee520ab]{padding:8px}}.control-group[data-v-3ee520ab]{display:flex;align-items:center;gap:8px}.control-group.search-group[data-v-3ee520ab]{flex:1}.control-label[data-v-3ee520ab]{color:#d4af37;font-size:14px;white-space:nowrap;min-width:50px}@media (max-width:767px){.control-label[data-v-3ee520ab]{font-size:12px;min-width:40px}}.world-selector[data-v-3ee520ab],.instance-selector[data-v-3ee520ab]{flex:1;padding:4px 8px;background:rgba(20,20,20,.8);border:1px solid #d4af37;border-radius:4px;color:#f5f5f5;font-size:14px;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.world-selector[data-v-3ee520ab],.instance-selector[data-v-3ee520ab]{font-size:12px;padding:4px}}.world-selector[data-v-3ee520ab]:hover,.instance-selector[data-v-3ee520ab]:hover{border-color:#f4d03f;background:rgba(212,175,55,.1)}.world-selector[data-v-3ee520ab]:focus,.instance-selector[data-v-3ee520ab]:focus{outline:none;border-color:#f4d03f;box-shadow:0 0 0 2px rgba(212,175,55,.2)}.search-input[data-v-3ee520ab]{flex:1;padding:4px 8px;background:rgba(20,20,20,.8);border:1px solid #d4af37;border-radius:4px;color:#f5f5f5;font-size:14px;transition:all .15s ease}@media (max-width:767px){.search-input[data-v-3ee520ab]{font-size:12px;padding:4px}}.search-input[data-v-3ee520ab]:focus{outline:none;border-color:#f4d03f;box-shadow:0 0 0 2px rgba(212,175,55,.2)}.search-input[data-v-3ee520ab]::placeholder{color:#ccc}.search-btn[data-v-3ee520ab]{padding:4px 8px;background:rgba(20,20,20,.8);border:1px solid #d4af37;border-radius:4px;color:#d4af37;font-size:16px;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.search-btn[data-v-3ee520ab]{font-size:14px;padding:4px}}.search-btn[data-v-3ee520ab]:hover{background:rgba(212,175,55,.2);border-color:#f4d03f;transform:scale(1.05)}.search-btn[data-v-3ee520ab]:active{transform:scale(0.95)}.ai-review-btn[data-v-3ee520ab]{width:100%;padding:8px;background:linear-gradient(135deg,rgba(138,43,226,0.3),rgba(75,0,130,0.3));border:1px solid rgba(138,43,226,.5);border-radius:4px;color:#d4af37;font-size:14px;font-weight:bold;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.ai-review-btn[data-v-3ee520ab]{font-size:12px;padding:4px}}.ai-review-btn[data-v-3ee520ab]:hover:not(:disabled){background:linear-gradient(135deg,rgba(138,43,226,0.5),rgba(75,0,130,0.5));border-color:rgba(138,43,226,.8);transform:translateY(-2px);box-shadow:0 4px 8px rgba(138,43,226,.3)}.ai-review-btn[data-v-3ee520ab]:active:not(:disabled){transform:translateY(0)}.ai-review-btn[data-v-3ee520ab]:disabled{opacity:.5;cursor:not-allowed}.ai-review-section[data-v-3ee520ab]{margin-bottom:16px;padding:16px;background:linear-gradient(135deg,rgba(138,43,226,0.1),rgba(75,0,130,0.1));border:1px solid rgba(138,43,226,.3);border-radius:8px}@media (max-width:767px){.ai-review-section[data-v-3ee520ab]{padding:8px;margin-bottom:8px}}.ai-review-header[data-v-3ee520ab]{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;padding-bottom:8px;border-bottom:1px solid rgba(138,43,226,.3)}.ai-review-header h3[data-v-3ee520ab]{margin:0;color:#d4af37;font-size:18px;text-shadow:0 0 10px rgba(212,175,55,.5)}@media (max-width:767px){.ai-review-header h3[data-v-3ee520ab]{font-size:16px}}.close-review-btn[data-v-3ee520ab]{width:24px;height:24px;padding:0;background:rgba(139,0,0,.3);border:1px solid rgba(220,20,60,.5);border-radius:4px;color:#f44336;font-size:16px;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.close-review-btn[data-v-3ee520ab]{width:20px;height:20px;font-size:14px}}.close-review-btn[data-v-3ee520ab]:hover{background:rgba(220,20,60,.3);border-color:#f44336;transform:scale(1.1)}.ai-review-content[data-v-3ee520ab]{color:#f5f5f5;font-size:16px;line-height:1.8;white-space:pre-wrap;word-wrap:break-word}@media (max-width:767px){.ai-review-content[data-v-3ee520ab]{font-size:14px;line-height:1.6}}.plot-review-title[data-v-3ee520ab]{margin:0;font-size:20px;color:#d4af37;text-shadow:0 0 10px rgba(212,175,55,.5);font-family:"Georgia","Times New Roman",serif}@media (max-width:767px){.plot-review-title[data-v-3ee520ab]{font-size:18px}}.close-btn[data-v-3ee520ab]{width:32px;height:32px;padding:0;background:rgba(139,0,0,.3);border:1px solid rgba(220,20,60,.5);border-radius:4px;color:#f44336;font-size:18px;cursor:pointer;transition:all .15s ease;flex-shrink:0}@media (max-width:767px){.close-btn[data-v-3ee520ab]{width:28px;height:28px;font-size:16px}}.close-btn[data-v-3ee520ab]:hover{background:rgba(220,20,60,.3);border-color:#f44336;transform:scale(1.1)}.plot-review-content[data-v-3ee520ab]{flex:1;overflow-y:auto;padding:16px}@media (max-width:767px){.plot-review-content[data-v-3ee520ab]{padding:8px}}.plot-review-content[data-v-3ee520ab]::-webkit-scrollbar{width:8px}@media (max-width:767px){.plot-review-content[data-v-3ee520ab]::-webkit-scrollbar{width:4px}}.plot-review-content[data-v-3ee520ab]::-webkit-scrollbar-track{background:rgba(0,0,0,.3)}.plot-review-content[data-v-3ee520ab]::-webkit-scrollbar-thumb{background:rgba(212,175,55,.3);border-radius:4px}.plot-review-content[data-v-3ee520ab]::-webkit-scrollbar-thumb:hover{background:rgba(212,175,55,.5)}.loading-state[data-v-3ee520ab],.empty-state[data-v-3ee520ab]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:#ccc;font-size:18px;gap:16px}.loading-state p[data-v-3ee520ab]:first-child,.empty-state p[data-v-3ee520ab]:first-child{font-size:48px;margin:0}.loading-state p[data-v-3ee520ab]:last-child,.empty-state p[data-v-3ee520ab]:last-child{margin:0}.loading-spinner[data-v-3ee520ab]{width:40px;height:40px;border:3px solid rgba(212,175,55,.2);border-top-color:#d4af37;border-radius:50%;animation:spin-3ee520ab 1s linear infinite}@keyframes spin-3ee520ab{to{transform:rotate(360deg)}}.messages-list[data-v-3ee520ab]{display:flex;flex-direction:column;gap:16px}@media (max-width:767px){.messages-list[data-v-3ee520ab]{gap:8px}}.message-item[data-v-3ee520ab]{background:rgba(0,0,0,.4);border:1px solid rgba(212,175,55,.2);border-radius:8px;padding:16px;transition:all .15s ease}@media (max-width:767px){.message-item[data-v-3ee520ab]{padding:8px}}.message-item[data-v-3ee520ab]:hover{border-color:rgba(212,175,55,.4);background:rgba(0,0,0,.5);box-shadow:0 2px 8px rgba(212,175,55,.2)}.message-item.is-user[data-v-3ee520ab]{border-left:3px solid #2196f3}.message-item.is-system[data-v-3ee520ab]{border-left:3px solid #ff9800;background:rgba(255,193,7,.05)}.message-item.is-highlighted[data-v-3ee520ab]{border-color:rgba(138,43,226,.5);background:rgba(138,43,226,.1);box-shadow:0 0 10px rgba(138,43,226,.3)}.message-header[data-v-3ee520ab]{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;padding-bottom:4px;border-bottom:1px solid rgba(212,175,55,.2)}.message-name[data-v-3ee520ab]{font-weight:bold;color:#d4af37;font-size:16px}@media (max-width:767px){.message-name[data-v-3ee520ab]{font-size:14px}}.message-index[data-v-3ee520ab]{font-size:14px;color:#ccc;font-family:monospace}@media (max-width:767px){.message-index[data-v-3ee520ab]{font-size:12px}}.message-content[data-v-3ee520ab]{color:#f5f5f5;font-size:16px;line-height:1.6;word-wrap:break-word;white-space:pre-wrap;cursor:pointer;transition:all .15s ease;position:relative}@media (max-width:767px){.message-content[data-v-3ee520ab]{font-size:14px;line-height:1.5}}.message-content.is-collapsed[data-v-3ee520ab]{display:-webkit-box;-webkit-line-clamp:3;line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.message-content.is-collapsed[data-v-3ee520ab]::after{content:"...";position:absolute;bottom:0;right:0;padding-left:20px;background:linear-gradient(to right,transparent,rgba(0,0,0,0.4) 20%)}.message-content[data-v-3ee520ab]:hover{color:#d4af37}.plot-review-footer[data-v-3ee520ab]{padding:16px;border-top:1px solid rgba(212,175,55,.3);display:flex;gap:8px;background:rgba(0,0,0,.3)}@media (max-width:767px){.plot-review-footer[data-v-3ee520ab]{padding:8px;gap:4px}}.action-btn[data-v-3ee520ab]{flex:1;padding:8px 16px;background:rgba(20,20,20,.8);border:1px solid #d4af37;border-radius:4px;color:#d4af37;font-size:14px;cursor:pointer;transition:all .15s ease;display:flex;flex-direction:column;align-items:center;gap:4px}@media (max-width:767px){.action-btn[data-v-3ee520ab]{padding:4px 8px;font-size:12px;gap:2px}}.action-btn span[data-v-3ee520ab]:first-child{font-size:18px}@media (max-width:767px){.action-btn span[data-v-3ee520ab]:first-child{font-size:16px}}.action-btn[data-v-3ee520ab]:hover{background:rgba(212,175,55,.2);border-color:#f4d03f;transform:translateY(-2px);box-shadow:0 4px 8px rgba(212,175,55,.3)}.action-btn[data-v-3ee520ab]:active{transform:translateY(0)}
[data-v-6a85f072]{box-sizing:border-box;margin:0;padding:0}body[data-v-6a85f072]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-6a85f072]::-webkit-scrollbar{width:8px;height:8px}[data-v-6a85f072]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-6a85f072]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-6a85f072]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-6a85f072]{color:#d4af37}.text-muted[data-v-6a85f072]{color:#888}.bg-overlay[data-v-6a85f072]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-6a85f072]{border:2px solid #d4af37}.shadow-gold[data-v-6a85f072]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-6a85f072]{z-index:50 !important}.dialogue-box[data-v-6a85f072],.combat-panel[data-v-6a85f072],.character-panel[data-v-6a85f072],.character-creator[data-v-6a85f072],.instance-record[data-v-6a85f072],.instance-generator[data-v-6a85f072],.interaction-room[data-v-6a85f072],.dice-roller[data-v-6a85f072],.map-panel[data-v-6a85f072],.plot-review[data-v-6a85f072]{z-index:50 !important}[data-v-6a85f072]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-6a85f072]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-6a85f072]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-6a85f072],.dialogue-box[data-v-6a85f072],.combat-panel[data-v-6a85f072],.character-panel[data-v-6a85f072],.character-creator[data-v-6a85f072],.instance-record[data-v-6a85f072],.instance-generator[data-v-6a85f072],.interaction-room[data-v-6a85f072],.dice-roller[data-v-6a85f072],.map-panel[data-v-6a85f072],.plot-review[data-v-6a85f072]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-6a85f072],.dialogue-box[data-v-6a85f072],.combat-panel[data-v-6a85f072],.character-panel[data-v-6a85f072],.character-creator[data-v-6a85f072],.instance-record[data-v-6a85f072],.instance-generator[data-v-6a85f072],.interaction-room[data-v-6a85f072],.dice-roller[data-v-6a85f072],.map-panel[data-v-6a85f072],.plot-review[data-v-6a85f072]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-6a85f072],.dialogue-box[data-v-6a85f072],.combat-panel[data-v-6a85f072],.character-panel[data-v-6a85f072],.character-creator[data-v-6a85f072],.instance-record[data-v-6a85f072],.instance-generator[data-v-6a85f072],.interaction-room[data-v-6a85f072],.dice-roller[data-v-6a85f072],.map-panel[data-v-6a85f072],.plot-review[data-v-6a85f072]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-6a85f072],.modal-overlay input[data-v-6a85f072],.modal-overlay textarea[data-v-6a85f072],.modal-overlay select[data-v-6a85f072],.modal-overlay .btn[data-v-6a85f072],.modal-overlay .form-control[data-v-6a85f072],.modal-overlay .modal-title[data-v-6a85f072],.modal-overlay .close-btn[data-v-6a85f072],.dialogue-box button[data-v-6a85f072],.dialogue-box input[data-v-6a85f072],.dialogue-box textarea[data-v-6a85f072],.dialogue-box select[data-v-6a85f072],.dialogue-box .btn[data-v-6a85f072],.dialogue-box .form-control[data-v-6a85f072],.dialogue-box .modal-title[data-v-6a85f072],.dialogue-box .close-btn[data-v-6a85f072],.combat-panel button[data-v-6a85f072],.combat-panel input[data-v-6a85f072],.combat-panel textarea[data-v-6a85f072],.combat-panel select[data-v-6a85f072],.combat-panel .btn[data-v-6a85f072],.combat-panel .form-control[data-v-6a85f072],.combat-panel .modal-title[data-v-6a85f072],.combat-panel .close-btn[data-v-6a85f072],.character-panel button[data-v-6a85f072],.character-panel input[data-v-6a85f072],.character-panel textarea[data-v-6a85f072],.character-panel select[data-v-6a85f072],.character-panel .btn[data-v-6a85f072],.character-panel .form-control[data-v-6a85f072],.character-panel .modal-title[data-v-6a85f072],.character-panel .close-btn[data-v-6a85f072],.character-creator button[data-v-6a85f072],.character-creator input[data-v-6a85f072],.character-creator textarea[data-v-6a85f072],.character-creator select[data-v-6a85f072],.character-creator .btn[data-v-6a85f072],.character-creator .form-control[data-v-6a85f072],.character-creator .modal-title[data-v-6a85f072],.character-creator .close-btn[data-v-6a85f072],.instance-record button[data-v-6a85f072],.instance-record input[data-v-6a85f072],.instance-record textarea[data-v-6a85f072],.instance-record select[data-v-6a85f072],.instance-record .btn[data-v-6a85f072],.instance-record .form-control[data-v-6a85f072],.instance-record .modal-title[data-v-6a85f072],.instance-record .close-btn[data-v-6a85f072],.instance-generator button[data-v-6a85f072],.instance-generator input[data-v-6a85f072],.instance-generator textarea[data-v-6a85f072],.instance-generator select[data-v-6a85f072],.instance-generator .btn[data-v-6a85f072],.instance-generator .form-control[data-v-6a85f072],.instance-generator .modal-title[data-v-6a85f072],.instance-generator .close-btn[data-v-6a85f072],.interaction-room button[data-v-6a85f072],.interaction-room input[data-v-6a85f072],.interaction-room textarea[data-v-6a85f072],.interaction-room select[data-v-6a85f072],.interaction-room .btn[data-v-6a85f072],.interaction-room .form-control[data-v-6a85f072],.interaction-room .modal-title[data-v-6a85f072],.interaction-room .close-btn[data-v-6a85f072],.dice-roller button[data-v-6a85f072],.dice-roller input[data-v-6a85f072],.dice-roller textarea[data-v-6a85f072],.dice-roller select[data-v-6a85f072],.dice-roller .btn[data-v-6a85f072],.dice-roller .form-control[data-v-6a85f072],.dice-roller .modal-title[data-v-6a85f072],.dice-roller .close-btn[data-v-6a85f072],.map-panel button[data-v-6a85f072],.map-panel input[data-v-6a85f072],.map-panel textarea[data-v-6a85f072],.map-panel select[data-v-6a85f072],.map-panel .btn[data-v-6a85f072],.map-panel .form-control[data-v-6a85f072],.map-panel .modal-title[data-v-6a85f072],.map-panel .close-btn[data-v-6a85f072],.plot-review button[data-v-6a85f072],.plot-review input[data-v-6a85f072],.plot-review textarea[data-v-6a85f072],.plot-review select[data-v-6a85f072],.plot-review .btn[data-v-6a85f072],.plot-review .form-control[data-v-6a85f072],.plot-review .modal-title[data-v-6a85f072],.plot-review .close-btn[data-v-6a85f072]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-6a85f072],.modal-overlay h2[data-v-6a85f072],.modal-overlay h3[data-v-6a85f072],.modal-overlay .modal-title[data-v-6a85f072],.dialogue-box h1[data-v-6a85f072],.dialogue-box h2[data-v-6a85f072],.dialogue-box h3[data-v-6a85f072],.dialogue-box .modal-title[data-v-6a85f072],.combat-panel h1[data-v-6a85f072],.combat-panel h2[data-v-6a85f072],.combat-panel h3[data-v-6a85f072],.combat-panel .modal-title[data-v-6a85f072],.character-panel h1[data-v-6a85f072],.character-panel h2[data-v-6a85f072],.character-panel h3[data-v-6a85f072],.character-panel .modal-title[data-v-6a85f072],.character-creator h1[data-v-6a85f072],.character-creator h2[data-v-6a85f072],.character-creator h3[data-v-6a85f072],.character-creator .modal-title[data-v-6a85f072],.instance-record h1[data-v-6a85f072],.instance-record h2[data-v-6a85f072],.instance-record h3[data-v-6a85f072],.instance-record .modal-title[data-v-6a85f072],.instance-generator h1[data-v-6a85f072],.instance-generator h2[data-v-6a85f072],.instance-generator h3[data-v-6a85f072],.instance-generator .modal-title[data-v-6a85f072],.interaction-room h1[data-v-6a85f072],.interaction-room h2[data-v-6a85f072],.interaction-room h3[data-v-6a85f072],.interaction-room .modal-title[data-v-6a85f072],.dice-roller h1[data-v-6a85f072],.dice-roller h2[data-v-6a85f072],.dice-roller h3[data-v-6a85f072],.dice-roller .modal-title[data-v-6a85f072],.map-panel h1[data-v-6a85f072],.map-panel h2[data-v-6a85f072],.map-panel h3[data-v-6a85f072],.map-panel .modal-title[data-v-6a85f072],.plot-review h1[data-v-6a85f072],.plot-review h2[data-v-6a85f072],.plot-review h3[data-v-6a85f072],.plot-review .modal-title[data-v-6a85f072]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-6a85f072],.modal-overlay .form-group[data-v-6a85f072],.dialogue-box .button-group[data-v-6a85f072],.dialogue-box .form-group[data-v-6a85f072],.combat-panel .button-group[data-v-6a85f072],.combat-panel .form-group[data-v-6a85f072],.character-panel .button-group[data-v-6a85f072],.character-panel .form-group[data-v-6a85f072],.character-creator .button-group[data-v-6a85f072],.character-creator .form-group[data-v-6a85f072],.instance-record .button-group[data-v-6a85f072],.instance-record .form-group[data-v-6a85f072],.instance-generator .button-group[data-v-6a85f072],.instance-generator .form-group[data-v-6a85f072],.interaction-room .button-group[data-v-6a85f072],.interaction-room .form-group[data-v-6a85f072],.dice-roller .button-group[data-v-6a85f072],.dice-roller .form-group[data-v-6a85f072],.map-panel .button-group[data-v-6a85f072],.map-panel .form-group[data-v-6a85f072],.plot-review .button-group[data-v-6a85f072],.plot-review .form-group[data-v-6a85f072]{gap:calc(16px*var(--modal-scale))}.instance-record[data-v-6a85f072]{width:100%;max-width:800px;max-height:90vh;overflow-y:auto;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:32px;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.instance-record[data-v-6a85f072]{max-width:95vw;max-height:95vh;padding:16px;border-width:1px}}@media (max-width:480px){.instance-record[data-v-6a85f072]{max-width:98vw;padding:8px}}.instance-record[data-v-6a85f072]{position:relative;width:100%;max-width:700px;max-height:80vh;display:flex;flex-direction:column}.floating-exit-btn[data-v-6a85f072]{position:absolute;top:16px;right:16px;width:32px;height:32px;padding:0;background:rgba(0,0,0,.7);border:1px solid #d4af37;border-radius:4px;color:#d4af37;font-size:18px;cursor:pointer;transition:all .15s ease;z-index:10}@media (max-width:767px){.floating-exit-btn[data-v-6a85f072]{width:28px;height:28px;font-size:16px;top:8px;right:8px}}.floating-exit-btn[data-v-6a85f072]:hover{background:rgba(244,67,54,.3);border-color:#f44336;color:#f44336;transform:scale(1.1)}.floating-exit-btn[data-v-6a85f072]{background:rgba(244,67,54,.9);border-color:#f44336;color:#fff}.floating-exit-btn[data-v-6a85f072]:hover{background:#f44336;box-shadow:0 0 20px rgba(244,67,54,.6)}.instance-list-view[data-v-6a85f072]{display:flex;flex-direction:column;width:100%;padding:24px;overflow-y:auto}.record-header[data-v-6a85f072]{text-align:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #333}.record-title[data-v-6a85f072]{font-size:24px;font-weight:700;color:#d4af37;margin-bottom:4px;text-shadow:0 0 10px rgba(212,175,55,.5)}.record-subtitle[data-v-6a85f072]{font-size:14px;color:#ccc}.empty-state[data-v-6a85f072]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;text-align:center}.empty-text[data-v-6a85f072]{font-size:18px;color:#ccc;margin-bottom:8px}.empty-hint[data-v-6a85f072]{font-size:14px;color:#888}.instance-list[data-v-6a85f072]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}.instance-card[data-v-6a85f072]{background:rgba(0,0,0,.4);border:1px solid #333;border-radius:8px;padding:16px;cursor:pointer;transition:all .15s ease}.instance-card[data-v-6a85f072]:hover{border-color:#d4af37;transform:translateY(-2px);box-shadow:0 0 20px rgba(212,175,55,.3)}.instance-card.active[data-v-6a85f072]{border-color:#d4af37;background:rgba(212,175,55,.1)}.instance-card-header[data-v-6a85f072]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.instance-name[data-v-6a85f072]{font-size:18px;font-weight:700;color:#d4af37}.draft-badge[data-v-6a85f072],.active-badge[data-v-6a85f072],.completed-badge[data-v-6a85f072]{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500}.draft-badge[data-v-6a85f072]{background:rgba(255,193,7,.2);color:#ffc107;border:1px solid #ffc107}.active-badge[data-v-6a85f072]{background:rgba(76,175,80,.2);color:#4caf50;border:1px solid #4caf50}.completed-badge[data-v-6a85f072]{background:rgba(158,158,158,.2);color:#9e9e9e;border:1px solid #9e9e9e}.instance-info[data-v-6a85f072]{display:flex;gap:16px;margin-bottom:8px}.info-item[data-v-6a85f072]{font-size:14px}.info-label[data-v-6a85f072]{color:#ccc;margin-right:4px}.info-value[data-v-6a85f072]{color:#d4af37;font-weight:500}.instance-stats[data-v-6a85f072]{display:flex;gap:16px;padding-top:8px;border-top:1px solid #333}.stat-item[data-v-6a85f072]{font-size:12px;color:#888}.instance-detail-view[data-v-6a85f072]{display:flex;flex-direction:column;width:100%;overflow-y:auto}.detail-header[data-v-6a85f072]{display:flex;align-items:center;gap:16px;padding:24px;background:rgba(0,0,0,.5);border-bottom:1px solid #333}.btn-back[data-v-6a85f072]{display:flex;align-items:center;gap:4px;padding:8px 16px;background:hsla(0,0%,100%,.1);border:1px solid #333;border-radius:4px;color:#ccc;font-size:14px;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.btn-back[data-v-6a85f072]{padding:4px 8px;font-size:12px;min-height:32px}}.btn-back[data-v-6a85f072]:hover{background:hsla(0,0%,100%,.15);color:#f5f5f5;border-color:#d4af37}.back-icon[data-v-6a85f072]{font-size:18px}.detail-title[data-v-6a85f072]{font-size:20px;font-weight:700;color:#d4af37;text-shadow:0 0 10px rgba(212,175,55,.5)}.detail-content[data-v-6a85f072]{padding:24px;display:flex;flex-direction:column;gap:24px}.detail-section[data-v-6a85f072]{background:rgba(0,0,0,.3);border:1px solid #333;border-radius:8px;padding:16px}.section-header[data-v-6a85f072]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.section-title[data-v-6a85f072]{font-size:18px;font-weight:700;color:#d4af37;margin-bottom:16px}.info-grid[data-v-6a85f072]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}.info-row[data-v-6a85f072]{display:flex;gap:8px}.world-setting[data-v-6a85f072]{font-size:14px;color:#f5f5f5;line-height:1.6;white-space:pre-wrap}.btn-add[data-v-6a85f072]{display:flex;align-items:center;gap:4px;padding:8px 16px;background:rgba(212,175,55,.2);border:1px solid #d4af37;border-radius:4px;color:#d4af37;font-size:14px;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.btn-add[data-v-6a85f072]{padding:4px 8px;font-size:12px;min-height:32px}}.btn-add[data-v-6a85f072]:hover{background:rgba(212,175,55,.3);transform:translateY(-1px)}.add-icon[data-v-6a85f072]{font-size:18px;font-weight:700}.empty-characters[data-v-6a85f072],.empty-events[data-v-6a85f072]{padding:24px;text-align:center;color:#888}.characters-list[data-v-6a85f072]{display:flex;flex-direction:column;gap:8px}.character-item[data-v-6a85f072]{background:rgba(0,0,0,.3);border:1px solid #333;border-radius:4px;overflow:hidden;transition:border-color .15s ease}.character-item.important[data-v-6a85f072]{border-color:#d4af37}.character-header[data-v-6a85f072]{display:flex;justify-content:space-between;align-items:center;padding:8px 16px;cursor:pointer;transition:background .15s ease}.character-header[data-v-6a85f072]:hover{background:hsla(0,0%,100%,.05)}.character-basic[data-v-6a85f072]{display:flex;align-items:center;gap:8px}.character-name[data-v-6a85f072]{font-size:16px;font-weight:500;color:#f5f5f5}.important-badge[data-v-6a85f072],.importance-badge[data-v-6a85f072]{padding:4px 8px;background:rgba(212,175,55,.2);border:1px solid #d4af37;border-radius:4px;font-size:12px;color:#d4af37}.importance-badge[data-v-6a85f072]{font-weight:700;letter-spacing:2px}.expand-icon[data-v-6a85f072]{font-size:12px;color:#888}.character-details[data-v-6a85f072]{padding:16px;border-top:1px solid #333;background:rgba(0,0,0,.2)}.character-info[data-v-6a85f072]{margin-bottom:16px}.character-info p[data-v-6a85f072]{font-size:14px;color:#ccc;margin-bottom:4px;line-height:1.5}.char-occupation[data-v-6a85f072]{color:#d4af37;font-weight:500}.character-actions[data-v-6a85f072]{display:flex;gap:8px}.btn-toggle-important[data-v-6a85f072]{padding:4px 16px;background:rgba(212,175,55,.2);border:1px solid #d4af37;border-radius:4px;color:#d4af37;font-size:12px;cursor:pointer;transition:all .15s ease}.btn-toggle-important[data-v-6a85f072]:hover{background:rgba(212,175,55,.3)}.events-list[data-v-6a85f072]{display:flex;flex-direction:column;gap:16px}.event-item[data-v-6a85f072]{padding:16px;background:rgba(0,0,0,.3);border-left:3px solid #d4af37;border-radius:4px}.event-header[data-v-6a85f072]{display:flex;gap:16px;margin-bottom:4px}.event-time[data-v-6a85f072]{font-size:12px;color:#888}.event-location[data-v-6a85f072]{font-size:12px;color:#d4af37;padding:2px 4px;background:rgba(212,175,55,.1);border-radius:4px}.event-summary[data-v-6a85f072]{font-size:14px;color:#f5f5f5;margin-bottom:8px;line-height:1.5}.event-characters[data-v-6a85f072]{display:flex;flex-wrap:wrap;gap:4px;align-items:center}.involved-label[data-v-6a85f072]{font-size:12px;color:#888}.involved-character[data-v-6a85f072]{font-size:12px;color:#d4af37;padding:2px 4px;background:rgba(212,175,55,.1);border-radius:4px}.ending-text[data-v-6a85f072]{font-size:16px;color:#f5f5f5;line-height:1.6;padding:16px;background:rgba(212,175,55,.1);border-radius:4px;border-left:3px solid #d4af37}.status-badge[data-v-6a85f072]{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500}.status-badge.status-draft[data-v-6a85f072]{background:rgba(255,193,7,.2);color:#ffc107;border:1px solid #ffc107}.status-badge.status-active[data-v-6a85f072]{background:rgba(76,175,80,.2);color:#4caf50;border:1px solid #4caf50}.status-badge.status-completed[data-v-6a85f072]{background:rgba(158,158,158,.2);color:#9e9e9e;border:1px solid #9e9e9e}.mementos-list[data-v-6a85f072]{display:flex;flex-direction:column;gap:8px}.memento-item[data-v-6a85f072]{padding:16px;background:rgba(0,0,0,.3);border-left:3px solid #d4af37;border-radius:4px}.memento-header[data-v-6a85f072]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.memento-name[data-v-6a85f072]{font-size:16px;font-weight:700;color:#d4af37}.memento-time[data-v-6a85f072]{font-size:12px;color:#888}.memento-description[data-v-6a85f072]{font-size:14px;color:#ccc;line-height:1.5;margin:0}.action-section[data-v-6a85f072]{background:rgba(0,0,0,.5);border:2px solid #d4af37}.action-buttons[data-v-6a85f072]{display:flex;gap:16px;flex-wrap:wrap}@media (max-width:767px){.action-buttons[data-v-6a85f072]{flex-direction:column;gap:8px}}.action-button[data-v-6a85f072]{flex:1;min-width:150px;padding:16px 24px;border-radius:8px;font-size:16px;font-weight:700;cursor:pointer;transition:all .15s ease;display:flex;align-items:center;justify-content:center;gap:8px}@media (max-width:767px){.action-button[data-v-6a85f072]{min-width:unset;padding:8px 16px;font-size:14px}}.action-button .button-icon[data-v-6a85f072]{font-size:20px}@media (max-width:767px){.action-button .button-icon[data-v-6a85f072]{font-size:18px}}.action-button[data-v-6a85f072]:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.3)}.action-button[data-v-6a85f072]:active{transform:translateY(0)}.plot-review-button[data-v-6a85f072]{background:linear-gradient(135deg,rgba(138,43,226,0.3),rgba(75,0,130,0.3));border:2px solid rgba(138,43,226,.5);color:#d4af37}.plot-review-button[data-v-6a85f072]:hover{background:linear-gradient(135deg,rgba(138,43,226,0.5),rgba(75,0,130,0.5));border-color:rgba(138,43,226,.8);box-shadow:0 4px 12px rgba(138,43,226,.4)}.end-instance-button[data-v-6a85f072]{background:linear-gradient(135deg,rgba(244,67,54,0.3),rgba(139,0,0,0.3));border:2px solid rgba(244,67,54,.5);color:#fff}.end-instance-button[data-v-6a85f072]:hover{background:linear-gradient(135deg,rgba(244,67,54,0.5),rgba(139,0,0,0.5));border-color:rgba(244,67,54,.8);box-shadow:0 4px 12px rgba(244,67,54,.4)}.close-instance-button[data-v-6a85f072]{background:linear-gradient(135deg,rgba(33,150,243,0.3),rgba(13,71,161,0.3));border:2px solid rgba(33,150,243,.5);color:#fff}.close-instance-button[data-v-6a85f072]:hover{background:linear-gradient(135deg,rgba(33,150,243,0.5),rgba(13,71,161,0.5));border-color:rgba(33,150,243,.8);box-shadow:0 4px 12px rgba(33,150,243,.4)}.modal-overlay[data-v-6a85f072]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[data-v-6a85f072]{max-width:90%;max-height:90%;overflow:auto}.plot-review-modal[data-v-6a85f072]{width:90%;max-width:500px;height:85vh;max-height:800px;border-radius:12px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.6)}@media (max-width:767px){.plot-review-modal[data-v-6a85f072]{width:95%;height:90vh}}
[data-v-6284e47b]{box-sizing:border-box;margin:0;padding:0}body[data-v-6284e47b]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-6284e47b]::-webkit-scrollbar{width:8px;height:8px}[data-v-6284e47b]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-6284e47b]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-6284e47b]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-6284e47b]{color:#d4af37}.text-muted[data-v-6284e47b]{color:#888}.bg-overlay[data-v-6284e47b]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-6284e47b]{border:2px solid #d4af37}.shadow-gold[data-v-6284e47b]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-6284e47b]{z-index:50 !important}.dialogue-box[data-v-6284e47b],.combat-panel[data-v-6284e47b],.character-panel[data-v-6284e47b],.character-creator[data-v-6284e47b],.instance-record[data-v-6284e47b],.instance-generator[data-v-6284e47b],.interaction-room[data-v-6284e47b],.dice-roller[data-v-6284e47b],.map-panel[data-v-6284e47b],.plot-review[data-v-6284e47b]{z-index:50 !important}[data-v-6284e47b]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-6284e47b]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-6284e47b]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-6284e47b],.dialogue-box[data-v-6284e47b],.combat-panel[data-v-6284e47b],.character-panel[data-v-6284e47b],.character-creator[data-v-6284e47b],.instance-record[data-v-6284e47b],.instance-generator[data-v-6284e47b],.interaction-room[data-v-6284e47b],.dice-roller[data-v-6284e47b],.map-panel[data-v-6284e47b],.plot-review[data-v-6284e47b]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-6284e47b],.dialogue-box[data-v-6284e47b],.combat-panel[data-v-6284e47b],.character-panel[data-v-6284e47b],.character-creator[data-v-6284e47b],.instance-record[data-v-6284e47b],.instance-generator[data-v-6284e47b],.interaction-room[data-v-6284e47b],.dice-roller[data-v-6284e47b],.map-panel[data-v-6284e47b],.plot-review[data-v-6284e47b]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-6284e47b],.dialogue-box[data-v-6284e47b],.combat-panel[data-v-6284e47b],.character-panel[data-v-6284e47b],.character-creator[data-v-6284e47b],.instance-record[data-v-6284e47b],.instance-generator[data-v-6284e47b],.interaction-room[data-v-6284e47b],.dice-roller[data-v-6284e47b],.map-panel[data-v-6284e47b],.plot-review[data-v-6284e47b]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-6284e47b],.modal-overlay input[data-v-6284e47b],.modal-overlay textarea[data-v-6284e47b],.modal-overlay select[data-v-6284e47b],.modal-overlay .btn[data-v-6284e47b],.modal-overlay .form-control[data-v-6284e47b],.modal-overlay .modal-title[data-v-6284e47b],.modal-overlay .close-btn[data-v-6284e47b],.dialogue-box button[data-v-6284e47b],.dialogue-box input[data-v-6284e47b],.dialogue-box textarea[data-v-6284e47b],.dialogue-box select[data-v-6284e47b],.dialogue-box .btn[data-v-6284e47b],.dialogue-box .form-control[data-v-6284e47b],.dialogue-box .modal-title[data-v-6284e47b],.dialogue-box .close-btn[data-v-6284e47b],.combat-panel button[data-v-6284e47b],.combat-panel input[data-v-6284e47b],.combat-panel textarea[data-v-6284e47b],.combat-panel select[data-v-6284e47b],.combat-panel .btn[data-v-6284e47b],.combat-panel .form-control[data-v-6284e47b],.combat-panel .modal-title[data-v-6284e47b],.combat-panel .close-btn[data-v-6284e47b],.character-panel button[data-v-6284e47b],.character-panel input[data-v-6284e47b],.character-panel textarea[data-v-6284e47b],.character-panel select[data-v-6284e47b],.character-panel .btn[data-v-6284e47b],.character-panel .form-control[data-v-6284e47b],.character-panel .modal-title[data-v-6284e47b],.character-panel .close-btn[data-v-6284e47b],.character-creator button[data-v-6284e47b],.character-creator input[data-v-6284e47b],.character-creator textarea[data-v-6284e47b],.character-creator select[data-v-6284e47b],.character-creator .btn[data-v-6284e47b],.character-creator .form-control[data-v-6284e47b],.character-creator .modal-title[data-v-6284e47b],.character-creator .close-btn[data-v-6284e47b],.instance-record button[data-v-6284e47b],.instance-record input[data-v-6284e47b],.instance-record textarea[data-v-6284e47b],.instance-record select[data-v-6284e47b],.instance-record .btn[data-v-6284e47b],.instance-record .form-control[data-v-6284e47b],.instance-record .modal-title[data-v-6284e47b],.instance-record .close-btn[data-v-6284e47b],.instance-generator button[data-v-6284e47b],.instance-generator input[data-v-6284e47b],.instance-generator textarea[data-v-6284e47b],.instance-generator select[data-v-6284e47b],.instance-generator .btn[data-v-6284e47b],.instance-generator .form-control[data-v-6284e47b],.instance-generator .modal-title[data-v-6284e47b],.instance-generator .close-btn[data-v-6284e47b],.interaction-room button[data-v-6284e47b],.interaction-room input[data-v-6284e47b],.interaction-room textarea[data-v-6284e47b],.interaction-room select[data-v-6284e47b],.interaction-room .btn[data-v-6284e47b],.interaction-room .form-control[data-v-6284e47b],.interaction-room .modal-title[data-v-6284e47b],.interaction-room .close-btn[data-v-6284e47b],.dice-roller button[data-v-6284e47b],.dice-roller input[data-v-6284e47b],.dice-roller textarea[data-v-6284e47b],.dice-roller select[data-v-6284e47b],.dice-roller .btn[data-v-6284e47b],.dice-roller .form-control[data-v-6284e47b],.dice-roller .modal-title[data-v-6284e47b],.dice-roller .close-btn[data-v-6284e47b],.map-panel button[data-v-6284e47b],.map-panel input[data-v-6284e47b],.map-panel textarea[data-v-6284e47b],.map-panel select[data-v-6284e47b],.map-panel .btn[data-v-6284e47b],.map-panel .form-control[data-v-6284e47b],.map-panel .modal-title[data-v-6284e47b],.map-panel .close-btn[data-v-6284e47b],.plot-review button[data-v-6284e47b],.plot-review input[data-v-6284e47b],.plot-review textarea[data-v-6284e47b],.plot-review select[data-v-6284e47b],.plot-review .btn[data-v-6284e47b],.plot-review .form-control[data-v-6284e47b],.plot-review .modal-title[data-v-6284e47b],.plot-review .close-btn[data-v-6284e47b]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-6284e47b],.modal-overlay h2[data-v-6284e47b],.modal-overlay h3[data-v-6284e47b],.modal-overlay .modal-title[data-v-6284e47b],.dialogue-box h1[data-v-6284e47b],.dialogue-box h2[data-v-6284e47b],.dialogue-box h3[data-v-6284e47b],.dialogue-box .modal-title[data-v-6284e47b],.combat-panel h1[data-v-6284e47b],.combat-panel h2[data-v-6284e47b],.combat-panel h3[data-v-6284e47b],.combat-panel .modal-title[data-v-6284e47b],.character-panel h1[data-v-6284e47b],.character-panel h2[data-v-6284e47b],.character-panel h3[data-v-6284e47b],.character-panel .modal-title[data-v-6284e47b],.character-creator h1[data-v-6284e47b],.character-creator h2[data-v-6284e47b],.character-creator h3[data-v-6284e47b],.character-creator .modal-title[data-v-6284e47b],.instance-record h1[data-v-6284e47b],.instance-record h2[data-v-6284e47b],.instance-record h3[data-v-6284e47b],.instance-record .modal-title[data-v-6284e47b],.instance-generator h1[data-v-6284e47b],.instance-generator h2[data-v-6284e47b],.instance-generator h3[data-v-6284e47b],.instance-generator .modal-title[data-v-6284e47b],.interaction-room h1[data-v-6284e47b],.interaction-room h2[data-v-6284e47b],.interaction-room h3[data-v-6284e47b],.interaction-room .modal-title[data-v-6284e47b],.dice-roller h1[data-v-6284e47b],.dice-roller h2[data-v-6284e47b],.dice-roller h3[data-v-6284e47b],.dice-roller .modal-title[data-v-6284e47b],.map-panel h1[data-v-6284e47b],.map-panel h2[data-v-6284e47b],.map-panel h3[data-v-6284e47b],.map-panel .modal-title[data-v-6284e47b],.plot-review h1[data-v-6284e47b],.plot-review h2[data-v-6284e47b],.plot-review h3[data-v-6284e47b],.plot-review .modal-title[data-v-6284e47b]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-6284e47b],.modal-overlay .form-group[data-v-6284e47b],.dialogue-box .button-group[data-v-6284e47b],.dialogue-box .form-group[data-v-6284e47b],.combat-panel .button-group[data-v-6284e47b],.combat-panel .form-group[data-v-6284e47b],.character-panel .button-group[data-v-6284e47b],.character-panel .form-group[data-v-6284e47b],.character-creator .button-group[data-v-6284e47b],.character-creator .form-group[data-v-6284e47b],.instance-record .button-group[data-v-6284e47b],.instance-record .form-group[data-v-6284e47b],.instance-generator .button-group[data-v-6284e47b],.instance-generator .form-group[data-v-6284e47b],.interaction-room .button-group[data-v-6284e47b],.interaction-room .form-group[data-v-6284e47b],.dice-roller .button-group[data-v-6284e47b],.dice-roller .form-group[data-v-6284e47b],.map-panel .button-group[data-v-6284e47b],.map-panel .form-group[data-v-6284e47b],.plot-review .button-group[data-v-6284e47b],.plot-review .form-group[data-v-6284e47b]{gap:calc(16px*var(--modal-scale))}.inventory-panel[data-v-6284e47b]{width:100%;max-width:800px;max-height:90vh;overflow-y:auto;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:32px;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.inventory-panel[data-v-6284e47b]{max-width:95vw;max-height:95vh;padding:16px;border-width:1px}}@media (max-width:480px){.inventory-panel[data-v-6284e47b]{max-width:98vw;padding:8px}}.inventory-panel[data-v-6284e47b]{max-width:900px;position:relative}.close-btn[data-v-6284e47b]{position:absolute;top:16px;right:16px;width:32px;height:32px;padding:0;background:rgba(0,0,0,.7);border:1px solid #d4af37;border-radius:4px;color:#d4af37;font-size:18px;cursor:pointer;transition:all .15s ease;z-index:10}@media (max-width:767px){.close-btn[data-v-6284e47b]{width:28px;height:28px;font-size:16px;top:8px;right:8px}}.close-btn[data-v-6284e47b]:hover{background:rgba(244,67,54,.3);border-color:#f44336;color:#f44336;transform:scale(1.1)}.panel-title[data-v-6284e47b]{--base-title-size:32px;font-size:32px;color:#d4af37;text-align:center;margin-bottom:32px;text-shadow:0 0 10px rgba(212,175,55,.5)}@media (max-width:767px){.panel-title[data-v-6284e47b]{--base-title-size:24px;font-size:24px;margin-bottom:16px}}@media (max-width:480px){.panel-title[data-v-6284e47b]{--base-title-size:20px;font-size:20px;margin-bottom:8px}}.inventory-tabs[data-v-6284e47b]{display:flex;gap:8px;justify-content:center;margin-bottom:24px}@media (max-width:767px){.inventory-tabs[data-v-6284e47b]{gap:4px;margin-bottom:16px}}.tab-btn[data-v-6284e47b]{padding:8px 24px;background:rgba(0,0,0,.6);border:2px solid #333;border-radius:8px;color:#ccc;font-size:16px;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.tab-btn[data-v-6284e47b]{padding:4px 16px;font-size:14px;border-width:1px}}.tab-btn[data-v-6284e47b]:hover{border-color:#d4af37;color:#d4af37}.tab-btn.active[data-v-6284e47b]{background:rgba(212,175,55,.2);border-color:#d4af37;color:#d4af37;box-shadow:0 0 20px rgba(212,175,55,.3)}.inventory-content[data-v-6284e47b]{min-height:300px}@media (max-width:767px){.inventory-content[data-v-6284e47b]{min-height:200px}}.empty-inventory[data-v-6284e47b]{text-align:center;padding:48px;color:#888}@media (max-width:767px){.empty-inventory[data-v-6284e47b]{padding:32px}}.empty-inventory p[data-v-6284e47b]{font-size:18px;margin:0}@media (max-width:767px){.empty-inventory p[data-v-6284e47b]{font-size:16px}}.items-grid[data-v-6284e47b]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:16px}@media (max-width:767px){.items-grid[data-v-6284e47b]{grid-template-columns:1fr;gap:8px}}.item-card[data-v-6284e47b]{padding:16px;background:rgba(0,0,0,.6);border:2px solid #333;border-radius:8px;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.item-card[data-v-6284e47b]{padding:8px;border-width:1px}}.item-card[data-v-6284e47b]:hover{border-color:#d4af37;transform:translateY(-2px);box-shadow:0 0 20px rgba(212,175,55,.3)}.item-header[data-v-6284e47b]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.item-name[data-v-6284e47b]{font-size:18px;font-weight:700;color:#f5f5f5}@media (max-width:767px){.item-name[data-v-6284e47b]{font-size:16px}}.item-type[data-v-6284e47b]{font-size:14px;color:#d4af37;padding:2px 8px;background:rgba(212,175,55,.2);border-radius:4px}@media (max-width:767px){.item-type[data-v-6284e47b]{font-size:12px;padding:1px 6px}}.item-description[data-v-6284e47b]{color:#ccc;font-size:14px;line-height:1.5;margin:0 0 4px 0}@media (max-width:767px){.item-description[data-v-6284e47b]{font-size:12px}}.item-meta[data-v-6284e47b]{margin-top:4px}.item-source[data-v-6284e47b]{font-size:12px;color:#888}@media (max-width:767px){.item-source[data-v-6284e47b]{font-size:10px}}.item-detail-overlay[data-v-6284e47b]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:10;backdrop-filter:blur(4px)}.item-detail-modal[data-v-6284e47b]{background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:32px;max-width:500px;width:90%;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.item-detail-modal[data-v-6284e47b]{padding:24px;border-width:1px}}.item-detail-modal h3[data-v-6284e47b]{font-size:24px;color:#d4af37;margin:0 0 16px 0}@media (max-width:767px){.item-detail-modal h3[data-v-6284e47b]{font-size:20px}}.detail-type[data-v-6284e47b]{font-size:16px;color:#d4af37;margin:0 0 8px 0}@media (max-width:767px){.detail-type[data-v-6284e47b]{font-size:14px}}.detail-description[data-v-6284e47b]{font-size:16px;color:#ccc;line-height:1.6;margin:0 0 16px 0}@media (max-width:767px){.detail-description[data-v-6284e47b]{font-size:14px}}.detail-meta[data-v-6284e47b]{margin-bottom:16px}.detail-meta p[data-v-6284e47b]{font-size:14px;color:#888;margin:4px 0}@media (max-width:767px){.detail-meta p[data-v-6284e47b]{font-size:12px}}.detail-actions[data-v-6284e47b]{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}.btn-action[data-v-6284e47b]{padding:8px 24px;border:2px solid;border-radius:8px;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease;min-width:80px}@media (max-width:767px){.btn-action[data-v-6284e47b]{padding:4px 16px;font-size:14px;border-width:1px;min-width:70px}}.btn-action.btn-use[data-v-6284e47b]{background:linear-gradient(135deg,rgba(76,175,80,0.3),rgba(76,175,80,0.5));border-color:#4caf50;color:#4caf50}.btn-action.btn-use[data-v-6284e47b]:hover{background:linear-gradient(135deg,rgba(76,175,80,0.5),rgba(76,175,80,0.7));box-shadow:0 0 20px rgba(76,175,80,.3);transform:translateY(-2px)}.btn-action.btn-discard[data-v-6284e47b]{background:linear-gradient(135deg,rgba(244,67,54,0.3),rgba(244,67,54,0.5));border-color:#f44336;color:#f44336}.btn-action.btn-discard[data-v-6284e47b]:hover{background:linear-gradient(135deg,rgba(244,67,54,0.5),rgba(244,67,54,0.7));box-shadow:0 0 20px rgba(244,67,54,.3);transform:translateY(-2px)}.btn-action.btn-close-detail[data-v-6284e47b]{background:linear-gradient(135deg,rgba(100,100,100,0.3),rgba(100,100,100,0.5));border-color:#888;color:#ccc}.btn-action.btn-close-detail[data-v-6284e47b]:hover{background:linear-gradient(135deg,rgba(100,100,100,0.5),rgba(100,100,100,0.7));box-shadow:0 0 20px rgba(100,100,100,.3);transform:translateY(-2px)}.btn-action[data-v-6284e47b]:active{transform:translateY(0)}
[data-v-3cc40fe2]{box-sizing:border-box;margin:0;padding:0}body[data-v-3cc40fe2]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-3cc40fe2]::-webkit-scrollbar{width:8px;height:8px}[data-v-3cc40fe2]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-3cc40fe2]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-3cc40fe2]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-3cc40fe2]{color:#d4af37}.text-muted[data-v-3cc40fe2]{color:#888}.bg-overlay[data-v-3cc40fe2]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-3cc40fe2]{border:2px solid #d4af37}.shadow-gold[data-v-3cc40fe2]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-3cc40fe2]{z-index:50 !important}.dialogue-box[data-v-3cc40fe2],.combat-panel[data-v-3cc40fe2],.character-panel[data-v-3cc40fe2],.character-creator[data-v-3cc40fe2],.instance-record[data-v-3cc40fe2],.instance-generator[data-v-3cc40fe2],.interaction-room[data-v-3cc40fe2],.dice-roller[data-v-3cc40fe2],.map-panel[data-v-3cc40fe2],.plot-review[data-v-3cc40fe2]{z-index:50 !important}[data-v-3cc40fe2]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-3cc40fe2]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-3cc40fe2]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-3cc40fe2],.dialogue-box[data-v-3cc40fe2],.combat-panel[data-v-3cc40fe2],.character-panel[data-v-3cc40fe2],.character-creator[data-v-3cc40fe2],.instance-record[data-v-3cc40fe2],.instance-generator[data-v-3cc40fe2],.interaction-room[data-v-3cc40fe2],.dice-roller[data-v-3cc40fe2],.map-panel[data-v-3cc40fe2],.plot-review[data-v-3cc40fe2]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-3cc40fe2],.dialogue-box[data-v-3cc40fe2],.combat-panel[data-v-3cc40fe2],.character-panel[data-v-3cc40fe2],.character-creator[data-v-3cc40fe2],.instance-record[data-v-3cc40fe2],.instance-generator[data-v-3cc40fe2],.interaction-room[data-v-3cc40fe2],.dice-roller[data-v-3cc40fe2],.map-panel[data-v-3cc40fe2],.plot-review[data-v-3cc40fe2]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-3cc40fe2],.dialogue-box[data-v-3cc40fe2],.combat-panel[data-v-3cc40fe2],.character-panel[data-v-3cc40fe2],.character-creator[data-v-3cc40fe2],.instance-record[data-v-3cc40fe2],.instance-generator[data-v-3cc40fe2],.interaction-room[data-v-3cc40fe2],.dice-roller[data-v-3cc40fe2],.map-panel[data-v-3cc40fe2],.plot-review[data-v-3cc40fe2]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-3cc40fe2],.modal-overlay input[data-v-3cc40fe2],.modal-overlay textarea[data-v-3cc40fe2],.modal-overlay select[data-v-3cc40fe2],.modal-overlay .btn[data-v-3cc40fe2],.modal-overlay .form-control[data-v-3cc40fe2],.modal-overlay .modal-title[data-v-3cc40fe2],.modal-overlay .close-btn[data-v-3cc40fe2],.dialogue-box button[data-v-3cc40fe2],.dialogue-box input[data-v-3cc40fe2],.dialogue-box textarea[data-v-3cc40fe2],.dialogue-box select[data-v-3cc40fe2],.dialogue-box .btn[data-v-3cc40fe2],.dialogue-box .form-control[data-v-3cc40fe2],.dialogue-box .modal-title[data-v-3cc40fe2],.dialogue-box .close-btn[data-v-3cc40fe2],.combat-panel button[data-v-3cc40fe2],.combat-panel input[data-v-3cc40fe2],.combat-panel textarea[data-v-3cc40fe2],.combat-panel select[data-v-3cc40fe2],.combat-panel .btn[data-v-3cc40fe2],.combat-panel .form-control[data-v-3cc40fe2],.combat-panel .modal-title[data-v-3cc40fe2],.combat-panel .close-btn[data-v-3cc40fe2],.character-panel button[data-v-3cc40fe2],.character-panel input[data-v-3cc40fe2],.character-panel textarea[data-v-3cc40fe2],.character-panel select[data-v-3cc40fe2],.character-panel .btn[data-v-3cc40fe2],.character-panel .form-control[data-v-3cc40fe2],.character-panel .modal-title[data-v-3cc40fe2],.character-panel .close-btn[data-v-3cc40fe2],.character-creator button[data-v-3cc40fe2],.character-creator input[data-v-3cc40fe2],.character-creator textarea[data-v-3cc40fe2],.character-creator select[data-v-3cc40fe2],.character-creator .btn[data-v-3cc40fe2],.character-creator .form-control[data-v-3cc40fe2],.character-creator .modal-title[data-v-3cc40fe2],.character-creator .close-btn[data-v-3cc40fe2],.instance-record button[data-v-3cc40fe2],.instance-record input[data-v-3cc40fe2],.instance-record textarea[data-v-3cc40fe2],.instance-record select[data-v-3cc40fe2],.instance-record .btn[data-v-3cc40fe2],.instance-record .form-control[data-v-3cc40fe2],.instance-record .modal-title[data-v-3cc40fe2],.instance-record .close-btn[data-v-3cc40fe2],.instance-generator button[data-v-3cc40fe2],.instance-generator input[data-v-3cc40fe2],.instance-generator textarea[data-v-3cc40fe2],.instance-generator select[data-v-3cc40fe2],.instance-generator .btn[data-v-3cc40fe2],.instance-generator .form-control[data-v-3cc40fe2],.instance-generator .modal-title[data-v-3cc40fe2],.instance-generator .close-btn[data-v-3cc40fe2],.interaction-room button[data-v-3cc40fe2],.interaction-room input[data-v-3cc40fe2],.interaction-room textarea[data-v-3cc40fe2],.interaction-room select[data-v-3cc40fe2],.interaction-room .btn[data-v-3cc40fe2],.interaction-room .form-control[data-v-3cc40fe2],.interaction-room .modal-title[data-v-3cc40fe2],.interaction-room .close-btn[data-v-3cc40fe2],.dice-roller button[data-v-3cc40fe2],.dice-roller input[data-v-3cc40fe2],.dice-roller textarea[data-v-3cc40fe2],.dice-roller select[data-v-3cc40fe2],.dice-roller .btn[data-v-3cc40fe2],.dice-roller .form-control[data-v-3cc40fe2],.dice-roller .modal-title[data-v-3cc40fe2],.dice-roller .close-btn[data-v-3cc40fe2],.map-panel button[data-v-3cc40fe2],.map-panel input[data-v-3cc40fe2],.map-panel textarea[data-v-3cc40fe2],.map-panel select[data-v-3cc40fe2],.map-panel .btn[data-v-3cc40fe2],.map-panel .form-control[data-v-3cc40fe2],.map-panel .modal-title[data-v-3cc40fe2],.map-panel .close-btn[data-v-3cc40fe2],.plot-review button[data-v-3cc40fe2],.plot-review input[data-v-3cc40fe2],.plot-review textarea[data-v-3cc40fe2],.plot-review select[data-v-3cc40fe2],.plot-review .btn[data-v-3cc40fe2],.plot-review .form-control[data-v-3cc40fe2],.plot-review .modal-title[data-v-3cc40fe2],.plot-review .close-btn[data-v-3cc40fe2]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-3cc40fe2],.modal-overlay h2[data-v-3cc40fe2],.modal-overlay h3[data-v-3cc40fe2],.modal-overlay .modal-title[data-v-3cc40fe2],.dialogue-box h1[data-v-3cc40fe2],.dialogue-box h2[data-v-3cc40fe2],.dialogue-box h3[data-v-3cc40fe2],.dialogue-box .modal-title[data-v-3cc40fe2],.combat-panel h1[data-v-3cc40fe2],.combat-panel h2[data-v-3cc40fe2],.combat-panel h3[data-v-3cc40fe2],.combat-panel .modal-title[data-v-3cc40fe2],.character-panel h1[data-v-3cc40fe2],.character-panel h2[data-v-3cc40fe2],.character-panel h3[data-v-3cc40fe2],.character-panel .modal-title[data-v-3cc40fe2],.character-creator h1[data-v-3cc40fe2],.character-creator h2[data-v-3cc40fe2],.character-creator h3[data-v-3cc40fe2],.character-creator .modal-title[data-v-3cc40fe2],.instance-record h1[data-v-3cc40fe2],.instance-record h2[data-v-3cc40fe2],.instance-record h3[data-v-3cc40fe2],.instance-record .modal-title[data-v-3cc40fe2],.instance-generator h1[data-v-3cc40fe2],.instance-generator h2[data-v-3cc40fe2],.instance-generator h3[data-v-3cc40fe2],.instance-generator .modal-title[data-v-3cc40fe2],.interaction-room h1[data-v-3cc40fe2],.interaction-room h2[data-v-3cc40fe2],.interaction-room h3[data-v-3cc40fe2],.interaction-room .modal-title[data-v-3cc40fe2],.dice-roller h1[data-v-3cc40fe2],.dice-roller h2[data-v-3cc40fe2],.dice-roller h3[data-v-3cc40fe2],.dice-roller .modal-title[data-v-3cc40fe2],.map-panel h1[data-v-3cc40fe2],.map-panel h2[data-v-3cc40fe2],.map-panel h3[data-v-3cc40fe2],.map-panel .modal-title[data-v-3cc40fe2],.plot-review h1[data-v-3cc40fe2],.plot-review h2[data-v-3cc40fe2],.plot-review h3[data-v-3cc40fe2],.plot-review .modal-title[data-v-3cc40fe2]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-3cc40fe2],.modal-overlay .form-group[data-v-3cc40fe2],.dialogue-box .button-group[data-v-3cc40fe2],.dialogue-box .form-group[data-v-3cc40fe2],.combat-panel .button-group[data-v-3cc40fe2],.combat-panel .form-group[data-v-3cc40fe2],.character-panel .button-group[data-v-3cc40fe2],.character-panel .form-group[data-v-3cc40fe2],.character-creator .button-group[data-v-3cc40fe2],.character-creator .form-group[data-v-3cc40fe2],.instance-record .button-group[data-v-3cc40fe2],.instance-record .form-group[data-v-3cc40fe2],.instance-generator .button-group[data-v-3cc40fe2],.instance-generator .form-group[data-v-3cc40fe2],.interaction-room .button-group[data-v-3cc40fe2],.interaction-room .form-group[data-v-3cc40fe2],.dice-roller .button-group[data-v-3cc40fe2],.dice-roller .form-group[data-v-3cc40fe2],.map-panel .button-group[data-v-3cc40fe2],.map-panel .form-group[data-v-3cc40fe2],.plot-review .button-group[data-v-3cc40fe2],.plot-review .form-group[data-v-3cc40fe2]{gap:calc(16px*var(--modal-scale))}.area-details-modal-overlay[data-v-3cc40fe2]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);display:flex;align-items:center;justify-content:center;z-index:60;backdrop-filter:blur(4px);padding:16px}@media (max-width:767px){.area-details-modal-overlay[data-v-3cc40fe2]{padding:8px}}.area-details-modal[data-v-3cc40fe2]{width:100%;max-width:800px;max-height:90vh;overflow-y:auto;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:32px;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.area-details-modal[data-v-3cc40fe2]{max-width:95vw;max-height:95vh;padding:16px;border-width:1px}}@media (max-width:480px){.area-details-modal[data-v-3cc40fe2]{max-width:98vw;padding:8px}}.area-details-modal[data-v-3cc40fe2]{max-width:700px;position:relative}.close-btn[data-v-3cc40fe2]{position:absolute;top:16px;right:16px;width:32px;height:32px;padding:0;background:rgba(0,0,0,.7);border:1px solid #d4af37;border-radius:4px;color:#d4af37;font-size:18px;cursor:pointer;transition:all .15s ease;z-index:10}@media (max-width:767px){.close-btn[data-v-3cc40fe2]{width:28px;height:28px;font-size:16px;top:8px;right:8px}}.close-btn[data-v-3cc40fe2]:hover{background:rgba(244,67,54,.3);border-color:#f44336;color:#f44336;transform:scale(1.1)}.modal-title[data-v-3cc40fe2]{--base-title-size:32px;font-size:32px;color:#d4af37;text-align:center;margin-bottom:32px;text-shadow:0 0 10px rgba(212,175,55,.5)}@media (max-width:767px){.modal-title[data-v-3cc40fe2]{--base-title-size:24px;font-size:24px;margin-bottom:16px}}@media (max-width:480px){.modal-title[data-v-3cc40fe2]{--base-title-size:20px;font-size:20px;margin-bottom:8px}}.loading[data-v-3cc40fe2]{text-align:center;padding:48px;color:#ccc}@media (max-width:767px){.loading[data-v-3cc40fe2]{padding:32px}}.details-content[data-v-3cc40fe2]{display:flex;flex-direction:column;gap:24px}@media (max-width:767px){.details-content[data-v-3cc40fe2]{gap:16px}}.detail-section h3[data-v-3cc40fe2]{font-size:18px;color:#d4af37;margin-bottom:8px}@media (max-width:767px){.detail-section h3[data-v-3cc40fe2]{font-size:16px}}.detail-section p[data-v-3cc40fe2]{color:#ccc;font-size:16px;line-height:1.6}@media (max-width:767px){.detail-section p[data-v-3cc40fe2]{font-size:14px}}.items-list[data-v-3cc40fe2]{display:flex;flex-direction:column;gap:8px}.item-card[data-v-3cc40fe2]{padding:16px;background:rgba(0,0,0,.6);border:2px solid #333;border-radius:8px;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.item-card[data-v-3cc40fe2]{padding:8px;border-width:1px}}.item-card[data-v-3cc40fe2]:hover{border-color:#d4af37;transform:translateY(-2px);box-shadow:0 0 20px rgba(212,175,55,.3)}.item-card.selected[data-v-3cc40fe2]{border-color:#f4d03f;background:rgba(212,175,55,.2);box-shadow:0 0 20px rgba(212,175,55,.3)}.item-header[data-v-3cc40fe2]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.item-name[data-v-3cc40fe2]{font-size:18px;font-weight:700;color:#f5f5f5}@media (max-width:767px){.item-name[data-v-3cc40fe2]{font-size:16px}}.item-type[data-v-3cc40fe2]{font-size:14px;color:#d4af37;padding:2px 8px;background:rgba(212,175,55,.2);border-radius:4px}@media (max-width:767px){.item-type[data-v-3cc40fe2]{font-size:12px;padding:1px 6px}}.item-description[data-v-3cc40fe2]{color:#ccc;font-size:14px;line-height:1.5;margin:0}@media (max-width:767px){.item-description[data-v-3cc40fe2]{font-size:12px}}.item-actions[data-v-3cc40fe2]{display:flex;gap:16px;margin-top:16px;justify-content:center}@media (max-width:767px){.item-actions[data-v-3cc40fe2]{gap:8px}}.btn-action[data-v-3cc40fe2]{padding:8px 24px;border:2px solid;border-radius:8px;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease;min-width:100px}@media (max-width:767px){.btn-action[data-v-3cc40fe2]{padding:4px 16px;font-size:14px;border-width:1px;min-width:80px}}.btn-action.btn-pickup[data-v-3cc40fe2]{background:linear-gradient(135deg,rgba(76,175,80,0.3),rgba(76,175,80,0.5));border-color:#4caf50;color:#4caf50}.btn-action.btn-pickup[data-v-3cc40fe2]:hover{background:linear-gradient(135deg,rgba(76,175,80,0.5),rgba(76,175,80,0.7));box-shadow:0 0 20px rgba(76,175,80,.3);transform:translateY(-2px)}.btn-action.btn-pickup[data-v-3cc40fe2]:active{transform:translateY(0)}.btn-action.btn-cancel-item[data-v-3cc40fe2]{background:linear-gradient(135deg,rgba(244,67,54,0.3),rgba(244,67,54,0.5));border-color:#f44336;color:#f44336}.btn-action.btn-cancel-item[data-v-3cc40fe2]:hover{background:linear-gradient(135deg,rgba(244,67,54,0.5),rgba(244,67,54,0.7));box-shadow:0 0 20px rgba(244,67,54,.3);transform:translateY(-2px)}.btn-action.btn-cancel-item[data-v-3cc40fe2]:active{transform:translateY(0)}.no-items[data-v-3cc40fe2]{text-align:center;padding:32px;color:#888}@media (max-width:767px){.no-items[data-v-3cc40fe2]{padding:24px}}.no-items p[data-v-3cc40fe2]{margin:0;font-size:16px}@media (max-width:767px){.no-items p[data-v-3cc40fe2]{font-size:14px}}
[data-v-4ba1ef10]{box-sizing:border-box;margin:0;padding:0}body[data-v-4ba1ef10]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-4ba1ef10]::-webkit-scrollbar{width:8px;height:8px}[data-v-4ba1ef10]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-4ba1ef10]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-4ba1ef10]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-4ba1ef10]{color:#d4af37}.text-muted[data-v-4ba1ef10]{color:#888}.bg-overlay[data-v-4ba1ef10]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-4ba1ef10]{border:2px solid #d4af37}.shadow-gold[data-v-4ba1ef10]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-4ba1ef10]{z-index:50 !important}.dialogue-box[data-v-4ba1ef10],.combat-panel[data-v-4ba1ef10],.character-panel[data-v-4ba1ef10],.character-creator[data-v-4ba1ef10],.instance-record[data-v-4ba1ef10],.instance-generator[data-v-4ba1ef10],.interaction-room[data-v-4ba1ef10],.dice-roller[data-v-4ba1ef10],.map-panel[data-v-4ba1ef10],.plot-review[data-v-4ba1ef10]{z-index:50 !important}[data-v-4ba1ef10]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-4ba1ef10]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-4ba1ef10]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-4ba1ef10],.dialogue-box[data-v-4ba1ef10],.combat-panel[data-v-4ba1ef10],.character-panel[data-v-4ba1ef10],.character-creator[data-v-4ba1ef10],.instance-record[data-v-4ba1ef10],.instance-generator[data-v-4ba1ef10],.interaction-room[data-v-4ba1ef10],.dice-roller[data-v-4ba1ef10],.map-panel[data-v-4ba1ef10],.plot-review[data-v-4ba1ef10]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-4ba1ef10],.dialogue-box[data-v-4ba1ef10],.combat-panel[data-v-4ba1ef10],.character-panel[data-v-4ba1ef10],.character-creator[data-v-4ba1ef10],.instance-record[data-v-4ba1ef10],.instance-generator[data-v-4ba1ef10],.interaction-room[data-v-4ba1ef10],.dice-roller[data-v-4ba1ef10],.map-panel[data-v-4ba1ef10],.plot-review[data-v-4ba1ef10]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-4ba1ef10],.dialogue-box[data-v-4ba1ef10],.combat-panel[data-v-4ba1ef10],.character-panel[data-v-4ba1ef10],.character-creator[data-v-4ba1ef10],.instance-record[data-v-4ba1ef10],.instance-generator[data-v-4ba1ef10],.interaction-room[data-v-4ba1ef10],.dice-roller[data-v-4ba1ef10],.map-panel[data-v-4ba1ef10],.plot-review[data-v-4ba1ef10]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-4ba1ef10],.modal-overlay input[data-v-4ba1ef10],.modal-overlay textarea[data-v-4ba1ef10],.modal-overlay select[data-v-4ba1ef10],.modal-overlay .btn[data-v-4ba1ef10],.modal-overlay .form-control[data-v-4ba1ef10],.modal-overlay .modal-title[data-v-4ba1ef10],.modal-overlay .close-btn[data-v-4ba1ef10],.dialogue-box button[data-v-4ba1ef10],.dialogue-box input[data-v-4ba1ef10],.dialogue-box textarea[data-v-4ba1ef10],.dialogue-box select[data-v-4ba1ef10],.dialogue-box .btn[data-v-4ba1ef10],.dialogue-box .form-control[data-v-4ba1ef10],.dialogue-box .modal-title[data-v-4ba1ef10],.dialogue-box .close-btn[data-v-4ba1ef10],.combat-panel button[data-v-4ba1ef10],.combat-panel input[data-v-4ba1ef10],.combat-panel textarea[data-v-4ba1ef10],.combat-panel select[data-v-4ba1ef10],.combat-panel .btn[data-v-4ba1ef10],.combat-panel .form-control[data-v-4ba1ef10],.combat-panel .modal-title[data-v-4ba1ef10],.combat-panel .close-btn[data-v-4ba1ef10],.character-panel button[data-v-4ba1ef10],.character-panel input[data-v-4ba1ef10],.character-panel textarea[data-v-4ba1ef10],.character-panel select[data-v-4ba1ef10],.character-panel .btn[data-v-4ba1ef10],.character-panel .form-control[data-v-4ba1ef10],.character-panel .modal-title[data-v-4ba1ef10],.character-panel .close-btn[data-v-4ba1ef10],.character-creator button[data-v-4ba1ef10],.character-creator input[data-v-4ba1ef10],.character-creator textarea[data-v-4ba1ef10],.character-creator select[data-v-4ba1ef10],.character-creator .btn[data-v-4ba1ef10],.character-creator .form-control[data-v-4ba1ef10],.character-creator .modal-title[data-v-4ba1ef10],.character-creator .close-btn[data-v-4ba1ef10],.instance-record button[data-v-4ba1ef10],.instance-record input[data-v-4ba1ef10],.instance-record textarea[data-v-4ba1ef10],.instance-record select[data-v-4ba1ef10],.instance-record .btn[data-v-4ba1ef10],.instance-record .form-control[data-v-4ba1ef10],.instance-record .modal-title[data-v-4ba1ef10],.instance-record .close-btn[data-v-4ba1ef10],.instance-generator button[data-v-4ba1ef10],.instance-generator input[data-v-4ba1ef10],.instance-generator textarea[data-v-4ba1ef10],.instance-generator select[data-v-4ba1ef10],.instance-generator .btn[data-v-4ba1ef10],.instance-generator .form-control[data-v-4ba1ef10],.instance-generator .modal-title[data-v-4ba1ef10],.instance-generator .close-btn[data-v-4ba1ef10],.interaction-room button[data-v-4ba1ef10],.interaction-room input[data-v-4ba1ef10],.interaction-room textarea[data-v-4ba1ef10],.interaction-room select[data-v-4ba1ef10],.interaction-room .btn[data-v-4ba1ef10],.interaction-room .form-control[data-v-4ba1ef10],.interaction-room .modal-title[data-v-4ba1ef10],.interaction-room .close-btn[data-v-4ba1ef10],.dice-roller button[data-v-4ba1ef10],.dice-roller input[data-v-4ba1ef10],.dice-roller textarea[data-v-4ba1ef10],.dice-roller select[data-v-4ba1ef10],.dice-roller .btn[data-v-4ba1ef10],.dice-roller .form-control[data-v-4ba1ef10],.dice-roller .modal-title[data-v-4ba1ef10],.dice-roller .close-btn[data-v-4ba1ef10],.map-panel button[data-v-4ba1ef10],.map-panel input[data-v-4ba1ef10],.map-panel textarea[data-v-4ba1ef10],.map-panel select[data-v-4ba1ef10],.map-panel .btn[data-v-4ba1ef10],.map-panel .form-control[data-v-4ba1ef10],.map-panel .modal-title[data-v-4ba1ef10],.map-panel .close-btn[data-v-4ba1ef10],.plot-review button[data-v-4ba1ef10],.plot-review input[data-v-4ba1ef10],.plot-review textarea[data-v-4ba1ef10],.plot-review select[data-v-4ba1ef10],.plot-review .btn[data-v-4ba1ef10],.plot-review .form-control[data-v-4ba1ef10],.plot-review .modal-title[data-v-4ba1ef10],.plot-review .close-btn[data-v-4ba1ef10]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-4ba1ef10],.modal-overlay h2[data-v-4ba1ef10],.modal-overlay h3[data-v-4ba1ef10],.modal-overlay .modal-title[data-v-4ba1ef10],.dialogue-box h1[data-v-4ba1ef10],.dialogue-box h2[data-v-4ba1ef10],.dialogue-box h3[data-v-4ba1ef10],.dialogue-box .modal-title[data-v-4ba1ef10],.combat-panel h1[data-v-4ba1ef10],.combat-panel h2[data-v-4ba1ef10],.combat-panel h3[data-v-4ba1ef10],.combat-panel .modal-title[data-v-4ba1ef10],.character-panel h1[data-v-4ba1ef10],.character-panel h2[data-v-4ba1ef10],.character-panel h3[data-v-4ba1ef10],.character-panel .modal-title[data-v-4ba1ef10],.character-creator h1[data-v-4ba1ef10],.character-creator h2[data-v-4ba1ef10],.character-creator h3[data-v-4ba1ef10],.character-creator .modal-title[data-v-4ba1ef10],.instance-record h1[data-v-4ba1ef10],.instance-record h2[data-v-4ba1ef10],.instance-record h3[data-v-4ba1ef10],.instance-record .modal-title[data-v-4ba1ef10],.instance-generator h1[data-v-4ba1ef10],.instance-generator h2[data-v-4ba1ef10],.instance-generator h3[data-v-4ba1ef10],.instance-generator .modal-title[data-v-4ba1ef10],.interaction-room h1[data-v-4ba1ef10],.interaction-room h2[data-v-4ba1ef10],.interaction-room h3[data-v-4ba1ef10],.interaction-room .modal-title[data-v-4ba1ef10],.dice-roller h1[data-v-4ba1ef10],.dice-roller h2[data-v-4ba1ef10],.dice-roller h3[data-v-4ba1ef10],.dice-roller .modal-title[data-v-4ba1ef10],.map-panel h1[data-v-4ba1ef10],.map-panel h2[data-v-4ba1ef10],.map-panel h3[data-v-4ba1ef10],.map-panel .modal-title[data-v-4ba1ef10],.plot-review h1[data-v-4ba1ef10],.plot-review h2[data-v-4ba1ef10],.plot-review h3[data-v-4ba1ef10],.plot-review .modal-title[data-v-4ba1ef10]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-4ba1ef10],.modal-overlay .form-group[data-v-4ba1ef10],.dialogue-box .button-group[data-v-4ba1ef10],.dialogue-box .form-group[data-v-4ba1ef10],.combat-panel .button-group[data-v-4ba1ef10],.combat-panel .form-group[data-v-4ba1ef10],.character-panel .button-group[data-v-4ba1ef10],.character-panel .form-group[data-v-4ba1ef10],.character-creator .button-group[data-v-4ba1ef10],.character-creator .form-group[data-v-4ba1ef10],.instance-record .button-group[data-v-4ba1ef10],.instance-record .form-group[data-v-4ba1ef10],.instance-generator .button-group[data-v-4ba1ef10],.instance-generator .form-group[data-v-4ba1ef10],.interaction-room .button-group[data-v-4ba1ef10],.interaction-room .form-group[data-v-4ba1ef10],.dice-roller .button-group[data-v-4ba1ef10],.dice-roller .form-group[data-v-4ba1ef10],.map-panel .button-group[data-v-4ba1ef10],.map-panel .form-group[data-v-4ba1ef10],.plot-review .button-group[data-v-4ba1ef10],.plot-review .form-group[data-v-4ba1ef10]{gap:calc(16px*var(--modal-scale))}.map-panel[data-v-4ba1ef10]{width:100%;max-width:800px;max-height:90vh;overflow-y:auto;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:32px;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.map-panel[data-v-4ba1ef10]{max-width:95vw;max-height:95vh;padding:16px;border-width:1px}}@media (max-width:480px){.map-panel[data-v-4ba1ef10]{max-width:98vw;padding:8px}}.map-panel[data-v-4ba1ef10]{width:100%;max-width:800px}.map-header[data-v-4ba1ef10]{text-align:center;margin-bottom:24px}@media (max-width:767px){.map-header[data-v-4ba1ef10]{margin-bottom:16px}}.map-header h2[data-v-4ba1ef10]{--base-title-size:32px;font-size:32px;color:#d4af37;text-align:center;margin-bottom:32px;text-shadow:0 0 10px rgba(212,175,55,.5)}@media (max-width:767px){.map-header h2[data-v-4ba1ef10]{--base-title-size:24px;font-size:24px;margin-bottom:16px}}@media (max-width:480px){.map-header h2[data-v-4ba1ef10]{--base-title-size:20px;font-size:20px;margin-bottom:8px}}.map-header h2[data-v-4ba1ef10]{margin:0;margin-bottom:16px}.map-tabs[data-v-4ba1ef10]{display:flex;gap:8px;justify-content:center;margin-bottom:16px}@media (max-width:767px){.map-tabs[data-v-4ba1ef10]{gap:4px;margin-bottom:8px}}.tab-btn[data-v-4ba1ef10]{padding:8px 24px;background:rgba(0,0,0,.6);border:2px solid #333;border-radius:8px;color:#ccc;font-size:16px;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.tab-btn[data-v-4ba1ef10]{padding:4px 16px;font-size:14px;border-width:1px}}.tab-btn[data-v-4ba1ef10]:hover{border-color:#d4af37;color:#d4af37}.tab-btn.active[data-v-4ba1ef10]{background:rgba(212,175,55,.2);border-color:#d4af37;color:#d4af37;box-shadow:0 0 20px rgba(212,175,55,.3)}.instance-name[data-v-4ba1ef10]{font-size:16px;color:#ccc;margin-top:8px}@media (max-width:767px){.instance-name[data-v-4ba1ef10]{font-size:14px}}.no-map[data-v-4ba1ef10]{text-align:center;padding:48px;color:#ccc}@media (max-width:767px){.no-map[data-v-4ba1ef10]{padding:32px}}.no-map p[data-v-4ba1ef10]{margin-bottom:24px;font-size:18px}@media (max-width:767px){.no-map p[data-v-4ba1ef10]{font-size:16px;margin-bottom:16px}}.btn-generate[data-v-4ba1ef10]{padding:16px 32px;background:linear-gradient(135deg,rgba(212,175,55,0.3),rgba(212,175,55,0.5));border:2px solid #d4af37;border-radius:8px;color:#d4af37;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease}@media (max-width:767px){.btn-generate[data-v-4ba1ef10]{padding:8px 24px;font-size:14px;border-width:1px}}.btn-generate[data-v-4ba1ef10]:hover{background:linear-gradient(135deg,rgba(212,175,55,0.5),rgba(212,175,55,0.7));box-shadow:0 0 20px rgba(212,175,55,.3);transform:translateY(-2px)}.btn-generate[data-v-4ba1ef10]:active{transform:translateY(0)}.current-area[data-v-4ba1ef10],.connected-areas[data-v-4ba1ef10]{margin-bottom:24px}@media (max-width:767px){.current-area[data-v-4ba1ef10],.connected-areas[data-v-4ba1ef10]{margin-bottom:16px}}.current-area h3[data-v-4ba1ef10],.connected-areas h3[data-v-4ba1ef10]{font-size:18px;color:#d4af37;margin-bottom:16px}@media (max-width:767px){.current-area h3[data-v-4ba1ef10],.connected-areas h3[data-v-4ba1ef10]{font-size:16px;margin-bottom:8px}}.areas-list[data-v-4ba1ef10]{display:flex;flex-direction:column;gap:8px}.area-card[data-v-4ba1ef10]{padding:16px;background:rgba(0,0,0,.6);border:2px solid #333;border-radius:8px;cursor:pointer;transition:all .15s ease}@media (max-width:767px){.area-card[data-v-4ba1ef10]{padding:8px;border-width:1px}}.area-card[data-v-4ba1ef10]:hover{border-color:#d4af37;transform:translateY(-2px);box-shadow:0 0 20px rgba(212,175,55,.3)}.area-card.current[data-v-4ba1ef10]{border-color:#d4af37;cursor:default;background:rgba(212,175,55,.1)}.area-card.current[data-v-4ba1ef10]:hover{transform:none}.area-card.discovered[data-v-4ba1ef10]{border-color:#d4af37}.area-card.selected[data-v-4ba1ef10]{border-color:#f4d03f;background:rgba(212,175,55,.2);box-shadow:0 0 20px rgba(212,175,55,.3)}.action-buttons[data-v-4ba1ef10]{display:flex;gap:16px;margin-top:24px;justify-content:center}@media (max-width:767px){.action-buttons[data-v-4ba1ef10]{gap:8px;margin-top:16px}}.btn-action[data-v-4ba1ef10]{padding:16px 32px;border:2px solid;border-radius:8px;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease;min-width:100px}@media (max-width:767px){.btn-action[data-v-4ba1ef10]{padding:8px 24px;font-size:14px;border-width:1px;min-width:80px}}.btn-action.btn-move[data-v-4ba1ef10]{background:linear-gradient(135deg,rgba(33,150,243,0.3),rgba(33,150,243,0.5));border-color:#2196f3;color:#2196f3}.btn-action.btn-move[data-v-4ba1ef10]:hover{background:linear-gradient(135deg,rgba(33,150,243,0.5),rgba(33,150,243,0.7));box-shadow:0 0 20px rgba(33,150,243,.3);transform:translateY(-2px)}.btn-action.btn-move[data-v-4ba1ef10]:active{transform:translateY(0)}.btn-action.btn-confirm[data-v-4ba1ef10]{background:linear-gradient(135deg,rgba(76,175,80,0.3),rgba(76,175,80,0.5));border-color:#4caf50;color:#4caf50}.btn-action.btn-confirm[data-v-4ba1ef10]:hover{background:linear-gradient(135deg,rgba(76,175,80,0.5),rgba(76,175,80,0.7));box-shadow:0 0 20px rgba(76,175,80,.3);transform:translateY(-2px)}.btn-action.btn-confirm[data-v-4ba1ef10]:active{transform:translateY(0)}.area-name[data-v-4ba1ef10]{font-size:18px;font-weight:700;color:#f5f5f5;margin-bottom:4px}@media (max-width:767px){.area-name[data-v-4ba1ef10]{font-size:16px}}.area-description[data-v-4ba1ef10]{color:#ccc;font-size:14px;line-height:1.5}@media (max-width:767px){.area-description[data-v-4ba1ef10]{font-size:12px}}.btn-view-details[data-v-4ba1ef10]{margin-top:16px;padding:8px 24px;background:linear-gradient(135deg,rgba(33,150,243,0.3),rgba(33,150,243,0.5));border:2px solid #2196f3;border-radius:8px;color:#2196f3;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease;width:100%}@media (max-width:767px){.btn-view-details[data-v-4ba1ef10]{padding:4px 16px;font-size:14px;border-width:1px;margin-top:8px}}.btn-view-details[data-v-4ba1ef10]:hover{background:linear-gradient(135deg,rgba(33,150,243,0.5),rgba(33,150,243,0.7));box-shadow:0 0 20px rgba(33,150,243,.3);transform:translateY(-2px)}.btn-view-details[data-v-4ba1ef10]:active{transform:translateY(0)}
.journal-view[data-v-30f8d2fa]{display:flex;flex-direction:column;height:100%;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);color:#e0e0e0;border-radius:12px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.4)}.panel-header[data-v-30f8d2fa]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem 2rem;background:hsla(0,0%,100%,.05);border-bottom:1px solid hsla(0,0%,100%,.1)}.panel-header .panel-title[data-v-30f8d2fa]{font-size:1.5rem;font-weight:600;color:#f0f0f0;margin:0}.panel-header .btn-close[data-v-30f8d2fa]{background:none;border:none;color:#e0e0e0;font-size:2rem;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all .2s}.panel-header .btn-close[data-v-30f8d2fa]:hover{background:hsla(0,0%,100%,.1);color:#fff}.panel-content[data-v-30f8d2fa]{display:flex;flex:1;overflow:hidden}.journal-list[data-v-30f8d2fa]{width:300px;background:rgba(0,0,0,.2);border-right:1px solid hsla(0,0%,100%,.1);display:flex;flex-direction:column;overflow:hidden}.author-selector[data-v-30f8d2fa]{padding:1rem;background:hsla(0,0%,100%,.05);border-bottom:1px solid hsla(0,0%,100%,.1)}.author-selector label[data-v-30f8d2fa]{display:block;margin-bottom:.5rem;font-size:.9rem;color:#b0b0b0}.author-selector select[data-v-30f8d2fa]{width:100%;padding:.5rem;background:hsla(0,0%,100%,.1);border:1px solid hsla(0,0%,100%,.2);border-radius:4px;color:#e0e0e0;font-size:.9rem;cursor:pointer}.author-selector select[data-v-30f8d2fa]:focus{outline:none;border-color:#4a9eff}.author-selector select option[data-v-30f8d2fa]{background:#1a1a2e;color:#e0e0e0}.author-selector select optgroup[data-v-30f8d2fa]{background:#16213e;color:#b0b0b0;font-weight:600}.history-section[data-v-30f8d2fa]{flex:1;overflow-y:auto;padding:1rem}.history-section .section-title[data-v-30f8d2fa]{font-size:1rem;font-weight:600;color:#b0b0b0;margin:0 0 1rem 0;padding-bottom:.5rem;border-bottom:1px solid hsla(0,0%,100%,.1)}.journal-items[data-v-30f8d2fa]{display:flex;flex-direction:column;gap:.5rem}.journal-item[data-v-30f8d2fa]{padding:.75rem;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;cursor:pointer;transition:all .2s}.journal-item[data-v-30f8d2fa]:hover{background:hsla(0,0%,100%,.08);border-color:hsla(0,0%,100%,.2)}.journal-item.active[data-v-30f8d2fa]{background:rgba(74,158,255,.2);border-color:#4a9eff}.journal-item .journal-header[data-v-30f8d2fa]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.journal-item .journal-header .journal-date[data-v-30f8d2fa]{font-size:.8rem;color:#b0b0b0}.journal-item .journal-header .journal-edited[data-v-30f8d2fa]{font-size:.75rem;color:orange}.journal-item .journal-preview[data-v-30f8d2fa]{font-size:.85rem;color:#d0d0d0;line-height:1.4;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}.empty-state[data-v-30f8d2fa]{text-align:center;padding:2rem 1rem;color:gray;font-size:.9rem}.journal-editor[data-v-30f8d2fa]{flex:1;display:flex;flex-direction:column;overflow:hidden}.editor-content[data-v-30f8d2fa]{display:flex;flex-direction:column;height:100%}.editor-header[data-v-30f8d2fa]{padding:1rem 1.5rem;background:hsla(0,0%,100%,.05);border-bottom:1px solid hsla(0,0%,100%,.1);display:flex;justify-content:space-between;align-items:center}.editor-header .editor-title[data-v-30f8d2fa]{font-size:1.1rem;font-weight:600;color:#f0f0f0;margin:0}.editor-header .editor-actions[data-v-30f8d2fa]{display:flex;gap:.5rem}.editor-header .editor-actions button[data-v-30f8d2fa]{padding:.5rem 1rem;border:none;border-radius:4px;font-size:.9rem;cursor:pointer;transition:all .2s}.editor-header .editor-actions button[data-v-30f8d2fa]:disabled{opacity:.5;cursor:not-allowed}.editor-header .editor-actions .btn-generate[data-v-30f8d2fa]{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff}.editor-header .editor-actions .btn-generate[data-v-30f8d2fa]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px rgba(102,126,234,.4)}.editor-header .editor-actions .btn-save[data-v-30f8d2fa]{background:linear-gradient(135deg,#4a9eff 0%,#2563eb 100%);color:#fff}.editor-header .editor-actions .btn-save[data-v-30f8d2fa]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px rgba(74,158,255,.4)}.editor-header .editor-actions .btn-delete[data-v-30f8d2fa]{background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);color:#fff}.editor-header .editor-actions .btn-delete[data-v-30f8d2fa]:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(239,68,68,.4)}.editor-header .editor-actions .btn-new[data-v-30f8d2fa]{background:hsla(0,0%,100%,.1);color:#e0e0e0}.editor-header .editor-actions .btn-new[data-v-30f8d2fa]:hover{background:hsla(0,0%,100%,.15)}.editor-body[data-v-30f8d2fa]{flex:1;padding:1.5rem;overflow:hidden}.editor-body .journal-textarea[data-v-30f8d2fa]{width:100%;height:100%;padding:1rem;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;color:#e0e0e0;font-size:1rem;line-height:1.8;font-family:"Microsoft YaHei",sans-serif;resize:none}.editor-body .journal-textarea[data-v-30f8d2fa]:focus{outline:none;border-color:#4a9eff;background:rgba(0,0,0,.4)}.editor-body .journal-textarea[data-v-30f8d2fa]:disabled{opacity:.6;cursor:not-allowed}.editor-body .journal-textarea[data-v-30f8d2fa]::placeholder{color:gray}.editor-footer[data-v-30f8d2fa]{padding:1rem 1.5rem;background:hsla(0,0%,100%,.05);border-top:1px solid hsla(0,0%,100%,.1)}.editor-footer .editor-hint[data-v-30f8d2fa]{margin:0;font-size:.85rem;color:#b0b0b0;line-height:1.5}.empty-editor[data-v-30f8d2fa]{display:flex;align-items:center;justify-content:center;height:100%;color:gray;font-size:1.1rem}
[data-v-efcbae3e]{box-sizing:border-box;margin:0;padding:0}body[data-v-efcbae3e]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-efcbae3e]::-webkit-scrollbar{width:8px;height:8px}[data-v-efcbae3e]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-efcbae3e]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-efcbae3e]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-efcbae3e]{color:#d4af37}.text-muted[data-v-efcbae3e]{color:#888}.bg-overlay[data-v-efcbae3e]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-efcbae3e]{border:2px solid #d4af37}.shadow-gold[data-v-efcbae3e]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-efcbae3e]{z-index:50 !important}.dialogue-box[data-v-efcbae3e],.combat-panel[data-v-efcbae3e],.character-panel[data-v-efcbae3e],.character-creator[data-v-efcbae3e],.instance-record[data-v-efcbae3e],.instance-generator[data-v-efcbae3e],.interaction-room[data-v-efcbae3e],.dice-roller[data-v-efcbae3e],.map-panel[data-v-efcbae3e],.plot-review[data-v-efcbae3e]{z-index:50 !important}[data-v-efcbae3e]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-efcbae3e]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-efcbae3e]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-efcbae3e],.dialogue-box[data-v-efcbae3e],.combat-panel[data-v-efcbae3e],.character-panel[data-v-efcbae3e],.character-creator[data-v-efcbae3e],.instance-record[data-v-efcbae3e],.instance-generator[data-v-efcbae3e],.interaction-room[data-v-efcbae3e],.dice-roller[data-v-efcbae3e],.map-panel[data-v-efcbae3e],.plot-review[data-v-efcbae3e]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-efcbae3e],.dialogue-box[data-v-efcbae3e],.combat-panel[data-v-efcbae3e],.character-panel[data-v-efcbae3e],.character-creator[data-v-efcbae3e],.instance-record[data-v-efcbae3e],.instance-generator[data-v-efcbae3e],.interaction-room[data-v-efcbae3e],.dice-roller[data-v-efcbae3e],.map-panel[data-v-efcbae3e],.plot-review[data-v-efcbae3e]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-efcbae3e],.dialogue-box[data-v-efcbae3e],.combat-panel[data-v-efcbae3e],.character-panel[data-v-efcbae3e],.character-creator[data-v-efcbae3e],.instance-record[data-v-efcbae3e],.instance-generator[data-v-efcbae3e],.interaction-room[data-v-efcbae3e],.dice-roller[data-v-efcbae3e],.map-panel[data-v-efcbae3e],.plot-review[data-v-efcbae3e]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-efcbae3e],.modal-overlay input[data-v-efcbae3e],.modal-overlay textarea[data-v-efcbae3e],.modal-overlay select[data-v-efcbae3e],.modal-overlay .btn[data-v-efcbae3e],.modal-overlay .form-control[data-v-efcbae3e],.modal-overlay .modal-title[data-v-efcbae3e],.modal-overlay .close-btn[data-v-efcbae3e],.dialogue-box button[data-v-efcbae3e],.dialogue-box input[data-v-efcbae3e],.dialogue-box textarea[data-v-efcbae3e],.dialogue-box select[data-v-efcbae3e],.dialogue-box .btn[data-v-efcbae3e],.dialogue-box .form-control[data-v-efcbae3e],.dialogue-box .modal-title[data-v-efcbae3e],.dialogue-box .close-btn[data-v-efcbae3e],.combat-panel button[data-v-efcbae3e],.combat-panel input[data-v-efcbae3e],.combat-panel textarea[data-v-efcbae3e],.combat-panel select[data-v-efcbae3e],.combat-panel .btn[data-v-efcbae3e],.combat-panel .form-control[data-v-efcbae3e],.combat-panel .modal-title[data-v-efcbae3e],.combat-panel .close-btn[data-v-efcbae3e],.character-panel button[data-v-efcbae3e],.character-panel input[data-v-efcbae3e],.character-panel textarea[data-v-efcbae3e],.character-panel select[data-v-efcbae3e],.character-panel .btn[data-v-efcbae3e],.character-panel .form-control[data-v-efcbae3e],.character-panel .modal-title[data-v-efcbae3e],.character-panel .close-btn[data-v-efcbae3e],.character-creator button[data-v-efcbae3e],.character-creator input[data-v-efcbae3e],.character-creator textarea[data-v-efcbae3e],.character-creator select[data-v-efcbae3e],.character-creator .btn[data-v-efcbae3e],.character-creator .form-control[data-v-efcbae3e],.character-creator .modal-title[data-v-efcbae3e],.character-creator .close-btn[data-v-efcbae3e],.instance-record button[data-v-efcbae3e],.instance-record input[data-v-efcbae3e],.instance-record textarea[data-v-efcbae3e],.instance-record select[data-v-efcbae3e],.instance-record .btn[data-v-efcbae3e],.instance-record .form-control[data-v-efcbae3e],.instance-record .modal-title[data-v-efcbae3e],.instance-record .close-btn[data-v-efcbae3e],.instance-generator button[data-v-efcbae3e],.instance-generator input[data-v-efcbae3e],.instance-generator textarea[data-v-efcbae3e],.instance-generator select[data-v-efcbae3e],.instance-generator .btn[data-v-efcbae3e],.instance-generator .form-control[data-v-efcbae3e],.instance-generator .modal-title[data-v-efcbae3e],.instance-generator .close-btn[data-v-efcbae3e],.interaction-room button[data-v-efcbae3e],.interaction-room input[data-v-efcbae3e],.interaction-room textarea[data-v-efcbae3e],.interaction-room select[data-v-efcbae3e],.interaction-room .btn[data-v-efcbae3e],.interaction-room .form-control[data-v-efcbae3e],.interaction-room .modal-title[data-v-efcbae3e],.interaction-room .close-btn[data-v-efcbae3e],.dice-roller button[data-v-efcbae3e],.dice-roller input[data-v-efcbae3e],.dice-roller textarea[data-v-efcbae3e],.dice-roller select[data-v-efcbae3e],.dice-roller .btn[data-v-efcbae3e],.dice-roller .form-control[data-v-efcbae3e],.dice-roller .modal-title[data-v-efcbae3e],.dice-roller .close-btn[data-v-efcbae3e],.map-panel button[data-v-efcbae3e],.map-panel input[data-v-efcbae3e],.map-panel textarea[data-v-efcbae3e],.map-panel select[data-v-efcbae3e],.map-panel .btn[data-v-efcbae3e],.map-panel .form-control[data-v-efcbae3e],.map-panel .modal-title[data-v-efcbae3e],.map-panel .close-btn[data-v-efcbae3e],.plot-review button[data-v-efcbae3e],.plot-review input[data-v-efcbae3e],.plot-review textarea[data-v-efcbae3e],.plot-review select[data-v-efcbae3e],.plot-review .btn[data-v-efcbae3e],.plot-review .form-control[data-v-efcbae3e],.plot-review .modal-title[data-v-efcbae3e],.plot-review .close-btn[data-v-efcbae3e]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-efcbae3e],.modal-overlay h2[data-v-efcbae3e],.modal-overlay h3[data-v-efcbae3e],.modal-overlay .modal-title[data-v-efcbae3e],.dialogue-box h1[data-v-efcbae3e],.dialogue-box h2[data-v-efcbae3e],.dialogue-box h3[data-v-efcbae3e],.dialogue-box .modal-title[data-v-efcbae3e],.combat-panel h1[data-v-efcbae3e],.combat-panel h2[data-v-efcbae3e],.combat-panel h3[data-v-efcbae3e],.combat-panel .modal-title[data-v-efcbae3e],.character-panel h1[data-v-efcbae3e],.character-panel h2[data-v-efcbae3e],.character-panel h3[data-v-efcbae3e],.character-panel .modal-title[data-v-efcbae3e],.character-creator h1[data-v-efcbae3e],.character-creator h2[data-v-efcbae3e],.character-creator h3[data-v-efcbae3e],.character-creator .modal-title[data-v-efcbae3e],.instance-record h1[data-v-efcbae3e],.instance-record h2[data-v-efcbae3e],.instance-record h3[data-v-efcbae3e],.instance-record .modal-title[data-v-efcbae3e],.instance-generator h1[data-v-efcbae3e],.instance-generator h2[data-v-efcbae3e],.instance-generator h3[data-v-efcbae3e],.instance-generator .modal-title[data-v-efcbae3e],.interaction-room h1[data-v-efcbae3e],.interaction-room h2[data-v-efcbae3e],.interaction-room h3[data-v-efcbae3e],.interaction-room .modal-title[data-v-efcbae3e],.dice-roller h1[data-v-efcbae3e],.dice-roller h2[data-v-efcbae3e],.dice-roller h3[data-v-efcbae3e],.dice-roller .modal-title[data-v-efcbae3e],.map-panel h1[data-v-efcbae3e],.map-panel h2[data-v-efcbae3e],.map-panel h3[data-v-efcbae3e],.map-panel .modal-title[data-v-efcbae3e],.plot-review h1[data-v-efcbae3e],.plot-review h2[data-v-efcbae3e],.plot-review h3[data-v-efcbae3e],.plot-review .modal-title[data-v-efcbae3e]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-efcbae3e],.modal-overlay .form-group[data-v-efcbae3e],.dialogue-box .button-group[data-v-efcbae3e],.dialogue-box .form-group[data-v-efcbae3e],.combat-panel .button-group[data-v-efcbae3e],.combat-panel .form-group[data-v-efcbae3e],.character-panel .button-group[data-v-efcbae3e],.character-panel .form-group[data-v-efcbae3e],.character-creator .button-group[data-v-efcbae3e],.character-creator .form-group[data-v-efcbae3e],.instance-record .button-group[data-v-efcbae3e],.instance-record .form-group[data-v-efcbae3e],.instance-generator .button-group[data-v-efcbae3e],.instance-generator .form-group[data-v-efcbae3e],.interaction-room .button-group[data-v-efcbae3e],.interaction-room .form-group[data-v-efcbae3e],.dice-roller .button-group[data-v-efcbae3e],.dice-roller .form-group[data-v-efcbae3e],.map-panel .button-group[data-v-efcbae3e],.map-panel .form-group[data-v-efcbae3e],.plot-review .button-group[data-v-efcbae3e],.plot-review .form-group[data-v-efcbae3e]{gap:calc(16px*var(--modal-scale))}.sanctuary-view[data-v-efcbae3e]{width:100%;height:100%;position:relative;overflow:hidden}.sanctuary-container[data-v-efcbae3e],.chat-container[data-v-efcbae3e]{width:100%;height:100%;position:relative}.sanctuary-background[data-v-efcbae3e]{width:100%;height:100%;background-size:cover;background-position:center;background-repeat:no-repeat;position:relative;background-color:#2a2a2a}.furniture-item[data-v-efcbae3e],.memento-item[data-v-efcbae3e]{position:absolute;cursor:pointer;transition:transform .15s ease}.furniture-item[data-v-efcbae3e]:hover,.memento-item[data-v-efcbae3e]:hover{transform:scale(1.05)}.furniture-item img[data-v-efcbae3e],.memento-item img[data-v-efcbae3e]{max-width:100px;max-height:100px;object-fit:contain}.placeholder-item[data-v-efcbae3e],.memento-placeholder[data-v-efcbae3e]{padding:8px 16px;background:rgba(0,0,0,.7);border:2px solid #d4af37;border-radius:4px;color:#d4af37;font-size:14px;white-space:nowrap}.sanctuary-actions[data-v-efcbae3e]{position:absolute;bottom:24px;left:50%;transform:translateX(-50%);display:flex;gap:16px;z-index:10}@media (max-width:767px){.sanctuary-actions[data-v-efcbae3e]{bottom:16px;gap:8px;flex-wrap:wrap;justify-content:center}}.action-btn[data-v-efcbae3e]{padding:8px 24px;background:rgba(0,0,0,.8);border:2px solid #d4af37;color:#d4af37;font-size:16px;cursor:pointer;transition:all .15s ease;font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif}@media (max-width:767px){.action-btn[data-v-efcbae3e]{padding:4px 16px;font-size:14px}}.action-btn[data-v-efcbae3e]:hover{background:rgba(212,175,55,.2);border-color:#d4af37;transform:translateY(-2px);box-shadow:0 0 20px rgba(212,175,55,.3)}.action-btn.close-btn[data-v-efcbae3e]{border-color:#333;color:#ccc}.action-btn.close-btn[data-v-efcbae3e]:hover{border-color:#ccc;background:hsla(0,0%,100%,.1)}.modal-overlay[data-v-efcbae3e]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:100}.invite-dialog[data-v-efcbae3e]{width:100%;max-width:800px;max-height:90vh;overflow-y:auto;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:32px;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.invite-dialog[data-v-efcbae3e]{max-width:95vw;max-height:95vh;padding:16px;border-width:1px}}@media (max-width:480px){.invite-dialog[data-v-efcbae3e]{max-width:98vw;padding:8px}}.invite-dialog[data-v-efcbae3e]{max-width:600px;width:90%;max-height:80vh;overflow-y:auto}.invite-dialog h3[data-v-efcbae3e]{--base-title-size:32px;font-size:32px;color:#d4af37;text-align:center;margin-bottom:32px;text-shadow:0 0 10px rgba(212,175,55,.5)}@media (max-width:767px){.invite-dialog h3[data-v-efcbae3e]{--base-title-size:24px;font-size:24px;margin-bottom:16px}}@media (max-width:480px){.invite-dialog h3[data-v-efcbae3e]{--base-title-size:20px;font-size:20px;margin-bottom:8px}}.invite-dialog h3[data-v-efcbae3e]{margin-bottom:24px}.journal-modal-container[data-v-efcbae3e]{width:90%;max-width:1200px;height:85vh;max-height:800px;border-radius:12px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.6)}@media (max-width:767px){.journal-modal-container[data-v-efcbae3e]{width:95%;height:90vh}}.npc-list[data-v-efcbae3e]{display:flex;flex-direction:column;gap:8px;margin-bottom:24px;max-height:400px;overflow-y:auto}.npc-option label[data-v-efcbae3e]{display:flex;align-items:center;gap:16px;padding:16px;background:rgba(0,0,0,.4);border:1px solid #333;border-radius:4px;cursor:pointer;transition:all .15s ease}.npc-option label[data-v-efcbae3e]:hover{border-color:#d4af37;background:rgba(212,175,55,.1)}.npc-option label input[type=checkbox][data-v-efcbae3e]{width:20px;height:20px;cursor:pointer}.npc-name[data-v-efcbae3e]{font-weight:700;color:#f5f5f5;flex:0 0 auto}.npc-info[data-v-efcbae3e]{color:#ccc;font-size:14px;flex:1}.dialog-actions[data-v-efcbae3e]{display:flex;gap:16px;justify-content:flex-end}@media (max-width:767px){.dialog-actions[data-v-efcbae3e]{flex-direction:column}}.btn-primary[data-v-efcbae3e],.btn-secondary[data-v-efcbae3e]{padding:8px 24px;font-size:16px;cursor:pointer;transition:all .15s ease;font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif}@media (max-width:767px){.btn-primary[data-v-efcbae3e],.btn-secondary[data-v-efcbae3e]{padding:8px 16px;font-size:14px}}.btn-primary[data-v-efcbae3e]{background:#d4af37;color:#0a0a0a;border:2px solid #d4af37}.btn-primary[data-v-efcbae3e]:hover:not(:disabled){background:rgb(221.024691358,191.7901234568,96.975308642);transform:translateY(-2px);box-shadow:0 0 20px rgba(212,175,55,.3)}.btn-primary[data-v-efcbae3e]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[data-v-efcbae3e]{background:rgba(0,0,0,0);color:#ccc;border:2px solid #333}.btn-secondary[data-v-efcbae3e]:hover{border-color:#ccc;color:#f5f5f5}.placeholder-text[data-v-efcbae3e]{color:#ccc;text-align:center;padding:32px;font-size:16px}.chat-container[data-v-efcbae3e]{display:flex;flex-direction:column;background:#0f0f0f}.chat-header[data-v-efcbae3e]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background:rgba(0,0,0,.8);border-bottom:2px solid #d4af37}@media (max-width:767px){.chat-header[data-v-efcbae3e]{padding:8px 16px}}.chat-title[data-v-efcbae3e]{font-size:18px;font-weight:700;color:#d4af37}@media (max-width:767px){.chat-title[data-v-efcbae3e]{font-size:16px}}.back-btn[data-v-efcbae3e]{padding:4px 16px;background:rgba(0,0,0,0);border:2px solid #333;color:#ccc;font-size:14px;cursor:pointer;transition:all .15s ease;font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif}.back-btn[data-v-efcbae3e]:hover{border-color:#ccc;color:#f5f5f5;background:hsla(0,0%,100%,.1)}.chat-messages[data-v-efcbae3e]{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:16px}@media (max-width:767px){.chat-messages[data-v-efcbae3e]{padding:16px;gap:8px}}.no-messages[data-v-efcbae3e]{text-align:center;color:#ccc;padding:32px;font-size:16px}.message-item[data-v-efcbae3e]{display:flex;animation:fadeIn-efcbae3e .3s ease-in-out}.message-item.user[data-v-efcbae3e]{justify-content:flex-end}.message-item.user .message-content[data-v-efcbae3e]{background:rgba(212,175,55,.2);border-color:#d4af37}.message-item.assistant[data-v-efcbae3e]{justify-content:flex-start}.message-item.assistant .message-content[data-v-efcbae3e]{background:rgba(0,0,0,.6);border-color:#555}.message-content[data-v-efcbae3e]{max-width:70%;padding:16px;border:1px solid;border-radius:8px;word-wrap:break-word}@media (max-width:767px){.message-content[data-v-efcbae3e]{max-width:85%;padding:8px}}.message-author[data-v-efcbae3e]{font-size:14px;font-weight:700;color:#d4af37;margin-bottom:4px}.message-text[data-v-efcbae3e]{font-size:16px;color:#f5f5f5;line-height:1.6;white-space:pre-wrap}@media (max-width:767px){.message-text[data-v-efcbae3e]{font-size:14px}}.chat-input-container[data-v-efcbae3e]{padding:16px 24px;background:rgba(0,0,0,.8);border-top:2px solid #d4af37;display:flex;gap:16px;align-items:flex-end}@media (max-width:767px){.chat-input-container[data-v-efcbae3e]{padding:8px 16px;gap:8px}}.chat-input[data-v-efcbae3e]{flex:1;min-height:60px;max-height:120px;padding:8px;background:rgba(0,0,0,.5);border:1px solid #555;border-radius:4px;color:#f5f5f5;font-size:16px;font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;resize:vertical;outline:none;transition:border-color .15s ease}@media (max-width:767px){.chat-input[data-v-efcbae3e]{min-height:50px;max-height:80px;font-size:16px}}.chat-input[data-v-efcbae3e]:focus{border-color:#d4af37}.chat-input[data-v-efcbae3e]::placeholder{color:#888}.send-btn[data-v-efcbae3e]{padding:8px 24px;background:#d4af37;color:#0a0a0a;border:2px solid #d4af37;font-size:16px;font-weight:700;cursor:pointer;transition:all .15s ease;white-space:nowrap;font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif}@media (max-width:767px){.send-btn[data-v-efcbae3e]{padding:4px 16px;font-size:14px}}.send-btn[data-v-efcbae3e]:hover:not(:disabled){background:rgb(221.024691358,191.7901234568,96.975308642);transform:translateY(-2px);box-shadow:0 0 20px rgba(212,175,55,.3)}.send-btn[data-v-efcbae3e]:disabled{opacity:.5;cursor:not-allowed}@keyframes fadeIn-efcbae3e{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
[data-v-0bbeca14]{box-sizing:border-box;margin:0;padding:0}body[data-v-0bbeca14]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-0bbeca14]::-webkit-scrollbar{width:8px;height:8px}[data-v-0bbeca14]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-0bbeca14]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-0bbeca14]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-0bbeca14]{color:#d4af37}.text-muted[data-v-0bbeca14]{color:#888}.bg-overlay[data-v-0bbeca14]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-0bbeca14]{border:2px solid #d4af37}.shadow-gold[data-v-0bbeca14]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-0bbeca14]{z-index:50 !important}.dialogue-box[data-v-0bbeca14],.combat-panel[data-v-0bbeca14],.character-panel[data-v-0bbeca14],.character-creator[data-v-0bbeca14],.instance-record[data-v-0bbeca14],.instance-generator[data-v-0bbeca14],.interaction-room[data-v-0bbeca14],.dice-roller[data-v-0bbeca14],.map-panel[data-v-0bbeca14],.plot-review[data-v-0bbeca14]{z-index:50 !important}[data-v-0bbeca14]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-0bbeca14]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-0bbeca14]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-0bbeca14],.dialogue-box[data-v-0bbeca14],.combat-panel[data-v-0bbeca14],.character-panel[data-v-0bbeca14],.character-creator[data-v-0bbeca14],.instance-record[data-v-0bbeca14],.instance-generator[data-v-0bbeca14],.interaction-room[data-v-0bbeca14],.dice-roller[data-v-0bbeca14],.map-panel[data-v-0bbeca14],.plot-review[data-v-0bbeca14]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-0bbeca14],.dialogue-box[data-v-0bbeca14],.combat-panel[data-v-0bbeca14],.character-panel[data-v-0bbeca14],.character-creator[data-v-0bbeca14],.instance-record[data-v-0bbeca14],.instance-generator[data-v-0bbeca14],.interaction-room[data-v-0bbeca14],.dice-roller[data-v-0bbeca14],.map-panel[data-v-0bbeca14],.plot-review[data-v-0bbeca14]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-0bbeca14],.dialogue-box[data-v-0bbeca14],.combat-panel[data-v-0bbeca14],.character-panel[data-v-0bbeca14],.character-creator[data-v-0bbeca14],.instance-record[data-v-0bbeca14],.instance-generator[data-v-0bbeca14],.interaction-room[data-v-0bbeca14],.dice-roller[data-v-0bbeca14],.map-panel[data-v-0bbeca14],.plot-review[data-v-0bbeca14]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-0bbeca14],.modal-overlay input[data-v-0bbeca14],.modal-overlay textarea[data-v-0bbeca14],.modal-overlay select[data-v-0bbeca14],.modal-overlay .btn[data-v-0bbeca14],.modal-overlay .form-control[data-v-0bbeca14],.modal-overlay .modal-title[data-v-0bbeca14],.modal-overlay .close-btn[data-v-0bbeca14],.dialogue-box button[data-v-0bbeca14],.dialogue-box input[data-v-0bbeca14],.dialogue-box textarea[data-v-0bbeca14],.dialogue-box select[data-v-0bbeca14],.dialogue-box .btn[data-v-0bbeca14],.dialogue-box .form-control[data-v-0bbeca14],.dialogue-box .modal-title[data-v-0bbeca14],.dialogue-box .close-btn[data-v-0bbeca14],.combat-panel button[data-v-0bbeca14],.combat-panel input[data-v-0bbeca14],.combat-panel textarea[data-v-0bbeca14],.combat-panel select[data-v-0bbeca14],.combat-panel .btn[data-v-0bbeca14],.combat-panel .form-control[data-v-0bbeca14],.combat-panel .modal-title[data-v-0bbeca14],.combat-panel .close-btn[data-v-0bbeca14],.character-panel button[data-v-0bbeca14],.character-panel input[data-v-0bbeca14],.character-panel textarea[data-v-0bbeca14],.character-panel select[data-v-0bbeca14],.character-panel .btn[data-v-0bbeca14],.character-panel .form-control[data-v-0bbeca14],.character-panel .modal-title[data-v-0bbeca14],.character-panel .close-btn[data-v-0bbeca14],.character-creator button[data-v-0bbeca14],.character-creator input[data-v-0bbeca14],.character-creator textarea[data-v-0bbeca14],.character-creator select[data-v-0bbeca14],.character-creator .btn[data-v-0bbeca14],.character-creator .form-control[data-v-0bbeca14],.character-creator .modal-title[data-v-0bbeca14],.character-creator .close-btn[data-v-0bbeca14],.instance-record button[data-v-0bbeca14],.instance-record input[data-v-0bbeca14],.instance-record textarea[data-v-0bbeca14],.instance-record select[data-v-0bbeca14],.instance-record .btn[data-v-0bbeca14],.instance-record .form-control[data-v-0bbeca14],.instance-record .modal-title[data-v-0bbeca14],.instance-record .close-btn[data-v-0bbeca14],.instance-generator button[data-v-0bbeca14],.instance-generator input[data-v-0bbeca14],.instance-generator textarea[data-v-0bbeca14],.instance-generator select[data-v-0bbeca14],.instance-generator .btn[data-v-0bbeca14],.instance-generator .form-control[data-v-0bbeca14],.instance-generator .modal-title[data-v-0bbeca14],.instance-generator .close-btn[data-v-0bbeca14],.interaction-room button[data-v-0bbeca14],.interaction-room input[data-v-0bbeca14],.interaction-room textarea[data-v-0bbeca14],.interaction-room select[data-v-0bbeca14],.interaction-room .btn[data-v-0bbeca14],.interaction-room .form-control[data-v-0bbeca14],.interaction-room .modal-title[data-v-0bbeca14],.interaction-room .close-btn[data-v-0bbeca14],.dice-roller button[data-v-0bbeca14],.dice-roller input[data-v-0bbeca14],.dice-roller textarea[data-v-0bbeca14],.dice-roller select[data-v-0bbeca14],.dice-roller .btn[data-v-0bbeca14],.dice-roller .form-control[data-v-0bbeca14],.dice-roller .modal-title[data-v-0bbeca14],.dice-roller .close-btn[data-v-0bbeca14],.map-panel button[data-v-0bbeca14],.map-panel input[data-v-0bbeca14],.map-panel textarea[data-v-0bbeca14],.map-panel select[data-v-0bbeca14],.map-panel .btn[data-v-0bbeca14],.map-panel .form-control[data-v-0bbeca14],.map-panel .modal-title[data-v-0bbeca14],.map-panel .close-btn[data-v-0bbeca14],.plot-review button[data-v-0bbeca14],.plot-review input[data-v-0bbeca14],.plot-review textarea[data-v-0bbeca14],.plot-review select[data-v-0bbeca14],.plot-review .btn[data-v-0bbeca14],.plot-review .form-control[data-v-0bbeca14],.plot-review .modal-title[data-v-0bbeca14],.plot-review .close-btn[data-v-0bbeca14]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-0bbeca14],.modal-overlay h2[data-v-0bbeca14],.modal-overlay h3[data-v-0bbeca14],.modal-overlay .modal-title[data-v-0bbeca14],.dialogue-box h1[data-v-0bbeca14],.dialogue-box h2[data-v-0bbeca14],.dialogue-box h3[data-v-0bbeca14],.dialogue-box .modal-title[data-v-0bbeca14],.combat-panel h1[data-v-0bbeca14],.combat-panel h2[data-v-0bbeca14],.combat-panel h3[data-v-0bbeca14],.combat-panel .modal-title[data-v-0bbeca14],.character-panel h1[data-v-0bbeca14],.character-panel h2[data-v-0bbeca14],.character-panel h3[data-v-0bbeca14],.character-panel .modal-title[data-v-0bbeca14],.character-creator h1[data-v-0bbeca14],.character-creator h2[data-v-0bbeca14],.character-creator h3[data-v-0bbeca14],.character-creator .modal-title[data-v-0bbeca14],.instance-record h1[data-v-0bbeca14],.instance-record h2[data-v-0bbeca14],.instance-record h3[data-v-0bbeca14],.instance-record .modal-title[data-v-0bbeca14],.instance-generator h1[data-v-0bbeca14],.instance-generator h2[data-v-0bbeca14],.instance-generator h3[data-v-0bbeca14],.instance-generator .modal-title[data-v-0bbeca14],.interaction-room h1[data-v-0bbeca14],.interaction-room h2[data-v-0bbeca14],.interaction-room h3[data-v-0bbeca14],.interaction-room .modal-title[data-v-0bbeca14],.dice-roller h1[data-v-0bbeca14],.dice-roller h2[data-v-0bbeca14],.dice-roller h3[data-v-0bbeca14],.dice-roller .modal-title[data-v-0bbeca14],.map-panel h1[data-v-0bbeca14],.map-panel h2[data-v-0bbeca14],.map-panel h3[data-v-0bbeca14],.map-panel .modal-title[data-v-0bbeca14],.plot-review h1[data-v-0bbeca14],.plot-review h2[data-v-0bbeca14],.plot-review h3[data-v-0bbeca14],.plot-review .modal-title[data-v-0bbeca14]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-0bbeca14],.modal-overlay .form-group[data-v-0bbeca14],.dialogue-box .button-group[data-v-0bbeca14],.dialogue-box .form-group[data-v-0bbeca14],.combat-panel .button-group[data-v-0bbeca14],.combat-panel .form-group[data-v-0bbeca14],.character-panel .button-group[data-v-0bbeca14],.character-panel .form-group[data-v-0bbeca14],.character-creator .button-group[data-v-0bbeca14],.character-creator .form-group[data-v-0bbeca14],.instance-record .button-group[data-v-0bbeca14],.instance-record .form-group[data-v-0bbeca14],.instance-generator .button-group[data-v-0bbeca14],.instance-generator .form-group[data-v-0bbeca14],.interaction-room .button-group[data-v-0bbeca14],.interaction-room .form-group[data-v-0bbeca14],.dice-roller .button-group[data-v-0bbeca14],.dice-roller .form-group[data-v-0bbeca14],.map-panel .button-group[data-v-0bbeca14],.map-panel .form-group[data-v-0bbeca14],.plot-review .button-group[data-v-0bbeca14],.plot-review .form-group[data-v-0bbeca14]{gap:calc(16px*var(--modal-scale))}.status-bar[data-v-0bbeca14]{position:fixed;top:90px;left:24px;width:220px;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;padding:8px 16px;z-index:20;box-shadow:0 4px 8px rgba(0,0,0,.4)}@media (max-width:767px){.status-bar[data-v-0bbeca14]{top:48px;left:8px;width:160px;padding:4px 8px;border-width:1px}}.character-name[data-v-0bbeca14]{font-size:16px;font-weight:700;color:#d4af37;text-align:center;margin-bottom:8px;text-shadow:0 0 10px rgba(212,175,55,.5)}@media (max-width:767px){.character-name[data-v-0bbeca14]{font-size:14px;margin-bottom:4px}}.status-bars[data-v-0bbeca14]{display:flex;flex-direction:column;gap:4px}.stat-row[data-v-0bbeca14]{display:flex;align-items:center;gap:8px}.stat-label[data-v-0bbeca14]{font-size:12px;font-weight:700;color:#ccc;width:32px;text-align:right}.progress-bar[data-v-0bbeca14]{position:relative;flex:1;height:20px;background:rgba(0,0,0,.5);border:1px solid #333;border-radius:4px;overflow:hidden}@media (max-width:767px){.progress-bar[data-v-0bbeca14]{height:16px}}.progress-fill[data-v-0bbeca14]{position:absolute;top:0;left:0;height:100%;transition:width .3s ease}.hp-bar .progress-fill[data-v-0bbeca14]{background:linear-gradient(90deg,rgb(213.698630137,43.8356164384,26.301369863),#e74c3c)}.mp-bar .progress-fill[data-v-0bbeca14]{background:linear-gradient(90deg,rgb(33.1380753138,125.1882845188,186.8619246862),#3498db)}.san-bar .progress-fill[data-v-0bbeca14]{background:linear-gradient(90deg,rgb(127.949790795,67.1966527197,152.8033472803),#9b59b6)}.stat-value[data-v-0bbeca14]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:12px;font-weight:700;color:#f5f5f5;text-shadow:0 1px 2px rgba(0,0,0,.8);z-index:1}
.test-panel[data-v-12099c54]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:800px;max-height:80vh;background:rgba(20,20,30,.95);border:2px solid #d4af37;border-radius:8px;box-shadow:0 8px 32px rgba(0,0,0,.8);z-index:1000;overflow:hidden;display:flex;flex-direction:column}.test-header[data-v-12099c54]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background:linear-gradient(135deg,#d4af37,#aa8c2e);color:#1a1a2e}.test-header h2[data-v-12099c54]{margin:0;font-size:20px;font-weight:bold}.test-header .close-btn[data-v-12099c54]{background:none;border:none;color:#1a1a2e;font-size:24px;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:background .2s}.test-header .close-btn[data-v-12099c54]:hover{background:rgba(0,0,0,.1)}.test-content[data-v-12099c54]{flex:1;overflow-y:auto;padding:24px}.test-section[data-v-12099c54]{margin-bottom:32px;padding:16px;background:hsla(0,0%,100%,.05);border-radius:8px;border:1px solid rgba(212,175,55,.3)}.test-section h3[data-v-12099c54]{margin:0 0 16px 0;color:#d4af37;font-size:18px}.test-section .test-actions[data-v-12099c54]{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:16px}.test-section .test-actions button[data-v-12099c54]{padding:8px 16px;background:rgba(212,175,55,.2);border:1px solid #d4af37;border-radius:4px;color:#d4af37;cursor:pointer;transition:all .2s;font-size:14px}.test-section .test-actions button[data-v-12099c54]:hover{background:rgba(212,175,55,.3);transform:translateY(-2px)}.test-section .test-actions button.primary-btn[data-v-12099c54]{background:linear-gradient(135deg,#d4af37,#aa8c2e);color:#1a1a2e;font-weight:bold}.test-section .test-actions button.primary-btn[data-v-12099c54]:hover{background:linear-gradient(135deg,#e5c158,#d4af37)}.test-section .test-result[data-v-12099c54]{padding:12px;background:rgba(0,0,0,.3);border-radius:4px;color:#e0e0e0;font-size:13px;line-height:1.6;white-space:pre-wrap;word-break:break-word;max-height:300px;overflow-y:auto}.test-section .test-result pre[data-v-12099c54]{margin:0;font-family:"Courier New",monospace;font-size:12px}
[data-v-1cd92598]{box-sizing:border-box;margin:0;padding:0}body[data-v-1cd92598]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-1cd92598]::-webkit-scrollbar{width:8px;height:8px}[data-v-1cd92598]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-1cd92598]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-1cd92598]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-1cd92598]{color:#d4af37}.text-muted[data-v-1cd92598]{color:#888}.bg-overlay[data-v-1cd92598]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-1cd92598]{border:2px solid #d4af37}.shadow-gold[data-v-1cd92598]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-1cd92598]{z-index:50 !important}.dialogue-box[data-v-1cd92598],.combat-panel[data-v-1cd92598],.character-panel[data-v-1cd92598],.character-creator[data-v-1cd92598],.instance-record[data-v-1cd92598],.instance-generator[data-v-1cd92598],.interaction-room[data-v-1cd92598],.dice-roller[data-v-1cd92598],.map-panel[data-v-1cd92598],.plot-review[data-v-1cd92598]{z-index:50 !important}[data-v-1cd92598]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-1cd92598]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-1cd92598]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-1cd92598],.dialogue-box[data-v-1cd92598],.combat-panel[data-v-1cd92598],.character-panel[data-v-1cd92598],.character-creator[data-v-1cd92598],.instance-record[data-v-1cd92598],.instance-generator[data-v-1cd92598],.interaction-room[data-v-1cd92598],.dice-roller[data-v-1cd92598],.map-panel[data-v-1cd92598],.plot-review[data-v-1cd92598]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-1cd92598],.dialogue-box[data-v-1cd92598],.combat-panel[data-v-1cd92598],.character-panel[data-v-1cd92598],.character-creator[data-v-1cd92598],.instance-record[data-v-1cd92598],.instance-generator[data-v-1cd92598],.interaction-room[data-v-1cd92598],.dice-roller[data-v-1cd92598],.map-panel[data-v-1cd92598],.plot-review[data-v-1cd92598]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-1cd92598],.dialogue-box[data-v-1cd92598],.combat-panel[data-v-1cd92598],.character-panel[data-v-1cd92598],.character-creator[data-v-1cd92598],.instance-record[data-v-1cd92598],.instance-generator[data-v-1cd92598],.interaction-room[data-v-1cd92598],.dice-roller[data-v-1cd92598],.map-panel[data-v-1cd92598],.plot-review[data-v-1cd92598]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-1cd92598],.modal-overlay input[data-v-1cd92598],.modal-overlay textarea[data-v-1cd92598],.modal-overlay select[data-v-1cd92598],.modal-overlay .btn[data-v-1cd92598],.modal-overlay .form-control[data-v-1cd92598],.modal-overlay .modal-title[data-v-1cd92598],.modal-overlay .close-btn[data-v-1cd92598],.dialogue-box button[data-v-1cd92598],.dialogue-box input[data-v-1cd92598],.dialogue-box textarea[data-v-1cd92598],.dialogue-box select[data-v-1cd92598],.dialogue-box .btn[data-v-1cd92598],.dialogue-box .form-control[data-v-1cd92598],.dialogue-box .modal-title[data-v-1cd92598],.dialogue-box .close-btn[data-v-1cd92598],.combat-panel button[data-v-1cd92598],.combat-panel input[data-v-1cd92598],.combat-panel textarea[data-v-1cd92598],.combat-panel select[data-v-1cd92598],.combat-panel .btn[data-v-1cd92598],.combat-panel .form-control[data-v-1cd92598],.combat-panel .modal-title[data-v-1cd92598],.combat-panel .close-btn[data-v-1cd92598],.character-panel button[data-v-1cd92598],.character-panel input[data-v-1cd92598],.character-panel textarea[data-v-1cd92598],.character-panel select[data-v-1cd92598],.character-panel .btn[data-v-1cd92598],.character-panel .form-control[data-v-1cd92598],.character-panel .modal-title[data-v-1cd92598],.character-panel .close-btn[data-v-1cd92598],.character-creator button[data-v-1cd92598],.character-creator input[data-v-1cd92598],.character-creator textarea[data-v-1cd92598],.character-creator select[data-v-1cd92598],.character-creator .btn[data-v-1cd92598],.character-creator .form-control[data-v-1cd92598],.character-creator .modal-title[data-v-1cd92598],.character-creator .close-btn[data-v-1cd92598],.instance-record button[data-v-1cd92598],.instance-record input[data-v-1cd92598],.instance-record textarea[data-v-1cd92598],.instance-record select[data-v-1cd92598],.instance-record .btn[data-v-1cd92598],.instance-record .form-control[data-v-1cd92598],.instance-record .modal-title[data-v-1cd92598],.instance-record .close-btn[data-v-1cd92598],.instance-generator button[data-v-1cd92598],.instance-generator input[data-v-1cd92598],.instance-generator textarea[data-v-1cd92598],.instance-generator select[data-v-1cd92598],.instance-generator .btn[data-v-1cd92598],.instance-generator .form-control[data-v-1cd92598],.instance-generator .modal-title[data-v-1cd92598],.instance-generator .close-btn[data-v-1cd92598],.interaction-room button[data-v-1cd92598],.interaction-room input[data-v-1cd92598],.interaction-room textarea[data-v-1cd92598],.interaction-room select[data-v-1cd92598],.interaction-room .btn[data-v-1cd92598],.interaction-room .form-control[data-v-1cd92598],.interaction-room .modal-title[data-v-1cd92598],.interaction-room .close-btn[data-v-1cd92598],.dice-roller button[data-v-1cd92598],.dice-roller input[data-v-1cd92598],.dice-roller textarea[data-v-1cd92598],.dice-roller select[data-v-1cd92598],.dice-roller .btn[data-v-1cd92598],.dice-roller .form-control[data-v-1cd92598],.dice-roller .modal-title[data-v-1cd92598],.dice-roller .close-btn[data-v-1cd92598],.map-panel button[data-v-1cd92598],.map-panel input[data-v-1cd92598],.map-panel textarea[data-v-1cd92598],.map-panel select[data-v-1cd92598],.map-panel .btn[data-v-1cd92598],.map-panel .form-control[data-v-1cd92598],.map-panel .modal-title[data-v-1cd92598],.map-panel .close-btn[data-v-1cd92598],.plot-review button[data-v-1cd92598],.plot-review input[data-v-1cd92598],.plot-review textarea[data-v-1cd92598],.plot-review select[data-v-1cd92598],.plot-review .btn[data-v-1cd92598],.plot-review .form-control[data-v-1cd92598],.plot-review .modal-title[data-v-1cd92598],.plot-review .close-btn[data-v-1cd92598]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-1cd92598],.modal-overlay h2[data-v-1cd92598],.modal-overlay h3[data-v-1cd92598],.modal-overlay .modal-title[data-v-1cd92598],.dialogue-box h1[data-v-1cd92598],.dialogue-box h2[data-v-1cd92598],.dialogue-box h3[data-v-1cd92598],.dialogue-box .modal-title[data-v-1cd92598],.combat-panel h1[data-v-1cd92598],.combat-panel h2[data-v-1cd92598],.combat-panel h3[data-v-1cd92598],.combat-panel .modal-title[data-v-1cd92598],.character-panel h1[data-v-1cd92598],.character-panel h2[data-v-1cd92598],.character-panel h3[data-v-1cd92598],.character-panel .modal-title[data-v-1cd92598],.character-creator h1[data-v-1cd92598],.character-creator h2[data-v-1cd92598],.character-creator h3[data-v-1cd92598],.character-creator .modal-title[data-v-1cd92598],.instance-record h1[data-v-1cd92598],.instance-record h2[data-v-1cd92598],.instance-record h3[data-v-1cd92598],.instance-record .modal-title[data-v-1cd92598],.instance-generator h1[data-v-1cd92598],.instance-generator h2[data-v-1cd92598],.instance-generator h3[data-v-1cd92598],.instance-generator .modal-title[data-v-1cd92598],.interaction-room h1[data-v-1cd92598],.interaction-room h2[data-v-1cd92598],.interaction-room h3[data-v-1cd92598],.interaction-room .modal-title[data-v-1cd92598],.dice-roller h1[data-v-1cd92598],.dice-roller h2[data-v-1cd92598],.dice-roller h3[data-v-1cd92598],.dice-roller .modal-title[data-v-1cd92598],.map-panel h1[data-v-1cd92598],.map-panel h2[data-v-1cd92598],.map-panel h3[data-v-1cd92598],.map-panel .modal-title[data-v-1cd92598],.plot-review h1[data-v-1cd92598],.plot-review h2[data-v-1cd92598],.plot-review h3[data-v-1cd92598],.plot-review .modal-title[data-v-1cd92598]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-1cd92598],.modal-overlay .form-group[data-v-1cd92598],.dialogue-box .button-group[data-v-1cd92598],.dialogue-box .form-group[data-v-1cd92598],.combat-panel .button-group[data-v-1cd92598],.combat-panel .form-group[data-v-1cd92598],.character-panel .button-group[data-v-1cd92598],.character-panel .form-group[data-v-1cd92598],.character-creator .button-group[data-v-1cd92598],.character-creator .form-group[data-v-1cd92598],.instance-record .button-group[data-v-1cd92598],.instance-record .form-group[data-v-1cd92598],.instance-generator .button-group[data-v-1cd92598],.instance-generator .form-group[data-v-1cd92598],.interaction-room .button-group[data-v-1cd92598],.interaction-room .form-group[data-v-1cd92598],.dice-roller .button-group[data-v-1cd92598],.dice-roller .form-group[data-v-1cd92598],.map-panel .button-group[data-v-1cd92598],.map-panel .form-group[data-v-1cd92598],.plot-review .button-group[data-v-1cd92598],.plot-review .form-group[data-v-1cd92598]{gap:calc(16px*var(--modal-scale))}.fade-enter-active[data-v-1cd92598],.fade-leave-active[data-v-1cd92598]{transition:opacity .3s ease}.fade-enter-from[data-v-1cd92598],.fade-leave-to[data-v-1cd92598]{opacity:0}.scale-enter-active[data-v-1cd92598],.scale-leave-active[data-v-1cd92598]{transition:all .3s ease}.scale-enter-from[data-v-1cd92598],.scale-leave-to[data-v-1cd92598]{opacity:0;transform:scale(0.9)}.confirm-dialog-overlay[data-v-1cd92598]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:calc(70 + 10);backdrop-filter:blur(5px);padding:16px}@media (max-width:767px){.confirm-dialog-overlay[data-v-1cd92598]{padding:8px}}.confirm-dialog[data-v-1cd92598]{background:linear-gradient(135deg,rgba(20,20,30,0.98),rgba(40,40,60,0.98));border:2px solid #d4af37;border-radius:12px;padding:48px;box-shadow:0 0 50px rgba(212,175,55,.4),0 8px 16px rgba(0,0,0,.5);max-width:500px;width:100%;animation:pulse-glow-1cd92598 2s ease-in-out infinite}@media (max-width:767px){.confirm-dialog[data-v-1cd92598]{padding:32px;border-width:1px;max-width:95%}}@media (max-width:480px){.confirm-dialog[data-v-1cd92598]{padding:24px;border-radius:8px}}@keyframes pulse-glow-1cd92598{0%,100%{box-shadow:0 0 50px rgba(212,175,55,.4),0 8px 16px rgba(0,0,0,.5)}50%{box-shadow:0 0 60px rgba(212,175,55,.6),0 8px 16px rgba(0,0,0,.5)}}.dialog-title[data-v-1cd92598]{font-size:24px;font-weight:700;color:#d4af37;text-align:center;margin:0 0 24px 0;text-shadow:0 0 10px rgba(212,175,55,.5)}@media (max-width:767px){.dialog-title[data-v-1cd92598]{font-size:20px;margin-bottom:16px}}@media (max-width:480px){.dialog-title[data-v-1cd92598]{font-size:18px;margin-bottom:8px}}.dialog-message[data-v-1cd92598]{font-size:16px;color:#ccc;text-align:center;line-height:1.8;margin:0 0 32px 0;white-space:pre-line}@media (max-width:767px){.dialog-message[data-v-1cd92598]{font-size:14px;margin-bottom:24px;line-height:1.6}}@media (max-width:480px){.dialog-message[data-v-1cd92598]{font-size:12px;margin-bottom:16px}}.dialog-buttons[data-v-1cd92598]{display:flex;gap:16px;justify-content:center}@media (max-width:767px){.dialog-buttons[data-v-1cd92598]{gap:8px;flex-direction:column-reverse}}.btn-dialog[data-v-1cd92598]{padding:16px 32px;border:2px solid;border-radius:8px;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease;min-width:120px;text-shadow:0 0 10px rgba(0,0,0,.5)}@media (max-width:767px){.btn-dialog[data-v-1cd92598]{padding:8px 24px;font-size:14px;border-width:1px;min-width:100px}}@media (max-width:480px){.btn-dialog[data-v-1cd92598]{padding:8px 16px;font-size:12px;min-width:80px}}.btn-dialog[data-v-1cd92598]:active{transform:scale(0.98)}.btn-cancel[data-v-1cd92598]{background:linear-gradient(135deg,rgba(128,128,128,0.3),rgba(128,128,128,0.5));border-color:#888;color:#ccc;box-shadow:0 0 20px rgba(128,128,128,.2)}.btn-cancel[data-v-1cd92598]:hover{background:linear-gradient(135deg,rgba(128,128,128,0.5),rgba(128,128,128,0.7));box-shadow:0 0 30px rgba(128,128,128,.4);transform:translateY(-2px)}@media (max-width:767px){.btn-cancel[data-v-1cd92598]:hover{transform:translateY(-1px)}}.btn-confirm[data-v-1cd92598]{background:linear-gradient(135deg,rgba(33,150,243,0.3),rgba(33,150,243,0.5));border-color:#2196f3;color:#2196f3;box-shadow:0 0 20px rgba(33,150,243,.3)}.btn-confirm[data-v-1cd92598]:hover{background:linear-gradient(135deg,rgba(33,150,243,0.5),rgba(33,150,243,0.7));box-shadow:0 0 30px rgba(33,150,243,.5);transform:translateY(-2px)}@media (max-width:767px){.btn-confirm[data-v-1cd92598]:hover{transform:translateY(-1px)}}.btn-confirm.btn-danger[data-v-1cd92598]{background:linear-gradient(135deg,rgba(244,67,54,0.3),rgba(244,67,54,0.5));border-color:#f44336;color:#f44336;box-shadow:0 0 20px rgba(244,67,54,.3)}.btn-confirm.btn-danger[data-v-1cd92598]:hover{background:linear-gradient(135deg,rgba(244,67,54,0.5),rgba(244,67,54,0.7));box-shadow:0 0 30px rgba(244,67,54,.5);transform:translateY(-2px)}@media (max-width:767px){.btn-confirm.btn-danger[data-v-1cd92598]:hover{transform:translateY(-1px)}}
[data-v-e852e086]{box-sizing:border-box;margin:0;padding:0}body[data-v-e852e086]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-e852e086]::-webkit-scrollbar{width:8px;height:8px}[data-v-e852e086]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-e852e086]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-e852e086]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-e852e086]{color:#d4af37}.text-muted[data-v-e852e086]{color:#888}.bg-overlay[data-v-e852e086]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-e852e086]{border:2px solid #d4af37}.shadow-gold[data-v-e852e086]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-e852e086]{z-index:50 !important}.dialogue-box[data-v-e852e086],.combat-panel[data-v-e852e086],.character-panel[data-v-e852e086],.character-creator[data-v-e852e086],.instance-record[data-v-e852e086],.instance-generator[data-v-e852e086],.interaction-room[data-v-e852e086],.dice-roller[data-v-e852e086],.map-panel[data-v-e852e086],.plot-review[data-v-e852e086]{z-index:50 !important}[data-v-e852e086]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-e852e086]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-e852e086]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-e852e086],.dialogue-box[data-v-e852e086],.combat-panel[data-v-e852e086],.character-panel[data-v-e852e086],.character-creator[data-v-e852e086],.instance-record[data-v-e852e086],.instance-generator[data-v-e852e086],.interaction-room[data-v-e852e086],.dice-roller[data-v-e852e086],.map-panel[data-v-e852e086],.plot-review[data-v-e852e086]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-e852e086],.dialogue-box[data-v-e852e086],.combat-panel[data-v-e852e086],.character-panel[data-v-e852e086],.character-creator[data-v-e852e086],.instance-record[data-v-e852e086],.instance-generator[data-v-e852e086],.interaction-room[data-v-e852e086],.dice-roller[data-v-e852e086],.map-panel[data-v-e852e086],.plot-review[data-v-e852e086]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-e852e086],.dialogue-box[data-v-e852e086],.combat-panel[data-v-e852e086],.character-panel[data-v-e852e086],.character-creator[data-v-e852e086],.instance-record[data-v-e852e086],.instance-generator[data-v-e852e086],.interaction-room[data-v-e852e086],.dice-roller[data-v-e852e086],.map-panel[data-v-e852e086],.plot-review[data-v-e852e086]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-e852e086],.modal-overlay input[data-v-e852e086],.modal-overlay textarea[data-v-e852e086],.modal-overlay select[data-v-e852e086],.modal-overlay .btn[data-v-e852e086],.modal-overlay .form-control[data-v-e852e086],.modal-overlay .modal-title[data-v-e852e086],.modal-overlay .close-btn[data-v-e852e086],.dialogue-box button[data-v-e852e086],.dialogue-box input[data-v-e852e086],.dialogue-box textarea[data-v-e852e086],.dialogue-box select[data-v-e852e086],.dialogue-box .btn[data-v-e852e086],.dialogue-box .form-control[data-v-e852e086],.dialogue-box .modal-title[data-v-e852e086],.dialogue-box .close-btn[data-v-e852e086],.combat-panel button[data-v-e852e086],.combat-panel input[data-v-e852e086],.combat-panel textarea[data-v-e852e086],.combat-panel select[data-v-e852e086],.combat-panel .btn[data-v-e852e086],.combat-panel .form-control[data-v-e852e086],.combat-panel .modal-title[data-v-e852e086],.combat-panel .close-btn[data-v-e852e086],.character-panel button[data-v-e852e086],.character-panel input[data-v-e852e086],.character-panel textarea[data-v-e852e086],.character-panel select[data-v-e852e086],.character-panel .btn[data-v-e852e086],.character-panel .form-control[data-v-e852e086],.character-panel .modal-title[data-v-e852e086],.character-panel .close-btn[data-v-e852e086],.character-creator button[data-v-e852e086],.character-creator input[data-v-e852e086],.character-creator textarea[data-v-e852e086],.character-creator select[data-v-e852e086],.character-creator .btn[data-v-e852e086],.character-creator .form-control[data-v-e852e086],.character-creator .modal-title[data-v-e852e086],.character-creator .close-btn[data-v-e852e086],.instance-record button[data-v-e852e086],.instance-record input[data-v-e852e086],.instance-record textarea[data-v-e852e086],.instance-record select[data-v-e852e086],.instance-record .btn[data-v-e852e086],.instance-record .form-control[data-v-e852e086],.instance-record .modal-title[data-v-e852e086],.instance-record .close-btn[data-v-e852e086],.instance-generator button[data-v-e852e086],.instance-generator input[data-v-e852e086],.instance-generator textarea[data-v-e852e086],.instance-generator select[data-v-e852e086],.instance-generator .btn[data-v-e852e086],.instance-generator .form-control[data-v-e852e086],.instance-generator .modal-title[data-v-e852e086],.instance-generator .close-btn[data-v-e852e086],.interaction-room button[data-v-e852e086],.interaction-room input[data-v-e852e086],.interaction-room textarea[data-v-e852e086],.interaction-room select[data-v-e852e086],.interaction-room .btn[data-v-e852e086],.interaction-room .form-control[data-v-e852e086],.interaction-room .modal-title[data-v-e852e086],.interaction-room .close-btn[data-v-e852e086],.dice-roller button[data-v-e852e086],.dice-roller input[data-v-e852e086],.dice-roller textarea[data-v-e852e086],.dice-roller select[data-v-e852e086],.dice-roller .btn[data-v-e852e086],.dice-roller .form-control[data-v-e852e086],.dice-roller .modal-title[data-v-e852e086],.dice-roller .close-btn[data-v-e852e086],.map-panel button[data-v-e852e086],.map-panel input[data-v-e852e086],.map-panel textarea[data-v-e852e086],.map-panel select[data-v-e852e086],.map-panel .btn[data-v-e852e086],.map-panel .form-control[data-v-e852e086],.map-panel .modal-title[data-v-e852e086],.map-panel .close-btn[data-v-e852e086],.plot-review button[data-v-e852e086],.plot-review input[data-v-e852e086],.plot-review textarea[data-v-e852e086],.plot-review select[data-v-e852e086],.plot-review .btn[data-v-e852e086],.plot-review .form-control[data-v-e852e086],.plot-review .modal-title[data-v-e852e086],.plot-review .close-btn[data-v-e852e086]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-e852e086],.modal-overlay h2[data-v-e852e086],.modal-overlay h3[data-v-e852e086],.modal-overlay .modal-title[data-v-e852e086],.dialogue-box h1[data-v-e852e086],.dialogue-box h2[data-v-e852e086],.dialogue-box h3[data-v-e852e086],.dialogue-box .modal-title[data-v-e852e086],.combat-panel h1[data-v-e852e086],.combat-panel h2[data-v-e852e086],.combat-panel h3[data-v-e852e086],.combat-panel .modal-title[data-v-e852e086],.character-panel h1[data-v-e852e086],.character-panel h2[data-v-e852e086],.character-panel h3[data-v-e852e086],.character-panel .modal-title[data-v-e852e086],.character-creator h1[data-v-e852e086],.character-creator h2[data-v-e852e086],.character-creator h3[data-v-e852e086],.character-creator .modal-title[data-v-e852e086],.instance-record h1[data-v-e852e086],.instance-record h2[data-v-e852e086],.instance-record h3[data-v-e852e086],.instance-record .modal-title[data-v-e852e086],.instance-generator h1[data-v-e852e086],.instance-generator h2[data-v-e852e086],.instance-generator h3[data-v-e852e086],.instance-generator .modal-title[data-v-e852e086],.interaction-room h1[data-v-e852e086],.interaction-room h2[data-v-e852e086],.interaction-room h3[data-v-e852e086],.interaction-room .modal-title[data-v-e852e086],.dice-roller h1[data-v-e852e086],.dice-roller h2[data-v-e852e086],.dice-roller h3[data-v-e852e086],.dice-roller .modal-title[data-v-e852e086],.map-panel h1[data-v-e852e086],.map-panel h2[data-v-e852e086],.map-panel h3[data-v-e852e086],.map-panel .modal-title[data-v-e852e086],.plot-review h1[data-v-e852e086],.plot-review h2[data-v-e852e086],.plot-review h3[data-v-e852e086],.plot-review .modal-title[data-v-e852e086]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-e852e086],.modal-overlay .form-group[data-v-e852e086],.dialogue-box .button-group[data-v-e852e086],.dialogue-box .form-group[data-v-e852e086],.combat-panel .button-group[data-v-e852e086],.combat-panel .form-group[data-v-e852e086],.character-panel .button-group[data-v-e852e086],.character-panel .form-group[data-v-e852e086],.character-creator .button-group[data-v-e852e086],.character-creator .form-group[data-v-e852e086],.instance-record .button-group[data-v-e852e086],.instance-record .form-group[data-v-e852e086],.instance-generator .button-group[data-v-e852e086],.instance-generator .form-group[data-v-e852e086],.interaction-room .button-group[data-v-e852e086],.interaction-room .form-group[data-v-e852e086],.dice-roller .button-group[data-v-e852e086],.dice-roller .form-group[data-v-e852e086],.map-panel .button-group[data-v-e852e086],.map-panel .form-group[data-v-e852e086],.plot-review .button-group[data-v-e852e086],.plot-review .form-group[data-v-e852e086]{gap:calc(16px*var(--modal-scale))}.welcome-modal-overlay[data-v-e852e086]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);display:flex;align-items:center;justify-content:center;z-index:70;backdrop-filter:blur(10px);padding:16px}@media (max-width:767px){.welcome-modal-overlay[data-v-e852e086]{padding:8px}}.welcome-modal[data-v-e852e086]{background:linear-gradient(135deg,rgba(20,20,30,0.95),rgba(40,40,60,0.95));border:2px solid #d4af37;border-radius:12px;padding:48px;box-shadow:0 0 50px rgba(212,175,55,.3),0 8px 16px rgba(0,0,0,.5);text-align:center;animation:fadeInScale-e852e086 .5s ease-out;max-width:600px;width:100%}@media (max-width:767px){.welcome-modal[data-v-e852e086]{padding:32px;border-width:1px;max-width:95%}}@media (max-width:480px){.welcome-modal[data-v-e852e086]{padding:24px;border-radius:8px}}@keyframes fadeInScale-e852e086{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}.welcome-content[data-v-e852e086]{display:flex;flex-direction:column;align-items:center;gap:32px}@media (max-width:767px){.welcome-content[data-v-e852e086]{gap:24px}}@media (max-width:480px){.welcome-content[data-v-e852e086]{gap:16px}}.welcome-title[data-v-e852e086]{font-size:3rem;font-weight:700;color:#d4af37;text-shadow:0 0 20px rgba(212,175,55,.8),0 0 40px rgba(212,175,55,.4);margin:0;letter-spacing:2px}@media (max-width:767px){.welcome-title[data-v-e852e086]{font-size:2rem;letter-spacing:1px}}@media (max-width:480px){.welcome-title[data-v-e852e086]{font-size:1.5rem;letter-spacing:.5px}}.welcome-subtitle[data-v-e852e086]{font-size:18px;color:#ccc;margin:0;letter-spacing:1px}@media (max-width:767px){.welcome-subtitle[data-v-e852e086]{font-size:16px;letter-spacing:.5px}}@media (max-width:480px){.welcome-subtitle[data-v-e852e086]{font-size:14px}}.button-group[data-v-e852e086]{display:flex;gap:16px;width:100%;justify-content:center}@media (max-width:767px){.button-group[data-v-e852e086]{gap:8px;flex-direction:column}}.btn-action[data-v-e852e086]{padding:16px 32px;border:2px solid;border-radius:8px;font-size:18px;font-weight:700;cursor:pointer;transition:all .3s ease;min-width:140px;text-shadow:0 0 10px rgba(0,0,0,.5)}@media (max-width:767px){.btn-action[data-v-e852e086]{padding:8px 24px;font-size:16px;border-width:1px;min-width:120px}}@media (max-width:480px){.btn-action[data-v-e852e086]{padding:8px 16px;font-size:14px;min-width:100px}}.btn-action.btn-update[data-v-e852e086]{background:linear-gradient(135deg,rgba(33,150,243,0.3),rgba(33,150,243,0.5));border-color:#2196f3;color:#2196f3;box-shadow:0 0 20px rgba(33,150,243,.3)}.btn-action.btn-update[data-v-e852e086]:hover{background:linear-gradient(135deg,rgba(33,150,243,0.5),rgba(33,150,243,0.7));box-shadow:0 0 30px rgba(33,150,243,.5);transform:translateY(-2px)}@media (max-width:767px){.btn-action.btn-update[data-v-e852e086]:hover{transform:translateY(-1px)}}.btn-action.btn-update[data-v-e852e086]:active{transform:translateY(0)}.btn-action.btn-continue[data-v-e852e086]{background:linear-gradient(135deg,rgba(76,175,80,0.3),rgba(76,175,80,0.5));border-color:#4caf50;color:#4caf50;box-shadow:0 0 20px rgba(76,175,80,.3)}.btn-action.btn-continue[data-v-e852e086]:hover{background:linear-gradient(135deg,rgba(76,175,80,0.5),rgba(76,175,80,0.7));box-shadow:0 0 30px rgba(76,175,80,.5);transform:translateY(-2px)}@media (max-width:767px){.btn-action.btn-continue[data-v-e852e086]:hover{transform:translateY(-1px)}}.btn-action.btn-continue[data-v-e852e086]:active{transform:translateY(0)}
[data-v-470a9889]{box-sizing:border-box;margin:0;padding:0}body[data-v-470a9889]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-470a9889]::-webkit-scrollbar{width:8px;height:8px}[data-v-470a9889]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-470a9889]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-470a9889]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-470a9889]{color:#d4af37}.text-muted[data-v-470a9889]{color:#888}.bg-overlay[data-v-470a9889]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-470a9889]{border:2px solid #d4af37}.shadow-gold[data-v-470a9889]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-470a9889]{z-index:50 !important}.dialogue-box[data-v-470a9889],.combat-panel[data-v-470a9889],.character-panel[data-v-470a9889],.character-creator[data-v-470a9889],.instance-record[data-v-470a9889],.instance-generator[data-v-470a9889],.interaction-room[data-v-470a9889],.dice-roller[data-v-470a9889],.map-panel[data-v-470a9889],.plot-review[data-v-470a9889]{z-index:50 !important}[data-v-470a9889]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-470a9889]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-470a9889]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-470a9889],.dialogue-box[data-v-470a9889],.combat-panel[data-v-470a9889],.character-panel[data-v-470a9889],.character-creator[data-v-470a9889],.instance-record[data-v-470a9889],.instance-generator[data-v-470a9889],.interaction-room[data-v-470a9889],.dice-roller[data-v-470a9889],.map-panel[data-v-470a9889],.plot-review[data-v-470a9889]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-470a9889],.dialogue-box[data-v-470a9889],.combat-panel[data-v-470a9889],.character-panel[data-v-470a9889],.character-creator[data-v-470a9889],.instance-record[data-v-470a9889],.instance-generator[data-v-470a9889],.interaction-room[data-v-470a9889],.dice-roller[data-v-470a9889],.map-panel[data-v-470a9889],.plot-review[data-v-470a9889]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-470a9889],.dialogue-box[data-v-470a9889],.combat-panel[data-v-470a9889],.character-panel[data-v-470a9889],.character-creator[data-v-470a9889],.instance-record[data-v-470a9889],.instance-generator[data-v-470a9889],.interaction-room[data-v-470a9889],.dice-roller[data-v-470a9889],.map-panel[data-v-470a9889],.plot-review[data-v-470a9889]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-470a9889],.modal-overlay input[data-v-470a9889],.modal-overlay textarea[data-v-470a9889],.modal-overlay select[data-v-470a9889],.modal-overlay .btn[data-v-470a9889],.modal-overlay .form-control[data-v-470a9889],.modal-overlay .modal-title[data-v-470a9889],.modal-overlay .close-btn[data-v-470a9889],.dialogue-box button[data-v-470a9889],.dialogue-box input[data-v-470a9889],.dialogue-box textarea[data-v-470a9889],.dialogue-box select[data-v-470a9889],.dialogue-box .btn[data-v-470a9889],.dialogue-box .form-control[data-v-470a9889],.dialogue-box .modal-title[data-v-470a9889],.dialogue-box .close-btn[data-v-470a9889],.combat-panel button[data-v-470a9889],.combat-panel input[data-v-470a9889],.combat-panel textarea[data-v-470a9889],.combat-panel select[data-v-470a9889],.combat-panel .btn[data-v-470a9889],.combat-panel .form-control[data-v-470a9889],.combat-panel .modal-title[data-v-470a9889],.combat-panel .close-btn[data-v-470a9889],.character-panel button[data-v-470a9889],.character-panel input[data-v-470a9889],.character-panel textarea[data-v-470a9889],.character-panel select[data-v-470a9889],.character-panel .btn[data-v-470a9889],.character-panel .form-control[data-v-470a9889],.character-panel .modal-title[data-v-470a9889],.character-panel .close-btn[data-v-470a9889],.character-creator button[data-v-470a9889],.character-creator input[data-v-470a9889],.character-creator textarea[data-v-470a9889],.character-creator select[data-v-470a9889],.character-creator .btn[data-v-470a9889],.character-creator .form-control[data-v-470a9889],.character-creator .modal-title[data-v-470a9889],.character-creator .close-btn[data-v-470a9889],.instance-record button[data-v-470a9889],.instance-record input[data-v-470a9889],.instance-record textarea[data-v-470a9889],.instance-record select[data-v-470a9889],.instance-record .btn[data-v-470a9889],.instance-record .form-control[data-v-470a9889],.instance-record .modal-title[data-v-470a9889],.instance-record .close-btn[data-v-470a9889],.instance-generator button[data-v-470a9889],.instance-generator input[data-v-470a9889],.instance-generator textarea[data-v-470a9889],.instance-generator select[data-v-470a9889],.instance-generator .btn[data-v-470a9889],.instance-generator .form-control[data-v-470a9889],.instance-generator .modal-title[data-v-470a9889],.instance-generator .close-btn[data-v-470a9889],.interaction-room button[data-v-470a9889],.interaction-room input[data-v-470a9889],.interaction-room textarea[data-v-470a9889],.interaction-room select[data-v-470a9889],.interaction-room .btn[data-v-470a9889],.interaction-room .form-control[data-v-470a9889],.interaction-room .modal-title[data-v-470a9889],.interaction-room .close-btn[data-v-470a9889],.dice-roller button[data-v-470a9889],.dice-roller input[data-v-470a9889],.dice-roller textarea[data-v-470a9889],.dice-roller select[data-v-470a9889],.dice-roller .btn[data-v-470a9889],.dice-roller .form-control[data-v-470a9889],.dice-roller .modal-title[data-v-470a9889],.dice-roller .close-btn[data-v-470a9889],.map-panel button[data-v-470a9889],.map-panel input[data-v-470a9889],.map-panel textarea[data-v-470a9889],.map-panel select[data-v-470a9889],.map-panel .btn[data-v-470a9889],.map-panel .form-control[data-v-470a9889],.map-panel .modal-title[data-v-470a9889],.map-panel .close-btn[data-v-470a9889],.plot-review button[data-v-470a9889],.plot-review input[data-v-470a9889],.plot-review textarea[data-v-470a9889],.plot-review select[data-v-470a9889],.plot-review .btn[data-v-470a9889],.plot-review .form-control[data-v-470a9889],.plot-review .modal-title[data-v-470a9889],.plot-review .close-btn[data-v-470a9889]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-470a9889],.modal-overlay h2[data-v-470a9889],.modal-overlay h3[data-v-470a9889],.modal-overlay .modal-title[data-v-470a9889],.dialogue-box h1[data-v-470a9889],.dialogue-box h2[data-v-470a9889],.dialogue-box h3[data-v-470a9889],.dialogue-box .modal-title[data-v-470a9889],.combat-panel h1[data-v-470a9889],.combat-panel h2[data-v-470a9889],.combat-panel h3[data-v-470a9889],.combat-panel .modal-title[data-v-470a9889],.character-panel h1[data-v-470a9889],.character-panel h2[data-v-470a9889],.character-panel h3[data-v-470a9889],.character-panel .modal-title[data-v-470a9889],.character-creator h1[data-v-470a9889],.character-creator h2[data-v-470a9889],.character-creator h3[data-v-470a9889],.character-creator .modal-title[data-v-470a9889],.instance-record h1[data-v-470a9889],.instance-record h2[data-v-470a9889],.instance-record h3[data-v-470a9889],.instance-record .modal-title[data-v-470a9889],.instance-generator h1[data-v-470a9889],.instance-generator h2[data-v-470a9889],.instance-generator h3[data-v-470a9889],.instance-generator .modal-title[data-v-470a9889],.interaction-room h1[data-v-470a9889],.interaction-room h2[data-v-470a9889],.interaction-room h3[data-v-470a9889],.interaction-room .modal-title[data-v-470a9889],.dice-roller h1[data-v-470a9889],.dice-roller h2[data-v-470a9889],.dice-roller h3[data-v-470a9889],.dice-roller .modal-title[data-v-470a9889],.map-panel h1[data-v-470a9889],.map-panel h2[data-v-470a9889],.map-panel h3[data-v-470a9889],.map-panel .modal-title[data-v-470a9889],.plot-review h1[data-v-470a9889],.plot-review h2[data-v-470a9889],.plot-review h3[data-v-470a9889],.plot-review .modal-title[data-v-470a9889]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-470a9889],.modal-overlay .form-group[data-v-470a9889],.dialogue-box .button-group[data-v-470a9889],.dialogue-box .form-group[data-v-470a9889],.combat-panel .button-group[data-v-470a9889],.combat-panel .form-group[data-v-470a9889],.character-panel .button-group[data-v-470a9889],.character-panel .form-group[data-v-470a9889],.character-creator .button-group[data-v-470a9889],.character-creator .form-group[data-v-470a9889],.instance-record .button-group[data-v-470a9889],.instance-record .form-group[data-v-470a9889],.instance-generator .button-group[data-v-470a9889],.instance-generator .form-group[data-v-470a9889],.interaction-room .button-group[data-v-470a9889],.interaction-room .form-group[data-v-470a9889],.dice-roller .button-group[data-v-470a9889],.dice-roller .form-group[data-v-470a9889],.map-panel .button-group[data-v-470a9889],.map-panel .form-group[data-v-470a9889],.plot-review .button-group[data-v-470a9889],.plot-review .form-group[data-v-470a9889]{gap:calc(16px*var(--modal-scale))}.main-interface[data-v-470a9889]{position:relative;width:100%;aspect-ratio:16/9;overflow:hidden}.layer[data-v-470a9889]{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}.layer[data-v-470a9889]>*{pointer-events:auto}.layer-background[data-v-470a9889]{z-index:0}.layer-sprite[data-v-470a9889]{z-index:10}.layer-ui[data-v-470a9889]{z-index:20}.control-panel[data-v-470a9889]{position:fixed;top:var(--control-panel-top);right:var(--control-panel-right);display:flex;flex-direction:column;gap:var(--spacing-control-gap);z-index:20;max-height:calc(100vh - var(--control-panel-top) - var(--spacing-page));overflow-y:auto;overflow-x:visible;scrollbar-width:none;-ms-overflow-style:none}.control-panel[data-v-470a9889]::-webkit-scrollbar{display:none}@media (max-width:767px){.control-panel[data-v-470a9889]{max-height:calc(100vh - var(--control-panel-top) - var(--btn-size-round) - var(--spacing-page)*2)}}@media (max-width:480px){.control-panel[data-v-470a9889]{max-height:calc(100vh - var(--control-panel-top) - var(--btn-size-round) - 16px)}}.control-panel[data-v-470a9889]::after{content:"";position:sticky;bottom:0;left:0;right:0;height:20px;background:linear-gradient(to top,rgba(0,0,0,0.5),transparent);pointer-events:none;opacity:0;transition:opacity .3s ease}.control-panel[data-v-470a9889]:hover::after{opacity:1}@media (max-width:767px){.control-panel[data-v-470a9889]::after{opacity:.7}}.control-btn[data-v-470a9889]{width:var(--btn-size-control);height:var(--btn-size-control);padding:0;display:flex;align-items:center;justify-content:center;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:8px;color:#d4af37;font-size:var(--btn-font-size-control);cursor:pointer;transition:all .15s ease;box-shadow:0 4px 8px rgba(0,0,0,.4)}@media (max-width:767px){.control-btn[data-v-470a9889]{border-width:1px}}.control-btn[data-v-470a9889]:hover{background:rgba(212,175,55,.2);border-color:#f4d03f;transform:translateX(-4px);box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}@media (max-width:767px){.control-btn[data-v-470a9889]:hover{transform:translateX(-2px)}}.control-btn[data-v-470a9889]:active{transform:translateX(-2px)}@media (max-width:767px){.control-btn[data-v-470a9889]:active{transform:translateX(-1px)}}.control-btn.active[data-v-470a9889]{background:rgba(212,175,55,.3);border-color:#f4d03f}.control-btn[data-v-470a9889]{flex-shrink:0}.modal-overlay[data-v-470a9889]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:50;backdrop-filter:blur(4px)}.modal-overlay.character-creation-overlay[data-v-470a9889]{z-index:60;background:rgba(0,0,0,.9)}.modal-overlay.sanctuary-modal .sanctuary-container[data-v-470a9889]{width:90vw;max-width:1400px;height:80vh;max-height:800px;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:12px;overflow:hidden;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3)}.ui-toggle-btn[data-v-470a9889]{width:var(--btn-size-round);height:var(--btn-size-round);padding:0;display:flex;align-items:center;justify-content:center;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:50%;color:#d4af37;font-size:var(--btn-font-size-round);cursor:pointer;transition:all .15s ease;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3);z-index:45}@media (max-width:767px){.ui-toggle-btn[data-v-470a9889]{border-width:1px}}.ui-toggle-btn[data-v-470a9889]:hover{background:rgba(212,175,55,.2);border-color:#f4d03f;transform:scale(1.1);box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 30px rgba(212,175,55,.5)}@media (max-width:767px){.ui-toggle-btn[data-v-470a9889]:hover{transform:scale(1.05)}}.ui-toggle-btn[data-v-470a9889]:active{transform:scale(1.05)}@media (max-width:767px){.ui-toggle-btn[data-v-470a9889]:active{transform:scale(1.02)}}.ui-toggle-btn[data-v-470a9889]{position:fixed;bottom:var(--spacing-page);left:var(--spacing-page);z-index:45}.ui-toggle-btn.ui-hidden[data-v-470a9889]{opacity:.5;background:rgba(20,20,20,.6)}.ui-toggle-btn.ui-hidden[data-v-470a9889]:hover{opacity:.8}.toggle-dialogue-btn[data-v-470a9889]{width:var(--btn-size-round);height:var(--btn-size-round);padding:0;display:flex;align-items:center;justify-content:center;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:50%;color:#d4af37;font-size:var(--btn-font-size-round);cursor:pointer;transition:all .15s ease;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3);z-index:45}@media (max-width:767px){.toggle-dialogue-btn[data-v-470a9889]{border-width:1px}}.toggle-dialogue-btn[data-v-470a9889]:hover{background:rgba(212,175,55,.2);border-color:#f4d03f;transform:scale(1.1);box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 30px rgba(212,175,55,.5)}@media (max-width:767px){.toggle-dialogue-btn[data-v-470a9889]:hover{transform:scale(1.05)}}.toggle-dialogue-btn[data-v-470a9889]:active{transform:scale(1.05)}@media (max-width:767px){.toggle-dialogue-btn[data-v-470a9889]:active{transform:scale(1.02)}}.toggle-dialogue-btn[data-v-470a9889]{position:fixed;bottom:var(--spacing-page);right:var(--spacing-page);z-index:45}@media (max-width:767px){.toggle-dialogue-btn[data-v-470a9889]{right:calc(var(--spacing-page) + var(--btn-size-control) + var(--spacing-control-gap))}}@media (max-width:480px){.toggle-dialogue-btn[data-v-470a9889]{right:calc(var(--spacing-page) + var(--btn-size-control) + 4px)}}.toggle-dialogue-btn.active[data-v-470a9889]{background:rgba(212,175,55,.3);border-color:#f4d03f;box-shadow:0 0 20px rgba(212,175,55,.3)}.fullscreen-btn[data-v-470a9889]{width:var(--btn-size-round);height:var(--btn-size-round);padding:0;display:flex;align-items:center;justify-content:center;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:50%;color:#d4af37;font-size:var(--btn-font-size-round);cursor:pointer;transition:all .15s ease;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3);z-index:45}@media (max-width:767px){.fullscreen-btn[data-v-470a9889]{border-width:1px}}.fullscreen-btn[data-v-470a9889]:hover{background:rgba(212,175,55,.2);border-color:#f4d03f;transform:scale(1.1);box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 30px rgba(212,175,55,.5)}@media (max-width:767px){.fullscreen-btn[data-v-470a9889]:hover{transform:scale(1.05)}}.fullscreen-btn[data-v-470a9889]:active{transform:scale(1.05)}@media (max-width:767px){.fullscreen-btn[data-v-470a9889]:active{transform:scale(1.02)}}.fullscreen-btn[data-v-470a9889]{position:fixed;top:var(--spacing-page);right:var(--spacing-page)}.plot-review-btn[data-v-470a9889]{width:var(--btn-size-round);height:var(--btn-size-round);padding:0;display:flex;align-items:center;justify-content:center;background:rgba(20,20,20,.9);border:2px solid #d4af37;border-radius:50%;color:#d4af37;font-size:var(--btn-font-size-round);cursor:pointer;transition:all .15s ease;box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 20px rgba(212,175,55,.3);z-index:45}@media (max-width:767px){.plot-review-btn[data-v-470a9889]{border-width:1px}}.plot-review-btn[data-v-470a9889]:hover{background:rgba(212,175,55,.2);border-color:#f4d03f;transform:scale(1.1);box-shadow:0 8px 16px rgba(0,0,0,.5),0 0 30px rgba(212,175,55,.5)}@media (max-width:767px){.plot-review-btn[data-v-470a9889]:hover{transform:scale(1.05)}}.plot-review-btn[data-v-470a9889]:active{transform:scale(1.05)}@media (max-width:767px){.plot-review-btn[data-v-470a9889]:active{transform:scale(1.02)}}.plot-review-btn[data-v-470a9889]{position:fixed;top:var(--spacing-page);left:var(--spacing-page);z-index:45}.plot-review-btn.active[data-v-470a9889]{background:rgba(212,175,55,.3);border-color:#f4d03f;box-shadow:0 0 20px rgba(212,175,55,.3)}
[data-v-dd7cafd0]{box-sizing:border-box;margin:0;padding:0}body[data-v-dd7cafd0]{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-v-dd7cafd0]::-webkit-scrollbar{width:8px;height:8px}[data-v-dd7cafd0]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}[data-v-dd7cafd0]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}[data-v-dd7cafd0]::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold[data-v-dd7cafd0]{color:#d4af37}.text-muted[data-v-dd7cafd0]{color:#888}.bg-overlay[data-v-dd7cafd0]{background-color:rgba(0,0,0,.85)}.border-gold[data-v-dd7cafd0]{border:2px solid #d4af37}.shadow-gold[data-v-dd7cafd0]{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay[data-v-dd7cafd0]{z-index:50 !important}.dialogue-box[data-v-dd7cafd0],.combat-panel[data-v-dd7cafd0],.character-panel[data-v-dd7cafd0],.character-creator[data-v-dd7cafd0],.instance-record[data-v-dd7cafd0],.instance-generator[data-v-dd7cafd0],.interaction-room[data-v-dd7cafd0],.dice-roller[data-v-dd7cafd0],.map-panel[data-v-dd7cafd0],.plot-review[data-v-dd7cafd0]{z-index:50 !important}[data-v-dd7cafd0]:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){[data-v-dd7cafd0]:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){[data-v-dd7cafd0]:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay[data-v-dd7cafd0],.dialogue-box[data-v-dd7cafd0],.combat-panel[data-v-dd7cafd0],.character-panel[data-v-dd7cafd0],.character-creator[data-v-dd7cafd0],.instance-record[data-v-dd7cafd0],.instance-generator[data-v-dd7cafd0],.interaction-room[data-v-dd7cafd0],.dice-roller[data-v-dd7cafd0],.map-panel[data-v-dd7cafd0],.plot-review[data-v-dd7cafd0]{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay[data-v-dd7cafd0],.dialogue-box[data-v-dd7cafd0],.combat-panel[data-v-dd7cafd0],.character-panel[data-v-dd7cafd0],.character-creator[data-v-dd7cafd0],.instance-record[data-v-dd7cafd0],.instance-generator[data-v-dd7cafd0],.interaction-room[data-v-dd7cafd0],.dice-roller[data-v-dd7cafd0],.map-panel[data-v-dd7cafd0],.plot-review[data-v-dd7cafd0]{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay[data-v-dd7cafd0],.dialogue-box[data-v-dd7cafd0],.combat-panel[data-v-dd7cafd0],.character-panel[data-v-dd7cafd0],.character-creator[data-v-dd7cafd0],.instance-record[data-v-dd7cafd0],.instance-generator[data-v-dd7cafd0],.interaction-room[data-v-dd7cafd0],.dice-roller[data-v-dd7cafd0],.map-panel[data-v-dd7cafd0],.plot-review[data-v-dd7cafd0]{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button[data-v-dd7cafd0],.modal-overlay input[data-v-dd7cafd0],.modal-overlay textarea[data-v-dd7cafd0],.modal-overlay select[data-v-dd7cafd0],.modal-overlay .btn[data-v-dd7cafd0],.modal-overlay .form-control[data-v-dd7cafd0],.modal-overlay .modal-title[data-v-dd7cafd0],.modal-overlay .close-btn[data-v-dd7cafd0],.dialogue-box button[data-v-dd7cafd0],.dialogue-box input[data-v-dd7cafd0],.dialogue-box textarea[data-v-dd7cafd0],.dialogue-box select[data-v-dd7cafd0],.dialogue-box .btn[data-v-dd7cafd0],.dialogue-box .form-control[data-v-dd7cafd0],.dialogue-box .modal-title[data-v-dd7cafd0],.dialogue-box .close-btn[data-v-dd7cafd0],.combat-panel button[data-v-dd7cafd0],.combat-panel input[data-v-dd7cafd0],.combat-panel textarea[data-v-dd7cafd0],.combat-panel select[data-v-dd7cafd0],.combat-panel .btn[data-v-dd7cafd0],.combat-panel .form-control[data-v-dd7cafd0],.combat-panel .modal-title[data-v-dd7cafd0],.combat-panel .close-btn[data-v-dd7cafd0],.character-panel button[data-v-dd7cafd0],.character-panel input[data-v-dd7cafd0],.character-panel textarea[data-v-dd7cafd0],.character-panel select[data-v-dd7cafd0],.character-panel .btn[data-v-dd7cafd0],.character-panel .form-control[data-v-dd7cafd0],.character-panel .modal-title[data-v-dd7cafd0],.character-panel .close-btn[data-v-dd7cafd0],.character-creator button[data-v-dd7cafd0],.character-creator input[data-v-dd7cafd0],.character-creator textarea[data-v-dd7cafd0],.character-creator select[data-v-dd7cafd0],.character-creator .btn[data-v-dd7cafd0],.character-creator .form-control[data-v-dd7cafd0],.character-creator .modal-title[data-v-dd7cafd0],.character-creator .close-btn[data-v-dd7cafd0],.instance-record button[data-v-dd7cafd0],.instance-record input[data-v-dd7cafd0],.instance-record textarea[data-v-dd7cafd0],.instance-record select[data-v-dd7cafd0],.instance-record .btn[data-v-dd7cafd0],.instance-record .form-control[data-v-dd7cafd0],.instance-record .modal-title[data-v-dd7cafd0],.instance-record .close-btn[data-v-dd7cafd0],.instance-generator button[data-v-dd7cafd0],.instance-generator input[data-v-dd7cafd0],.instance-generator textarea[data-v-dd7cafd0],.instance-generator select[data-v-dd7cafd0],.instance-generator .btn[data-v-dd7cafd0],.instance-generator .form-control[data-v-dd7cafd0],.instance-generator .modal-title[data-v-dd7cafd0],.instance-generator .close-btn[data-v-dd7cafd0],.interaction-room button[data-v-dd7cafd0],.interaction-room input[data-v-dd7cafd0],.interaction-room textarea[data-v-dd7cafd0],.interaction-room select[data-v-dd7cafd0],.interaction-room .btn[data-v-dd7cafd0],.interaction-room .form-control[data-v-dd7cafd0],.interaction-room .modal-title[data-v-dd7cafd0],.interaction-room .close-btn[data-v-dd7cafd0],.dice-roller button[data-v-dd7cafd0],.dice-roller input[data-v-dd7cafd0],.dice-roller textarea[data-v-dd7cafd0],.dice-roller select[data-v-dd7cafd0],.dice-roller .btn[data-v-dd7cafd0],.dice-roller .form-control[data-v-dd7cafd0],.dice-roller .modal-title[data-v-dd7cafd0],.dice-roller .close-btn[data-v-dd7cafd0],.map-panel button[data-v-dd7cafd0],.map-panel input[data-v-dd7cafd0],.map-panel textarea[data-v-dd7cafd0],.map-panel select[data-v-dd7cafd0],.map-panel .btn[data-v-dd7cafd0],.map-panel .form-control[data-v-dd7cafd0],.map-panel .modal-title[data-v-dd7cafd0],.map-panel .close-btn[data-v-dd7cafd0],.plot-review button[data-v-dd7cafd0],.plot-review input[data-v-dd7cafd0],.plot-review textarea[data-v-dd7cafd0],.plot-review select[data-v-dd7cafd0],.plot-review .btn[data-v-dd7cafd0],.plot-review .form-control[data-v-dd7cafd0],.plot-review .modal-title[data-v-dd7cafd0],.plot-review .close-btn[data-v-dd7cafd0]{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1[data-v-dd7cafd0],.modal-overlay h2[data-v-dd7cafd0],.modal-overlay h3[data-v-dd7cafd0],.modal-overlay .modal-title[data-v-dd7cafd0],.dialogue-box h1[data-v-dd7cafd0],.dialogue-box h2[data-v-dd7cafd0],.dialogue-box h3[data-v-dd7cafd0],.dialogue-box .modal-title[data-v-dd7cafd0],.combat-panel h1[data-v-dd7cafd0],.combat-panel h2[data-v-dd7cafd0],.combat-panel h3[data-v-dd7cafd0],.combat-panel .modal-title[data-v-dd7cafd0],.character-panel h1[data-v-dd7cafd0],.character-panel h2[data-v-dd7cafd0],.character-panel h3[data-v-dd7cafd0],.character-panel .modal-title[data-v-dd7cafd0],.character-creator h1[data-v-dd7cafd0],.character-creator h2[data-v-dd7cafd0],.character-creator h3[data-v-dd7cafd0],.character-creator .modal-title[data-v-dd7cafd0],.instance-record h1[data-v-dd7cafd0],.instance-record h2[data-v-dd7cafd0],.instance-record h3[data-v-dd7cafd0],.instance-record .modal-title[data-v-dd7cafd0],.instance-generator h1[data-v-dd7cafd0],.instance-generator h2[data-v-dd7cafd0],.instance-generator h3[data-v-dd7cafd0],.instance-generator .modal-title[data-v-dd7cafd0],.interaction-room h1[data-v-dd7cafd0],.interaction-room h2[data-v-dd7cafd0],.interaction-room h3[data-v-dd7cafd0],.interaction-room .modal-title[data-v-dd7cafd0],.dice-roller h1[data-v-dd7cafd0],.dice-roller h2[data-v-dd7cafd0],.dice-roller h3[data-v-dd7cafd0],.dice-roller .modal-title[data-v-dd7cafd0],.map-panel h1[data-v-dd7cafd0],.map-panel h2[data-v-dd7cafd0],.map-panel h3[data-v-dd7cafd0],.map-panel .modal-title[data-v-dd7cafd0],.plot-review h1[data-v-dd7cafd0],.plot-review h2[data-v-dd7cafd0],.plot-review h3[data-v-dd7cafd0],.plot-review .modal-title[data-v-dd7cafd0]{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group[data-v-dd7cafd0],.modal-overlay .form-group[data-v-dd7cafd0],.dialogue-box .button-group[data-v-dd7cafd0],.dialogue-box .form-group[data-v-dd7cafd0],.combat-panel .button-group[data-v-dd7cafd0],.combat-panel .form-group[data-v-dd7cafd0],.character-panel .button-group[data-v-dd7cafd0],.character-panel .form-group[data-v-dd7cafd0],.character-creator .button-group[data-v-dd7cafd0],.character-creator .form-group[data-v-dd7cafd0],.instance-record .button-group[data-v-dd7cafd0],.instance-record .form-group[data-v-dd7cafd0],.instance-generator .button-group[data-v-dd7cafd0],.instance-generator .form-group[data-v-dd7cafd0],.interaction-room .button-group[data-v-dd7cafd0],.interaction-room .form-group[data-v-dd7cafd0],.dice-roller .button-group[data-v-dd7cafd0],.dice-roller .form-group[data-v-dd7cafd0],.map-panel .button-group[data-v-dd7cafd0],.map-panel .form-group[data-v-dd7cafd0],.plot-review .button-group[data-v-dd7cafd0],.plot-review .form-group[data-v-dd7cafd0]{gap:calc(16px*var(--modal-scale))}.loading-overlay[data-v-dd7cafd0]{position:absolute;top:0;left:0;width:100%;height:100%;background:#0f0f0f;display:flex;align-items:center;justify-content:center;z-index:50}.loading-content[data-v-dd7cafd0]{text-align:center;color:#d4af37}.loading-content p[data-v-dd7cafd0]{margin-top:24px;font-size:18px}.loading-spinner[data-v-dd7cafd0]{width:60px;height:60px;border:4px solid #333;border-top-color:#d4af37;border-radius:50%;animation:spin-dd7cafd0 1s linear infinite;margin:0 auto}@keyframes spin-dd7cafd0{to{transform:rotate(360deg)}}.error-overlay[data-v-dd7cafd0]{position:absolute;top:0;left:0;width:100%;height:100%;background:#0f0f0f;display:flex;align-items:center;justify-content:center;z-index:50}.error-content[data-v-dd7cafd0]{text-align:center;color:#f5f5f5;max-width:500px;padding:32px}.error-content h2[data-v-dd7cafd0]{color:#f44336;margin-bottom:24px;font-size:24px}.error-content p[data-v-dd7cafd0]{margin-bottom:32px;font-size:16px;line-height:1.6}.retry-button[data-v-dd7cafd0]{padding:16px 32px;background:linear-gradient(135deg,#d4af37,#b8941e);border:none;border-radius:8px;color:#0a0a0a;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease}.retry-button[data-v-dd7cafd0]:hover{background:linear-gradient(135deg,#f4d03f,#d4af37);transform:translateY(-2px);box-shadow:0 0 20px rgba(212,175,55,.3)}.infinite-flow-game[data-v-dd7cafd0]{position:relative;width:100%;aspect-ratio:16/9;overflow:hidden;background-color:#0f0f0f}
*{box-sizing:border-box;margin:0;padding:0}body{font-family:"Microsoft YaHei","PingFang SC","Hiragino Sans GB",sans-serif;font-size:16px;color:#f5f5f5;background-color:#0f0f0f;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}::-webkit-scrollbar-thumb{background:#555;border-radius:4px}::-webkit-scrollbar-thumb:hover{background:#d4af37}.text-gold{color:#d4af37}.text-muted{color:#888}.bg-overlay{background-color:rgba(0,0,0,.85)}.border-gold{border:2px solid #d4af37}.shadow-gold{box-shadow:0 0 20px rgba(212,175,55,.3)}.modal-overlay{z-index:50 !important}.dialogue-box,.combat-panel,.character-panel,.character-creator,.instance-record,.instance-generator,.interaction-room,.dice-roller,.map-panel,.plot-review{z-index:50 !important}:root{--btn-size-round:50px;--btn-size-control:40px;--btn-font-size-round:24px;--btn-font-size-control:20px;--spacing-page:24px;--spacing-control-gap:8px;--dialogue-bottom-offset:calc(24px + 50px + 16px);--dialogue-side-margin:120px;--dialogue-max-height:40vh;--control-panel-top:calc(24px + 50px + 16px);--control-panel-right:24px}@media (max-width:767px){:root{--btn-size-round:36px;--btn-size-control:32px;--btn-font-size-round:18px;--btn-font-size-control:16px;--spacing-page:8px;--spacing-control-gap:4px;--dialogue-bottom-offset:calc(8px + 36px + 4px);--dialogue-side-margin:120px;--dialogue-max-height:45vh;--control-panel-top:calc(8px + 36px + 4px);--control-panel-right:8px}}@media (max-width:480px){:root{--dialogue-side-margin:100px;--dialogue-max-height:50vh;--btn-size-round:32px;--btn-size-control:28px}}.modal-overlay,.dialogue-box,.combat-panel,.character-panel,.character-creator,.instance-record,.instance-generator,.interaction-room,.dice-roller,.map-panel,.plot-review{--modal-scale:min(1,calc(100vw / 800))}@media (max-width:767px){.modal-overlay,.dialogue-box,.combat-panel,.character-panel,.character-creator,.instance-record,.instance-generator,.interaction-room,.dice-roller,.map-panel,.plot-review{--modal-scale:min(1,calc(95vw / 800))}}@media (max-width:480px){.modal-overlay,.dialogue-box,.combat-panel,.character-panel,.character-creator,.instance-record,.instance-generator,.interaction-room,.dice-roller,.map-panel,.plot-review{--modal-scale:min(1,calc(98vw / 800))}}.modal-overlay button,.modal-overlay input,.modal-overlay textarea,.modal-overlay select,.modal-overlay .btn,.modal-overlay .form-control,.modal-overlay .modal-title,.modal-overlay .close-btn,.dialogue-box button,.dialogue-box input,.dialogue-box textarea,.dialogue-box select,.dialogue-box .btn,.dialogue-box .form-control,.dialogue-box .modal-title,.dialogue-box .close-btn,.combat-panel button,.combat-panel input,.combat-panel textarea,.combat-panel select,.combat-panel .btn,.combat-panel .form-control,.combat-panel .modal-title,.combat-panel .close-btn,.character-panel button,.character-panel input,.character-panel textarea,.character-panel select,.character-panel .btn,.character-panel .form-control,.character-panel .modal-title,.character-panel .close-btn,.character-creator button,.character-creator input,.character-creator textarea,.character-creator select,.character-creator .btn,.character-creator .form-control,.character-creator .modal-title,.character-creator .close-btn,.instance-record button,.instance-record input,.instance-record textarea,.instance-record select,.instance-record .btn,.instance-record .form-control,.instance-record .modal-title,.instance-record .close-btn,.instance-generator button,.instance-generator input,.instance-generator textarea,.instance-generator select,.instance-generator .btn,.instance-generator .form-control,.instance-generator .modal-title,.instance-generator .close-btn,.interaction-room button,.interaction-room input,.interaction-room textarea,.interaction-room select,.interaction-room .btn,.interaction-room .form-control,.interaction-room .modal-title,.interaction-room .close-btn,.dice-roller button,.dice-roller input,.dice-roller textarea,.dice-roller select,.dice-roller .btn,.dice-roller .form-control,.dice-roller .modal-title,.dice-roller .close-btn,.map-panel button,.map-panel input,.map-panel textarea,.map-panel select,.map-panel .btn,.map-panel .form-control,.map-panel .modal-title,.map-panel .close-btn,.plot-review button,.plot-review input,.plot-review textarea,.plot-review select,.plot-review .btn,.plot-review .form-control,.plot-review .modal-title,.plot-review .close-btn{font-size:calc(var(--base-font-size,1rem)*var(--modal-scale));padding:calc(var(--base-padding,12px)*var(--modal-scale));border-radius:calc(var(--base-border-radius,8px)*var(--modal-scale));min-height:calc(var(--base-min-height,40px)*var(--modal-scale))}.modal-overlay h1,.modal-overlay h2,.modal-overlay h3,.modal-overlay .modal-title,.dialogue-box h1,.dialogue-box h2,.dialogue-box h3,.dialogue-box .modal-title,.combat-panel h1,.combat-panel h2,.combat-panel h3,.combat-panel .modal-title,.character-panel h1,.character-panel h2,.character-panel h3,.character-panel .modal-title,.character-creator h1,.character-creator h2,.character-creator h3,.character-creator .modal-title,.instance-record h1,.instance-record h2,.instance-record h3,.instance-record .modal-title,.instance-generator h1,.instance-generator h2,.instance-generator h3,.instance-generator .modal-title,.interaction-room h1,.interaction-room h2,.interaction-room h3,.interaction-room .modal-title,.dice-roller h1,.dice-roller h2,.dice-roller h3,.dice-roller .modal-title,.map-panel h1,.map-panel h2,.map-panel h3,.map-panel .modal-title,.plot-review h1,.plot-review h2,.plot-review h3,.plot-review .modal-title{font-size:calc(var(--base-title-size,2rem)*var(--modal-scale))}.modal-overlay .button-group,.modal-overlay .form-group,.dialogue-box .button-group,.dialogue-box .form-group,.combat-panel .button-group,.combat-panel .form-group,.character-panel .button-group,.character-panel .form-group,.character-creator .button-group,.character-creator .form-group,.instance-record .button-group,.instance-record .form-group,.instance-generator .button-group,.instance-generator .form-group,.interaction-room .button-group,.interaction-room .form-group,.dice-roller .button-group,.dice-roller .form-group,.map-panel .button-group,.map-panel .form-group,.plot-review .button-group,.plot-review .form-group{gap:calc(16px*var(--modal-scale))}

/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body>